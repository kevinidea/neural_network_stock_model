Current working directory
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml
source kevin/venv/bin/activate
which python3
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/bin/python3
2024-07-15 19:50:35,390	PANIC scripts.py:900 -- `--address` is a required flag unless starting a head node with `--head`.
Error: `{}` is a required flag unless starting a head node with `{}`.
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
INFO:preprocess_data_nn.py:

Loading and preprocessing data...

DEBUG:preprocess_data_nn.py:          date   permno
626    1980-01  10006.0
5399   1980-01  10057.0
11398  1980-01  10137.0
12828  1980-01  10145.0
13984  1980-01  10153.0
DEBUG:preprocess_data_nn.py:--------------------------------------------------
INFO:main.py:preprocessed df: (667724, 161)
INFO:preprocess_data_nn.py:

Applying secondary data preprocessing..

INFO:main.py:secondary preprocessed df: (667724, 161)
INFO:main.py:df sample:     permno       pdate        ym  gvkey  sic2    absacc       acc    aeavol  ...      roaa      roea   roavola       ret        mve_m      retq  pyear     date
0  10006.0  1980-01-01  198001.0   1010    37  0.083420  0.083420  1.001090  ...  0.048684  0.141715  0.004512  0.211679   303420.750 -0.055806   1980  1980-01
1  10057.0  1980-01-01  198001.0   1098    36  0.088951  0.088951 -0.613146  ...  0.092434  0.174252  0.035698  0.282297   111423.125 -0.069431   1980  1980-01
2  10137.0  1980-01-01  198001.0   1279    49  0.041008  0.041008 -0.491307  ...  0.034895  0.097554  0.006254 -0.032258   617349.500 -0.108065   1980  1980-01
3  10145.0  1980-01-01  198001.0   1300    99  0.050486  0.050486 -0.256932  ...  0.049028  0.122729  0.004320  0.150127  1415193.000 -0.085950   1980  1980-01
4  10153.0  1980-01-01  198001.0   1308    13       NaN       NaN  1.631801  ...  0.049860  0.109950  0.009149 -0.122744   429488.500 -0.285199   1980  1980-01

[5 rows x 161 columns]
INFO:main.py:Train year start: 1980
INFO:main.py:Prediction data years: [1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020]
INFO:main.py:

Loop through all the prediction years and build optimized model for each year

INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983]
INFO:transform_data_nn.py:Train_data: (37173, 161)

INFO:transform_data_nn.py:Test data years: [1984]
INFO:transform_data_nn.py:Test_data: (13554, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984]
INFO:transform_data_nn.py:Retrain_data: (50727, 161)

INFO:transform_data_nn.py:Prediction data years: [1985]
INFO:transform_data_nn.py:Prediction_data: (14870, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([37173, 152])
            y_train_tf: torch.Size([37173])

            x_test_tf: torch.Size([13554, 152])
            y_test_tf: torch.Size([13554])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([50727, 152])
            y_retrain_tf: torch.Size([50727])

            x_prediction_tf: torch.Size([14870, 152])
            y_prediction_tf: torch.Size([14870])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([ 0.0532,  0.3675,  0.2276, -1.1851, -0.0859, -0.6627, -0.0880, -0.2748,
         0.0553, -0.1508, -0.7143, -0.2422, -0.4025, -0.2096,  0.1431,  0.6166,
        -0.1558,  0.0891,  0.0000,  0.5221, -0.3975, -0.5730, -0.0420,  0.0741,
        -0.1360, -0.1722, -0.5560,  0.0000,  0.4161,  0.5836,  0.4532, -0.1190,
         0.3308,  0.0000, -0.4383, -0.2031,  0.0581,  0.2170,  0.2272, -1.1552,
        -0.2501, -0.2802,  0.1923, -0.1684, -0.0838, -0.7201, -0.2343, -0.0456,
        -0.5920, -0.4609, -0.6104,  0.6038, -0.1768, -0.7566,  0.0567,  0.4154,
        -0.7654, -0.1756, -0.3131,  0.2321,  0.1090, -0.3835,  0.1363,  0.2755,
         0.2643, -0.1085,  0.1497, -0.0144,  0.6511, -0.3923,  0.0000,  0.0000,
         0.0000, -0.8978, -0.1755,  0.4788,  0.0382, -0.3277, -0.1897, -0.1001,
         0.0000,  0.5454, -0.1682,  0.0746, -0.5464, -0.0594, -0.0453, -0.3985,
        -0.1242,  0.1563, -0.4635, -1.3193,  0.0000,  0.3504,  1.0719,  0.6646,
        -0.4446,  0.3251, -1.2996, -1.3634, -1.4568,  0.3567,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0781, -0.8151,  0.0000, -1.1987, -0.7329, -0.9654,
         0.0675, -0.0623,  0.0000,  0.0000, -0.0258, -0.1355, -0.0767,  0.1613,
         0.1697, -0.4761, -0.4103,  0.0106,  0.1743, -0.5318,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([896]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-1.2547, -0.7306, -0.4546,  2.3913, -0.7002, -0.9413, -0.1617, -0.3357,
        -0.2258,  0.2562, -0.7941, -0.4672, -1.5882,  0.1179,  0.1496, -1.5545,
        -0.1785, -1.2155,  0.0000, -0.6723,  0.7653, -0.5730, -0.0639, -0.6812,
        -0.1246, -0.0502, -0.6477,  0.0000,  1.1025,  0.5465, -1.0192, -0.6510,
        -0.2751,  0.0000, -0.6835, -0.3870, -0.0381, -0.0292, -1.7292, -0.6582,
        -0.2528,  0.5326, -0.4599, -0.1981, -0.3786, -0.9491,  0.5567, -0.2115,
        -0.7963,  1.1124,  0.0559,  0.7866, -0.3001, -0.7566,  0.0567, -0.0130,
        -0.6629, -0.1438, -0.2388,  0.1045,  0.2321, -0.6524, -0.5977, -0.2180,
        -1.2618, -0.9039,  0.7375, -0.0162, -0.7117, -0.4823,  0.0000,  0.0000,
         0.0000, -1.2167, -0.4863, -1.1590,  0.2582, -0.3679, -0.2020,  1.3561,
         0.0000, -2.2631, -0.5793,  0.7328,  0.9336, -0.0524, -0.0431, -0.4372,
        -0.3054, -0.9095,  0.9153, -0.4669,  0.0000, -1.2514, -1.1650, -1.7189,
         1.3413, -0.7633,  0.9094, -1.7061, -1.3967, -0.7540,  0.0000,  0.0000,
         0.0000,  0.0000, -0.1690, -0.8151,  0.0000,  1.7120,  0.3904,  2.1510,
        -0.0088, -0.0623,  0.0000,  0.0000, -0.2833, -0.1608, -0.0767,  0.7204,
         0.1743, -0.9745, -0.6053, -0.6478, -0.3341, -0.0535,  0.0000,  0.0000,
         0.0000,  0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  1.0000,  0.0000,  0.0000]), tensor([945]), tensor(0.0275))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-0.0067,  0.3197,  0.2194, -1.2141, -0.1261, -0.6221, -0.0984, -0.2873,
         0.1534, -0.1619, -0.7165, -0.2269, -0.4275, -0.1703,  0.1184,  0.6090,
        -0.1475,  0.0881,  0.0000,  0.5182, -0.3056,  0.0932, -0.0394, -0.0072,
        -0.1154, -0.2093, -0.5687,  0.0000,  0.4274,  0.6948,  0.4798, -0.1521,
         0.3766,  0.0000, -0.4196, -0.1835,  0.0896,  0.2648,  0.1857, -1.1756,
        -0.2486, -0.0574,  0.1861, -0.1307, -0.0974, -0.6779, -0.1000, -0.0419,
        -0.6077, -0.2871, -0.6160,  0.6367, -0.1798, -0.2277,  0.0229,  0.4441,
        -0.7671, -0.1410, -0.3106,  0.1864,  0.0977, -0.3876,  0.1515,  0.3127,
         0.2454, -0.0990,  0.1182, -0.0331,  0.6423, -0.4089,  0.0000,  0.0000,
         0.0000, -0.8463, -0.1161,  0.5137,  0.0479, -0.3351, -0.1862, -0.0302,
         0.0000,  0.5091, -0.0908, -0.0771, -0.5431, -0.0656, -0.0515, -0.3883,
        -0.1546,  0.1526, -0.4652, -1.2916,  0.0000,  0.6123,  1.3429,  0.9783,
        -0.2574,  0.5183, -1.6086, -1.0886, -1.3142,  0.3028,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0558, -0.8242,  0.0000, -1.2617, -1.0052, -1.1608,
         0.0832, -0.0920,  0.0000,  0.0000, -0.0071, -0.1319, -0.0436,  0.1436,
         0.2193, -0.4500, -0.4138,  0.0709,  0.2018, -0.4794,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([1057]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-3.5541e-02, -3.1473e-02,  6.9044e+00, -4.8718e-01, -3.7399e-02,
         1.8157e+00,  1.8471e+00,  2.0916e+00, -5.1028e-01, -4.6532e-01,
         1.1642e+00,  1.4917e-02,  2.0411e-01,  2.9692e-02,  7.6405e-03,
        -8.2565e-03, -2.2184e-01, -2.1168e+00,  0.0000e+00, -9.0573e-03,
        -2.3354e-01,  9.3180e-02,  8.9928e-03, -1.8666e-02, -9.8145e-03,
        -2.9154e-01,  2.9385e-02,  0.0000e+00, -1.3687e+00, -9.4795e-01,
         1.4198e+00, -3.8788e-02,  1.4494e-01,  0.0000e+00,  3.3448e+00,
         1.7744e-02,  1.6136e-02, -1.7888e-01, -1.7655e-01,  1.3208e+00,
        -8.3496e-02, -1.4023e+00, -1.4078e-02, -4.2197e-01, -1.9644e-02,
         3.2230e-01, -1.3703e+00,  2.5145e-01, -3.6213e-01, -1.5088e+00,
         2.8064e+00, -1.1100e+00, -9.4838e-02, -2.2774e-01,  7.9354e-01,
         3.3974e-01, -2.1428e-02,  2.3160e-02, -2.2957e-02,  2.9556e-02,
        -8.7836e-03, -2.1470e-02,  3.6345e-02,  4.2058e-02, -9.7462e-03,
         1.5879e-02, -2.3376e-02,  1.6198e-02,  6.4233e-01,  3.8849e-02,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  3.2896e-01,  3.0743e-01,
        -1.4042e-02, -2.0656e-01,  1.2085e+00,  6.9330e+00, -3.0173e-02,
         0.0000e+00,  1.5769e-02, -3.4090e-01, -9.1126e-01, -5.2861e-01,
        -6.6146e-02, -5.1157e-02, -5.5830e-02,  5.6105e-01, -2.3373e-02,
        -4.1076e-01,  1.9687e+00,  0.0000e+00, -6.7487e-01, -3.0891e-01,
        -1.0547e+00, -3.5636e+00, -1.0826e+00,  1.0152e+00, -1.2112e+00,
        -5.3489e-01, -3.4670e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00, -6.0399e-03,  2.0349e-03,  0.0000e+00,  6.4186e-01,
        -1.1317e+00,  9.6608e-01, -4.2225e-03, -9.1975e-02,  0.0000e+00,
         0.0000e+00,  3.1905e-02, -1.0698e-02, -4.3647e-02, -1.5213e-02,
         3.4496e-02,  5.0923e-01,  8.7191e-02,  5.3129e-01,  2.3714e-01,
        -4.0068e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2420]), tensor(0.4426))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983]
INFO:main.py:Testing data year: 1984
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 3578
            device: cpu
            
2024-07-15 19:57:52,088	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-15 19:57:52,183	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-15 19:57:52,218	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-15 19:57:52,225	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-15 19:57:56,046	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-15 19:59:01,945	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_19-57-54' in 0.1366s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 3578, 'embedding_dim': 25, 'dropout_rate': 0.18, 'lr': 0.05, 'weight_decay': 0.0001251605833757037, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.041003799576261275
INFO:model_data_nn.py:Best trial testing loss: 0.035718137890381634
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-15_19-57-45_951807_1361901/artifacts/2024-07-15_19-57-54/train_fnn_2024-07-15_19-57-54/driver_artifacts/train_fnn_338fd_00037_37_dropout_rate=0.1800,embedding_dim=25,hidden_dim=25,lr=0.0500,num_layers=1,weight_decay=0.0001_2024-07-15_19-57-56
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 4249, 'embedding_dim': 25, 'dropout_rate': 0.18, 'lr': 0.05, 'weight_decay': 0.0001251605833757037, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 2.8835552940004736, 'avg_test_loss': 0.0661886196772931}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.054586043815367184, 'avg_test_loss': 0.05887085432975979}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.05031324608541613, 'avg_test_loss': 0.05921972745050818}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.04838859653989574, 'avg_test_loss': 0.05838182107624361}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.04764376872747987, 'avg_test_loss': 0.058236135580277036}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.04718210982467661, 'avg_test_loss': 0.05836895032454345}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.0467121539141365, 'avg_test_loss': 0.05843164535018347}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.046169910579919815, 'avg_test_loss': 0.05858977183194484}
INFO:model_data_nn.py:Early stopping at epoch 8
INFO:main.py:Making prediction for data in year: 1985
INFO:main.py:Prediction data shape: (14870,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1985: 0.2360206899053433
INFO:main.py:Prediction Stats:                retq          pred
count  14870.000000  14870.000000
mean       0.059184      0.058505
std        0.233633      0.035846
min       -0.916667     -0.264965
25%       -0.069152      0.040466
50%        0.042554      0.054885
75%        0.171429      0.072456
max        4.111109      0.365931
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984]
INFO:transform_data_nn.py:Train_data: (50727, 161)

INFO:transform_data_nn.py:Test data years: [1985]
INFO:transform_data_nn.py:Test_data: (14870, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Retrain_data: (65597, 161)

INFO:transform_data_nn.py:Prediction data years: [1986]
INFO:transform_data_nn.py:Prediction_data: (15019, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([50727, 152])
            y_train_tf: torch.Size([50727])

            x_test_tf: torch.Size([14870, 152])
            y_test_tf: torch.Size([14870])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([65597, 152])
            y_retrain_tf: torch.Size([65597])

            x_prediction_tf: torch.Size([15019, 152])
            y_prediction_tf: torch.Size([15019])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-0.0067,  0.3197,  0.2194, -1.2141, -0.1261, -0.6221, -0.0984, -0.2873,
         0.1534, -0.1619, -0.7165, -0.2269, -0.4275, -0.1703,  0.1184,  0.6090,
        -0.1475,  0.0881,  0.0000,  0.5182, -0.3056,  0.0932, -0.0394, -0.0072,
        -0.1154, -0.2093, -0.5687,  0.0000,  0.4274,  0.6948,  0.4798, -0.1521,
         0.3766,  0.0000, -0.4196, -0.1835,  0.0896,  0.2648,  0.1857, -1.1756,
        -0.2486, -0.0574,  0.1861, -0.1307, -0.0974, -0.6779, -0.1000, -0.0419,
        -0.6077, -0.2871, -0.6160,  0.6367, -0.1798, -0.2277,  0.0229,  0.4441,
        -0.7671, -0.1410, -0.3106,  0.1864,  0.0977, -0.3876,  0.1515,  0.3127,
         0.2454, -0.0990,  0.1182, -0.0331,  0.6423, -0.4089,  0.0000,  0.0000,
         0.0000, -0.8463, -0.1161,  0.5137,  0.0479, -0.3351, -0.1862, -0.0302,
         0.0000,  0.5091, -0.0908, -0.0771, -0.5431, -0.0656, -0.0515, -0.3883,
        -0.1546,  0.1526, -0.4652, -1.2916,  0.0000,  0.6123,  1.3429,  0.9783,
        -0.2574,  0.5183, -1.6086, -1.0886, -1.3142,  0.3028,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0558, -0.8242,  0.0000, -1.2617, -1.0052, -1.1608,
         0.0832, -0.0920,  0.0000,  0.0000, -0.0071, -0.1319, -0.0436,  0.1436,
         0.2193, -0.4500, -0.4138,  0.0709,  0.2018, -0.4794,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([1057]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-3.5541e-02, -3.1473e-02,  6.9044e+00, -4.8718e-01, -3.7399e-02,
         1.8157e+00,  1.8471e+00,  2.0916e+00, -5.1028e-01, -4.6532e-01,
         1.1642e+00,  1.4917e-02,  2.0411e-01,  2.9692e-02,  7.6405e-03,
        -8.2565e-03, -2.2184e-01, -2.1168e+00,  0.0000e+00, -9.0573e-03,
        -2.3354e-01,  9.3180e-02,  8.9928e-03, -1.8666e-02, -9.8145e-03,
        -2.9154e-01,  2.9385e-02,  0.0000e+00, -1.3687e+00, -9.4795e-01,
         1.4198e+00, -3.8788e-02,  1.4494e-01,  0.0000e+00,  3.3448e+00,
         1.7744e-02,  1.6136e-02, -1.7888e-01, -1.7655e-01,  1.3208e+00,
        -8.3496e-02, -1.4023e+00, -1.4078e-02, -4.2197e-01, -1.9644e-02,
         3.2230e-01, -1.3703e+00,  2.5145e-01, -3.6213e-01, -1.5088e+00,
         2.8064e+00, -1.1100e+00, -9.4838e-02, -2.2774e-01,  7.9354e-01,
         3.3974e-01, -2.1428e-02,  2.3160e-02, -2.2957e-02,  2.9556e-02,
        -8.7836e-03, -2.1470e-02,  3.6345e-02,  4.2058e-02, -9.7462e-03,
         1.5879e-02, -2.3376e-02,  1.6198e-02,  6.4233e-01,  3.8849e-02,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  3.2896e-01,  3.0743e-01,
        -1.4042e-02, -2.0656e-01,  1.2085e+00,  6.9330e+00, -3.0173e-02,
         0.0000e+00,  1.5769e-02, -3.4090e-01, -9.1126e-01, -5.2861e-01,
        -6.6146e-02, -5.1157e-02, -5.5830e-02,  5.6105e-01, -2.3373e-02,
        -4.1076e-01,  1.9687e+00,  0.0000e+00, -6.7487e-01, -3.0891e-01,
        -1.0547e+00, -3.5636e+00, -1.0826e+00,  1.0152e+00, -1.2112e+00,
        -5.3489e-01, -3.4670e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00, -6.0399e-03,  2.0349e-03,  0.0000e+00,  6.4186e-01,
        -1.1317e+00,  9.6608e-01, -4.2225e-03, -9.1975e-02,  0.0000e+00,
         0.0000e+00,  3.1905e-02, -1.0698e-02, -4.3647e-02, -1.5213e-02,
         3.4496e-02,  5.0923e-01,  8.7191e-02,  5.3129e-01,  2.3714e-01,
        -4.0068e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2420]), tensor(0.4426))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.0866e-01,  2.1567e-01,  1.8687e-01, -1.2464e+00, -1.4750e-01,
        -6.0599e-01, -1.1476e-01, -3.0086e-01,  2.0923e-01, -1.6396e-01,
        -7.1105e-01, -1.6450e-01, -4.3970e-01, -9.2192e-02,  9.0120e-02,
         5.5198e-01, -1.4281e-01,  8.2749e-02,  0.0000e+00,  4.3716e-01,
        -3.6548e-01, -2.8282e-01, -1.3577e-03, -7.1517e-04, -1.0327e-01,
        -2.2369e-01, -5.8433e-01,  0.0000e+00,  4.3690e-01,  7.8414e-01,
         4.8983e-01, -1.4383e-01,  3.8715e-01,  0.0000e+00, -4.1197e-01,
        -1.8811e-01,  7.5261e-02,  3.1092e-01,  1.0364e-01, -1.1787e+00,
        -2.5471e-01,  4.8843e-02,  1.3564e-01, -1.0668e-01, -1.4147e-01,
        -6.4896e-01, -3.6768e-02, -2.3174e-03, -6.2742e-01, -2.8325e-01,
        -6.2002e-01,  6.6451e-01, -1.8099e-01, -1.8662e-01,  2.1484e-02,
         4.4240e-01, -7.6693e-01, -1.0270e-01, -2.7572e-01,  1.4888e-01,
         9.8031e-02, -3.4406e-01,  1.6447e-01,  2.9799e-01,  2.0712e-01,
        -9.6412e-02,  6.7037e-02, -5.1608e-02,  6.5689e-01, -4.0800e-01,
         0.0000e+00,  0.0000e+00, -1.5042e-01, -8.0966e-01, -6.3832e-02,
         5.2703e-01,  4.8402e-02, -3.4089e-01, -1.8360e-01, -1.1685e-02,
         0.0000e+00,  3.8418e-01, -4.3338e-02, -1.5994e-01, -5.4566e-01,
        -7.2678e-02, -5.8190e-02, -3.8189e-01, -1.6225e-01,  1.5746e-01,
        -4.7465e-01, -1.2857e+00, -1.7335e+00,  8.5916e-01,  1.5859e+00,
         1.2321e+00,  3.1903e-01,  7.7744e-01, -1.8854e+00, -8.3912e-01,
        -1.1769e+00,  1.9221e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.8057e-02,  4.2140e-02,  0.0000e+00, -1.4389e+00,
        -4.1932e-01, -1.4216e+00,  9.8359e-02, -3.2869e-02,  0.0000e+00,
         0.0000e+00,  1.1453e-02, -1.5504e-01, -6.1259e-02,  1.0941e-01,
         2.4897e-01, -4.3682e-01, -4.0812e-01,  1.0562e-01,  2.0867e-01,
        -3.8885e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1179]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-4.7985e-01, -1.6106e+00, -5.5060e-01, -4.7226e-03,  4.3003e+00,
        -3.5303e-01,  1.3575e+00,  1.3208e+00, -9.6294e-01, -9.4089e-01,
        -3.5415e-03, -1.7267e-01,  2.3447e-01,  5.6794e-01,  2.5223e+00,
        -1.8668e-03, -2.1744e-01, -3.3228e-01,  0.0000e+00, -5.0880e-02,
        -2.8527e-01, -2.8282e-01,  2.4364e-03,  3.5003e-01,  1.5369e+00,
        -9.0415e-01, -2.9426e-01,  0.0000e+00,  9.5529e-02, -8.8314e-01,
         2.8603e-04,  2.4687e-01, -4.5384e-02,  0.0000e+00,  1.1446e+00,
        -1.0048e-02,  2.4348e+00, -2.1209e-01,  7.2558e-02,  7.3454e-01,
        -2.5444e-01, -5.1495e-01,  1.5967e+00, -3.6739e-01,  5.6767e+00,
        -5.8272e-02,  2.4333e+00,  5.6871e-01, -1.0539e+00,  1.2308e+00,
         7.9871e-01, -4.5356e-01, -1.0711e-01, -1.8662e-01,  7.8078e-01,
         2.3879e-01,  2.1691e+00, -7.9302e-02, -2.0149e+00, -1.8340e+00,
         5.3175e-02, -1.7157e+00, -1.0708e+00, -1.6445e+00,  5.1078e-02,
        -8.4687e-01, -8.4636e-01, -2.4089e-01, -9.0968e-03, -6.6790e-01,
         0.0000e+00,  0.0000e+00,  8.1978e+00, -6.6867e-01, -2.6865e-01,
         8.8454e-03, -2.2079e-01,  6.3787e-01,  6.9349e+00, -1.1685e-02,
         0.0000e+00,  2.8331e-01, -6.1461e-01,  1.0987e+00,  1.6332e+00,
        -6.1567e-02, -5.2940e-02, -2.8137e-01, -1.1726e+00,  4.7360e-01,
         1.9134e+00, -7.8598e-01, -1.7335e+00, -1.9806e+00, -2.0008e+00,
        -1.6215e+00, -1.1878e+00, -1.1509e+00,  2.4348e-01, -5.9449e-01,
        -3.1360e-01, -1.6351e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.9270e-02,  1.3996e-01,  0.0000e+00, -7.9850e-02,
        -1.3016e+00,  8.1629e-01, -8.0799e-04, -3.2869e-02,  0.0000e+00,
         0.0000e+00, -1.7570e+00,  1.4390e+00, -6.1259e-02,  1.3578e+00,
        -1.7508e-03, -4.8388e-01, -1.1590e+00, -7.4953e-02,  1.1934e-01,
         4.9949e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00]), tensor([2426]), tensor(0.2099))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984]
INFO:main.py:Testing data year: 1985
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 4249
            device: cpu
            
2024-07-15 20:06:20,287	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-15 20:06:20,325	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-15 20:06:20,359	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-15 20:06:20,364	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-15 20:06:22,362	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-15 20:07:30,785	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_20-06-22' in 0.1366s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 4, 'num_embeddings': 4249, 'embedding_dim': 5, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 5.891087281171031e-05, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.048883616372044365
INFO:model_data_nn.py:Best trial testing loss: 0.05781007697016506
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-15_20-06-17_816666_1361901/artifacts/2024-07-15_20-06-22/train_fnn_2024-07-15_20-06-22/driver_artifacts/train_fnn_61623_00044_44_dropout_rate=0.5200,embedding_dim=5,hidden_dim=25,lr=0.0100,num_layers=4,weight_decay=0.0001_2024-07-15_20-06-22
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 4, 'num_embeddings': 4799, 'embedding_dim': 5, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 5.891087281171031e-05, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 14.768050490476279, 'avg_test_loss': 0.31497698188838313}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.17946754346677765, 'avg_test_loss': 0.11547498493376425}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.07010565535799539, 'avg_test_loss': 0.0738030535689855}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.05316145315128542, 'avg_test_loss': 0.06601033814377703}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.05032920998300096, 'avg_test_loss': 0.06455122155405707}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.0500051712885441, 'avg_test_loss': 0.0640181755741774}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.04981261364941699, 'avg_test_loss': 0.06298987327490822}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.04995504572465726, 'avg_test_loss': 0.06390521498554844}
INFO:model_data_nn.py:Epoch 9/40, metrics: {'avg_train_loss': 0.0500001989681897, 'avg_test_loss': 0.06384199942951485}
INFO:model_data_nn.py:Epoch 10/40, metrics: {'avg_train_loss': 0.050014920793618675, 'avg_test_loss': 0.06415206203395027}
INFO:model_data_nn.py:Early stopping at epoch 10
INFO:main.py:Making prediction for data in year: 1986
INFO:main.py:Prediction data shape: (15019,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1986: 0.25331783678272596
INFO:main.py:Prediction Stats:                retq          pred
count  1.501900e+04  15019.000000
mean   2.116020e-02      0.052492
std    2.505653e-01      0.016751
min   -9.375002e-01      0.007238
25%   -1.200001e-01      0.040907
50%    1.000000e-07      0.047017
75%    1.356736e-01      0.059264
max    3.999999e+00      0.189221
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Train_data: (65597, 161)

INFO:transform_data_nn.py:Test data years: [1986]
INFO:transform_data_nn.py:Test_data: (15019, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:transform_data_nn.py:Retrain_data: (80616, 161)

INFO:transform_data_nn.py:Prediction data years: [1987]
INFO:transform_data_nn.py:Prediction_data: (15222, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([65597, 152])
            y_train_tf: torch.Size([65597])

            x_test_tf: torch.Size([15019, 152])
            y_test_tf: torch.Size([15019])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([80616, 152])
            y_retrain_tf: torch.Size([80616])

            x_prediction_tf: torch.Size([15222, 152])
            y_prediction_tf: torch.Size([15222])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.0866e-01,  2.1567e-01,  1.8687e-01, -1.2464e+00, -1.4750e-01,
        -6.0599e-01, -1.1476e-01, -3.0086e-01,  2.0923e-01, -1.6396e-01,
        -7.1105e-01, -1.6450e-01, -4.3970e-01, -9.2192e-02,  9.0120e-02,
         5.5198e-01, -1.4281e-01,  8.2749e-02,  0.0000e+00,  4.3716e-01,
        -3.6548e-01, -2.8282e-01, -1.3577e-03, -7.1517e-04, -1.0327e-01,
        -2.2369e-01, -5.8433e-01,  0.0000e+00,  4.3690e-01,  7.8414e-01,
         4.8983e-01, -1.4383e-01,  3.8715e-01,  0.0000e+00, -4.1197e-01,
        -1.8811e-01,  7.5261e-02,  3.1092e-01,  1.0364e-01, -1.1787e+00,
        -2.5471e-01,  4.8843e-02,  1.3564e-01, -1.0668e-01, -1.4147e-01,
        -6.4896e-01, -3.6768e-02, -2.3174e-03, -6.2742e-01, -2.8325e-01,
        -6.2002e-01,  6.6451e-01, -1.8099e-01, -1.8662e-01,  2.1484e-02,
         4.4240e-01, -7.6693e-01, -1.0270e-01, -2.7572e-01,  1.4888e-01,
         9.8031e-02, -3.4406e-01,  1.6447e-01,  2.9799e-01,  2.0712e-01,
        -9.6412e-02,  6.7037e-02, -5.1608e-02,  6.5689e-01, -4.0800e-01,
         0.0000e+00,  0.0000e+00, -1.5042e-01, -8.0966e-01, -6.3832e-02,
         5.2703e-01,  4.8402e-02, -3.4089e-01, -1.8360e-01, -1.1685e-02,
         0.0000e+00,  3.8418e-01, -4.3338e-02, -1.5994e-01, -5.4566e-01,
        -7.2678e-02, -5.8190e-02, -3.8189e-01, -1.6225e-01,  1.5746e-01,
        -4.7465e-01, -1.2857e+00, -1.7335e+00,  8.5916e-01,  1.5859e+00,
         1.2321e+00,  3.1903e-01,  7.7744e-01, -1.8854e+00, -8.3912e-01,
        -1.1769e+00,  1.9221e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.8057e-02,  4.2140e-02,  0.0000e+00, -1.4389e+00,
        -4.1932e-01, -1.4216e+00,  9.8359e-02, -3.2869e-02,  0.0000e+00,
         0.0000e+00,  1.1453e-02, -1.5504e-01, -6.1259e-02,  1.0941e-01,
         2.4897e-01, -4.3682e-01, -4.0812e-01,  1.0562e-01,  2.0867e-01,
        -3.8885e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1179]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-4.7985e-01, -1.6106e+00, -5.5060e-01, -4.7226e-03,  4.3003e+00,
        -3.5303e-01,  1.3575e+00,  1.3208e+00, -9.6294e-01, -9.4089e-01,
        -3.5415e-03, -1.7267e-01,  2.3447e-01,  5.6794e-01,  2.5223e+00,
        -1.8668e-03, -2.1744e-01, -3.3228e-01,  0.0000e+00, -5.0880e-02,
        -2.8527e-01, -2.8282e-01,  2.4364e-03,  3.5003e-01,  1.5369e+00,
        -9.0415e-01, -2.9426e-01,  0.0000e+00,  9.5529e-02, -8.8314e-01,
         2.8603e-04,  2.4687e-01, -4.5384e-02,  0.0000e+00,  1.1446e+00,
        -1.0048e-02,  2.4348e+00, -2.1209e-01,  7.2558e-02,  7.3454e-01,
        -2.5444e-01, -5.1495e-01,  1.5967e+00, -3.6739e-01,  5.6767e+00,
        -5.8272e-02,  2.4333e+00,  5.6871e-01, -1.0539e+00,  1.2308e+00,
         7.9871e-01, -4.5356e-01, -1.0711e-01, -1.8662e-01,  7.8078e-01,
         2.3879e-01,  2.1691e+00, -7.9302e-02, -2.0149e+00, -1.8340e+00,
         5.3175e-02, -1.7157e+00, -1.0708e+00, -1.6445e+00,  5.1078e-02,
        -8.4687e-01, -8.4636e-01, -2.4089e-01, -9.0968e-03, -6.6790e-01,
         0.0000e+00,  0.0000e+00,  8.1978e+00, -6.6867e-01, -2.6865e-01,
         8.8454e-03, -2.2079e-01,  6.3787e-01,  6.9349e+00, -1.1685e-02,
         0.0000e+00,  2.8331e-01, -6.1461e-01,  1.0987e+00,  1.6332e+00,
        -6.1567e-02, -5.2940e-02, -2.8137e-01, -1.1726e+00,  4.7360e-01,
         1.9134e+00, -7.8598e-01, -1.7335e+00, -1.9806e+00, -2.0008e+00,
        -1.6215e+00, -1.1878e+00, -1.1509e+00,  2.4348e-01, -5.9449e-01,
        -3.1360e-01, -1.6351e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.9270e-02,  1.3996e-01,  0.0000e+00, -7.9850e-02,
        -1.3016e+00,  8.1629e-01, -8.0799e-04, -3.2869e-02,  0.0000e+00,
         0.0000e+00, -1.7570e+00,  1.4390e+00, -6.1259e-02,  1.3578e+00,
        -1.7508e-03, -4.8388e-01, -1.1590e+00, -7.4953e-02,  1.1934e-01,
         4.9949e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00]), tensor([2426]), tensor(0.2099))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-0.1414,  0.1986,  0.1728, -1.2784, -0.1442, -0.6168, -0.1266, -0.3134,
         0.2711, -0.1654, -0.7099, -0.1157, -0.4643, -0.0527,  0.0539,  0.5454,
        -0.1487,  0.1052,  0.0000,  0.4468, -0.3606, -0.2099,  0.0230,  0.0144,
        -0.0802, -0.2349, -0.5752,  0.0000,  0.4123,  0.8678,  0.4872, -0.1312,
         0.4094,  0.0000, -0.3989, -0.2029,  0.0721,  0.3417,  0.0772, -1.1731,
        -0.2581,  0.0194,  0.1417, -0.0841, -0.1514, -0.6566, -0.0554, -0.0098,
        -0.5561, -0.2960, -0.6232,  0.6637, -0.1749, -0.0577,  0.0330,  0.4444,
        -0.7661, -0.0492, -0.2734,  0.0823,  0.1064, -0.3426,  0.1596,  0.2937,
         0.2057, -0.1063,  0.0391, -0.0557,  0.7033, -0.4125,  0.0000,  0.0000,
         0.0513, -0.8156, -0.0191,  0.5723,  0.0427, -0.3448, -0.1804, -0.0102,
         0.0000,  0.3570,  0.0039, -0.1845, -0.5544, -0.0788, -0.0637, -0.3736,
        -0.1572,  0.1355, -0.5050, -1.2963,  0.1945,  0.9785,  1.5414,  1.3476,
         0.4970,  0.9783, -2.0705, -0.7350, -1.1693,  0.1734,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0678,  0.3529,  0.0000, -1.5779, -0.1659, -1.6371,
         0.1135,  0.0465,  0.0000,  0.0000,  0.0170, -0.1662, -0.0735,  0.0650,
         0.2120, -0.4261, -0.3975,  0.1463,  0.2233, -0.3880,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([4168]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([ 1.7846e+00,  1.9069e+00,  3.4361e-01, -1.9137e-01,  1.3492e+00,
         2.6575e+00, -8.9253e-01, -7.8656e-01, -4.9982e-01, -6.4854e-01,
        -5.2989e-01, -1.1458e-01,  2.3261e-01, -3.7458e-01,  1.8167e+00,
         2.3084e+00, -2.2699e-01,  3.8054e+00,  0.0000e+00,  3.2725e+00,
        -9.5187e-04, -2.0993e-01,  1.1770e-02, -2.6351e-03,  6.2052e-02,
         1.0155e+00,  2.0266e+00,  0.0000e+00, -1.3806e+00, -8.3095e-01,
        -4.6921e-01, -1.4888e-01,  4.0902e-02,  0.0000e+00,  1.2258e+00,
        -2.0736e-01,  1.9689e-01,  3.9878e-01,  4.5772e+00, -5.7555e-01,
         3.6600e-01, -5.7831e-01,  2.2737e+00, -3.6082e-01,  2.8400e+00,
        -1.0271e+00, -2.3747e-01, -1.0380e+00, -6.8909e-01,  5.0096e-02,
        -6.2317e-01, -1.0957e+00, -1.3055e-01, -5.7724e-02, -7.3486e-01,
         4.8713e-02,  1.0536e+00, -3.2655e-01,  5.9465e-01,  3.3433e+00,
         2.0045e-01,  6.5240e-01,  8.6342e-01,  5.6553e-01, -1.9344e+00,
         3.9479e-01,  1.1737e+00, -5.9419e-01, -1.2752e+00, -3.7517e-01,
         0.0000e+00,  0.0000e+00,  5.1340e-02, -6.4841e-01, -1.0715e-01,
         1.5993e+00, -7.7461e-02, -3.9745e-01,  2.2093e-01, -9.8308e-01,
         0.0000e+00,  2.2845e+00, -2.7875e-01,  2.0295e+00, -6.1026e-02,
        -4.8734e-02, -4.9927e-02, -3.6036e-01, -2.2350e-01, -1.2884e-01,
        -6.0508e-01,  3.0593e+00,  1.9446e-01, -1.6323e+00, -1.7286e+00,
        -1.5430e+00, -6.3486e-01, -1.3849e+00,  2.0114e-01, -3.2475e-01,
        -3.6099e-01,  1.8927e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6502e-02,  3.5288e-01,  0.0000e+00,  7.4865e-01,
        -1.3943e+00,  3.3312e-01, -1.9827e-02,  4.6549e-02,  0.0000e+00,
         0.0000e+00,  2.7868e+00,  5.3752e-01, -7.3545e-02,  3.3132e-01,
         1.7485e+00,  4.2340e-01, -6.2935e-02,  5.9027e-03,  4.3736e-02,
         3.4040e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1368]), tensor(3.2000e-07))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:main.py:Testing data year: 1986
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 4799
            device: cpu
            
2024-07-15 20:17:00,137	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-15 20:17:00,184	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-15 20:17:00,228	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-15 20:17:00,234	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-15 20:17:02,744	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-15 20:18:37,357	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_20-17-02' in 0.1520s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 4799, 'embedding_dim': 25, 'dropout_rate': 0.18, 'lr': 0.05, 'weight_decay': 0.0001251605833757037, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.05324919805916367
INFO:model_data_nn.py:Best trial testing loss: 0.06536165946873568
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-15_20-16-57_797975_1361901/artifacts/2024-07-15_20-17-02/train_fnn_2024-07-15_20-17-02/driver_artifacts/train_fnn_df14c_00037_37_dropout_rate=0.1800,embedding_dim=25,hidden_dim=25,lr=0.0500,num_layers=1,weight_decay=0.0001_2024-07-15_20-17-02
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 5134, 'embedding_dim': 25, 'dropout_rate': 0.18, 'lr': 0.05, 'weight_decay': 0.0001251605833757037, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 3.9479463626586258, 'avg_test_loss': 0.11601782521853844}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.06457333382632997, 'avg_test_loss': 0.10406093144168456}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.057957265727103705, 'avg_test_loss': 0.09678358373542627}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.054931934710059846, 'avg_test_loss': 0.09472924821699659}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.05342947111006767, 'avg_test_loss': 0.09504975664118925}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.05257071444676036, 'avg_test_loss': 0.09419562593102455}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.052076450699851624, 'avg_test_loss': 0.09748527525613705}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.05126181510942323, 'avg_test_loss': 0.09482810090606411}
INFO:model_data_nn.py:Epoch 9/40, metrics: {'avg_train_loss': 0.05012534781699143, 'avg_test_loss': 0.09557846381018559}
INFO:model_data_nn.py:Early stopping at epoch 9
INFO:main.py:Making prediction for data in year: 1987
INFO:main.py:Prediction data shape: (15222,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1987: 0.30685707966589276
INFO:main.py:Prediction Stats:                retq          pred
count  1.522200e+04  15222.000000
mean  -7.633223e-03      0.059946
std    3.006234e-01      0.040045
min   -9.431818e-01     -0.189822
25%   -1.803514e-01      0.036937
50%   -7.049888e-07      0.050862
75%    1.343371e-01      0.071902
max    5.466666e+00      0.451143
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:transform_data_nn.py:Train_data: (80616, 161)

INFO:transform_data_nn.py:Test data years: [1987]
INFO:transform_data_nn.py:Test_data: (15222, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:transform_data_nn.py:Retrain_data: (95838, 161)

INFO:transform_data_nn.py:Prediction data years: [1988]
INFO:transform_data_nn.py:Prediction_data: (16210, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([80616, 152])
            y_train_tf: torch.Size([80616])

            x_test_tf: torch.Size([15222, 152])
            y_test_tf: torch.Size([15222])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([95838, 152])
            y_retrain_tf: torch.Size([95838])

            x_prediction_tf: torch.Size([16210, 152])
            y_prediction_tf: torch.Size([16210])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-0.1414,  0.1986,  0.1728, -1.2784, -0.1442, -0.6168, -0.1266, -0.3134,
         0.2711, -0.1654, -0.7099, -0.1157, -0.4643, -0.0527,  0.0539,  0.5454,
        -0.1487,  0.1052,  0.0000,  0.4468, -0.3606, -0.2099,  0.0230,  0.0144,
        -0.0802, -0.2349, -0.5752,  0.0000,  0.4123,  0.8678,  0.4872, -0.1312,
         0.4094,  0.0000, -0.3989, -0.2029,  0.0721,  0.3417,  0.0772, -1.1731,
        -0.2581,  0.0194,  0.1417, -0.0841, -0.1514, -0.6566, -0.0554, -0.0098,
        -0.5561, -0.2960, -0.6232,  0.6637, -0.1749, -0.0577,  0.0330,  0.4444,
        -0.7661, -0.0492, -0.2734,  0.0823,  0.1064, -0.3426,  0.1596,  0.2937,
         0.2057, -0.1063,  0.0391, -0.0557,  0.7033, -0.4125,  0.0000,  0.0000,
         0.0513, -0.8156, -0.0191,  0.5723,  0.0427, -0.3448, -0.1804, -0.0102,
         0.0000,  0.3570,  0.0039, -0.1845, -0.5544, -0.0788, -0.0637, -0.3736,
        -0.1572,  0.1355, -0.5050, -1.2963,  0.1945,  0.9785,  1.5414,  1.3476,
         0.4970,  0.9783, -2.0705, -0.7350, -1.1693,  0.1734,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0678,  0.3529,  0.0000, -1.5779, -0.1659, -1.6371,
         0.1135,  0.0465,  0.0000,  0.0000,  0.0170, -0.1662, -0.0735,  0.0650,
         0.2120, -0.4261, -0.3975,  0.1463,  0.2233, -0.3880,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([4168]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([ 1.7846e+00,  1.9069e+00,  3.4361e-01, -1.9137e-01,  1.3492e+00,
         2.6575e+00, -8.9253e-01, -7.8656e-01, -4.9982e-01, -6.4854e-01,
        -5.2989e-01, -1.1458e-01,  2.3261e-01, -3.7458e-01,  1.8167e+00,
         2.3084e+00, -2.2699e-01,  3.8054e+00,  0.0000e+00,  3.2725e+00,
        -9.5187e-04, -2.0993e-01,  1.1770e-02, -2.6351e-03,  6.2052e-02,
         1.0155e+00,  2.0266e+00,  0.0000e+00, -1.3806e+00, -8.3095e-01,
        -4.6921e-01, -1.4888e-01,  4.0902e-02,  0.0000e+00,  1.2258e+00,
        -2.0736e-01,  1.9689e-01,  3.9878e-01,  4.5772e+00, -5.7555e-01,
         3.6600e-01, -5.7831e-01,  2.2737e+00, -3.6082e-01,  2.8400e+00,
        -1.0271e+00, -2.3747e-01, -1.0380e+00, -6.8909e-01,  5.0096e-02,
        -6.2317e-01, -1.0957e+00, -1.3055e-01, -5.7724e-02, -7.3486e-01,
         4.8713e-02,  1.0536e+00, -3.2655e-01,  5.9465e-01,  3.3433e+00,
         2.0045e-01,  6.5240e-01,  8.6342e-01,  5.6553e-01, -1.9344e+00,
         3.9479e-01,  1.1737e+00, -5.9419e-01, -1.2752e+00, -3.7517e-01,
         0.0000e+00,  0.0000e+00,  5.1340e-02, -6.4841e-01, -1.0715e-01,
         1.5993e+00, -7.7461e-02, -3.9745e-01,  2.2093e-01, -9.8308e-01,
         0.0000e+00,  2.2845e+00, -2.7875e-01,  2.0295e+00, -6.1026e-02,
        -4.8734e-02, -4.9927e-02, -3.6036e-01, -2.2350e-01, -1.2884e-01,
        -6.0508e-01,  3.0593e+00,  1.9446e-01, -1.6323e+00, -1.7286e+00,
        -1.5430e+00, -6.3486e-01, -1.3849e+00,  2.0114e-01, -3.2475e-01,
        -3.6099e-01,  1.8927e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6502e-02,  3.5288e-01,  0.0000e+00,  7.4865e-01,
        -1.3943e+00,  3.3312e-01, -1.9827e-02,  4.6549e-02,  0.0000e+00,
         0.0000e+00,  2.7868e+00,  5.3752e-01, -7.3545e-02,  3.3132e-01,
         1.7485e+00,  4.2340e-01, -6.2935e-02,  5.9027e-03,  4.3736e-02,
         3.4040e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1368]), tensor(3.2000e-07))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.6749e-01,  1.8039e-01,  1.7439e-01, -1.2934e+00, -1.5217e-01,
        -6.2532e-01, -1.4105e-01, -3.2622e-01,  3.3397e-01, -1.7092e-01,
        -7.1138e-01, -7.9930e-02, -4.8715e-01, -2.8729e-02,  5.0620e-02,
         5.3680e-01, -1.5086e-01,  1.3707e-01,  0.0000e+00,  4.4747e-01,
        -3.6798e-01, -2.7737e-02,  1.7979e-02,  3.1756e-03, -6.1519e-02,
        -2.4363e-01, -5.7138e-01,  0.0000e+00,  3.8881e-01,  9.3932e-01,
         4.8111e-01, -1.3014e-01,  4.3260e-01,  0.0000e+00, -3.8304e-01,
        -1.9981e-01,  7.3661e-02,  3.5875e-01,  5.9394e-02, -1.1663e+00,
        -2.6389e-01,  6.3167e-02,  1.5538e-01, -6.6349e-02, -1.6337e-01,
        -6.5926e-01, -3.2849e-02, -9.8768e-03, -5.4961e-01, -2.9247e-01,
        -6.2524e-01,  6.5618e-01, -1.6367e-01, -1.3712e-03,  3.0379e-02,
         4.4666e-01, -7.6340e-01, -1.8507e-02, -2.7156e-01,  4.5804e-02,
         1.0842e-01, -3.4037e-01,  1.5983e-01,  2.9087e-01,  1.9905e-01,
        -1.1055e-01,  1.8707e-02, -6.5066e-02,  7.2838e-01, -4.1396e-01,
         0.0000e+00,  0.0000e+00,  2.9079e-03, -8.1796e-01,  1.3836e-02,
         5.9724e-01,  4.4363e-02, -3.4442e-01, -1.8141e-01, -1.1348e-02,
         0.0000e+00,  3.2837e-01,  4.7142e-02, -2.1021e-01, -5.5949e-01,
        -8.4724e-02, -6.9207e-02, -3.6622e-01, -1.4938e-01,  1.0129e-01,
        -5.1817e-01, -1.3017e+00,  9.1096e-02,  1.0397e+00,  1.5247e+00,
         1.4285e+00,  5.4615e-01,  1.1460e+00, -2.2843e+00, -6.0600e-01,
        -1.2501e+00,  1.5397e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.2503e-02,  7.6798e-02,  0.0000e+00, -1.7350e+00,
         2.3586e-02, -1.8329e+00,  1.2462e-01,  8.6240e-02,  0.0000e+00,
         0.0000e+00,  2.4629e-02, -1.7408e-01, -7.1432e-02,  3.1925e-02,
         2.0089e-01, -4.1318e-01, -3.9079e-01,  1.7856e-01,  2.3805e-01,
        -3.9978e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([4640]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-6.8700e-03, -1.3906e-03, -6.2760e-01, -8.1075e-01, -6.9975e-01,
        -1.2774e-01, -1.8530e+00, -1.0250e+00, -1.8833e-02,  3.1154e-04,
        -3.5055e-01, -2.2122e-01,  5.2339e-02, -5.7797e-03,  3.0203e-02,
        -1.4377e+00, -2.2830e-01, -1.2641e-01,  0.0000e+00, -2.4754e-01,
         3.5335e-01, -2.7737e-02,  1.3908e-03,  3.7832e-02,  8.8959e-03,
        -6.3207e-01, -7.4060e-01,  0.0000e+00, -7.5916e-01,  2.7774e-02,
        -9.9067e-01, -3.3856e-01,  4.6256e-02,  0.0000e+00, -2.4031e+00,
         9.2312e-03, -6.2428e-01, -5.2958e-01, -2.9028e-01, -7.8854e-01,
         7.0285e-01, -9.9150e-01, -5.3299e-01, -1.9134e-01,  1.1251e-02,
        -1.0866e-01, -5.3210e-01, -2.8988e-01, -2.8152e-01, -6.9593e-02,
         1.1890e-01, -1.4763e+00, -4.8603e-01, -1.3712e-03, -7.4046e-01,
        -1.6129e+00, -1.0878e+00, -3.7510e-01, -5.6659e-02,  5.8481e-03,
        -2.8530e+00, -5.3244e-02, -9.0868e-02, -5.0486e+00, -4.3985e-03,
        -3.9025e-01, -8.4175e-03,  1.7970e+00, -5.7971e-01, -3.6225e-01,
         0.0000e+00,  0.0000e+00,  2.9079e-03,  1.4063e-01, -1.8985e-01,
        -2.2815e-01, -1.4983e-01,  3.2499e+00, -2.0335e-01, -1.1348e-02,
         0.0000e+00, -9.9196e-01, -3.1309e-02,  2.4329e+00,  3.8119e+00,
        -7.3119e-02, -6.3627e-02, -2.3311e-01,  6.0460e-01, -2.8651e-01,
         7.7305e-01,  5.7043e-01,  9.1096e-02, -7.2100e-01, -5.6034e-01,
        -1.0275e+00,  6.9980e-01, -1.0601e+00,  7.4176e-01, -9.7179e-01,
         5.6117e+00, -3.1374e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.0423e-02,  7.6798e-02,  0.0000e+00, -1.1967e+00,
        -1.4312e+00,  1.0112e-01, -1.5572e-02,  5.0367e+00,  0.0000e+00,
         0.0000e+00, -1.4247e+00, -2.4009e-01, -7.1432e-02,  1.6151e+00,
         5.1085e-03,  7.5954e-01, -3.9705e-01, -7.9781e-02, -1.5664e-02,
         1.0374e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2340]), tensor(0.0613))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:main.py:Testing data year: 1987
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 5134
            device: cpu
            
2024-07-15 20:30:12,832	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-15 20:30:12,869	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-15 20:30:12,920	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-15 20:30:12,926	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-15 20:30:15,122	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-15 20:31:43,989	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_20-30-15' in 0.1339s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 5134, 'embedding_dim': 5, 'dropout_rate': 0.44, 'lr': 0.007, 'weight_decay': 8.707410675803571e-05, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.046399144248829946
INFO:model_data_nn.py:Best trial testing loss: 0.0818508705124259
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-15_20-30-10_253814_1361901/artifacts/2024-07-15_20-30-15/train_fnn_2024-07-15_20-30-15/driver_artifacts/train_fnn_b7600_00042_42_dropout_rate=0.4400,embedding_dim=5,hidden_dim=25,lr=0.0070,num_layers=1,weight_decay=0.0001_2024-07-15_20-30-15
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 5713, 'embedding_dim': 5, 'dropout_rate': 0.44, 'lr': 0.007, 'weight_decay': 8.707410675803571e-05, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 18.145081043402353, 'avg_test_loss': 0.270462105050683}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.2367604213754336, 'avg_test_loss': 0.1093564567854628}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.09057795177896817, 'avg_test_loss': 0.074131814239081}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.06682551069060962, 'avg_test_loss': 0.06576589914038777}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.06040025078256925, 'avg_test_loss': 0.062488433643011376}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.05853547415137291, 'avg_test_loss': 0.06253262649988756}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.05764174218972524, 'avg_test_loss': 0.06291651562787592}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.057374050706624984, 'avg_test_loss': 0.06352833303390071}
INFO:model_data_nn.py:Early stopping at epoch 8
INFO:main.py:Making prediction for data in year: 1988
INFO:main.py:Prediction data shape: (16210,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1988: 0.25002862467284537
INFO:main.py:Prediction Stats:                retq          pred
count  16210.000000  16210.000000
mean       0.049695      0.034119
std        0.249702      0.018828
min       -0.901408     -0.178787
25%       -0.072601      0.024192
50%        0.019064      0.033350
75%        0.142858      0.043948
max        5.000002      0.228925
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:transform_data_nn.py:Train_data: (95838, 161)

INFO:transform_data_nn.py:Test data years: [1988]
INFO:transform_data_nn.py:Test_data: (16210, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:transform_data_nn.py:Retrain_data: (112048, 161)

INFO:transform_data_nn.py:Prediction data years: [1989]
INFO:transform_data_nn.py:Prediction_data: (16366, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([95838, 152])
            y_train_tf: torch.Size([95838])

            x_test_tf: torch.Size([16210, 152])
            y_test_tf: torch.Size([16210])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([112048, 152])
            y_retrain_tf: torch.Size([112048])

            x_prediction_tf: torch.Size([16366, 152])
            y_prediction_tf: torch.Size([16366])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.6749e-01,  1.8039e-01,  1.7439e-01, -1.2934e+00, -1.5217e-01,
        -6.2532e-01, -1.4105e-01, -3.2622e-01,  3.3397e-01, -1.7092e-01,
        -7.1138e-01, -7.9930e-02, -4.8715e-01, -2.8729e-02,  5.0620e-02,
         5.3680e-01, -1.5086e-01,  1.3707e-01,  0.0000e+00,  4.4747e-01,
        -3.6798e-01, -2.7737e-02,  1.7979e-02,  3.1756e-03, -6.1519e-02,
        -2.4363e-01, -5.7138e-01,  0.0000e+00,  3.8881e-01,  9.3932e-01,
         4.8111e-01, -1.3014e-01,  4.3260e-01,  0.0000e+00, -3.8304e-01,
        -1.9981e-01,  7.3661e-02,  3.5875e-01,  5.9394e-02, -1.1663e+00,
        -2.6389e-01,  6.3167e-02,  1.5538e-01, -6.6349e-02, -1.6337e-01,
        -6.5926e-01, -3.2849e-02, -9.8768e-03, -5.4961e-01, -2.9247e-01,
        -6.2524e-01,  6.5618e-01, -1.6367e-01, -1.3712e-03,  3.0379e-02,
         4.4666e-01, -7.6340e-01, -1.8507e-02, -2.7156e-01,  4.5804e-02,
         1.0842e-01, -3.4037e-01,  1.5983e-01,  2.9087e-01,  1.9905e-01,
        -1.1055e-01,  1.8707e-02, -6.5066e-02,  7.2838e-01, -4.1396e-01,
         0.0000e+00,  0.0000e+00,  2.9079e-03, -8.1796e-01,  1.3836e-02,
         5.9724e-01,  4.4363e-02, -3.4442e-01, -1.8141e-01, -1.1348e-02,
         0.0000e+00,  3.2837e-01,  4.7142e-02, -2.1021e-01, -5.5949e-01,
        -8.4724e-02, -6.9207e-02, -3.6622e-01, -1.4938e-01,  1.0129e-01,
        -5.1817e-01, -1.3017e+00,  9.1096e-02,  1.0397e+00,  1.5247e+00,
         1.4285e+00,  5.4615e-01,  1.1460e+00, -2.2843e+00, -6.0600e-01,
        -1.2501e+00,  1.5397e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.2503e-02,  7.6798e-02,  0.0000e+00, -1.7350e+00,
         2.3586e-02, -1.8329e+00,  1.2462e-01,  8.6240e-02,  0.0000e+00,
         0.0000e+00,  2.4629e-02, -1.7408e-01, -7.1432e-02,  3.1925e-02,
         2.0089e-01, -4.1318e-01, -3.9079e-01,  1.7856e-01,  2.3805e-01,
        -3.9978e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([4640]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-6.8700e-03, -1.3906e-03, -6.2760e-01, -8.1075e-01, -6.9975e-01,
        -1.2774e-01, -1.8530e+00, -1.0250e+00, -1.8833e-02,  3.1154e-04,
        -3.5055e-01, -2.2122e-01,  5.2339e-02, -5.7797e-03,  3.0203e-02,
        -1.4377e+00, -2.2830e-01, -1.2641e-01,  0.0000e+00, -2.4754e-01,
         3.5335e-01, -2.7737e-02,  1.3908e-03,  3.7832e-02,  8.8959e-03,
        -6.3207e-01, -7.4060e-01,  0.0000e+00, -7.5916e-01,  2.7774e-02,
        -9.9067e-01, -3.3856e-01,  4.6256e-02,  0.0000e+00, -2.4031e+00,
         9.2312e-03, -6.2428e-01, -5.2958e-01, -2.9028e-01, -7.8854e-01,
         7.0285e-01, -9.9150e-01, -5.3299e-01, -1.9134e-01,  1.1251e-02,
        -1.0866e-01, -5.3210e-01, -2.8988e-01, -2.8152e-01, -6.9593e-02,
         1.1890e-01, -1.4763e+00, -4.8603e-01, -1.3712e-03, -7.4046e-01,
        -1.6129e+00, -1.0878e+00, -3.7510e-01, -5.6659e-02,  5.8481e-03,
        -2.8530e+00, -5.3244e-02, -9.0868e-02, -5.0486e+00, -4.3985e-03,
        -3.9025e-01, -8.4175e-03,  1.7970e+00, -5.7971e-01, -3.6225e-01,
         0.0000e+00,  0.0000e+00,  2.9079e-03,  1.4063e-01, -1.8985e-01,
        -2.2815e-01, -1.4983e-01,  3.2499e+00, -2.0335e-01, -1.1348e-02,
         0.0000e+00, -9.9196e-01, -3.1309e-02,  2.4329e+00,  3.8119e+00,
        -7.3119e-02, -6.3627e-02, -2.3311e-01,  6.0460e-01, -2.8651e-01,
         7.7305e-01,  5.7043e-01,  9.1096e-02, -7.2100e-01, -5.6034e-01,
        -1.0275e+00,  6.9980e-01, -1.0601e+00,  7.4176e-01, -9.7179e-01,
         5.6117e+00, -3.1374e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.0423e-02,  7.6798e-02,  0.0000e+00, -1.1967e+00,
        -1.4312e+00,  1.0112e-01, -1.5572e-02,  5.0367e+00,  0.0000e+00,
         0.0000e+00, -1.4247e+00, -2.4009e-01, -7.1432e-02,  1.6151e+00,
         5.1085e-03,  7.5954e-01, -3.9705e-01, -7.9781e-02, -1.5664e-02,
         1.0374e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2340]), tensor(0.0613))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-2.0368e-01,  1.4613e-01,  1.6670e-01, -1.2996e+00, -1.5581e-01,
        -6.3490e-01, -1.5167e-01, -3.3234e-01,  3.4130e-01, -1.6509e-01,
        -7.1113e-01, -3.0598e-02, -4.9210e-01,  1.7698e-02,  2.7621e-02,
         5.2354e-01, -1.4034e-01,  1.7132e-01,  0.0000e+00,  4.3357e-01,
        -3.6155e-01,  7.5280e-02,  1.7328e-02,  8.9085e-03, -6.4428e-02,
        -2.5203e-01, -5.6494e-01,  0.0000e+00,  4.0549e-01,  9.9060e-01,
         4.7090e-01, -1.2756e-01,  4.3668e-01,  0.0000e+00, -3.7373e-01,
        -1.9599e-01,  6.2056e-02,  3.9172e-01,  3.1288e-02, -1.1685e+00,
        -2.7627e-01,  2.4020e-01,  1.8337e-01, -6.8351e-02, -1.7270e-01,
        -6.6981e-01,  7.0629e-02, -5.5404e-02, -5.4842e-01, -2.0600e-01,
        -6.1664e-01,  6.6804e-01, -1.6028e-01,  2.4212e-03,  2.3795e-02,
         4.4623e-01, -7.5902e-01, -7.9499e-06, -2.6507e-01,  1.4397e-02,
         1.1498e-01, -3.3111e-01,  1.5373e-01,  2.8344e-01,  1.5654e-01,
        -1.1914e-01, -4.6283e-03, -7.3628e-02,  7.4786e-01, -4.1645e-01,
         0.0000e+00,  0.0000e+00, -1.9676e-01, -8.1574e-01,  3.7799e-02,
         5.7971e-01,  4.3629e-02, -3.4559e-01, -1.8308e-01, -4.2580e-03,
         0.0000e+00,  2.7307e-01,  5.3735e-02, -2.4523e-01, -5.5063e-01,
        -9.1112e-02, -7.4417e-02, -3.6511e-01, -1.3978e-01,  1.0272e-01,
        -5.1587e-01, -1.2930e+00,  3.7267e-02,  1.1955e+00,  1.6803e+00,
         1.5826e+00,  5.7628e-01,  1.3009e+00, -2.4806e+00, -4.5262e-01,
        -1.0432e+00,  1.1783e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.2399e-02,  2.5983e-01,  0.0000e+00, -1.4926e+00,
         2.5113e-01, -2.0098e+00,  1.3238e-01,  2.3763e-02,  0.0000e+00,
         0.0000e+00,  2.7788e-02, -1.7916e-01,  1.6315e-02,  6.6375e-03,
         1.8096e-01, -4.1411e-01, -3.8277e-01,  1.9860e-01,  2.4497e-01,
        -3.9885e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([5143]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-1.0328e-02, -4.5945e-03, -6.1175e-01, -4.2919e-01, -2.9979e-01,
        -5.8820e-02, -1.9398e+00, -1.0548e+00, -4.8105e-02,  9.2327e-02,
        -1.9427e-02,  1.6832e-02, -3.9303e-02, -1.2090e-02,  3.2950e-02,
         3.7676e-01, -2.2029e-01, -4.9129e-01,  0.0000e+00,  5.6969e-03,
        -8.4695e-02,  7.5280e-02,  3.7865e-02,  9.6094e-01, -7.9298e-03,
        -4.5620e-03, -7.2574e-01,  0.0000e+00, -1.4182e+00,  3.7398e-02,
         4.2706e-01, -1.7737e-01,  2.7372e-01,  0.0000e+00,  1.7543e-03,
        -6.5350e-01,  7.9022e-03, -5.5227e-01, -8.4291e-01, -7.9602e-01,
         8.6959e-01,  7.0136e-02,  1.2240e-02,  2.1631e-02, -3.8938e-03,
         3.6990e-01,  6.9289e-02, -2.2570e-01, -4.2325e-01,  3.5530e-02,
         8.9260e-01, -1.3853e+00, -5.1862e-01, -2.5414e+00, -7.4346e-01,
         1.2464e-02, -1.0845e+00,  6.9339e-01,  7.3179e-03, -4.0037e-01,
        -5.0445e-03,  7.0648e-03,  7.1479e-03,  9.0722e-03, -1.6392e-02,
        -3.6987e-04, -9.4731e-03,  1.7388e+00,  1.3989e+00, -9.5058e-03,
         0.0000e+00,  0.0000e+00, -1.9676e-01,  6.6468e-01,  1.7143e-02,
        -8.8511e-02,  3.6591e-04, -1.2622e-03,  7.1653e-04, -4.2580e-03,
         0.0000e+00, -3.3035e-01, -6.4811e-02, -4.3878e-01, -5.6962e-01,
        -7.8317e-02, -6.8695e-02,  2.3996e-02, -1.0220e-04, -9.2791e-02,
        -6.5617e-01,  6.2750e-01,  3.7267e-02, -6.8854e-01,  8.3982e-02,
        -1.0567e+00, -1.3036e+00, -1.2722e-01, -6.6624e-01, -1.0806e+00,
        -9.2166e-01, -6.2909e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0426e-02,  2.5983e-01,  0.0000e+00, -1.3044e+00,
        -1.2224e+00,  4.1615e-01,  6.2709e-02,  2.3763e-02,  0.0000e+00,
         0.0000e+00,  1.2651e-02, -2.0436e-01,  1.6315e-02, -2.0294e-02,
        -8.1752e-04,  1.9352e-03, -2.3160e-02,  2.4850e-01,  1.9696e-01,
         1.4419e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2274]), tensor(0.0776))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:main.py:Testing data year: 1988
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 5713
            device: cpu
            
2024-07-15 20:44:58,810	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-15 20:44:58,855	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-15 20:44:58,894	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-15 20:44:58,899	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-15 20:45:01,531	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-15 20:46:42,221	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_20-45-01' in 0.1292s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 2, 'num_embeddings': 5713, 'embedding_dim': 30, 'dropout_rate': 0.36, 'lr': 0.05, 'weight_decay': 0.00028480262754225174, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.05867478186885516
INFO:model_data_nn.py:Best trial testing loss: 0.06381186348153278
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-15_20-44-56_417685_1361901/artifacts/2024-07-15_20-45-01/train_fnn_2024-07-15_20-45-01/driver_artifacts/train_fnn_c7b75_00010_10_dropout_rate=0.3600,embedding_dim=30,hidden_dim=15,lr=0.0500,num_layers=2,weight_decay=0.0003_2024-07-15_20-45-01
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 2, 'num_embeddings': 6323, 'embedding_dim': 30, 'dropout_rate': 0.36, 'lr': 0.05, 'weight_decay': 0.00028480262754225174, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 1.0377103854906342, 'avg_test_loss': 0.06351058767177165}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.06029770954524818, 'avg_test_loss': 0.06296679776278324}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.06024766939619905, 'avg_test_loss': 0.06650607025949284}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.0599003469562966, 'avg_test_loss': 0.06292860858957283}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.0597400958033185, 'avg_test_loss': 0.06578646786510944}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.06010419691670431, 'avg_test_loss': 0.06395535249612294}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.05956754388636378, 'avg_test_loss': 0.06331519805826247}
INFO:model_data_nn.py:Early stopping at epoch 7
INFO:main.py:Making prediction for data in year: 1989
INFO:main.py:Prediction data shape: (16366,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1989: 0.2515527027523669
INFO:main.py:Prediction Stats:                retq          pred
count  16366.000000  16366.000000
mean       0.032052      0.031381
std        0.251212      0.011158
min       -0.945313     -0.021345
25%       -0.090909      0.026433
50%        0.016642      0.029549
75%        0.132440      0.032218
max        3.923078      0.176381
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:transform_data_nn.py:Train_data: (112048, 161)

INFO:transform_data_nn.py:Test data years: [1989]
INFO:transform_data_nn.py:Test_data: (16366, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:transform_data_nn.py:Retrain_data: (128414, 161)

INFO:transform_data_nn.py:Prediction data years: [1990]
INFO:transform_data_nn.py:Prediction_data: (16126, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([112048, 152])
            y_train_tf: torch.Size([112048])

            x_test_tf: torch.Size([16366, 152])
            y_test_tf: torch.Size([16366])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([128414, 152])
            y_retrain_tf: torch.Size([128414])

            x_prediction_tf: torch.Size([16126, 152])
            y_prediction_tf: torch.Size([16126])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-2.0368e-01,  1.4613e-01,  1.6670e-01, -1.2996e+00, -1.5581e-01,
        -6.3490e-01, -1.5167e-01, -3.3234e-01,  3.4130e-01, -1.6509e-01,
        -7.1113e-01, -3.0598e-02, -4.9210e-01,  1.7698e-02,  2.7621e-02,
         5.2354e-01, -1.4034e-01,  1.7132e-01,  0.0000e+00,  4.3357e-01,
        -3.6155e-01,  7.5280e-02,  1.7328e-02,  8.9085e-03, -6.4428e-02,
        -2.5203e-01, -5.6494e-01,  0.0000e+00,  4.0549e-01,  9.9060e-01,
         4.7090e-01, -1.2756e-01,  4.3668e-01,  0.0000e+00, -3.7373e-01,
        -1.9599e-01,  6.2056e-02,  3.9172e-01,  3.1288e-02, -1.1685e+00,
        -2.7627e-01,  2.4020e-01,  1.8337e-01, -6.8351e-02, -1.7270e-01,
        -6.6981e-01,  7.0629e-02, -5.5404e-02, -5.4842e-01, -2.0600e-01,
        -6.1664e-01,  6.6804e-01, -1.6028e-01,  2.4212e-03,  2.3795e-02,
         4.4623e-01, -7.5902e-01, -7.9499e-06, -2.6507e-01,  1.4397e-02,
         1.1498e-01, -3.3111e-01,  1.5373e-01,  2.8344e-01,  1.5654e-01,
        -1.1914e-01, -4.6283e-03, -7.3628e-02,  7.4786e-01, -4.1645e-01,
         0.0000e+00,  0.0000e+00, -1.9676e-01, -8.1574e-01,  3.7799e-02,
         5.7971e-01,  4.3629e-02, -3.4559e-01, -1.8308e-01, -4.2580e-03,
         0.0000e+00,  2.7307e-01,  5.3735e-02, -2.4523e-01, -5.5063e-01,
        -9.1112e-02, -7.4417e-02, -3.6511e-01, -1.3978e-01,  1.0272e-01,
        -5.1587e-01, -1.2930e+00,  3.7267e-02,  1.1955e+00,  1.6803e+00,
         1.5826e+00,  5.7628e-01,  1.3009e+00, -2.4806e+00, -4.5262e-01,
        -1.0432e+00,  1.1783e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.2399e-02,  2.5983e-01,  0.0000e+00, -1.4926e+00,
         2.5113e-01, -2.0098e+00,  1.3238e-01,  2.3763e-02,  0.0000e+00,
         0.0000e+00,  2.7788e-02, -1.7916e-01,  1.6315e-02,  6.6375e-03,
         1.8096e-01, -4.1411e-01, -3.8277e-01,  1.9860e-01,  2.4497e-01,
        -3.9885e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([5143]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-1.0328e-02, -4.5945e-03, -6.1175e-01, -4.2919e-01, -2.9979e-01,
        -5.8820e-02, -1.9398e+00, -1.0548e+00, -4.8105e-02,  9.2327e-02,
        -1.9427e-02,  1.6832e-02, -3.9303e-02, -1.2090e-02,  3.2950e-02,
         3.7676e-01, -2.2029e-01, -4.9129e-01,  0.0000e+00,  5.6969e-03,
        -8.4695e-02,  7.5280e-02,  3.7865e-02,  9.6094e-01, -7.9298e-03,
        -4.5620e-03, -7.2574e-01,  0.0000e+00, -1.4182e+00,  3.7398e-02,
         4.2706e-01, -1.7737e-01,  2.7372e-01,  0.0000e+00,  1.7543e-03,
        -6.5350e-01,  7.9022e-03, -5.5227e-01, -8.4291e-01, -7.9602e-01,
         8.6959e-01,  7.0136e-02,  1.2240e-02,  2.1631e-02, -3.8938e-03,
         3.6990e-01,  6.9289e-02, -2.2570e-01, -4.2325e-01,  3.5530e-02,
         8.9260e-01, -1.3853e+00, -5.1862e-01, -2.5414e+00, -7.4346e-01,
         1.2464e-02, -1.0845e+00,  6.9339e-01,  7.3179e-03, -4.0037e-01,
        -5.0445e-03,  7.0648e-03,  7.1479e-03,  9.0722e-03, -1.6392e-02,
        -3.6987e-04, -9.4731e-03,  1.7388e+00,  1.3989e+00, -9.5058e-03,
         0.0000e+00,  0.0000e+00, -1.9676e-01,  6.6468e-01,  1.7143e-02,
        -8.8511e-02,  3.6591e-04, -1.2622e-03,  7.1653e-04, -4.2580e-03,
         0.0000e+00, -3.3035e-01, -6.4811e-02, -4.3878e-01, -5.6962e-01,
        -7.8317e-02, -6.8695e-02,  2.3996e-02, -1.0220e-04, -9.2791e-02,
        -6.5617e-01,  6.2750e-01,  3.7267e-02, -6.8854e-01,  8.3982e-02,
        -1.0567e+00, -1.3036e+00, -1.2722e-01, -6.6624e-01, -1.0806e+00,
        -9.2166e-01, -6.2909e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0426e-02,  2.5983e-01,  0.0000e+00, -1.3044e+00,
        -1.2224e+00,  4.1615e-01,  6.2709e-02,  2.3763e-02,  0.0000e+00,
         0.0000e+00,  1.2651e-02, -2.0436e-01,  1.6315e-02, -2.0294e-02,
        -8.1752e-04,  1.9352e-03, -2.3160e-02,  2.4850e-01,  1.9696e-01,
         1.4419e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2274]), tensor(0.0776))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.9888e-01,  2.4175e-01,  1.5162e-01, -1.3099e+00, -1.4741e-01,
        -6.3165e-01, -1.6069e-01, -3.3851e-01,  3.5518e-01, -1.6748e-01,
        -7.0992e-01, -1.6779e-02, -4.9800e-01, -2.6410e-02,  5.4492e-02,
         5.1524e-01, -1.3399e-01,  1.9059e-01, -2.4120e-02,  4.2271e-01,
        -3.6509e-01,  6.2610e-02,  2.5325e-02,  1.1384e-02, -6.3968e-02,
        -2.5729e-01, -5.7182e-01, -8.8892e-02,  4.0815e-01,  1.0331e+00,
         4.6613e-01, -1.1249e-01,  4.4130e-01,  6.9937e-02, -3.7023e-01,
        -1.9514e-01,  6.5328e-02,  4.2076e-01,  1.4483e-02, -1.1635e+00,
        -2.8302e-01,  2.5730e-01,  2.0227e-01, -6.9445e-02, -1.7670e-01,
        -6.6391e-01,  7.2989e-02, -5.6736e-02, -4.9058e-01, -2.0618e-01,
        -6.2754e-01,  6.7258e-01, -1.5462e-01, -8.1040e-02,  2.3827e-02,
         4.4010e-01, -7.5521e-01,  1.3362e-02, -2.5698e-01, -1.0978e-02,
         1.2090e-01, -3.2007e-01,  1.4735e-01,  2.7103e-01,  1.3328e-01,
        -1.2598e-01,  6.7935e-02, -8.1626e-02,  7.4496e-01, -4.1644e-01,
         0.0000e+00,  0.0000e+00, -1.1640e-01, -8.0519e-01,  5.6881e-02,
         5.7511e-01,  3.9681e-02, -3.4605e-01, -1.8426e-01, -2.1421e-03,
        -1.4698e-02,  2.4485e-01,  5.8111e-02, -2.7826e-01, -5.5057e-01,
        -9.6684e-02, -7.8830e-02, -3.5740e-01, -1.2274e-01,  1.1675e-01,
        -5.1316e-01, -1.2843e+00,  8.6597e-03,  1.3297e+00,  1.8072e+00,
         1.7105e+00,  7.2289e-01,  1.4011e+00, -2.3735e+00, -2.5662e-01,
        -9.9383e-01,  9.8230e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.3717e-02,  3.4823e-01,  0.0000e+00, -1.2770e+00,
         3.9812e-01, -2.1813e+00,  1.3916e-01,  2.8586e-02,  0.0000e+00,
         0.0000e+00,  2.1786e-02, -1.8152e-01,  1.6267e-02, -1.8414e-02,
         8.2592e-02, -4.2343e-01, -3.7704e-01,  2.1237e-01,  2.4886e-01,
        -4.0087e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([5399]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([ 1.4584e-02,  6.3886e-02, -7.9550e-01, -1.1657e-01,  7.9758e-01,
        -7.0532e-01, -1.9870e+00, -1.0734e+00, -3.6949e-01, -1.4820e-01,
        -1.3949e-02,  1.1311e-02, -4.0241e-02, -5.3472e-02,  2.8244e-02,
         5.4960e-01, -1.9454e-01,  7.6766e-01,  4.7940e-01,  1.0482e-02,
         7.1274e-01, -2.1217e-01,  4.4143e-02, -4.2309e-01,  5.0684e-01,
        -5.9167e-03, -7.2234e-01, -8.8892e-02, -7.8899e-01,  3.2734e-02,
         1.8189e-01,  4.2959e-03,  3.3217e-01,  6.9937e-02, -2.7940e-04,
        -1.1348e+00,  1.0277e-02, -5.7281e-01,  6.2460e-01, -7.1152e-01,
        -1.3769e-01,  1.3250e-01,  1.1561e-02,  2.2164e-02, -2.5906e-03,
        -4.3427e-01,  9.3256e-01,  2.4867e-01, -4.2093e-01,  1.1561e+00,
         1.6633e+00, -1.0965e+00, -6.3259e-01, -1.2558e+00, -7.4224e-01,
         9.6668e-03, -1.0816e+00,  1.1522e+00,  9.5753e-04,  5.6143e-02,
        -3.8307e-03,  7.1953e-04,  4.4287e-03,  1.3628e-02, -3.1390e-03,
        -2.6362e-03,  3.9700e-02, -2.5201e+00,  9.2752e-02, -9.2406e-03,
         0.0000e+00,  0.0000e+00, -1.1640e-01, -5.4046e-01,  1.2246e-02,
         3.0416e-01,  9.7548e-04, -2.2895e-03,  2.6460e-03, -2.1421e-03,
         1.9614e-01,  5.8838e-01, -1.5876e-01,  2.9465e-02, -4.6237e-01,
        -8.5136e-02, -7.3785e-02,  2.9507e-02,  6.0131e-03,  2.8181e-01,
        -5.4587e-01, -1.2843e+00,  8.6597e-03, -1.1177e+00, -8.7787e-01,
        -1.2271e+00, -5.5954e-01, -2.9398e-01, -8.9560e-01, -1.1520e+00,
        -6.3334e-01,  2.2149e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.5919e-02,  4.1491e-01,  0.0000e+00, -9.6291e-01,
        -9.4916e-01,  2.5299e-01,  1.1801e-01,  2.8586e-02,  0.0000e+00,
         0.0000e+00,  1.0858e-02,  2.3569e-01,  1.6267e-02, -1.9918e-02,
        -4.3167e-02,  1.1825e-03, -2.1146e-02,  3.4402e-01,  3.6973e-01,
        -2.7416e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2216]), tensor(-0.0123))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:main.py:Testing data year: 1989
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 6323
            device: cpu
            
2024-07-15 21:02:01,823	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-15 21:02:01,860	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-15 21:02:01,893	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-15 21:02:01,897	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-15 21:02:03,882	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-15 21:03:50,704	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_21-02-03' in 0.1338s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 6323, 'embedding_dim': 15, 'dropout_rate': 0.37, 'lr': 0.05, 'weight_decay': 0.0004986865424754641, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.05612145957524237
INFO:model_data_nn.py:Best trial testing loss: 0.06348690117010847
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-15_21-01-59_498157_1361901/artifacts/2024-07-15_21-02-03/train_fnn_2024-07-15_21-02-03/driver_artifacts/train_fnn_2915b_00016_16_dropout_rate=0.3700,embedding_dim=15,hidden_dim=25,lr=0.0500,num_layers=1,weight_decay=0.0005_2024-07-15_21-02-04
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 6635, 'embedding_dim': 15, 'dropout_rate': 0.37, 'lr': 0.05, 'weight_decay': 0.0004986865424754641, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 2.303169004864011, 'avg_test_loss': 0.1078967261645529}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.06220489868753222, 'avg_test_loss': 0.108780470987161}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.06087584647375986, 'avg_test_loss': 0.10598762966101131}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.060964929266458016, 'avg_test_loss': 0.10593454403773186}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.06069261352142015, 'avg_test_loss': 0.10452957380385626}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.059704036500111995, 'avg_test_loss': 0.10267946644434853}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.0582372702183239, 'avg_test_loss': 0.1003567844865814}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.057303904848863406, 'avg_test_loss': 0.10633277526450535}
INFO:model_data_nn.py:Epoch 9/40, metrics: {'avg_train_loss': 0.056372742201999365, 'avg_test_loss': 0.10238335997102753}
INFO:model_data_nn.py:Epoch 10/40, metrics: {'avg_train_loss': 0.055627484920905884, 'avg_test_loss': 0.10031895641060103}
INFO:model_data_nn.py:Epoch 11/40, metrics: {'avg_train_loss': 0.05540807401961777, 'avg_test_loss': 0.10601729290589454}
INFO:model_data_nn.py:Epoch 12/40, metrics: {'avg_train_loss': 0.05510817208806001, 'avg_test_loss': 0.10317253114448653}
INFO:model_data_nn.py:Epoch 13/40, metrics: {'avg_train_loss': 0.05523211836250892, 'avg_test_loss': 0.09871451113195646}
INFO:model_data_nn.py:Epoch 14/40, metrics: {'avg_train_loss': 0.05558165165028012, 'avg_test_loss': 0.09566571486611215}
INFO:model_data_nn.py:Epoch 15/40, metrics: {'avg_train_loss': 0.05536388222172678, 'avg_test_loss': 0.10054848106607558}
INFO:model_data_nn.py:Epoch 16/40, metrics: {'avg_train_loss': 0.05636037621216707, 'avg_test_loss': 0.10838873867714216}
INFO:model_data_nn.py:Epoch 17/40, metrics: {'avg_train_loss': 0.05616496817999152, 'avg_test_loss': 0.11722566725479232}
INFO:model_data_nn.py:Early stopping at epoch 17
INFO:main.py:Making prediction for data in year: 1990
INFO:main.py:Prediction data shape: (16126,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1990: 0.34237261963219345
INFO:main.py:Prediction Stats:                retq          pred
count  16126.000000  16126.000000
mean      -0.047284      0.038314
std        0.309796      0.113013
min       -0.945652     -0.519226
25%       -0.208333      0.015783
50%       -0.046875      0.034023
75%        0.078226      0.059517
max       15.200000      2.619411
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:transform_data_nn.py:Train_data: (128414, 161)

INFO:transform_data_nn.py:Test data years: [1990]
INFO:transform_data_nn.py:Test_data: (16126, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:transform_data_nn.py:Retrain_data: (144540, 161)

INFO:transform_data_nn.py:Prediction data years: [1991]
INFO:transform_data_nn.py:Prediction_data: (16222, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([128414, 152])
            y_train_tf: torch.Size([128414])

            x_test_tf: torch.Size([16126, 152])
            y_test_tf: torch.Size([16126])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([144540, 152])
            y_retrain_tf: torch.Size([144540])

            x_prediction_tf: torch.Size([16222, 152])
            y_prediction_tf: torch.Size([16222])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.9888e-01,  2.4175e-01,  1.5162e-01, -1.3099e+00, -1.4741e-01,
        -6.3165e-01, -1.6069e-01, -3.3851e-01,  3.5518e-01, -1.6748e-01,
        -7.0992e-01, -1.6779e-02, -4.9800e-01, -2.6410e-02,  5.4492e-02,
         5.1524e-01, -1.3399e-01,  1.9059e-01, -2.4120e-02,  4.2271e-01,
        -3.6509e-01,  6.2610e-02,  2.5325e-02,  1.1384e-02, -6.3968e-02,
        -2.5729e-01, -5.7182e-01, -8.8892e-02,  4.0815e-01,  1.0331e+00,
         4.6613e-01, -1.1249e-01,  4.4130e-01,  6.9937e-02, -3.7023e-01,
        -1.9514e-01,  6.5328e-02,  4.2076e-01,  1.4483e-02, -1.1635e+00,
        -2.8302e-01,  2.5730e-01,  2.0227e-01, -6.9445e-02, -1.7670e-01,
        -6.6391e-01,  7.2989e-02, -5.6736e-02, -4.9058e-01, -2.0618e-01,
        -6.2754e-01,  6.7258e-01, -1.5462e-01, -8.1040e-02,  2.3827e-02,
         4.4010e-01, -7.5521e-01,  1.3362e-02, -2.5698e-01, -1.0978e-02,
         1.2090e-01, -3.2007e-01,  1.4735e-01,  2.7103e-01,  1.3328e-01,
        -1.2598e-01,  6.7935e-02, -8.1626e-02,  7.4496e-01, -4.1644e-01,
         0.0000e+00,  0.0000e+00, -1.1640e-01, -8.0519e-01,  5.6881e-02,
         5.7511e-01,  3.9681e-02, -3.4605e-01, -1.8426e-01, -2.1421e-03,
        -1.4698e-02,  2.4485e-01,  5.8111e-02, -2.7826e-01, -5.5057e-01,
        -9.6684e-02, -7.8830e-02, -3.5740e-01, -1.2274e-01,  1.1675e-01,
        -5.1316e-01, -1.2843e+00,  8.6597e-03,  1.3297e+00,  1.8072e+00,
         1.7105e+00,  7.2289e-01,  1.4011e+00, -2.3735e+00, -2.5662e-01,
        -9.9383e-01,  9.8230e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.3717e-02,  3.4823e-01,  0.0000e+00, -1.2770e+00,
         3.9812e-01, -2.1813e+00,  1.3916e-01,  2.8586e-02,  0.0000e+00,
         0.0000e+00,  2.1786e-02, -1.8152e-01,  1.6267e-02, -1.8414e-02,
         8.2592e-02, -4.2343e-01, -3.7704e-01,  2.1237e-01,  2.4886e-01,
        -4.0087e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([5399]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([ 1.4584e-02,  6.3886e-02, -7.9550e-01, -1.1657e-01,  7.9758e-01,
        -7.0532e-01, -1.9870e+00, -1.0734e+00, -3.6949e-01, -1.4820e-01,
        -1.3949e-02,  1.1311e-02, -4.0241e-02, -5.3472e-02,  2.8244e-02,
         5.4960e-01, -1.9454e-01,  7.6766e-01,  4.7940e-01,  1.0482e-02,
         7.1274e-01, -2.1217e-01,  4.4143e-02, -4.2309e-01,  5.0684e-01,
        -5.9167e-03, -7.2234e-01, -8.8892e-02, -7.8899e-01,  3.2734e-02,
         1.8189e-01,  4.2959e-03,  3.3217e-01,  6.9937e-02, -2.7940e-04,
        -1.1348e+00,  1.0277e-02, -5.7281e-01,  6.2460e-01, -7.1152e-01,
        -1.3769e-01,  1.3250e-01,  1.1561e-02,  2.2164e-02, -2.5906e-03,
        -4.3427e-01,  9.3256e-01,  2.4867e-01, -4.2093e-01,  1.1561e+00,
         1.6633e+00, -1.0965e+00, -6.3259e-01, -1.2558e+00, -7.4224e-01,
         9.6668e-03, -1.0816e+00,  1.1522e+00,  9.5753e-04,  5.6143e-02,
        -3.8307e-03,  7.1953e-04,  4.4287e-03,  1.3628e-02, -3.1390e-03,
        -2.6362e-03,  3.9700e-02, -2.5201e+00,  9.2752e-02, -9.2406e-03,
         0.0000e+00,  0.0000e+00, -1.1640e-01, -5.4046e-01,  1.2246e-02,
         3.0416e-01,  9.7548e-04, -2.2895e-03,  2.6460e-03, -2.1421e-03,
         1.9614e-01,  5.8838e-01, -1.5876e-01,  2.9465e-02, -4.6237e-01,
        -8.5136e-02, -7.3785e-02,  2.9507e-02,  6.0131e-03,  2.8181e-01,
        -5.4587e-01, -1.2843e+00,  8.6597e-03, -1.1177e+00, -8.7787e-01,
        -1.2271e+00, -5.5954e-01, -2.9398e-01, -8.9560e-01, -1.1520e+00,
        -6.3334e-01,  2.2149e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.5919e-02,  4.1491e-01,  0.0000e+00, -9.6291e-01,
        -9.4916e-01,  2.5299e-01,  1.1801e-01,  2.8586e-02,  0.0000e+00,
         0.0000e+00,  1.0858e-02,  2.3569e-01,  1.6267e-02, -1.9918e-02,
        -4.3167e-02,  1.1825e-03, -2.1146e-02,  3.4402e-01,  3.6973e-01,
        -2.7416e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2216]), tensor(-0.0123))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.8127e-01,  3.5956e-01,  1.4748e-01, -1.3199e+00, -1.3889e-01,
        -6.3833e-01, -1.6951e-01, -3.4585e-01,  3.3324e-01, -1.6478e-01,
        -7.0628e-01, -3.0352e-03, -4.9006e-01, -1.0081e-01,  6.9917e-02,
         5.1296e-01, -1.2890e-01,  1.9683e-01, -5.3400e-02,  4.3029e-01,
        -3.4217e-01,  2.6293e-02,  2.9814e-02,  1.4656e-02, -5.7687e-02,
        -2.6135e-01, -5.6682e-01, -2.7892e-03,  4.1402e-01,  1.0375e+00,
         4.6537e-01, -1.0050e-01,  4.4065e-01, -1.7268e-03, -3.6984e-01,
        -1.9264e-01,  6.9834e-02,  4.4125e-01,  1.0406e-02, -1.1532e+00,
        -2.9090e-01,  3.2361e-01,  2.2406e-01, -8.0628e-02, -1.7584e-01,
        -6.6210e-01,  1.0551e-01, -3.7356e-02, -4.5092e-01, -1.6225e-01,
        -6.4144e-01,  6.7715e-01, -1.4747e-01, -5.9432e-02,  2.6581e-02,
         4.3425e-01, -7.5034e-01,  3.6750e-02, -2.5420e-01, -2.4406e-02,
         1.2572e-01, -3.1598e-01,  1.4020e-01,  2.6296e-01,  1.2433e-01,
        -1.3243e-01,  1.5329e-01, -6.8269e-02,  7.3781e-01, -4.1781e-01,
         0.0000e+00,  0.0000e+00, -7.4018e-02, -8.0028e-01,  6.9763e-02,
         5.7405e-01,  3.3836e-02, -3.4724e-01, -1.8399e-01, -2.5441e-04,
        -3.6230e-03,  2.3486e-01,  4.0894e-02, -3.0437e-01, -5.4985e-01,
        -1.0212e-01, -8.3575e-02, -3.4775e-01, -1.0388e-01,  1.3574e-01,
        -5.0724e-01, -1.2705e+00, -6.6341e-04,  1.4422e+00,  1.9335e+00,
         1.8332e+00,  7.8078e-01,  1.5128e+00, -2.3936e+00, -1.2649e-01,
        -1.0045e+00,  1.0076e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0662e-02,  3.4013e-01,  0.0000e+00, -1.1694e+00,
         5.1689e-01, -2.2414e+00,  1.4424e-01,  2.6814e-02,  0.0000e+00,
         0.0000e+00,  1.6278e-02, -1.8149e-01,  1.8735e-02, -4.0309e-02,
         4.2391e-02, -4.3083e-01, -3.6705e-01,  2.2432e-01,  2.5494e-01,
        -4.0724e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([5613]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([ 1.0049e-02,  5.1942e-02,  5.4218e-01,  1.4344e-01, -3.8141e-01,
        -3.1417e-01, -2.0959e+00, -1.0820e+00, -2.3176e-01, -3.2281e-01,
        -1.3056e-02,  9.9614e-03, -2.9154e-02, -4.8064e-02,  2.6795e-02,
        -1.3662e+00, -1.4158e-01,  5.7737e-02,  1.1894e-01,  1.4866e-02,
         6.1920e-02, -1.2541e-01,  5.5872e-01, -2.9872e-01, -3.4182e-01,
        -5.4803e-03, -6.6215e-01, -2.7892e-03, -1.0539e+00,  2.2103e-02,
        -2.0981e-01, -5.3803e-02,  2.9685e-01, -1.7268e-03,  2.0650e-04,
        -5.2036e-01,  6.9215e-03, -5.8960e-01, -1.1895e-01, -9.4741e-01,
         9.0662e-02, -7.8324e-01,  1.2031e-02,  1.2732e-02,  1.2096e-03,
         9.2210e-02, -2.8657e-01, -2.7115e-02,  7.1776e-01, -1.6502e-01,
         9.0143e-01, -1.0782e+00, -5.6287e-01, -9.5281e-01, -7.4076e-01,
         8.7588e-03, -1.0777e+00, -3.4752e-01,  6.9650e-05,  1.3055e-01,
        -4.4525e-03, -1.2021e-03,  5.7498e-03,  9.2681e-03,  2.1116e-04,
        -8.8350e-04,  3.2723e-02, -4.0264e-01,  8.1723e-02, -8.4904e-03,
         0.0000e+00,  0.0000e+00, -7.4018e-02,  4.3080e-02,  1.0297e-02,
        -3.9166e-01,  1.4043e-03, -2.8493e-03,  9.1460e-04, -2.5441e-04,
         1.6154e-01, -5.3648e-01, -1.7969e-01,  6.1375e-01, -4.9153e-01,
        -9.2394e-02, -7.8904e-02,  2.4872e-02,  4.7694e-03,  1.0059e-01,
        -6.5150e-01,  9.6492e-01, -6.6341e-04, -2.9424e-01, -7.9551e-01,
        -7.1778e-01,  5.1068e-02, -6.3808e-01, -1.2960e-01,  2.0901e-02,
        -7.3395e-01,  8.3138e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.8489e-02,  2.6498e-01,  0.0000e+00, -1.0782e+00,
        -1.5875e+00, -1.8571e+00,  1.1898e-01,  2.6814e-02,  0.0000e+00,
         0.0000e+00,  1.1161e-02, -2.3206e-01,  1.8735e-02, -1.7987e-02,
         1.1591e-02,  8.5840e-04, -1.4908e-02,  2.6827e-01,  2.6579e-01,
        -2.8380e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2209]), tensor(0.0145))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:main.py:Testing data year: 1990
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 6635
            device: cpu
            
2024-07-15 21:21:45,636	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-15 21:21:45,678	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-15 21:21:45,714	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-15 21:21:45,719	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-15 21:21:47,690	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-15 21:23:46,797	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_21-21-47' in 0.1069s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 1, 'num_embeddings': 6635, 'embedding_dim': 15, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 0.000526576127715743, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.055911935576464074
INFO:model_data_nn.py:Best trial testing loss: 0.09967361532506488
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-15_21-21-43_284950_1361901/artifacts/2024-07-15_21-21-47/train_fnn_2024-07-15_21-21-47/driver_artifacts/train_fnn_eab06_00022_22_dropout_rate=0.5200,embedding_dim=15,hidden_dim=5,lr=0.0100,num_layers=1,weight_decay=0.0005_2024-07-15_21-21-47
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 1, 'num_embeddings': 6904, 'embedding_dim': 15, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 0.000526576127715743, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 13.685482438106453, 'avg_test_loss': 0.5719756283797324}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.37015357829828177, 'avg_test_loss': 0.22702203679364175}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.15736376796148518, 'avg_test_loss': 0.1818884534877725}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.10407639008707704, 'avg_test_loss': 0.17045989056350663}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.08237288879082266, 'avg_test_loss': 0.1692577464855276}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.07287143290834089, 'avg_test_loss': 0.16991659306222573}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.06832108845752953, 'avg_test_loss': 0.17191468720557168}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.06592672146131508, 'avg_test_loss': 0.17400084203109145}
INFO:model_data_nn.py:Early stopping at epoch 8
INFO:main.py:Making prediction for data in year: 1991
INFO:main.py:Prediction data shape: (16222,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1991: 0.4178232822640685
INFO:main.py:Prediction Stats:                retq          pred
count  16222.000000  16222.000000
mean       0.115448      0.034076
std        0.411550      0.018961
min       -0.988636     -0.153898
25%       -0.078436      0.022300
50%        0.046431      0.029460
75%        0.225745      0.040277
max       10.600000      0.232810
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:transform_data_nn.py:Train_data: (144540, 161)

INFO:transform_data_nn.py:Test data years: [1991]
INFO:transform_data_nn.py:Test_data: (16222, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:transform_data_nn.py:Retrain_data: (160762, 161)

INFO:transform_data_nn.py:Prediction data years: [1992]
INFO:transform_data_nn.py:Prediction_data: (16382, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([144540, 152])
            y_train_tf: torch.Size([144540])

            x_test_tf: torch.Size([16222, 152])
            y_test_tf: torch.Size([16222])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([160762, 152])
            y_retrain_tf: torch.Size([160762])

            x_prediction_tf: torch.Size([16382, 152])
            y_prediction_tf: torch.Size([16382])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.8127e-01,  3.5956e-01,  1.4748e-01, -1.3199e+00, -1.3889e-01,
        -6.3833e-01, -1.6951e-01, -3.4585e-01,  3.3324e-01, -1.6478e-01,
        -7.0628e-01, -3.0352e-03, -4.9006e-01, -1.0081e-01,  6.9917e-02,
         5.1296e-01, -1.2890e-01,  1.9683e-01, -5.3400e-02,  4.3029e-01,
        -3.4217e-01,  2.6293e-02,  2.9814e-02,  1.4656e-02, -5.7687e-02,
        -2.6135e-01, -5.6682e-01, -2.7892e-03,  4.1402e-01,  1.0375e+00,
         4.6537e-01, -1.0050e-01,  4.4065e-01, -1.7268e-03, -3.6984e-01,
        -1.9264e-01,  6.9834e-02,  4.4125e-01,  1.0406e-02, -1.1532e+00,
        -2.9090e-01,  3.2361e-01,  2.2406e-01, -8.0628e-02, -1.7584e-01,
        -6.6210e-01,  1.0551e-01, -3.7356e-02, -4.5092e-01, -1.6225e-01,
        -6.4144e-01,  6.7715e-01, -1.4747e-01, -5.9432e-02,  2.6581e-02,
         4.3425e-01, -7.5034e-01,  3.6750e-02, -2.5420e-01, -2.4406e-02,
         1.2572e-01, -3.1598e-01,  1.4020e-01,  2.6296e-01,  1.2433e-01,
        -1.3243e-01,  1.5329e-01, -6.8269e-02,  7.3781e-01, -4.1781e-01,
         0.0000e+00,  0.0000e+00, -7.4018e-02, -8.0028e-01,  6.9763e-02,
         5.7405e-01,  3.3836e-02, -3.4724e-01, -1.8399e-01, -2.5441e-04,
        -3.6230e-03,  2.3486e-01,  4.0894e-02, -3.0437e-01, -5.4985e-01,
        -1.0212e-01, -8.3575e-02, -3.4775e-01, -1.0388e-01,  1.3574e-01,
        -5.0724e-01, -1.2705e+00, -6.6341e-04,  1.4422e+00,  1.9335e+00,
         1.8332e+00,  7.8078e-01,  1.5128e+00, -2.3936e+00, -1.2649e-01,
        -1.0045e+00,  1.0076e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0662e-02,  3.4013e-01,  0.0000e+00, -1.1694e+00,
         5.1689e-01, -2.2414e+00,  1.4424e-01,  2.6814e-02,  0.0000e+00,
         0.0000e+00,  1.6278e-02, -1.8149e-01,  1.8735e-02, -4.0309e-02,
         4.2391e-02, -4.3083e-01, -3.6705e-01,  2.2432e-01,  2.5494e-01,
        -4.0724e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([5613]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([ 1.0049e-02,  5.1942e-02,  5.4218e-01,  1.4344e-01, -3.8141e-01,
        -3.1417e-01, -2.0959e+00, -1.0820e+00, -2.3176e-01, -3.2281e-01,
        -1.3056e-02,  9.9614e-03, -2.9154e-02, -4.8064e-02,  2.6795e-02,
        -1.3662e+00, -1.4158e-01,  5.7737e-02,  1.1894e-01,  1.4866e-02,
         6.1920e-02, -1.2541e-01,  5.5872e-01, -2.9872e-01, -3.4182e-01,
        -5.4803e-03, -6.6215e-01, -2.7892e-03, -1.0539e+00,  2.2103e-02,
        -2.0981e-01, -5.3803e-02,  2.9685e-01, -1.7268e-03,  2.0650e-04,
        -5.2036e-01,  6.9215e-03, -5.8960e-01, -1.1895e-01, -9.4741e-01,
         9.0662e-02, -7.8324e-01,  1.2031e-02,  1.2732e-02,  1.2096e-03,
         9.2210e-02, -2.8657e-01, -2.7115e-02,  7.1776e-01, -1.6502e-01,
         9.0143e-01, -1.0782e+00, -5.6287e-01, -9.5281e-01, -7.4076e-01,
         8.7588e-03, -1.0777e+00, -3.4752e-01,  6.9650e-05,  1.3055e-01,
        -4.4525e-03, -1.2021e-03,  5.7498e-03,  9.2681e-03,  2.1116e-04,
        -8.8350e-04,  3.2723e-02, -4.0264e-01,  8.1723e-02, -8.4904e-03,
         0.0000e+00,  0.0000e+00, -7.4018e-02,  4.3080e-02,  1.0297e-02,
        -3.9166e-01,  1.4043e-03, -2.8493e-03,  9.1460e-04, -2.5441e-04,
         1.6154e-01, -5.3648e-01, -1.7969e-01,  6.1375e-01, -4.9153e-01,
        -9.2394e-02, -7.8904e-02,  2.4872e-02,  4.7694e-03,  1.0059e-01,
        -6.5150e-01,  9.6492e-01, -6.6341e-04, -2.9424e-01, -7.9551e-01,
        -7.1778e-01,  5.1068e-02, -6.3808e-01, -1.2960e-01,  2.0901e-02,
        -7.3395e-01,  8.3138e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.8489e-02,  2.6498e-01,  0.0000e+00, -1.0782e+00,
        -1.5875e+00, -1.8571e+00,  1.1898e-01,  2.6814e-02,  0.0000e+00,
         0.0000e+00,  1.1161e-02, -2.3206e-01,  1.8735e-02, -1.7987e-02,
         1.1591e-02,  8.5840e-04, -1.4908e-02,  2.6827e-01,  2.6579e-01,
        -2.8380e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2209]), tensor(0.0145))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.7734e-01,  4.5340e-01,  1.3377e-01, -1.3261e+00, -1.2311e-01,
        -6.5098e-01, -1.7753e-01, -3.5516e-01,  3.0045e-01, -1.6351e-01,
        -7.0341e-01,  6.8448e-03, -4.7901e-01, -1.6231e-01,  8.0110e-02,
         5.0950e-01, -1.2548e-01,  1.9564e-01, -7.2714e-02,  4.4782e-01,
        -3.5735e-01, -6.6628e-03,  9.3140e-03,  2.0648e-02, -5.6081e-02,
        -2.6397e-01, -5.6231e-01, -2.1161e-02,  4.1490e-01,  1.0341e+00,
         4.3785e-01, -9.1039e-02,  4.4138e-01, -1.3588e-02, -3.7245e-01,
        -1.8960e-01,  7.6126e-02,  4.6096e-01,  1.4997e-02, -1.1373e+00,
        -2.9925e-01,  3.4205e-01,  2.5111e-01, -9.3056e-02, -1.6665e-01,
        -6.6268e-01,  1.1682e-01, -4.0390e-02, -4.3304e-01, -1.7197e-01,
        -6.6367e-01,  6.7888e-01, -1.3982e-01, -4.4105e-02,  3.2892e-02,
         4.3293e-01, -7.4493e-01,  5.0402e-02, -2.5059e-01, -3.0483e-02,
         1.2759e-01, -3.1220e-01,  1.3602e-01,  2.5551e-01,  1.2531e-01,
        -1.3906e-01,  2.2288e-01, -7.8586e-02,  7.3184e-01, -4.1788e-01,
        -1.0879e-01, -4.0737e-02, -6.1110e-02, -7.9729e-01,  8.3312e-02,
         5.8354e-01,  2.7448e-02, -3.4959e-01, -1.8488e-01, -3.8435e-03,
        -1.4837e-02,  2.4283e-01,  1.9573e-02, -3.2015e-01, -5.4688e-01,
        -1.0675e-01, -8.8442e-02, -3.3864e-01, -8.7835e-02,  1.5286e-01,
        -5.0111e-01, -1.2624e+00, -3.4320e-06,  1.5509e+00,  1.9771e+00,
         1.9546e+00,  7.1260e-01,  1.6179e+00, -2.5331e+00, -5.9443e-02,
        -9.7327e-01,  1.1628e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.5478e-02,  3.8159e-01,  0.0000e+00, -1.1082e+00,
         6.1212e-01, -2.1870e+00,  1.4742e-01,  3.0443e-02,  0.0000e+00,
         0.0000e+00,  1.3705e-02, -1.7713e-01,  1.9624e-02, -6.0341e-02,
         4.7219e-02, -4.3803e-01, -3.5763e-01,  2.3778e-01,  2.6301e-01,
        -4.1376e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([5884]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([ 4.5884e-03,  4.9765e-02, -6.3958e-01,  3.6238e-01, -2.6211e-01,
        -4.5410e-01, -2.1801e+00, -1.0535e+00, -5.0918e-01, -3.2670e-01,
        -1.2268e-02,  5.0461e-03, -3.9376e-02, -4.0670e-02,  2.3914e-02,
         2.5567e-01, -1.9601e-01,  5.6621e-02,  2.0582e-01,  1.9670e-02,
         5.4303e-01, -8.8635e-02,  2.0365e-02, -2.9322e-01, -1.5510e-01,
        -5.2580e-03, -6.9155e-01, -9.9206e-01, -6.1416e-01,  2.8934e-02,
        -2.4629e-02, -8.9173e-02,  2.2688e-01, -1.3588e-02, -8.6521e-04,
        -5.1289e-01,  1.0675e-02, -6.0930e-01, -1.5761e-01, -1.0796e+00,
         2.5863e-02,  2.4820e-01,  1.7210e-02,  2.4536e-02,  6.8984e-03,
        -2.3126e-01,  9.4793e-01, -9.2326e-02,  3.9157e-01,  1.1064e+00,
         1.6536e+00, -8.2409e-01, -6.2094e-01, -8.1102e-01, -7.3726e-01,
         7.6105e-03, -1.0737e+00,  1.1574e+00, -7.0059e-04, -7.3457e-01,
        -4.5052e-03, -1.5322e-03,  3.9907e-03,  6.2976e-03,  8.2498e-04,
        -2.7221e-03,  2.9387e-02, -5.5122e+00,  7.3184e-01, -7.9588e-03,
        -1.0879e-01, -4.0737e-02, -6.1110e-02, -9.3162e-02,  9.2216e-03,
        -2.9512e-02,  1.1943e-03, -4.6854e-03,  2.6733e-04, -3.8435e-03,
         1.3799e-01, -2.4547e-01, -3.6935e-01,  7.1472e-01, -3.3434e-01,
        -4.0610e-03, -2.5000e-03,  2.9221e-02,  5.3267e-03,  1.0881e-01,
        -4.2178e-01, -3.7129e-01, -3.4320e-06, -1.3317e+00, -2.4169e+00,
        -9.3624e-01,  1.9813e+00, -1.6256e+00,  8.2424e-01, -9.8591e-01,
         3.8318e-01,  1.1111e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  4.1856e-02,  7.7902e-01,  0.0000e+00, -2.4267e-01,
        -1.7175e-01, -1.5689e+00,  1.2207e-01,  3.0443e-02,  0.0000e+00,
         0.0000e+00,  1.2271e-02, -2.0077e-01,  1.9624e-02, -1.5370e-02,
         4.4105e-03, -2.2916e-04, -2.4002e-02,  2.8235e-01,  2.6622e-01,
        -4.0010e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2258]), tensor(-0.1793))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:main.py:Testing data year: 1991
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 6904
            device: cpu
            
2024-07-15 21:43:00,864	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-15 21:43:00,912	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-15 21:43:00,948	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-15 21:43:00,952	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-15 21:43:03,127	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-15 21:46:43,963	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_21-43-03' in 0.1753s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 125, 'num_layers': 1, 'num_embeddings': 6904, 'embedding_dim': 25, 'dropout_rate': 0.15, 'lr': 0.01, 'weight_decay': 1.4096175149815853e-05, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.05669334146433172
INFO:model_data_nn.py:Best trial testing loss: 0.16405018710065633
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-15_21-42-58_566519_1361901/artifacts/2024-07-15_21-43-03/train_fnn_2024-07-15_21-43-03/driver_artifacts/train_fnn_e2e8b_00012_12_dropout_rate=0.1500,embedding_dim=25,hidden_dim=125,lr=0.0100,num_layers=1,weight_decay=0.0000_2024-07-15_21-43-03
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 125, 'num_layers': 1, 'num_embeddings': 7233, 'embedding_dim': 25, 'dropout_rate': 0.15, 'lr': 0.01, 'weight_decay': 1.4096175149815853e-05, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 2.8551707009778946, 'avg_test_loss': 0.11984176182886586}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.0768472397118617, 'avg_test_loss': 0.12180383311351761}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.07791569484931649, 'avg_test_loss': 0.12399268115404993}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.08073521260717872, 'avg_test_loss': 0.1376309769693762}
INFO:model_data_nn.py:Early stopping at epoch 4
INFO:main.py:Making prediction for data in year: 1992
INFO:main.py:Prediction data shape: (16382,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1992: 0.37098973588779083
INFO:main.py:Prediction Stats:                retq          pred
count  16382.000000  16382.000000
mean       0.062721      0.156551
std        0.346966      0.131078
min       -0.958333     -0.310357
25%       -0.103448      0.073833
50%        0.013034      0.126243
75%        0.162791      0.201646
max        7.000003      1.371005
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:transform_data_nn.py:Train_data: (160762, 161)

INFO:transform_data_nn.py:Test data years: [1992]
INFO:transform_data_nn.py:Test_data: (16382, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Retrain_data: (177144, 161)

INFO:transform_data_nn.py:Prediction data years: [1993]
INFO:transform_data_nn.py:Prediction_data: (17602, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([160762, 152])
            y_train_tf: torch.Size([160762])

            x_test_tf: torch.Size([16382, 152])
            y_test_tf: torch.Size([16382])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([177144, 152])
            y_retrain_tf: torch.Size([177144])

            x_prediction_tf: torch.Size([17602, 152])
            y_prediction_tf: torch.Size([17602])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.7734e-01,  4.5340e-01,  1.3377e-01, -1.3261e+00, -1.2311e-01,
        -6.5098e-01, -1.7753e-01, -3.5516e-01,  3.0045e-01, -1.6351e-01,
        -7.0341e-01,  6.8448e-03, -4.7901e-01, -1.6231e-01,  8.0110e-02,
         5.0950e-01, -1.2548e-01,  1.9564e-01, -7.2714e-02,  4.4782e-01,
        -3.5735e-01, -6.6628e-03,  9.3140e-03,  2.0648e-02, -5.6081e-02,
        -2.6397e-01, -5.6231e-01, -2.1161e-02,  4.1490e-01,  1.0341e+00,
         4.3785e-01, -9.1039e-02,  4.4138e-01, -1.3588e-02, -3.7245e-01,
        -1.8960e-01,  7.6126e-02,  4.6096e-01,  1.4997e-02, -1.1373e+00,
        -2.9925e-01,  3.4205e-01,  2.5111e-01, -9.3056e-02, -1.6665e-01,
        -6.6268e-01,  1.1682e-01, -4.0390e-02, -4.3304e-01, -1.7197e-01,
        -6.6367e-01,  6.7888e-01, -1.3982e-01, -4.4105e-02,  3.2892e-02,
         4.3293e-01, -7.4493e-01,  5.0402e-02, -2.5059e-01, -3.0483e-02,
         1.2759e-01, -3.1220e-01,  1.3602e-01,  2.5551e-01,  1.2531e-01,
        -1.3906e-01,  2.2288e-01, -7.8586e-02,  7.3184e-01, -4.1788e-01,
        -1.0879e-01, -4.0737e-02, -6.1110e-02, -7.9729e-01,  8.3312e-02,
         5.8354e-01,  2.7448e-02, -3.4959e-01, -1.8488e-01, -3.8435e-03,
        -1.4837e-02,  2.4283e-01,  1.9573e-02, -3.2015e-01, -5.4688e-01,
        -1.0675e-01, -8.8442e-02, -3.3864e-01, -8.7835e-02,  1.5286e-01,
        -5.0111e-01, -1.2624e+00, -3.4320e-06,  1.5509e+00,  1.9771e+00,
         1.9546e+00,  7.1260e-01,  1.6179e+00, -2.5331e+00, -5.9443e-02,
        -9.7327e-01,  1.1628e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.5478e-02,  3.8159e-01,  0.0000e+00, -1.1082e+00,
         6.1212e-01, -2.1870e+00,  1.4742e-01,  3.0443e-02,  0.0000e+00,
         0.0000e+00,  1.3705e-02, -1.7713e-01,  1.9624e-02, -6.0341e-02,
         4.7219e-02, -4.3803e-01, -3.5763e-01,  2.3778e-01,  2.6301e-01,
        -4.1376e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([5884]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([ 4.5884e-03,  4.9765e-02, -6.3958e-01,  3.6238e-01, -2.6211e-01,
        -4.5410e-01, -2.1801e+00, -1.0535e+00, -5.0918e-01, -3.2670e-01,
        -1.2268e-02,  5.0461e-03, -3.9376e-02, -4.0670e-02,  2.3914e-02,
         2.5567e-01, -1.9601e-01,  5.6621e-02,  2.0582e-01,  1.9670e-02,
         5.4303e-01, -8.8635e-02,  2.0365e-02, -2.9322e-01, -1.5510e-01,
        -5.2580e-03, -6.9155e-01, -9.9206e-01, -6.1416e-01,  2.8934e-02,
        -2.4629e-02, -8.9173e-02,  2.2688e-01, -1.3588e-02, -8.6521e-04,
        -5.1289e-01,  1.0675e-02, -6.0930e-01, -1.5761e-01, -1.0796e+00,
         2.5863e-02,  2.4820e-01,  1.7210e-02,  2.4536e-02,  6.8984e-03,
        -2.3126e-01,  9.4793e-01, -9.2326e-02,  3.9157e-01,  1.1064e+00,
         1.6536e+00, -8.2409e-01, -6.2094e-01, -8.1102e-01, -7.3726e-01,
         7.6105e-03, -1.0737e+00,  1.1574e+00, -7.0059e-04, -7.3457e-01,
        -4.5052e-03, -1.5322e-03,  3.9907e-03,  6.2976e-03,  8.2498e-04,
        -2.7221e-03,  2.9387e-02, -5.5122e+00,  7.3184e-01, -7.9588e-03,
        -1.0879e-01, -4.0737e-02, -6.1110e-02, -9.3162e-02,  9.2216e-03,
        -2.9512e-02,  1.1943e-03, -4.6854e-03,  2.6733e-04, -3.8435e-03,
         1.3799e-01, -2.4547e-01, -3.6935e-01,  7.1472e-01, -3.3434e-01,
        -4.0610e-03, -2.5000e-03,  2.9221e-02,  5.3267e-03,  1.0881e-01,
        -4.2178e-01, -3.7129e-01, -3.4320e-06, -1.3317e+00, -2.4169e+00,
        -9.3624e-01,  1.9813e+00, -1.6256e+00,  8.2424e-01, -9.8591e-01,
         3.8318e-01,  1.1111e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  4.1856e-02,  7.7902e-01,  0.0000e+00, -2.4267e-01,
        -1.7175e-01, -1.5689e+00,  1.2207e-01,  3.0443e-02,  0.0000e+00,
         0.0000e+00,  1.2271e-02, -2.0077e-01,  1.9624e-02, -1.5370e-02,
         4.4105e-03, -2.2916e-04, -2.4002e-02,  2.8235e-01,  2.6622e-01,
        -4.0010e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2258]), tensor(-0.1793))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.7511e-01,  5.3032e-01,  1.2118e-01, -1.3279e+00, -1.1473e-01,
        -6.6547e-01, -1.7965e-01, -3.5902e-01,  3.0039e-01, -1.6157e-01,
        -7.0364e-01,  1.3287e-02, -4.8032e-01, -2.1689e-01,  9.2752e-02,
         5.1136e-01, -1.2770e-01,  2.0288e-01, -8.6807e-02,  4.6755e-01,
        -3.3014e-01, -3.0899e-03,  1.2939e-02,  1.7989e-02, -5.1916e-02,
        -2.6816e-01, -5.6058e-01, -1.8181e-02,  4.0599e-01,  1.0573e+00,
         4.2291e-01, -9.3946e-02,  4.4649e-01, -2.1402e-02, -3.7431e-01,
        -1.8455e-01,  9.1704e-02,  4.7506e-01,  2.3524e-02, -1.1254e+00,
        -3.0536e-01,  2.8104e-01,  2.7996e-01, -9.3432e-02, -1.5500e-01,
        -6.7113e-01,  8.9885e-02, -3.4669e-02, -4.0734e-01, -1.7358e-01,
        -6.8742e-01,  6.7090e-01, -1.3187e-01, -3.4868e-02,  2.6621e-02,
         4.3297e-01, -7.3884e-01,  5.0399e-02, -2.5586e-01, -3.3450e-02,
         1.2930e-01, -3.1684e-01,  1.3231e-01,  2.5136e-01,  1.2800e-01,
        -1.4296e-01,  2.7904e-01, -8.9100e-02,  7.2144e-01, -4.1733e-01,
        -1.5802e-01, -6.1594e-02, -4.7980e-02, -8.0352e-01,  9.5446e-02,
         6.0000e-01,  2.5124e-02, -3.5209e-01, -1.8562e-01,  6.4939e-04,
        -1.6890e-02,  2.5546e-01,  1.9693e-02, -3.2662e-01, -5.4653e-01,
        -1.1026e-01, -9.2396e-02, -3.3079e-01, -7.5383e-02,  1.6134e-01,
        -5.0113e-01, -1.2592e+00,  2.9665e-03,  1.6367e+00,  1.9011e+00,
         2.0545e+00,  4.0982e-01,  1.6419e+00, -2.5976e+00,  5.4995e-02,
        -9.5135e-01,  1.2901e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0600e-02,  5.5131e-01,  0.0000e+00, -1.1747e+00,
         6.5082e-01, -2.0948e+00,  1.5020e-01,  1.9927e-02,  0.0000e+00,
         0.0000e+00,  1.6984e-02, -1.7085e-01,  2.0595e-02, -7.1156e-02,
         5.0707e-02, -4.4174e-01, -3.5503e-01,  2.4983e-01,  2.6954e-01,
        -4.1798e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([6170]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([ 6.2201e-03,  4.0160e-02, -4.9216e-01,  5.4931e-01,  2.8609e-01,
        -6.0069e-01, -2.2084e+00, -1.0302e+00, -4.7065e-01, -2.4710e-01,
        -1.4308e-02,  4.9625e-03, -3.6213e-02, -3.3412e-02,  2.1304e-02,
        -1.0237e+00, -1.7729e-01,  6.1705e-01,  1.6484e-01,  1.1458e-02,
         7.6160e-01, -7.4634e-02, -2.4968e-02, -3.4868e-01,  1.4408e-01,
        -8.4063e-03, -6.4430e-01, -7.3839e-01, -1.2763e+00,  3.1663e-02,
        -2.8039e-02, -2.1211e-01,  1.8460e-01, -2.1402e-02,  1.1698e-03,
         1.3698e+00,  1.4487e-02, -6.2328e-01,  4.0902e-01, -1.0097e+00,
        -3.1756e-02, -2.4244e-01,  1.2191e-02,  2.9435e-02,  4.8104e-03,
        -5.0599e-01, -2.1340e-01, -1.4904e-01,  3.2076e-01,  5.2773e-01,
         1.6373e+00, -8.3324e-01, -5.9558e-01, -7.2872e-01, -7.3904e-01,
         5.1056e-03, -1.0694e+00, -4.4086e-02, -7.2391e-03,  2.6464e-01,
        -4.8327e-03, -7.3293e-03,  6.8518e-03,  1.0950e-02,  9.3378e-04,
         3.1050e-03,  2.2322e-02,  1.1238e+00,  5.7967e-02, -1.1165e-02,
        -1.5802e-01, -6.1594e-02, -4.7980e-02, -4.3363e-01,  8.7659e-03,
         2.5548e-02,  6.8801e-04, -4.4530e-03,  6.7547e-04,  6.4939e-04,
         1.2073e-01, -4.7145e-01, -3.6522e-01, -1.7265e-01, -5.0460e-01,
        -4.0603e-03, -3.1113e-03,  2.9184e-02,  4.2500e-03,  1.2579e-01,
        -6.3919e-01,  9.8457e-01,  2.9665e-03, -1.3392e+00, -1.5266e+00,
        -9.6352e-01,  1.8288e+00, -1.6627e+00,  1.2169e+00, -1.1459e+00,
        -9.4967e-01,  2.1429e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.3449e-02,  3.4491e-01,  0.0000e+00,  5.3013e-01,
        -2.8294e-02,  4.7908e-01,  1.0045e-01,  1.9927e-02,  0.0000e+00,
         0.0000e+00,  1.3357e-02,  2.3455e-02,  2.0595e-02, -9.1336e-03,
         8.4218e-03,  1.6526e-03, -2.1462e-02,  1.1496e-01,  1.7460e-01,
        -3.3093e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2434]), tensor(0.0291))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:main.py:Testing data year: 1992
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 7233
            device: cpu
            
2024-07-15 22:08:18,684	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-15 22:08:18,725	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-15 22:08:18,762	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-15 22:08:18,767	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-15 22:08:20,787	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-15 22:10:44,112	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_22-08-20' in 0.1653s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 7233, 'embedding_dim': 5, 'dropout_rate': 0.19, 'lr': 0.05, 'weight_decay': 1.9489008462344248e-05, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07052296382274217
INFO:model_data_nn.py:Best trial testing loss: 0.1177662355476059
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-15_22-08-16_498034_1361901/artifacts/2024-07-15_22-08-20/train_fnn_2024-07-15_22-08-20/driver_artifacts/train_fnn_6b813_00027_27_dropout_rate=0.1900,embedding_dim=5,hidden_dim=45,lr=0.0500,num_layers=1,weight_decay=0.0000_2024-07-15_22-08-20
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 7594, 'embedding_dim': 5, 'dropout_rate': 0.19, 'lr': 0.05, 'weight_decay': 1.9489008462344248e-05, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 1.75418967058656, 'avg_test_loss': 0.0933631329756716}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.0829556439384129, 'avg_test_loss': 0.09475235344059225}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.08100986496862993, 'avg_test_loss': 0.09374621515904648}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.08203348359146903, 'avg_test_loss': 0.09212290587416594}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.08060993035620002, 'avg_test_loss': 0.09307887864069662}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.0786671722684637, 'avg_test_loss': 0.09322134545747784}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.0763624486368085, 'avg_test_loss': 0.09211840394182481}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.07445551554074867, 'avg_test_loss': 0.09389386007535284}
INFO:model_data_nn.py:Epoch 9/40, metrics: {'avg_train_loss': 0.07416017546259254, 'avg_test_loss': 0.09202026446228442}
INFO:model_data_nn.py:Epoch 10/40, metrics: {'avg_train_loss': 0.07444710830883311, 'avg_test_loss': 0.09297537603887959}
INFO:model_data_nn.py:Epoch 11/40, metrics: {'avg_train_loss': 0.07451237269241169, 'avg_test_loss': 0.09396779828745386}
INFO:model_data_nn.py:Epoch 12/40, metrics: {'avg_train_loss': 0.07572055419616272, 'avg_test_loss': 0.10998639755922815}
INFO:model_data_nn.py:Early stopping at epoch 12
INFO:main.py:Making prediction for data in year: 1993
INFO:main.py:Prediction data shape: (17602,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1993: 0.33183750465065154
INFO:main.py:Prediction Stats:                retq          pred
count  17602.000000  17602.000000
mean       0.049683     -0.029502
std        0.303347      0.107778
min       -0.941177     -0.916906
25%       -0.092593     -0.063742
50%        0.012762      0.006842
75%        0.142857      0.030296
max       12.250001      0.476895
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Train_data: (177144, 161)

INFO:transform_data_nn.py:Test data years: [1993]
INFO:transform_data_nn.py:Test_data: (17602, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:transform_data_nn.py:Retrain_data: (194746, 161)

INFO:transform_data_nn.py:Prediction data years: [1994]
INFO:transform_data_nn.py:Prediction_data: (19550, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([177144, 152])
            y_train_tf: torch.Size([177144])

            x_test_tf: torch.Size([17602, 152])
            y_test_tf: torch.Size([17602])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([194746, 152])
            y_retrain_tf: torch.Size([194746])

            x_prediction_tf: torch.Size([19550, 152])
            y_prediction_tf: torch.Size([19550])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.7511e-01,  5.3032e-01,  1.2118e-01, -1.3279e+00, -1.1473e-01,
        -6.6547e-01, -1.7965e-01, -3.5902e-01,  3.0039e-01, -1.6157e-01,
        -7.0364e-01,  1.3287e-02, -4.8032e-01, -2.1689e-01,  9.2752e-02,
         5.1136e-01, -1.2770e-01,  2.0288e-01, -8.6807e-02,  4.6755e-01,
        -3.3014e-01, -3.0899e-03,  1.2939e-02,  1.7989e-02, -5.1916e-02,
        -2.6816e-01, -5.6058e-01, -1.8181e-02,  4.0599e-01,  1.0573e+00,
         4.2291e-01, -9.3946e-02,  4.4649e-01, -2.1402e-02, -3.7431e-01,
        -1.8455e-01,  9.1704e-02,  4.7506e-01,  2.3524e-02, -1.1254e+00,
        -3.0536e-01,  2.8104e-01,  2.7996e-01, -9.3432e-02, -1.5500e-01,
        -6.7113e-01,  8.9885e-02, -3.4669e-02, -4.0734e-01, -1.7358e-01,
        -6.8742e-01,  6.7090e-01, -1.3187e-01, -3.4868e-02,  2.6621e-02,
         4.3297e-01, -7.3884e-01,  5.0399e-02, -2.5586e-01, -3.3450e-02,
         1.2930e-01, -3.1684e-01,  1.3231e-01,  2.5136e-01,  1.2800e-01,
        -1.4296e-01,  2.7904e-01, -8.9100e-02,  7.2144e-01, -4.1733e-01,
        -1.5802e-01, -6.1594e-02, -4.7980e-02, -8.0352e-01,  9.5446e-02,
         6.0000e-01,  2.5124e-02, -3.5209e-01, -1.8562e-01,  6.4939e-04,
        -1.6890e-02,  2.5546e-01,  1.9693e-02, -3.2662e-01, -5.4653e-01,
        -1.1026e-01, -9.2396e-02, -3.3079e-01, -7.5383e-02,  1.6134e-01,
        -5.0113e-01, -1.2592e+00,  2.9665e-03,  1.6367e+00,  1.9011e+00,
         2.0545e+00,  4.0982e-01,  1.6419e+00, -2.5976e+00,  5.4995e-02,
        -9.5135e-01,  1.2901e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0600e-02,  5.5131e-01,  0.0000e+00, -1.1747e+00,
         6.5082e-01, -2.0948e+00,  1.5020e-01,  1.9927e-02,  0.0000e+00,
         0.0000e+00,  1.6984e-02, -1.7085e-01,  2.0595e-02, -7.1156e-02,
         5.0707e-02, -4.4174e-01, -3.5503e-01,  2.4983e-01,  2.6954e-01,
        -4.1798e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([6170]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([ 6.2201e-03,  4.0160e-02, -4.9216e-01,  5.4931e-01,  2.8609e-01,
        -6.0069e-01, -2.2084e+00, -1.0302e+00, -4.7065e-01, -2.4710e-01,
        -1.4308e-02,  4.9625e-03, -3.6213e-02, -3.3412e-02,  2.1304e-02,
        -1.0237e+00, -1.7729e-01,  6.1705e-01,  1.6484e-01,  1.1458e-02,
         7.6160e-01, -7.4634e-02, -2.4968e-02, -3.4868e-01,  1.4408e-01,
        -8.4063e-03, -6.4430e-01, -7.3839e-01, -1.2763e+00,  3.1663e-02,
        -2.8039e-02, -2.1211e-01,  1.8460e-01, -2.1402e-02,  1.1698e-03,
         1.3698e+00,  1.4487e-02, -6.2328e-01,  4.0902e-01, -1.0097e+00,
        -3.1756e-02, -2.4244e-01,  1.2191e-02,  2.9435e-02,  4.8104e-03,
        -5.0599e-01, -2.1340e-01, -1.4904e-01,  3.2076e-01,  5.2773e-01,
         1.6373e+00, -8.3324e-01, -5.9558e-01, -7.2872e-01, -7.3904e-01,
         5.1056e-03, -1.0694e+00, -4.4086e-02, -7.2391e-03,  2.6464e-01,
        -4.8327e-03, -7.3293e-03,  6.8518e-03,  1.0950e-02,  9.3378e-04,
         3.1050e-03,  2.2322e-02,  1.1238e+00,  5.7967e-02, -1.1165e-02,
        -1.5802e-01, -6.1594e-02, -4.7980e-02, -4.3363e-01,  8.7659e-03,
         2.5548e-02,  6.8801e-04, -4.4530e-03,  6.7547e-04,  6.4939e-04,
         1.2073e-01, -4.7145e-01, -3.6522e-01, -1.7265e-01, -5.0460e-01,
        -4.0603e-03, -3.1113e-03,  2.9184e-02,  4.2500e-03,  1.2579e-01,
        -6.3919e-01,  9.8457e-01,  2.9665e-03, -1.3392e+00, -1.5266e+00,
        -9.6352e-01,  1.8288e+00, -1.6627e+00,  1.2169e+00, -1.1459e+00,
        -9.4967e-01,  2.1429e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.3449e-02,  3.4491e-01,  0.0000e+00,  5.3013e-01,
        -2.8294e-02,  4.7908e-01,  1.0045e-01,  1.9927e-02,  0.0000e+00,
         0.0000e+00,  1.3357e-02,  2.3455e-02,  2.0595e-02, -9.1336e-03,
         8.4218e-03,  1.6526e-03, -2.1462e-02,  1.1496e-01,  1.7460e-01,
        -3.3093e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2434]), tensor(0.0291))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-0.1669,  0.5888,  0.1036, -1.3219, -0.1143, -0.6813, -0.1850, -0.3644,
         0.3208, -0.1635, -0.7034,  0.0227, -0.4865, -0.2572,  0.1009,  0.5067,
        -0.1305,  0.2120, -0.0732,  0.4743, -0.3380,  0.0057,  0.0149,  0.0136,
        -0.0537, -0.2743, -0.5612, -0.0210,  0.3845,  1.0975,  0.4100, -0.0973,
         0.4536, -0.0351, -0.3724, -0.1814,  0.0980,  0.4924,  0.0227, -1.1218,
        -0.3089,  0.2602,  0.2824, -0.0835, -0.1526, -0.6815,  0.0777, -0.0463,
        -0.4050, -0.1860, -0.7059,  0.6565, -0.1252, -0.0294,  0.0189,  0.4337,
        -0.7312,  0.0518, -0.2591, -0.0319,  0.1302, -0.3191,  0.1327,  0.2513,
         0.1271, -0.1443,  0.3185, -0.0992,  0.7069, -0.4184, -0.1927, -0.0776,
        -0.0450, -0.8111,  0.1075,  0.6137,  0.0222, -0.3556, -0.1870,  0.0038,
        -0.0102,  0.2538,  0.0352, -0.3280, -0.5492, -0.1148, -0.0973, -0.3225,
        -0.0634,  0.1735, -0.5036, -1.2598,  0.0066,  1.6984,  1.9427,  2.1325,
         0.2193,  1.6729, -2.6897,  0.1787, -0.8928,  0.1270,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0538,  0.5436,  0.0000, -1.2410,  0.6873, -2.1641,
         0.1521,  0.0133,  0.0000,  0.0000,  0.0265, -0.1685,  0.0193, -0.0752,
         0.0659, -0.4429, -0.3589,  0.2582,  0.2740, -0.4163,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([6665]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-1.0950e+00, -1.5362e-01, -7.1802e-01,  7.1595e-01, -7.3885e-02,
        -4.5583e-01, -2.1670e+00, -9.9111e-01, -5.6359e-01, -3.7633e-01,
        -5.5989e-01,  7.3728e-03,  1.0031e-01,  2.8742e-01, -2.1712e-01,
        -3.9971e-02, -2.1449e-01,  2.2596e-01, -7.3246e-02,  1.8080e-01,
        -1.1654e-01, -7.5538e-02, -3.7054e-01,  1.9298e-01,  9.2301e-02,
        -5.2914e-01, -5.9192e-01, -5.7700e-01, -1.0409e+00,  3.7015e-01,
        -4.2835e-01, -3.7255e-02,  2.4777e-01, -3.5072e-02, -7.3016e-01,
         2.6784e-03,  4.2254e-01, -6.3613e-01, -1.4406e-01, -9.4372e-01,
        -1.0650e-01, -1.9294e-01,  6.3178e-01, -2.7989e-01, -1.4918e-01,
        -1.4076e-01,  1.9851e-01,  6.3793e-01,  3.5250e-01, -6.9402e-02,
         7.0255e-02, -7.0042e-01, -5.8644e-01, -6.7527e-01, -7.3775e-01,
         4.5410e-01, -1.0644e+00,  3.5916e-01, -4.3311e-01,  1.6513e-01,
         3.9582e-01, -5.8113e-01, -3.9604e-01, -8.5332e-01, -2.4208e-03,
        -4.9585e-01, -2.8668e-02,  2.7000e+00,  1.3721e+00, -4.1798e-01,
        -1.9274e-01, -7.7553e-02, -4.5049e-02, -8.9308e-02,  4.3926e-02,
         4.8803e-02, -1.8841e-01, -1.3370e-01, -7.9591e-02,  3.7770e-03,
         1.1047e-01,  1.2347e-01, -3.8610e-01,  1.4558e+00,  4.0162e-01,
        -1.0213e-01, -8.9866e-02, -2.9537e-01, -5.4278e-01,  1.9339e-02,
        -6.3314e-02,  1.4176e-01,  6.5806e-03, -1.4075e+00, -1.1267e+00,
        -1.2399e+00,  1.8304e+00, -1.4574e+00,  7.6483e-01, -1.1369e+00,
        -1.0717e+00,  4.8402e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6488e-02, -5.7104e-02,  0.0000e+00,  4.8339e-01,
        -2.0257e-01,  2.5994e-01,  1.3269e-01,  2.1396e+00,  0.0000e+00,
         0.0000e+00, -5.9865e-01, -1.8242e-01, -3.9370e+00,  7.0672e-01,
        -4.0138e-01, -4.5708e-01, -4.2166e-01,  2.4906e-01,  3.2776e-01,
        -3.5330e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2049]), tensor(-0.0517))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:main.py:Testing data year: 1993
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 7594
            device: cpu
            
2024-07-15 22:34:41,510	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-15 22:34:41,549	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-15 22:34:41,582	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-15 22:34:41,586	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-15 22:34:43,860	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-15 22:39:23,585	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_22-34-43' in 0.1191s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 7594, 'embedding_dim': 25, 'dropout_rate': 0.37, 'lr': 0.005, 'weight_decay': 2.3845927361089558e-05, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07565346863551464
INFO:model_data_nn.py:Best trial testing loss: 0.0919952292157256
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-15_22-34-39_224650_1361901/artifacts/2024-07-15_22-34-43/train_fnn_2024-07-15_22-34-43/driver_artifacts/train_fnn_1b16f_00034_34_dropout_rate=0.3700,embedding_dim=25,hidden_dim=5,lr=0.0050,num_layers=4,weight_decay=0.0000_2024-07-15_22-34-44
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 8208, 'embedding_dim': 25, 'dropout_rate': 0.37, 'lr': 0.005, 'weight_decay': 2.3845927361089558e-05, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 4.790472209903946, 'avg_test_loss': 0.2171454962778401}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.2707590940708243, 'avg_test_loss': 0.10660267988969753}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.12944496004461614, 'avg_test_loss': 0.08155441835716173}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.09613880849934126, 'avg_test_loss': 0.0698219287850253}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.08620179626655014, 'avg_test_loss': 0.06662484635780384}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.08291471933605793, 'avg_test_loss': 0.0650194985187286}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.0815587097952698, 'avg_test_loss': 0.06360859077955995}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.08117434553283116, 'avg_test_loss': 0.06511685808564162}
INFO:model_data_nn.py:Epoch 9/40, metrics: {'avg_train_loss': 0.08124507603856017, 'avg_test_loss': 0.06302741847255013}
INFO:model_data_nn.py:Epoch 10/40, metrics: {'avg_train_loss': 0.08111729655958193, 'avg_test_loss': 0.062495029132281034}
INFO:model_data_nn.py:Epoch 11/40, metrics: {'avg_train_loss': 0.08098679931244461, 'avg_test_loss': 0.06436293581863503}
INFO:model_data_nn.py:Epoch 12/40, metrics: {'avg_train_loss': 0.08103218449967449, 'avg_test_loss': 0.0626962480994014}
INFO:model_data_nn.py:Epoch 13/40, metrics: {'avg_train_loss': 0.08094653059360075, 'avg_test_loss': 0.0625434804998048}
INFO:model_data_nn.py:Early stopping at epoch 13
INFO:main.py:Making prediction for data in year: 1994
INFO:main.py:Prediction data shape: (19550,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1994: 0.24975576859847154
INFO:main.py:Prediction Stats:                retq          pred
count  19550.000000  19550.000000
mean      -0.009021      0.026655
std        0.246687      0.011304
min       -0.941176      0.015993
25%       -0.125000      0.022377
50%       -0.014632      0.022886
75%        0.082227      0.026464
max        6.294121      1.000605
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:transform_data_nn.py:Train_data: (194746, 161)

INFO:transform_data_nn.py:Test data years: [1994]
INFO:transform_data_nn.py:Test_data: (19550, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:transform_data_nn.py:Retrain_data: (214296, 161)

INFO:transform_data_nn.py:Prediction data years: [1995]
INFO:transform_data_nn.py:Prediction_data: (22259, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([194746, 152])
            y_train_tf: torch.Size([194746])

            x_test_tf: torch.Size([19550, 152])
            y_test_tf: torch.Size([19550])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([214296, 152])
            y_retrain_tf: torch.Size([214296])

            x_prediction_tf: torch.Size([22259, 152])
            y_prediction_tf: torch.Size([22259])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-0.1669,  0.5888,  0.1036, -1.3219, -0.1143, -0.6813, -0.1850, -0.3644,
         0.3208, -0.1635, -0.7034,  0.0227, -0.4865, -0.2572,  0.1009,  0.5067,
        -0.1305,  0.2120, -0.0732,  0.4743, -0.3380,  0.0057,  0.0149,  0.0136,
        -0.0537, -0.2743, -0.5612, -0.0210,  0.3845,  1.0975,  0.4100, -0.0973,
         0.4536, -0.0351, -0.3724, -0.1814,  0.0980,  0.4924,  0.0227, -1.1218,
        -0.3089,  0.2602,  0.2824, -0.0835, -0.1526, -0.6815,  0.0777, -0.0463,
        -0.4050, -0.1860, -0.7059,  0.6565, -0.1252, -0.0294,  0.0189,  0.4337,
        -0.7312,  0.0518, -0.2591, -0.0319,  0.1302, -0.3191,  0.1327,  0.2513,
         0.1271, -0.1443,  0.3185, -0.0992,  0.7069, -0.4184, -0.1927, -0.0776,
        -0.0450, -0.8111,  0.1075,  0.6137,  0.0222, -0.3556, -0.1870,  0.0038,
        -0.0102,  0.2538,  0.0352, -0.3280, -0.5492, -0.1148, -0.0973, -0.3225,
        -0.0634,  0.1735, -0.5036, -1.2598,  0.0066,  1.6984,  1.9427,  2.1325,
         0.2193,  1.6729, -2.6897,  0.1787, -0.8928,  0.1270,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0538,  0.5436,  0.0000, -1.2410,  0.6873, -2.1641,
         0.1521,  0.0133,  0.0000,  0.0000,  0.0265, -0.1685,  0.0193, -0.0752,
         0.0659, -0.4429, -0.3589,  0.2582,  0.2740, -0.4163,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([6665]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-1.0950e+00, -1.5362e-01, -7.1802e-01,  7.1595e-01, -7.3885e-02,
        -4.5583e-01, -2.1670e+00, -9.9111e-01, -5.6359e-01, -3.7633e-01,
        -5.5989e-01,  7.3728e-03,  1.0031e-01,  2.8742e-01, -2.1712e-01,
        -3.9971e-02, -2.1449e-01,  2.2596e-01, -7.3246e-02,  1.8080e-01,
        -1.1654e-01, -7.5538e-02, -3.7054e-01,  1.9298e-01,  9.2301e-02,
        -5.2914e-01, -5.9192e-01, -5.7700e-01, -1.0409e+00,  3.7015e-01,
        -4.2835e-01, -3.7255e-02,  2.4777e-01, -3.5072e-02, -7.3016e-01,
         2.6784e-03,  4.2254e-01, -6.3613e-01, -1.4406e-01, -9.4372e-01,
        -1.0650e-01, -1.9294e-01,  6.3178e-01, -2.7989e-01, -1.4918e-01,
        -1.4076e-01,  1.9851e-01,  6.3793e-01,  3.5250e-01, -6.9402e-02,
         7.0255e-02, -7.0042e-01, -5.8644e-01, -6.7527e-01, -7.3775e-01,
         4.5410e-01, -1.0644e+00,  3.5916e-01, -4.3311e-01,  1.6513e-01,
         3.9582e-01, -5.8113e-01, -3.9604e-01, -8.5332e-01, -2.4208e-03,
        -4.9585e-01, -2.8668e-02,  2.7000e+00,  1.3721e+00, -4.1798e-01,
        -1.9274e-01, -7.7553e-02, -4.5049e-02, -8.9308e-02,  4.3926e-02,
         4.8803e-02, -1.8841e-01, -1.3370e-01, -7.9591e-02,  3.7770e-03,
         1.1047e-01,  1.2347e-01, -3.8610e-01,  1.4558e+00,  4.0162e-01,
        -1.0213e-01, -8.9866e-02, -2.9537e-01, -5.4278e-01,  1.9339e-02,
        -6.3314e-02,  1.4176e-01,  6.5806e-03, -1.4075e+00, -1.1267e+00,
        -1.2399e+00,  1.8304e+00, -1.4574e+00,  7.6483e-01, -1.1369e+00,
        -1.0717e+00,  4.8402e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6488e-02, -5.7104e-02,  0.0000e+00,  4.8339e-01,
        -2.0257e-01,  2.5994e-01,  1.3269e-01,  2.1396e+00,  0.0000e+00,
         0.0000e+00, -5.9865e-01, -1.8242e-01, -3.9370e+00,  7.0672e-01,
        -4.0138e-01, -4.5708e-01, -4.2166e-01,  2.4906e-01,  3.2776e-01,
        -3.5330e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2049]), tensor(-0.0517))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.6138e-01,  6.3450e-01,  9.6981e-02, -1.3080e+00, -1.1959e-01,
        -6.9455e-01, -1.8408e-01, -3.6603e-01,  3.4602e-01, -1.6517e-01,
        -7.0044e-01,  3.5450e-02, -4.9125e-01, -2.8845e-01,  1.0510e-01,
         5.0456e-01, -1.3299e-01,  2.2204e-01, -6.2827e-02,  4.7706e-01,
        -3.3099e-01,  1.1276e-02,  6.6511e-03,  8.8014e-03, -5.7867e-02,
        -2.7626e-01, -5.6481e-01, -1.7767e-02,  3.6237e-01,  1.1400e+00,
         4.0725e-01, -1.0241e-01,  4.6180e-01, -2.9825e-02, -3.6021e-01,
        -1.8733e-01,  9.5078e-02,  5.2221e-01,  1.4196e-02, -1.1223e+00,
        -3.1014e-01,  2.8018e-01,  2.7811e-01, -7.3863e-02, -1.5659e-01,
        -6.8839e-01,  8.3863e-02, -3.2747e-02, -4.1685e-01, -1.7848e-01,
        -7.2196e-01,  6.4307e-01, -1.2036e-01, -2.1798e-02,  1.4097e-02,
         4.3111e-01, -7.2384e-01,  6.8795e-02, -2.5934e-01, -3.0069e-02,
         1.2961e-01, -3.1864e-01,  1.3157e-01,  2.5408e-01,  1.2160e-01,
        -1.4858e-01,  3.4747e-01, -1.0941e-01,  6.8888e-01, -4.1828e-01,
        -2.1984e-01, -3.1756e-02, -4.4639e-02, -8.1988e-01,  1.2150e-01,
         6.2742e-01,  2.0417e-02, -3.5962e-01, -1.8665e-01,  6.7417e-03,
        -1.1077e-03,  2.4425e-01,  5.6884e-02, -3.2948e-01, -5.5073e-01,
        -1.1984e-01, -1.0287e-01, -3.1502e-01, -4.3851e-02,  1.7717e-01,
        -5.0642e-01, -1.2600e+00,  1.0965e-02,  1.7803e+00,  2.0508e+00,
         2.2045e+00,  8.3752e-02,  1.7561e+00, -2.8150e+00,  2.9148e-01,
        -8.5039e-01,  1.2211e-01,  0.0000e+00, -1.0546e+00,  0.0000e+00,
         1.5404e+00,  5.2180e-02,  6.0691e-01,  0.0000e+00, -1.3295e+00,
         7.3676e-01, -2.2904e+00,  1.5304e-01,  1.7361e-02,  0.0000e+00,
        -3.9607e-01,  4.4101e-02, -1.6949e-01,  3.3249e-02, -8.2228e-02,
         8.3000e-02, -4.3063e-01, -3.5525e-01,  2.6693e-01,  2.7907e-01,
        -4.1393e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([7461]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-4.8294e-01, -5.4073e-01, -7.6601e-01,  8.6777e-01, -3.0059e-01,
        -2.2299e-01, -1.5585e+00, -9.6941e-01, -4.3036e-01, -3.6043e-01,
        -6.6956e-01,  6.8434e-03, -5.5438e-03,  5.4760e-01, -7.4776e-02,
        -4.6272e-01, -1.7317e-01,  4.1447e-01, -6.2827e-02, -7.4029e-02,
         2.4118e-03, -6.9747e-02, -1.4708e-01, -2.2730e-01, -5.5682e-02,
        -5.5428e-01, -5.8687e-01, -1.7767e-02, -1.3436e+00,  6.6675e-01,
        -3.2284e-02, -1.1997e-01,  2.4504e-01, -2.9825e-02, -7.5459e-01,
        -7.5051e-04,  2.6271e-02, -6.3358e-01,  3.1237e-01, -8.3944e-01,
         2.2254e-01, -1.1148e+00,  9.9344e-02, -2.4154e-01, -3.0358e-01,
        -3.9225e-01, -3.8217e-01, -2.8421e-01,  4.2144e-02, -2.4167e-01,
         1.5758e+00, -7.7319e-01, -4.8150e-01, -6.3692e-01, -7.3569e-01,
         3.6909e-01, -1.0605e+00,  1.0941e-01, -3.3120e-01, -2.1883e-01,
         1.1599e-01, -4.1932e-01, -1.9770e-01,  2.1818e-01, -2.3513e-03,
        -4.2883e-01, -2.6993e-01,  6.9062e-01,  1.3538e+00, -4.6101e-01,
        -2.1984e-01, -3.1756e-02, -4.4639e-02, -8.4792e-02,  3.8531e-02,
        -3.0587e-01, -1.0111e-01, -1.8760e-01, -5.2785e-02,  6.7417e-03,
        -1.1077e-03, -5.0326e-01, -3.4607e-01, -4.9446e-01, -6.5240e-01,
        -1.0350e-01, -9.3501e-02, -3.2932e-01, -6.4154e-01,  1.1695e-01,
        -7.0328e-01,  5.0377e-01,  1.0965e-02, -9.9174e-01, -5.9269e-02,
        -1.1645e+00,  3.5015e-01, -4.5817e-01, -6.3622e-03, -1.2639e+00,
        -6.3468e-01, -2.5567e-01,  0.0000e+00, -1.0546e+00,  0.0000e+00,
         1.5404e+00,  2.0201e-02, -1.3220e-01,  0.0000e+00, -1.8752e-01,
        -4.9769e-01,  8.6243e-01,  1.3005e-01,  7.6998e-01,  0.0000e+00,
        -3.9607e-01, -4.5139e-01, -1.9572e-01, -3.8074e+00,  7.7426e-01,
         2.9990e-01, -5.2928e-01, -4.7617e-01,  2.0270e-01,  2.6195e-01,
        -3.6208e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2268]), tensor(-0.0506))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:main.py:Testing data year: 1994
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 8208
            device: cpu
            
2024-07-15 23:06:42,606	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-15 23:06:42,648	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-15 23:06:42,684	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-15 23:06:42,688	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-15 23:06:44,865	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-15 23:10:15,911	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_23-06-44' in 0.1298s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 4, 'num_embeddings': 8208, 'embedding_dim': 20, 'dropout_rate': 0.47, 'lr': 0.007, 'weight_decay': 1.754189348745081e-05, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07648891419583488
INFO:model_data_nn.py:Best trial testing loss: 0.06033403699757991
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-15_23-06-40_325976_1361901/artifacts/2024-07-15_23-06-44/train_fnn_2024-07-15_23-06-44/driver_artifacts/train_fnn_94193_00007_7_dropout_rate=0.4700,embedding_dim=20,hidden_dim=15,lr=0.0070,num_layers=4,weight_decay=0.0000_2024-07-15_23-06-44
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 4, 'num_embeddings': 9180, 'embedding_dim': 20, 'dropout_rate': 0.47, 'lr': 0.007, 'weight_decay': 1.754189348745081e-05, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 5.39930422555184, 'avg_test_loss': 0.09378354940777538}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.0868785769094075, 'avg_test_loss': 0.08309276346331355}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.07961412717483778, 'avg_test_loss': 0.08358613480867326}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.07976837142377309, 'avg_test_loss': 0.08433664384587057}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.07985013397521648, 'avg_test_loss': 0.08345941257202762}
INFO:model_data_nn.py:Early stopping at epoch 5
INFO:main.py:Making prediction for data in year: 1995
INFO:main.py:Prediction data shape: (22259,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1995: 0.28891742265154796
INFO:main.py:Prediction Stats:                retq          pred
count  22259.000000  22259.000000
mean       0.068422      0.039380
std        0.287634      0.004739
min       -0.950000      0.026265
25%       -0.062810      0.037569
50%        0.041558      0.039120
75%        0.165696      0.040236
max        4.272732      0.102057
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:transform_data_nn.py:Train_data: (214296, 161)

INFO:transform_data_nn.py:Test data years: [1995]
INFO:transform_data_nn.py:Test_data: (22259, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:transform_data_nn.py:Retrain_data: (236555, 161)

INFO:transform_data_nn.py:Prediction data years: [1996]
INFO:transform_data_nn.py:Prediction_data: (22619, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([214296, 152])
            y_train_tf: torch.Size([214296])

            x_test_tf: torch.Size([22259, 152])
            y_test_tf: torch.Size([22259])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([236555, 152])
            y_retrain_tf: torch.Size([236555])

            x_prediction_tf: torch.Size([22619, 152])
            y_prediction_tf: torch.Size([22619])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.6138e-01,  6.3450e-01,  9.6981e-02, -1.3080e+00, -1.1959e-01,
        -6.9455e-01, -1.8408e-01, -3.6603e-01,  3.4602e-01, -1.6517e-01,
        -7.0044e-01,  3.5450e-02, -4.9125e-01, -2.8845e-01,  1.0510e-01,
         5.0456e-01, -1.3299e-01,  2.2204e-01, -6.2827e-02,  4.7706e-01,
        -3.3099e-01,  1.1276e-02,  6.6511e-03,  8.8014e-03, -5.7867e-02,
        -2.7626e-01, -5.6481e-01, -1.7767e-02,  3.6237e-01,  1.1400e+00,
         4.0725e-01, -1.0241e-01,  4.6180e-01, -2.9825e-02, -3.6021e-01,
        -1.8733e-01,  9.5078e-02,  5.2221e-01,  1.4196e-02, -1.1223e+00,
        -3.1014e-01,  2.8018e-01,  2.7811e-01, -7.3863e-02, -1.5659e-01,
        -6.8839e-01,  8.3863e-02, -3.2747e-02, -4.1685e-01, -1.7848e-01,
        -7.2196e-01,  6.4307e-01, -1.2036e-01, -2.1798e-02,  1.4097e-02,
         4.3111e-01, -7.2384e-01,  6.8795e-02, -2.5934e-01, -3.0069e-02,
         1.2961e-01, -3.1864e-01,  1.3157e-01,  2.5408e-01,  1.2160e-01,
        -1.4858e-01,  3.4747e-01, -1.0941e-01,  6.8888e-01, -4.1828e-01,
        -2.1984e-01, -3.1756e-02, -4.4639e-02, -8.1988e-01,  1.2150e-01,
         6.2742e-01,  2.0417e-02, -3.5962e-01, -1.8665e-01,  6.7417e-03,
        -1.1077e-03,  2.4425e-01,  5.6884e-02, -3.2948e-01, -5.5073e-01,
        -1.1984e-01, -1.0287e-01, -3.1502e-01, -4.3851e-02,  1.7717e-01,
        -5.0642e-01, -1.2600e+00,  1.0965e-02,  1.7803e+00,  2.0508e+00,
         2.2045e+00,  8.3752e-02,  1.7561e+00, -2.8150e+00,  2.9148e-01,
        -8.5039e-01,  1.2211e-01,  0.0000e+00, -1.0546e+00,  0.0000e+00,
         1.5404e+00,  5.2180e-02,  6.0691e-01,  0.0000e+00, -1.3295e+00,
         7.3676e-01, -2.2904e+00,  1.5304e-01,  1.7361e-02,  0.0000e+00,
        -3.9607e-01,  4.4101e-02, -1.6949e-01,  3.3249e-02, -8.2228e-02,
         8.3000e-02, -4.3063e-01, -3.5525e-01,  2.6693e-01,  2.7907e-01,
        -4.1393e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([7461]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-4.8294e-01, -5.4073e-01, -7.6601e-01,  8.6777e-01, -3.0059e-01,
        -2.2299e-01, -1.5585e+00, -9.6941e-01, -4.3036e-01, -3.6043e-01,
        -6.6956e-01,  6.8434e-03, -5.5438e-03,  5.4760e-01, -7.4776e-02,
        -4.6272e-01, -1.7317e-01,  4.1447e-01, -6.2827e-02, -7.4029e-02,
         2.4118e-03, -6.9747e-02, -1.4708e-01, -2.2730e-01, -5.5682e-02,
        -5.5428e-01, -5.8687e-01, -1.7767e-02, -1.3436e+00,  6.6675e-01,
        -3.2284e-02, -1.1997e-01,  2.4504e-01, -2.9825e-02, -7.5459e-01,
        -7.5051e-04,  2.6271e-02, -6.3358e-01,  3.1237e-01, -8.3944e-01,
         2.2254e-01, -1.1148e+00,  9.9344e-02, -2.4154e-01, -3.0358e-01,
        -3.9225e-01, -3.8217e-01, -2.8421e-01,  4.2144e-02, -2.4167e-01,
         1.5758e+00, -7.7319e-01, -4.8150e-01, -6.3692e-01, -7.3569e-01,
         3.6909e-01, -1.0605e+00,  1.0941e-01, -3.3120e-01, -2.1883e-01,
         1.1599e-01, -4.1932e-01, -1.9770e-01,  2.1818e-01, -2.3513e-03,
        -4.2883e-01, -2.6993e-01,  6.9062e-01,  1.3538e+00, -4.6101e-01,
        -2.1984e-01, -3.1756e-02, -4.4639e-02, -8.4792e-02,  3.8531e-02,
        -3.0587e-01, -1.0111e-01, -1.8760e-01, -5.2785e-02,  6.7417e-03,
        -1.1077e-03, -5.0326e-01, -3.4607e-01, -4.9446e-01, -6.5240e-01,
        -1.0350e-01, -9.3501e-02, -3.2932e-01, -6.4154e-01,  1.1695e-01,
        -7.0328e-01,  5.0377e-01,  1.0965e-02, -9.9174e-01, -5.9269e-02,
        -1.1645e+00,  3.5015e-01, -4.5817e-01, -6.3622e-03, -1.2639e+00,
        -6.3468e-01, -2.5567e-01,  0.0000e+00, -1.0546e+00,  0.0000e+00,
         1.5404e+00,  2.0201e-02, -1.3220e-01,  0.0000e+00, -1.8752e-01,
        -4.9769e-01,  8.6243e-01,  1.3005e-01,  7.6998e-01,  0.0000e+00,
        -3.9607e-01, -4.5139e-01, -1.9572e-01, -3.8074e+00,  7.7426e-01,
         2.9990e-01, -5.2928e-01, -4.7617e-01,  2.0270e-01,  2.6195e-01,
        -3.6208e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2268]), tensor(-0.0506))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.5465e-01,  6.6885e-01,  8.5476e-02, -1.2872e+00, -1.2682e-01,
        -7.0710e-01, -1.7775e-01, -3.6445e-01,  3.6850e-01, -1.7035e-01,
        -6.9521e-01,  4.6163e-02, -4.8957e-01, -3.1484e-01,  1.0988e-01,
         5.0111e-01, -1.3360e-01,  2.3042e-01, -5.9369e-02,  4.7335e-01,
        -3.5575e-01,  6.9554e-03, -1.5421e-02,  1.9538e-03, -5.8418e-02,
        -2.7375e-01, -5.7194e-01, -1.5993e-02,  3.4099e-01,  1.1822e+00,
         4.0172e-01, -1.0509e-01,  4.6804e-01, -2.7462e-02, -3.4340e-01,
        -1.9804e-01,  8.5568e-02,  5.5779e-01,  3.2951e-03, -1.1233e+00,
        -3.1047e-01,  3.0597e-01,  2.6816e-01, -7.1363e-02, -1.6457e-01,
        -6.9600e-01,  9.3016e-02, -4.4227e-02, -4.1794e-01, -1.8607e-01,
        -7.3816e-01,  6.3137e-01, -1.1456e-01, -1.6210e-02,  2.6085e-03,
         4.2819e-01, -7.1177e-01,  7.6150e-02, -2.5529e-01, -2.0217e-02,
         1.2886e-01, -3.1347e-01,  1.3228e-01,  2.5872e-01,  1.1666e-01,
        -1.5427e-01,  3.6959e-01, -1.1485e-01,  6.7589e-01, -4.1543e-01,
        -2.3957e-01, -4.1940e-02, -8.1201e-03, -8.2637e-01,  1.3267e-01,
         6.3311e-01,  1.7659e-02, -3.6415e-01, -1.8467e-01,  6.6376e-03,
        -2.0541e-03,  2.3300e-01,  7.8207e-02, -3.3225e-01, -5.5213e-01,
        -1.2473e-01, -1.0838e-01, -3.0840e-01, -2.1037e-02,  1.7360e-01,
        -5.0841e-01, -1.2612e+00,  1.2012e-02,  1.8212e+00,  2.1685e+00,
         2.2888e+00,  7.5983e-02,  1.8721e+00, -2.8702e+00,  4.0568e-01,
        -7.9586e-01,  1.1003e-01,  7.1534e-01,  1.9921e-01, -2.0874e-01,
         2.9136e-01,  4.8129e-02,  4.9181e-01,  0.0000e+00, -1.3169e+00,
         8.2750e-01, -2.4208e+00,  1.5395e-01,  3.5656e-02,  0.0000e+00,
        -1.1729e-01,  7.0280e-02, -1.7483e-01,  1.7692e-02, -9.2213e-02,
         9.6501e-02, -4.1147e-01, -3.4738e-01,  2.7235e-01,  2.8255e-01,
        -4.1445e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([8187]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-3.4706e-01, -5.8692e-01, -5.1251e-01,  1.0123e+00, -8.8275e-02,
        -1.8575e-01, -6.2726e-01, -6.5006e-01, -4.6369e-01, -4.1597e-01,
        -7.1277e-01,  2.3876e-02, -1.2728e-01,  5.5995e-01,  1.4051e-01,
         6.9417e-02, -2.1466e-01,  3.2960e-01, -1.8060e-01,  1.3972e-01,
         2.0362e-01, -6.4095e-02, -2.0622e-02, -2.2984e-01,  8.8198e-02,
        -5.9688e-01, -6.0876e-01, -1.5993e-02, -1.2960e+00,  5.8608e-01,
        -4.4832e-01, -6.6236e-02,  2.4729e-01, -2.7462e-02, -7.3220e-01,
        -5.9738e-02,  2.4769e-01, -6.3787e-01, -6.7517e-02, -8.8688e-01,
        -1.0564e-03,  1.8863e-01,  2.6198e-01, -2.5534e-01, -1.5373e-01,
         2.0762e-01, -9.4873e-03,  5.7696e-01, -1.2216e-01,  2.9324e-02,
         1.5413e+00, -6.9475e-01, -5.9335e-01, -6.0518e-01, -7.3726e-01,
         3.9733e-01, -1.0525e+00,  3.6123e-01, -5.0060e-01, -3.7416e-01,
         1.0904e-01, -5.2580e-01, -2.1244e-01,  6.7539e-02, -3.0935e-03,
        -4.0521e-01, -2.7154e-01, -5.1469e-02,  1.3419e+00, -5.0704e-01,
        -2.3957e-01, -4.1940e-02, -8.1201e-03,  8.1635e-02,  5.7545e-02,
        -8.2888e-02,  8.5503e-02, -2.2786e-01, -5.5072e-02,  6.6376e-03,
         1.2189e-01, -6.5599e-02, -3.4642e-01,  1.1322e+00, -4.0199e-01,
        -1.0438e-01, -9.7048e-02, -3.5142e-01, -5.6331e-01,  2.5259e-01,
        -5.2920e-01, -6.4311e-01,  1.2012e-02, -1.8836e+00, -6.2020e-01,
        -1.2011e+00,  3.0616e-01, -5.9280e-01, -9.7377e-01, -1.0392e+00,
        -4.6702e-01,  9.3573e-02,  7.1534e-01, -3.6527e+00, -2.0874e-01,
         5.5889e+00,  2.1032e-02,  7.4366e-01,  0.0000e+00, -3.4124e-01,
        -8.1074e-01,  4.4621e-01,  1.3354e-01,  1.2521e+00,  0.0000e+00,
        -1.1729e-01, -3.9310e-01, -1.5445e-01, -3.7710e+00,  7.2779e-01,
         5.2095e-02, -4.8817e-01, -5.1235e-01,  2.2483e-01,  2.8419e-01,
        -3.8822e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2302]), tensor(0.0223))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:main.py:Testing data year: 1995
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 9180
            device: cpu
            
2024-07-15 23:39:12,315	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-15 23:39:12,351	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-15 23:39:12,388	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-15 23:39:12,394	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-15 23:39:14,522	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-15 23:42:52,254	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_23-39-14' in 0.1376s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 2, 'num_embeddings': 9180, 'embedding_dim': 20, 'dropout_rate': 0.54, 'lr': 0.01, 'weight_decay': 0.0008692991511139556, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07814078614880333
INFO:model_data_nn.py:Best trial testing loss: 0.08248706324689689
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-15_23-39-10_155994_1361901/artifacts/2024-07-15_23-39-14/train_fnn_2024-07-15_23-39-14/driver_artifacts/train_fnn_1e2f2_00009_9_dropout_rate=0.5400,embedding_dim=20,hidden_dim=55,lr=0.0100,num_layers=2,weight_decay=0.0009_2024-07-15_23-39-14
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 2, 'num_embeddings': 10061, 'embedding_dim': 20, 'dropout_rate': 0.54, 'lr': 0.01, 'weight_decay': 0.0008692991511139556, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 3.1282928732641646, 'avg_test_loss': 0.08503000819113816}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.08145655655780354, 'avg_test_loss': 0.08406494271135732}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.08266384801349125, 'avg_test_loss': 0.08583230491769447}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.08474436402522229, 'avg_test_loss': 0.08380163000540787}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.0838806489996008, 'avg_test_loss': 0.08369931689557734}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.08234086656087154, 'avg_test_loss': 0.0833454809329483}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.08048351089293893, 'avg_test_loss': 0.08478469763662708}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.07860501948442009, 'avg_test_loss': 0.08315247031493803}
INFO:model_data_nn.py:Epoch 9/40, metrics: {'avg_train_loss': 0.07777454607390069, 'avg_test_loss': 0.08264540236317709}
INFO:model_data_nn.py:Epoch 10/40, metrics: {'avg_train_loss': 0.07755962349273063, 'avg_test_loss': 0.08402575152727325}
INFO:model_data_nn.py:Epoch 11/40, metrics: {'avg_train_loss': 0.07677817134841068, 'avg_test_loss': 0.08383824590468004}
INFO:model_data_nn.py:Epoch 12/40, metrics: {'avg_train_loss': 0.07715304890999923, 'avg_test_loss': 0.08565111617358882}
INFO:model_data_nn.py:Early stopping at epoch 12
INFO:main.py:Making prediction for data in year: 1996
INFO:main.py:Prediction data shape: (22619,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1996: 0.2925242705315551
INFO:main.py:Prediction Stats:                retq          pred
count  22619.000000  22619.000000
mean       0.044741      0.061140
std        0.289333      0.068256
min       -0.961538     -0.193893
25%       -0.085714      0.024136
50%        0.018182      0.039262
75%        0.140416      0.070695
max       10.111111      0.670844
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:transform_data_nn.py:Train_data: (236555, 161)

INFO:transform_data_nn.py:Test data years: [1996]
INFO:transform_data_nn.py:Test_data: (22619, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:transform_data_nn.py:Retrain_data: (259174, 161)

INFO:transform_data_nn.py:Prediction data years: [1997]
INFO:transform_data_nn.py:Prediction_data: (23999, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([236555, 152])
            y_train_tf: torch.Size([236555])

            x_test_tf: torch.Size([22619, 152])
            y_test_tf: torch.Size([22619])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([259174, 152])
            y_retrain_tf: torch.Size([259174])

            x_prediction_tf: torch.Size([23999, 152])
            y_prediction_tf: torch.Size([23999])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.5465e-01,  6.6885e-01,  8.5476e-02, -1.2872e+00, -1.2682e-01,
        -7.0710e-01, -1.7775e-01, -3.6445e-01,  3.6850e-01, -1.7035e-01,
        -6.9521e-01,  4.6163e-02, -4.8957e-01, -3.1484e-01,  1.0988e-01,
         5.0111e-01, -1.3360e-01,  2.3042e-01, -5.9369e-02,  4.7335e-01,
        -3.5575e-01,  6.9554e-03, -1.5421e-02,  1.9538e-03, -5.8418e-02,
        -2.7375e-01, -5.7194e-01, -1.5993e-02,  3.4099e-01,  1.1822e+00,
         4.0172e-01, -1.0509e-01,  4.6804e-01, -2.7462e-02, -3.4340e-01,
        -1.9804e-01,  8.5568e-02,  5.5779e-01,  3.2951e-03, -1.1233e+00,
        -3.1047e-01,  3.0597e-01,  2.6816e-01, -7.1363e-02, -1.6457e-01,
        -6.9600e-01,  9.3016e-02, -4.4227e-02, -4.1794e-01, -1.8607e-01,
        -7.3816e-01,  6.3137e-01, -1.1456e-01, -1.6210e-02,  2.6085e-03,
         4.2819e-01, -7.1177e-01,  7.6150e-02, -2.5529e-01, -2.0217e-02,
         1.2886e-01, -3.1347e-01,  1.3228e-01,  2.5872e-01,  1.1666e-01,
        -1.5427e-01,  3.6959e-01, -1.1485e-01,  6.7589e-01, -4.1543e-01,
        -2.3957e-01, -4.1940e-02, -8.1201e-03, -8.2637e-01,  1.3267e-01,
         6.3311e-01,  1.7659e-02, -3.6415e-01, -1.8467e-01,  6.6376e-03,
        -2.0541e-03,  2.3300e-01,  7.8207e-02, -3.3225e-01, -5.5213e-01,
        -1.2473e-01, -1.0838e-01, -3.0840e-01, -2.1037e-02,  1.7360e-01,
        -5.0841e-01, -1.2612e+00,  1.2012e-02,  1.8212e+00,  2.1685e+00,
         2.2888e+00,  7.5983e-02,  1.8721e+00, -2.8702e+00,  4.0568e-01,
        -7.9586e-01,  1.1003e-01,  7.1534e-01,  1.9921e-01, -2.0874e-01,
         2.9136e-01,  4.8129e-02,  4.9181e-01,  0.0000e+00, -1.3169e+00,
         8.2750e-01, -2.4208e+00,  1.5395e-01,  3.5656e-02,  0.0000e+00,
        -1.1729e-01,  7.0280e-02, -1.7483e-01,  1.7692e-02, -9.2213e-02,
         9.6501e-02, -4.1147e-01, -3.4738e-01,  2.7235e-01,  2.8255e-01,
        -4.1445e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([8187]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-3.4706e-01, -5.8692e-01, -5.1251e-01,  1.0123e+00, -8.8275e-02,
        -1.8575e-01, -6.2726e-01, -6.5006e-01, -4.6369e-01, -4.1597e-01,
        -7.1277e-01,  2.3876e-02, -1.2728e-01,  5.5995e-01,  1.4051e-01,
         6.9417e-02, -2.1466e-01,  3.2960e-01, -1.8060e-01,  1.3972e-01,
         2.0362e-01, -6.4095e-02, -2.0622e-02, -2.2984e-01,  8.8198e-02,
        -5.9688e-01, -6.0876e-01, -1.5993e-02, -1.2960e+00,  5.8608e-01,
        -4.4832e-01, -6.6236e-02,  2.4729e-01, -2.7462e-02, -7.3220e-01,
        -5.9738e-02,  2.4769e-01, -6.3787e-01, -6.7517e-02, -8.8688e-01,
        -1.0564e-03,  1.8863e-01,  2.6198e-01, -2.5534e-01, -1.5373e-01,
         2.0762e-01, -9.4873e-03,  5.7696e-01, -1.2216e-01,  2.9324e-02,
         1.5413e+00, -6.9475e-01, -5.9335e-01, -6.0518e-01, -7.3726e-01,
         3.9733e-01, -1.0525e+00,  3.6123e-01, -5.0060e-01, -3.7416e-01,
         1.0904e-01, -5.2580e-01, -2.1244e-01,  6.7539e-02, -3.0935e-03,
        -4.0521e-01, -2.7154e-01, -5.1469e-02,  1.3419e+00, -5.0704e-01,
        -2.3957e-01, -4.1940e-02, -8.1201e-03,  8.1635e-02,  5.7545e-02,
        -8.2888e-02,  8.5503e-02, -2.2786e-01, -5.5072e-02,  6.6376e-03,
         1.2189e-01, -6.5599e-02, -3.4642e-01,  1.1322e+00, -4.0199e-01,
        -1.0438e-01, -9.7048e-02, -3.5142e-01, -5.6331e-01,  2.5259e-01,
        -5.2920e-01, -6.4311e-01,  1.2012e-02, -1.8836e+00, -6.2020e-01,
        -1.2011e+00,  3.0616e-01, -5.9280e-01, -9.7377e-01, -1.0392e+00,
        -4.6702e-01,  9.3573e-02,  7.1534e-01, -3.6527e+00, -2.0874e-01,
         5.5889e+00,  2.1032e-02,  7.4366e-01,  0.0000e+00, -3.4124e-01,
        -8.1074e-01,  4.4621e-01,  1.3354e-01,  1.2521e+00,  0.0000e+00,
        -1.1729e-01, -3.9310e-01, -1.5445e-01, -3.7710e+00,  7.2779e-01,
         5.2095e-02, -4.8817e-01, -5.1235e-01,  2.2483e-01,  2.8419e-01,
        -3.8822e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2302]), tensor(0.0223))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.4880e-01,  6.9521e-01,  7.9073e-02, -1.2731e+00, -1.3749e-01,
        -7.1969e-01, -1.7195e-01, -3.6190e-01,  3.9376e-01, -1.7017e-01,
        -6.9037e-01,  5.3550e-02, -4.9331e-01, -3.3738e-01,  1.1412e-01,
         5.0071e-01, -1.3906e-01,  2.3610e-01, -4.8212e-02,  4.7460e-01,
        -3.4819e-01,  1.5372e-02, -3.9827e-02,  1.2964e-04, -5.6493e-02,
        -2.7282e-01, -5.7808e-01, -2.0449e-02,  3.1053e-01,  1.2282e+00,
         3.9251e-01, -1.1274e-01,  4.7515e-01, -3.3248e-02, -3.2932e-01,
        -2.0729e-01,  8.0102e-02,  5.8961e-01, -7.0135e-03, -1.1219e+00,
        -3.0714e-01,  2.6452e-01,  2.6121e-01, -6.4193e-02, -1.6986e-01,
        -7.0253e-01,  7.4020e-02, -4.5559e-02, -4.0965e-01, -1.9228e-01,
        -7.4970e-01,  6.1298e-01, -1.0643e-01, -1.4157e-02, -8.2136e-03,
         4.2601e-01, -6.9788e-01,  7.6248e-02, -2.5865e-01, -1.6434e-02,
         1.3006e-01, -3.1513e-01,  1.3385e-01,  2.5961e-01,  1.0734e-01,
        -1.5899e-01,  3.8703e-01, -1.2239e-01,  6.7389e-01, -4.1416e-01,
        -2.5506e-01, -5.0796e-02,  1.4470e-03, -8.3424e-01,  1.4112e-01,
         6.4460e-01,  1.5110e-02, -3.6804e-01, -1.8318e-01,  5.6013e-03,
        -1.8051e-03,  2.2095e-01,  9.8807e-02, -3.2572e-01, -5.5546e-01,
        -1.2895e-01, -1.1314e-01, -3.0071e-01, -3.5542e-03,  1.7228e-01,
        -5.1372e-01, -1.2628e+00,  1.4299e-02,  1.7954e+00,  2.2832e+00,
         2.3517e+00,  2.2862e-02,  1.9832e+00, -2.9241e+00,  4.9539e-01,
        -7.8563e-01,  1.0158e-01, -5.3760e-01,  7.9158e-02,  3.8423e-01,
         1.8522e-01,  4.8789e-02,  4.3421e-01,  0.0000e+00, -1.3807e+00,
         8.8076e-01, -2.5454e+00,  1.5510e-01,  2.4301e-02,  0.0000e+00,
        -5.9034e-02,  9.6087e-02, -1.7846e-01,  2.8494e-02, -1.0019e-01,
         1.0179e-01, -3.9550e-01, -3.4418e-01,  2.7712e-01,  2.8553e-01,
        -4.1652e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([8675]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-8.5434e-01,  1.5356e-01,  2.0732e-01,  1.1448e+00, -8.4316e-02,
        -4.7100e-01, -6.1442e-01, -6.4004e-01, -3.1435e-01, -2.9830e-01,
        -7.4604e-01,  1.2911e-02, -2.1747e+00,  8.2419e-02, -4.1931e-01,
        -4.5306e-01, -1.8767e-01, -1.3225e-01,  7.9684e-02, -7.1321e-03,
         3.2981e-01, -6.0564e-02, -1.3137e-01, -2.3293e-01,  5.4243e-02,
        -5.9473e-01, -6.2350e-01, -5.4848e-01, -8.9352e-01,  8.8011e-01,
        -4.3661e-01, -1.2415e-01,  2.4384e-01, -2.4274e+00, -7.7629e-01,
        -1.1264e-01,  4.8749e-02, -6.3743e-01, -2.5934e-01, -8.7099e-01,
         9.1009e-02, -1.3482e-01,  2.8138e-01, -1.8172e-01, -1.2515e-01,
        -1.6322e-01, -3.3947e-01, -4.8949e-01, -2.5839e-01,  1.2283e-01,
         1.5612e-02, -7.6832e-01, -5.8544e-01, -5.8243e-01, -7.3674e-01,
         2.8582e-01, -1.0422e+00,  1.0387e-01, -2.0648e-01, -3.5042e-01,
         5.7477e-02, -1.6340e-01, -1.1582e-01, -6.6688e-02, -3.1892e-03,
        -3.5912e-01,  1.6965e-01, -6.0161e-01,  6.4383e-03, -5.0308e-01,
        -2.5506e-01, -5.0796e-02,  1.4470e-03,  4.1342e-01,  5.0155e-02,
         3.8097e-02,  1.1700e+00, -2.6240e-01, -9.8077e-02,  5.6013e-03,
         1.1876e-01, -3.0161e-01, -2.7645e-01,  1.6201e-03, -5.0708e-01,
        -1.1001e-01, -1.0270e-01, -3.6406e-01, -6.1253e-01,  2.2928e-02,
        -5.5082e-01, -9.6781e-01,  1.4299e-02, -1.9548e+00, -7.3393e-01,
        -1.2708e+00,  6.6421e-01, -6.3947e-01, -3.1675e-01, -9.0903e-01,
         4.1027e-01,  9.7794e-02, -5.3760e-01, -2.9017e+00,  3.8423e-01,
         4.3736e+00,  1.5561e-02, -3.2619e-01,  0.0000e+00,  7.6622e-01,
         5.7234e-01,  9.8142e-01,  1.2886e-01,  6.8689e-01,  0.0000e+00,
        -5.9034e-02, -2.7421e-01, -1.7482e-01, -3.7708e+00,  7.8676e-01,
        -7.5419e-01, -5.5688e-01, -5.5884e-01,  1.7163e-01,  2.3172e-01,
        -4.0256e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2440]), tensor(0.0745))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:main.py:Testing data year: 1996
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 10061
            device: cpu
            
2024-07-16 00:15:03,374	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 00:15:03,417	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 00:15:03,452	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 00:15:03,458	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 00:15:05,735	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 00:18:26,940	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_00-15-05' in 0.1311s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 10061, 'embedding_dim': 5, 'dropout_rate': 0.44, 'lr': 0.007, 'weight_decay': 8.707410675803571e-05, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07630462242542087
INFO:model_data_nn.py:Best trial testing loss: 0.08248460114923085
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_00-15-01_094208_1361901/artifacts/2024-07-16_00-15-05/train_fnn_2024-07-16_00-15-05/driver_artifacts/train_fnn_20682_00042_42_dropout_rate=0.4400,embedding_dim=5,hidden_dim=25,lr=0.0070,num_layers=1,weight_decay=0.0001_2024-07-16_00-15-05
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 10656, 'embedding_dim': 5, 'dropout_rate': 0.44, 'lr': 0.007, 'weight_decay': 8.707410675803571e-05, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 2.788240914349789, 'avg_test_loss': 0.0992278675053348}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.08050475697247321, 'avg_test_loss': 0.09811807558574576}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.08033805783665192, 'avg_test_loss': 0.09870743997236515}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.0807844923822042, 'avg_test_loss': 0.09946736578453094}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.08103622048578399, 'avg_test_loss': 0.09947755219454461}
INFO:model_data_nn.py:Early stopping at epoch 5
INFO:main.py:Making prediction for data in year: 1997
INFO:main.py:Prediction data shape: (23999,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1997: 0.3155377874370251
INFO:main.py:Prediction Stats:                retq          pred
count  23999.000000  23999.000000
mean       0.055567      0.053795
std        0.312191      0.040772
min       -0.982955     -0.592266
25%       -0.095238      0.036848
50%        0.035715      0.053124
75%        0.181672      0.070882
max       14.000004      0.380803
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:transform_data_nn.py:Train_data: (259174, 161)

INFO:transform_data_nn.py:Test data years: [1997]
INFO:transform_data_nn.py:Test_data: (23999, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:transform_data_nn.py:Retrain_data: (283173, 161)

INFO:transform_data_nn.py:Prediction data years: [1998]
INFO:transform_data_nn.py:Prediction_data: (24412, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([259174, 152])
            y_train_tf: torch.Size([259174])

            x_test_tf: torch.Size([23999, 152])
            y_test_tf: torch.Size([23999])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([283173, 152])
            y_retrain_tf: torch.Size([283173])

            x_prediction_tf: torch.Size([24412, 152])
            y_prediction_tf: torch.Size([24412])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.4880e-01,  6.9521e-01,  7.9073e-02, -1.2731e+00, -1.3749e-01,
        -7.1969e-01, -1.7195e-01, -3.6190e-01,  3.9376e-01, -1.7017e-01,
        -6.9037e-01,  5.3550e-02, -4.9331e-01, -3.3738e-01,  1.1412e-01,
         5.0071e-01, -1.3906e-01,  2.3610e-01, -4.8212e-02,  4.7460e-01,
        -3.4819e-01,  1.5372e-02, -3.9827e-02,  1.2964e-04, -5.6493e-02,
        -2.7282e-01, -5.7808e-01, -2.0449e-02,  3.1053e-01,  1.2282e+00,
         3.9251e-01, -1.1274e-01,  4.7515e-01, -3.3248e-02, -3.2932e-01,
        -2.0729e-01,  8.0102e-02,  5.8961e-01, -7.0135e-03, -1.1219e+00,
        -3.0714e-01,  2.6452e-01,  2.6121e-01, -6.4193e-02, -1.6986e-01,
        -7.0253e-01,  7.4020e-02, -4.5559e-02, -4.0965e-01, -1.9228e-01,
        -7.4970e-01,  6.1298e-01, -1.0643e-01, -1.4157e-02, -8.2136e-03,
         4.2601e-01, -6.9788e-01,  7.6248e-02, -2.5865e-01, -1.6434e-02,
         1.3006e-01, -3.1513e-01,  1.3385e-01,  2.5961e-01,  1.0734e-01,
        -1.5899e-01,  3.8703e-01, -1.2239e-01,  6.7389e-01, -4.1416e-01,
        -2.5506e-01, -5.0796e-02,  1.4470e-03, -8.3424e-01,  1.4112e-01,
         6.4460e-01,  1.5110e-02, -3.6804e-01, -1.8318e-01,  5.6013e-03,
        -1.8051e-03,  2.2095e-01,  9.8807e-02, -3.2572e-01, -5.5546e-01,
        -1.2895e-01, -1.1314e-01, -3.0071e-01, -3.5542e-03,  1.7228e-01,
        -5.1372e-01, -1.2628e+00,  1.4299e-02,  1.7954e+00,  2.2832e+00,
         2.3517e+00,  2.2862e-02,  1.9832e+00, -2.9241e+00,  4.9539e-01,
        -7.8563e-01,  1.0158e-01, -5.3760e-01,  7.9158e-02,  3.8423e-01,
         1.8522e-01,  4.8789e-02,  4.3421e-01,  0.0000e+00, -1.3807e+00,
         8.8076e-01, -2.5454e+00,  1.5510e-01,  2.4301e-02,  0.0000e+00,
        -5.9034e-02,  9.6087e-02, -1.7846e-01,  2.8494e-02, -1.0019e-01,
         1.0179e-01, -3.9550e-01, -3.4418e-01,  2.7712e-01,  2.8553e-01,
        -4.1652e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([8675]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-8.5434e-01,  1.5356e-01,  2.0732e-01,  1.1448e+00, -8.4316e-02,
        -4.7100e-01, -6.1442e-01, -6.4004e-01, -3.1435e-01, -2.9830e-01,
        -7.4604e-01,  1.2911e-02, -2.1747e+00,  8.2419e-02, -4.1931e-01,
        -4.5306e-01, -1.8767e-01, -1.3225e-01,  7.9684e-02, -7.1321e-03,
         3.2981e-01, -6.0564e-02, -1.3137e-01, -2.3293e-01,  5.4243e-02,
        -5.9473e-01, -6.2350e-01, -5.4848e-01, -8.9352e-01,  8.8011e-01,
        -4.3661e-01, -1.2415e-01,  2.4384e-01, -2.4274e+00, -7.7629e-01,
        -1.1264e-01,  4.8749e-02, -6.3743e-01, -2.5934e-01, -8.7099e-01,
         9.1009e-02, -1.3482e-01,  2.8138e-01, -1.8172e-01, -1.2515e-01,
        -1.6322e-01, -3.3947e-01, -4.8949e-01, -2.5839e-01,  1.2283e-01,
         1.5612e-02, -7.6832e-01, -5.8544e-01, -5.8243e-01, -7.3674e-01,
         2.8582e-01, -1.0422e+00,  1.0387e-01, -2.0648e-01, -3.5042e-01,
         5.7477e-02, -1.6340e-01, -1.1582e-01, -6.6688e-02, -3.1892e-03,
        -3.5912e-01,  1.6965e-01, -6.0161e-01,  6.4383e-03, -5.0308e-01,
        -2.5506e-01, -5.0796e-02,  1.4470e-03,  4.1342e-01,  5.0155e-02,
         3.8097e-02,  1.1700e+00, -2.6240e-01, -9.8077e-02,  5.6013e-03,
         1.1876e-01, -3.0161e-01, -2.7645e-01,  1.6201e-03, -5.0708e-01,
        -1.1001e-01, -1.0270e-01, -3.6406e-01, -6.1253e-01,  2.2928e-02,
        -5.5082e-01, -9.6781e-01,  1.4299e-02, -1.9548e+00, -7.3393e-01,
        -1.2708e+00,  6.6421e-01, -6.3947e-01, -3.1675e-01, -9.0903e-01,
         4.1027e-01,  9.7794e-02, -5.3760e-01, -2.9017e+00,  3.8423e-01,
         4.3736e+00,  1.5561e-02, -3.2619e-01,  0.0000e+00,  7.6622e-01,
         5.7234e-01,  9.8142e-01,  1.2886e-01,  6.8689e-01,  0.0000e+00,
        -5.9034e-02, -2.7421e-01, -1.7482e-01, -3.7708e+00,  7.8676e-01,
        -7.5419e-01, -5.5688e-01, -5.5884e-01,  1.7163e-01,  2.3172e-01,
        -4.0256e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2440]), tensor(0.0745))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.4875e-01,  7.2061e-01,  7.2912e-02, -1.2606e+00, -1.4886e-01,
        -7.3204e-01, -1.6850e-01, -3.6069e-01,  4.2156e-01, -1.6996e-01,
        -6.8732e-01,  6.2069e-02, -4.9929e-01, -3.5319e-01,  1.1656e-01,
         4.9707e-01, -1.4139e-01,  2.4484e-01, -4.3315e-02,  4.8274e-01,
        -3.5553e-01,  1.5676e-02, -4.0194e-02, -3.8391e-03, -5.8610e-02,
        -2.7463e-01, -5.8303e-01, -1.6828e-02,  2.8067e-01,  1.2710e+00,
         3.8739e-01, -1.1953e-01,  4.8341e-01, -4.5972e-02, -3.1644e-01,
        -2.1355e-01,  7.1828e-02,  6.2033e-01, -1.9624e-02, -1.1225e+00,
        -3.0338e-01,  2.7821e-01,  2.4991e-01, -5.3326e-02, -1.7550e-01,
        -7.1020e-01,  7.6894e-02, -5.2911e-02, -4.1289e-01, -1.9440e-01,
        -7.6091e-01,  5.9169e-01, -9.4990e-02, -1.2033e-02, -1.4167e-02,
         4.2622e-01, -6.8477e-01,  8.1612e-02, -2.6019e-01, -1.7514e-02,
         1.2912e-01, -3.1628e-01,  1.3074e-01,  2.5888e-01,  1.0887e-01,
        -1.6674e-01,  4.0211e-01, -1.2470e-01,  6.6961e-01, -4.1523e-01,
        -2.6985e-01, -6.1165e-02, -9.8828e-04, -8.4282e-01,  1.5168e-01,
         6.5720e-01,  1.5584e-02, -3.7219e-01, -1.8143e-01,  5.0605e-03,
        -1.8819e-03,  2.0476e-01,  1.2074e-01, -3.1400e-01, -5.6006e-01,
        -1.3345e-01, -1.1882e-01, -2.9322e-01,  7.9855e-03,  1.7296e-01,
        -5.2195e-01, -1.2660e+00,  1.6970e-02,  1.7147e+00,  2.3702e+00,
         2.4034e+00, -7.6860e-03,  2.0941e+00, -3.0161e+00,  5.8447e-01,
        -8.6387e-01,  1.0094e-01, -3.3009e-01,  6.7510e-02,  2.8525e-01,
         1.5178e-01,  4.9893e-02,  3.3440e-01,  0.0000e+00, -1.4748e+00,
         8.9989e-01, -2.5525e+00,  1.5741e-01,  8.5457e-03,  0.0000e+00,
        -1.8565e-02,  1.2020e-01, -1.8193e-01,  1.3378e-02, -1.0678e-01,
         1.0540e-01, -3.8029e-01, -3.4150e-01,  2.8398e-01,  2.9023e-01,
        -4.1761e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([9386]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-4.9754e-01,  4.5230e-01, -7.9629e-01,  1.2705e+00, -3.4419e-02,
        -8.0852e-01, -1.2732e+00, -8.7504e-01, -3.5972e-01, -1.0120e-01,
        -7.5125e-01,  1.0637e-02, -4.6192e+00, -1.6720e-01, -4.3450e-01,
         1.6455e-01, -1.7177e-01, -1.1868e-02, -4.3315e-02,  1.0907e+00,
         1.4642e-01, -6.0401e-02, -4.8681e-02, -1.6256e-01, -6.2277e-02,
        -4.3124e-01, -6.4073e-01, -1.6828e-02, -1.2184e+00,  8.5124e-01,
        -1.3525e-01, -1.9557e-01,  2.3175e-01, -4.5972e-02, -7.8088e-01,
        -3.9932e-01, -2.3895e-01, -6.1120e-01, -2.4745e-01, -9.0022e-01,
        -2.2962e-01,  1.3594e-01,  3.5618e-01, -1.5770e-01, -5.3546e-02,
        -6.5398e-01, -5.5200e-02,  2.5113e-01, -2.6188e-01,  2.1419e-02,
         9.0682e-03, -7.2800e-01, -6.8018e-01, -5.6584e-01, -7.3715e-01,
         2.8444e-01, -1.0327e+00, -1.4410e-01,  1.2377e+00, -4.4250e-01,
        -1.9594e-02,  3.1610e-01, -1.1760e+00,  5.3322e-01,  1.1959e-03,
        -7.9654e-01,  4.2208e-01,  1.3068e+00, -2.0039e+00, -4.5196e-01,
        -2.6985e-01, -6.1165e-02, -9.8828e-04, -7.6262e-01,  5.3793e-02,
         1.4250e-02,  5.2743e+00, -3.4692e-01, -4.9553e-03,  5.0605e-03,
        -1.8819e-03,  9.3164e-02, -2.2469e-01,  1.1796e+00,  3.0917e-01,
        -1.1656e-01, -1.0947e-01, -3.6519e-01, -6.1414e-01,  1.1825e-03,
        -2.3899e-01, -6.9905e-01,  1.6970e-02, -2.2883e+00, -1.4159e+00,
        -1.2488e+00,  2.3878e-01, -5.0993e-01, -9.9969e-01, -1.1059e+00,
         8.7936e-01,  5.0583e-01, -3.3009e-01,  3.3646e+00,  2.8525e-01,
         1.5399e+00,  2.3916e-02,  9.1798e-01,  0.0000e+00,  4.0425e-01,
        -6.9032e-01,  1.3071e+00,  1.2843e-01,  1.3725e+00,  0.0000e+00,
        -1.8565e-02, -5.1438e-02, -1.3765e-01, -3.7524e+00,  7.0168e-01,
        -3.1048e-01, -4.7103e-01, -4.3587e-01,  1.6012e-01,  2.3185e-01,
        -4.0248e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2456]), tensor(-0.0156))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:main.py:Testing data year: 1997
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 10656
            device: cpu
            
2024-07-16 00:53:03,326	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 00:53:03,366	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 00:53:03,405	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 00:53:03,410	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 00:53:05,667	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 00:57:32,579	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_00-53-05' in 0.1296s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 1, 'num_embeddings': 10656, 'embedding_dim': 15, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 0.000526576127715743, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.08037462530460904
INFO:model_data_nn.py:Best trial testing loss: 0.0979587718487737
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_00-53-01_078855_1361901/artifacts/2024-07-16_00-53-05/train_fnn_2024-07-16_00-53-05/driver_artifacts/train_fnn_6f5a4_00022_22_dropout_rate=0.5200,embedding_dim=15,hidden_dim=5,lr=0.0100,num_layers=1,weight_decay=0.0005_2024-07-16_00-53-05
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 1, 'num_embeddings': 11533, 'embedding_dim': 15, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 0.000526576127715743, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 1.3226194129928663, 'avg_test_loss': 0.1387565634601439}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.08205835134558238, 'avg_test_loss': 0.13709753441313902}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.08172830741418409, 'avg_test_loss': 0.13714198426653942}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.08158336126505521, 'avg_test_loss': 0.13720662895745286}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.0816089276496957, 'avg_test_loss': 0.13240437015580633}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.08030520198494868, 'avg_test_loss': 0.13345279944284508}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.08016296344545906, 'avg_test_loss': 0.13116434030234814}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.07978650600108458, 'avg_test_loss': 0.13113837130367756}
INFO:model_data_nn.py:Epoch 9/40, metrics: {'avg_train_loss': 0.07948346230409226, 'avg_test_loss': 0.13295372513433298}
INFO:model_data_nn.py:Epoch 10/40, metrics: {'avg_train_loss': 0.07981176943919523, 'avg_test_loss': 0.134487440266336}
INFO:model_data_nn.py:Epoch 11/40, metrics: {'avg_train_loss': 0.07993814060607522, 'avg_test_loss': 0.13390806643292308}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main.py:Making prediction for data in year: 1998
INFO:main.py:Prediction data shape: (24412,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1998: 0.36616773542811026
INFO:main.py:Prediction Stats:                retq          pred
count  24412.000000  24412.000000
mean       0.004293      0.041572
std        0.368725      0.027821
min       -0.979592     -0.091161
25%       -0.186753      0.026536
50%       -0.017392      0.033816
75%        0.131659      0.046657
max       10.538459      0.336021
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:transform_data_nn.py:Train_data: (283173, 161)

INFO:transform_data_nn.py:Test data years: [1998]
INFO:transform_data_nn.py:Test_data: (24412, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Retrain_data: (307585, 161)

INFO:transform_data_nn.py:Prediction data years: [1999]
INFO:transform_data_nn.py:Prediction_data: (23257, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([283173, 152])
            y_train_tf: torch.Size([283173])

            x_test_tf: torch.Size([24412, 152])
            y_test_tf: torch.Size([24412])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([307585, 152])
            y_retrain_tf: torch.Size([307585])

            x_prediction_tf: torch.Size([23257, 152])
            y_prediction_tf: torch.Size([23257])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.4875e-01,  7.2061e-01,  7.2912e-02, -1.2606e+00, -1.4886e-01,
        -7.3204e-01, -1.6850e-01, -3.6069e-01,  4.2156e-01, -1.6996e-01,
        -6.8732e-01,  6.2069e-02, -4.9929e-01, -3.5319e-01,  1.1656e-01,
         4.9707e-01, -1.4139e-01,  2.4484e-01, -4.3315e-02,  4.8274e-01,
        -3.5553e-01,  1.5676e-02, -4.0194e-02, -3.8391e-03, -5.8610e-02,
        -2.7463e-01, -5.8303e-01, -1.6828e-02,  2.8067e-01,  1.2710e+00,
         3.8739e-01, -1.1953e-01,  4.8341e-01, -4.5972e-02, -3.1644e-01,
        -2.1355e-01,  7.1828e-02,  6.2033e-01, -1.9624e-02, -1.1225e+00,
        -3.0338e-01,  2.7821e-01,  2.4991e-01, -5.3326e-02, -1.7550e-01,
        -7.1020e-01,  7.6894e-02, -5.2911e-02, -4.1289e-01, -1.9440e-01,
        -7.6091e-01,  5.9169e-01, -9.4990e-02, -1.2033e-02, -1.4167e-02,
         4.2622e-01, -6.8477e-01,  8.1612e-02, -2.6019e-01, -1.7514e-02,
         1.2912e-01, -3.1628e-01,  1.3074e-01,  2.5888e-01,  1.0887e-01,
        -1.6674e-01,  4.0211e-01, -1.2470e-01,  6.6961e-01, -4.1523e-01,
        -2.6985e-01, -6.1165e-02, -9.8828e-04, -8.4282e-01,  1.5168e-01,
         6.5720e-01,  1.5584e-02, -3.7219e-01, -1.8143e-01,  5.0605e-03,
        -1.8819e-03,  2.0476e-01,  1.2074e-01, -3.1400e-01, -5.6006e-01,
        -1.3345e-01, -1.1882e-01, -2.9322e-01,  7.9855e-03,  1.7296e-01,
        -5.2195e-01, -1.2660e+00,  1.6970e-02,  1.7147e+00,  2.3702e+00,
         2.4034e+00, -7.6860e-03,  2.0941e+00, -3.0161e+00,  5.8447e-01,
        -8.6387e-01,  1.0094e-01, -3.3009e-01,  6.7510e-02,  2.8525e-01,
         1.5178e-01,  4.9893e-02,  3.3440e-01,  0.0000e+00, -1.4748e+00,
         8.9989e-01, -2.5525e+00,  1.5741e-01,  8.5457e-03,  0.0000e+00,
        -1.8565e-02,  1.2020e-01, -1.8193e-01,  1.3378e-02, -1.0678e-01,
         1.0540e-01, -3.8029e-01, -3.4150e-01,  2.8398e-01,  2.9023e-01,
        -4.1761e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([9386]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-4.9754e-01,  4.5230e-01, -7.9629e-01,  1.2705e+00, -3.4419e-02,
        -8.0852e-01, -1.2732e+00, -8.7504e-01, -3.5972e-01, -1.0120e-01,
        -7.5125e-01,  1.0637e-02, -4.6192e+00, -1.6720e-01, -4.3450e-01,
         1.6455e-01, -1.7177e-01, -1.1868e-02, -4.3315e-02,  1.0907e+00,
         1.4642e-01, -6.0401e-02, -4.8681e-02, -1.6256e-01, -6.2277e-02,
        -4.3124e-01, -6.4073e-01, -1.6828e-02, -1.2184e+00,  8.5124e-01,
        -1.3525e-01, -1.9557e-01,  2.3175e-01, -4.5972e-02, -7.8088e-01,
        -3.9932e-01, -2.3895e-01, -6.1120e-01, -2.4745e-01, -9.0022e-01,
        -2.2962e-01,  1.3594e-01,  3.5618e-01, -1.5770e-01, -5.3546e-02,
        -6.5398e-01, -5.5200e-02,  2.5113e-01, -2.6188e-01,  2.1419e-02,
         9.0682e-03, -7.2800e-01, -6.8018e-01, -5.6584e-01, -7.3715e-01,
         2.8444e-01, -1.0327e+00, -1.4410e-01,  1.2377e+00, -4.4250e-01,
        -1.9594e-02,  3.1610e-01, -1.1760e+00,  5.3322e-01,  1.1959e-03,
        -7.9654e-01,  4.2208e-01,  1.3068e+00, -2.0039e+00, -4.5196e-01,
        -2.6985e-01, -6.1165e-02, -9.8828e-04, -7.6262e-01,  5.3793e-02,
         1.4250e-02,  5.2743e+00, -3.4692e-01, -4.9553e-03,  5.0605e-03,
        -1.8819e-03,  9.3164e-02, -2.2469e-01,  1.1796e+00,  3.0917e-01,
        -1.1656e-01, -1.0947e-01, -3.6519e-01, -6.1414e-01,  1.1825e-03,
        -2.3899e-01, -6.9905e-01,  1.6970e-02, -2.2883e+00, -1.4159e+00,
        -1.2488e+00,  2.3878e-01, -5.0993e-01, -9.9969e-01, -1.1059e+00,
         8.7936e-01,  5.0583e-01, -3.3009e-01,  3.3646e+00,  2.8525e-01,
         1.5399e+00,  2.3916e-02,  9.1798e-01,  0.0000e+00,  4.0425e-01,
        -6.9032e-01,  1.3071e+00,  1.2843e-01,  1.3725e+00,  0.0000e+00,
        -1.8565e-02, -5.1438e-02, -1.3765e-01, -3.7524e+00,  7.0168e-01,
        -3.1048e-01, -4.7103e-01, -4.3587e-01,  1.6012e-01,  2.3185e-01,
        -4.0248e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2456]), tensor(-0.0156))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-0.1509,  0.7440,  0.0739, -1.2498, -0.1583, -0.7484, -0.1661, -0.3605,
         0.4437, -0.1689, -0.6865,  0.0739, -0.5083, -0.3612,  0.1127,  0.4919,
        -0.1471,  0.2453, -0.0326,  0.4865, -0.3329,  0.0062, -0.0411, -0.0063,
        -0.0596, -0.2770, -0.5903, -0.0243,  0.2523,  1.3025,  0.3879, -0.1208,
         0.4900, -0.0370, -0.3052, -0.2211,  0.0571,  0.6507, -0.0367, -1.1276,
        -0.3000,  0.2835,  0.2404, -0.0413, -0.1868, -0.7212,  0.0792, -0.0531,
        -0.4181, -0.1738, -0.7727,  0.5697, -0.0804, -0.0112, -0.0218,  0.4249,
        -0.6743,  0.0835, -0.2571, -0.0244,  0.1277, -0.3128,  0.1321,  0.2572,
         0.1087, -0.1698,  0.4162, -0.1267,  0.6665, -0.4178, -0.2836, -0.0720,
        -0.0133, -0.8554,  0.1637,  0.6658,  0.0178, -0.3752, -0.1796,  0.0047,
        -0.0033,  0.1852,  0.1404, -0.3015, -0.5638, -0.1380, -0.1245, -0.2873,
         0.0166,  0.1728, -0.5317, -1.2685,  0.0185,  1.6282,  2.3471,  2.4638,
        -0.0452,  2.2006, -2.9314,  0.6653, -0.6964,  0.0989, -0.1149,  0.0153,
         0.3349,  0.1291,  0.0518,  0.2270,  0.0000, -1.5009,  0.9768, -2.5665,
         0.1609,  0.0047,  0.0000, -0.0273,  0.1423, -0.1884, -0.0187, -0.1151,
         0.1141, -0.3668, -0.3363,  0.2919,  0.2945, -0.4157,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([9974]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-2.4279e-01, -5.4056e-01, -3.7466e-01,  1.3921e+00, -3.4530e-01,
        -8.1114e-01, -1.6376e+00, -9.1233e-01, -3.5750e-01, -3.1677e-01,
        -7.4018e-01,  2.4990e-02, -1.1498e+00,  6.9382e-01,  2.6771e-01,
         4.5418e-01, -1.8631e-01, -3.0621e-01,  1.3363e-01, -8.3417e-01,
         3.2863e-01, -6.1122e-02, -3.8941e-02, -5.3512e-02, -1.3785e-01,
        -4.2425e-01, -6.3906e-01, -2.4296e-02, -8.5865e-01,  8.6023e-01,
         3.1274e-01, -1.6124e-01,  2.5772e-01, -2.2774e+00, -7.4574e-01,
        -4.0902e-01, -4.6274e-01, -5.9875e-01, -7.1793e-01, -1.0732e+00,
        -2.4376e-01, -5.9177e-01, -5.9555e-01, -1.6706e-01, -3.2865e-01,
        -7.9236e-01, -1.0617e-01,  1.7908e-01, -3.3487e-01,  1.4255e-01,
         7.7668e-01, -7.0627e-01, -7.1038e-01, -5.5264e-01, -7.3689e-01,
         3.2908e-01, -1.0253e+00, -9.0320e-02, -1.1286e-01, -1.8251e-01,
        -5.3808e-03,  3.2517e-01,  7.9990e-01, -7.9642e-01, -1.0776e-03,
         6.7643e-01, -3.7252e-01,  4.9175e-01,  6.6652e-01, -3.8839e-01,
        -2.8357e-01, -7.1964e-02, -1.3280e-02, -7.9567e-01,  7.6774e-02,
         7.0727e-01,  1.6970e+00, -2.8202e-01, -1.4733e-01,  4.6881e-03,
         1.1976e-01,  5.9480e-02, -1.5375e-01,  4.9903e-01, -5.1187e-02,
        -1.2330e-01, -1.1638e-01, -3.5442e-01, -5.4464e-01,  1.8507e-01,
        -3.9372e-01,  1.6076e-01,  1.8480e-02, -2.3308e+00, -2.0402e+00,
        -1.1560e+00,  4.3587e-01, -7.7550e-01, -7.9302e-01, -2.6511e-02,
         1.1223e+00, -5.6112e-01, -1.1486e-01,  1.8025e+00,  3.3495e-01,
         2.7049e+00,  2.8338e-02,  4.0988e-01,  0.0000e+00, -1.3899e+00,
        -4.1890e-01,  1.0006e+00,  1.2894e-01,  2.7026e+00,  0.0000e+00,
        -2.7314e-02,  4.5218e-02, -2.3823e-01, -3.6706e+00,  6.3616e-01,
         9.8503e-01, -2.8688e-01, -3.9455e-01,  2.0078e-01,  2.6829e-01,
        -4.0594e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2385]), tensor(-0.0790))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:main.py:Testing data year: 1998
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 11533
            device: cpu
            
2024-07-16 01:36:25,406	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 01:36:25,453	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 01:36:25,496	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 01:36:25,501	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 01:36:27,730	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 01:40:27,350	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_01-36-27' in 0.1302s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 11533, 'embedding_dim': 25, 'dropout_rate': 0.18, 'lr': 0.05, 'weight_decay': 0.0001251605833757037, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.08069222966964544
INFO:model_data_nn.py:Best trial testing loss: 0.13484102693231156
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_01-36-23_106028_1361901/artifacts/2024-07-16_01-36-27/train_fnn_2024-07-16_01-36-27/driver_artifacts/train_fnn_7e4d8_00037_37_dropout_rate=0.1800,embedding_dim=25,hidden_dim=25,lr=0.0500,num_layers=1,weight_decay=0.0001_2024-07-16_01-36-27
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 12245, 'embedding_dim': 25, 'dropout_rate': 0.18, 'lr': 0.05, 'weight_decay': 0.0001251605833757037, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 1.224672808003505, 'avg_test_loss': 0.25723671425993627}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.08792473222694659, 'avg_test_loss': 0.2582317788031075}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.08724017636215131, 'avg_test_loss': 0.2572909030694883}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.08486712571487649, 'avg_test_loss': 0.26028831900803595}
INFO:model_data_nn.py:Early stopping at epoch 4
INFO:main.py:Making prediction for data in year: 1999
INFO:main.py:Prediction data shape: (23257,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1999: 0.5097134812459133
INFO:main.py:Prediction Stats:                retq          pred
count  23257.000000  23257.000000
mean       0.079897      0.012365
std        0.505723      0.053475
min       -0.980932     -0.401707
25%       -0.147059      0.000469
50%        0.000000      0.016106
75%        0.177420      0.034734
max       16.624997      0.411960
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Train_data: (307585, 161)

INFO:transform_data_nn.py:Test data years: [1999]
INFO:transform_data_nn.py:Test_data: (23257, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:transform_data_nn.py:Retrain_data: (330842, 161)

INFO:transform_data_nn.py:Prediction data years: [2000]
INFO:transform_data_nn.py:Prediction_data: (22167, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([307585, 152])
            y_train_tf: torch.Size([307585])

            x_test_tf: torch.Size([23257, 152])
            y_test_tf: torch.Size([23257])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([330842, 152])
            y_retrain_tf: torch.Size([330842])

            x_prediction_tf: torch.Size([22167, 152])
            y_prediction_tf: torch.Size([22167])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-0.1509,  0.7440,  0.0739, -1.2498, -0.1583, -0.7484, -0.1661, -0.3605,
         0.4437, -0.1689, -0.6865,  0.0739, -0.5083, -0.3612,  0.1127,  0.4919,
        -0.1471,  0.2453, -0.0326,  0.4865, -0.3329,  0.0062, -0.0411, -0.0063,
        -0.0596, -0.2770, -0.5903, -0.0243,  0.2523,  1.3025,  0.3879, -0.1208,
         0.4900, -0.0370, -0.3052, -0.2211,  0.0571,  0.6507, -0.0367, -1.1276,
        -0.3000,  0.2835,  0.2404, -0.0413, -0.1868, -0.7212,  0.0792, -0.0531,
        -0.4181, -0.1738, -0.7727,  0.5697, -0.0804, -0.0112, -0.0218,  0.4249,
        -0.6743,  0.0835, -0.2571, -0.0244,  0.1277, -0.3128,  0.1321,  0.2572,
         0.1087, -0.1698,  0.4162, -0.1267,  0.6665, -0.4178, -0.2836, -0.0720,
        -0.0133, -0.8554,  0.1637,  0.6658,  0.0178, -0.3752, -0.1796,  0.0047,
        -0.0033,  0.1852,  0.1404, -0.3015, -0.5638, -0.1380, -0.1245, -0.2873,
         0.0166,  0.1728, -0.5317, -1.2685,  0.0185,  1.6282,  2.3471,  2.4638,
        -0.0452,  2.2006, -2.9314,  0.6653, -0.6964,  0.0989, -0.1149,  0.0153,
         0.3349,  0.1291,  0.0518,  0.2270,  0.0000, -1.5009,  0.9768, -2.5665,
         0.1609,  0.0047,  0.0000, -0.0273,  0.1423, -0.1884, -0.0187, -0.1151,
         0.1141, -0.3668, -0.3363,  0.2919,  0.2945, -0.4157,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([9974]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-2.4279e-01, -5.4056e-01, -3.7466e-01,  1.3921e+00, -3.4530e-01,
        -8.1114e-01, -1.6376e+00, -9.1233e-01, -3.5750e-01, -3.1677e-01,
        -7.4018e-01,  2.4990e-02, -1.1498e+00,  6.9382e-01,  2.6771e-01,
         4.5418e-01, -1.8631e-01, -3.0621e-01,  1.3363e-01, -8.3417e-01,
         3.2863e-01, -6.1122e-02, -3.8941e-02, -5.3512e-02, -1.3785e-01,
        -4.2425e-01, -6.3906e-01, -2.4296e-02, -8.5865e-01,  8.6023e-01,
         3.1274e-01, -1.6124e-01,  2.5772e-01, -2.2774e+00, -7.4574e-01,
        -4.0902e-01, -4.6274e-01, -5.9875e-01, -7.1793e-01, -1.0732e+00,
        -2.4376e-01, -5.9177e-01, -5.9555e-01, -1.6706e-01, -3.2865e-01,
        -7.9236e-01, -1.0617e-01,  1.7908e-01, -3.3487e-01,  1.4255e-01,
         7.7668e-01, -7.0627e-01, -7.1038e-01, -5.5264e-01, -7.3689e-01,
         3.2908e-01, -1.0253e+00, -9.0320e-02, -1.1286e-01, -1.8251e-01,
        -5.3808e-03,  3.2517e-01,  7.9990e-01, -7.9642e-01, -1.0776e-03,
         6.7643e-01, -3.7252e-01,  4.9175e-01,  6.6652e-01, -3.8839e-01,
        -2.8357e-01, -7.1964e-02, -1.3280e-02, -7.9567e-01,  7.6774e-02,
         7.0727e-01,  1.6970e+00, -2.8202e-01, -1.4733e-01,  4.6881e-03,
         1.1976e-01,  5.9480e-02, -1.5375e-01,  4.9903e-01, -5.1187e-02,
        -1.2330e-01, -1.1638e-01, -3.5442e-01, -5.4464e-01,  1.8507e-01,
        -3.9372e-01,  1.6076e-01,  1.8480e-02, -2.3308e+00, -2.0402e+00,
        -1.1560e+00,  4.3587e-01, -7.7550e-01, -7.9302e-01, -2.6511e-02,
         1.1223e+00, -5.6112e-01, -1.1486e-01,  1.8025e+00,  3.3495e-01,
         2.7049e+00,  2.8338e-02,  4.0988e-01,  0.0000e+00, -1.3899e+00,
        -4.1890e-01,  1.0006e+00,  1.2894e-01,  2.7026e+00,  0.0000e+00,
        -2.7314e-02,  4.5218e-02, -2.3823e-01, -3.6706e+00,  6.3616e-01,
         9.8503e-01, -2.8688e-01, -3.9455e-01,  2.0078e-01,  2.6829e-01,
        -4.0594e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2385]), tensor(-0.0790))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-0.1517,  0.7643,  0.0741, -1.2420, -0.1630, -0.7659, -0.1644, -0.3590,
         0.4438, -0.1655, -0.6851,  0.0833, -0.5092, -0.3713,  0.1118,  0.4894,
        -0.1436,  0.2420, -0.0348,  0.4922, -0.3416,  0.0049, -0.0404, -0.0039,
        -0.0545, -0.2778, -0.5963, -0.0290,  0.2277,  1.3229,  0.3730, -0.1190,
         0.4949, -0.0264, -0.2939, -0.2278,  0.0436,  0.6775, -0.0490, -1.1350,
        -0.2977,  0.3173,  0.2359, -0.0378, -0.1943, -0.7313,  0.0980, -0.0503,
        -0.4175, -0.1673, -0.7843,  0.5522, -0.0630, -0.0116, -0.0237,  0.4228,
        -0.6646,  0.0795, -0.2531, -0.0328,  0.1284, -0.3086,  0.1336,  0.2554,
         0.1134, -0.1725,  0.4281, -0.1310,  0.6667, -0.4198, -0.2946, -0.0809,
        -0.0220, -0.8696,  0.1742,  0.6666,  0.0194, -0.3778, -0.1779,  0.0063,
        -0.0066,  0.1756,  0.1491, -0.2889, -0.5626, -0.1416, -0.1292, -0.2838,
         0.0285,  0.1826, -0.5358, -1.2721,  0.0191,  1.5680,  2.2776,  2.5200,
        -0.0780,  2.2929, -2.9799,  0.7094, -0.7643,  0.0997, -0.1145,  0.0057,
         0.3502,  0.1574,  0.0542,  0.2523,  0.0000, -1.4063,  1.0355, -2.5828,
         0.1644,  0.0092,  0.0000, -0.0067,  0.1611, -0.1942, -0.0167, -0.1234,
         0.1210, -0.3549, -0.3292,  0.2991,  0.2976, -0.4133,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([10466]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-1.7463e-02, -6.8208e-01, -5.1292e-01,  1.5087e+00, -2.6048e-01,
        -8.0411e-01, -1.6087e+00, -9.1082e-01, -2.2046e-01, -2.4390e-01,
        -6.8325e-01,  3.3706e-02, -3.0564e-01,  9.8559e-01,  5.3074e-01,
         6.0774e-01, -2.2486e-01,  1.4532e-01,  7.0841e-02, -9.6938e-01,
         1.8550e-01, -6.4694e-02, -4.3657e-02, -5.4047e-02,  4.0327e-02,
        -4.7776e-01, -6.5774e-01, -2.8979e-02, -8.9603e-01,  1.1710e+00,
        -4.1486e-02, -1.5411e-01,  2.9379e-01, -2.2267e+00, -7.8194e-01,
        -2.8490e-01, -1.8904e-01, -5.4945e-01, -1.7000e-01, -1.1194e+00,
        -4.3445e-02, -3.1549e-01, -3.6533e-01, -9.9723e-02, -2.6630e-01,
        -3.6560e-01, -3.6423e-01, -8.0028e-02, -4.8426e-02, -1.1814e-01,
         7.7213e-01, -7.7487e-01, -5.6102e-01, -5.4456e-01, -7.3591e-01,
         2.6051e-01, -1.0184e+00,  1.2153e-01, -4.1426e-01, -4.3467e-01,
        -1.7693e-01, -1.1241e-01,  1.0690e+00,  1.0657e-01,  2.6272e-04,
         1.3289e+00, -4.8393e-01,  2.0586e+00,  6.6670e-01, -3.8214e-01,
        -2.9457e-01, -8.0898e-02, -2.2006e-02, -4.1936e-01,  7.0712e-02,
         7.8962e-01,  5.5825e-02, -1.0734e-01, -1.5332e-01,  6.2512e-03,
         1.2375e-01,  8.8372e-02,  3.8248e-02,  2.4160e-01, -5.7003e-01,
        -1.3262e-01, -1.2374e-01, -3.0045e-01, -5.1220e-01, -3.7390e-01,
        -5.9571e-01, -1.1923e-01,  1.9131e-02, -2.2531e+00, -1.5614e+00,
        -1.1678e+00,  3.0509e-01, -4.1689e-01, -3.4242e-01, -8.5690e-01,
        -3.2235e-01, -9.6125e-01, -1.1448e-01,  8.6509e-01,  3.5022e-01,
         1.9737e+00,  3.2488e-02, -1.0175e+00,  0.0000e+00, -6.5791e-01,
         4.5432e-02,  1.3014e+00,  1.1926e-01,  5.0540e+00,  0.0000e+00,
        -6.7208e-03, -1.5726e-01, -2.2692e-01, -3.6150e+00,  6.4678e-01,
         1.4428e-01, -1.0529e-01, -4.0449e-01,  2.0893e-01,  2.7106e-01,
        -4.2404e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00]), tensor([2268]), tensor(-0.0447))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:main.py:Testing data year: 1999
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 12245
            device: cpu
            
2024-07-16 02:21:10,161	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 02:21:10,203	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 02:21:10,239	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 02:21:10,244	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 02:21:12,451	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 02:26:47,072	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_02-21-12' in 0.1458s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 12245, 'embedding_dim': 15, 'dropout_rate': 0.37, 'lr': 0.05, 'weight_decay': 0.0004986865424754641, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.08683794134369309
INFO:model_data_nn.py:Best trial testing loss: 0.2571834874349636
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_02-21-07_969756_1361901/artifacts/2024-07-16_02-21-12/train_fnn_2024-07-16_02-21-12/driver_artifacts/train_fnn_be856_00016_16_dropout_rate=0.3700,embedding_dim=15,hidden_dim=25,lr=0.0500,num_layers=1,weight_decay=0.0005_2024-07-16_02-21-12
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 12852, 'embedding_dim': 15, 'dropout_rate': 0.37, 'lr': 0.05, 'weight_decay': 0.0004986865424754641, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 0.7383042886040742, 'avg_test_loss': 0.21129831500437068}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.09908939456626231, 'avg_test_loss': 0.2121586486183364}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.09686033003614195, 'avg_test_loss': 0.21015615101860857}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.09649589216971895, 'avg_test_loss': 0.20386790047431813}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.09667229403763987, 'avg_test_loss': 0.20351489740370335}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.09667320554385975, 'avg_test_loss': 0.20854374886244192}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.11299785361996198, 'avg_test_loss': 0.2862057464903799}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.09917274509878557, 'avg_test_loss': 0.20592779152352234}
INFO:model_data_nn.py:Early stopping at epoch 8
INFO:main.py:Making prediction for data in year: 2000
INFO:main.py:Prediction data shape: (22167,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2000: 0.45360801399528883
INFO:main.py:Prediction Stats:                retq          pred
count  22167.000000  22167.000000
mean      -0.000670      0.028331
std        0.453416      0.027803
min       -0.980000     -0.252082
25%       -0.222436      0.016124
50%       -0.022528      0.025035
75%        0.141851      0.036235
max       10.941179      0.894025
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:transform_data_nn.py:Train_data: (330842, 161)

INFO:transform_data_nn.py:Test data years: [2000]
INFO:transform_data_nn.py:Test_data: (22167, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:transform_data_nn.py:Retrain_data: (353009, 161)

INFO:transform_data_nn.py:Prediction data years: [2001]
INFO:transform_data_nn.py:Prediction_data: (21485, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([330842, 152])
            y_train_tf: torch.Size([330842])

            x_test_tf: torch.Size([22167, 152])
            y_test_tf: torch.Size([22167])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([353009, 152])
            y_retrain_tf: torch.Size([353009])

            x_prediction_tf: torch.Size([21485, 152])
            y_prediction_tf: torch.Size([21485])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-0.1517,  0.7643,  0.0741, -1.2420, -0.1630, -0.7659, -0.1644, -0.3590,
         0.4438, -0.1655, -0.6851,  0.0833, -0.5092, -0.3713,  0.1118,  0.4894,
        -0.1436,  0.2420, -0.0348,  0.4922, -0.3416,  0.0049, -0.0404, -0.0039,
        -0.0545, -0.2778, -0.5963, -0.0290,  0.2277,  1.3229,  0.3730, -0.1190,
         0.4949, -0.0264, -0.2939, -0.2278,  0.0436,  0.6775, -0.0490, -1.1350,
        -0.2977,  0.3173,  0.2359, -0.0378, -0.1943, -0.7313,  0.0980, -0.0503,
        -0.4175, -0.1673, -0.7843,  0.5522, -0.0630, -0.0116, -0.0237,  0.4228,
        -0.6646,  0.0795, -0.2531, -0.0328,  0.1284, -0.3086,  0.1336,  0.2554,
         0.1134, -0.1725,  0.4281, -0.1310,  0.6667, -0.4198, -0.2946, -0.0809,
        -0.0220, -0.8696,  0.1742,  0.6666,  0.0194, -0.3778, -0.1779,  0.0063,
        -0.0066,  0.1756,  0.1491, -0.2889, -0.5626, -0.1416, -0.1292, -0.2838,
         0.0285,  0.1826, -0.5358, -1.2721,  0.0191,  1.5680,  2.2776,  2.5200,
        -0.0780,  2.2929, -2.9799,  0.7094, -0.7643,  0.0997, -0.1145,  0.0057,
         0.3502,  0.1574,  0.0542,  0.2523,  0.0000, -1.4063,  1.0355, -2.5828,
         0.1644,  0.0092,  0.0000, -0.0067,  0.1611, -0.1942, -0.0167, -0.1234,
         0.1210, -0.3549, -0.3292,  0.2991,  0.2976, -0.4133,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([10466]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-1.7463e-02, -6.8208e-01, -5.1292e-01,  1.5087e+00, -2.6048e-01,
        -8.0411e-01, -1.6087e+00, -9.1082e-01, -2.2046e-01, -2.4390e-01,
        -6.8325e-01,  3.3706e-02, -3.0564e-01,  9.8559e-01,  5.3074e-01,
         6.0774e-01, -2.2486e-01,  1.4532e-01,  7.0841e-02, -9.6938e-01,
         1.8550e-01, -6.4694e-02, -4.3657e-02, -5.4047e-02,  4.0327e-02,
        -4.7776e-01, -6.5774e-01, -2.8979e-02, -8.9603e-01,  1.1710e+00,
        -4.1486e-02, -1.5411e-01,  2.9379e-01, -2.2267e+00, -7.8194e-01,
        -2.8490e-01, -1.8904e-01, -5.4945e-01, -1.7000e-01, -1.1194e+00,
        -4.3445e-02, -3.1549e-01, -3.6533e-01, -9.9723e-02, -2.6630e-01,
        -3.6560e-01, -3.6423e-01, -8.0028e-02, -4.8426e-02, -1.1814e-01,
         7.7213e-01, -7.7487e-01, -5.6102e-01, -5.4456e-01, -7.3591e-01,
         2.6051e-01, -1.0184e+00,  1.2153e-01, -4.1426e-01, -4.3467e-01,
        -1.7693e-01, -1.1241e-01,  1.0690e+00,  1.0657e-01,  2.6272e-04,
         1.3289e+00, -4.8393e-01,  2.0586e+00,  6.6670e-01, -3.8214e-01,
        -2.9457e-01, -8.0898e-02, -2.2006e-02, -4.1936e-01,  7.0712e-02,
         7.8962e-01,  5.5825e-02, -1.0734e-01, -1.5332e-01,  6.2512e-03,
         1.2375e-01,  8.8372e-02,  3.8248e-02,  2.4160e-01, -5.7003e-01,
        -1.3262e-01, -1.2374e-01, -3.0045e-01, -5.1220e-01, -3.7390e-01,
        -5.9571e-01, -1.1923e-01,  1.9131e-02, -2.2531e+00, -1.5614e+00,
        -1.1678e+00,  3.0509e-01, -4.1689e-01, -3.4242e-01, -8.5690e-01,
        -3.2235e-01, -9.6125e-01, -1.1448e-01,  8.6509e-01,  3.5022e-01,
         1.9737e+00,  3.2488e-02, -1.0175e+00,  0.0000e+00, -6.5791e-01,
         4.5432e-02,  1.3014e+00,  1.1926e-01,  5.0540e+00,  0.0000e+00,
        -6.7208e-03, -1.5726e-01, -2.2692e-01, -3.6150e+00,  6.4678e-01,
         1.4428e-01, -1.0529e-01, -4.0449e-01,  2.0893e-01,  2.7106e-01,
        -4.2404e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00]), tensor([2268]), tensor(-0.0447))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.5170e-01,  7.8169e-01,  7.9342e-02, -1.2365e+00, -1.6841e-01,
        -7.8872e-01, -1.6086e-01, -3.5673e-01,  4.3400e-01, -1.6062e-01,
        -6.8302e-01,  9.1437e-02, -5.0654e-01, -3.8443e-01,  1.1169e-01,
         4.8542e-01, -1.4517e-01,  2.4144e-01, -3.5083e-02,  5.0189e-01,
        -3.2631e-01,  2.2627e-03, -3.7241e-02, -5.7087e-03, -4.9664e-02,
        -2.7789e-01, -5.9548e-01, -3.0669e-02,  1.9746e-01,  1.3382e+00,
         3.6286e-01, -1.2000e-01,  4.9758e-01, -3.5242e-02, -2.8389e-01,
        -2.2792e-01,  3.7222e-02,  6.9911e-01, -5.3938e-02, -1.1400e+00,
        -2.9416e-01,  2.5646e-01,  2.4021e-01, -4.1841e-02, -1.9822e-01,
        -7.4495e-01,  8.4166e-02, -5.5735e-02, -4.0163e-01, -1.6177e-01,
        -7.9419e-01,  5.3171e-01, -4.3740e-02, -9.5275e-03, -2.6106e-02,
         4.2102e-01, -6.5470e-01,  7.9345e-02, -2.5267e-01, -4.1140e-02,
         1.2773e-01, -3.0794e-01,  1.2879e-01,  2.5580e-01,  1.1144e-01,
        -1.8088e-01,  4.3880e-01, -1.3207e-01,  6.6354e-01, -4.2059e-01,
        -3.0142e-01, -2.3224e-02, -2.3187e-02, -8.8797e-01,  1.8281e-01,
         6.6443e-01,  2.1081e-02, -3.8111e-01, -1.7609e-01,  5.5197e-03,
        -3.3395e-03,  1.6638e-01,  1.5014e-01, -2.6760e-01, -5.6123e-01,
        -1.4502e-01, -1.3371e-01, -2.7933e-01,  4.1315e-02,  1.9152e-01,
        -5.3593e-01, -1.2752e+00,  1.9779e-02,  1.5375e+00,  2.3052e+00,
         2.5731e+00, -8.0186e-02,  2.3788e+00, -2.8994e+00,  7.6530e-01,
        -7.7655e-01,  1.0315e-01, -6.5651e-02,  5.4512e-02,  2.1990e-01,
         1.5332e-01,  5.3323e-02,  2.6708e-01,  0.0000e+00, -1.4434e+00,
         9.0323e-01, -2.6043e+00,  1.6773e-01,  3.7569e-04, -3.4438e-01,
         1.5154e-02,  1.7938e-01, -1.9686e-01, -5.1633e-02, -1.2949e-01,
         1.2043e-01, -3.4192e-01, -3.2717e-01,  3.0505e-01,  2.9974e-01,
        -4.1218e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([10879]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-7.8114e-01,  2.9078e-01, -2.6587e-01,  1.6201e+00, -1.3885e-01,
        -6.3873e-01, -1.6337e+00, -9.0372e-01, -2.8292e-01, -5.2687e-01,
        -7.4509e-01,  4.3381e-02, -2.0238e-02,  3.0761e-02, -4.9230e-01,
         6.2448e-01, -2.2009e-01,  9.7809e-02,  2.9115e-01,  3.1294e-01,
         5.2929e-01, -6.0036e-02, -4.0250e-02,  3.9724e-01,  1.5292e-02,
        -5.1123e-01, -6.5124e-01, -3.0669e-02, -8.6758e-01,  1.0285e+00,
         4.2996e-02, -1.3328e-01,  2.8588e-01, -2.1762e+00, -7.4250e-01,
        -1.8188e-01, -7.4501e-02, -4.8264e-01, -2.4550e-01, -1.1541e+00,
        -2.2444e-01,  1.0381e-01,  1.2773e-01, -1.1210e-01, -1.7610e-01,
        -7.0901e-01,  6.1741e-02,  1.6879e-01, -3.2922e-01,  4.3904e-01,
        -7.9419e-01, -7.1193e-01, -7.8809e-01, -5.3828e-01, -7.3540e-01,
         3.0973e-01, -1.0111e+00,  1.3383e-01, -3.5705e-01, -1.2404e-01,
         9.4415e-04, -3.8743e-01, -2.1083e-01,  4.4077e-01, -1.7325e-03,
        -3.9360e-01,  2.4403e-01,  3.5432e-01,  6.6354e-01, -4.2389e-01,
        -3.0142e-01, -2.3224e-02, -2.3187e-02, -6.3793e-01,  9.2474e-02,
         7.7075e-01,  2.2561e-03, -1.5449e-01, -8.9974e-02,  5.5197e-03,
         1.2261e-01,  3.2050e-01,  1.6015e-01, -2.3159e-02, -5.9930e-01,
        -1.3706e-01, -1.2925e-01, -3.5632e-01, -6.0520e-01, -1.3039e-01,
        -6.2087e-01,  1.4415e-03,  1.9779e-02, -1.7158e+00, -1.0605e+00,
        -1.0689e+00, -7.6335e-01, -1.8129e-01, -1.6174e+00, -4.3010e-01,
         2.2089e+00,  5.6988e-01, -6.5651e-02, -9.3425e-02,  2.1990e-01,
         8.1181e-01,  5.3960e-02,  1.4850e+00,  0.0000e+00,  3.7240e+00,
         3.0207e+00,  5.8686e-01,  1.2117e-01,  8.1395e+00, -3.4438e-01,
         1.5154e-02, -1.2073e-01, -1.4820e-01, -3.5350e+00,  6.5671e-01,
        -9.0136e-01,  1.8755e-01, -3.8519e-01,  2.1452e-01,  2.8088e-01,
        -4.2366e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2271]), tensor(0.0385))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:main.py:Testing data year: 2000
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 12852
            device: cpu
            
2024-07-16 03:10:49,728	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 03:10:49,775	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 03:10:49,816	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 03:10:49,821	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 03:10:52,171	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 03:15:36,219	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_03-10-52' in 0.1338s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 4, 'num_embeddings': 12852, 'embedding_dim': 5, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 5.891087281171031e-05, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.09718750537087174
INFO:model_data_nn.py:Best trial testing loss: 0.2073817208580587
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_03-10-47_324756_1361901/artifacts/2024-07-16_03-10-52/train_fnn_2024-07-16_03-10-52/driver_artifacts/train_fnn_ae92a_00044_44_dropout_rate=0.5200,embedding_dim=5,hidden_dim=25,lr=0.0100,num_layers=4,weight_decay=0.0001_2024-07-16_03-10-52
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 4, 'num_embeddings': 13377, 'embedding_dim': 5, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 5.891087281171031e-05, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 2.233624790982222, 'avg_test_loss': 0.20240592938803492}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.10711704635151147, 'avg_test_loss': 0.20155229774259387}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.1086953982678421, 'avg_test_loss': 0.20140893890389375}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.10946574958447877, 'avg_test_loss': 0.20146376581951267}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.10840334833219399, 'avg_test_loss': 0.20006912308079855}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.10701606167916633, 'avg_test_loss': 0.2015693062206819}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.1053352621643979, 'avg_test_loss': 0.20154155826284773}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.1036063228113181, 'avg_test_loss': 0.20428808955919175}
INFO:model_data_nn.py:Early stopping at epoch 8
INFO:main.py:Making prediction for data in year: 2001
INFO:main.py:Prediction data shape: (21485,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2001: 0.4514440446614721
INFO:main.py:Prediction Stats:                retq          pred
count  21485.000000  21485.000000
mean       0.078995      0.010739
std        0.448298      0.047585
min       -0.977966     -0.500261
25%       -0.138629      0.006143
50%        0.023648      0.009454
75%        0.215909      0.013948
max        7.399999      1.441456
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:transform_data_nn.py:Train_data: (353009, 161)

INFO:transform_data_nn.py:Test data years: [2001]
INFO:transform_data_nn.py:Test_data: (21485, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:transform_data_nn.py:Retrain_data: (374494, 161)

INFO:transform_data_nn.py:Prediction data years: [2002]
INFO:transform_data_nn.py:Prediction_data: (20629, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([353009, 152])
            y_train_tf: torch.Size([353009])

            x_test_tf: torch.Size([21485, 152])
            y_test_tf: torch.Size([21485])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([374494, 152])
            y_retrain_tf: torch.Size([374494])

            x_prediction_tf: torch.Size([20629, 152])
            y_prediction_tf: torch.Size([20629])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.5170e-01,  7.8169e-01,  7.9342e-02, -1.2365e+00, -1.6841e-01,
        -7.8872e-01, -1.6086e-01, -3.5673e-01,  4.3400e-01, -1.6062e-01,
        -6.8302e-01,  9.1437e-02, -5.0654e-01, -3.8443e-01,  1.1169e-01,
         4.8542e-01, -1.4517e-01,  2.4144e-01, -3.5083e-02,  5.0189e-01,
        -3.2631e-01,  2.2627e-03, -3.7241e-02, -5.7087e-03, -4.9664e-02,
        -2.7789e-01, -5.9548e-01, -3.0669e-02,  1.9746e-01,  1.3382e+00,
         3.6286e-01, -1.2000e-01,  4.9758e-01, -3.5242e-02, -2.8389e-01,
        -2.2792e-01,  3.7222e-02,  6.9911e-01, -5.3938e-02, -1.1400e+00,
        -2.9416e-01,  2.5646e-01,  2.4021e-01, -4.1841e-02, -1.9822e-01,
        -7.4495e-01,  8.4166e-02, -5.5735e-02, -4.0163e-01, -1.6177e-01,
        -7.9419e-01,  5.3171e-01, -4.3740e-02, -9.5275e-03, -2.6106e-02,
         4.2102e-01, -6.5470e-01,  7.9345e-02, -2.5267e-01, -4.1140e-02,
         1.2773e-01, -3.0794e-01,  1.2879e-01,  2.5580e-01,  1.1144e-01,
        -1.8088e-01,  4.3880e-01, -1.3207e-01,  6.6354e-01, -4.2059e-01,
        -3.0142e-01, -2.3224e-02, -2.3187e-02, -8.8797e-01,  1.8281e-01,
         6.6443e-01,  2.1081e-02, -3.8111e-01, -1.7609e-01,  5.5197e-03,
        -3.3395e-03,  1.6638e-01,  1.5014e-01, -2.6760e-01, -5.6123e-01,
        -1.4502e-01, -1.3371e-01, -2.7933e-01,  4.1315e-02,  1.9152e-01,
        -5.3593e-01, -1.2752e+00,  1.9779e-02,  1.5375e+00,  2.3052e+00,
         2.5731e+00, -8.0186e-02,  2.3788e+00, -2.8994e+00,  7.6530e-01,
        -7.7655e-01,  1.0315e-01, -6.5651e-02,  5.4512e-02,  2.1990e-01,
         1.5332e-01,  5.3323e-02,  2.6708e-01,  0.0000e+00, -1.4434e+00,
         9.0323e-01, -2.6043e+00,  1.6773e-01,  3.7569e-04, -3.4438e-01,
         1.5154e-02,  1.7938e-01, -1.9686e-01, -5.1633e-02, -1.2949e-01,
         1.2043e-01, -3.4192e-01, -3.2717e-01,  3.0505e-01,  2.9974e-01,
        -4.1218e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([10879]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-7.8114e-01,  2.9078e-01, -2.6587e-01,  1.6201e+00, -1.3885e-01,
        -6.3873e-01, -1.6337e+00, -9.0372e-01, -2.8292e-01, -5.2687e-01,
        -7.4509e-01,  4.3381e-02, -2.0238e-02,  3.0761e-02, -4.9230e-01,
         6.2448e-01, -2.2009e-01,  9.7809e-02,  2.9115e-01,  3.1294e-01,
         5.2929e-01, -6.0036e-02, -4.0250e-02,  3.9724e-01,  1.5292e-02,
        -5.1123e-01, -6.5124e-01, -3.0669e-02, -8.6758e-01,  1.0285e+00,
         4.2996e-02, -1.3328e-01,  2.8588e-01, -2.1762e+00, -7.4250e-01,
        -1.8188e-01, -7.4501e-02, -4.8264e-01, -2.4550e-01, -1.1541e+00,
        -2.2444e-01,  1.0381e-01,  1.2773e-01, -1.1210e-01, -1.7610e-01,
        -7.0901e-01,  6.1741e-02,  1.6879e-01, -3.2922e-01,  4.3904e-01,
        -7.9419e-01, -7.1193e-01, -7.8809e-01, -5.3828e-01, -7.3540e-01,
         3.0973e-01, -1.0111e+00,  1.3383e-01, -3.5705e-01, -1.2404e-01,
         9.4415e-04, -3.8743e-01, -2.1083e-01,  4.4077e-01, -1.7325e-03,
        -3.9360e-01,  2.4403e-01,  3.5432e-01,  6.6354e-01, -4.2389e-01,
        -3.0142e-01, -2.3224e-02, -2.3187e-02, -6.3793e-01,  9.2474e-02,
         7.7075e-01,  2.2561e-03, -1.5449e-01, -8.9974e-02,  5.5197e-03,
         1.2261e-01,  3.2050e-01,  1.6015e-01, -2.3159e-02, -5.9930e-01,
        -1.3706e-01, -1.2925e-01, -3.5632e-01, -6.0520e-01, -1.3039e-01,
        -6.2087e-01,  1.4415e-03,  1.9779e-02, -1.7158e+00, -1.0605e+00,
        -1.0689e+00, -7.6335e-01, -1.8129e-01, -1.6174e+00, -4.3010e-01,
         2.2089e+00,  5.6988e-01, -6.5651e-02, -9.3425e-02,  2.1990e-01,
         8.1181e-01,  5.3960e-02,  1.4850e+00,  0.0000e+00,  3.7240e+00,
         3.0207e+00,  5.8686e-01,  1.2117e-01,  8.1395e+00, -3.4438e-01,
         1.5154e-02, -1.2073e-01, -1.4820e-01, -3.5350e+00,  6.5671e-01,
        -9.0136e-01,  1.8755e-01, -3.8519e-01,  2.1452e-01,  2.8088e-01,
        -4.2366e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2271]), tensor(0.0385))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.5948e-01,  7.9738e-01,  8.4846e-02, -1.2304e+00, -1.6902e-01,
        -8.0273e-01, -1.5623e-01, -3.5426e-01,  3.9958e-01, -1.4777e-01,
        -6.8298e-01,  1.0336e-01, -5.0110e-01, -3.7410e-01,  1.0466e-01,
         4.8227e-01, -1.4280e-01,  2.3940e-01, -2.5912e-02,  5.1135e-01,
        -3.2847e-01, -1.0317e-02, -3.5884e-02, -6.6024e-04, -4.8149e-02,
        -2.7864e-01, -5.8734e-01, -4.2626e-02,  1.8062e-01,  1.3197e+00,
         3.5665e-01, -1.1922e-01,  4.9095e-01, -2.4000e-02, -2.7263e-01,
        -2.2900e-01,  3.1229e-02,  7.1063e-01, -5.7610e-02, -1.1426e+00,
        -2.9484e-01,  2.9418e-01,  2.4680e-01, -4.9661e-02, -1.9874e-01,
        -7.5286e-01,  1.0260e-01, -3.4387e-02, -3.8934e-01, -1.5192e-01,
        -8.0408e-01,  5.1870e-01, -3.3780e-02, -1.0439e-02, -2.4128e-02,
         4.2172e-01, -6.4519e-01,  7.6807e-02, -2.5008e-01, -5.1755e-02,
         1.3048e-01, -3.0504e-01,  1.2968e-01,  2.4632e-01,  1.0496e-01,
        -1.8426e-01,  4.4867e-01, -1.2992e-01,  6.6712e-01, -4.2231e-01,
        -3.0861e-01, -2.5502e-02, -2.5970e-02, -8.9653e-01,  1.9598e-01,
         6.6228e-01,  1.7156e-02, -3.8393e-01, -1.7519e-01,  2.7696e-03,
         3.9799e-03,  1.4937e-01,  1.4155e-01, -2.4625e-01, -5.6503e-01,
        -1.4898e-01, -1.3812e-01, -2.7864e-01,  5.1816e-02,  1.9193e-01,
        -5.4084e-01, -1.2749e+00,  2.0026e-02,  1.5713e+00,  2.3191e+00,
         2.6238e+00, -4.8888e-02,  2.4330e+00, -2.8916e+00,  8.0735e-01,
        -7.8575e-01,  1.0866e-01, -8.2531e-02,  4.1074e-02,  2.0973e-01,
         1.6476e-01,  6.7014e-02,  3.2513e-01,  0.0000e+00, -1.2120e+00,
         6.1685e-01, -2.6591e+00,  1.7333e-01, -4.0787e-02,  2.5658e-01,
        -2.8032e-03,  1.9923e-01, -1.9682e-01, -5.6867e-02, -1.3972e-01,
         1.2623e-01, -3.3013e-01, -3.1721e-01,  3.1352e-01,  3.0387e-01,
        -4.0598e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([11430]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-4.4287e-01, -2.9374e-01, -5.4204e-01,  1.7279e+00,  1.1068e-01,
        -7.2087e-01, -1.6152e+00, -8.8289e-01, -3.5977e-01, -4.7237e-01,
        -7.4387e-01,  5.6000e-02, -2.0076e-02,  6.2140e-01,  2.8911e-01,
         2.5104e+00, -8.6857e-02,  1.9387e-01,  2.3250e-01,  1.5336e+00,
        -4.4167e-01, -5.7489e-02, -3.1261e-02,  3.5916e-02, -4.7259e-02,
        -5.0918e-01, -6.4168e-01, -4.2626e-02, -6.3441e-01,  8.1874e-01,
        -2.6701e-01, -1.1631e-01,  3.2025e-01, -2.1190e+00, -7.6737e-01,
        -3.5389e-01, -4.6610e-01, -4.8687e-01, -1.6505e-01, -1.0107e+00,
        -2.2801e-01, -6.4754e-01,  4.9209e-01, -9.0698e-02,  1.8388e-02,
        -7.9447e-01,  1.5812e-01,  1.2287e-02, -2.2565e-01, -1.9925e-01,
        -1.8764e-02, -6.2600e-01, -7.1488e-01, -5.3412e-01, -2.4128e-02,
         3.3318e-01, -1.0038e+00, -6.4378e-03, -1.4118e-01, -2.7862e-01,
        -3.0280e-01, -3.6026e-01, -1.1666e+00,  1.0884e+00, -8.6625e-04,
        -7.0039e-01, -1.5700e-01,  1.0723e+00,  1.3394e+00, -4.5566e-01,
        -3.0861e-01, -2.5502e-02, -2.5970e-02, -7.8798e-01,  9.8336e-02,
         6.7502e-02, -1.6303e-03, -2.7010e-01,  1.2147e-01,  2.7696e-03,
         1.3074e-01,  8.3715e-01,  3.9455e-01, -8.6543e-02, -5.5960e-01,
        -1.3925e-01, -1.3336e-01, -3.5523e-01, -7.8780e-01,  4.8034e-01,
        -5.4792e-01, -1.2749e+00,  2.0026e-02, -1.3436e+00, -2.3871e+00,
        -1.0818e+00,  1.1173e-01, -1.8007e+00,  1.5578e+00,  7.1121e-01,
        -7.1365e-02,  2.5640e-01, -8.2531e-02,  3.6353e+00,  2.0973e-01,
         1.5160e+00,  5.2681e-02,  4.2382e-01,  0.0000e+00,  6.7511e-01,
         1.9415e+00, -2.3518e-01,  1.1899e-01,  1.3992e+01,  2.5658e-01,
        -2.8032e-03,  6.3074e-02, -2.0534e-01, -3.3755e+00,  6.0411e-01,
         5.7346e-01,  6.3479e-01, -3.2757e-01,  2.4583e-01,  3.5075e-01,
        -3.9729e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2102]), tensor(-0.0803))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:main.py:Testing data year: 2001
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 13377
            device: cpu
            
2024-07-16 04:02:21,976	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 04:02:22,022	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 04:02:22,058	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 04:02:22,062	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 04:02:24,595	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 04:09:42,958	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_04-02-24' in 0.1251s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 2, 'num_embeddings': 13377, 'embedding_dim': 5, 'dropout_rate': 0.42, 'lr': 0.0007, 'weight_decay': 0.0002466377747309976, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.09717793887220404
INFO:model_data_nn.py:Best trial testing loss: 0.1986251427304177
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_04-02-19_685547_1361901/artifacts/2024-07-16_04-02-24/train_fnn_2024-07-16_04-02-24/driver_artifacts/train_fnn_e1cd1_00045_45_dropout_rate=0.4200,embedding_dim=5,hidden_dim=25,lr=0.0007,num_layers=2,weight_decay=0.0002_2024-07-16_04-02-24
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 2, 'num_embeddings': 14051, 'embedding_dim': 5, 'dropout_rate': 0.42, 'lr': 0.0007, 'weight_decay': 0.0002466377747309976, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 15.075659474280299, 'avg_test_loss': 0.6800811176682696}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.40791349917629854, 'avg_test_loss': 0.19304329993916147}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.1251861751817997, 'avg_test_loss': 0.13353107510893433}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.11113067154892894, 'avg_test_loss': 0.12792859911734675}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.1107380872137809, 'avg_test_loss': 0.12664730276590513}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.11082844499317816, 'avg_test_loss': 0.12892780351785965}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.11098024971217875, 'avg_test_loss': 0.12713645702158963}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.11096661977383346, 'avg_test_loss': 0.12696552823907065}
INFO:model_data_nn.py:Early stopping at epoch 8
INFO:main.py:Making prediction for data in year: 2002
INFO:main.py:Prediction data shape: (20629,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2002: 0.3560603156484264
INFO:main.py:Prediction Stats:                retq          pred
count  20629.000000  20629.000000
mean      -0.024597      0.044180
std        0.347899      0.016945
min       -0.987768     -0.006124
25%       -0.201179      0.033267
50%       -0.018143      0.039500
75%        0.112728      0.049705
max        8.604649      0.164796
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:transform_data_nn.py:Train_data: (374494, 161)

INFO:transform_data_nn.py:Test data years: [2002]
INFO:transform_data_nn.py:Test_data: (20629, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:transform_data_nn.py:Retrain_data: (395123, 161)

INFO:transform_data_nn.py:Prediction data years: [2003]
INFO:transform_data_nn.py:Prediction_data: (19044, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([374494, 152])
            y_train_tf: torch.Size([374494])

            x_test_tf: torch.Size([20629, 152])
            y_test_tf: torch.Size([20629])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([395123, 152])
            y_retrain_tf: torch.Size([395123])

            x_prediction_tf: torch.Size([19044, 152])
            y_prediction_tf: torch.Size([19044])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.5948e-01,  7.9738e-01,  8.4846e-02, -1.2304e+00, -1.6902e-01,
        -8.0273e-01, -1.5623e-01, -3.5426e-01,  3.9958e-01, -1.4777e-01,
        -6.8298e-01,  1.0336e-01, -5.0110e-01, -3.7410e-01,  1.0466e-01,
         4.8227e-01, -1.4280e-01,  2.3940e-01, -2.5912e-02,  5.1135e-01,
        -3.2847e-01, -1.0317e-02, -3.5884e-02, -6.6024e-04, -4.8149e-02,
        -2.7864e-01, -5.8734e-01, -4.2626e-02,  1.8062e-01,  1.3197e+00,
         3.5665e-01, -1.1922e-01,  4.9095e-01, -2.4000e-02, -2.7263e-01,
        -2.2900e-01,  3.1229e-02,  7.1063e-01, -5.7610e-02, -1.1426e+00,
        -2.9484e-01,  2.9418e-01,  2.4680e-01, -4.9661e-02, -1.9874e-01,
        -7.5286e-01,  1.0260e-01, -3.4387e-02, -3.8934e-01, -1.5192e-01,
        -8.0408e-01,  5.1870e-01, -3.3780e-02, -1.0439e-02, -2.4128e-02,
         4.2172e-01, -6.4519e-01,  7.6807e-02, -2.5008e-01, -5.1755e-02,
         1.3048e-01, -3.0504e-01,  1.2968e-01,  2.4632e-01,  1.0496e-01,
        -1.8426e-01,  4.4867e-01, -1.2992e-01,  6.6712e-01, -4.2231e-01,
        -3.0861e-01, -2.5502e-02, -2.5970e-02, -8.9653e-01,  1.9598e-01,
         6.6228e-01,  1.7156e-02, -3.8393e-01, -1.7519e-01,  2.7696e-03,
         3.9799e-03,  1.4937e-01,  1.4155e-01, -2.4625e-01, -5.6503e-01,
        -1.4898e-01, -1.3812e-01, -2.7864e-01,  5.1816e-02,  1.9193e-01,
        -5.4084e-01, -1.2749e+00,  2.0026e-02,  1.5713e+00,  2.3191e+00,
         2.6238e+00, -4.8888e-02,  2.4330e+00, -2.8916e+00,  8.0735e-01,
        -7.8575e-01,  1.0866e-01, -8.2531e-02,  4.1074e-02,  2.0973e-01,
         1.6476e-01,  6.7014e-02,  3.2513e-01,  0.0000e+00, -1.2120e+00,
         6.1685e-01, -2.6591e+00,  1.7333e-01, -4.0787e-02,  2.5658e-01,
        -2.8032e-03,  1.9923e-01, -1.9682e-01, -5.6867e-02, -1.3972e-01,
         1.2623e-01, -3.3013e-01, -3.1721e-01,  3.1352e-01,  3.0387e-01,
        -4.0598e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([11430]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-4.4287e-01, -2.9374e-01, -5.4204e-01,  1.7279e+00,  1.1068e-01,
        -7.2087e-01, -1.6152e+00, -8.8289e-01, -3.5977e-01, -4.7237e-01,
        -7.4387e-01,  5.6000e-02, -2.0076e-02,  6.2140e-01,  2.8911e-01,
         2.5104e+00, -8.6857e-02,  1.9387e-01,  2.3250e-01,  1.5336e+00,
        -4.4167e-01, -5.7489e-02, -3.1261e-02,  3.5916e-02, -4.7259e-02,
        -5.0918e-01, -6.4168e-01, -4.2626e-02, -6.3441e-01,  8.1874e-01,
        -2.6701e-01, -1.1631e-01,  3.2025e-01, -2.1190e+00, -7.6737e-01,
        -3.5389e-01, -4.6610e-01, -4.8687e-01, -1.6505e-01, -1.0107e+00,
        -2.2801e-01, -6.4754e-01,  4.9209e-01, -9.0698e-02,  1.8388e-02,
        -7.9447e-01,  1.5812e-01,  1.2287e-02, -2.2565e-01, -1.9925e-01,
        -1.8764e-02, -6.2600e-01, -7.1488e-01, -5.3412e-01, -2.4128e-02,
         3.3318e-01, -1.0038e+00, -6.4378e-03, -1.4118e-01, -2.7862e-01,
        -3.0280e-01, -3.6026e-01, -1.1666e+00,  1.0884e+00, -8.6625e-04,
        -7.0039e-01, -1.5700e-01,  1.0723e+00,  1.3394e+00, -4.5566e-01,
        -3.0861e-01, -2.5502e-02, -2.5970e-02, -7.8798e-01,  9.8336e-02,
         6.7502e-02, -1.6303e-03, -2.7010e-01,  1.2147e-01,  2.7696e-03,
         1.3074e-01,  8.3715e-01,  3.9455e-01, -8.6543e-02, -5.5960e-01,
        -1.3925e-01, -1.3336e-01, -3.5523e-01, -7.8780e-01,  4.8034e-01,
        -5.4792e-01, -1.2749e+00,  2.0026e-02, -1.3436e+00, -2.3871e+00,
        -1.0818e+00,  1.1173e-01, -1.8007e+00,  1.5578e+00,  7.1121e-01,
        -7.1365e-02,  2.5640e-01, -8.2531e-02,  3.6353e+00,  2.0973e-01,
         1.5160e+00,  5.2681e-02,  4.2382e-01,  0.0000e+00,  6.7511e-01,
         1.9415e+00, -2.3518e-01,  1.1899e-01,  1.3992e+01,  2.5658e-01,
        -2.8032e-03,  6.3074e-02, -2.0534e-01, -3.3755e+00,  6.0411e-01,
         5.7346e-01,  6.3479e-01, -3.2757e-01,  2.4583e-01,  3.5075e-01,
        -3.9729e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2102]), tensor(-0.0803))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-0.1721,  0.8169,  0.0877, -1.2257, -0.1545, -0.8123, -0.1512, -0.3522,
         0.3872, -0.1460, -0.6854,  0.1167, -0.5019, -0.3625,  0.0933,  0.4887,
        -0.1408,  0.2354, -0.0296,  0.5302, -0.3156, -0.0091, -0.0217,  0.0065,
        -0.0416, -0.2792, -0.5852, -0.0476,  0.1669,  1.2601,  0.3529, -0.1106,
         0.4891, -0.0130, -0.2599, -0.2270,  0.0428,  0.7302, -0.0530, -1.1471,
        -0.2949,  0.3037,  0.2660, -0.0537, -0.1905, -0.7562,  0.1054, -0.0320,
        -0.3746, -0.1430, -0.8155,  0.5058, -0.0278, -0.0101, -0.0254,  0.4245,
        -0.6363,  0.0705, -0.2477, -0.0593,  0.1311, -0.3040,  0.1315,  0.2389,
         0.1082, -0.1871,  0.4608, -0.1317,  0.6682, -0.4242, -0.3163, -0.0290,
        -0.0281, -0.9017,  0.2114,  0.6740,  0.0206, -0.3871, -0.1750,  0.0070,
         0.0030,  0.1589,  0.1422, -0.2264, -0.5652, -0.1529, -0.1430, -0.2799,
         0.0578,  0.1904, -0.5441, -1.2752,  0.0177,  1.6195,  2.2608,  2.6944,
        -0.0770,  2.4012, -2.8918,  0.7793, -0.8087,  0.1255, -0.0708,  0.0343,
         0.2038,  0.1479,  0.0641,  0.3696,  0.0000, -1.1930,  0.5757, -2.7203,
         0.1787, -0.0059,  0.1861, -0.0220,  0.2206, -0.1949, -0.0243, -0.1542,
         0.1332, -0.3190, -0.3039,  0.3248,  0.3097, -0.4046,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([11621]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-2.5336e-02, -5.8967e-01,  2.6355e-01,  1.8283e+00, -7.8493e-01,
        -5.6450e-01, -1.5599e+00, -8.6559e-01, -6.3206e-03, -4.0300e-01,
        -7.3615e-01,  4.7545e-02, -3.8138e+00,  1.1509e+00,  4.0747e-01,
        -1.9625e+00, -1.8073e-01, -3.7805e-01, -2.9584e-02, -1.6946e+00,
        -1.4442e-01, -5.4114e-02, -2.8901e-02, -5.3617e-01,  5.9445e-02,
        -5.3774e-01, -6.4346e-01, -4.7607e-02, -9.3981e-01,  1.6137e+00,
        -5.0386e-01, -2.2148e-01,  2.2793e-01, -1.3010e-02, -7.7083e-01,
        -2.8453e-01, -1.1733e-01, -5.9279e-01, -4.4790e-01, -1.0745e+00,
        -2.3711e-01, -9.7715e-01, -4.8021e-01, -1.9589e-02, -6.5586e-01,
        -7.2864e-01, -6.4279e-01, -7.3818e-01,  1.8440e-01, -4.9875e-01,
         7.6192e-01, -8.4593e-01, -5.3885e-01, -5.3208e-01, -7.3365e-01,
         2.0043e-01, -9.9670e-01,  2.1175e-01, -3.4891e-01, -3.2963e-01,
         1.3873e-02, -3.8471e-01,  4.2228e-01,  2.2273e-01,  1.1131e-03,
         3.3247e-01, -1.3915e+00,  9.3603e-01, -3.8710e-03, -4.8603e-01,
        -3.1634e-01, -2.9030e-02, -2.8083e-02, -6.2110e-01,  1.0375e-01,
        -1.2465e+00,  2.4416e+00, -1.9944e-01,  1.7855e-01,  6.9553e-03,
         3.0438e-03, -8.5565e-01,  6.1390e-01,  7.9496e-02, -4.7733e-01,
        -1.4182e-01, -1.3799e-01, -3.4533e-01, -3.7077e-01,  1.5252e+00,
        -4.8922e-01,  1.1568e+00,  1.7699e-02, -6.5983e-01, -1.2441e+00,
        -3.9940e-01,  7.6469e-01, -1.8165e+00,  1.1497e+00,  5.8451e-01,
         3.2179e-01, -1.7415e+00, -7.0821e-02,  1.8081e+00,  2.0381e-01,
         2.4351e+00,  1.5858e-02,  3.6960e-01,  0.0000e+00, -1.4863e+00,
        -7.2142e-01, -4.2507e-01,  1.2173e-01,  9.6193e+00,  1.8612e-01,
        -2.1954e-02, -1.0043e-01, -2.6332e-01, -3.3450e+00,  7.2723e-01,
         3.0019e-01,  5.6778e-01, -3.6925e-01,  1.5503e-01,  1.5877e-01,
        -3.6994e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1951]), tensor(0.0590))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:main.py:Testing data year: 2002
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 14051
            device: cpu
            
2024-07-16 04:58:37,066	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 04:58:37,124	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 04:58:37,159	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 04:58:37,164	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 04:58:39,471	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 05:05:31,192	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_04-58-39' in 0.1331s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 1, 'num_embeddings': 14051, 'embedding_dim': 15, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 0.000526576127715743, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10918472028927532
INFO:model_data_nn.py:Best trial testing loss: 0.12493874031452486
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_04-58-34_741647_1361901/artifacts/2024-07-16_04-58-39/train_fnn_2024-07-16_04-58-39/driver_artifacts/train_fnn_bd625_00022_22_dropout_rate=0.5200,embedding_dim=15,hidden_dim=5,lr=0.0100,num_layers=1,weight_decay=0.0005_2024-07-16_04-58-39
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 1, 'num_embeddings': 14292, 'embedding_dim': 15, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 0.000526576127715743, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 2.0571521486836084, 'avg_test_loss': 0.1529906574388345}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.1207991706622388, 'avg_test_loss': 0.16126154894630115}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.11166228491262836, 'avg_test_loss': 0.16574145595232645}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.11031359318798224, 'avg_test_loss': 0.15304505169391633}
INFO:model_data_nn.py:Early stopping at epoch 4
INFO:main.py:Making prediction for data in year: 2003
INFO:main.py:Prediction data shape: (19044,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2003: 0.39201672837677676
INFO:main.py:Prediction Stats:                retq          pred
count  19044.000000  19044.000000
mean       0.157039      0.072814
std        0.390767      0.040614
min       -0.964285     -0.165677
25%       -0.023484      0.042017
50%        0.087272      0.061620
75%        0.245431      0.098337
max       11.166664      0.282060
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:transform_data_nn.py:Train_data: (395123, 161)

INFO:transform_data_nn.py:Test data years: [2003]
INFO:transform_data_nn.py:Test_data: (19044, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:transform_data_nn.py:Retrain_data: (414167, 161)

INFO:transform_data_nn.py:Prediction data years: [2004]
INFO:transform_data_nn.py:Prediction_data: (17992, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([395123, 152])
            y_train_tf: torch.Size([395123])

            x_test_tf: torch.Size([19044, 152])
            y_test_tf: torch.Size([19044])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([414167, 152])
            y_retrain_tf: torch.Size([414167])

            x_prediction_tf: torch.Size([17992, 152])
            y_prediction_tf: torch.Size([17992])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-0.1721,  0.8169,  0.0877, -1.2257, -0.1545, -0.8123, -0.1512, -0.3522,
         0.3872, -0.1460, -0.6854,  0.1167, -0.5019, -0.3625,  0.0933,  0.4887,
        -0.1408,  0.2354, -0.0296,  0.5302, -0.3156, -0.0091, -0.0217,  0.0065,
        -0.0416, -0.2792, -0.5852, -0.0476,  0.1669,  1.2601,  0.3529, -0.1106,
         0.4891, -0.0130, -0.2599, -0.2270,  0.0428,  0.7302, -0.0530, -1.1471,
        -0.2949,  0.3037,  0.2660, -0.0537, -0.1905, -0.7562,  0.1054, -0.0320,
        -0.3746, -0.1430, -0.8155,  0.5058, -0.0278, -0.0101, -0.0254,  0.4245,
        -0.6363,  0.0705, -0.2477, -0.0593,  0.1311, -0.3040,  0.1315,  0.2389,
         0.1082, -0.1871,  0.4608, -0.1317,  0.6682, -0.4242, -0.3163, -0.0290,
        -0.0281, -0.9017,  0.2114,  0.6740,  0.0206, -0.3871, -0.1750,  0.0070,
         0.0030,  0.1589,  0.1422, -0.2264, -0.5652, -0.1529, -0.1430, -0.2799,
         0.0578,  0.1904, -0.5441, -1.2752,  0.0177,  1.6195,  2.2608,  2.6944,
        -0.0770,  2.4012, -2.8918,  0.7793, -0.8087,  0.1255, -0.0708,  0.0343,
         0.2038,  0.1479,  0.0641,  0.3696,  0.0000, -1.1930,  0.5757, -2.7203,
         0.1787, -0.0059,  0.1861, -0.0220,  0.2206, -0.1949, -0.0243, -0.1542,
         0.1332, -0.3190, -0.3039,  0.3248,  0.3097, -0.4046,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([11621]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-2.5336e-02, -5.8967e-01,  2.6355e-01,  1.8283e+00, -7.8493e-01,
        -5.6450e-01, -1.5599e+00, -8.6559e-01, -6.3206e-03, -4.0300e-01,
        -7.3615e-01,  4.7545e-02, -3.8138e+00,  1.1509e+00,  4.0747e-01,
        -1.9625e+00, -1.8073e-01, -3.7805e-01, -2.9584e-02, -1.6946e+00,
        -1.4442e-01, -5.4114e-02, -2.8901e-02, -5.3617e-01,  5.9445e-02,
        -5.3774e-01, -6.4346e-01, -4.7607e-02, -9.3981e-01,  1.6137e+00,
        -5.0386e-01, -2.2148e-01,  2.2793e-01, -1.3010e-02, -7.7083e-01,
        -2.8453e-01, -1.1733e-01, -5.9279e-01, -4.4790e-01, -1.0745e+00,
        -2.3711e-01, -9.7715e-01, -4.8021e-01, -1.9589e-02, -6.5586e-01,
        -7.2864e-01, -6.4279e-01, -7.3818e-01,  1.8440e-01, -4.9875e-01,
         7.6192e-01, -8.4593e-01, -5.3885e-01, -5.3208e-01, -7.3365e-01,
         2.0043e-01, -9.9670e-01,  2.1175e-01, -3.4891e-01, -3.2963e-01,
         1.3873e-02, -3.8471e-01,  4.2228e-01,  2.2273e-01,  1.1131e-03,
         3.3247e-01, -1.3915e+00,  9.3603e-01, -3.8710e-03, -4.8603e-01,
        -3.1634e-01, -2.9030e-02, -2.8083e-02, -6.2110e-01,  1.0375e-01,
        -1.2465e+00,  2.4416e+00, -1.9944e-01,  1.7855e-01,  6.9553e-03,
         3.0438e-03, -8.5565e-01,  6.1390e-01,  7.9496e-02, -4.7733e-01,
        -1.4182e-01, -1.3799e-01, -3.4533e-01, -3.7077e-01,  1.5252e+00,
        -4.8922e-01,  1.1568e+00,  1.7699e-02, -6.5983e-01, -1.2441e+00,
        -3.9940e-01,  7.6469e-01, -1.8165e+00,  1.1497e+00,  5.8451e-01,
         3.2179e-01, -1.7415e+00, -7.0821e-02,  1.8081e+00,  2.0381e-01,
         2.4351e+00,  1.5858e-02,  3.6960e-01,  0.0000e+00, -1.4863e+00,
        -7.2142e-01, -4.2507e-01,  1.2173e-01,  9.6193e+00,  1.8612e-01,
        -2.1954e-02, -1.0043e-01, -2.6332e-01, -3.3450e+00,  7.2723e-01,
         3.0019e-01,  5.6778e-01, -3.6925e-01,  1.5503e-01,  1.5877e-01,
        -3.6994e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1951]), tensor(0.0590))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.7691e-01,  8.3472e-01,  8.5007e-02, -1.2235e+00, -1.4235e-01,
        -8.1628e-01, -1.4754e-01, -3.5021e-01,  3.8305e-01, -1.4563e-01,
        -6.8896e-01,  1.2245e-01, -5.0418e-01, -3.6553e-01,  9.3019e-02,
         4.8990e-01, -1.3791e-01,  2.3091e-01, -3.0420e-02,  5.4392e-01,
        -3.3311e-01, -5.8796e-03, -7.6251e-03,  5.1652e-03, -3.5088e-02,
        -2.7885e-01, -5.8781e-01, -5.2735e-02,  1.5159e-01,  1.2634e+00,
         3.4677e-01, -1.0361e-01,  4.9157e-01, -1.4596e-03, -2.5149e-01,
        -2.1879e-01,  6.4771e-02,  7.4599e-01, -4.2716e-02, -1.1523e+00,
        -2.9324e-01,  3.0206e-01,  2.8339e-01, -5.5354e-02, -1.8354e-01,
        -7.5452e-01,  1.0882e-01, -3.2442e-02, -3.6424e-01, -1.5474e-01,
        -8.2628e-01,  4.9218e-01, -2.3628e-02, -1.0290e-02, -2.6877e-02,
         4.2518e-01, -6.2827e-01,  6.3533e-02, -2.4676e-01, -5.2799e-02,
         1.2926e-01, -3.0352e-01,  1.3475e-01,  2.3676e-01,  1.0897e-01,
        -1.8733e-01,  4.7246e-01, -1.3229e-01,  6.5685e-01, -4.2552e-01,
        -3.2324e-01, -3.1691e-02, -2.9137e-02, -9.0115e-01,  2.1909e-01,
         6.8209e-01,  2.4920e-02, -3.8959e-01, -1.7514e-01,  9.7928e-03,
        -4.8798e-03,  1.6975e-01,  1.4553e-01, -2.0250e-01, -5.6435e-01,
        -1.5537e-01, -1.4633e-01, -2.8138e-01,  6.3534e-02,  1.8839e-01,
        -5.4800e-01, -1.2762e+00,  1.6181e-02,  1.6713e+00,  2.3090e+00,
         2.7658e+00, -8.5525e-02,  2.3631e+00, -2.9202e+00,  7.7779e-01,
        -8.3307e-01,  1.3847e-01,  2.7372e-01,  5.5249e-02,  4.1898e-01,
         1.3040e-01,  5.1610e-02,  2.9600e-01,  0.0000e+00, -1.0849e+00,
         6.1663e-01, -2.7300e+00,  1.8042e-01, -2.3450e-03,  1.6970e-01,
        -2.1652e-02,  2.4078e-01, -1.9235e-01, -4.7087e-02, -1.5893e-01,
         1.3417e-01, -3.0851e-01, -2.9324e-01,  3.3125e-01,  3.1256e-01,
        -4.0709e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([11747]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-3.3032e-01, -3.2863e-01, -5.4621e-01,  1.9187e+00, -1.3604e-02,
        -4.1048e-01, -1.4297e+00, -8.5045e-01,  2.0488e-01,  2.9088e-01,
        -3.9718e-01,  5.2314e-02, -8.5454e-02,  8.8066e-01,  3.4494e-01,
        -2.8047e-01, -2.1841e-01,  2.1148e-01, -3.0420e-02, -1.2082e-01,
         2.7830e-01, -5.4898e-02, -2.0056e-03,  3.0199e-01, -1.1484e-02,
        -5.4956e-01, -6.3334e-01, -5.2735e-02, -9.7430e-01,  1.5681e+00,
         5.7532e-02, -2.3687e-01,  1.8167e-01, -1.4596e-03, -8.5417e-01,
        -2.5726e-01, -1.6822e-01, -5.9864e-01, -2.9938e-01, -6.4472e-01,
        -2.4293e-01,  6.3351e-01,  7.7548e-02,  2.3678e-01, -3.4791e-02,
        -6.7028e-01, -5.2449e-01, -5.4741e-02, -5.2849e-01, -1.7863e-01,
         7.5579e-01, -9.5859e-01, -7.0035e-01, -5.3131e-01, -2.6877e-02,
         1.0805e-01, -9.9068e-01,  1.2342e-02, -2.4363e-01,  2.7336e-02,
         1.1204e-01, -8.0581e-02, -4.9904e-02, -4.7279e-02, -8.4790e-04,
        -3.4607e-01, -2.5287e+00,  5.8546e-01,  1.3277e+00, -4.7879e-01,
        -3.2324e-01, -3.1691e-02, -2.9137e-02, -6.9785e-01,  7.2630e-02,
         5.1817e-01, -1.7032e-01, -2.5562e-01,  5.3902e-02,  9.7928e-03,
        -4.8798e-03, -5.1251e-01,  6.5282e-01, -1.5843e-01, -9.1988e-02,
        -1.3942e-01, -1.3948e-01,  2.7220e-01, -3.3671e-01, -3.1625e+00,
        -2.2754e-01, -2.3453e-01,  1.6181e-02, -9.7372e-01, -4.0657e-01,
        -6.9811e-01, -2.8577e-01, -1.7511e+00,  1.4865e+00, -6.6536e-02,
        -6.1298e-01, -1.3437e-01, -3.7728e+00,  1.1455e-01,  2.1749e+00,
         1.6659e+00,  5.7954e-02,  2.9600e-01,  1.0163e+00, -1.8067e+00,
        -1.0412e+00,  1.2836e-01,  1.1798e-01,  7.2003e+00,  1.6970e-01,
        -2.1652e-02, -2.6242e-01, -1.3663e-01, -3.3328e+00,  7.9554e-01,
        -4.1379e-01,  3.2971e-02, -4.7902e-01,  1.1867e-01,  1.0595e-01,
        -3.5654e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2471]), tensor(0.2185))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:main.py:Testing data year: 2003
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 14292
            device: cpu
            
2024-07-16 05:55:59,474	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 05:55:59,513	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 05:55:59,545	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 05:55:59,550	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 05:56:02,107	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 06:01:30,714	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_05-56-02' in 0.1326s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 125, 'num_layers': 1, 'num_embeddings': 14292, 'embedding_dim': 25, 'dropout_rate': 0.15, 'lr': 0.01, 'weight_decay': 1.4096175149815853e-05, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10679390726832992
INFO:model_data_nn.py:Best trial testing loss: 0.1480011591811975
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_05-55-57_211906_1361901/artifacts/2024-07-16_05-56-02/train_fnn_2024-07-16_05-56-02/driver_artifacts/train_fnn_c15ad_00012_12_dropout_rate=0.1500,embedding_dim=25,hidden_dim=125,lr=0.0100,num_layers=1,weight_decay=0.0000_2024-07-16_05-56-02
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 125, 'num_layers': 1, 'num_embeddings': 14438, 'embedding_dim': 25, 'dropout_rate': 0.15, 'lr': 0.01, 'weight_decay': 1.4096175149815853e-05, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 0.7216228381126235, 'avg_test_loss': 0.09391998056269868}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.13209401938157117, 'avg_test_loss': 0.08745814261721893}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.12053893423179908, 'avg_test_loss': 0.08570014082000289}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.11307915371965861, 'avg_test_loss': 0.0875676852506651}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.1088235255547227, 'avg_test_loss': 0.09413658617667749}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.10782663426759143, 'avg_test_loss': 0.08121394898585031}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.1080549413796482, 'avg_test_loss': 0.08480541625807822}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.1084035872303327, 'avg_test_loss': 0.08258805793880576}
INFO:model_data_nn.py:Epoch 9/40, metrics: {'avg_train_loss': 0.1087534006579108, 'avg_test_loss': 0.07959799137963376}
INFO:model_data_nn.py:Epoch 10/40, metrics: {'avg_train_loss': 0.10876115207526976, 'avg_test_loss': 0.08087475708043071}
INFO:model_data_nn.py:Epoch 11/40, metrics: {'avg_train_loss': 0.10934626327641078, 'avg_test_loss': 0.08262893192889825}
INFO:model_data_nn.py:Epoch 12/40, metrics: {'avg_train_loss': 0.10902532801372822, 'avg_test_loss': 0.08360828797687107}
INFO:model_data_nn.py:Early stopping at epoch 12
INFO:main.py:Making prediction for data in year: 2004
INFO:main.py:Prediction data shape: (17992,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2004: 0.2892651153487336
INFO:main.py:Prediction Stats:                retq          pred
count  17992.000000  17992.000000
mean       0.052419      0.048406
std        0.280720      0.079565
min       -0.938679     -1.104860
25%       -0.068413      0.026159
50%        0.026063      0.054168
75%        0.139854      0.085559
max       11.611828      0.676477
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:transform_data_nn.py:Train_data: (414167, 161)

INFO:transform_data_nn.py:Test data years: [2004]
INFO:transform_data_nn.py:Test_data: (17992, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]
INFO:transform_data_nn.py:Retrain_data: (432159, 161)

INFO:transform_data_nn.py:Prediction data years: [2005]
INFO:transform_data_nn.py:Prediction_data: (17457, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([414167, 152])
            y_train_tf: torch.Size([414167])

            x_test_tf: torch.Size([17992, 152])
            y_test_tf: torch.Size([17992])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([432159, 152])
            y_retrain_tf: torch.Size([432159])

            x_prediction_tf: torch.Size([17457, 152])
            y_prediction_tf: torch.Size([17457])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.7691e-01,  8.3472e-01,  8.5007e-02, -1.2235e+00, -1.4235e-01,
        -8.1628e-01, -1.4754e-01, -3.5021e-01,  3.8305e-01, -1.4563e-01,
        -6.8896e-01,  1.2245e-01, -5.0418e-01, -3.6553e-01,  9.3019e-02,
         4.8990e-01, -1.3791e-01,  2.3091e-01, -3.0420e-02,  5.4392e-01,
        -3.3311e-01, -5.8796e-03, -7.6251e-03,  5.1652e-03, -3.5088e-02,
        -2.7885e-01, -5.8781e-01, -5.2735e-02,  1.5159e-01,  1.2634e+00,
         3.4677e-01, -1.0361e-01,  4.9157e-01, -1.4596e-03, -2.5149e-01,
        -2.1879e-01,  6.4771e-02,  7.4599e-01, -4.2716e-02, -1.1523e+00,
        -2.9324e-01,  3.0206e-01,  2.8339e-01, -5.5354e-02, -1.8354e-01,
        -7.5452e-01,  1.0882e-01, -3.2442e-02, -3.6424e-01, -1.5474e-01,
        -8.2628e-01,  4.9218e-01, -2.3628e-02, -1.0290e-02, -2.6877e-02,
         4.2518e-01, -6.2827e-01,  6.3533e-02, -2.4676e-01, -5.2799e-02,
         1.2926e-01, -3.0352e-01,  1.3475e-01,  2.3676e-01,  1.0897e-01,
        -1.8733e-01,  4.7246e-01, -1.3229e-01,  6.5685e-01, -4.2552e-01,
        -3.2324e-01, -3.1691e-02, -2.9137e-02, -9.0115e-01,  2.1909e-01,
         6.8209e-01,  2.4920e-02, -3.8959e-01, -1.7514e-01,  9.7928e-03,
        -4.8798e-03,  1.6975e-01,  1.4553e-01, -2.0250e-01, -5.6435e-01,
        -1.5537e-01, -1.4633e-01, -2.8138e-01,  6.3534e-02,  1.8839e-01,
        -5.4800e-01, -1.2762e+00,  1.6181e-02,  1.6713e+00,  2.3090e+00,
         2.7658e+00, -8.5525e-02,  2.3631e+00, -2.9202e+00,  7.7779e-01,
        -8.3307e-01,  1.3847e-01,  2.7372e-01,  5.5249e-02,  4.1898e-01,
         1.3040e-01,  5.1610e-02,  2.9600e-01,  0.0000e+00, -1.0849e+00,
         6.1663e-01, -2.7300e+00,  1.8042e-01, -2.3450e-03,  1.6970e-01,
        -2.1652e-02,  2.4078e-01, -1.9235e-01, -4.7087e-02, -1.5893e-01,
         1.3417e-01, -3.0851e-01, -2.9324e-01,  3.3125e-01,  3.1256e-01,
        -4.0709e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([11747]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-3.3032e-01, -3.2863e-01, -5.4621e-01,  1.9187e+00, -1.3604e-02,
        -4.1048e-01, -1.4297e+00, -8.5045e-01,  2.0488e-01,  2.9088e-01,
        -3.9718e-01,  5.2314e-02, -8.5454e-02,  8.8066e-01,  3.4494e-01,
        -2.8047e-01, -2.1841e-01,  2.1148e-01, -3.0420e-02, -1.2082e-01,
         2.7830e-01, -5.4898e-02, -2.0056e-03,  3.0199e-01, -1.1484e-02,
        -5.4956e-01, -6.3334e-01, -5.2735e-02, -9.7430e-01,  1.5681e+00,
         5.7532e-02, -2.3687e-01,  1.8167e-01, -1.4596e-03, -8.5417e-01,
        -2.5726e-01, -1.6822e-01, -5.9864e-01, -2.9938e-01, -6.4472e-01,
        -2.4293e-01,  6.3351e-01,  7.7548e-02,  2.3678e-01, -3.4791e-02,
        -6.7028e-01, -5.2449e-01, -5.4741e-02, -5.2849e-01, -1.7863e-01,
         7.5579e-01, -9.5859e-01, -7.0035e-01, -5.3131e-01, -2.6877e-02,
         1.0805e-01, -9.9068e-01,  1.2342e-02, -2.4363e-01,  2.7336e-02,
         1.1204e-01, -8.0581e-02, -4.9904e-02, -4.7279e-02, -8.4790e-04,
        -3.4607e-01, -2.5287e+00,  5.8546e-01,  1.3277e+00, -4.7879e-01,
        -3.2324e-01, -3.1691e-02, -2.9137e-02, -6.9785e-01,  7.2630e-02,
         5.1817e-01, -1.7032e-01, -2.5562e-01,  5.3902e-02,  9.7928e-03,
        -4.8798e-03, -5.1251e-01,  6.5282e-01, -1.5843e-01, -9.1988e-02,
        -1.3942e-01, -1.3948e-01,  2.7220e-01, -3.3671e-01, -3.1625e+00,
        -2.2754e-01, -2.3453e-01,  1.6181e-02, -9.7372e-01, -4.0657e-01,
        -6.9811e-01, -2.8577e-01, -1.7511e+00,  1.4865e+00, -6.6536e-02,
        -6.1298e-01, -1.3437e-01, -3.7728e+00,  1.1455e-01,  2.1749e+00,
         1.6659e+00,  5.7954e-02,  2.9600e-01,  1.0163e+00, -1.8067e+00,
        -1.0412e+00,  1.2836e-01,  1.1798e-01,  7.2003e+00,  1.6970e-01,
        -2.1652e-02, -2.6242e-01, -1.3663e-01, -3.3328e+00,  7.9554e-01,
        -4.1379e-01,  3.2971e-02, -4.7902e-01,  1.1867e-01,  1.0595e-01,
        -3.5654e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2471]), tensor(0.2185))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.7339e-01,  8.4992e-01,  8.6402e-02, -1.5400e+00, -1.3984e-01,
        -8.1489e-01, -1.4654e-01, -3.4958e-01,  3.9916e-01, -1.8746e-01,
        -6.9306e-01,  8.2659e-02, -7.0223e-01, -4.8380e-01,  6.9990e-02,
         4.9457e-01, -1.3871e-01,  2.0506e-01, -6.7835e-02,  5.5422e-01,
        -4.0333e-01, -4.8444e-02, -1.4951e-01,  2.5652e-03, -8.8841e-02,
        -3.3848e-01, -5.8921e-01, -5.3741e-02,  4.8661e-01,  1.3565e+00,
         3.4964e-01, -1.4058e-01,  7.6665e-01,  2.7734e-01, -2.4610e-01,
        -2.4994e-01,  8.2909e-02,  7.5973e-01, -3.4617e-02, -1.1520e+00,
        -2.8875e-01,  2.2615e-01,  2.9726e-01,  4.0419e-02, -1.7960e-01,
        -7.4955e-01,  8.0036e-02, -3.8337e-02, -3.6052e-01, -1.6278e-01,
        -8.3355e-01,  4.6937e-01, -4.7447e-01,  9.0737e-02, -2.9689e-02,
         5.0327e-01, -6.2055e-01, -1.9281e-01, -2.5044e-01, -4.9213e-02,
        -2.9842e-05, -3.0736e-01,  5.7393e-02,  2.2353e-01,  9.0457e-02,
        -1.9447e-01,  6.7320e-01, -2.6768e-01,  6.4575e-01, -5.6356e-01,
        -3.2740e-01, -1.6271e-01, -2.9131e-02, -8.9527e-01,  1.7078e-01,
         7.0712e-01,  8.1884e-01, -1.1273e+00,  2.7984e-01,  1.1873e-02,
        -8.0590e-01,  1.7475e-01,  3.0779e-01, -1.7584e-01, -5.6411e-01,
        -4.3099e-01, -5.2815e-01, -2.7993e-01,  6.7890e-02,  1.0498e-01,
        -5.5481e-01, -1.3403e+00,  2.2558e-01, -1.1102e-16, -1.1102e-16,
         2.8310e+00, -8.4100e-02,  2.3541e+00, -2.9417e+00,  8.0874e-01,
        -8.2351e-01,  1.4608e-01,  1.2037e-01,  5.9782e-02,  3.0659e-01,
         1.2993e-01, -1.1979e-01,  2.9014e-01, -7.2199e-01, -1.0192e+00,
         6.5536e-01,  0.0000e+00,  3.4953e-01, -1.1306e-03,  1.4251e-01,
         9.3818e-04,  2.5949e-01, -2.3872e-01,  1.9013e-02, -5.7219e-01,
         1.3201e-01, -2.9745e-01, -3.9589e-01,  3.5383e-01,  3.7347e-01,
        -4.0906e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([11851]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-2.9738e-01,  7.5153e-01, -6.9859e-01,  1.3755e+00, -4.7087e-01,
        -1.8759e-01, -1.3375e+00, -8.3761e-01, -1.2325e-01,  1.9891e-02,
        -6.0898e-01, -2.3867e-01, -7.0223e-01, -1.3589e+00, -1.6912e+00,
        -9.6042e-01, -2.2222e-01, -5.5459e-01, -6.7835e-02,  8.6479e-01,
        -2.0320e-01, -1.2217e-01, -1.4458e-01, -7.0472e-01, -1.4384e-01,
        -7.3254e-01, -6.3916e-01, -5.3741e-02, -9.4243e-01, -4.9568e-01,
        -4.1341e-02, -4.7921e-01, -2.1638e-01,  2.7734e-01, -9.1269e-01,
        -6.3703e-01, -4.3146e-01, -6.1478e-01, -6.3603e-01, -5.6854e-01,
        -2.2993e-01,  1.1130e-01, -5.8439e-02,  3.2993e-01, -3.5401e-01,
         2.4189e-01, -2.4694e-01,  1.0455e+00, -8.3080e-01, -4.6759e-01,
        -1.6254e+00, -9.0452e-01, -4.7447e-01, -6.6976e-01, -7.3519e-01,
        -3.5698e-01, -9.8539e-01, -4.7531e-01,  1.4565e-01, -3.0306e-01,
        -7.5482e-02, -3.7464e-01, -1.7277e+00,  2.4459e-01, -2.7491e-02,
        -8.1128e-01,  1.7903e+00,  9.8129e-01, -2.0372e+00, -6.8266e-01,
        -3.2740e-01, -1.6271e-01, -2.9131e-02, -1.7443e-01, -2.0096e-01,
        -3.0484e-01,  8.1884e-01, -4.3326e-01,  1.4848e+00,  1.1873e-02,
        -8.0590e-01, -5.8506e-01,  6.3879e-01,  1.0993e+00,  1.7163e-01,
        -3.0619e-01, -4.2956e-01, -1.4078e-01, -4.0739e-01,  5.5157e-01,
        -2.6339e-01, -1.0277e+00,  2.2558e-01, -1.1102e-16, -1.1102e-16,
        -4.7159e-01,  5.8371e-02, -1.1678e+00,  3.1160e-01, -8.0709e-01,
        -6.8757e-01,  2.6424e-01,  1.2037e-01, -2.2485e-01,  3.0659e-01,
         8.8114e-01, -2.1660e-01,  2.9014e-01,  1.5035e+00, -5.2377e-01,
        -7.3882e-01,  0.0000e+00, -8.0589e-02,  5.2052e+00,  1.4251e-01,
         9.3818e-04, -1.1305e-01, -2.2258e-01,  1.9013e-02,  1.0175e+00,
        -1.1796e+00,  9.2318e-03, -7.3617e-01, -1.5035e-02, -3.5734e-01,
        -3.1233e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2417]), tensor(0.0304))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:main.py:Testing data year: 2004
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 14438
            device: cpu
            
2024-07-16 06:55:56,689	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 06:55:56,731	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 06:55:56,762	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 06:55:56,768	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 06:55:59,326	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 07:02:58,031	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_06-55-59' in 0.1332s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 2, 'num_embeddings': 14438, 'embedding_dim': 30, 'dropout_rate': 0.36, 'lr': 0.05, 'weight_decay': 0.00028480262754225174, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.11772806257037136
INFO:model_data_nn.py:Best trial testing loss: 0.07886585254799312
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_06-55-54_332628_1361901/artifacts/2024-07-16_06-55-59/train_fnn_2024-07-16_06-55-59/driver_artifacts/train_fnn_2176e_00010_10_dropout_rate=0.3600,embedding_dim=30,hidden_dim=15,lr=0.0500,num_layers=2,weight_decay=0.0003_2024-07-16_06-55-59
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 2, 'num_embeddings': 14571, 'embedding_dim': 30, 'dropout_rate': 0.36, 'lr': 0.05, 'weight_decay': 0.00028480262754225174, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 0.27255613624590824, 'avg_test_loss': 0.05056202719392984}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.11223074295125182, 'avg_test_loss': 0.051332777662985565}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.11080985380443614, 'avg_test_loss': 0.051791138326128326}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.11263366980293998, 'avg_test_loss': 0.05225654586177805}
INFO:model_data_nn.py:Early stopping at epoch 4
INFO:main.py:Making prediction for data in year: 2005
INFO:main.py:Prediction data shape: (17457,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2005: 0.22908271973784258
INFO:main.py:Prediction Stats:                retq          pred
count  17457.000000  17457.000000
mean       0.011168      0.059394
std        0.223895      0.000770
min       -0.888060      0.042393
25%       -0.092593      0.058903
50%        0.000000      0.059302
75%        0.096127      0.059767
max        3.573606      0.063411
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]
INFO:transform_data_nn.py:Train_data: (432159, 161)

INFO:transform_data_nn.py:Test data years: [2005]
INFO:transform_data_nn.py:Test_data: (17457, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]
INFO:transform_data_nn.py:Retrain_data: (449616, 161)

INFO:transform_data_nn.py:Prediction data years: [2006]
INFO:transform_data_nn.py:Prediction_data: (17129, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([432159, 152])
            y_train_tf: torch.Size([432159])

            x_test_tf: torch.Size([17457, 152])
            y_test_tf: torch.Size([17457])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([449616, 152])
            y_retrain_tf: torch.Size([449616])

            x_prediction_tf: torch.Size([17129, 152])
            y_prediction_tf: torch.Size([17129])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.7339e-01,  8.4992e-01,  8.6402e-02, -1.5400e+00, -1.3984e-01,
        -8.1489e-01, -1.4654e-01, -3.4958e-01,  3.9916e-01, -1.8746e-01,
        -6.9306e-01,  8.2659e-02, -7.0223e-01, -4.8380e-01,  6.9990e-02,
         4.9457e-01, -1.3871e-01,  2.0506e-01, -6.7835e-02,  5.5422e-01,
        -4.0333e-01, -4.8444e-02, -1.4951e-01,  2.5652e-03, -8.8841e-02,
        -3.3848e-01, -5.8921e-01, -5.3741e-02,  4.8661e-01,  1.3565e+00,
         3.4964e-01, -1.4058e-01,  7.6665e-01,  2.7734e-01, -2.4610e-01,
        -2.4994e-01,  8.2909e-02,  7.5973e-01, -3.4617e-02, -1.1520e+00,
        -2.8875e-01,  2.2615e-01,  2.9726e-01,  4.0419e-02, -1.7960e-01,
        -7.4955e-01,  8.0036e-02, -3.8337e-02, -3.6052e-01, -1.6278e-01,
        -8.3355e-01,  4.6937e-01, -4.7447e-01,  9.0737e-02, -2.9689e-02,
         5.0327e-01, -6.2055e-01, -1.9281e-01, -2.5044e-01, -4.9213e-02,
        -2.9842e-05, -3.0736e-01,  5.7393e-02,  2.2353e-01,  9.0457e-02,
        -1.9447e-01,  6.7320e-01, -2.6768e-01,  6.4575e-01, -5.6356e-01,
        -3.2740e-01, -1.6271e-01, -2.9131e-02, -8.9527e-01,  1.7078e-01,
         7.0712e-01,  8.1884e-01, -1.1273e+00,  2.7984e-01,  1.1873e-02,
        -8.0590e-01,  1.7475e-01,  3.0779e-01, -1.7584e-01, -5.6411e-01,
        -4.3099e-01, -5.2815e-01, -2.7993e-01,  6.7890e-02,  1.0498e-01,
        -5.5481e-01, -1.3403e+00,  2.2558e-01, -1.1102e-16, -1.1102e-16,
         2.8310e+00, -8.4100e-02,  2.3541e+00, -2.9417e+00,  8.0874e-01,
        -8.2351e-01,  1.4608e-01,  1.2037e-01,  5.9782e-02,  3.0659e-01,
         1.2993e-01, -1.1979e-01,  2.9014e-01, -7.2199e-01, -1.0192e+00,
         6.5536e-01,  0.0000e+00,  3.4953e-01, -1.1306e-03,  1.4251e-01,
         9.3818e-04,  2.5949e-01, -2.3872e-01,  1.9013e-02, -5.7219e-01,
         1.3201e-01, -2.9745e-01, -3.9589e-01,  3.5383e-01,  3.7347e-01,
        -4.0906e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([11851]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-2.9738e-01,  7.5153e-01, -6.9859e-01,  1.3755e+00, -4.7087e-01,
        -1.8759e-01, -1.3375e+00, -8.3761e-01, -1.2325e-01,  1.9891e-02,
        -6.0898e-01, -2.3867e-01, -7.0223e-01, -1.3589e+00, -1.6912e+00,
        -9.6042e-01, -2.2222e-01, -5.5459e-01, -6.7835e-02,  8.6479e-01,
        -2.0320e-01, -1.2217e-01, -1.4458e-01, -7.0472e-01, -1.4384e-01,
        -7.3254e-01, -6.3916e-01, -5.3741e-02, -9.4243e-01, -4.9568e-01,
        -4.1341e-02, -4.7921e-01, -2.1638e-01,  2.7734e-01, -9.1269e-01,
        -6.3703e-01, -4.3146e-01, -6.1478e-01, -6.3603e-01, -5.6854e-01,
        -2.2993e-01,  1.1130e-01, -5.8439e-02,  3.2993e-01, -3.5401e-01,
         2.4189e-01, -2.4694e-01,  1.0455e+00, -8.3080e-01, -4.6759e-01,
        -1.6254e+00, -9.0452e-01, -4.7447e-01, -6.6976e-01, -7.3519e-01,
        -3.5698e-01, -9.8539e-01, -4.7531e-01,  1.4565e-01, -3.0306e-01,
        -7.5482e-02, -3.7464e-01, -1.7277e+00,  2.4459e-01, -2.7491e-02,
        -8.1128e-01,  1.7903e+00,  9.8129e-01, -2.0372e+00, -6.8266e-01,
        -3.2740e-01, -1.6271e-01, -2.9131e-02, -1.7443e-01, -2.0096e-01,
        -3.0484e-01,  8.1884e-01, -4.3326e-01,  1.4848e+00,  1.1873e-02,
        -8.0590e-01, -5.8506e-01,  6.3879e-01,  1.0993e+00,  1.7163e-01,
        -3.0619e-01, -4.2956e-01, -1.4078e-01, -4.0739e-01,  5.5157e-01,
        -2.6339e-01, -1.0277e+00,  2.2558e-01, -1.1102e-16, -1.1102e-16,
        -4.7159e-01,  5.8371e-02, -1.1678e+00,  3.1160e-01, -8.0709e-01,
        -6.8757e-01,  2.6424e-01,  1.2037e-01, -2.2485e-01,  3.0659e-01,
         8.8114e-01, -2.1660e-01,  2.9014e-01,  1.5035e+00, -5.2377e-01,
        -7.3882e-01,  0.0000e+00, -8.0589e-02,  5.2052e+00,  1.4251e-01,
         9.3818e-04, -1.1305e-01, -2.2258e-01,  1.9013e-02,  1.0175e+00,
        -1.1796e+00,  9.2318e-03, -7.3617e-01, -1.5035e-02, -3.5734e-01,
        -3.1233e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2417]), tensor(0.0304))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.6422e-01,  8.6080e-01,  8.0949e-02, -1.5621e+00, -1.3976e-01,
        -8.1094e-01, -1.4697e-01, -3.4954e-01,  4.1537e-01, -1.8795e-01,
        -6.9693e-01,  8.2605e-02, -7.0770e-01, -4.9074e-01,  7.3805e-02,
         4.9764e-01, -1.3815e-01,  2.0290e-01, -6.9999e-02,  5.5934e-01,
        -4.0490e-01, -4.1744e-02, -1.5407e-01,  1.8748e-03, -9.1832e-02,
        -3.3960e-01, -5.9071e-01, -5.7244e-02,  4.6754e-01,  1.3738e+00,
         3.5024e-01, -1.4165e-01,  7.6981e-01,  2.8198e-01, -2.4116e-01,
        -2.4579e-01,  9.2161e-02,  7.7175e-01, -3.3033e-02, -1.1472e+00,
        -2.8446e-01,  2.3391e-01,  3.0662e-01,  4.5647e-02, -1.7822e-01,
        -7.4199e-01,  8.2041e-02, -4.1488e-02, -3.6932e-01, -1.6307e-01,
        -8.3499e-01,  4.4570e-01, -4.7374e-01,  9.2545e-02, -3.0536e-02,
         5.0296e-01, -6.1273e-01, -1.9017e-01, -2.5170e-01, -4.4054e-02,
        -2.2158e-04, -3.0818e-01,  5.7115e-02,  2.2379e-01,  8.7802e-02,
        -1.9619e-01,  6.8851e-01, -2.6471e-01,  6.3766e-01, -5.6636e-01,
        -3.3152e-01, -1.6558e-01, -2.7076e-02, -8.8590e-01,  1.7233e-01,
         7.1465e-01,  8.3127e-01, -1.1374e+00,  2.8092e-01,  1.2594e-02,
        -8.0267e-01,  1.7327e-01,  3.2426e-01, -1.5055e-01, -5.6491e-01,
        -4.3553e-01, -5.3387e-01, -2.7841e-01,  7.2082e-02,  1.0874e-01,
        -5.6271e-01, -1.3407e+00,  2.2904e-01,  2.2204e-16,  2.2204e-16,
         2.8940e+00, -7.7924e-02,  2.3965e+00, -2.9751e+00,  8.4022e-01,
        -8.0438e-01,  1.5074e-01,  7.5235e-02,  6.0721e-02,  2.6063e-01,
         1.1586e-01, -1.2327e-01,  3.0730e-01, -2.0687e-01, -1.0137e+00,
         6.9188e-01, -1.5987e-14,  3.4390e-01, -1.5249e-02,  9.6888e-02,
         1.0166e-02,  2.7608e-01, -2.3681e-01,  1.8715e-02, -5.6817e-01,
         1.3303e-01, -2.8778e-01, -3.9345e-01,  3.5348e-01,  3.7222e-01,
        -4.1032e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([12077]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-8.9436e-01,  2.7926e-01, -6.7114e-01,  1.3445e+00, -5.2880e-01,
        -4.3378e-01, -1.0141e+00, -7.7123e-01, -2.4467e-01, -4.9815e-02,
        -7.3268e-01, -8.0459e-02, -7.0770e-01,  5.8780e-02, -3.3090e-01,
         2.5502e-01, -1.7869e-01,  5.2572e-02, -6.9999e-02, -3.7305e-01,
        -5.0599e-01, -1.2324e-01, -5.7890e-01,  3.8417e-01, -1.4942e-02,
        -6.2659e-01, -6.4159e-01, -5.7244e-02, -5.2518e-01, -5.3078e-01,
         6.7170e-01,  2.0342e-01,  3.7467e-01,  2.8198e-01, -6.5708e-01,
        -5.2567e-01, -5.6965e-01, -6.2066e-01, -3.9137e-01, -3.1491e-02,
        -2.4998e-01, -1.4061e-01, -2.9828e-01, -1.3421e-01, -5.6056e-01,
        -5.9725e-01,  4.1602e-01,  1.0068e-01, -4.0347e-01, -1.8266e-02,
        -8.3499e-01, -7.0011e-01, -4.7374e-01, -6.6924e-01, -7.3494e-01,
         2.9534e-01, -9.8023e-01, -3.7871e-01,  3.2971e-01, -2.5926e-01,
         2.7893e+00,  5.4242e-02,  2.2839e-01,  5.1967e-01, -2.6811e-02,
        -8.7968e-02,  4.2001e-02,  1.5137e+00,  6.3766e-01, -6.5300e-01,
        -3.3152e-01, -1.6558e-01, -2.7076e-02, -6.4940e-01,  2.6099e-02,
        -4.2064e-01,  8.3127e-01, -2.4464e-01,  1.4851e+00,  1.2594e-02,
        -8.0267e-01, -3.1879e-01,  1.5017e-01,  1.7888e-01, -2.6315e-01,
        -3.2150e-01, -4.4246e-01, -3.3687e-01, -4.3354e-01, -7.1419e-01,
        -1.7664e-01, -3.3816e-01,  2.2904e-01,  2.2204e-16,  2.2204e-16,
        -2.8560e-01, -5.1299e-01, -5.2471e-01, -1.0677e+00, -1.0559e-01,
        -8.2387e-01, -7.1678e-01, -2.5612e+00, -1.0892e+00,  1.6737e+00,
        -2.9122e-01, -1.2170e-01,  3.0730e-01,  1.4516e-01, -2.1263e-01,
        -8.4793e-01, -1.5987e-14,  1.4162e-01,  5.7856e+00,  9.6888e-02,
         1.0166e-02, -1.0840e-02, -4.4751e-01,  1.8715e-02,  9.5791e-02,
         8.6070e-01,  7.2908e-02, -4.6831e-01,  2.5641e-01,  2.8608e-01,
        -3.3344e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2364]), tensor(0.1390))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]
INFO:main.py:Testing data year: 2005
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 14571
            device: cpu
            
2024-07-16 07:57:49,914	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 07:57:49,960	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 07:57:49,998	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 07:57:50,004	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 07:57:52,720	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 08:05:26,028	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_07-57-52' in 0.1082s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 1, 'num_embeddings': 14571, 'embedding_dim': 15, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 0.000526576127715743, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.1109493089748283
INFO:model_data_nn.py:Best trial testing loss: 0.05077477242203726
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_07-57-47_517129_1361901/artifacts/2024-07-16_07-57-52/train_fnn_2024-07-16_07-57-52/driver_artifacts/train_fnn_c6d1f_00022_22_dropout_rate=0.5200,embedding_dim=15,hidden_dim=5,lr=0.0100,num_layers=1,weight_decay=0.0005_2024-07-16_07-57-52
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 1, 'num_embeddings': 14834, 'embedding_dim': 15, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 0.000526576127715743, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 1.3796660124823052, 'avg_test_loss': 0.054818728744094054}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.11152252904735781, 'avg_test_loss': 0.05158229447456438}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.10942966333872972, 'avg_test_loss': 0.051257142157696965}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.10873558104258745, 'avg_test_loss': 0.05203557384214295}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.1082877214313164, 'avg_test_loss': 0.05164277183809387}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.10834470020440674, 'avg_test_loss': 0.05182902773480807}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 2006
INFO:main.py:Prediction data shape: (17129,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2006: 0.22766035104091523
INFO:main.py:Prediction Stats:                retq          pred
count  17129.000000  17129.000000
mean       0.041924      0.024729
std        0.226924      0.026641
min       -0.891239     -0.313147
25%       -0.066391      0.017072
50%        0.021390      0.025154
75%        0.123542      0.034529
max        3.713501      0.198607
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]
INFO:transform_data_nn.py:Train_data: (449616, 161)

INFO:transform_data_nn.py:Test data years: [2006]
INFO:transform_data_nn.py:Test_data: (17129, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]
INFO:transform_data_nn.py:Retrain_data: (466745, 161)

INFO:transform_data_nn.py:Prediction data years: [2007]
INFO:transform_data_nn.py:Prediction_data: (16760, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([449616, 152])
            y_train_tf: torch.Size([449616])

            x_test_tf: torch.Size([17129, 152])
            y_test_tf: torch.Size([17129])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([466745, 152])
            y_retrain_tf: torch.Size([466745])

            x_prediction_tf: torch.Size([16760, 152])
            y_prediction_tf: torch.Size([16760])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.6422e-01,  8.6080e-01,  8.0949e-02, -1.5621e+00, -1.3976e-01,
        -8.1094e-01, -1.4697e-01, -3.4954e-01,  4.1537e-01, -1.8795e-01,
        -6.9693e-01,  8.2605e-02, -7.0770e-01, -4.9074e-01,  7.3805e-02,
         4.9764e-01, -1.3815e-01,  2.0290e-01, -6.9999e-02,  5.5934e-01,
        -4.0490e-01, -4.1744e-02, -1.5407e-01,  1.8748e-03, -9.1832e-02,
        -3.3960e-01, -5.9071e-01, -5.7244e-02,  4.6754e-01,  1.3738e+00,
         3.5024e-01, -1.4165e-01,  7.6981e-01,  2.8198e-01, -2.4116e-01,
        -2.4579e-01,  9.2161e-02,  7.7175e-01, -3.3033e-02, -1.1472e+00,
        -2.8446e-01,  2.3391e-01,  3.0662e-01,  4.5647e-02, -1.7822e-01,
        -7.4199e-01,  8.2041e-02, -4.1488e-02, -3.6932e-01, -1.6307e-01,
        -8.3499e-01,  4.4570e-01, -4.7374e-01,  9.2545e-02, -3.0536e-02,
         5.0296e-01, -6.1273e-01, -1.9017e-01, -2.5170e-01, -4.4054e-02,
        -2.2158e-04, -3.0818e-01,  5.7115e-02,  2.2379e-01,  8.7802e-02,
        -1.9619e-01,  6.8851e-01, -2.6471e-01,  6.3766e-01, -5.6636e-01,
        -3.3152e-01, -1.6558e-01, -2.7076e-02, -8.8590e-01,  1.7233e-01,
         7.1465e-01,  8.3127e-01, -1.1374e+00,  2.8092e-01,  1.2594e-02,
        -8.0267e-01,  1.7327e-01,  3.2426e-01, -1.5055e-01, -5.6491e-01,
        -4.3553e-01, -5.3387e-01, -2.7841e-01,  7.2082e-02,  1.0874e-01,
        -5.6271e-01, -1.3407e+00,  2.2904e-01,  2.2204e-16,  2.2204e-16,
         2.8940e+00, -7.7924e-02,  2.3965e+00, -2.9751e+00,  8.4022e-01,
        -8.0438e-01,  1.5074e-01,  7.5235e-02,  6.0721e-02,  2.6063e-01,
         1.1586e-01, -1.2327e-01,  3.0730e-01, -2.0687e-01, -1.0137e+00,
         6.9188e-01, -1.5987e-14,  3.4390e-01, -1.5249e-02,  9.6888e-02,
         1.0166e-02,  2.7608e-01, -2.3681e-01,  1.8715e-02, -5.6817e-01,
         1.3303e-01, -2.8778e-01, -3.9345e-01,  3.5348e-01,  3.7222e-01,
        -4.1032e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([12077]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-8.9436e-01,  2.7926e-01, -6.7114e-01,  1.3445e+00, -5.2880e-01,
        -4.3378e-01, -1.0141e+00, -7.7123e-01, -2.4467e-01, -4.9815e-02,
        -7.3268e-01, -8.0459e-02, -7.0770e-01,  5.8780e-02, -3.3090e-01,
         2.5502e-01, -1.7869e-01,  5.2572e-02, -6.9999e-02, -3.7305e-01,
        -5.0599e-01, -1.2324e-01, -5.7890e-01,  3.8417e-01, -1.4942e-02,
        -6.2659e-01, -6.4159e-01, -5.7244e-02, -5.2518e-01, -5.3078e-01,
         6.7170e-01,  2.0342e-01,  3.7467e-01,  2.8198e-01, -6.5708e-01,
        -5.2567e-01, -5.6965e-01, -6.2066e-01, -3.9137e-01, -3.1491e-02,
        -2.4998e-01, -1.4061e-01, -2.9828e-01, -1.3421e-01, -5.6056e-01,
        -5.9725e-01,  4.1602e-01,  1.0068e-01, -4.0347e-01, -1.8266e-02,
        -8.3499e-01, -7.0011e-01, -4.7374e-01, -6.6924e-01, -7.3494e-01,
         2.9534e-01, -9.8023e-01, -3.7871e-01,  3.2971e-01, -2.5926e-01,
         2.7893e+00,  5.4242e-02,  2.2839e-01,  5.1967e-01, -2.6811e-02,
        -8.7968e-02,  4.2001e-02,  1.5137e+00,  6.3766e-01, -6.5300e-01,
        -3.3152e-01, -1.6558e-01, -2.7076e-02, -6.4940e-01,  2.6099e-02,
        -4.2064e-01,  8.3127e-01, -2.4464e-01,  1.4851e+00,  1.2594e-02,
        -8.0267e-01, -3.1879e-01,  1.5017e-01,  1.7888e-01, -2.6315e-01,
        -3.2150e-01, -4.4246e-01, -3.3687e-01, -4.3354e-01, -7.1419e-01,
        -1.7664e-01, -3.3816e-01,  2.2904e-01,  2.2204e-16,  2.2204e-16,
        -2.8560e-01, -5.1299e-01, -5.2471e-01, -1.0677e+00, -1.0559e-01,
        -8.2387e-01, -7.1678e-01, -2.5612e+00, -1.0892e+00,  1.6737e+00,
        -2.9122e-01, -1.2170e-01,  3.0730e-01,  1.4516e-01, -2.1263e-01,
        -8.4793e-01, -1.5987e-14,  1.4162e-01,  5.7856e+00,  9.6888e-02,
         1.0166e-02, -1.0840e-02, -4.4751e-01,  1.8715e-02,  9.5791e-02,
         8.6070e-01,  7.2908e-02, -4.6831e-01,  2.5641e-01,  2.8608e-01,
        -3.3344e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2364]), tensor(0.1390))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.5343e-01,  8.7000e-01,  7.6211e-02, -1.5806e+00, -1.3913e-01,
        -8.0726e-01, -1.4754e-01, -3.4986e-01,  4.3093e-01, -1.8867e-01,
        -7.0019e-01,  8.0590e-02, -7.1244e-01, -4.9952e-01,  7.7213e-02,
         5.0212e-01, -1.3682e-01,  2.0030e-01, -6.9934e-02,  5.6579e-01,
        -4.0727e-01, -5.0676e-02, -1.6227e-01,  2.0041e-04, -9.4665e-02,
        -3.4049e-01, -5.9238e-01, -6.0616e-02,  4.4348e-01,  1.3890e+00,
         3.5124e-01, -1.4152e-01,  7.7590e-01,  2.8717e-01, -2.3646e-01,
        -2.4760e-01,  9.9282e-02,  7.8200e-01, -3.2885e-02, -1.1374e+00,
        -2.8039e-01,  2.4230e-01,  3.1494e-01,  5.0172e-02, -1.7757e-01,
        -7.3537e-01,  8.4181e-02, -4.3410e-02, -3.8147e-01, -1.6263e-01,
        -8.3534e-01,  4.2180e-01, -4.7317e-01,  9.1894e-02, -2.9973e-02,
         5.0152e-01, -6.0461e-01, -1.9013e-01, -2.5178e-01, -4.0858e-02,
         4.3791e-04, -3.0818e-01,  5.4131e-02,  2.2176e-01,  8.4850e-02,
        -1.9804e-01,  6.9975e-01, -2.6370e-01,  6.3515e-01, -5.6858e-01,
        -3.3489e-01, -1.6822e-01, -2.6428e-02, -8.7792e-01,  1.7216e-01,
         7.2411e-01,  8.4288e-01, -1.1481e+00,  2.8117e-01,  1.2946e-02,
        -8.2220e-01,  1.7050e-01,  3.3951e-01, -1.2513e-01, -5.6740e-01,
        -4.3948e-01, -5.3860e-01, -2.7657e-01,  7.6140e-02,  1.1048e-01,
        -5.7134e-01, -1.3411e+00,  2.3318e-01, -9.9920e-16, -9.9920e-16,
         2.9549e+00, -4.9379e-02,  2.4481e+00, -2.8995e+00,  8.6308e-01,
        -7.9107e-01,  1.5704e-01,  5.7232e-02,  6.2791e-02,  2.4593e-01,
         1.1269e-01, -1.2646e-01,  2.9148e-01, -1.9699e-01, -1.0220e+00,
         7.2637e-01, -1.0658e-14,  3.3912e-01, -2.5082e-02,  7.5466e-02,
         1.1656e-02,  2.9105e-01, -2.3589e-01,  1.8516e-02, -5.6718e-01,
         1.3557e-01, -2.7903e-01, -3.9206e-01,  3.5332e-01,  3.6987e-01,
        -4.1061e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([12309]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([ 7.1211e-02, -6.1130e-01, -4.7646e-01,  1.3171e+00, -4.1827e-01,
        -7.8553e-01, -8.0019e-01, -7.0121e-01, -2.4937e-01,  2.1620e-02,
        -7.1667e-01, -1.2501e-02, -7.1244e-01,  9.5090e-01,  6.5651e-01,
         9.0636e-01, -1.9072e-01, -1.0538e-01, -6.9934e-02,  2.3074e-01,
         5.8622e-01, -1.2556e-01, -8.5769e-02,  3.2947e-01, -8.9437e-03,
        -5.9910e-01, -6.5054e-01, -6.0616e-02, -6.4972e-01, -5.2826e-01,
        -1.7061e-01, -8.3638e-02,  4.5501e-01,  2.8717e-01, -5.8623e-01,
        -4.0731e-01, -4.1114e-01, -6.2183e-01, -5.7554e-01, -2.0258e-01,
         3.2559e+00,  2.4016e-01, -1.4834e-01, -2.3366e-01, -4.3862e-01,
        -7.6208e-01,  1.5164e-01, -2.9741e-01,  3.2750e-01,  6.8283e-01,
         7.4742e-01, -6.4967e-01, -4.7317e-01, -6.6924e-01, -7.3534e-01,
         3.9064e-01, -9.7479e-01, -3.9734e-01, -4.4041e-02, -3.5243e-01,
         3.2130e-02, -3.5033e-01, -8.3366e-02,  6.3097e-01, -2.6374e-02,
        -2.5894e-01, -5.0549e-01, -5.4346e-01,  1.3068e+00, -6.8622e-01,
        -3.3489e-01, -1.6822e-01, -2.6428e-02, -7.5642e-01,  1.0301e-01,
        -2.3588e-01,  8.4288e-01, -3.0027e-01,  1.4885e+00,  1.2946e-02,
        -8.2220e-01, -1.4700e-01,  1.2884e-01,  2.7042e+00, -5.3054e-01,
        -3.4474e-01, -4.6334e-01, -3.2356e-01, -3.1648e-01,  4.2150e-01,
        -6.1911e-01, -1.3411e+00,  2.3318e-01, -9.9920e-16, -9.9920e-16,
        -4.1690e-01, -1.5493e+00, -1.7221e-01, -1.4833e+00, -2.2984e-01,
        -8.5130e-01, -6.3868e-01,  1.8285e+00, -1.8076e+00,  2.9315e+00,
        -7.3680e-01, -1.3374e-01,  2.9148e-01,  1.1806e+00,  5.4483e-02,
        -9.5343e-01, -1.0658e-14,  1.6770e-01,  8.4219e+00,  7.5466e-02,
         1.1656e-02, -1.1986e-01, -3.5522e-01,  1.8516e-02,  1.2237e-01,
         1.0057e+00,  2.5211e-01, -3.4174e-01,  3.3789e-01,  3.8331e-01,
        -2.9598e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2311]), tensor(0.3165))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]
INFO:main.py:Testing data year: 2006
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 14834
            device: cpu
            
2024-07-16 09:01:34,583	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 09:01:34,624	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 09:01:34,660	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 09:01:34,664	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 09:01:37,367	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 09:10:38,745	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_09-01-37' in 0.1287s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 65, 'num_layers': 4, 'num_embeddings': 14834, 'embedding_dim': 25, 'dropout_rate': 0.15, 'lr': 0.005, 'weight_decay': 0.000362561763457623, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10693738349396936
INFO:model_data_nn.py:Best trial testing loss: 0.05152619118565944
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_09-01-32_212965_1361901/artifacts/2024-07-16_09-01-37/train_fnn_2024-07-16_09-01-37/driver_artifacts/train_fnn_ae7cb_00000_0_dropout_rate=0.1500,embedding_dim=25,hidden_dim=65,lr=0.0050,num_layers=4,weight_decay=0.0004_2024-07-16_09-01-37
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 65, 'num_layers': 4, 'num_embeddings': 15108, 'embedding_dim': 25, 'dropout_rate': 0.15, 'lr': 0.005, 'weight_decay': 0.000362561763457623, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 0.6725780832756866, 'avg_test_loss': 0.05961309568109838}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.11056928276166059, 'avg_test_loss': 0.05772365460341627}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.10930153594981357, 'avg_test_loss': 0.05968165375066526}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.10624178295154452, 'avg_test_loss': 0.05512482898704933}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.10349960040031492, 'avg_test_loss': 0.05503782361858722}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.10335776323387236, 'avg_test_loss': 0.05806753061937563}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.10435552304006067, 'avg_test_loss': 0.056027904519754826}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.10491946579177718, 'avg_test_loss': 0.05491337899795987}
INFO:model_data_nn.py:Epoch 9/40, metrics: {'avg_train_loss': 0.10504059728618972, 'avg_test_loss': 0.05466453883458267}
INFO:model_data_nn.py:Epoch 10/40, metrics: {'avg_train_loss': 0.10507858941625607, 'avg_test_loss': 0.05438997565458218}
INFO:model_data_nn.py:Epoch 11/40, metrics: {'avg_train_loss': 0.10498941445053277, 'avg_test_loss': 0.05567373126519449}
INFO:model_data_nn.py:Epoch 12/40, metrics: {'avg_train_loss': 0.10493234476777152, 'avg_test_loss': 0.05533095725783796}
INFO:model_data_nn.py:Epoch 13/40, metrics: {'avg_train_loss': 0.10493571319609162, 'avg_test_loss': 0.05472211570789417}
INFO:model_data_nn.py:Early stopping at epoch 13
INFO:main.py:Making prediction for data in year: 2007
INFO:main.py:Prediction data shape: (16760,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2007: 0.23321977129369578
INFO:main.py:Prediction Stats:                retq          pred
count  16760.000000  16760.000000
mean      -0.012095      0.024261
std        0.229951      0.011898
min       -0.942307      0.004176
25%       -0.121358      0.020769
50%       -0.010779      0.022048
75%        0.083408      0.023324
max        8.158734      0.295738
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]
INFO:transform_data_nn.py:Train_data: (466745, 161)

INFO:transform_data_nn.py:Test data years: [2007]
INFO:transform_data_nn.py:Test_data: (16760, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:transform_data_nn.py:Retrain_data: (483505, 161)

INFO:transform_data_nn.py:Prediction data years: [2008]
INFO:transform_data_nn.py:Prediction_data: (16465, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([466745, 152])
            y_train_tf: torch.Size([466745])

            x_test_tf: torch.Size([16760, 152])
            y_test_tf: torch.Size([16760])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([483505, 152])
            y_retrain_tf: torch.Size([483505])

            x_prediction_tf: torch.Size([16465, 152])
            y_prediction_tf: torch.Size([16465])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.5343e-01,  8.7000e-01,  7.6211e-02, -1.5806e+00, -1.3913e-01,
        -8.0726e-01, -1.4754e-01, -3.4986e-01,  4.3093e-01, -1.8867e-01,
        -7.0019e-01,  8.0590e-02, -7.1244e-01, -4.9952e-01,  7.7213e-02,
         5.0212e-01, -1.3682e-01,  2.0030e-01, -6.9934e-02,  5.6579e-01,
        -4.0727e-01, -5.0676e-02, -1.6227e-01,  2.0041e-04, -9.4665e-02,
        -3.4049e-01, -5.9238e-01, -6.0616e-02,  4.4348e-01,  1.3890e+00,
         3.5124e-01, -1.4152e-01,  7.7590e-01,  2.8717e-01, -2.3646e-01,
        -2.4760e-01,  9.9282e-02,  7.8200e-01, -3.2885e-02, -1.1374e+00,
        -2.8039e-01,  2.4230e-01,  3.1494e-01,  5.0172e-02, -1.7757e-01,
        -7.3537e-01,  8.4181e-02, -4.3410e-02, -3.8147e-01, -1.6263e-01,
        -8.3534e-01,  4.2180e-01, -4.7317e-01,  9.1894e-02, -2.9973e-02,
         5.0152e-01, -6.0461e-01, -1.9013e-01, -2.5178e-01, -4.0858e-02,
         4.3791e-04, -3.0818e-01,  5.4131e-02,  2.2176e-01,  8.4850e-02,
        -1.9804e-01,  6.9975e-01, -2.6370e-01,  6.3515e-01, -5.6858e-01,
        -3.3489e-01, -1.6822e-01, -2.6428e-02, -8.7792e-01,  1.7216e-01,
         7.2411e-01,  8.4288e-01, -1.1481e+00,  2.8117e-01,  1.2946e-02,
        -8.2220e-01,  1.7050e-01,  3.3951e-01, -1.2513e-01, -5.6740e-01,
        -4.3948e-01, -5.3860e-01, -2.7657e-01,  7.6140e-02,  1.1048e-01,
        -5.7134e-01, -1.3411e+00,  2.3318e-01, -9.9920e-16, -9.9920e-16,
         2.9549e+00, -4.9379e-02,  2.4481e+00, -2.8995e+00,  8.6308e-01,
        -7.9107e-01,  1.5704e-01,  5.7232e-02,  6.2791e-02,  2.4593e-01,
         1.1269e-01, -1.2646e-01,  2.9148e-01, -1.9699e-01, -1.0220e+00,
         7.2637e-01, -1.0658e-14,  3.3912e-01, -2.5082e-02,  7.5466e-02,
         1.1656e-02,  2.9105e-01, -2.3589e-01,  1.8516e-02, -5.6718e-01,
         1.3557e-01, -2.7903e-01, -3.9206e-01,  3.5332e-01,  3.6987e-01,
        -4.1061e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([12309]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([ 7.1211e-02, -6.1130e-01, -4.7646e-01,  1.3171e+00, -4.1827e-01,
        -7.8553e-01, -8.0019e-01, -7.0121e-01, -2.4937e-01,  2.1620e-02,
        -7.1667e-01, -1.2501e-02, -7.1244e-01,  9.5090e-01,  6.5651e-01,
         9.0636e-01, -1.9072e-01, -1.0538e-01, -6.9934e-02,  2.3074e-01,
         5.8622e-01, -1.2556e-01, -8.5769e-02,  3.2947e-01, -8.9437e-03,
        -5.9910e-01, -6.5054e-01, -6.0616e-02, -6.4972e-01, -5.2826e-01,
        -1.7061e-01, -8.3638e-02,  4.5501e-01,  2.8717e-01, -5.8623e-01,
        -4.0731e-01, -4.1114e-01, -6.2183e-01, -5.7554e-01, -2.0258e-01,
         3.2559e+00,  2.4016e-01, -1.4834e-01, -2.3366e-01, -4.3862e-01,
        -7.6208e-01,  1.5164e-01, -2.9741e-01,  3.2750e-01,  6.8283e-01,
         7.4742e-01, -6.4967e-01, -4.7317e-01, -6.6924e-01, -7.3534e-01,
         3.9064e-01, -9.7479e-01, -3.9734e-01, -4.4041e-02, -3.5243e-01,
         3.2130e-02, -3.5033e-01, -8.3366e-02,  6.3097e-01, -2.6374e-02,
        -2.5894e-01, -5.0549e-01, -5.4346e-01,  1.3068e+00, -6.8622e-01,
        -3.3489e-01, -1.6822e-01, -2.6428e-02, -7.5642e-01,  1.0301e-01,
        -2.3588e-01,  8.4288e-01, -3.0027e-01,  1.4885e+00,  1.2946e-02,
        -8.2220e-01, -1.4700e-01,  1.2884e-01,  2.7042e+00, -5.3054e-01,
        -3.4474e-01, -4.6334e-01, -3.2356e-01, -3.1648e-01,  4.2150e-01,
        -6.1911e-01, -1.3411e+00,  2.3318e-01, -9.9920e-16, -9.9920e-16,
        -4.1690e-01, -1.5493e+00, -1.7221e-01, -1.4833e+00, -2.2984e-01,
        -8.5130e-01, -6.3868e-01,  1.8285e+00, -1.8076e+00,  2.9315e+00,
        -7.3680e-01, -1.3374e-01,  2.9148e-01,  1.1806e+00,  5.4483e-02,
        -9.5343e-01, -1.0658e-14,  1.6770e-01,  8.4219e+00,  7.5466e-02,
         1.1656e-02, -1.1986e-01, -3.5522e-01,  1.8516e-02,  1.2237e-01,
         1.0057e+00,  2.5211e-01, -3.4174e-01,  3.3789e-01,  3.8331e-01,
        -2.9598e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2311]), tensor(0.3165))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.4447e-01,  8.7784e-01,  7.0549e-02, -1.5962e+00, -1.3840e-01,
        -8.0299e-01, -1.4802e-01, -3.5038e-01,  4.4537e-01, -1.9072e-01,
        -7.0250e-01,  7.7724e-02, -7.1651e-01, -5.1140e-01,  7.8370e-02,
         5.0638e-01, -1.3471e-01,  1.9865e-01, -7.4812e-02,  5.7213e-01,
        -4.1515e-01, -5.0482e-02, -1.7344e-01,  1.0633e-03, -9.7778e-02,
        -3.4116e-01, -5.9356e-01, -6.2545e-02,  4.1664e-01,  1.4043e+00,
         3.5357e-01, -1.4228e-01,  7.8786e-01,  2.9236e-01, -2.3153e-01,
        -2.4999e-01,  1.0389e-01,  7.8851e-01, -3.1875e-02, -1.1260e+00,
        -2.7656e-01,  2.5082e-01,  3.2160e-01,  5.3495e-02, -1.7702e-01,
        -7.2774e-01,  8.6251e-02, -4.3586e-02, -3.8267e-01, -1.6381e-01,
        -8.3520e-01,  3.9844e-01, -4.7255e-01,  9.1401e-02, -2.6911e-02,
         5.0135e-01, -5.9667e-01, -1.9442e-01, -2.5200e-01, -3.7946e-02,
        -1.7973e-03, -3.0818e-01,  5.1986e-02,  2.1737e-01,  8.3061e-02,
        -1.9872e-01,  7.0662e-01, -2.6441e-01,  6.3368e-01, -5.7020e-01,
        -3.3779e-01, -1.7063e-01, -2.6298e-02, -8.6899e-01,  1.7090e-01,
         7.3874e-01,  8.5342e-01, -1.1580e+00,  2.8058e-01,  1.3099e-02,
        -8.4987e-01,  1.6969e-01,  3.5410e-01, -9.9312e-02, -5.6964e-01,
        -4.4404e-01, -5.4320e-01, -2.7422e-01,  8.0564e-02,  1.0877e-01,
        -5.8058e-01, -1.3402e+00,  2.3778e-01, -7.7716e-16, -7.7716e-16,
         3.0116e+00, -4.9175e-06,  2.4971e+00, -2.8295e+00,  8.8496e-01,
        -7.9040e-01,  1.6298e-01,  4.4413e-02,  5.7049e-02,  2.2784e-01,
         1.0374e-01, -1.3021e-01,  2.8527e-01, -1.3746e-01, -1.0443e+00,
         7.5886e-01,  7.1054e-15,  3.3668e-01, -1.1245e-02,  5.5238e-02,
         1.6508e-02,  3.0458e-01, -2.3623e-01,  1.8253e-02, -5.7129e-01,
         1.3756e-01, -2.7085e-01, -3.9073e-01,  3.5460e-01,  3.6764e-01,
        -4.1046e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([12513]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-2.8202e-01,  7.6730e-01, -6.4354e-01,  1.2929e+00, -7.5015e-01,
        -2.9721e-01, -3.8841e-01, -5.0400e-01, -2.8395e-01, -5.5864e-02,
        -6.0834e-01, -6.4708e-03, -1.5971e-02, -2.5511e-01, -5.5967e-01,
        -8.3973e-01, -1.6966e-01, -5.0427e-01, -7.4812e-02, -8.6902e-01,
        -8.7255e-01, -1.2840e-01,  1.7909e-01, -1.9877e-01, -4.0563e-01,
        -2.7000e-01, -6.6181e-01, -6.2545e-02, -6.1957e-01,  6.7965e-01,
         1.9095e-01, -4.0029e-02,  3.6092e-01,  2.9236e-01, -5.7341e-01,
        -4.6189e-01, -1.5415e+00, -6.2257e-01, -9.8021e-01, -2.3680e-01,
        -1.8251e-01, -1.4659e-01, -1.8004e+00, -4.2294e-01, -7.6837e-01,
        -4.5417e-01,  3.5019e-01, -7.0584e-02,  3.6539e-01, -2.4956e-01,
        -4.3711e-02, -5.6617e-01, -4.7255e-01, -6.7074e-01, -2.6911e-02,
         1.7198e-01, -9.6937e-01, -3.5464e-01,  9.7623e-01,  3.9905e-01,
         4.3880e-01,  9.9803e-01, -1.3649e-01,  1.9927e-01, -2.6573e-02,
        -3.0099e-01,  6.4649e-01, -1.0991e+00, -3.8886e-02, -5.2024e-01,
        -3.3779e-01, -1.7063e-01, -2.6298e-02, -2.8941e-01,  2.1040e-01,
        -2.6077e-01,  8.5342e-01, -6.6354e-01,  1.4931e+00,  1.3099e-02,
        -8.4987e-01, -8.5983e-01, -2.7300e-01,  7.9895e-01, -5.0996e-01,
        -3.1457e-01, -4.4987e-01, -2.7171e-01, -3.3127e-01,  2.4969e-01,
        -6.0498e-01, -9.9415e-01,  2.3778e-01, -7.7716e-16, -7.7716e-16,
        -5.4053e-01, -2.9537e+00, -8.5046e-01, -4.0666e-01,  4.6162e-01,
         2.3150e-01, -5.8334e-01, -9.7529e-01,  3.0603e+00,  1.9120e+00,
         2.1252e-01, -1.5037e-01,  2.8527e-01,  7.3946e-01, -1.9158e-01,
        -4.4185e-01,  7.1054e-15,  2.4794e-01,  4.6009e+00,  5.5238e-02,
         1.6508e-02, -1.4692e-01, -4.9452e-01,  1.8253e-02, -2.5265e-01,
        -1.3463e+00, -4.5101e-02, -1.2896e-01,  3.6594e-01,  2.8635e-01,
        -2.9174e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2276]), tensor(-0.0378))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]
INFO:main.py:Testing data year: 2007
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15108
            device: cpu
            
2024-07-16 10:10:07,843	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 10:10:07,888	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 10:10:07,925	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 10:10:07,930	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 10:10:10,743	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 10:22:17,427	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_10-10-10' in 0.1383s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 5, 'num_embeddings': 15108, 'embedding_dim': 15, 'dropout_rate': 0.54, 'lr': 0.001, 'weight_decay': 0.00018292676411745708, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10296138588404447
INFO:model_data_nn.py:Best trial testing loss: 0.05409962365008665
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_10-10-05_435502_1361901/artifacts/2024-07-16_10-10-10/train_fnn_2024-07-16_10-10-10/driver_artifacts/train_fnn_42402_00040_40_dropout_rate=0.5400,embedding_dim=15,hidden_dim=135,lr=0.0010,num_layers=5,weight_decay=0.0002_2024-07-16_10-10-10
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 5, 'num_embeddings': 15361, 'embedding_dim': 15, 'dropout_rate': 0.54, 'lr': 0.001, 'weight_decay': 0.00018292676411745708, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 8.505927349539851, 'avg_test_loss': 0.13386033509786313}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.10732537658679037, 'avg_test_loss': 0.1334199400475392}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.10959910030849969, 'avg_test_loss': 0.12922441225785475}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.11257703451448613, 'avg_test_loss': 0.13094190261684932}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.11302333777349358, 'avg_test_loss': 0.13591666427942423}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.11088586385451088, 'avg_test_loss': 0.13953612693227255}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 2008
INFO:main.py:Prediction data shape: (16465,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2008: 0.3729433819153835
INFO:main.py:Prediction Stats:                retq          pred
count  16465.000000  16465.000000
mean      -0.119762      0.072571
std        0.319514      0.005909
min       -0.957296      0.047054
25%       -0.293863      0.069590
50%       -0.110638      0.074047
75%        0.023365      0.076345
max       10.299695      0.106844
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:transform_data_nn.py:Train_data: (483505, 161)

INFO:transform_data_nn.py:Test data years: [2008]
INFO:transform_data_nn.py:Test_data: (16465, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:transform_data_nn.py:Retrain_data: (499970, 161)

INFO:transform_data_nn.py:Prediction data years: [2009]
INFO:transform_data_nn.py:Prediction_data: (16061, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([483505, 152])
            y_train_tf: torch.Size([483505])

            x_test_tf: torch.Size([16465, 152])
            y_test_tf: torch.Size([16465])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([499970, 152])
            y_retrain_tf: torch.Size([499970])

            x_prediction_tf: torch.Size([16061, 152])
            y_prediction_tf: torch.Size([16061])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.4447e-01,  8.7784e-01,  7.0549e-02, -1.5962e+00, -1.3840e-01,
        -8.0299e-01, -1.4802e-01, -3.5038e-01,  4.4537e-01, -1.9072e-01,
        -7.0250e-01,  7.7724e-02, -7.1651e-01, -5.1140e-01,  7.8370e-02,
         5.0638e-01, -1.3471e-01,  1.9865e-01, -7.4812e-02,  5.7213e-01,
        -4.1515e-01, -5.0482e-02, -1.7344e-01,  1.0633e-03, -9.7778e-02,
        -3.4116e-01, -5.9356e-01, -6.2545e-02,  4.1664e-01,  1.4043e+00,
         3.5357e-01, -1.4228e-01,  7.8786e-01,  2.9236e-01, -2.3153e-01,
        -2.4999e-01,  1.0389e-01,  7.8851e-01, -3.1875e-02, -1.1260e+00,
        -2.7656e-01,  2.5082e-01,  3.2160e-01,  5.3495e-02, -1.7702e-01,
        -7.2774e-01,  8.6251e-02, -4.3586e-02, -3.8267e-01, -1.6381e-01,
        -8.3520e-01,  3.9844e-01, -4.7255e-01,  9.1401e-02, -2.6911e-02,
         5.0135e-01, -5.9667e-01, -1.9442e-01, -2.5200e-01, -3.7946e-02,
        -1.7973e-03, -3.0818e-01,  5.1986e-02,  2.1737e-01,  8.3061e-02,
        -1.9872e-01,  7.0662e-01, -2.6441e-01,  6.3368e-01, -5.7020e-01,
        -3.3779e-01, -1.7063e-01, -2.6298e-02, -8.6899e-01,  1.7090e-01,
         7.3874e-01,  8.5342e-01, -1.1580e+00,  2.8058e-01,  1.3099e-02,
        -8.4987e-01,  1.6969e-01,  3.5410e-01, -9.9312e-02, -5.6964e-01,
        -4.4404e-01, -5.4320e-01, -2.7422e-01,  8.0564e-02,  1.0877e-01,
        -5.8058e-01, -1.3402e+00,  2.3778e-01, -7.7716e-16, -7.7716e-16,
         3.0116e+00, -4.9175e-06,  2.4971e+00, -2.8295e+00,  8.8496e-01,
        -7.9040e-01,  1.6298e-01,  4.4413e-02,  5.7049e-02,  2.2784e-01,
         1.0374e-01, -1.3021e-01,  2.8527e-01, -1.3746e-01, -1.0443e+00,
         7.5886e-01,  7.1054e-15,  3.3668e-01, -1.1245e-02,  5.5238e-02,
         1.6508e-02,  3.0458e-01, -2.3623e-01,  1.8253e-02, -5.7129e-01,
         1.3756e-01, -2.7085e-01, -3.9073e-01,  3.5460e-01,  3.6764e-01,
        -4.1046e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([12513]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-2.8202e-01,  7.6730e-01, -6.4354e-01,  1.2929e+00, -7.5015e-01,
        -2.9721e-01, -3.8841e-01, -5.0400e-01, -2.8395e-01, -5.5864e-02,
        -6.0834e-01, -6.4708e-03, -1.5971e-02, -2.5511e-01, -5.5967e-01,
        -8.3973e-01, -1.6966e-01, -5.0427e-01, -7.4812e-02, -8.6902e-01,
        -8.7255e-01, -1.2840e-01,  1.7909e-01, -1.9877e-01, -4.0563e-01,
        -2.7000e-01, -6.6181e-01, -6.2545e-02, -6.1957e-01,  6.7965e-01,
         1.9095e-01, -4.0029e-02,  3.6092e-01,  2.9236e-01, -5.7341e-01,
        -4.6189e-01, -1.5415e+00, -6.2257e-01, -9.8021e-01, -2.3680e-01,
        -1.8251e-01, -1.4659e-01, -1.8004e+00, -4.2294e-01, -7.6837e-01,
        -4.5417e-01,  3.5019e-01, -7.0584e-02,  3.6539e-01, -2.4956e-01,
        -4.3711e-02, -5.6617e-01, -4.7255e-01, -6.7074e-01, -2.6911e-02,
         1.7198e-01, -9.6937e-01, -3.5464e-01,  9.7623e-01,  3.9905e-01,
         4.3880e-01,  9.9803e-01, -1.3649e-01,  1.9927e-01, -2.6573e-02,
        -3.0099e-01,  6.4649e-01, -1.0991e+00, -3.8886e-02, -5.2024e-01,
        -3.3779e-01, -1.7063e-01, -2.6298e-02, -2.8941e-01,  2.1040e-01,
        -2.6077e-01,  8.5342e-01, -6.6354e-01,  1.4931e+00,  1.3099e-02,
        -8.4987e-01, -8.5983e-01, -2.7300e-01,  7.9895e-01, -5.0996e-01,
        -3.1457e-01, -4.4987e-01, -2.7171e-01, -3.3127e-01,  2.4969e-01,
        -6.0498e-01, -9.9415e-01,  2.3778e-01, -7.7716e-16, -7.7716e-16,
        -5.4053e-01, -2.9537e+00, -8.5046e-01, -4.0666e-01,  4.6162e-01,
         2.3150e-01, -5.8334e-01, -9.7529e-01,  3.0603e+00,  1.9120e+00,
         2.1252e-01, -1.5037e-01,  2.8527e-01,  7.3946e-01, -1.9158e-01,
        -4.4185e-01,  7.1054e-15,  2.4794e-01,  4.6009e+00,  5.5238e-02,
         1.6508e-02, -1.4692e-01, -4.9452e-01,  1.8253e-02, -2.5265e-01,
        -1.3463e+00, -4.5101e-02, -1.2896e-01,  3.6594e-01,  2.8635e-01,
        -2.9174e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2276]), tensor(-0.0378))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.3834e-01,  8.8641e-01,  7.0010e-02, -1.6107e+00, -1.3694e-01,
        -8.1424e-01, -1.4822e-01, -3.5060e-01,  4.4198e-01, -1.8868e-01,
        -7.0388e-01,  7.9521e-02, -7.1558e-01, -5.1497e-01,  7.7327e-02,
         5.1104e-01, -1.3124e-01,  2.0309e-01, -7.7387e-02,  5.8002e-01,
        -4.1119e-01, -5.1090e-02, -1.7515e-01,  3.4879e-03, -9.8594e-02,
        -3.4145e-01, -5.9437e-01, -6.8377e-02,  3.9758e-01,  1.3974e+00,
         3.5190e-01, -1.4045e-01,  7.8751e-01,  2.9673e-01, -2.2549e-01,
        -2.4982e-01,  1.0686e-01,  7.9445e-01, -3.0162e-02, -1.1197e+00,
        -2.7480e-01,  2.8297e-01,  3.2759e-01,  4.8487e-02, -1.7661e-01,
        -7.3139e-01,  1.0241e-01, -2.8907e-02, -3.8290e-01, -1.5081e-01,
        -8.3637e-01,  3.8202e-01, -4.7150e-01,  9.0745e-02, -2.2174e-02,
         4.9990e-01, -5.8836e-01, -1.9193e-01, -2.5136e-01, -3.6155e-02,
         1.6557e-04, -3.0746e-01,  5.3572e-02,  2.1627e-01,  8.3302e-02,
        -1.9868e-01,  7.1773e-01, -2.6358e-01,  6.3520e-01, -5.7163e-01,
        -3.4078e-01, -1.7289e-01, -2.6737e-02, -8.7677e-01,  1.7389e-01,
         7.4455e-01,  8.6284e-01, -1.1669e+00,  2.8036e-01,  1.2859e-02,
        -8.5991e-01,  1.7080e-01,  3.6011e-01, -7.8064e-02, -5.7476e-01,
        -4.5096e-01, -5.4846e-01, -2.7239e-01,  8.5494e-02,  1.1281e-01,
        -5.8858e-01, -1.3406e+00,  2.4175e-01, -5.5511e-16, -5.5511e-16,
         3.0668e+00,  9.5409e-02,  2.5114e+00, -2.8713e+00,  8.4400e-01,
        -6.2231e-01,  1.7089e-01,  3.4541e-02,  5.3086e-02,  2.1588e-01,
         9.5705e-02, -1.3112e-01,  2.9994e-01, -1.7642e-01, -1.0326e+00,
         7.8098e-01,  0.0000e+00,  3.3523e-01, -1.0222e-02,  4.7863e-02,
         1.4473e-02,  3.1692e-01, -2.3714e-01,  1.7989e-02, -5.6940e-01,
         1.3832e-01, -2.6259e-01, -3.8416e-01,  3.5537e-01,  3.6571e-01,
        -4.1004e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([12754]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-8.5753e-01,  1.5961e-01, -4.3739e-01,  1.2697e+00,  8.5082e-01,
         2.0544e+00,  4.6894e-01,  1.7200e-01,  2.5960e-01, -1.1830e+00,
        -5.1503e-01, -2.6796e-01, -7.1558e-01,  1.7722e-01, -8.3372e-02,
         6.6050e-03, -2.1357e-01,  1.7785e+00,  6.2039e-03,  1.8107e-01,
         3.4686e+00, -1.3305e+00, -1.6590e-01, -1.4806e-01,  4.9132e-01,
        -7.2803e-01, -5.3560e-01, -6.8377e-02,  4.9681e-01,  3.0521e-01,
        -2.7679e+00,  7.3610e-01,  1.6269e-01, -1.1482e+00, -9.2375e-01,
        -1.2168e-01, -2.2495e-01, -3.5334e-02,  1.5339e+00,  3.4492e-01,
        -2.6568e-01, -1.5550e+00, -1.0451e-01,  1.7504e+00,  3.7970e-01,
         1.6249e+00, -9.8430e-02,  1.2935e+00, -7.7177e-01,  2.4360e+00,
         1.5402e+00,  3.0646e-01, -4.7150e-01, -3.5738e-01, -7.3471e-01,
        -1.0689e-01, -9.0435e-01, -3.1847e-01, -1.7835e-01,  4.4553e-01,
        -2.5940e-02, -2.2741e-01, -2.2083e+00, -4.8825e-01, -6.4925e-01,
        -1.3467e+00, -4.9602e-01,  5.9803e-02,  6.3520e-01, -5.1032e-01,
        -3.4078e-01, -1.7289e-01, -2.6737e-02,  2.5981e+00, -1.9809e-01,
        -6.2049e-02, -1.4252e+00, -1.6032e+00, -1.7082e+00,  1.2859e-02,
         7.9165e-01,  2.6852e-01, -5.8745e-01, -2.9587e-01, -1.5509e-01,
         7.7953e-01,  1.5779e+00, -3.8589e-01,  4.3100e-01, -1.8140e-01,
        -3.4341e-03, -6.7040e-01,  2.4175e-01, -5.5511e-16, -5.5511e-16,
        -6.8856e-02, -1.6627e+00, -1.8867e+00,  6.4900e-01,  6.2618e+00,
         6.6340e+00,  2.4243e-03, -2.3343e+00,  1.0756e-01, -3.4580e+00,
        -3.4296e-01, -2.5899e-01, -1.9375e-01,  1.7223e+00, -1.4476e+00,
        -2.8876e-01,  0.0000e+00,  4.0441e-01, -1.0222e-02, -1.0005e+00,
        -7.0403e-01, -1.1265e+00,  9.3009e-02,  1.7989e-02,  3.2092e-01,
         1.7459e-02, -1.2012e+00, -1.1096e+00,  1.0037e-01, -8.1572e-03,
        -4.1262e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1262]), tensor(-0.5694))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:main.py:Testing data year: 2008
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15361
            device: cpu
            
2024-07-16 11:21:46,231	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 11:21:46,269	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 11:21:46,303	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 11:21:46,307	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 11:21:49,326	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 11:30:18,300	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_11-21-49' in 0.1036s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 145, 'num_layers': 3, 'num_embeddings': 15361, 'embedding_dim': 30, 'dropout_rate': 0.32, 'lr': 0.001, 'weight_decay': 0.0002547052623339119, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.1066747148550333
INFO:model_data_nn.py:Best trial testing loss: 0.1434146483357136
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_11-21-43_851315_1361901/artifacts/2024-07-16_11-21-49/train_fnn_2024-07-16_11-21-49/driver_artifacts/train_fnn_4467d_00024_24_dropout_rate=0.3200,embedding_dim=30,hidden_dim=145,lr=0.0010,num_layers=3,weight_decay=0.0003_2024-07-16_11-21-49
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 145, 'num_layers': 3, 'num_embeddings': 15661, 'embedding_dim': 30, 'dropout_rate': 0.32, 'lr': 0.001, 'weight_decay': 0.0002547052623339119, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 5.422378224216806, 'avg_test_loss': 0.26132598738112145}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.10959553889055167, 'avg_test_loss': 0.2725314406293725}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.10828497801109492, 'avg_test_loss': 0.28466489618378027}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.1094329428068813, 'avg_test_loss': 0.2591401981928992}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.10939123518212089, 'avg_test_loss': 0.26437574264312547}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.10745530174387392, 'avg_test_loss': 0.28399638967618107}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.10526998899495772, 'avg_test_loss': 0.26930773134032887}
INFO:model_data_nn.py:Early stopping at epoch 7
INFO:main.py:Making prediction for data in year: 2009
INFO:main.py:Prediction data shape: (16061,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2009: 0.5194965208760707
INFO:main.py:Prediction Stats:                retq          pred
count  16061.000000  16061.000000
mean       0.139171      0.116664
std        0.512778      0.173974
min       -0.941129     -1.494187
25%       -0.088888      0.059025
50%        0.057852      0.147832
75%        0.252000      0.207988
max       18.331762      0.662287
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:transform_data_nn.py:Train_data: (499970, 161)

INFO:transform_data_nn.py:Test data years: [2009]
INFO:transform_data_nn.py:Test_data: (16061, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:transform_data_nn.py:Retrain_data: (516031, 161)

INFO:transform_data_nn.py:Prediction data years: [2010]
INFO:transform_data_nn.py:Prediction_data: (15133, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([499970, 152])
            y_train_tf: torch.Size([499970])

            x_test_tf: torch.Size([16061, 152])
            y_test_tf: torch.Size([16061])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([516031, 152])
            y_retrain_tf: torch.Size([516031])

            x_prediction_tf: torch.Size([15133, 152])
            y_prediction_tf: torch.Size([15133])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.3834e-01,  8.8641e-01,  7.0010e-02, -1.6107e+00, -1.3694e-01,
        -8.1424e-01, -1.4822e-01, -3.5060e-01,  4.4198e-01, -1.8868e-01,
        -7.0388e-01,  7.9521e-02, -7.1558e-01, -5.1497e-01,  7.7327e-02,
         5.1104e-01, -1.3124e-01,  2.0309e-01, -7.7387e-02,  5.8002e-01,
        -4.1119e-01, -5.1090e-02, -1.7515e-01,  3.4879e-03, -9.8594e-02,
        -3.4145e-01, -5.9437e-01, -6.8377e-02,  3.9758e-01,  1.3974e+00,
         3.5190e-01, -1.4045e-01,  7.8751e-01,  2.9673e-01, -2.2549e-01,
        -2.4982e-01,  1.0686e-01,  7.9445e-01, -3.0162e-02, -1.1197e+00,
        -2.7480e-01,  2.8297e-01,  3.2759e-01,  4.8487e-02, -1.7661e-01,
        -7.3139e-01,  1.0241e-01, -2.8907e-02, -3.8290e-01, -1.5081e-01,
        -8.3637e-01,  3.8202e-01, -4.7150e-01,  9.0745e-02, -2.2174e-02,
         4.9990e-01, -5.8836e-01, -1.9193e-01, -2.5136e-01, -3.6155e-02,
         1.6557e-04, -3.0746e-01,  5.3572e-02,  2.1627e-01,  8.3302e-02,
        -1.9868e-01,  7.1773e-01, -2.6358e-01,  6.3520e-01, -5.7163e-01,
        -3.4078e-01, -1.7289e-01, -2.6737e-02, -8.7677e-01,  1.7389e-01,
         7.4455e-01,  8.6284e-01, -1.1669e+00,  2.8036e-01,  1.2859e-02,
        -8.5991e-01,  1.7080e-01,  3.6011e-01, -7.8064e-02, -5.7476e-01,
        -4.5096e-01, -5.4846e-01, -2.7239e-01,  8.5494e-02,  1.1281e-01,
        -5.8858e-01, -1.3406e+00,  2.4175e-01, -5.5511e-16, -5.5511e-16,
         3.0668e+00,  9.5409e-02,  2.5114e+00, -2.8713e+00,  8.4400e-01,
        -6.2231e-01,  1.7089e-01,  3.4541e-02,  5.3086e-02,  2.1588e-01,
         9.5705e-02, -1.3112e-01,  2.9994e-01, -1.7642e-01, -1.0326e+00,
         7.8098e-01,  0.0000e+00,  3.3523e-01, -1.0222e-02,  4.7863e-02,
         1.4473e-02,  3.1692e-01, -2.3714e-01,  1.7989e-02, -5.6940e-01,
         1.3832e-01, -2.6259e-01, -3.8416e-01,  3.5537e-01,  3.6571e-01,
        -4.1004e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([12754]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-8.5753e-01,  1.5961e-01, -4.3739e-01,  1.2697e+00,  8.5082e-01,
         2.0544e+00,  4.6894e-01,  1.7200e-01,  2.5960e-01, -1.1830e+00,
        -5.1503e-01, -2.6796e-01, -7.1558e-01,  1.7722e-01, -8.3372e-02,
         6.6050e-03, -2.1357e-01,  1.7785e+00,  6.2039e-03,  1.8107e-01,
         3.4686e+00, -1.3305e+00, -1.6590e-01, -1.4806e-01,  4.9132e-01,
        -7.2803e-01, -5.3560e-01, -6.8377e-02,  4.9681e-01,  3.0521e-01,
        -2.7679e+00,  7.3610e-01,  1.6269e-01, -1.1482e+00, -9.2375e-01,
        -1.2168e-01, -2.2495e-01, -3.5334e-02,  1.5339e+00,  3.4492e-01,
        -2.6568e-01, -1.5550e+00, -1.0451e-01,  1.7504e+00,  3.7970e-01,
         1.6249e+00, -9.8430e-02,  1.2935e+00, -7.7177e-01,  2.4360e+00,
         1.5402e+00,  3.0646e-01, -4.7150e-01, -3.5738e-01, -7.3471e-01,
        -1.0689e-01, -9.0435e-01, -3.1847e-01, -1.7835e-01,  4.4553e-01,
        -2.5940e-02, -2.2741e-01, -2.2083e+00, -4.8825e-01, -6.4925e-01,
        -1.3467e+00, -4.9602e-01,  5.9803e-02,  6.3520e-01, -5.1032e-01,
        -3.4078e-01, -1.7289e-01, -2.6737e-02,  2.5981e+00, -1.9809e-01,
        -6.2049e-02, -1.4252e+00, -1.6032e+00, -1.7082e+00,  1.2859e-02,
         7.9165e-01,  2.6852e-01, -5.8745e-01, -2.9587e-01, -1.5509e-01,
         7.7953e-01,  1.5779e+00, -3.8589e-01,  4.3100e-01, -1.8140e-01,
        -3.4341e-03, -6.7040e-01,  2.4175e-01, -5.5511e-16, -5.5511e-16,
        -6.8856e-02, -1.6627e+00, -1.8867e+00,  6.4900e-01,  6.2618e+00,
         6.6340e+00,  2.4243e-03, -2.3343e+00,  1.0756e-01, -3.4580e+00,
        -3.4296e-01, -2.5899e-01, -1.9375e-01,  1.7223e+00, -1.4476e+00,
        -2.8876e-01,  0.0000e+00,  4.0441e-01, -1.0222e-02, -1.0005e+00,
        -7.0403e-01, -1.1265e+00,  9.3009e-02,  1.7989e-02,  3.2092e-01,
         1.7459e-02, -1.2012e+00, -1.1096e+00,  1.0037e-01, -8.1572e-03,
        -4.1262e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1262]), tensor(-0.5694))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.4121e-01,  8.9528e-01,  7.1463e-02, -1.6241e+00, -1.2727e-01,
        -8.2640e-01, -1.4643e-01, -3.4830e-01,  4.1360e-01, -1.8449e-01,
        -7.0624e-01,  8.7671e-02, -7.0982e-01, -5.1635e-01,  7.4806e-02,
         5.1213e-01, -1.2865e-01,  2.0872e-01, -8.1535e-02,  5.9056e-01,
        -4.1575e-01, -5.5161e-02, -1.7422e-01,  8.9817e-03, -9.5227e-02,
        -3.4136e-01, -5.9477e-01, -8.0225e-02,  3.8121e-01,  1.3623e+00,
         3.4425e-01, -1.3246e-01,  7.8188e-01,  3.0258e-01, -2.2237e-01,
        -2.4719e-01,  1.1713e-01,  7.9888e-01, -2.5969e-02, -1.1252e+00,
        -2.7520e-01,  3.2236e-01,  3.3716e-01,  3.5944e-02, -1.7170e-01,
        -7.3785e-01,  1.2651e-01, -3.9350e-02, -3.7240e-01, -1.4075e-01,
        -8.4013e-01,  3.7359e-01, -4.7051e-01,  8.8480e-02, -1.6546e-02,
         4.9786e-01, -5.8096e-01, -1.8873e-01, -2.5121e-01, -3.9380e-02,
         4.0694e-03, -3.0703e-01,  6.0828e-02,  2.1111e-01,  8.6529e-02,
        -1.9613e-01,  7.3131e-01, -2.6322e-01,  6.4098e-01, -5.7237e-01,
        -3.4422e-01, -1.7451e-01, -2.6886e-02, -8.8361e-01,  1.8117e-01,
         7.4646e-01,  8.7196e-01, -1.1736e+00,  2.7550e-01,  1.1739e-02,
        -9.2036e-01,  1.7764e-01,  3.5238e-01, -6.2739e-02, -5.7678e-01,
        -4.5776e-01, -5.5306e-01, -2.7362e-01,  9.0321e-02,  1.1504e-01,
        -5.9541e-01, -1.3428e+00,  2.4559e-01, -9.9920e-16, -9.9920e-16,
         3.1114e+00,  1.3849e-01,  2.4813e+00, -2.8954e+00,  5.9632e-01,
        -5.6662e-01,  1.8169e-01, -3.2624e-03,  2.0718e-02,  2.1226e-01,
         9.2872e-02, -1.3143e-01,  2.7299e-01,  2.4228e-01, -9.6495e-01,
         7.9448e-01,  5.3291e-15,  3.3665e-01, -1.1475e-03,  9.2821e-02,
         1.1428e-02,  3.2856e-01, -2.3612e-01,  1.7756e-02, -5.6831e-01,
         1.4121e-01, -2.5690e-01, -3.7294e-01,  3.5968e-01,  3.6648e-01,
        -4.1146e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([12906]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-2.5344e-01, -3.1096e-01, -6.7341e-01,  1.2490e+00, -4.1006e-01,
        -2.5781e-01, -5.0459e-01, -5.6837e-01, -9.2668e-02, -1.3391e-01,
        -3.0494e-01,  5.2440e-02, -7.0982e-01,  5.5361e-01,  2.3954e-01,
         1.5969e+00, -1.1194e-01,  1.4900e+00, -8.1535e-02, -1.3064e+00,
         2.7600e-01, -1.2736e-01, -5.1178e-01, -4.3434e-01,  3.2039e-01,
        -7.4341e-01, -6.4548e-01, -8.0225e-02, -6.0723e-01,  1.0306e-02,
        -3.0019e-01, -2.3412e-01,  4.1398e-01,  3.0258e-01, -5.5404e-01,
         4.7722e-01,  6.7906e-01, -6.4132e-01,  1.2262e+00, -4.8690e-01,
        -2.7090e-01,  1.5761e-02, -4.2001e-01, -3.7687e-01, -3.9244e-01,
         6.7322e-01,  3.8929e-02,  1.0615e+00, -1.0189e-01,  2.6221e-02,
         2.3339e+00, -5.3937e-01, -4.7051e-01, -6.7241e-01, -7.3405e-01,
         2.5985e-01, -9.5832e-01,  8.8949e-01, -2.1402e-01, -3.7729e-01,
         2.0044e+00,  2.0470e-01,  2.2179e+00,  2.0581e+00, -2.3054e-02,
         1.5396e+00, -4.9340e-01, -3.0781e-01,  6.4098e-01, -6.6845e-01,
        -3.4422e-01, -1.7451e-01, -2.6886e-02,  1.5724e-01,  1.7281e-01,
        -8.0240e-01,  8.7196e-01,  1.6555e-01,  1.4933e+00,  1.1739e-02,
        -9.2036e-01,  7.3198e-01, -1.6257e-01,  6.6372e-01,  9.9439e-01,
        -3.1379e-01, -4.5383e-01, -3.7081e-02, -2.5262e-01, -4.8432e-01,
         4.7028e-01, -9.4676e-01,  2.4559e-01, -9.9920e-16, -9.9920e-16,
        -2.0504e-01,  1.4241e-01, -1.7596e+00,  1.7051e+00,  1.4704e-01,
        -4.3362e-01, -1.4750e+00, -3.2624e-03, -1.1227e+00,  2.1226e-01,
         7.0597e-03, -1.9757e-01,  2.7299e-01, -1.7608e+00, -1.5179e+00,
         1.0186e+00,  5.3291e-15,  2.7466e-01,  4.5938e+00,  9.2821e-02,
         1.1428e-02, -3.0758e-01, -3.1646e-01,  1.7756e-02, -4.3565e-01,
         1.0607e+00, -8.0701e-02, -3.8260e-01,  3.5104e-01,  2.5291e-01,
        -3.3628e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2067]), tensor(0.0007))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:main.py:Testing data year: 2009
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15661
            device: cpu
            
2024-07-16 12:31:37,496	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 12:31:37,594	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 12:31:37,629	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 12:31:37,635	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 12:31:40,472	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 12:42:06,165	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_12-31-40' in 0.1281s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 3, 'num_embeddings': 15661, 'embedding_dim': 5, 'dropout_rate': 0.15, 'lr': 0.003, 'weight_decay': 1.1241862095793053e-05, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.09393799216500813
INFO:model_data_nn.py:Best trial testing loss: 0.23682189791921585
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_12-31-34_839694_1361901/artifacts/2024-07-16_12-31-40/train_fnn_2024-07-16_12-31-40/driver_artifacts/train_fnn_0685e_00017_17_dropout_rate=0.1500,embedding_dim=5,hidden_dim=135,lr=0.0030,num_layers=3,weight_decay=0.0000_2024-07-16_12-31-40
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 3, 'num_embeddings': 15845, 'embedding_dim': 5, 'dropout_rate': 0.15, 'lr': 0.003, 'weight_decay': 1.1241862095793053e-05, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 2.3831392749090723, 'avg_test_loss': 0.07860638362665971}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.11416726499345035, 'avg_test_loss': 0.09939107839018106}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.11675137739318113, 'avg_test_loss': 0.07715097613011797}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.1169914191474192, 'avg_test_loss': 0.08319970636318127}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.11463807584784393, 'avg_test_loss': 0.07434184920663635}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.11021932718410556, 'avg_test_loss': 0.07588885709022482}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.10556396201718599, 'avg_test_loss': 0.07488888337587317}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.10278587444086693, 'avg_test_loss': 0.0772031423014899}
INFO:model_data_nn.py:Early stopping at epoch 8
INFO:main.py:Making prediction for data in year: 2010
INFO:main.py:Prediction data shape: (15133,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2010: 0.2790331068635674
INFO:main.py:Prediction Stats:                retq          pred
count  15133.000000  15133.000000
mean       0.066892      0.067745
std        0.270575      0.077011
min       -0.913334     -0.263208
25%       -0.069767      0.019864
50%        0.041405      0.049994
75%        0.175515      0.101177
max        7.399156      0.859522
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:transform_data_nn.py:Train_data: (516031, 161)

INFO:transform_data_nn.py:Test data years: [2010]
INFO:transform_data_nn.py:Test_data: (15133, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:transform_data_nn.py:Retrain_data: (531164, 161)

INFO:transform_data_nn.py:Prediction data years: [2011]
INFO:transform_data_nn.py:Prediction_data: (14552, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([516031, 152])
            y_train_tf: torch.Size([516031])

            x_test_tf: torch.Size([15133, 152])
            y_test_tf: torch.Size([15133])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([531164, 152])
            y_retrain_tf: torch.Size([531164])

            x_prediction_tf: torch.Size([14552, 152])
            y_prediction_tf: torch.Size([14552])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.4121e-01,  8.9528e-01,  7.1463e-02, -1.6241e+00, -1.2727e-01,
        -8.2640e-01, -1.4643e-01, -3.4830e-01,  4.1360e-01, -1.8449e-01,
        -7.0624e-01,  8.7671e-02, -7.0982e-01, -5.1635e-01,  7.4806e-02,
         5.1213e-01, -1.2865e-01,  2.0872e-01, -8.1535e-02,  5.9056e-01,
        -4.1575e-01, -5.5161e-02, -1.7422e-01,  8.9817e-03, -9.5227e-02,
        -3.4136e-01, -5.9477e-01, -8.0225e-02,  3.8121e-01,  1.3623e+00,
         3.4425e-01, -1.3246e-01,  7.8188e-01,  3.0258e-01, -2.2237e-01,
        -2.4719e-01,  1.1713e-01,  7.9888e-01, -2.5969e-02, -1.1252e+00,
        -2.7520e-01,  3.2236e-01,  3.3716e-01,  3.5944e-02, -1.7170e-01,
        -7.3785e-01,  1.2651e-01, -3.9350e-02, -3.7240e-01, -1.4075e-01,
        -8.4013e-01,  3.7359e-01, -4.7051e-01,  8.8480e-02, -1.6546e-02,
         4.9786e-01, -5.8096e-01, -1.8873e-01, -2.5121e-01, -3.9380e-02,
         4.0694e-03, -3.0703e-01,  6.0828e-02,  2.1111e-01,  8.6529e-02,
        -1.9613e-01,  7.3131e-01, -2.6322e-01,  6.4098e-01, -5.7237e-01,
        -3.4422e-01, -1.7451e-01, -2.6886e-02, -8.8361e-01,  1.8117e-01,
         7.4646e-01,  8.7196e-01, -1.1736e+00,  2.7550e-01,  1.1739e-02,
        -9.2036e-01,  1.7764e-01,  3.5238e-01, -6.2739e-02, -5.7678e-01,
        -4.5776e-01, -5.5306e-01, -2.7362e-01,  9.0321e-02,  1.1504e-01,
        -5.9541e-01, -1.3428e+00,  2.4559e-01, -9.9920e-16, -9.9920e-16,
         3.1114e+00,  1.3849e-01,  2.4813e+00, -2.8954e+00,  5.9632e-01,
        -5.6662e-01,  1.8169e-01, -3.2624e-03,  2.0718e-02,  2.1226e-01,
         9.2872e-02, -1.3143e-01,  2.7299e-01,  2.4228e-01, -9.6495e-01,
         7.9448e-01,  5.3291e-15,  3.3665e-01, -1.1475e-03,  9.2821e-02,
         1.1428e-02,  3.2856e-01, -2.3612e-01,  1.7756e-02, -5.6831e-01,
         1.4121e-01, -2.5690e-01, -3.7294e-01,  3.5968e-01,  3.6648e-01,
        -4.1146e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([12906]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-2.5344e-01, -3.1096e-01, -6.7341e-01,  1.2490e+00, -4.1006e-01,
        -2.5781e-01, -5.0459e-01, -5.6837e-01, -9.2668e-02, -1.3391e-01,
        -3.0494e-01,  5.2440e-02, -7.0982e-01,  5.5361e-01,  2.3954e-01,
         1.5969e+00, -1.1194e-01,  1.4900e+00, -8.1535e-02, -1.3064e+00,
         2.7600e-01, -1.2736e-01, -5.1178e-01, -4.3434e-01,  3.2039e-01,
        -7.4341e-01, -6.4548e-01, -8.0225e-02, -6.0723e-01,  1.0306e-02,
        -3.0019e-01, -2.3412e-01,  4.1398e-01,  3.0258e-01, -5.5404e-01,
         4.7722e-01,  6.7906e-01, -6.4132e-01,  1.2262e+00, -4.8690e-01,
        -2.7090e-01,  1.5761e-02, -4.2001e-01, -3.7687e-01, -3.9244e-01,
         6.7322e-01,  3.8929e-02,  1.0615e+00, -1.0189e-01,  2.6221e-02,
         2.3339e+00, -5.3937e-01, -4.7051e-01, -6.7241e-01, -7.3405e-01,
         2.5985e-01, -9.5832e-01,  8.8949e-01, -2.1402e-01, -3.7729e-01,
         2.0044e+00,  2.0470e-01,  2.2179e+00,  2.0581e+00, -2.3054e-02,
         1.5396e+00, -4.9340e-01, -3.0781e-01,  6.4098e-01, -6.6845e-01,
        -3.4422e-01, -1.7451e-01, -2.6886e-02,  1.5724e-01,  1.7281e-01,
        -8.0240e-01,  8.7196e-01,  1.6555e-01,  1.4933e+00,  1.1739e-02,
        -9.2036e-01,  7.3198e-01, -1.6257e-01,  6.6372e-01,  9.9439e-01,
        -3.1379e-01, -4.5383e-01, -3.7081e-02, -2.5262e-01, -4.8432e-01,
         4.7028e-01, -9.4676e-01,  2.4559e-01, -9.9920e-16, -9.9920e-16,
        -2.0504e-01,  1.4241e-01, -1.7596e+00,  1.7051e+00,  1.4704e-01,
        -4.3362e-01, -1.4750e+00, -3.2624e-03, -1.1227e+00,  2.1226e-01,
         7.0597e-03, -1.9757e-01,  2.7299e-01, -1.7608e+00, -1.5179e+00,
         1.0186e+00,  5.3291e-15,  2.7466e-01,  4.5938e+00,  9.2821e-02,
         1.1428e-02, -3.0758e-01, -3.1646e-01,  1.7756e-02, -4.3565e-01,
         1.0607e+00, -8.0701e-02, -3.8260e-01,  3.5104e-01,  2.5291e-01,
        -3.3628e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2067]), tensor(0.0007))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.4204e-01,  9.0497e-01,  7.1025e-02, -1.6388e+00, -1.2056e-01,
        -8.2879e-01, -1.4566e-01, -3.4674e-01,  4.0978e-01, -1.8283e-01,
        -7.1041e-01,  9.1306e-02, -7.0798e-01, -5.2311e-01,  7.6981e-02,
         5.1650e-01, -1.2718e-01,  2.1020e-01, -8.0993e-02,  6.0212e-01,
        -4.0567e-01, -5.9257e-02, -1.7616e-01,  8.1113e-03, -9.1650e-02,
        -3.4175e-01, -5.9556e-01, -8.3323e-02,  3.6245e-01,  1.3576e+00,
         3.4575e-01, -1.2974e-01,  7.8350e-01,  3.0756e-01, -2.2172e-01,
        -2.3947e-01,  1.3213e-01,  8.0166e-01, -1.8019e-02, -1.1316e+00,
        -2.7344e-01,  2.8652e-01,  3.4979e-01,  3.1012e-02, -1.6565e-01,
        -7.3752e-01,  1.1264e-01, -4.6470e-02, -3.5081e-01, -1.4099e-01,
        -8.4408e-01,  3.6004e-01, -4.7003e-01,  8.6631e-02, -1.6777e-02,
         4.9713e-01, -5.7405e-01, -1.8628e-01, -2.5300e-01, -3.9390e-02,
         3.9095e-03, -3.0957e-01,  6.7811e-02,  2.1479e-01,  8.9776e-02,
        -1.9308e-01,  7.4305e-01, -2.6158e-01,  6.3569e-01, -5.7392e-01,
        -3.4702e-01, -1.7552e-01, -2.6984e-02, -8.8324e-01,  1.8516e-01,
         7.5307e-01,  8.8312e-01, -1.1774e+00,  2.7376e-01,  1.3360e-02,
        -9.5882e-01,  1.8817e-01,  3.5765e-01, -4.4799e-02, -5.7842e-01,
        -4.6241e-01, -5.5628e-01, -2.7512e-01,  9.2996e-02,  1.1420e-01,
        -6.0227e-01, -1.3410e+00,  2.4940e-01,  0.0000e+00,  0.0000e+00,
         3.1545e+00,  1.2984e-01,  2.4640e+00, -2.8995e+00,  5.9741e-01,
        -5.7146e-01,  1.9291e-01,  1.4458e-03, -3.1282e-02,  2.0882e-01,
         9.1615e-02, -1.4229e-01,  2.7212e-01,  1.4418e-01, -9.0940e-01,
         7.9023e-01,  3.5527e-15,  3.3744e-01,  6.4198e-03,  8.5865e-02,
         1.7372e-02,  3.3998e-01, -2.3104e-01,  1.7550e-02, -5.6647e-01,
         1.4017e-01, -2.4964e-01, -3.6628e-01,  3.6211e-01,  3.6720e-01,
        -4.1350e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([12960]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-1.4866e-01, -3.8436e-01,  1.6939e+00,  1.2290e+00,  1.2932e+00,
        -8.5364e-01, -5.5220e-01, -5.9230e-01, -1.4163e-01, -9.1641e-02,
        -4.8680e-01,  2.7352e-01, -7.0798e-01,  5.9831e-01,  8.0353e-02,
        -9.4614e-01,  2.0258e+00,  1.4897e+00, -8.0993e-02, -5.6157e-02,
        -2.1391e-01, -1.3037e-01, -1.5752e-01, -9.0284e-01,  8.5135e-01,
        -8.5961e-01, -5.7532e-01, -8.3323e-02,  6.7166e-01,  3.8547e-01,
         9.5406e-04,  7.4984e-01,  5.5137e-01,  3.0756e-01, -6.4749e-01,
         6.8013e-01,  4.3329e-01, -6.4366e-01,  1.1155e+00, -3.9802e-01,
        -2.7352e-01, -1.7590e-01,  3.4984e-01, -3.8674e-01,  6.9995e-01,
        -8.6480e-01, -1.8046e-01,  3.0750e-01, -8.9476e-02, -3.0337e-01,
         2.3328e+00, -2.6145e-01, -4.7003e-01, -6.7361e-01, -7.3673e-01,
         1.4283e-01, -9.5341e-01,  9.1073e-02, -7.1060e-01, -3.6045e-01,
         6.3468e-01, -5.5225e-01, -6.2751e-02, -1.3289e+00, -2.5585e-02,
        -2.5170e-01, -4.9021e-01, -3.8605e-01,  2.6573e+00, -7.2974e-01,
        -3.4702e-01, -1.7552e-01, -2.6984e-02, -1.0522e+00,  1.0922e-01,
         6.5243e-02,  8.8312e-01,  1.1512e-01,  1.4958e+00,  1.3360e-02,
        -9.5882e-01, -2.3551e-01, -4.1797e-01, -8.7387e-01, -3.8474e-01,
        -3.2019e-01, -4.5914e-01, -1.6928e-01, -5.6706e-01,  5.3923e-01,
        -2.6620e-01, -3.5075e-01,  2.4940e-01,  0.0000e+00,  0.0000e+00,
        -6.0167e-02,  2.3365e-01, -1.6341e+00,  1.2753e+00,  7.7413e-02,
        -4.6648e-01, -1.0458e-01,  1.4458e-03, -1.2036e+00,  2.0882e-01,
        -6.2544e-01, -1.6480e-01,  2.7212e-01,  1.0230e+00, -1.2542e+00,
        -8.3681e-01,  3.5527e-15,  3.7054e-01,  1.3856e+00,  8.5865e-02,
         1.7372e-02, -6.1138e-01,  2.4378e-01,  1.7550e-02, -3.4986e-01,
         1.2958e-01, -5.7191e-01, -7.4570e-01,  4.7395e-01,  4.0797e-01,
        -3.0856e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1997]), tensor(0.1286))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:main.py:Testing data year: 2010
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15845
            device: cpu
            
2024-07-16 13:47:26,047	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 13:47:26,093	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 13:47:26,134	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 13:47:26,138	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 13:47:29,147	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 13:54:54,021	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_13-47-29' in 0.1188s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 15845, 'embedding_dim': 5, 'dropout_rate': 0.44, 'lr': 0.007, 'weight_decay': 8.707410675803571e-05, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10973215459417256
INFO:model_data_nn.py:Best trial testing loss: 0.07259172253931562
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_13-47-23_663828_1361901/artifacts/2024-07-16_13-47-29/train_fnn_2024-07-16_13-47-29/driver_artifacts/train_fnn_9dbeb_00042_42_dropout_rate=0.4400,embedding_dim=5,hidden_dim=25,lr=0.0070,num_layers=1,weight_decay=0.0001_2024-07-16_13-47-29
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 15911, 'embedding_dim': 5, 'dropout_rate': 0.44, 'lr': 0.007, 'weight_decay': 8.707410675803571e-05, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 0.7375841520654868, 'avg_test_loss': 0.08144002551572364}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.11234878324959652, 'avg_test_loss': 0.07064500879169557}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.11179857296936484, 'avg_test_loss': 0.07146272474997922}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.10993301768618893, 'avg_test_loss': 0.07176316833417666}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.10845630705715661, 'avg_test_loss': 0.06891049644011155}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.10816519513726235, 'avg_test_loss': 0.06829198998840232}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.1082587999931301, 'avg_test_loss': 0.06801296424186021}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.10847058014697339, 'avg_test_loss': 0.07255609127643861}
INFO:model_data_nn.py:Epoch 9/40, metrics: {'avg_train_loss': 0.10849287774907537, 'avg_test_loss': 0.06984542833085645}
INFO:model_data_nn.py:Epoch 10/40, metrics: {'avg_train_loss': 0.10861670029989208, 'avg_test_loss': 0.07358658457534355}
INFO:model_data_nn.py:Early stopping at epoch 10
INFO:main.py:Making prediction for data in year: 2011
INFO:main.py:Prediction data shape: (14552,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2011: 0.2710912003026613
INFO:main.py:Prediction Stats:                retq          pred
count  14552.000000  14552.000000
mean      -0.010813      0.064154
std        0.256328      0.047764
min       -0.956637     -0.190648
25%       -0.153673      0.033464
50%       -0.006813      0.053391
75%        0.109958      0.082364
max        3.447154      0.418986
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:transform_data_nn.py:Train_data: (531164, 161)

INFO:transform_data_nn.py:Test data years: [2011]
INFO:transform_data_nn.py:Test_data: (14552, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:transform_data_nn.py:Retrain_data: (545716, 161)

INFO:transform_data_nn.py:Prediction data years: [2012]
INFO:transform_data_nn.py:Prediction_data: (14104, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([531164, 152])
            y_train_tf: torch.Size([531164])

            x_test_tf: torch.Size([14552, 152])
            y_test_tf: torch.Size([14552])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([545716, 152])
            y_retrain_tf: torch.Size([545716])

            x_prediction_tf: torch.Size([14104, 152])
            y_prediction_tf: torch.Size([14104])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.4204e-01,  9.0497e-01,  7.1025e-02, -1.6388e+00, -1.2056e-01,
        -8.2879e-01, -1.4566e-01, -3.4674e-01,  4.0978e-01, -1.8283e-01,
        -7.1041e-01,  9.1306e-02, -7.0798e-01, -5.2311e-01,  7.6981e-02,
         5.1650e-01, -1.2718e-01,  2.1020e-01, -8.0993e-02,  6.0212e-01,
        -4.0567e-01, -5.9257e-02, -1.7616e-01,  8.1113e-03, -9.1650e-02,
        -3.4175e-01, -5.9556e-01, -8.3323e-02,  3.6245e-01,  1.3576e+00,
         3.4575e-01, -1.2974e-01,  7.8350e-01,  3.0756e-01, -2.2172e-01,
        -2.3947e-01,  1.3213e-01,  8.0166e-01, -1.8019e-02, -1.1316e+00,
        -2.7344e-01,  2.8652e-01,  3.4979e-01,  3.1012e-02, -1.6565e-01,
        -7.3752e-01,  1.1264e-01, -4.6470e-02, -3.5081e-01, -1.4099e-01,
        -8.4408e-01,  3.6004e-01, -4.7003e-01,  8.6631e-02, -1.6777e-02,
         4.9713e-01, -5.7405e-01, -1.8628e-01, -2.5300e-01, -3.9390e-02,
         3.9095e-03, -3.0957e-01,  6.7811e-02,  2.1479e-01,  8.9776e-02,
        -1.9308e-01,  7.4305e-01, -2.6158e-01,  6.3569e-01, -5.7392e-01,
        -3.4702e-01, -1.7552e-01, -2.6984e-02, -8.8324e-01,  1.8516e-01,
         7.5307e-01,  8.8312e-01, -1.1774e+00,  2.7376e-01,  1.3360e-02,
        -9.5882e-01,  1.8817e-01,  3.5765e-01, -4.4799e-02, -5.7842e-01,
        -4.6241e-01, -5.5628e-01, -2.7512e-01,  9.2996e-02,  1.1420e-01,
        -6.0227e-01, -1.3410e+00,  2.4940e-01,  0.0000e+00,  0.0000e+00,
         3.1545e+00,  1.2984e-01,  2.4640e+00, -2.8995e+00,  5.9741e-01,
        -5.7146e-01,  1.9291e-01,  1.4458e-03, -3.1282e-02,  2.0882e-01,
         9.1615e-02, -1.4229e-01,  2.7212e-01,  1.4418e-01, -9.0940e-01,
         7.9023e-01,  3.5527e-15,  3.3744e-01,  6.4198e-03,  8.5865e-02,
         1.7372e-02,  3.3998e-01, -2.3104e-01,  1.7550e-02, -5.6647e-01,
         1.4017e-01, -2.4964e-01, -3.6628e-01,  3.6211e-01,  3.6720e-01,
        -4.1350e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([12960]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-1.4866e-01, -3.8436e-01,  1.6939e+00,  1.2290e+00,  1.2932e+00,
        -8.5364e-01, -5.5220e-01, -5.9230e-01, -1.4163e-01, -9.1641e-02,
        -4.8680e-01,  2.7352e-01, -7.0798e-01,  5.9831e-01,  8.0353e-02,
        -9.4614e-01,  2.0258e+00,  1.4897e+00, -8.0993e-02, -5.6157e-02,
        -2.1391e-01, -1.3037e-01, -1.5752e-01, -9.0284e-01,  8.5135e-01,
        -8.5961e-01, -5.7532e-01, -8.3323e-02,  6.7166e-01,  3.8547e-01,
         9.5406e-04,  7.4984e-01,  5.5137e-01,  3.0756e-01, -6.4749e-01,
         6.8013e-01,  4.3329e-01, -6.4366e-01,  1.1155e+00, -3.9802e-01,
        -2.7352e-01, -1.7590e-01,  3.4984e-01, -3.8674e-01,  6.9995e-01,
        -8.6480e-01, -1.8046e-01,  3.0750e-01, -8.9476e-02, -3.0337e-01,
         2.3328e+00, -2.6145e-01, -4.7003e-01, -6.7361e-01, -7.3673e-01,
         1.4283e-01, -9.5341e-01,  9.1073e-02, -7.1060e-01, -3.6045e-01,
         6.3468e-01, -5.5225e-01, -6.2751e-02, -1.3289e+00, -2.5585e-02,
        -2.5170e-01, -4.9021e-01, -3.8605e-01,  2.6573e+00, -7.2974e-01,
        -3.4702e-01, -1.7552e-01, -2.6984e-02, -1.0522e+00,  1.0922e-01,
         6.5243e-02,  8.8312e-01,  1.1512e-01,  1.4958e+00,  1.3360e-02,
        -9.5882e-01, -2.3551e-01, -4.1797e-01, -8.7387e-01, -3.8474e-01,
        -3.2019e-01, -4.5914e-01, -1.6928e-01, -5.6706e-01,  5.3923e-01,
        -2.6620e-01, -3.5075e-01,  2.4940e-01,  0.0000e+00,  0.0000e+00,
        -6.0167e-02,  2.3365e-01, -1.6341e+00,  1.2753e+00,  7.7413e-02,
        -4.6648e-01, -1.0458e-01,  1.4458e-03, -1.2036e+00,  2.0882e-01,
        -6.2544e-01, -1.6480e-01,  2.7212e-01,  1.0230e+00, -1.2542e+00,
        -8.3681e-01,  3.5527e-15,  3.7054e-01,  1.3856e+00,  8.5865e-02,
         1.7372e-02, -6.1138e-01,  2.4378e-01,  1.7550e-02, -3.4986e-01,
         1.2958e-01, -5.7191e-01, -7.4570e-01,  4.7395e-01,  4.0797e-01,
        -3.0856e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1997]), tensor(0.1286))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.3689e-01,  9.1157e-01,  6.9369e-02, -1.6528e+00, -1.1841e-01,
        -8.2997e-01, -1.4522e-01, -3.4551e-01,  4.0898e-01, -1.8154e-01,
        -7.1409e-01,  8.8285e-02, -7.0755e-01, -5.3051e-01,  7.9484e-02,
         5.1566e-01, -1.2543e-01,  2.0740e-01, -8.1313e-02,  6.0604e-01,
        -4.0398e-01, -6.3847e-02, -1.7607e-01,  7.2938e-03, -9.3163e-02,
        -3.4207e-01, -5.9572e-01, -8.5288e-02,  3.4276e-01,  1.3574e+00,
         3.4760e-01, -1.2902e-01,  7.8441e-01,  3.1260e-01, -2.2243e-01,
        -2.3153e-01,  1.4059e-01,  8.0375e-01, -1.4506e-02, -1.1356e+00,
        -2.7169e-01,  2.8390e-01,  3.5667e-01,  2.7859e-02, -1.6326e-01,
        -7.3498e-01,  1.0962e-01, -4.3715e-02, -3.4253e-01, -1.4341e-01,
        -8.4501e-01,  3.4471e-01, -4.6989e-01,  8.6626e-02, -1.6034e-02,
         4.9646e-01, -5.6699e-01, -1.8578e-01, -2.5334e-01, -3.5828e-02,
         8.2573e-04, -3.0962e-01,  7.1605e-02,  2.1474e-01,  8.6633e-02,
        -1.9115e-01,  7.5164e-01, -2.5935e-01,  6.2505e-01, -5.7514e-01,
        -3.4902e-01, -1.7629e-01, -2.6399e-02, -8.8201e-01,  1.8375e-01,
         7.5769e-01,  8.9317e-01, -1.1798e+00,  2.7173e-01,  1.4574e-02,
        -9.7922e-01,  1.9013e-01,  3.6375e-01, -2.7009e-02, -5.7969e-01,
        -4.6671e-01, -5.5887e-01, -2.7655e-01,  9.6208e-02,  1.1249e-01,
        -6.0925e-01, -1.3408e+00,  2.5293e-01,  1.2212e-15,  1.2212e-15,
         3.1977e+00,  1.2540e-01,  2.4540e+00, -2.9155e+00,  6.0812e-01,
        -5.8052e-01,  1.9693e-01,  7.3229e-03,  2.6452e-02,  1.9573e-01,
         5.2888e-02, -1.4760e-01,  3.1676e-01,  2.2975e-01, -8.9574e-01,
         8.0794e-01, -3.5527e-15,  3.3442e-01,  1.9658e-02,  7.4325e-02,
         1.9734e-02,  3.5144e-01, -2.2905e-01,  1.7363e-02, -5.6395e-01,
         1.4048e-01, -2.4261e-01, -3.6250e-01,  3.6109e-01,  3.6553e-01,
        -4.1516e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([13097]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-9.1540e-01,  2.4769e-01, -3.3152e-01,  1.2101e+00,  5.1742e-02,
        -8.5674e-01, -1.2410e+00, -8.2972e-01,  4.9757e-02,  1.0736e-01,
        -3.8931e-01,  1.0250e-01, -7.0755e-01,  1.1292e-01, -2.7881e-01,
        -4.2093e-01, -2.1141e-01,  4.3789e-01, -2.4972e-03, -2.1453e-02,
        -2.5788e-01, -1.3231e-01, -2.2300e-01,  1.1090e-01, -2.4793e-01,
        -7.1905e-01, -6.5163e-01, -8.5288e-02, -2.5324e-01,  6.7568e-01,
         1.0699e-02,  2.7583e-01,  4.0599e-01,  3.1260e-01, -6.5606e-01,
        -3.2582e-01,  2.2114e+00, -6.4318e-01,  3.8407e-02, -8.1228e-01,
        -2.6887e-01, -2.1768e-02,  1.5608e+00, -4.0965e-01, -2.8912e-01,
        -8.5881e-01, -7.5526e-02,  3.0800e-01,  1.4610e-01, -2.5192e-01,
        -5.1011e-02, -2.1669e-01, -4.6989e-01, -3.7144e-01, -7.3728e-01,
         7.1490e-02, -9.4836e-01, -4.4846e-01,  8.6418e-01, -2.8403e-01,
        -1.4576e-01,  8.3445e-01,  2.5686e-01,  3.0595e-01, -2.4979e-02,
        -1.0063e-01, -8.5363e-02, -1.4782e+00, -7.1970e-01, -6.1788e-01,
        -3.4902e-01, -1.7629e-01, -2.6399e-02, -1.0134e+00,  2.0826e-01,
        -2.3417e-02,  2.6780e-01,  3.3369e-01,  1.4982e+00,  1.4574e-02,
         9.2404e-01,  1.0937e-01, -3.8311e-01, -5.1559e-01, -5.7603e-01,
        -3.3527e-01, -4.6945e-01, -4.1899e-01, -3.8347e-01, -2.3051e-01,
        -5.9140e-01,  1.7751e+00,  2.5293e-01,  1.2212e-15,  1.2212e-15,
        -6.4329e-02, -7.2743e-01, -1.5994e+00,  2.1592e-01,  6.0812e-01,
         8.8690e-02, -7.0430e-02,  7.3229e-03, -8.2229e-01,  1.9573e-01,
         3.9552e+00, -1.6782e-01, -1.9428e-01,  2.0045e+00, -6.9486e-01,
        -4.2603e-01, -3.5527e-15,  3.3997e-01, -7.3946e-02, -6.4652e-01,
        -3.4309e+00, -5.9862e-01, -2.5489e-01,  1.7363e-02, -5.3383e-01,
        -6.4987e-01, -5.3894e-01, -5.1364e-01,  3.4006e-01,  1.9917e-01,
        -3.1055e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00]), tensor([1934]), tensor(0.0332))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:main.py:Testing data year: 2011
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15911
            device: cpu
            
2024-07-16 15:02:18,385	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 15:02:18,430	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 15:02:18,467	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 15:02:18,471	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 15:02:21,506	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 15:16:44,466	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_15-02-21' in 0.1082s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 5, 'num_embeddings': 15911, 'embedding_dim': 15, 'dropout_rate': 0.54, 'lr': 0.001, 'weight_decay': 0.00018292676411745708, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10541281357766634
INFO:model_data_nn.py:Best trial testing loss: 0.06585234044152394
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_15-02-15_972458_1361901/artifacts/2024-07-16_15-02-21/train_fnn_2024-07-16_15-02-21/driver_artifacts/train_fnn_13662_00040_40_dropout_rate=0.5400,embedding_dim=15,hidden_dim=135,lr=0.0010,num_layers=5,weight_decay=0.0002_2024-07-16_15-02-21
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 5, 'num_embeddings': 16081, 'embedding_dim': 15, 'dropout_rate': 0.54, 'lr': 0.001, 'weight_decay': 0.00018292676411745708, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 5.981664015130467, 'avg_test_loss': 0.07498766495180982}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.11142668301697409, 'avg_test_loss': 0.07801136138316776}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.11469219154966594, 'avg_test_loss': 0.07566939038224518}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.11665324370881741, 'avg_test_loss': 0.07723210705444217}
INFO:model_data_nn.py:Early stopping at epoch 4
INFO:main.py:Making prediction for data in year: 2012
INFO:main.py:Prediction data shape: (14104,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2012: 0.2758324156297596
INFO:main.py:Prediction Stats:                retq          pred
count  14104.000000  14104.000000
mean       0.048736      0.089056
std        0.272076      0.014472
min       -0.918750      0.010515
25%       -0.066871      0.084550
50%        0.024092      0.094138
75%        0.136884      0.098718
max       10.269234      0.111377
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:transform_data_nn.py:Train_data: (545716, 161)

INFO:transform_data_nn.py:Test data years: [2012]
INFO:transform_data_nn.py:Test_data: (14104, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:transform_data_nn.py:Retrain_data: (559820, 161)

INFO:transform_data_nn.py:Prediction data years: [2013]
INFO:transform_data_nn.py:Prediction_data: (13650, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([545716, 152])
            y_train_tf: torch.Size([545716])

            x_test_tf: torch.Size([14104, 152])
            y_test_tf: torch.Size([14104])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([559820, 152])
            y_retrain_tf: torch.Size([559820])

            x_prediction_tf: torch.Size([13650, 152])
            y_prediction_tf: torch.Size([13650])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.3689e-01,  9.1157e-01,  6.9369e-02, -1.6528e+00, -1.1841e-01,
        -8.2997e-01, -1.4522e-01, -3.4551e-01,  4.0898e-01, -1.8154e-01,
        -7.1409e-01,  8.8285e-02, -7.0755e-01, -5.3051e-01,  7.9484e-02,
         5.1566e-01, -1.2543e-01,  2.0740e-01, -8.1313e-02,  6.0604e-01,
        -4.0398e-01, -6.3847e-02, -1.7607e-01,  7.2938e-03, -9.3163e-02,
        -3.4207e-01, -5.9572e-01, -8.5288e-02,  3.4276e-01,  1.3574e+00,
         3.4760e-01, -1.2902e-01,  7.8441e-01,  3.1260e-01, -2.2243e-01,
        -2.3153e-01,  1.4059e-01,  8.0375e-01, -1.4506e-02, -1.1356e+00,
        -2.7169e-01,  2.8390e-01,  3.5667e-01,  2.7859e-02, -1.6326e-01,
        -7.3498e-01,  1.0962e-01, -4.3715e-02, -3.4253e-01, -1.4341e-01,
        -8.4501e-01,  3.4471e-01, -4.6989e-01,  8.6626e-02, -1.6034e-02,
         4.9646e-01, -5.6699e-01, -1.8578e-01, -2.5334e-01, -3.5828e-02,
         8.2573e-04, -3.0962e-01,  7.1605e-02,  2.1474e-01,  8.6633e-02,
        -1.9115e-01,  7.5164e-01, -2.5935e-01,  6.2505e-01, -5.7514e-01,
        -3.4902e-01, -1.7629e-01, -2.6399e-02, -8.8201e-01,  1.8375e-01,
         7.5769e-01,  8.9317e-01, -1.1798e+00,  2.7173e-01,  1.4574e-02,
        -9.7922e-01,  1.9013e-01,  3.6375e-01, -2.7009e-02, -5.7969e-01,
        -4.6671e-01, -5.5887e-01, -2.7655e-01,  9.6208e-02,  1.1249e-01,
        -6.0925e-01, -1.3408e+00,  2.5293e-01,  1.2212e-15,  1.2212e-15,
         3.1977e+00,  1.2540e-01,  2.4540e+00, -2.9155e+00,  6.0812e-01,
        -5.8052e-01,  1.9693e-01,  7.3229e-03,  2.6452e-02,  1.9573e-01,
         5.2888e-02, -1.4760e-01,  3.1676e-01,  2.2975e-01, -8.9574e-01,
         8.0794e-01, -3.5527e-15,  3.3442e-01,  1.9658e-02,  7.4325e-02,
         1.9734e-02,  3.5144e-01, -2.2905e-01,  1.7363e-02, -5.6395e-01,
         1.4048e-01, -2.4261e-01, -3.6250e-01,  3.6109e-01,  3.6553e-01,
        -4.1516e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([13097]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-9.1540e-01,  2.4769e-01, -3.3152e-01,  1.2101e+00,  5.1742e-02,
        -8.5674e-01, -1.2410e+00, -8.2972e-01,  4.9757e-02,  1.0736e-01,
        -3.8931e-01,  1.0250e-01, -7.0755e-01,  1.1292e-01, -2.7881e-01,
        -4.2093e-01, -2.1141e-01,  4.3789e-01, -2.4972e-03, -2.1453e-02,
        -2.5788e-01, -1.3231e-01, -2.2300e-01,  1.1090e-01, -2.4793e-01,
        -7.1905e-01, -6.5163e-01, -8.5288e-02, -2.5324e-01,  6.7568e-01,
         1.0699e-02,  2.7583e-01,  4.0599e-01,  3.1260e-01, -6.5606e-01,
        -3.2582e-01,  2.2114e+00, -6.4318e-01,  3.8407e-02, -8.1228e-01,
        -2.6887e-01, -2.1768e-02,  1.5608e+00, -4.0965e-01, -2.8912e-01,
        -8.5881e-01, -7.5526e-02,  3.0800e-01,  1.4610e-01, -2.5192e-01,
        -5.1011e-02, -2.1669e-01, -4.6989e-01, -3.7144e-01, -7.3728e-01,
         7.1490e-02, -9.4836e-01, -4.4846e-01,  8.6418e-01, -2.8403e-01,
        -1.4576e-01,  8.3445e-01,  2.5686e-01,  3.0595e-01, -2.4979e-02,
        -1.0063e-01, -8.5363e-02, -1.4782e+00, -7.1970e-01, -6.1788e-01,
        -3.4902e-01, -1.7629e-01, -2.6399e-02, -1.0134e+00,  2.0826e-01,
        -2.3417e-02,  2.6780e-01,  3.3369e-01,  1.4982e+00,  1.4574e-02,
         9.2404e-01,  1.0937e-01, -3.8311e-01, -5.1559e-01, -5.7603e-01,
        -3.3527e-01, -4.6945e-01, -4.1899e-01, -3.8347e-01, -2.3051e-01,
        -5.9140e-01,  1.7751e+00,  2.5293e-01,  1.2212e-15,  1.2212e-15,
        -6.4329e-02, -7.2743e-01, -1.5994e+00,  2.1592e-01,  6.0812e-01,
         8.8690e-02, -7.0430e-02,  7.3229e-03, -8.2229e-01,  1.9573e-01,
         3.9552e+00, -1.6782e-01, -1.9428e-01,  2.0045e+00, -6.9486e-01,
        -4.2603e-01, -3.5527e-15,  3.3997e-01, -7.3946e-02, -6.4652e-01,
        -3.4309e+00, -5.9862e-01, -2.5489e-01,  1.7363e-02, -5.3383e-01,
        -6.4987e-01, -5.3894e-01, -5.1364e-01,  3.4006e-01,  1.9917e-01,
        -3.1055e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00]), tensor([1934]), tensor(0.0332))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.3134e-01,  9.1741e-01,  6.8600e-02, -1.6661e+00, -1.1546e-01,
        -8.2999e-01, -1.4765e-01, -3.4688e-01,  4.0666e-01, -1.8007e-01,
        -7.1706e-01,  8.6669e-02, -7.0631e-01, -5.3659e-01,  8.0938e-02,
         5.1852e-01, -1.2317e-01,  2.0496e-01, -8.0231e-02,  6.1119e-01,
        -4.0744e-01, -6.4498e-02, -1.7740e-01,  8.2663e-03, -9.5221e-02,
        -3.4235e-01, -5.9517e-01, -8.6764e-02,  3.2506e-01,  1.3596e+00,
         3.4679e-01, -1.2692e-01,  7.8438e-01,  3.1710e-01, -2.2289e-01,
        -2.3086e-01,  1.4533e-01,  8.0607e-01, -1.3221e-02, -1.1325e+00,
        -2.7025e-01,  2.9709e-01,  3.6244e-01,  2.4822e-02, -1.6114e-01,
        -7.3257e-01,  1.1550e-01, -4.7342e-02, -3.5036e-01, -1.4263e-01,
        -8.4546e-01,  3.3027e-01, -4.6971e-01,  8.8318e-02, -1.3565e-02,
         4.9486e-01, -5.6010e-01, -1.8500e-01, -2.5326e-01, -3.2945e-02,
         5.2329e-04, -3.0915e-01,  7.4502e-02,  2.1366e-01,  8.6836e-02,
        -1.8950e-01,  7.5984e-01, -2.5695e-01,  6.2041e-01, -5.7606e-01,
        -3.5119e-01, -1.7717e-01, -2.5276e-02, -8.7995e-01,  1.8319e-01,
         7.6310e-01,  9.0150e-01, -1.1813e+00,  2.6892e-01,  1.4756e-02,
        -1.0024e+00,  1.9299e-01,  3.6787e-01, -1.1292e-02, -5.8009e-01,
        -4.7025e-01, -5.6101e-01, -2.7805e-01,  1.0030e-01,  1.1237e-01,
        -6.1468e-01, -1.3391e+00,  2.5619e-01,  1.3323e-15,  1.3323e-15,
         3.2409e+00,  1.5289e-01,  2.4501e+00, -2.9549e+00,  5.9736e-01,
        -5.8456e-01,  2.0129e-01,  1.0080e-02,  2.5722e-02,  1.8887e-01,
         4.4875e-02, -1.4970e-01,  2.9308e-01,  3.5833e-01, -8.7931e-01,
         8.3088e-01,  1.2434e-14,  3.3043e-01,  2.1224e-02,  7.2497e-02,
         1.7726e-02,  3.6186e-01, -2.2825e-01,  2.8958e-02, -5.6168e-01,
         1.4255e-01, -2.3650e-01, -3.5840e-01,  3.6035e-01,  3.6384e-01,
        -4.1619e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([13205]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-1.4549e-01, -3.7391e-01,  1.8760e-01,  1.1923e+00, -1.6308e-01,
        -5.1522e-01, -1.2280e+00, -8.2958e-01,  2.8453e-01,  3.7376e-01,
        -7.1323e-01, -3.7186e-02, -7.0631e-01,  5.7672e-01,  9.5974e-02,
        -5.9167e-01, -2.1170e-01,  7.9871e-01, -6.4928e-03, -3.2868e-01,
         4.6456e-02, -1.3384e-01, -8.4167e-02, -2.5031e-01, -2.6656e-01,
        -8.1576e-01, -6.6191e-01, -8.6764e-02,  3.8224e-02,  1.2989e+00,
        -1.4633e+00, -2.4447e-01,  2.4122e-01,  3.1710e-01, -7.5839e-01,
         2.6573e-01,  5.4074e-01, -6.3729e-01,  4.6888e-01, -1.1161e+00,
        -2.6478e-01, -3.2840e-01,  5.7793e-01, -2.9995e-01, -7.8543e-02,
        -7.4276e-01, -4.3808e-01, -1.5116e-01, -8.7587e-02, -2.4871e-01,
         7.4218e-01, -3.2487e-01, -4.6971e-01, -3.7833e-01, -1.3565e-02,
        -4.2524e-02, -9.4346e-01, -4.6739e-01, -5.9257e-01, -2.6549e-01,
        -2.0328e-01, -6.0882e-01,  5.8847e-02, -1.0648e+00, -2.3387e-02,
        -1.8379e-01, -4.8605e-01,  2.0428e-01,  6.2041e-01, -7.0234e-01,
        -3.5119e-01, -1.7717e-01, -2.5276e-02, -8.3436e-01, -2.0635e-02,
        -6.0002e-02,  9.0150e-01,  4.0698e-01,  1.4995e+00,  1.4756e-02,
         8.2353e-01, -6.2025e-01, -3.4493e-01, -8.4149e-01, -5.3665e-01,
        -3.7968e-01, -4.9422e-01, -3.5890e-01, -6.0860e-01, -7.1343e-01,
        -4.9902e-01,  6.7590e-01,  2.5619e-01,  1.3323e-15,  1.3323e-15,
        -1.0106e-01, -9.4955e-01, -1.5124e+00,  1.0751e-01, -1.5377e-01,
        -4.1755e-01, -1.8981e-01,  1.0080e-02, -8.2532e-01,  1.8887e-01,
         3.9336e+00, -2.2935e-01,  8.1304e-01,  2.0392e-01, -9.6015e-01,
        -6.8517e-01,  1.2434e-14,  2.2073e-01, -2.0105e+00, -3.9169e-01,
        -3.3986e+00, -5.0987e-01, -1.5158e-01,  2.8958e-02, -2.0123e-01,
         3.8092e-01, -6.5375e-01, -8.0499e-01,  1.8264e-01,  3.9108e-02,
        -3.3784e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00]), tensor([1882]), tensor(0.1081))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:main.py:Testing data year: 2012
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 16081
            device: cpu
            
2024-07-16 16:25:46,596	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 16:25:46,636	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 16:25:46,672	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_eba32acbd23df5a8.zip' (1.38MiB) to Ray cluster...
2024-07-16 16:25:46,678	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_eba32acbd23df5a8.zip'.
2024-07-16 16:25:49,722	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 16:35:44,263	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_16-25-49' in 0.1723s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 1, 'num_embeddings': 16081, 'embedding_dim': 15, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 0.000526576127715743, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10869716903226237
INFO:model_data_nn.py:Best trial testing loss: 0.07514804877739932
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_16-25-44_180137_1361901/artifacts/2024-07-16_16-25-49/train_fnn_2024-07-16_16-25-49/driver_artifacts/train_fnn_bc874_00022_22_dropout_rate=0.5200,embedding_dim=15,hidden_dim=5,lr=0.0100,num_layers=1,weight_decay=0.0005_2024-07-16_16-25-49
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 1, 'num_embeddings': 16225, 'embedding_dim': 15, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 0.000526576127715743, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 1.9345261894599128, 'avg_test_loss': 0.05839824221200413}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.108799792293018, 'avg_test_loss': 0.058864441665786284}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.10789857029056353, 'avg_test_loss': 0.05862536543497333}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.10775732896646299, 'avg_test_loss': 0.05903582226622988}
INFO:model_data_nn.py:Early stopping at epoch 4
INFO:main.py:Making prediction for data in year: 2013
INFO:main.py:Prediction data shape: (13650,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2013: 0.24086136264823815
INFO:main.py:Prediction Stats:                retq          pred
count  13650.000000  13650.000000
mean       0.095489      0.035866
std        0.233383      0.015730
min       -0.927594     -0.122665
25%       -0.012730      0.028735
50%        0.068853      0.033583
75%        0.174490      0.041307
max        3.696775      0.171347
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:transform_data_nn.py:Train_data: (559820, 161)

INFO:transform_data_nn.py:Test data years: [2013]
INFO:transform_data_nn.py:Test_data: (13650, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:transform_data_nn.py:Retrain_data: (573470, 161)

INFO:transform_data_nn.py:Prediction data years: [2014]
INFO:transform_data_nn.py:Prediction_data: (13465, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([559820, 152])
            y_train_tf: torch.Size([559820])

            x_test_tf: torch.Size([13650, 152])
            y_test_tf: torch.Size([13650])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([573470, 152])
            y_retrain_tf: torch.Size([573470])

            x_prediction_tf: torch.Size([13465, 152])
            y_prediction_tf: torch.Size([13465])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.3134e-01,  9.1741e-01,  6.8600e-02, -1.6661e+00, -1.1546e-01,
        -8.2999e-01, -1.4765e-01, -3.4688e-01,  4.0666e-01, -1.8007e-01,
        -7.1706e-01,  8.6669e-02, -7.0631e-01, -5.3659e-01,  8.0938e-02,
         5.1852e-01, -1.2317e-01,  2.0496e-01, -8.0231e-02,  6.1119e-01,
        -4.0744e-01, -6.4498e-02, -1.7740e-01,  8.2663e-03, -9.5221e-02,
        -3.4235e-01, -5.9517e-01, -8.6764e-02,  3.2506e-01,  1.3596e+00,
         3.4679e-01, -1.2692e-01,  7.8438e-01,  3.1710e-01, -2.2289e-01,
        -2.3086e-01,  1.4533e-01,  8.0607e-01, -1.3221e-02, -1.1325e+00,
        -2.7025e-01,  2.9709e-01,  3.6244e-01,  2.4822e-02, -1.6114e-01,
        -7.3257e-01,  1.1550e-01, -4.7342e-02, -3.5036e-01, -1.4263e-01,
        -8.4546e-01,  3.3027e-01, -4.6971e-01,  8.8318e-02, -1.3565e-02,
         4.9486e-01, -5.6010e-01, -1.8500e-01, -2.5326e-01, -3.2945e-02,
         5.2329e-04, -3.0915e-01,  7.4502e-02,  2.1366e-01,  8.6836e-02,
        -1.8950e-01,  7.5984e-01, -2.5695e-01,  6.2041e-01, -5.7606e-01,
        -3.5119e-01, -1.7717e-01, -2.5276e-02, -8.7995e-01,  1.8319e-01,
         7.6310e-01,  9.0150e-01, -1.1813e+00,  2.6892e-01,  1.4756e-02,
        -1.0024e+00,  1.9299e-01,  3.6787e-01, -1.1292e-02, -5.8009e-01,
        -4.7025e-01, -5.6101e-01, -2.7805e-01,  1.0030e-01,  1.1237e-01,
        -6.1468e-01, -1.3391e+00,  2.5619e-01,  1.3323e-15,  1.3323e-15,
         3.2409e+00,  1.5289e-01,  2.4501e+00, -2.9549e+00,  5.9736e-01,
        -5.8456e-01,  2.0129e-01,  1.0080e-02,  2.5722e-02,  1.8887e-01,
         4.4875e-02, -1.4970e-01,  2.9308e-01,  3.5833e-01, -8.7931e-01,
         8.3088e-01,  1.2434e-14,  3.3043e-01,  2.1224e-02,  7.2497e-02,
         1.7726e-02,  3.6186e-01, -2.2825e-01,  2.8958e-02, -5.6168e-01,
         1.4255e-01, -2.3650e-01, -3.5840e-01,  3.6035e-01,  3.6384e-01,
        -4.1619e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([13205]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-1.4549e-01, -3.7391e-01,  1.8760e-01,  1.1923e+00, -1.6308e-01,
        -5.1522e-01, -1.2280e+00, -8.2958e-01,  2.8453e-01,  3.7376e-01,
        -7.1323e-01, -3.7186e-02, -7.0631e-01,  5.7672e-01,  9.5974e-02,
        -5.9167e-01, -2.1170e-01,  7.9871e-01, -6.4928e-03, -3.2868e-01,
         4.6456e-02, -1.3384e-01, -8.4167e-02, -2.5031e-01, -2.6656e-01,
        -8.1576e-01, -6.6191e-01, -8.6764e-02,  3.8224e-02,  1.2989e+00,
        -1.4633e+00, -2.4447e-01,  2.4122e-01,  3.1710e-01, -7.5839e-01,
         2.6573e-01,  5.4074e-01, -6.3729e-01,  4.6888e-01, -1.1161e+00,
        -2.6478e-01, -3.2840e-01,  5.7793e-01, -2.9995e-01, -7.8543e-02,
        -7.4276e-01, -4.3808e-01, -1.5116e-01, -8.7587e-02, -2.4871e-01,
         7.4218e-01, -3.2487e-01, -4.6971e-01, -3.7833e-01, -1.3565e-02,
        -4.2524e-02, -9.4346e-01, -4.6739e-01, -5.9257e-01, -2.6549e-01,
        -2.0328e-01, -6.0882e-01,  5.8847e-02, -1.0648e+00, -2.3387e-02,
        -1.8379e-01, -4.8605e-01,  2.0428e-01,  6.2041e-01, -7.0234e-01,
        -3.5119e-01, -1.7717e-01, -2.5276e-02, -8.3436e-01, -2.0635e-02,
        -6.0002e-02,  9.0150e-01,  4.0698e-01,  1.4995e+00,  1.4756e-02,
         8.2353e-01, -6.2025e-01, -3.4493e-01, -8.4149e-01, -5.3665e-01,
        -3.7968e-01, -4.9422e-01, -3.5890e-01, -6.0860e-01, -7.1343e-01,
        -4.9902e-01,  6.7590e-01,  2.5619e-01,  1.3323e-15,  1.3323e-15,
        -1.0106e-01, -9.4955e-01, -1.5124e+00,  1.0751e-01, -1.5377e-01,
        -4.1755e-01, -1.8981e-01,  1.0080e-02, -8.2532e-01,  1.8887e-01,
         3.9336e+00, -2.2935e-01,  8.1304e-01,  2.0392e-01, -9.6015e-01,
        -6.8517e-01,  1.2434e-14,  2.2073e-01, -2.0105e+00, -3.9169e-01,
        -3.3986e+00, -5.0987e-01, -1.5158e-01,  2.8958e-02, -2.0123e-01,
         3.8092e-01, -6.5375e-01, -8.0499e-01,  1.8264e-01,  3.9108e-02,
        -3.3784e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00]), tensor([1882]), tensor(0.1081))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.2712e-01,  9.2409e-01,  6.6992e-02, -1.6785e+00, -1.1233e-01,
        -8.2670e-01, -1.5045e-01, -3.4872e-01,  4.0952e-01, -1.7885e-01,
        -7.1955e-01,  8.7390e-02, -7.0704e-01, -5.4205e-01,  8.3250e-02,
         5.2239e-01, -1.2151e-01,  2.0256e-01, -8.3591e-02,  6.1778e-01,
        -4.1136e-01, -6.7821e-02, -1.8047e-01,  9.7519e-03, -9.5602e-02,
        -3.4241e-01, -5.9448e-01, -8.7497e-02,  3.0576e-01,  1.3617e+00,
         3.4786e-01, -1.2465e-01,  7.8587e-01,  3.2159e-01, -2.2264e-01,
        -2.3219e-01,  1.5006e-01,  8.0883e-01, -1.1515e-02, -1.1254e+00,
        -2.6839e-01,  2.9494e-01,  3.6886e-01,  2.4009e-02, -1.5918e-01,
        -7.2673e-01,  1.1317e-01, -5.1507e-02, -3.5028e-01, -1.4660e-01,
        -8.4682e-01,  3.1403e-01, -4.6974e-01,  9.0548e-02, -1.0862e-02,
         4.9251e-01, -5.5361e-01, -1.8394e-01, -2.5323e-01, -3.0984e-02,
        -3.3121e-04, -3.0907e-01,  7.5793e-02,  2.1515e-01,  8.9659e-02,
        -1.8882e-01,  7.6813e-01, -2.5451e-01,  6.1676e-01, -5.7672e-01,
        -3.5287e-01, -1.7814e-01, -2.5421e-02, -8.7254e-01,  1.8428e-01,
         7.7113e-01,  9.0929e-01, -1.1825e+00,  2.6667e-01,  1.4808e-02,
        -1.0121e+00,  1.9789e-01,  3.7412e-01,  2.4083e-03, -5.8094e-01,
        -4.7349e-01, -5.6256e-01, -2.7868e-01,  1.0453e-01,  1.1347e-01,
        -6.1938e-01, -1.3370e+00,  2.5965e-01,  1.4433e-15,  1.4433e-15,
         3.2826e+00,  1.6600e-01,  2.4501e+00, -2.9904e+00,  6.1111e-01,
        -5.8062e-01,  2.0672e-01,  1.0280e-02, -5.3443e-02,  1.8299e-01,
         6.5259e-02, -1.5122e-01,  2.8433e-01,  4.2051e-01, -8.7025e-01,
         8.4897e-01,  3.5527e-15,  3.2663e-01,  2.2914e-02,  7.2964e-02,
         1.3990e-02,  3.7160e-01, -2.2736e-01,  5.0014e-02, -5.6005e-01,
         1.4389e-01, -2.3080e-01, -3.5506e-01,  3.6060e-01,  3.6296e-01,
        -4.1606e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([13321]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-7.5230e-01,  1.3016e-01, -3.0819e-02,  1.1761e+00,  4.5838e-02,
        -4.5548e-01, -1.2282e+00, -8.3242e-01,  4.6186e-01,  6.8586e-01,
        -4.5686e-01,  3.6876e-02, -7.0704e-01,  2.1870e-01, -1.1987e-01,
         3.9091e-01, -1.4981e-01,  2.1797e-01,  2.6314e-01, -1.2643e-01,
        -7.0538e-01, -1.3342e-01, -2.1326e-02, -5.6735e-02, -7.4411e-02,
        -7.3587e-01, -6.6603e-01, -8.7497e-02,  8.8518e-01,  1.1466e+00,
        -3.4410e-01,  1.0060e-01,  3.8847e-01,  3.2159e-01, -7.1518e-01,
         8.0116e-02,  5.6858e-01, -6.3466e-01, -2.3487e-01, -1.2279e+00,
        -2.6888e-01,  3.0810e-01,  1.1066e+00, -2.9368e-01, -1.6622e-01,
        -6.7966e-01, -2.7994e-01, -4.5495e-01, -3.5683e-01, -5.6834e-01,
         7.4103e-01, -2.9223e-01, -4.6974e-01, -3.8495e-01, -7.3774e-01,
        -8.5628e-03, -9.3887e-01, -1.9774e-01,  3.5194e-01, -1.5673e-01,
         4.6068e-02,  5.2244e-01,  6.6486e-01,  8.5647e-01, -2.2974e-02,
         1.1651e-01, -3.4466e-01, -5.7437e-01,  1.9596e+00, -6.1395e-01,
        -3.5287e-01, -1.7814e-01, -2.5421e-02, -6.8455e-01,  6.8765e-02,
         8.2196e-02,  3.1947e-01,  8.8142e-01,  1.5025e+00,  1.4808e-02,
         9.0757e-01,  2.7155e-01, -2.8203e-01, -1.2266e+00, -1.1994e-01,
        -4.0185e-01, -5.1041e-01, -3.5155e-01, -3.3836e-01, -1.8840e-01,
         5.0572e-01, -9.5103e-01,  2.5965e-01,  1.4433e-15,  1.4433e-15,
        -3.1069e-01,  2.4798e-01, -1.4549e+00,  1.0411e+00, -6.3947e-01,
        -4.9844e-01, -3.6311e-01,  1.0280e-02, -4.7432e-01,  1.8299e-01,
         3.3030e+00, -2.0420e-01,  1.0471e-01,  2.9919e-01, -5.0049e-01,
        -1.7612e-01,  3.5527e-15,  2.8477e-01, -1.3643e+00, -1.6462e-01,
        -3.3745e+00, -5.0529e-01, -2.4294e-01,  5.0014e-02, -5.6760e-01,
        -3.4870e-01, -6.2531e-01, -6.7829e-01,  2.5647e-01,  1.1355e-01,
        -3.3697e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1853]), tensor(0.2707))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:main.py:Testing data year: 2013
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 16225
            device: cpu
            
2024-07-16 17:46:10,729	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 17:46:10,778	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 17:46:10,820	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_524ec76d8a57c10b.zip' (1.31MiB) to Ray cluster...
2024-07-16 17:46:10,825	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_524ec76d8a57c10b.zip'.
2024-07-16 17:46:13,743	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 17:55:36,939	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_17-46-13' in 0.1450s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 16225, 'embedding_dim': 5, 'dropout_rate': 0.19, 'lr': 0.05, 'weight_decay': 1.9489008462344248e-05, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.11255468130384234
INFO:model_data_nn.py:Best trial testing loss: 0.05571839792860879
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_17-46-08_245437_1361901/artifacts/2024-07-16_17-46-13/train_fnn_2024-07-16_17-46-13/driver_artifacts/train_fnn_f7de7_00027_27_dropout_rate=0.1900,embedding_dim=5,hidden_dim=45,lr=0.0500,num_layers=1,weight_decay=0.0000_2024-07-16_17-46-13
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 16362, 'embedding_dim': 5, 'dropout_rate': 0.19, 'lr': 0.05, 'weight_decay': 1.9489008462344248e-05, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 0.36978533398734037, 'avg_test_loss': 0.06712948182984343}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.10715675159178371, 'avg_test_loss': 0.05994187295436859}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.10587462705893742, 'avg_test_loss': 0.05902161522996875}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.16533521561983547, 'avg_test_loss': 0.06401764302742931}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.1073358383067933, 'avg_test_loss': 0.05712777959569445}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.10679538056773034, 'avg_test_loss': 0.07115383379442512}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.2208823034475819, 'avg_test_loss': 0.0598822100755741}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.10821117142889447, 'avg_test_loss': 0.05564432552541202}
INFO:model_data_nn.py:Epoch 9/40, metrics: {'avg_train_loss': 0.1068017223233998, 'avg_test_loss': 0.05732966456913723}
INFO:model_data_nn.py:Epoch 10/40, metrics: {'avg_train_loss': 0.11676732866473359, 'avg_test_loss': 11.67633468699905}
INFO:model_data_nn.py:Epoch 11/40, metrics: {'avg_train_loss': 0.34953335446872014, 'avg_test_loss': 0.058449445749228855}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main.py:Making prediction for data in year: 2014
INFO:main.py:Prediction data shape: (13465,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2014: 0.24126706024657416
INFO:main.py:Prediction Stats:                retq          pred
count  13465.000000  13465.000000
mean       0.014125      0.059393
std        0.233495      0.029738
min       -0.876499     -0.028546
25%       -0.083091      0.041474
50%        0.002797      0.052380
75%        0.098080      0.067297
max        6.562500      0.320915
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:transform_data_nn.py:Train_data: (573470, 161)

INFO:transform_data_nn.py:Test data years: [2014]
INFO:transform_data_nn.py:Test_data: (13465, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:transform_data_nn.py:Retrain_data: (586935, 161)

INFO:transform_data_nn.py:Prediction data years: [2015]
INFO:transform_data_nn.py:Prediction_data: (13715, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([573470, 152])
            y_train_tf: torch.Size([573470])

            x_test_tf: torch.Size([13465, 152])
            y_test_tf: torch.Size([13465])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([586935, 152])
            y_retrain_tf: torch.Size([586935])

            x_prediction_tf: torch.Size([13715, 152])
            y_prediction_tf: torch.Size([13715])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.2712e-01,  9.2409e-01,  6.6992e-02, -1.6785e+00, -1.1233e-01,
        -8.2670e-01, -1.5045e-01, -3.4872e-01,  4.0952e-01, -1.7885e-01,
        -7.1955e-01,  8.7390e-02, -7.0704e-01, -5.4205e-01,  8.3250e-02,
         5.2239e-01, -1.2151e-01,  2.0256e-01, -8.3591e-02,  6.1778e-01,
        -4.1136e-01, -6.7821e-02, -1.8047e-01,  9.7519e-03, -9.5602e-02,
        -3.4241e-01, -5.9448e-01, -8.7497e-02,  3.0576e-01,  1.3617e+00,
         3.4786e-01, -1.2465e-01,  7.8587e-01,  3.2159e-01, -2.2264e-01,
        -2.3219e-01,  1.5006e-01,  8.0883e-01, -1.1515e-02, -1.1254e+00,
        -2.6839e-01,  2.9494e-01,  3.6886e-01,  2.4009e-02, -1.5918e-01,
        -7.2673e-01,  1.1317e-01, -5.1507e-02, -3.5028e-01, -1.4660e-01,
        -8.4682e-01,  3.1403e-01, -4.6974e-01,  9.0548e-02, -1.0862e-02,
         4.9251e-01, -5.5361e-01, -1.8394e-01, -2.5323e-01, -3.0984e-02,
        -3.3121e-04, -3.0907e-01,  7.5793e-02,  2.1515e-01,  8.9659e-02,
        -1.8882e-01,  7.6813e-01, -2.5451e-01,  6.1676e-01, -5.7672e-01,
        -3.5287e-01, -1.7814e-01, -2.5421e-02, -8.7254e-01,  1.8428e-01,
         7.7113e-01,  9.0929e-01, -1.1825e+00,  2.6667e-01,  1.4808e-02,
        -1.0121e+00,  1.9789e-01,  3.7412e-01,  2.4083e-03, -5.8094e-01,
        -4.7349e-01, -5.6256e-01, -2.7868e-01,  1.0453e-01,  1.1347e-01,
        -6.1938e-01, -1.3370e+00,  2.5965e-01,  1.4433e-15,  1.4433e-15,
         3.2826e+00,  1.6600e-01,  2.4501e+00, -2.9904e+00,  6.1111e-01,
        -5.8062e-01,  2.0672e-01,  1.0280e-02, -5.3443e-02,  1.8299e-01,
         6.5259e-02, -1.5122e-01,  2.8433e-01,  4.2051e-01, -8.7025e-01,
         8.4897e-01,  3.5527e-15,  3.2663e-01,  2.2914e-02,  7.2964e-02,
         1.3990e-02,  3.7160e-01, -2.2736e-01,  5.0014e-02, -5.6005e-01,
         1.4389e-01, -2.3080e-01, -3.5506e-01,  3.6060e-01,  3.6296e-01,
        -4.1606e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([13321]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-7.5230e-01,  1.3016e-01, -3.0819e-02,  1.1761e+00,  4.5838e-02,
        -4.5548e-01, -1.2282e+00, -8.3242e-01,  4.6186e-01,  6.8586e-01,
        -4.5686e-01,  3.6876e-02, -7.0704e-01,  2.1870e-01, -1.1987e-01,
         3.9091e-01, -1.4981e-01,  2.1797e-01,  2.6314e-01, -1.2643e-01,
        -7.0538e-01, -1.3342e-01, -2.1326e-02, -5.6735e-02, -7.4411e-02,
        -7.3587e-01, -6.6603e-01, -8.7497e-02,  8.8518e-01,  1.1466e+00,
        -3.4410e-01,  1.0060e-01,  3.8847e-01,  3.2159e-01, -7.1518e-01,
         8.0116e-02,  5.6858e-01, -6.3466e-01, -2.3487e-01, -1.2279e+00,
        -2.6888e-01,  3.0810e-01,  1.1066e+00, -2.9368e-01, -1.6622e-01,
        -6.7966e-01, -2.7994e-01, -4.5495e-01, -3.5683e-01, -5.6834e-01,
         7.4103e-01, -2.9223e-01, -4.6974e-01, -3.8495e-01, -7.3774e-01,
        -8.5628e-03, -9.3887e-01, -1.9774e-01,  3.5194e-01, -1.5673e-01,
         4.6068e-02,  5.2244e-01,  6.6486e-01,  8.5647e-01, -2.2974e-02,
         1.1651e-01, -3.4466e-01, -5.7437e-01,  1.9596e+00, -6.1395e-01,
        -3.5287e-01, -1.7814e-01, -2.5421e-02, -6.8455e-01,  6.8765e-02,
         8.2196e-02,  3.1947e-01,  8.8142e-01,  1.5025e+00,  1.4808e-02,
         9.0757e-01,  2.7155e-01, -2.8203e-01, -1.2266e+00, -1.1994e-01,
        -4.0185e-01, -5.1041e-01, -3.5155e-01, -3.3836e-01, -1.8840e-01,
         5.0572e-01, -9.5103e-01,  2.5965e-01,  1.4433e-15,  1.4433e-15,
        -3.1069e-01,  2.4798e-01, -1.4549e+00,  1.0411e+00, -6.3947e-01,
        -4.9844e-01, -3.6311e-01,  1.0280e-02, -4.7432e-01,  1.8299e-01,
         3.3030e+00, -2.0420e-01,  1.0471e-01,  2.9919e-01, -5.0049e-01,
        -1.7612e-01,  3.5527e-15,  2.8477e-01, -1.3643e+00, -1.6462e-01,
        -3.3745e+00, -5.0529e-01, -2.4294e-01,  5.0014e-02, -5.6760e-01,
        -3.4870e-01, -6.2531e-01, -6.7829e-01,  2.5647e-01,  1.1355e-01,
        -3.3697e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1853]), tensor(0.2707))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.2297e-01,  9.3129e-01,  6.5636e-02, -1.6897e+00, -1.1095e-01,
        -8.2298e-01, -1.5324e-01, -3.5066e-01,  4.1632e-01, -1.7877e-01,
        -7.2170e-01,  8.9094e-02, -7.1006e-01, -5.4722e-01,  8.5773e-02,
         5.2549e-01, -1.2008e-01,  2.0266e-01, -8.4213e-02,  6.2454e-01,
        -4.0895e-01, -6.6791e-02, -1.8372e-01,  1.0453e-02, -9.5881e-02,
        -3.4276e-01, -5.9379e-01, -9.0171e-02,  2.8383e-01,  1.3663e+00,
         3.4980e-01, -1.2416e-01,  7.8868e-01,  3.2531e-01, -2.2196e-01,
        -2.3097e-01,  1.5455e-01,  8.0949e-01, -9.3699e-03, -1.1168e+00,
        -2.6601e-01,  2.8564e-01,  3.7528e-01,  2.5188e-02, -1.5746e-01,
        -7.2033e-01,  1.0760e-01, -5.1448e-02, -3.5141e-01, -1.4899e-01,
        -8.4783e-01,  2.9581e-01, -4.6980e-01,  9.2151e-02, -8.2883e-03,
         4.9036e-01, -5.4727e-01, -1.8323e-01, -2.5408e-01, -2.8635e-02,
        -1.4982e-03, -3.0983e-01,  7.3052e-02,  2.1674e-01,  9.1409e-02,
        -1.9114e-01,  7.7571e-01, -2.5242e-01,  6.1363e-01, -5.7728e-01,
        -3.5407e-01, -1.7923e-01, -2.5364e-02, -8.6483e-01,  1.8619e-01,
         7.7950e-01,  9.1719e-01, -1.1852e+00,  2.6439e-01,  1.5025e-02,
        -1.0150e+00,  2.0181e-01,  3.8299e-01,  1.7625e-02, -5.8125e-01,
        -4.7682e-01, -5.6400e-01, -2.7840e-01,  1.0834e-01,  1.1444e-01,
        -6.2445e-01, -1.3359e+00,  2.6316e-01,  1.3323e-15,  1.3323e-15,
         3.3235e+00,  1.6146e-01,  2.4532e+00, -3.0225e+00,  6.3244e-01,
        -5.7335e-01,  2.1253e-01,  1.2189e-02, -5.2237e-02,  1.7609e-01,
         6.5543e-02, -1.5258e-01,  2.8951e-01,  4.8873e-01, -8.6323e-01,
         8.6470e-01,  1.4211e-14,  3.2292e-01,  1.4093e-02,  6.5325e-02,
         1.6333e-02,  3.8096e-01, -2.2697e-01,  6.3748e-02, -5.5838e-01,
         1.4427e-01, -2.2475e-01, -3.5316e-01,  3.6115e-01,  3.6161e-01,
        -4.1541e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([13469]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-3.5774e-01, -1.8605e-01, -5.3812e-01,  1.1617e+00, -2.3422e-01,
        -5.4884e-01, -9.8823e-01, -7.7397e-01,  8.0277e-02,  3.3126e-01,
        -7.4848e-01,  1.0178e-02, -7.1006e-01,  3.6292e-01,  5.4398e-02,
         3.3245e-01, -2.0969e-01,  7.2537e-01, -1.1900e-02, -4.5638e-03,
        -5.9686e-01, -1.2395e+00, -3.6291e-01, -1.8387e-01, -3.4472e-01,
        -8.0183e-01, -6.6412e-01, -9.0171e-02,  1.9067e-01,  8.7317e-01,
        -1.8547e-01, -2.3838e-01,  2.8462e-01,  3.2531e-01, -7.7393e-01,
        -3.7375e-01,  1.5995e-01, -6.3930e-01,  2.8817e-01, -9.8606e-01,
        -2.6549e-01,  1.5027e-02, -2.3144e-01, -3.6104e-01, -1.7781e-01,
        -8.0229e-01,  6.5681e-01, -3.1208e-01, -5.7922e-01,  1.6285e-01,
         1.5337e+00, -1.5721e-01, -4.6980e-01, -3.9189e-01, -8.2883e-03,
        -6.7610e-02, -9.3437e-01,  5.0216e-02, -4.7276e-01,  1.0803e-01,
        -7.0768e-01, -5.1945e-01,  2.9076e-01,  7.5764e-01, -2.3098e-02,
        -9.2962e-02, -4.8128e-01,  1.3564e-01,  6.1363e-01, -6.8169e-01,
        -3.5407e-01, -1.7923e-01, -2.5364e-02, -8.7973e-01,  2.8922e-03,
        -1.0470e-01,  9.1719e-01,  8.8083e-01,  1.5062e+00,  1.5025e-02,
         8.6924e-01,  2.7747e-01, -3.3537e-01, -1.0518e+00, -4.4547e-01,
        -3.8114e-01, -5.0047e-01, -3.3548e-01, -6.4803e-01, -3.9025e-01,
        -3.3281e-01, -2.5707e-01,  2.6316e-01,  1.3323e-15,  1.3323e-15,
        -2.1744e-01, -8.7120e-02, -1.4168e+00,  1.0835e-01, -1.9652e-01,
        -1.1579e-01, -3.6732e-03,  1.2189e-02, -2.0997e-01,  1.7609e-01,
         2.6332e+00, -2.0607e-01,  5.3732e-01,  2.4851e-01, -3.6536e-01,
        -4.3748e-01,  1.4211e-14,  1.2293e-01, -6.7237e-01, -5.1786e-01,
        -6.8808e-01, -4.5964e-01, -2.4675e-01,  6.3748e-02, -3.8448e-01,
         2.9366e-01, -4.9552e-01, -7.1746e-01,  2.3160e-01,  9.2251e-02,
        -3.8407e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00]), tensor([1907]), tensor(-0.0839))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:main.py:Testing data year: 2014
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 16362
            device: cpu
            
2024-07-16 19:07:38,045	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 19:07:38,089	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 19:07:38,126	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_524ec76d8a57c10b.zip' (1.31MiB) to Ray cluster...
2024-07-16 19:07:38,131	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_524ec76d8a57c10b.zip'.
2024-07-16 19:07:41,112	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 19:18:53,363	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_19-07-41' in 0.1480s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 1, 'num_embeddings': 16362, 'embedding_dim': 15, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 0.000526576127715743, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10689475772165125
INFO:model_data_nn.py:Best trial testing loss: 0.055213125598318175
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_19-07-35_520467_1361901/artifacts/2024-07-16_19-07-41/train_fnn_2024-07-16_19-07-41/driver_artifacts/train_fnn_58f7c_00022_22_dropout_rate=0.5200,embedding_dim=15,hidden_dim=5,lr=0.0100,num_layers=1,weight_decay=0.0005_2024-07-16_19-07-41
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 1, 'num_embeddings': 16543, 'embedding_dim': 15, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 0.000526576127715743, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 1.5763180396762078, 'avg_test_loss': 0.08479328250029573}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.10730570418751245, 'avg_test_loss': 0.08177904046520039}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.10640130824999575, 'avg_test_loss': 0.08271726555432435}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.10558301648080375, 'avg_test_loss': 0.08300102257204277}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.10529358800365786, 'avg_test_loss': 0.08305562732534276}
INFO:model_data_nn.py:Early stopping at epoch 5
INFO:main.py:Making prediction for data in year: 2015
INFO:main.py:Prediction data shape: (13715,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2015: 0.2879158366529362
INFO:main.py:Prediction Stats:                retq          pred
count  13715.000000  13715.000000
mean      -0.012963      0.041971
std        0.281375      0.031117
min       -0.894256     -0.256078
25%       -0.117383      0.031500
50%       -0.004975      0.041442
75%        0.079168      0.054936
max       16.161400      0.211747
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:transform_data_nn.py:Train_data: (586935, 161)

INFO:transform_data_nn.py:Test data years: [2015]
INFO:transform_data_nn.py:Test_data: (13715, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:transform_data_nn.py:Retrain_data: (600650, 161)

INFO:transform_data_nn.py:Prediction data years: [2016]
INFO:transform_data_nn.py:Prediction_data: (13785, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([586935, 152])
            y_train_tf: torch.Size([586935])

            x_test_tf: torch.Size([13715, 152])
            y_test_tf: torch.Size([13715])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([600650, 152])
            y_retrain_tf: torch.Size([600650])

            x_prediction_tf: torch.Size([13785, 152])
            y_prediction_tf: torch.Size([13785])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.2297e-01,  9.3129e-01,  6.5636e-02, -1.6897e+00, -1.1095e-01,
        -8.2298e-01, -1.5324e-01, -3.5066e-01,  4.1632e-01, -1.7877e-01,
        -7.2170e-01,  8.9094e-02, -7.1006e-01, -5.4722e-01,  8.5773e-02,
         5.2549e-01, -1.2008e-01,  2.0266e-01, -8.4213e-02,  6.2454e-01,
        -4.0895e-01, -6.6791e-02, -1.8372e-01,  1.0453e-02, -9.5881e-02,
        -3.4276e-01, -5.9379e-01, -9.0171e-02,  2.8383e-01,  1.3663e+00,
         3.4980e-01, -1.2416e-01,  7.8868e-01,  3.2531e-01, -2.2196e-01,
        -2.3097e-01,  1.5455e-01,  8.0949e-01, -9.3699e-03, -1.1168e+00,
        -2.6601e-01,  2.8564e-01,  3.7528e-01,  2.5188e-02, -1.5746e-01,
        -7.2033e-01,  1.0760e-01, -5.1448e-02, -3.5141e-01, -1.4899e-01,
        -8.4783e-01,  2.9581e-01, -4.6980e-01,  9.2151e-02, -8.2883e-03,
         4.9036e-01, -5.4727e-01, -1.8323e-01, -2.5408e-01, -2.8635e-02,
        -1.4982e-03, -3.0983e-01,  7.3052e-02,  2.1674e-01,  9.1409e-02,
        -1.9114e-01,  7.7571e-01, -2.5242e-01,  6.1363e-01, -5.7728e-01,
        -3.5407e-01, -1.7923e-01, -2.5364e-02, -8.6483e-01,  1.8619e-01,
         7.7950e-01,  9.1719e-01, -1.1852e+00,  2.6439e-01,  1.5025e-02,
        -1.0150e+00,  2.0181e-01,  3.8299e-01,  1.7625e-02, -5.8125e-01,
        -4.7682e-01, -5.6400e-01, -2.7840e-01,  1.0834e-01,  1.1444e-01,
        -6.2445e-01, -1.3359e+00,  2.6316e-01,  1.3323e-15,  1.3323e-15,
         3.3235e+00,  1.6146e-01,  2.4532e+00, -3.0225e+00,  6.3244e-01,
        -5.7335e-01,  2.1253e-01,  1.2189e-02, -5.2237e-02,  1.7609e-01,
         6.5543e-02, -1.5258e-01,  2.8951e-01,  4.8873e-01, -8.6323e-01,
         8.6470e-01,  1.4211e-14,  3.2292e-01,  1.4093e-02,  6.5325e-02,
         1.6333e-02,  3.8096e-01, -2.2697e-01,  6.3748e-02, -5.5838e-01,
         1.4427e-01, -2.2475e-01, -3.5316e-01,  3.6115e-01,  3.6161e-01,
        -4.1541e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([13469]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-3.5774e-01, -1.8605e-01, -5.3812e-01,  1.1617e+00, -2.3422e-01,
        -5.4884e-01, -9.8823e-01, -7.7397e-01,  8.0277e-02,  3.3126e-01,
        -7.4848e-01,  1.0178e-02, -7.1006e-01,  3.6292e-01,  5.4398e-02,
         3.3245e-01, -2.0969e-01,  7.2537e-01, -1.1900e-02, -4.5638e-03,
        -5.9686e-01, -1.2395e+00, -3.6291e-01, -1.8387e-01, -3.4472e-01,
        -8.0183e-01, -6.6412e-01, -9.0171e-02,  1.9067e-01,  8.7317e-01,
        -1.8547e-01, -2.3838e-01,  2.8462e-01,  3.2531e-01, -7.7393e-01,
        -3.7375e-01,  1.5995e-01, -6.3930e-01,  2.8817e-01, -9.8606e-01,
        -2.6549e-01,  1.5027e-02, -2.3144e-01, -3.6104e-01, -1.7781e-01,
        -8.0229e-01,  6.5681e-01, -3.1208e-01, -5.7922e-01,  1.6285e-01,
         1.5337e+00, -1.5721e-01, -4.6980e-01, -3.9189e-01, -8.2883e-03,
        -6.7610e-02, -9.3437e-01,  5.0216e-02, -4.7276e-01,  1.0803e-01,
        -7.0768e-01, -5.1945e-01,  2.9076e-01,  7.5764e-01, -2.3098e-02,
        -9.2962e-02, -4.8128e-01,  1.3564e-01,  6.1363e-01, -6.8169e-01,
        -3.5407e-01, -1.7923e-01, -2.5364e-02, -8.7973e-01,  2.8922e-03,
        -1.0470e-01,  9.1719e-01,  8.8083e-01,  1.5062e+00,  1.5025e-02,
         8.6924e-01,  2.7747e-01, -3.3537e-01, -1.0518e+00, -4.4547e-01,
        -3.8114e-01, -5.0047e-01, -3.3548e-01, -6.4803e-01, -3.9025e-01,
        -3.3281e-01, -2.5707e-01,  2.6316e-01,  1.3323e-15,  1.3323e-15,
        -2.1744e-01, -8.7120e-02, -1.4168e+00,  1.0835e-01, -1.9652e-01,
        -1.1579e-01, -3.6732e-03,  1.2189e-02, -2.0997e-01,  1.7609e-01,
         2.6332e+00, -2.0607e-01,  5.3732e-01,  2.4851e-01, -3.6536e-01,
        -4.3748e-01,  1.4211e-14,  1.2293e-01, -6.7237e-01, -5.1786e-01,
        -6.8808e-01, -4.5964e-01, -2.4675e-01,  6.3748e-02, -3.8448e-01,
         2.9366e-01, -4.9552e-01, -7.1746e-01,  2.3160e-01,  9.2251e-02,
        -3.8407e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00]), tensor([1907]), tensor(-0.0839))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.1961e-01,  9.3757e-01,  6.4268e-02, -1.6984e+00, -1.1011e-01,
        -8.2162e-01, -1.5708e-01, -3.5330e-01,  4.2020e-01, -1.7875e-01,
        -7.2314e-01,  9.2995e-02, -7.1218e-01, -5.4972e-01,  8.8526e-02,
         5.2769e-01, -1.1863e-01,  2.0216e-01, -8.3589e-02,  6.3049e-01,
        -4.0953e-01, -6.9182e-02, -1.8601e-01,  1.1531e-02, -9.7244e-02,
        -3.4346e-01, -5.9328e-01, -9.1453e-02,  2.6184e-01,  1.3700e+00,
         3.5016e-01, -1.2255e-01,  7.9076e-01,  3.2898e-01, -2.2041e-01,
        -2.2986e-01,  1.5796e-01,  8.1345e-01, -8.7550e-03, -1.1073e+00,
        -2.6396e-01,  2.9707e-01,  3.8114e-01,  2.5518e-02, -1.5728e-01,
        -7.1601e-01,  1.1233e-01, -4.8778e-02, -3.5785e-01, -1.4643e-01,
        -8.4844e-01,  2.7867e-01, -4.6977e-01,  9.4329e-02, -5.4672e-03,
         4.8797e-01, -5.4097e-01, -1.8265e-01, -2.5418e-01, -2.7392e-02,
        -1.5689e-03, -3.0952e-01,  7.3888e-02,  2.1626e-01,  9.2406e-02,
        -1.9076e-01,  7.8221e-01, -2.5050e-01,  6.1171e-01, -5.7770e-01,
        -3.5567e-01, -1.8053e-01, -2.5192e-02, -8.6089e-01,  1.8947e-01,
         7.8667e-01,  9.2490e-01, -1.1883e+00,  2.6091e-01,  1.4650e-02,
        -1.0191e+00,  2.0380e-01,  3.9056e-01,  3.2376e-02, -5.8238e-01,
        -4.8121e-01, -5.6566e-01, -2.7834e-01,  1.1208e-01,  1.1501e-01,
        -6.3038e-01, -1.3341e+00,  2.6679e-01,  6.6613e-16,  6.6613e-16,
         3.3653e+00,  1.7775e-01,  2.4586e+00, -3.0597e+00,  6.4007e-01,
        -5.7805e-01,  2.1770e-01,  1.2067e-02, -4.9524e-02,  1.7055e-01,
         5.0943e-02, -1.5363e-01,  2.9591e-01,  5.5555e-01, -8.6319e-01,
         8.8036e-01,  1.2434e-14,  3.2014e-01,  2.2101e-02,  5.9652e-02,
         1.6591e-02,  3.9024e-01, -2.2754e-01,  7.5351e-02, -5.5685e-01,
         1.4538e-01, -2.1852e-01, -3.5035e-01,  3.6248e-01,  3.6039e-01,
        -4.1401e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([13713]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-3.6229e-01, -1.7521e-01, -6.7623e-01,  1.1491e+00, -4.0509e-01,
        -1.6985e-01, -1.0147e+00, -7.8352e-01,  6.3024e-01,  7.4602e-01,
        -6.7768e-01, -7.2364e-02, -7.1218e-01,  4.6291e-01,  8.2450e-02,
        -1.9446e-01, -2.0499e-01, -5.2014e-01, -1.2723e-02, -4.0135e-01,
        -4.1952e-01, -1.3350e-01, -1.5706e-01, -2.1393e-01, -2.2169e-01,
        -8.1077e-01, -6.7251e-01, -9.1453e-02, -3.1085e-01,  1.5761e+00,
        -3.3640e-01, -2.1134e-01,  1.8925e-01,  3.2898e-01, -8.0515e-01,
        -3.1908e-01, -1.3330e-01, -6.4137e-01, -9.1804e-01, -9.9317e-01,
        -2.5921e-01, -6.0989e-01, -1.6154e-01, -2.4723e-01, -4.0859e-01,
         1.0192e+00, -5.3104e-01, -9.6284e-01,  6.7116e-03, -5.1277e-01,
         7.3950e-01, -3.5428e-01, -4.6977e-01, -3.9857e-01, -7.3815e-01,
        -1.3129e-01, -9.2996e-01, -2.0246e-01, -2.0748e-01, -3.1216e-01,
        -3.9450e-02, -2.0333e-01,  3.7004e-01,  4.8472e-01, -2.2548e-02,
         3.4874e-02, -4.7907e-01,  2.5206e-01,  6.1171e-01, -6.8773e-01,
        -3.5567e-01, -1.8053e-01, -2.5192e-02,  3.8409e-01, -6.9357e-02,
        -1.4204e-01,  9.2490e-01,  8.7999e-01,  1.5093e+00,  1.4650e-02,
         8.5072e-01, -5.7528e-01, -1.9657e-01, -5.4947e-01, -2.9009e-01,
        -3.7120e-01, -5.0007e-01, -4.2207e-01, -4.5988e-01, -2.7839e-01,
        -2.6369e-01, -4.1986e-01,  2.6679e-01,  6.6613e-16,  6.6613e-16,
        -2.6331e-01, -1.4962e+00, -1.3056e+00,  1.2026e-01,  1.0249e+00,
         1.4083e-01, -9.4690e-01,  1.2067e-02, -1.6059e-02,  1.7055e-01,
         2.1787e+00,  1.9562e-02, -3.6232e+00,  5.0111e-01, -6.7713e-01,
        -1.9019e-01,  1.2434e-14,  8.9498e-02, -1.5108e+00, -3.0415e-01,
        -6.8249e-01, -5.2500e-01, -3.5868e-01,  7.5351e-02, -2.7896e-01,
        -9.3988e-02, -5.5951e-01, -8.2045e-01,  1.4583e-01, -1.0355e-02,
        -4.0202e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00]), tensor([1911]), tensor(0.0483))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:main.py:Testing data year: 2015
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 16543
            device: cpu
            
2024-07-16 20:33:12,972	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 20:33:13,018	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 20:33:13,056	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_524ec76d8a57c10b.zip' (1.31MiB) to Ray cluster...
2024-07-16 20:33:13,061	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_524ec76d8a57c10b.zip'.
2024-07-16 20:33:16,031	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 20:41:25,307	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_20-33-16' in 0.1505s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 2, 'num_embeddings': 16543, 'embedding_dim': 5, 'dropout_rate': 0.24, 'lr': 0.01, 'weight_decay': 1.4560904745083134e-05, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.36422211372541696
INFO:model_data_nn.py:Best trial testing loss: 0.08428596294726487
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_20-33-10_560452_1361901/artifacts/2024-07-16_20-33-16/train_fnn_2024-07-16_20-33-16/driver_artifacts/train_fnn_4d9e5_00048_48_dropout_rate=0.2400,embedding_dim=5,hidden_dim=25,lr=0.0100,num_layers=2,weight_decay=0.0000_2024-07-16_20-33-16
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 2, 'num_embeddings': 16832, 'embedding_dim': 5, 'dropout_rate': 0.24, 'lr': 0.01, 'weight_decay': 1.4560904745083134e-05, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 0.5116573884372108, 'avg_test_loss': 0.09482416151850312}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.10802438435500665, 'avg_test_loss': 0.09707433237107815}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.10631057076095823, 'avg_test_loss': 0.0950421182507718}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.1042189342249542, 'avg_test_loss': 0.09468350559473038}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.10277613599693008, 'avg_test_loss': 0.09426369828482468}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.10208332582889185, 'avg_test_loss': 0.09536522306087944}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.1023861259701382, 'avg_test_loss': 0.09427057558463679}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.10244036497469654, 'avg_test_loss': 0.09667612532912581}
INFO:model_data_nn.py:Early stopping at epoch 8
INFO:main.py:Making prediction for data in year: 2016
INFO:main.py:Prediction data shape: (13785,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2016: 0.3109684491567339
INFO:main.py:Prediction Stats:                retq          pred
count  13785.000000  13785.000000
mean       0.043107      0.064760
std        0.307751      0.041945
min       -0.983828     -0.171874
25%       -0.074501      0.042714
50%        0.023648      0.051864
75%        0.142416      0.072136
max       16.130048      0.574526
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:transform_data_nn.py:Train_data: (600650, 161)

INFO:transform_data_nn.py:Test data years: [2016]
INFO:transform_data_nn.py:Test_data: (13785, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]
INFO:transform_data_nn.py:Retrain_data: (614435, 161)

INFO:transform_data_nn.py:Prediction data years: [2017]
INFO:transform_data_nn.py:Prediction_data: (13498, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([600650, 152])
            y_train_tf: torch.Size([600650])

            x_test_tf: torch.Size([13785, 152])
            y_test_tf: torch.Size([13785])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([614435, 152])
            y_retrain_tf: torch.Size([614435])

            x_prediction_tf: torch.Size([13498, 152])
            y_prediction_tf: torch.Size([13498])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.1961e-01,  9.3757e-01,  6.4268e-02, -1.6984e+00, -1.1011e-01,
        -8.2162e-01, -1.5708e-01, -3.5330e-01,  4.2020e-01, -1.7875e-01,
        -7.2314e-01,  9.2995e-02, -7.1218e-01, -5.4972e-01,  8.8526e-02,
         5.2769e-01, -1.1863e-01,  2.0216e-01, -8.3589e-02,  6.3049e-01,
        -4.0953e-01, -6.9182e-02, -1.8601e-01,  1.1531e-02, -9.7244e-02,
        -3.4346e-01, -5.9328e-01, -9.1453e-02,  2.6184e-01,  1.3700e+00,
         3.5016e-01, -1.2255e-01,  7.9076e-01,  3.2898e-01, -2.2041e-01,
        -2.2986e-01,  1.5796e-01,  8.1345e-01, -8.7550e-03, -1.1073e+00,
        -2.6396e-01,  2.9707e-01,  3.8114e-01,  2.5518e-02, -1.5728e-01,
        -7.1601e-01,  1.1233e-01, -4.8778e-02, -3.5785e-01, -1.4643e-01,
        -8.4844e-01,  2.7867e-01, -4.6977e-01,  9.4329e-02, -5.4672e-03,
         4.8797e-01, -5.4097e-01, -1.8265e-01, -2.5418e-01, -2.7392e-02,
        -1.5689e-03, -3.0952e-01,  7.3888e-02,  2.1626e-01,  9.2406e-02,
        -1.9076e-01,  7.8221e-01, -2.5050e-01,  6.1171e-01, -5.7770e-01,
        -3.5567e-01, -1.8053e-01, -2.5192e-02, -8.6089e-01,  1.8947e-01,
         7.8667e-01,  9.2490e-01, -1.1883e+00,  2.6091e-01,  1.4650e-02,
        -1.0191e+00,  2.0380e-01,  3.9056e-01,  3.2376e-02, -5.8238e-01,
        -4.8121e-01, -5.6566e-01, -2.7834e-01,  1.1208e-01,  1.1501e-01,
        -6.3038e-01, -1.3341e+00,  2.6679e-01,  6.6613e-16,  6.6613e-16,
         3.3653e+00,  1.7775e-01,  2.4586e+00, -3.0597e+00,  6.4007e-01,
        -5.7805e-01,  2.1770e-01,  1.2067e-02, -4.9524e-02,  1.7055e-01,
         5.0943e-02, -1.5363e-01,  2.9591e-01,  5.5555e-01, -8.6319e-01,
         8.8036e-01,  1.2434e-14,  3.2014e-01,  2.2101e-02,  5.9652e-02,
         1.6591e-02,  3.9024e-01, -2.2754e-01,  7.5351e-02, -5.5685e-01,
         1.4538e-01, -2.1852e-01, -3.5035e-01,  3.6248e-01,  3.6039e-01,
        -4.1401e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([13713]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-3.6229e-01, -1.7521e-01, -6.7623e-01,  1.1491e+00, -4.0509e-01,
        -1.6985e-01, -1.0147e+00, -7.8352e-01,  6.3024e-01,  7.4602e-01,
        -6.7768e-01, -7.2364e-02, -7.1218e-01,  4.6291e-01,  8.2450e-02,
        -1.9446e-01, -2.0499e-01, -5.2014e-01, -1.2723e-02, -4.0135e-01,
        -4.1952e-01, -1.3350e-01, -1.5706e-01, -2.1393e-01, -2.2169e-01,
        -8.1077e-01, -6.7251e-01, -9.1453e-02, -3.1085e-01,  1.5761e+00,
        -3.3640e-01, -2.1134e-01,  1.8925e-01,  3.2898e-01, -8.0515e-01,
        -3.1908e-01, -1.3330e-01, -6.4137e-01, -9.1804e-01, -9.9317e-01,
        -2.5921e-01, -6.0989e-01, -1.6154e-01, -2.4723e-01, -4.0859e-01,
         1.0192e+00, -5.3104e-01, -9.6284e-01,  6.7116e-03, -5.1277e-01,
         7.3950e-01, -3.5428e-01, -4.6977e-01, -3.9857e-01, -7.3815e-01,
        -1.3129e-01, -9.2996e-01, -2.0246e-01, -2.0748e-01, -3.1216e-01,
        -3.9450e-02, -2.0333e-01,  3.7004e-01,  4.8472e-01, -2.2548e-02,
         3.4874e-02, -4.7907e-01,  2.5206e-01,  6.1171e-01, -6.8773e-01,
        -3.5567e-01, -1.8053e-01, -2.5192e-02,  3.8409e-01, -6.9357e-02,
        -1.4204e-01,  9.2490e-01,  8.7999e-01,  1.5093e+00,  1.4650e-02,
         8.5072e-01, -5.7528e-01, -1.9657e-01, -5.4947e-01, -2.9009e-01,
        -3.7120e-01, -5.0007e-01, -4.2207e-01, -4.5988e-01, -2.7839e-01,
        -2.6369e-01, -4.1986e-01,  2.6679e-01,  6.6613e-16,  6.6613e-16,
        -2.6331e-01, -1.4962e+00, -1.3056e+00,  1.2026e-01,  1.0249e+00,
         1.4083e-01, -9.4690e-01,  1.2067e-02, -1.6059e-02,  1.7055e-01,
         2.1787e+00,  1.9562e-02, -3.6232e+00,  5.0111e-01, -6.7713e-01,
        -1.9019e-01,  1.2434e-14,  8.9498e-02, -1.5108e+00, -3.0415e-01,
        -6.8249e-01, -5.2500e-01, -3.5868e-01,  7.5351e-02, -2.7896e-01,
        -9.3988e-02, -5.5951e-01, -8.2045e-01,  1.4583e-01, -1.0355e-02,
        -4.0202e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00]), tensor([1911]), tensor(0.0483))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.1879e-01,  9.4321e-01,  6.3329e-02, -1.7061e+00, -1.0695e-01,
        -8.2167e-01, -1.5971e-01, -3.5496e-01,  4.2319e-01, -1.7800e-01,
        -7.2408e-01,  9.9669e-02, -7.1336e-01, -5.4968e-01,  8.8846e-02,
         5.3097e-01, -1.1696e-01,  2.0172e-01, -8.4957e-02,  6.3770e-01,
        -4.1266e-01, -6.6137e-02, -1.8490e-01,  1.3801e-02, -9.6282e-02,
        -3.4405e-01, -5.9323e-01, -9.3383e-02,  2.4298e-01,  1.3712e+00,
         3.4988e-01, -1.1939e-01,  7.9182e-01,  3.3234e-01, -2.1691e-01,
        -2.2938e-01,  1.6177e-01,  8.1734e-01, -8.6401e-03, -1.0997e+00,
        -2.6202e-01,  3.1273e-01,  3.8902e-01,  2.4981e-02, -1.5612e-01,
        -7.1301e-01,  1.1993e-01, -4.9385e-02, -3.5905e-01, -1.4325e-01,
        -8.4984e-01,  2.6369e-01, -4.6952e-01,  9.7075e-02, -2.3628e-03,
         4.8463e-01, -5.3502e-01, -1.8187e-01, -2.5290e-01, -2.7965e-02,
        -1.2174e-03, -3.0804e-01,  7.3540e-02,  2.1603e-01,  9.4387e-02,
        -1.9113e-01,  7.8985e-01, -2.4873e-01,  6.1106e-01, -5.7785e-01,
        -3.5767e-01, -1.8230e-01, -2.5416e-02, -8.5886e-01,  1.9480e-01,
         7.9362e-01,  9.3213e-01, -1.1916e+00,  2.5685e-01,  1.4150e-02,
        -1.0411e+00,  2.0708e-01,  3.9690e-01,  4.6322e-02, -5.8310e-01,
        -4.8748e-01, -5.6759e-01, -2.7873e-01,  1.1580e-01,  1.1573e-01,
        -6.3564e-01, -1.3330e+00,  2.6992e-01,  6.6613e-16,  6.6613e-16,
         3.4069e+00,  2.1191e-01,  2.4701e+00, -3.0827e+00,  6.3707e-01,
        -5.8285e-01,  2.2507e-01,  1.1436e-02, -4.7594e-02,  1.6806e-01,
         5.0409e-02, -1.5415e-01,  2.5646e-01,  5.9089e-01, -8.5109e-01,
         8.9897e-01,  1.4211e-14,  3.1911e-01,  2.8687e-02,  5.3502e-02,
         1.4085e-02,  3.9967e-01, -2.2706e-01,  8.5841e-02, -5.5557e-01,
         1.4678e-01, -2.1286e-01, -3.4551e-01,  3.6512e-01,  3.5881e-01,
        -4.1247e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([13910]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-3.9730e-01, -1.3769e-01, -5.5384e-01,  1.1374e+00, -4.6372e-01,
        -9.8860e-01, -1.3233e+00, -8.5474e-01, -7.5678e-02,  9.8967e-02,
        -6.5086e-01, -7.0955e-02, -5.8203e-01,  1.1884e-01, -1.9635e-01,
        -2.3451e-01, -2.0460e-01, -1.3992e-01, -1.4783e-02, -2.1873e-01,
         1.7607e+00, -1.3329e-01, -5.5283e-02, -2.8985e-01, -3.1342e-01,
        -7.0902e-01, -6.5367e-01, -9.3383e-02,  6.8746e-01,  8.3982e-01,
         1.1350e-01, -3.2413e-01,  9.5883e-02,  3.3234e-01, -8.5419e-01,
        -6.3044e-01, -3.7395e-01, -6.3469e-01, -5.8384e-01, -9.1900e-02,
        -2.6316e-01,  3.6008e-01, -4.3839e-01, -4.1846e-01, -3.7246e-01,
        -8.9713e-01,  1.0749e+00,  1.9905e-02, -3.0355e-01,  2.1860e+00,
        -5.5439e-02, -1.2342e-01, -4.6952e-01, -4.0506e-01, -7.3820e-01,
        -1.9849e-01, -9.2583e-01, -4.2263e-01,  4.9758e-01,  1.8083e-01,
        -2.3771e-01,  3.5632e-01, -3.0389e-01, -9.9688e-01, -2.2148e-02,
        -3.9293e-01, -4.7732e-01,  9.4118e-01, -7.3251e-01, -6.1703e-01,
        -3.5767e-01, -1.8230e-01, -2.5416e-02, -1.0967e+00, -1.3121e-01,
        -8.7997e-02,  9.3213e-01,  8.7834e-01,  1.5095e+00,  1.4150e-02,
         7.1653e-01, -7.6735e-01, -4.8173e-01, -5.0476e-01, -2.1589e-01,
        -3.7450e-01, -4.9944e-01, -3.2512e-01, -3.4799e-01,  3.2325e-01,
        -2.4932e-01, -4.1668e-01,  2.6992e-01,  6.6613e-16,  6.6613e-16,
        -3.5980e-01, -1.5692e+00, -1.1790e+00, -4.8303e-02, -6.1655e-01,
        -5.6617e-01, -5.0238e-02,  1.0928e+00,  3.6336e-01,  7.6946e-01,
         1.5337e+00, -3.1634e-01, -3.8747e-02,  1.5525e+00, -8.1605e-01,
        -6.8367e-01,  1.4211e-14, -3.9121e-02, -2.4006e+00, -1.0332e+00,
         7.2466e+00, -6.1138e-01, -2.1204e-01,  8.5841e-02, -1.1785e-01,
        -6.9485e-02, -6.4187e-01, -6.3630e-01,  1.0311e-01, -6.0308e-02,
        -3.8034e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00]), tensor([1842]), tensor(0.0179))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:main.py:Testing data year: 2016
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 16832
            device: cpu
            
2024-07-16 21:56:40,070	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 21:56:40,121	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 21:56:40,158	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_524ec76d8a57c10b.zip' (1.31MiB) to Ray cluster...
2024-07-16 21:56:40,162	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_524ec76d8a57c10b.zip'.
2024-07-16 21:56:43,232	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 22:10:36,187	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_21-56-43' in 0.1455s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 4, 'num_embeddings': 16832, 'embedding_dim': 5, 'dropout_rate': 0.4, 'lr': 0.0005, 'weight_decay': 5.989003672254302e-05, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.09439928463966124
INFO:model_data_nn.py:Best trial testing loss: 0.09319382736942282
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_21-56-37_552329_1361901/artifacts/2024-07-16_21-56-43/train_fnn_2024-07-16_21-56-43/driver_artifacts/train_fnn_f6248_00011_11_dropout_rate=0.4000,embedding_dim=5,hidden_dim=135,lr=0.0005,num_layers=4,weight_decay=0.0001_2024-07-16_21-56-43
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 4, 'num_embeddings': 17074, 'embedding_dim': 5, 'dropout_rate': 0.4, 'lr': 0.0005, 'weight_decay': 5.989003672254302e-05, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 14.479107140104555, 'avg_test_loss': 0.3098859964114315}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.26050393458538035, 'avg_test_loss': 0.07319141404246385}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.10674504571280495, 'avg_test_loss': 0.07172947556202142}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.10713758240331714, 'avg_test_loss': 0.0719085702286014}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.10770245526809834, 'avg_test_loss': 0.0722702348710231}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.1071572752187695, 'avg_test_loss': 0.07428654617155497}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 2017
INFO:main.py:Prediction data shape: (13498,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2017: 0.27110303757819254
INFO:main.py:Prediction Stats:                retq          pred
count  13498.000000  13498.000000
mean       0.040207      0.091648
std        0.265685      0.026875
min       -0.907776      0.037199
25%       -0.067703      0.079458
50%        0.019797      0.088130
75%        0.118715      0.094509
max        5.661212      0.283028
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]
INFO:transform_data_nn.py:Train_data: (614435, 161)

INFO:transform_data_nn.py:Test data years: [2017]
INFO:transform_data_nn.py:Test_data: (13498, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]
INFO:transform_data_nn.py:Retrain_data: (627933, 161)

INFO:transform_data_nn.py:Prediction data years: [2018]
INFO:transform_data_nn.py:Prediction_data: (13226, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([614435, 152])
            y_train_tf: torch.Size([614435])

            x_test_tf: torch.Size([13498, 152])
            y_test_tf: torch.Size([13498])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([627933, 152])
            y_retrain_tf: torch.Size([627933])

            x_prediction_tf: torch.Size([13226, 152])
            y_prediction_tf: torch.Size([13226])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.1879e-01,  9.4321e-01,  6.3329e-02, -1.7061e+00, -1.0695e-01,
        -8.2167e-01, -1.5971e-01, -3.5496e-01,  4.2319e-01, -1.7800e-01,
        -7.2408e-01,  9.9669e-02, -7.1336e-01, -5.4968e-01,  8.8846e-02,
         5.3097e-01, -1.1696e-01,  2.0172e-01, -8.4957e-02,  6.3770e-01,
        -4.1266e-01, -6.6137e-02, -1.8490e-01,  1.3801e-02, -9.6282e-02,
        -3.4405e-01, -5.9323e-01, -9.3383e-02,  2.4298e-01,  1.3712e+00,
         3.4988e-01, -1.1939e-01,  7.9182e-01,  3.3234e-01, -2.1691e-01,
        -2.2938e-01,  1.6177e-01,  8.1734e-01, -8.6401e-03, -1.0997e+00,
        -2.6202e-01,  3.1273e-01,  3.8902e-01,  2.4981e-02, -1.5612e-01,
        -7.1301e-01,  1.1993e-01, -4.9385e-02, -3.5905e-01, -1.4325e-01,
        -8.4984e-01,  2.6369e-01, -4.6952e-01,  9.7075e-02, -2.3628e-03,
         4.8463e-01, -5.3502e-01, -1.8187e-01, -2.5290e-01, -2.7965e-02,
        -1.2174e-03, -3.0804e-01,  7.3540e-02,  2.1603e-01,  9.4387e-02,
        -1.9113e-01,  7.8985e-01, -2.4873e-01,  6.1106e-01, -5.7785e-01,
        -3.5767e-01, -1.8230e-01, -2.5416e-02, -8.5886e-01,  1.9480e-01,
         7.9362e-01,  9.3213e-01, -1.1916e+00,  2.5685e-01,  1.4150e-02,
        -1.0411e+00,  2.0708e-01,  3.9690e-01,  4.6322e-02, -5.8310e-01,
        -4.8748e-01, -5.6759e-01, -2.7873e-01,  1.1580e-01,  1.1573e-01,
        -6.3564e-01, -1.3330e+00,  2.6992e-01,  6.6613e-16,  6.6613e-16,
         3.4069e+00,  2.1191e-01,  2.4701e+00, -3.0827e+00,  6.3707e-01,
        -5.8285e-01,  2.2507e-01,  1.1436e-02, -4.7594e-02,  1.6806e-01,
         5.0409e-02, -1.5415e-01,  2.5646e-01,  5.9089e-01, -8.5109e-01,
         8.9897e-01,  1.4211e-14,  3.1911e-01,  2.8687e-02,  5.3502e-02,
         1.4085e-02,  3.9967e-01, -2.2706e-01,  8.5841e-02, -5.5557e-01,
         1.4678e-01, -2.1286e-01, -3.4551e-01,  3.6512e-01,  3.5881e-01,
        -4.1247e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([13910]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-3.9730e-01, -1.3769e-01, -5.5384e-01,  1.1374e+00, -4.6372e-01,
        -9.8860e-01, -1.3233e+00, -8.5474e-01, -7.5678e-02,  9.8967e-02,
        -6.5086e-01, -7.0955e-02, -5.8203e-01,  1.1884e-01, -1.9635e-01,
        -2.3451e-01, -2.0460e-01, -1.3992e-01, -1.4783e-02, -2.1873e-01,
         1.7607e+00, -1.3329e-01, -5.5283e-02, -2.8985e-01, -3.1342e-01,
        -7.0902e-01, -6.5367e-01, -9.3383e-02,  6.8746e-01,  8.3982e-01,
         1.1350e-01, -3.2413e-01,  9.5883e-02,  3.3234e-01, -8.5419e-01,
        -6.3044e-01, -3.7395e-01, -6.3469e-01, -5.8384e-01, -9.1900e-02,
        -2.6316e-01,  3.6008e-01, -4.3839e-01, -4.1846e-01, -3.7246e-01,
        -8.9713e-01,  1.0749e+00,  1.9905e-02, -3.0355e-01,  2.1860e+00,
        -5.5439e-02, -1.2342e-01, -4.6952e-01, -4.0506e-01, -7.3820e-01,
        -1.9849e-01, -9.2583e-01, -4.2263e-01,  4.9758e-01,  1.8083e-01,
        -2.3771e-01,  3.5632e-01, -3.0389e-01, -9.9688e-01, -2.2148e-02,
        -3.9293e-01, -4.7732e-01,  9.4118e-01, -7.3251e-01, -6.1703e-01,
        -3.5767e-01, -1.8230e-01, -2.5416e-02, -1.0967e+00, -1.3121e-01,
        -8.7997e-02,  9.3213e-01,  8.7834e-01,  1.5095e+00,  1.4150e-02,
         7.1653e-01, -7.6735e-01, -4.8173e-01, -5.0476e-01, -2.1589e-01,
        -3.7450e-01, -4.9944e-01, -3.2512e-01, -3.4799e-01,  3.2325e-01,
        -2.4932e-01, -4.1668e-01,  2.6992e-01,  6.6613e-16,  6.6613e-16,
        -3.5980e-01, -1.5692e+00, -1.1790e+00, -4.8303e-02, -6.1655e-01,
        -5.6617e-01, -5.0238e-02,  1.0928e+00,  3.6336e-01,  7.6946e-01,
         1.5337e+00, -3.1634e-01, -3.8747e-02,  1.5525e+00, -8.1605e-01,
        -6.8367e-01,  1.4211e-14, -3.9121e-02, -2.4006e+00, -1.0332e+00,
         7.2466e+00, -6.1138e-01, -2.1204e-01,  8.5841e-02, -1.1785e-01,
        -6.9485e-02, -6.4187e-01, -6.3630e-01,  1.0311e-01, -6.0308e-02,
        -3.8034e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00]), tensor([1842]), tensor(0.0179))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.1810e-01,  9.4908e-01,  6.1155e-02, -1.7131e+00, -1.0370e-01,
        -8.2052e-01, -1.6272e-01, -3.5692e-01,  4.2943e-01, -1.7776e-01,
        -7.2490e-01,  1.0603e-01, -7.1575e-01, -5.4906e-01,  9.0054e-02,
         5.3366e-01, -1.1645e-01,  2.0152e-01, -8.5586e-02,  6.4484e-01,
        -4.1328e-01, -6.6484e-02, -1.8170e-01,  1.4751e-02, -9.6002e-02,
        -3.4412e-01, -5.9308e-01, -9.3968e-02,  2.2085e-01,  1.3746e+00,
         3.5063e-01, -1.1693e-01,  7.9397e-01,  3.3628e-01, -2.1326e-01,
        -2.2749e-01,  1.6721e-01,  8.2072e-01, -7.1833e-03, -1.0932e+00,
        -2.5971e-01,  3.1290e-01,  3.9642e-01,  2.6536e-02, -1.5480e-01,
        -7.0923e-01,  1.1884e-01, -5.3090e-02, -3.5368e-01, -1.4426e-01,
        -8.5121e-01,  2.4804e-01, -4.6935e-01,  9.7795e-02, -9.6488e-04,
         4.8193e-01, -5.2944e-01, -1.8102e-01, -2.5159e-01, -2.7927e-02,
        -6.4104e-04, -3.0684e-01,  7.2972e-02,  2.1730e-01,  9.4620e-02,
        -1.9167e-01,  7.9745e-01, -2.4686e-01,  6.0897e-01, -5.7769e-01,
        -3.5909e-01, -1.8425e-01, -2.6042e-02, -8.5428e-01,  1.9996e-01,
         8.0063e-01,  9.3980e-01, -1.1949e+00,  2.5298e-01,  1.4749e-02,
        -1.0707e+00,  2.0967e-01,  4.0411e-01,  6.0256e-02, -5.8362e-01,
        -4.9400e-01, -5.6939e-01, -2.7868e-01,  1.1905e-01,  1.1643e-01,
        -6.4056e-01, -1.3320e+00,  2.7321e-01, -1.1102e-15, -1.1102e-15,
         3.4464e+00,  2.3476e-01,  2.4893e+00, -3.1048e+00,  6.5659e-01,
        -5.7430e-01,  2.3227e-01,  1.1404e-02, -4.6341e-02,  1.6449e-01,
         5.1625e-02, -1.5660e-01,  2.4325e-01,  6.4231e-01, -8.3870e-01,
         9.1867e-01,  8.8818e-15,  3.1843e-01,  2.7414e-02,  4.8645e-02,
         1.3878e-02,  4.0922e-01, -2.2573e-01,  9.3958e-02, -5.5418e-01,
         1.4856e-01, -2.0737e-01, -3.4111e-01,  3.6765e-01,  3.5746e-01,
        -4.1151e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([14034]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-3.8109e-01, -1.4332e-01, -1.3723e-01,  1.1277e+00, -1.4309e-01,
        -5.4020e-01, -6.6337e-01, -6.4956e-01, -6.5929e-01, -1.0354e+00,
         7.4836e-02,  1.4410e+00,  1.9425e+00, -9.3326e-03, -6.1171e-02,
         3.2998e-01, -2.0532e-01, -2.0936e+00, -1.9266e-02,  1.6777e-01,
         2.8783e-01, -1.3370e-01, -1.6483e-01,  1.9440e-01,  3.5284e-02,
         1.2958e-01, -3.4712e-01, -4.0851e-01,  8.7936e-01, -1.6440e-01,
         6.7155e-01, -1.4609e-01,  2.2673e-01,  3.3628e-01,  4.0723e-01,
        -2.0781e-01,  3.3674e-01, -2.8501e-01,  2.1531e-01, -1.1132e+00,
        -2.6143e-01, -3.1732e-02,  8.9484e-02, -6.2665e-01, -3.9855e-02,
        -8.5502e-01,  3.6934e-02,  7.2662e-04, -4.4817e-02,  2.7321e-01,
         7.3827e-01,  1.2827e+00, -4.6935e-01,  1.5521e-01, -7.3895e-01,
         1.5634e-01, -3.4867e-01,  5.1531e-02, -2.7262e-01, -5.2225e-01,
        -6.2007e-02, -3.1105e-01, -2.0494e-01, -4.6337e-01, -1.0179e-01,
        -3.1500e-01, -3.4194e-01, -2.9697e-01,  6.0897e-01,  3.3105e-02,
        -3.5596e-01, -1.8347e-01, -2.6042e-02, -9.8206e-01,  1.2096e+00,
         1.2050e-02, -1.2701e-01,  3.6578e-01,  5.4786e-01,  3.5510e-01,
         7.7550e-01, -1.6629e-01, -6.0970e-01, -9.5197e-01, -4.2028e-01,
        -4.9942e-01, -5.7236e-01, -3.5900e-01, -2.7140e-01,  1.8030e-01,
        -3.4222e-01, -1.8088e-01,  2.7321e-01, -1.1102e-15, -1.1102e-15,
        -6.4060e-01, -1.2806e+00, -8.9790e-01, -7.7609e-01, -7.3985e-01,
        -6.4398e-01,  5.9012e-02, -4.6564e-01, -4.3832e-01, -2.7772e+00,
         1.4399e+00, -1.7049e-01,  4.6931e-01,  6.4231e-01, -6.3944e-01,
        -7.4605e-01,  8.8818e-15,  2.7867e-01,  2.7414e-02, -8.1351e-01,
        -2.2931e-02, -7.9242e-02, -3.9314e-01,  9.3958e-02, -5.6292e-01,
        -4.3957e-02,  9.3401e-02,  2.5380e+00,  5.9345e-01,  2.8250e-01,
        -4.1181e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([925]), tensor(-0.0976))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]
INFO:main.py:Testing data year: 2017
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 17074
            device: cpu
            
2024-07-16 23:28:32,330	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 23:28:32,380	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 23:28:32,416	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_524ec76d8a57c10b.zip' (1.31MiB) to Ray cluster...
2024-07-16 23:28:32,422	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_524ec76d8a57c10b.zip'.
2024-07-16 23:28:35,475	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 23:38:55,082	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_23-28-35' in 0.1539s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 17074, 'embedding_dim': 5, 'dropout_rate': 0.49, 'lr': 5e-05, 'weight_decay': 0.00010124137770478638, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10038901127871748
INFO:model_data_nn.py:Best trial testing loss: 0.0711185060582071
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_23-28-29_891098_1361901/artifacts/2024-07-16_23-28-35/train_fnn_2024-07-16_23-28-35/driver_artifacts/train_fnn_cbb20_00026_26_dropout_rate=0.4900,embedding_dim=5,hidden_dim=45,lr=0.0001,num_layers=1,weight_decay=0.0001_2024-07-16_23-28-35
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 17220, 'embedding_dim': 5, 'dropout_rate': 0.49, 'lr': 5e-05, 'weight_decay': 0.00010124137770478638, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 87.88050294107094, 'avg_test_loss': 10.069218809788044}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 26.077445380502073, 'avg_test_loss': 5.70467549103957}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 9.54828881196863, 'avg_test_loss': 1.8135427282406733}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 2.4140481040811133, 'avg_test_loss': 0.43020685131733233}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.42421297413740067, 'avg_test_loss': 0.14421298641424912}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.12549863945688222, 'avg_test_loss': 0.10114332789985034}
INFO:model_data_nn.py:Epoch 7/40, metrics: {'avg_train_loss': 0.10562539071944166, 'avg_test_loss': 0.09475474908518103}
INFO:model_data_nn.py:Epoch 8/40, metrics: {'avg_train_loss': 0.10445541808593531, 'avg_test_loss': 0.09345913911238313}
INFO:model_data_nn.py:Epoch 9/40, metrics: {'avg_train_loss': 0.10416658576828482, 'avg_test_loss': 0.09281485445367602}
INFO:model_data_nn.py:Epoch 10/40, metrics: {'avg_train_loss': 0.10386905111023177, 'avg_test_loss': 0.09279825696005271}
INFO:model_data_nn.py:Epoch 11/40, metrics: {'avg_train_loss': 0.10353225427218422, 'avg_test_loss': 0.0926962373420023}
INFO:model_data_nn.py:Epoch 12/40, metrics: {'avg_train_loss': 0.10326745829294762, 'avg_test_loss': 0.09296404298108357}
INFO:model_data_nn.py:Epoch 13/40, metrics: {'avg_train_loss': 0.10297366040783466, 'avg_test_loss': 0.09379067451048356}
INFO:model_data_nn.py:Epoch 14/40, metrics: {'avg_train_loss': 0.102745989921491, 'avg_test_loss': 0.09281624341383576}
INFO:model_data_nn.py:Early stopping at epoch 14
INFO:main.py:Making prediction for data in year: 2018
INFO:main.py:Prediction data shape: (13226,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2018: 0.3042711545737976
INFO:main.py:Prediction Stats:                retq          pred
count  13226.000000  13226.000000
mean      -0.026920      0.033755
std        0.297287      0.022037
min       -0.999805     -0.140027
25%       -0.157460      0.022204
50%       -0.023134      0.031300
75%        0.081345      0.041513
max       12.032942      0.179487
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]
INFO:transform_data_nn.py:Train_data: (627933, 161)

INFO:transform_data_nn.py:Test data years: [2018]
INFO:transform_data_nn.py:Test_data: (13226, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]
INFO:transform_data_nn.py:Retrain_data: (641159, 161)

INFO:transform_data_nn.py:Prediction data years: [2019]
INFO:transform_data_nn.py:Prediction_data: (13264, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([627933, 152])
            y_train_tf: torch.Size([627933])

            x_test_tf: torch.Size([13226, 152])
            y_test_tf: torch.Size([13226])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([641159, 152])
            y_retrain_tf: torch.Size([641159])

            x_prediction_tf: torch.Size([13264, 152])
            y_prediction_tf: torch.Size([13264])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.1810e-01,  9.4908e-01,  6.1155e-02, -1.7131e+00, -1.0370e-01,
        -8.2052e-01, -1.6272e-01, -3.5692e-01,  4.2943e-01, -1.7776e-01,
        -7.2490e-01,  1.0603e-01, -7.1575e-01, -5.4906e-01,  9.0054e-02,
         5.3366e-01, -1.1645e-01,  2.0152e-01, -8.5586e-02,  6.4484e-01,
        -4.1328e-01, -6.6484e-02, -1.8170e-01,  1.4751e-02, -9.6002e-02,
        -3.4412e-01, -5.9308e-01, -9.3968e-02,  2.2085e-01,  1.3746e+00,
         3.5063e-01, -1.1693e-01,  7.9397e-01,  3.3628e-01, -2.1326e-01,
        -2.2749e-01,  1.6721e-01,  8.2072e-01, -7.1833e-03, -1.0932e+00,
        -2.5971e-01,  3.1290e-01,  3.9642e-01,  2.6536e-02, -1.5480e-01,
        -7.0923e-01,  1.1884e-01, -5.3090e-02, -3.5368e-01, -1.4426e-01,
        -8.5121e-01,  2.4804e-01, -4.6935e-01,  9.7795e-02, -9.6488e-04,
         4.8193e-01, -5.2944e-01, -1.8102e-01, -2.5159e-01, -2.7927e-02,
        -6.4104e-04, -3.0684e-01,  7.2972e-02,  2.1730e-01,  9.4620e-02,
        -1.9167e-01,  7.9745e-01, -2.4686e-01,  6.0897e-01, -5.7769e-01,
        -3.5909e-01, -1.8425e-01, -2.6042e-02, -8.5428e-01,  1.9996e-01,
         8.0063e-01,  9.3980e-01, -1.1949e+00,  2.5298e-01,  1.4749e-02,
        -1.0707e+00,  2.0967e-01,  4.0411e-01,  6.0256e-02, -5.8362e-01,
        -4.9400e-01, -5.6939e-01, -2.7868e-01,  1.1905e-01,  1.1643e-01,
        -6.4056e-01, -1.3320e+00,  2.7321e-01, -1.1102e-15, -1.1102e-15,
         3.4464e+00,  2.3476e-01,  2.4893e+00, -3.1048e+00,  6.5659e-01,
        -5.7430e-01,  2.3227e-01,  1.1404e-02, -4.6341e-02,  1.6449e-01,
         5.1625e-02, -1.5660e-01,  2.4325e-01,  6.4231e-01, -8.3870e-01,
         9.1867e-01,  8.8818e-15,  3.1843e-01,  2.7414e-02,  4.8645e-02,
         1.3878e-02,  4.0922e-01, -2.2573e-01,  9.3958e-02, -5.5418e-01,
         1.4856e-01, -2.0737e-01, -3.4111e-01,  3.6765e-01,  3.5746e-01,
        -4.1151e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([14034]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-3.8109e-01, -1.4332e-01, -1.3723e-01,  1.1277e+00, -1.4309e-01,
        -5.4020e-01, -6.6337e-01, -6.4956e-01, -6.5929e-01, -1.0354e+00,
         7.4836e-02,  1.4410e+00,  1.9425e+00, -9.3326e-03, -6.1171e-02,
         3.2998e-01, -2.0532e-01, -2.0936e+00, -1.9266e-02,  1.6777e-01,
         2.8783e-01, -1.3370e-01, -1.6483e-01,  1.9440e-01,  3.5284e-02,
         1.2958e-01, -3.4712e-01, -4.0851e-01,  8.7936e-01, -1.6440e-01,
         6.7155e-01, -1.4609e-01,  2.2673e-01,  3.3628e-01,  4.0723e-01,
        -2.0781e-01,  3.3674e-01, -2.8501e-01,  2.1531e-01, -1.1132e+00,
        -2.6143e-01, -3.1732e-02,  8.9484e-02, -6.2665e-01, -3.9855e-02,
        -8.5502e-01,  3.6934e-02,  7.2662e-04, -4.4817e-02,  2.7321e-01,
         7.3827e-01,  1.2827e+00, -4.6935e-01,  1.5521e-01, -7.3895e-01,
         1.5634e-01, -3.4867e-01,  5.1531e-02, -2.7262e-01, -5.2225e-01,
        -6.2007e-02, -3.1105e-01, -2.0494e-01, -4.6337e-01, -1.0179e-01,
        -3.1500e-01, -3.4194e-01, -2.9697e-01,  6.0897e-01,  3.3105e-02,
        -3.5596e-01, -1.8347e-01, -2.6042e-02, -9.8206e-01,  1.2096e+00,
         1.2050e-02, -1.2701e-01,  3.6578e-01,  5.4786e-01,  3.5510e-01,
         7.7550e-01, -1.6629e-01, -6.0970e-01, -9.5197e-01, -4.2028e-01,
        -4.9942e-01, -5.7236e-01, -3.5900e-01, -2.7140e-01,  1.8030e-01,
        -3.4222e-01, -1.8088e-01,  2.7321e-01, -1.1102e-15, -1.1102e-15,
        -6.4060e-01, -1.2806e+00, -8.9790e-01, -7.7609e-01, -7.3985e-01,
        -6.4398e-01,  5.9012e-02, -4.6564e-01, -4.3832e-01, -2.7772e+00,
         1.4399e+00, -1.7049e-01,  4.6931e-01,  6.4231e-01, -6.3944e-01,
        -7.4605e-01,  8.8818e-15,  2.7867e-01,  2.7414e-02, -8.1351e-01,
        -2.2931e-02, -7.9242e-02, -3.9314e-01,  9.3958e-02, -5.6292e-01,
        -4.3957e-02,  9.3401e-02,  2.5380e+00,  5.9345e-01,  2.8250e-01,
        -4.1181e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([925]), tensor(-0.0976))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.1676e-01,  9.5332e-01,  5.9128e-02, -1.7205e+00, -1.0311e-01,
        -8.1990e-01, -1.6585e-01, -3.5892e-01,  4.3543e-01, -1.7735e-01,
        -7.2534e-01,  1.1109e-01, -7.1881e-01, -5.4888e-01,  9.1678e-02,
         5.3631e-01, -1.1613e-01,  1.9987e-01, -9.0169e-02,  6.5005e-01,
        -4.1457e-01, -6.7557e-02, -1.8307e-01,  1.6918e-02, -9.6752e-02,
        -3.4414e-01, -5.9236e-01, -9.5371e-02,  2.0022e-01,  1.3770e+00,
         3.5025e-01, -1.1689e-01,  7.9600e-01,  3.3865e-01, -2.0974e-01,
        -2.2510e-01,  1.7127e-01,  8.2319e-01, -5.7916e-03, -1.0873e+00,
        -2.5739e-01,  3.1429e-01,  4.0195e-01,  2.8640e-02, -1.5393e-01,
        -7.0467e-01,  1.1825e-01, -5.2297e-02, -3.5214e-01, -1.4572e-01,
        -8.5127e-01,  2.3200e-01, -4.6923e-01,  9.8502e-02,  7.3323e-04,
         4.8067e-01, -5.2395e-01, -1.8006e-01, -2.5147e-01, -2.7450e-02,
        -5.3786e-04, -3.0672e-01,  7.1259e-02,  2.1892e-01,  9.2232e-02,
        -1.9307e-01,  8.0423e-01, -2.4536e-01,  6.0833e-01, -5.7755e-01,
        -3.6034e-01, -1.8612e-01, -2.6389e-02, -8.5003e-01,  2.0454e-01,
         8.0607e-01,  9.4667e-01, -1.1984e+00,  2.5053e-01,  1.4819e-02,
        -1.0899e+00,  2.0934e-01,  4.1097e-01,  7.4576e-02, -5.8401e-01,
        -5.0024e-01, -5.7093e-01, -2.7806e-01,  1.2175e-01,  1.1774e-01,
        -6.4538e-01, -1.3307e+00,  2.7593e-01, -3.3307e-16, -3.3307e-16,
         3.4823e+00,  2.5980e-01,  2.5161e+00, -3.0980e+00,  6.7202e-01,
        -5.7052e-01,  2.3673e-01,  1.2265e-02, -4.4577e-02,  1.6373e-01,
         5.2495e-02, -1.5990e-01,  2.4184e-01,  6.4956e-01, -8.3091e-01,
         9.3903e-01, -1.7764e-14,  3.1753e-01,  2.6405e-02,  4.4465e-02,
         1.5956e-02,  4.1853e-01, -2.2497e-01,  1.0083e-01, -5.5285e-01,
         1.4900e-01, -2.0189e-01, -3.3770e-01,  3.6963e-01,  3.5570e-01,
        -4.1145e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([14178]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-6.9802e-01,  1.2601e-01,  2.7326e-02,  1.1184e+00, -1.9269e-01,
        -3.3091e-01, -7.0688e-01, -6.6964e-01, -6.0459e-01, -1.1729e+00,
        -8.1862e-02,  1.7271e+00,  1.9372e+00, -3.7816e-03, -5.0207e-01,
        -1.2429e-01, -1.9881e-01,  3.4870e-01, -2.6330e-02,  4.4819e-02,
        -1.5275e-01,  1.1228e+00, -2.1519e-01, -4.1044e-01, -6.3662e-02,
         1.4182e-01, -3.3343e-01, -4.3356e-01,  8.7727e-01, -1.2085e-01,
        -4.2216e-01, -8.6744e-02,  2.7469e-01,  3.3865e-01,  3.5207e-01,
        -2.8949e-01, -1.8315e-01, -2.9601e-01, -6.8622e-02, -1.1320e+00,
        -2.5906e-01, -3.6241e-01, -2.5639e-02, -6.2599e-01, -4.1522e-01,
        -6.9710e-01, -1.4443e-01, -5.7617e-01,  4.4260e-02, -5.9789e-02,
         7.3835e-01,  1.2416e+00, -4.6923e-01,  4.2309e-01, -7.3961e-01,
         1.0225e-01, -3.2907e-01, -4.6601e-01, -1.1526e-01, -1.5277e-01,
        -7.3557e-02, -1.8889e-01, -1.2936e-01, -2.6542e-02, -7.0753e-02,
        -2.8476e-01, -1.3652e-01, -3.4672e-01,  6.0833e-01,  9.8469e-03,
        -3.5734e-01, -1.8545e-01, -2.6389e-02, -5.2235e-01,  1.2265e+00,
        -1.3297e-01,  1.5290e-01,  2.4834e-01,  5.1771e-01,  3.5803e-01,
         7.7267e-01, -2.5899e-01, -5.9090e-01, -1.1098e+00, -3.3333e-01,
        -5.0762e-01, -5.7420e-01, -3.5747e-01, -4.6943e-01, -2.0689e-01,
        -2.9120e-01, -2.6347e-01,  2.7593e-01, -3.3307e-16, -3.3307e-16,
        -4.6978e-01, -1.2132e+00, -5.5294e-01, -1.3196e+00,  1.8767e-01,
         1.3975e+00,  1.2668e-01, -8.0014e-01, -5.2822e-01, -2.0363e+00,
         1.3824e+00, -1.9084e-01, -2.3429e+00,  6.4956e-01, -8.3660e-01,
        -9.6349e-01, -1.7764e-14,  2.4167e-01,  2.6405e-02, -7.5347e-01,
        -6.7922e-01, -2.7920e-02, -3.4535e-01,  1.0083e-01, -5.6184e-01,
        -6.8839e-02,  8.0848e-02,  2.5432e+00,  6.9831e-01,  3.4051e-01,
        -3.9283e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([937]), tensor(0.1020))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]
INFO:main.py:Testing data year: 2018
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 17220
            device: cpu
            
2024-07-17 00:55:57,131	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-17 00:55:57,181	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-17 00:55:57,219	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_524ec76d8a57c10b.zip' (1.31MiB) to Ray cluster...
2024-07-17 00:55:57,226	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_524ec76d8a57c10b.zip'.
2024-07-17 00:56:00,256	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-17 01:09:06,944	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-17_00-56-00' in 0.1587s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 17220, 'embedding_dim': 5, 'dropout_rate': 0.19, 'lr': 0.05, 'weight_decay': 1.9489008462344248e-05, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.15837674795566797
INFO:model_data_nn.py:Best trial testing loss: 0.0912390139598686
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-17_00-55-54_699979_1361901/artifacts/2024-07-17_00-56-00/train_fnn_2024-07-17_00-56-00/driver_artifacts/train_fnn_01d3f_00027_27_dropout_rate=0.1900,embedding_dim=5,hidden_dim=45,lr=0.0500,num_layers=1,weight_decay=0.0000_2024-07-17_00-56-00
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 17402, 'embedding_dim': 5, 'dropout_rate': 0.19, 'lr': 0.05, 'weight_decay': 1.9489008462344248e-05, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 0.35644437530618944, 'avg_test_loss': 0.10450869945522684}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.10447471036525544, 'avg_test_loss': 0.10611245494622451}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.10385846414727841, 'avg_test_loss': 0.10470227327627632}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.10731180400667552, 'avg_test_loss': 0.10519514218545876}
INFO:model_data_nn.py:Early stopping at epoch 4
INFO:main.py:Making prediction for data in year: 2019
INFO:main.py:Prediction data shape: (13264,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2019: 0.32448121455718076
INFO:main.py:Prediction Stats:                retq          pred
count  13264.000000  13264.000000
mean       0.056319      0.039903
std        0.323019      0.020459
min       -0.956827     -0.053052
25%       -0.068035      0.029024
50%        0.034312      0.035775
75%        0.149987      0.044930
max        7.044691      0.237700
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]
INFO:transform_data_nn.py:Train_data: (641159, 161)

INFO:transform_data_nn.py:Test data years: [2019]
INFO:transform_data_nn.py:Test_data: (13264, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019]
INFO:transform_data_nn.py:Retrain_data: (654423, 161)

INFO:transform_data_nn.py:Prediction data years: [2020]
INFO:transform_data_nn.py:Prediction_data: (13301, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([641159, 152])
            y_train_tf: torch.Size([641159])

            x_test_tf: torch.Size([13264, 152])
            y_test_tf: torch.Size([13264])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([654423, 152])
            y_retrain_tf: torch.Size([654423])

            x_prediction_tf: torch.Size([13301, 152])
            y_prediction_tf: torch.Size([13301])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.1676e-01,  9.5332e-01,  5.9128e-02, -1.7205e+00, -1.0311e-01,
        -8.1990e-01, -1.6585e-01, -3.5892e-01,  4.3543e-01, -1.7735e-01,
        -7.2534e-01,  1.1109e-01, -7.1881e-01, -5.4888e-01,  9.1678e-02,
         5.3631e-01, -1.1613e-01,  1.9987e-01, -9.0169e-02,  6.5005e-01,
        -4.1457e-01, -6.7557e-02, -1.8307e-01,  1.6918e-02, -9.6752e-02,
        -3.4414e-01, -5.9236e-01, -9.5371e-02,  2.0022e-01,  1.3770e+00,
         3.5025e-01, -1.1689e-01,  7.9600e-01,  3.3865e-01, -2.0974e-01,
        -2.2510e-01,  1.7127e-01,  8.2319e-01, -5.7916e-03, -1.0873e+00,
        -2.5739e-01,  3.1429e-01,  4.0195e-01,  2.8640e-02, -1.5393e-01,
        -7.0467e-01,  1.1825e-01, -5.2297e-02, -3.5214e-01, -1.4572e-01,
        -8.5127e-01,  2.3200e-01, -4.6923e-01,  9.8502e-02,  7.3323e-04,
         4.8067e-01, -5.2395e-01, -1.8006e-01, -2.5147e-01, -2.7450e-02,
        -5.3786e-04, -3.0672e-01,  7.1259e-02,  2.1892e-01,  9.2232e-02,
        -1.9307e-01,  8.0423e-01, -2.4536e-01,  6.0833e-01, -5.7755e-01,
        -3.6034e-01, -1.8612e-01, -2.6389e-02, -8.5003e-01,  2.0454e-01,
         8.0607e-01,  9.4667e-01, -1.1984e+00,  2.5053e-01,  1.4819e-02,
        -1.0899e+00,  2.0934e-01,  4.1097e-01,  7.4576e-02, -5.8401e-01,
        -5.0024e-01, -5.7093e-01, -2.7806e-01,  1.2175e-01,  1.1774e-01,
        -6.4538e-01, -1.3307e+00,  2.7593e-01, -3.3307e-16, -3.3307e-16,
         3.4823e+00,  2.5980e-01,  2.5161e+00, -3.0980e+00,  6.7202e-01,
        -5.7052e-01,  2.3673e-01,  1.2265e-02, -4.4577e-02,  1.6373e-01,
         5.2495e-02, -1.5990e-01,  2.4184e-01,  6.4956e-01, -8.3091e-01,
         9.3903e-01, -1.7764e-14,  3.1753e-01,  2.6405e-02,  4.4465e-02,
         1.5956e-02,  4.1853e-01, -2.2497e-01,  1.0083e-01, -5.5285e-01,
         1.4900e-01, -2.0189e-01, -3.3770e-01,  3.6963e-01,  3.5570e-01,
        -4.1145e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([14178]), tensor(-0.0558))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-6.9802e-01,  1.2601e-01,  2.7326e-02,  1.1184e+00, -1.9269e-01,
        -3.3091e-01, -7.0688e-01, -6.6964e-01, -6.0459e-01, -1.1729e+00,
        -8.1862e-02,  1.7271e+00,  1.9372e+00, -3.7816e-03, -5.0207e-01,
        -1.2429e-01, -1.9881e-01,  3.4870e-01, -2.6330e-02,  4.4819e-02,
        -1.5275e-01,  1.1228e+00, -2.1519e-01, -4.1044e-01, -6.3662e-02,
         1.4182e-01, -3.3343e-01, -4.3356e-01,  8.7727e-01, -1.2085e-01,
        -4.2216e-01, -8.6744e-02,  2.7469e-01,  3.3865e-01,  3.5207e-01,
        -2.8949e-01, -1.8315e-01, -2.9601e-01, -6.8622e-02, -1.1320e+00,
        -2.5906e-01, -3.6241e-01, -2.5639e-02, -6.2599e-01, -4.1522e-01,
        -6.9710e-01, -1.4443e-01, -5.7617e-01,  4.4260e-02, -5.9789e-02,
         7.3835e-01,  1.2416e+00, -4.6923e-01,  4.2309e-01, -7.3961e-01,
         1.0225e-01, -3.2907e-01, -4.6601e-01, -1.1526e-01, -1.5277e-01,
        -7.3557e-02, -1.8889e-01, -1.2936e-01, -2.6542e-02, -7.0753e-02,
        -2.8476e-01, -1.3652e-01, -3.4672e-01,  6.0833e-01,  9.8469e-03,
        -3.5734e-01, -1.8545e-01, -2.6389e-02, -5.2235e-01,  1.2265e+00,
        -1.3297e-01,  1.5290e-01,  2.4834e-01,  5.1771e-01,  3.5803e-01,
         7.7267e-01, -2.5899e-01, -5.9090e-01, -1.1098e+00, -3.3333e-01,
        -5.0762e-01, -5.7420e-01, -3.5747e-01, -4.6943e-01, -2.0689e-01,
        -2.9120e-01, -2.6347e-01,  2.7593e-01, -3.3307e-16, -3.3307e-16,
        -4.6978e-01, -1.2132e+00, -5.5294e-01, -1.3196e+00,  1.8767e-01,
         1.3975e+00,  1.2668e-01, -8.0014e-01, -5.2822e-01, -2.0363e+00,
         1.3824e+00, -1.9084e-01, -2.3429e+00,  6.4956e-01, -8.3660e-01,
        -9.6349e-01, -1.7764e-14,  2.4167e-01,  2.6405e-02, -7.5347e-01,
        -6.7922e-01, -2.7920e-02, -3.4535e-01,  1.0083e-01, -5.6184e-01,
        -6.8839e-02,  8.0848e-02,  2.5432e+00,  6.9831e-01,  3.4051e-01,
        -3.9283e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([937]), tensor(0.1020))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.1539e-01,  9.5694e-01,  5.7715e-02, -1.7252e+00, -1.0321e-01,
        -8.2251e-01, -1.7064e-01, -3.6223e-01,  4.3640e-01, -1.7624e-01,
        -7.2524e-01,  1.1644e-01, -7.1965e-01, -5.4697e-01,  9.1889e-02,
         5.3861e-01, -1.1525e-01,  1.9845e-01, -9.0948e-02,  6.5505e-01,
        -4.1452e-01, -6.6294e-02, -1.8884e-01,  1.8600e-02, -1.0072e-01,
        -3.4396e-01, -5.9176e-01, -9.7988e-02,  1.7522e-01,  1.3746e+00,
         3.5051e-01, -1.1628e-01,  7.9578e-01,  3.4199e-01, -2.0559e-01,
        -2.2410e-01,  1.7407e-01,  8.2458e-01, -5.5354e-03, -1.0817e+00,
        -2.5533e-01,  3.2940e-01,  4.0504e-01,  2.7797e-02, -1.5442e-01,
        -7.0337e-01,  1.2544e-01, -4.8968e-02, -3.5451e-01, -1.4122e-01,
        -8.5220e-01,  2.1814e-01, -4.6886e-01,  9.9233e-02,  3.4732e-03,
         4.8045e-01, -5.1829e-01, -1.7860e-01, -2.5068e-01, -2.1552e-02,
        -8.5449e-05, -3.0578e-01,  7.0157e-02,  2.1847e-01,  9.0758e-02,
        -1.9422e-01,  8.0985e-01, -2.4268e-01,  6.0847e-01, -5.7682e-01,
        -3.6158e-01, -1.8805e-01, -2.4393e-02, -8.4999e-01,  2.0961e-01,
         8.1073e-01,  9.5344e-01, -1.2019e+00,  2.4719e-01,  1.7171e-02,
        -1.1009e+00,  2.0898e-01,  4.1405e-01,  8.8214e-02, -5.8440e-01,
        -5.0664e-01, -5.7223e-01, -2.7775e-01,  1.2416e-01,  1.2166e-01,
        -6.5004e-01, -1.3287e+00,  2.7893e-01,  3.3307e-16,  3.3307e-16,
         3.5179e+00,  2.8104e-01,  2.5448e+00, -3.0181e+00,  6.7884e-01,
        -5.7321e-01,  2.4087e-01,  1.0039e-02, -4.3870e-02,  1.5819e-01,
         5.1909e-02, -1.6235e-01,  1.8136e-01,  6.5670e-01, -8.2995e-01,
         9.5472e-01,  1.9540e-14,  3.1697e-01,  3.0542e-02,  3.9156e-02,
         1.4859e-02,  4.2770e-01, -2.2604e-01,  1.0765e-01, -5.5116e-01,
         1.4899e-01, -1.9613e-01, -3.3310e-01,  3.7148e-01,  3.5471e-01,
        -4.1138e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([14363]), tensor(-0.0558))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-3.9281e-01, -1.2114e-01, -3.5078e-01,  1.1119e+00, -1.5017e-01,
        -8.1166e-01, -1.0248e+00, -7.8966e-01, -6.5343e-01, -1.1725e+00,
         3.8486e-01,  1.6364e+00,  1.4506e+00, -1.5449e-02, -5.6715e-01,
        -9.5622e-02, -2.0469e-01,  6.0259e-02, -9.1657e-01, -9.4196e-02,
         2.5999e-02,  2.3551e+00, -1.7626e-01, -3.8282e-01, -8.2401e-02,
         4.8556e-01, -3.3515e-01, -4.9046e-01,  8.8060e-01, -1.7100e-01,
        -4.8276e-01, -1.0565e-01,  2.2796e-01,  3.4199e-01,  2.9168e-01,
        -4.6589e-01, -2.2274e-01, -2.7129e-01, -2.1664e-01, -1.1050e+00,
        -2.5711e-01,  1.4532e-01, -5.3296e-01, -6.2877e-01, -2.2822e-01,
        -8.5014e-01,  3.0910e-01, -5.4812e-02, -2.1235e-01,  2.9141e-01,
         7.3818e-01,  1.3377e+00, -4.6886e-01,  1.2928e-01, -7.3980e-01,
         8.5223e-02, -3.5644e-01, -1.7107e-01,  3.7214e-01, -2.1984e-01,
        -3.6069e-02,  4.6368e-01,  2.0695e-02, -5.3520e-02, -1.4068e-02,
        -2.1228e-01, -3.2305e-01, -2.9569e-01, -6.3907e-02,  3.6925e-01,
        -3.5919e-01, -1.8740e-01, -2.4393e-02, -9.5910e-01,  1.2364e+00,
        -7.9380e-02, -5.9434e-01,  2.6803e-01,  4.6666e-01,  3.6294e-01,
         7.6960e-01, -2.7566e-01, -6.1538e-01, -1.1296e+00, -2.4332e-01,
        -5.1496e-01, -5.7592e-01, -4.0588e-01,  6.6453e-02, -1.2901e-02,
        -8.7442e-02, -6.5693e-01,  2.7893e-01,  3.3307e-16,  3.3307e-16,
        -6.9543e-01, -5.9449e-01, -8.0934e-01, -1.3770e+00, -3.6929e-01,
        -5.6299e-01, -2.6812e-02,  1.0039e-02, -4.9060e-01,  1.5819e-01,
         1.6596e+00, -1.8125e-01,  3.3084e-01,  6.5670e-01, -1.1996e-01,
         2.4606e-01,  1.9540e-14,  2.4620e-01,  3.0542e-02, -6.7374e-01,
         1.8372e-01,  2.9524e-03, -2.8426e-01,  1.0765e-01, -5.6080e-01,
         1.1831e-01,  2.4262e-02,  2.5551e+00,  6.0297e-01,  2.7418e-01,
        -3.9191e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([936]), tensor(-0.3402))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]
INFO:main.py:Testing data year: 2019
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 40
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 17402
            device: cpu
            
2024-07-17 02:25:14,451	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-17 02:25:14,494	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-17 02:25:14,529	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_524ec76d8a57c10b.zip' (1.31MiB) to Ray cluster...
2024-07-17 02:25:14,532	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_524ec76d8a57c10b.zip'.
2024-07-17 02:25:17,521	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-17 02:36:59,361	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-17_02-25-17' in 0.1436s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 2, 'num_embeddings': 17402, 'embedding_dim': 30, 'dropout_rate': 0.36, 'lr': 0.05, 'weight_decay': 0.00028480262754225174, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.11176177839527349
INFO:model_data_nn.py:Best trial testing loss: 0.10515117627353622
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-17_02-25-12_157934_1361901/artifacts/2024-07-17_02-25-17/train_fnn_2024-07-17_02-25-17/driver_artifacts/train_fnn_7b01d_00010_10_dropout_rate=0.3600,embedding_dim=30,hidden_dim=15,lr=0.0500,num_layers=2,weight_decay=0.0003_2024-07-17_02-25-17
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 2, 'num_embeddings': 17639, 'embedding_dim': 30, 'dropout_rate': 0.36, 'lr': 0.05, 'weight_decay': 0.00028480262754225174, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 0.2936025660617607, 'avg_test_loss': 0.3165790723780027}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.10455812266155477, 'avg_test_loss': 0.30644766262804085}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.10418808671777305, 'avg_test_loss': 0.32167449371459395}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.1122531505490263, 'avg_test_loss': 0.3196618231729819}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.10472370926429156, 'avg_test_loss': 0.3169156172527717}
INFO:model_data_nn.py:Early stopping at epoch 5
INFO:main.py:Making prediction for data in year: 2020
INFO:main.py:Prediction data shape: (13301,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:355: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2020: 0.5629380081908024
INFO:main.py:Prediction Stats:                retq          pred
count  13301.000000  13301.000000
mean       0.115792      0.057751
std        0.562998      0.014767
min       -0.955222      0.034432
25%       -0.158517      0.046981
50%        0.046018      0.052428
75%        0.288242      0.065680
max       18.046271      0.158397

 Configuration for experiment     train_fnn_2024-07-15_19-57-54   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_19-57-54
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-15_19-57-45_951807_1361901/artifacts/2024-07-15_19-57-54/train_fnn_2024-07-15_19-57-54/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-15_20-06-22   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_20-06-22
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-15_20-06-17_816666_1361901/artifacts/2024-07-15_20-06-22/train_fnn_2024-07-15_20-06-22/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-15_20-17-02   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_20-17-02
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-15_20-16-57_797975_1361901/artifacts/2024-07-15_20-17-02/train_fnn_2024-07-15_20-17-02/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-15_20-30-15   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_20-30-15
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-15_20-30-10_253814_1361901/artifacts/2024-07-15_20-30-15/train_fnn_2024-07-15_20-30-15/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-15_20-45-01   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_20-45-01
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-15_20-44-56_417685_1361901/artifacts/2024-07-15_20-45-01/train_fnn_2024-07-15_20-45-01/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-15_21-02-03   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_21-02-03
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-15_21-01-59_498157_1361901/artifacts/2024-07-15_21-02-03/train_fnn_2024-07-15_21-02-03/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-15_21-21-47   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_21-21-47
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-15_21-21-43_284950_1361901/artifacts/2024-07-15_21-21-47/train_fnn_2024-07-15_21-21-47/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-15_21-43-03   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_21-43-03
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-15_21-42-58_566519_1361901/artifacts/2024-07-15_21-43-03/train_fnn_2024-07-15_21-43-03/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-15_22-08-20   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_22-08-20
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-15_22-08-16_498034_1361901/artifacts/2024-07-15_22-08-20/train_fnn_2024-07-15_22-08-20/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-15_22-34-43   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_22-34-43
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-15_22-34-39_224650_1361901/artifacts/2024-07-15_22-34-43/train_fnn_2024-07-15_22-34-43/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-15_23-06-44   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_23-06-44
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-15_23-06-40_325976_1361901/artifacts/2024-07-15_23-06-44/train_fnn_2024-07-15_23-06-44/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-15_23-39-14   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_23-39-14
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-15_23-39-10_155994_1361901/artifacts/2024-07-15_23-39-14/train_fnn_2024-07-15_23-39-14/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_00-15-05   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_00-15-05
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_00-15-01_094208_1361901/artifacts/2024-07-16_00-15-05/train_fnn_2024-07-16_00-15-05/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_00-53-05   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_00-53-05
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_00-53-01_078855_1361901/artifacts/2024-07-16_00-53-05/train_fnn_2024-07-16_00-53-05/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_01-36-27   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_01-36-27
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_01-36-23_106028_1361901/artifacts/2024-07-16_01-36-27/train_fnn_2024-07-16_01-36-27/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_02-21-12   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_02-21-12
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_02-21-07_969756_1361901/artifacts/2024-07-16_02-21-12/train_fnn_2024-07-16_02-21-12/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_03-10-52   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_03-10-52
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_03-10-47_324756_1361901/artifacts/2024-07-16_03-10-52/train_fnn_2024-07-16_03-10-52/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_04-02-24   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_04-02-24
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_04-02-19_685547_1361901/artifacts/2024-07-16_04-02-24/train_fnn_2024-07-16_04-02-24/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_04-58-39   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_04-58-39
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_04-58-34_741647_1361901/artifacts/2024-07-16_04-58-39/train_fnn_2024-07-16_04-58-39/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_05-56-02   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_05-56-02
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_05-55-57_211906_1361901/artifacts/2024-07-16_05-56-02/train_fnn_2024-07-16_05-56-02/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_06-55-59   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_06-55-59
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_06-55-54_332628_1361901/artifacts/2024-07-16_06-55-59/train_fnn_2024-07-16_06-55-59/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_07-57-52   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_07-57-52
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_07-57-47_517129_1361901/artifacts/2024-07-16_07-57-52/train_fnn_2024-07-16_07-57-52/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_09-01-37   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_09-01-37
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_09-01-32_212965_1361901/artifacts/2024-07-16_09-01-37/train_fnn_2024-07-16_09-01-37/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_10-10-10   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_10-10-10
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_10-10-05_435502_1361901/artifacts/2024-07-16_10-10-10/train_fnn_2024-07-16_10-10-10/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_11-21-49   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_11-21-49
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_11-21-43_851315_1361901/artifacts/2024-07-16_11-21-49/train_fnn_2024-07-16_11-21-49/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_12-31-40   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_12-31-40
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_12-31-34_839694_1361901/artifacts/2024-07-16_12-31-40/train_fnn_2024-07-16_12-31-40/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_13-47-29   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_13-47-29
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_13-47-23_663828_1361901/artifacts/2024-07-16_13-47-29/train_fnn_2024-07-16_13-47-29/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_15-02-21   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_15-02-21
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_15-02-15_972458_1361901/artifacts/2024-07-16_15-02-21/train_fnn_2024-07-16_15-02-21/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_16-25-49   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_16-25-49
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_16-25-44_180137_1361901/artifacts/2024-07-16_16-25-49/train_fnn_2024-07-16_16-25-49/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_17-46-13   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_17-46-13
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_17-46-08_245437_1361901/artifacts/2024-07-16_17-46-13/train_fnn_2024-07-16_17-46-13/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_19-07-41   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_19-07-41
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_19-07-35_520467_1361901/artifacts/2024-07-16_19-07-41/train_fnn_2024-07-16_19-07-41/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_20-33-16   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_20-33-16
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_20-33-10_560452_1361901/artifacts/2024-07-16_20-33-16/train_fnn_2024-07-16_20-33-16/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_21-56-43   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_21-56-43
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_21-56-37_552329_1361901/artifacts/2024-07-16_21-56-43/train_fnn_2024-07-16_21-56-43/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_23-28-35   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_23-28-35
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_23-28-29_891098_1361901/artifacts/2024-07-16_23-28-35/train_fnn_2024-07-16_23-28-35/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-17_00-56-00   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-17_00-56-00
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-17_00-55-54_699979_1361901/artifacts/2024-07-17_00-56-00/train_fnn_2024-07-17_00-56-00/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-17_02-25-17   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-17_02-25-17
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-17_02-25-12_157934_1361901/artifacts/2024-07-17_02-25-17/train_fnn_2024-07-17_02-25-17/driver_artifacts`

INFO:postprocess_predictions.py:Post processing prediction files
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2014.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2013.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1992.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1995.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2002.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2005.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1985.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2020.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2012.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2015.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2004.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2003.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1994.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1993.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2009.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2000.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2007.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1999.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1990.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1997.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1986.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1988.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2016.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2011.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2018.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1996.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1991.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1998.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2006.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2001.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2008.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2019.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2010.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2017.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1989.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1987.csv
INFO:postprocess_predictions.py:Sort the result by date and rank both ascendingly
INFO:postprocess_predictions.py:Saved the result file: result.csv
to the directory: kevin/output/prediction/quarterly_new_vars
