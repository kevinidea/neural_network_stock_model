Current working directory
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml
source kevin/venv/bin/activate
which python3
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/bin/python3
2024-08-23 16:13:11,260	PANIC scripts.py:900 -- `--address` is a required flag unless starting a head node with `--head`.
Error: `{}` is a required flag unless starting a head node with `{}`.
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
INFO:preprocess_data_nn.py:

Loading and preprocessing data...

DEBUG:preprocess_data_nn.py:          date   permno
626    1980-01  10006.0
5399   1980-01  10057.0
11398  1980-01  10137.0
12828  1980-01  10145.0
13984  1980-01  10153.0
DEBUG:preprocess_data_nn.py:--------------------------------------------------
INFO:main.py:preprocessed df: (667724, 161)
INFO:preprocess_data_nn.py:

Applying secondary data preprocessing..

INFO:main.py:secondary preprocessed df: (667724, 161)
INFO:main.py:df sample:     permno       pdate        ym  gvkey  sic2    absacc       acc  ...      roea   roavola       ret        mve_m      retq  pyear     date
0  10006.0  1980-01-01  198001.0   1010    37  0.083420  0.083420  ...  0.141715  0.004512  0.211679   303420.750 -0.055806   1980  1980-01
1  10057.0  1980-01-01  198001.0   1098    36  0.088951  0.088951  ...  0.174252  0.035698  0.282297   111423.125 -0.069431   1980  1980-01
2  10137.0  1980-01-01  198001.0   1279    49  0.041008  0.041008  ...  0.097554  0.006254 -0.032258   617349.500 -0.108065   1980  1980-01
3  10145.0  1980-01-01  198001.0   1300    99  0.050486  0.050486  ...  0.122729  0.004320  0.150127  1415193.000 -0.085950   1980  1980-01
4  10153.0  1980-01-01  198001.0   1308    13       NaN       NaN  ...  0.109950  0.009149 -0.122744   429488.500 -0.285199   1980  1980-01

[5 rows x 161 columns]
INFO:main.py:Train year start: 1980
INFO:main.py:Prediction data years: [1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020]
INFO:main.py:

Loop through all the prediction years and build optimized model for each year

INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983]
INFO:transform_data_nn.py:Train_data: (37173, 161)

INFO:transform_data_nn.py:Test data years: [1984]
INFO:transform_data_nn.py:Test_data: (13554, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984]
INFO:transform_data_nn.py:Retrain_data: (50727, 161)

INFO:transform_data_nn.py:Prediction data years: [1985]
INFO:transform_data_nn.py:Prediction_data: (14870, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([37173, 152])
            y_train_tf: torch.Size([37173])

            x_test_tf: torch.Size([13554, 152])
            y_test_tf: torch.Size([13554])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([50727, 152])
            y_retrain_tf: torch.Size([50727])

            x_prediction_tf: torch.Size([14870, 152])
            y_prediction_tf: torch.Size([14870])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983]
INFO:main.py:Testing data year: 1984
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 3578
            device: cpu
            
2024-08-23 16:20:00,716	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 16:20:00,865	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 16:20:00,923	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_1f039aac55080bb2.zip' (5.13MiB) to Ray cluster...
2024-08-23 16:20:00,937	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_1f039aac55080bb2.zip'.
2024-08-23 16:20:02,496	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-23 16:25:43,895	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_16-20-02' in 0.3420s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 125, 'num_layers': 2, 'num_embeddings': 3578, 'embedding_dim': 3, 'dropout_rate': 0.5, 'lr': 5.531840383530181e-05, 'weight_decay': 0.0005864080259257125, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}
INFO:model_data_nn.py:Best trial training loss: 0.13546538255338011
INFO:model_data_nn.py:Best trial testing loss: 0.1259441630176778
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_16-19-56_663767_2457758/artifacts/2024-08-23_16-20-02/train_fnn_2024-08-23_16-20-02/driver_artifacts/train_fnn_393b5_00064_64_batch_size=128,dropout_rate=0.5000,embedding_dim=3,hidden_dim=125,lr=0.0001,num_layers=2,weight_decay=0.0_2024-08-23_16-20-03
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 125, 'num_layers': 2, 'num_embeddings': 4249, 'embedding_dim': 3, 'dropout_rate': 0.5, 'lr': 5.531840383530181e-05, 'weight_decay': 0.0005864080259257125, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/cuda/__init__.py:619: UserWarning: Can't initialize NVML
  warnings.warn("Can't initialize NVML")
INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.16304689246897747, 'avg_test_loss': 0.16429991306912187}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.15366626265599873, 'avg_test_loss': 0.16317954984230873}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.1508894728666002, 'avg_test_loss': 0.16246527598963845}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.14864025951711216, 'avg_test_loss': 0.16238389743698967}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.14711628212696976, 'avg_test_loss': 0.16259006251636735}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.14573437795795577, 'avg_test_loss': 0.1625297850268519}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.14452035747694247, 'avg_test_loss': 0.16264605770508447}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.14329789703090987, 'avg_test_loss': 0.16284775243610397}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.14243340422634523, 'avg_test_loss': 0.16304161355026767}
INFO:model_data_nn.py:Early stopping at epoch 9
INFO:main.py:Making prediction for data in year: 1985
INFO:main.py:Prediction data shape: (14870,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1985: 0.2351734510574653
INFO:main.py:Prediction Stats:                retq          pred
count  14870.000000  14870.000000
mean       0.059184      0.052615
std        0.233633      0.048547
min       -0.916667     -0.304461
25%       -0.069152      0.027507
50%        0.042554      0.062199
75%        0.171429      0.086479
max        4.111109      0.188121
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984]
INFO:transform_data_nn.py:Train_data: (50727, 161)

INFO:transform_data_nn.py:Test data years: [1985]
INFO:transform_data_nn.py:Test_data: (14870, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Retrain_data: (65597, 161)

INFO:transform_data_nn.py:Prediction data years: [1986]
INFO:transform_data_nn.py:Prediction_data: (15019, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([50727, 152])
            y_train_tf: torch.Size([50727])

            x_test_tf: torch.Size([14870, 152])
            y_test_tf: torch.Size([14870])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([65597, 152])
            y_retrain_tf: torch.Size([65597])

            x_prediction_tf: torch.Size([15019, 152])
            y_prediction_tf: torch.Size([15019])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984]
INFO:main.py:Testing data year: 1985
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 4249
            device: cpu
            
2024-08-23 16:33:30,172	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 16:33:30,224	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 16:33:30,289	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_ee02e0a1e6a4f516.zip' (4.98MiB) to Ray cluster...
2024-08-23 16:33:30,305	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_ee02e0a1e6a4f516.zip'.
2024-08-23 16:33:31,735	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-23 16:57:39,375	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_16-33-31' in 0.3499s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 3, 'num_embeddings': 4249, 'embedding_dim': 4, 'dropout_rate': 0.47, 'lr': 2.7022810517535554e-05, 'weight_decay': 0.0009403366840186871, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.13958961346924117
INFO:model_data_nn.py:Best trial testing loss: 0.16038853912263787
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_16-33-27_837067_2457758/artifacts/2024-08-23_16-33-31/train_fnn_2024-08-23_16-33-31/driver_artifacts/train_fnn_1b9b8_00059_59_batch_size=32,dropout_rate=0.4700,embedding_dim=4,hidden_dim=45,lr=0.0000,num_layers=3,weight_decay=0.000_2024-08-23_16-33-32
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 3, 'num_embeddings': 4799, 'embedding_dim': 4, 'dropout_rate': 0.47, 'lr': 2.7022810517535554e-05, 'weight_decay': 0.0009403366840186871, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.16049125023720728, 'avg_test_loss': 0.17406068219149368}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.15767669349021596, 'avg_test_loss': 0.1762781798046954}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.15665653362513868, 'avg_test_loss': 0.1774852730175282}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.15576819432631187, 'avg_test_loss': 0.1798951561939209}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.15452925915061236, 'avg_test_loss': 0.1820375436322486}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.1535414584624645, 'avg_test_loss': 0.18439147594444294}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 1986
INFO:main.py:Prediction data shape: (15019,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1986: 0.2618559858331471
INFO:main.py:Prediction Stats:                retq          pred
count  1.501900e+04  15019.000000
mean   2.116020e-02     -0.007384
std    2.505653e-01      0.071273
min   -9.375002e-01     -0.348664
25%   -1.200001e-01     -0.022856
50%    1.000000e-07      0.015761
75%    1.356736e-01      0.038261
max    3.999999e+00      0.099068
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Train_data: (65597, 161)

INFO:transform_data_nn.py:Test data years: [1986]
INFO:transform_data_nn.py:Test_data: (15019, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:transform_data_nn.py:Retrain_data: (80616, 161)

INFO:transform_data_nn.py:Prediction data years: [1987]
INFO:transform_data_nn.py:Prediction_data: (15222, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([65597, 152])
            y_train_tf: torch.Size([65597])

            x_test_tf: torch.Size([15019, 152])
            y_test_tf: torch.Size([15019])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([80616, 152])
            y_retrain_tf: torch.Size([80616])

            x_prediction_tf: torch.Size([15222, 152])
            y_prediction_tf: torch.Size([15222])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:main.py:Testing data year: 1986
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 4799
            device: cpu
            
2024-08-23 17:08:13,698	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 17:08:13,751	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 17:08:13,813	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_59839a8b5916af4e.zip' (5.16MiB) to Ray cluster...
2024-08-23 17:08:13,830	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_59839a8b5916af4e.zip'.
2024-08-23 17:08:15,433	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-23 17:14:56,023	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_17-08-15' in 0.3028s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 3, 'num_embeddings': 4799, 'embedding_dim': 8, 'dropout_rate': 0.39, 'lr': 5.792044561296821e-06, 'weight_decay': 0.00013562381460600193, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}
INFO:model_data_nn.py:Best trial training loss: 0.15379255562366348
INFO:model_data_nn.py:Best trial testing loss: 0.17083777470615344
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_17-08-11_251971_2457758/artifacts/2024-08-23_17-08-15/train_fnn_2024-08-23_17-08-15/driver_artifacts/train_fnn_f5969_00119_119_batch_size=16,dropout_rate=0.3900,embedding_dim=8,hidden_dim=55,lr=0.0000,num_layers=3,weight_decay=0.00_2024-08-23_17-08-16
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 3, 'num_embeddings': 5134, 'embedding_dim': 8, 'dropout_rate': 0.39, 'lr': 5.792044561296821e-06, 'weight_decay': 0.00013562381460600193, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.16883286828439167, 'avg_test_loss': 0.2136427964623861}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.16413370003378808, 'avg_test_loss': 0.21359438003048675}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.16196219117386965, 'avg_test_loss': 0.21351845692764937}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.16128755550433738, 'avg_test_loss': 0.21359999108073466}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.16079864516091186, 'avg_test_loss': 0.21343290672379256}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.16045284044972105, 'avg_test_loss': 0.21337340223141202}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.15995760527766617, 'avg_test_loss': 0.21341588957031735}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.15966799209480748, 'avg_test_loss': 0.21322434887430874}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.1593281543322289, 'avg_test_loss': 0.2131996107123354}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.15897642859894046, 'avg_test_loss': 0.21355901135742164}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.15856242808171353, 'avg_test_loss': 0.21267270243202313}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.15832437207880193, 'avg_test_loss': 0.21309604334934545}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.15812540345733933, 'avg_test_loss': 0.2120893798267641}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.15769190194159924, 'avg_test_loss': 0.21218247599743245}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.1571806389276484, 'avg_test_loss': 0.21259638457363392}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.15712538014013364, 'avg_test_loss': 0.2125737737089458}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.15661498129962337, 'avg_test_loss': 0.21215370392912075}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.1566212877768723, 'avg_test_loss': 0.21177905076379036}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.15614498957678077, 'avg_test_loss': 0.2118195069546835}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.15606455487887175, 'avg_test_loss': 0.21162981475789508}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.15540691792710568, 'avg_test_loss': 0.21192181549825462}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.15529519474964237, 'avg_test_loss': 0.21162033043488734}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.15503572082903447, 'avg_test_loss': 0.21160149008051313}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.15479933243258195, 'avg_test_loss': 0.2117458573472099}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.1545416014879031, 'avg_test_loss': 0.2114225505585117}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.15436325377461904, 'avg_test_loss': 0.2118773554890033}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.15409281031524746, 'avg_test_loss': 0.21138241856961565}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.15391361100710824, 'avg_test_loss': 0.2119885882707078}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.1535752040414275, 'avg_test_loss': 0.21198051382137947}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.15336421460324381, 'avg_test_loss': 0.21140535371847638}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.15350006106810563, 'avg_test_loss': 0.2111117729932821}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.153080205707772, 'avg_test_loss': 0.2112935837319105}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.1528876629251722, 'avg_test_loss': 0.21121654206370355}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.15272125386887717, 'avg_test_loss': 0.21109992120915852}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.152553763645788, 'avg_test_loss': 0.21106019655649527}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.15256109953284525, 'avg_test_loss': 0.21127998289659994}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.15216102504399548, 'avg_test_loss': 0.21072163108830191}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.15237821207047927, 'avg_test_loss': 0.2106521988420614}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.1519799851777299, 'avg_test_loss': 0.21084286519834974}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.15166536752916887, 'avg_test_loss': 0.2105933064047028}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.1518568297764549, 'avg_test_loss': 0.20984770824052706}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.15147753955397802, 'avg_test_loss': 0.21039368661057925}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.15132319229407626, 'avg_test_loss': 0.21063409935870842}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.15136377644806853, 'avg_test_loss': 0.2100313687501397}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.15124524167342146, 'avg_test_loss': 0.21042082746348836}
INFO:model_data_nn.py:Epoch 46/50, metrics: {'avg_train_loss': 0.15120017190832452, 'avg_test_loss': 0.2099835001628752}
INFO:model_data_nn.py:Early stopping at epoch 46
INFO:main.py:Making prediction for data in year: 1987
INFO:main.py:Prediction data shape: (15222,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1987: 0.2987778835470562
INFO:main.py:Prediction Stats:                retq          pred
count  1.522200e+04  15222.000000
mean  -7.633223e-03     -0.001552
std    3.006234e-01      0.039428
min   -9.431818e-01     -0.229794
25%   -1.803514e-01     -0.021127
50%   -7.049888e-07      0.005535
75%    1.343371e-01      0.026553
max    5.466666e+00      0.091054
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:transform_data_nn.py:Train_data: (80616, 161)

INFO:transform_data_nn.py:Test data years: [1987]
INFO:transform_data_nn.py:Test_data: (15222, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:transform_data_nn.py:Retrain_data: (95838, 161)

INFO:transform_data_nn.py:Prediction data years: [1988]
INFO:transform_data_nn.py:Prediction_data: (16210, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([80616, 152])
            y_train_tf: torch.Size([80616])

            x_test_tf: torch.Size([15222, 152])
            y_test_tf: torch.Size([15222])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([95838, 152])
            y_retrain_tf: torch.Size([95838])

            x_prediction_tf: torch.Size([16210, 152])
            y_prediction_tf: torch.Size([16210])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:main.py:Testing data year: 1987
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 5134
            device: cpu
            
2024-08-23 17:39:11,352	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 17:39:11,400	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 17:39:11,452	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_59839a8b5916af4e.zip' (5.16MiB) to Ray cluster...
2024-08-23 17:39:11,467	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_59839a8b5916af4e.zip'.
2024-08-23 17:39:12,797	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-23 17:52:10,303	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_17-39-12' in 0.5129s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 2, 'num_embeddings': 5134, 'embedding_dim': 7, 'dropout_rate': 0.14, 'lr': 0.0026148220784844123, 'weight_decay': 9.946913289874026e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}
INFO:model_data_nn.py:Best trial training loss: 0.12073992885601749
INFO:model_data_nn.py:Best trial testing loss: 0.19139438768227895
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_17-39-08_949258_2457758/artifacts/2024-08-23_17-39-12/train_fnn_2024-08-23_17-39-12/driver_artifacts/train_fnn_48a9c_00067_67_batch_size=256,dropout_rate=0.1400,embedding_dim=7,hidden_dim=15,lr=0.0026,num_layers=2,weight_decay=0.00_2024-08-23_17-39-13
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 2, 'num_embeddings': 5713, 'embedding_dim': 7, 'dropout_rate': 0.14, 'lr': 0.0026148220784844123, 'weight_decay': 9.946913289874026e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.15696598649184335, 'avg_test_loss': 0.1676886078203097}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.14809793721944253, 'avg_test_loss': 0.1749004361918196}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.14460435760690565, 'avg_test_loss': 0.1870360104367137}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1412129848996267, 'avg_test_loss': 0.1940267834579572}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.13888787145522188, 'avg_test_loss': 0.19746674038469791}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.13677888977177002, 'avg_test_loss': 0.19138928165193647}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 1988
INFO:main.py:Prediction data shape: (16210,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1988: 0.2973135283255777
INFO:main.py:Prediction Stats:                retq          pred
count  16210.000000  16210.000000
mean       0.049695     -0.057106
std        0.249702      0.089530
min       -0.901408     -0.700959
25%       -0.072601     -0.085916
50%        0.019064     -0.027558
75%        0.142858      0.003504
max        5.000002      0.196355
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:transform_data_nn.py:Train_data: (95838, 161)

INFO:transform_data_nn.py:Test data years: [1988]
INFO:transform_data_nn.py:Test_data: (16210, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:transform_data_nn.py:Retrain_data: (112048, 161)

INFO:transform_data_nn.py:Prediction data years: [1989]
INFO:transform_data_nn.py:Prediction_data: (16366, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([95838, 152])
            y_train_tf: torch.Size([95838])

            x_test_tf: torch.Size([16210, 152])
            y_test_tf: torch.Size([16210])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([112048, 152])
            y_retrain_tf: torch.Size([112048])

            x_prediction_tf: torch.Size([16366, 152])
            y_prediction_tf: torch.Size([16366])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:main.py:Testing data year: 1988
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 5713
            device: cpu
            
2024-08-23 18:06:10,391	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 18:06:10,433	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 18:06:10,483	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_59839a8b5916af4e.zip' (5.16MiB) to Ray cluster...
2024-08-23 18:06:10,497	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_59839a8b5916af4e.zip'.
2024-08-23 18:06:11,857	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-23 18:18:35,905	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_18-06-11' in 0.3481s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 5713, 'embedding_dim': 8, 'dropout_rate': 0.46, 'lr': 2.1028597652512023e-05, 'weight_decay': 5.590323850203873e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}
INFO:model_data_nn.py:Best trial training loss: 0.1553023057797105
INFO:model_data_nn.py:Best trial testing loss: 0.15873313359034485
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_18-06-08_012139_2457758/artifacts/2024-08-23_18-06-11/train_fnn_2024-08-23_18-06-11/driver_artifacts/train_fnn_0db2b_00011_11_batch_size=16,dropout_rate=0.4600,embedding_dim=8,hidden_dim=85,lr=0.0000,num_layers=4,weight_decay=0.000_2024-08-23_18-06-12
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 6323, 'embedding_dim': 8, 'dropout_rate': 0.46, 'lr': 2.1028597652512023e-05, 'weight_decay': 5.590323850203873e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.17305758234108667, 'avg_test_loss': 0.16511414903976235}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.16805910024864834, 'avg_test_loss': 0.1646770498335711}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.1672081282546133, 'avg_test_loss': 0.16423550973175674}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.16611721502399165, 'avg_test_loss': 0.16391266195626086}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.16528288783021744, 'avg_test_loss': 0.16328176326561766}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.16437375671575363, 'avg_test_loss': 0.16294764685476398}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.16372496004938636, 'avg_test_loss': 0.16256322210266794}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.16291665538930558, 'avg_test_loss': 0.16251259508341523}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.16246241999610006, 'avg_test_loss': 0.1621700208688761}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.16168566013993696, 'avg_test_loss': 0.16223404927585247}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.16114390585276292, 'avg_test_loss': 0.1619775903903727}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.1607376459614134, 'avg_test_loss': 0.16230094299914782}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.16021168296118046, 'avg_test_loss': 0.16204989245589294}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.1597463015510017, 'avg_test_loss': 0.1618759432955047}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.15966147730957095, 'avg_test_loss': 0.16410359205679925}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.15915253982330907, 'avg_test_loss': 0.1621131050716339}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.15856958651926098, 'avg_test_loss': 0.16455829808468458}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.15820644795043493, 'avg_test_loss': 0.16366773013131128}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.15792698971049438, 'avg_test_loss': 0.16344816053426395}
INFO:model_data_nn.py:Early stopping at epoch 19
INFO:main.py:Making prediction for data in year: 1989
INFO:main.py:Prediction data shape: (16366,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1989: 0.25420857616480175
INFO:main.py:Prediction Stats:                retq          pred
count  16366.000000  16366.000000
mean       0.032052     -0.024360
std        0.251212      0.045883
min       -0.945313     -0.386259
25%       -0.090909     -0.050557
50%        0.016642     -0.016559
75%        0.132440      0.009102
max        3.923078      0.082541
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:transform_data_nn.py:Train_data: (112048, 161)

INFO:transform_data_nn.py:Test data years: [1989]
INFO:transform_data_nn.py:Test_data: (16366, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:transform_data_nn.py:Retrain_data: (128414, 161)

INFO:transform_data_nn.py:Prediction data years: [1990]
INFO:transform_data_nn.py:Prediction_data: (16126, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([112048, 152])
            y_train_tf: torch.Size([112048])

            x_test_tf: torch.Size([16366, 152])
            y_test_tf: torch.Size([16366])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([128414, 152])
            y_retrain_tf: torch.Size([128414])

            x_prediction_tf: torch.Size([16126, 152])
            y_prediction_tf: torch.Size([16126])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:main.py:Testing data year: 1989
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 6323
            device: cpu
            
2024-08-23 18:42:11,619	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 18:42:11,672	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 18:42:11,727	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_59839a8b5916af4e.zip' (5.16MiB) to Ray cluster...
2024-08-23 18:42:11,744	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_59839a8b5916af4e.zip'.
2024-08-23 18:42:13,295	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-23 19:01:40,872	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_18-42-13' in 0.3652s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 35, 'num_layers': 4, 'num_embeddings': 6323, 'embedding_dim': 9, 'dropout_rate': 0.48, 'lr': 3.458458790818999e-05, 'weight_decay': 0.00018272051027736587, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}
INFO:model_data_nn.py:Best trial training loss: 0.15889928751326826
INFO:model_data_nn.py:Best trial testing loss: 0.16097948619347513
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_18-42-09_236353_2457758/artifacts/2024-08-23_18-42-13/train_fnn_2024-08-23_18-42-13/driver_artifacts/train_fnn_16040_00123_123_batch_size=16,dropout_rate=0.4800,embedding_dim=9,hidden_dim=35,lr=0.0000,num_layers=4,weight_decay=0.00_2024-08-23_18-42-14
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 35, 'num_layers': 4, 'num_embeddings': 6635, 'embedding_dim': 9, 'dropout_rate': 0.48, 'lr': 3.458458790818999e-05, 'weight_decay': 0.00018272051027736587, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.16862527513522596, 'avg_test_loss': 0.2085844403177145}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.16748114736652078, 'avg_test_loss': 0.2101947496024271}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.16678148882132823, 'avg_test_loss': 0.21045065184478604}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1659834353867164, 'avg_test_loss': 0.21108575700412666}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.1650911998553811, 'avg_test_loss': 0.21251771099392383}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.16437646270448172, 'avg_test_loss': 0.21335515644519576}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 1990
INFO:main.py:Prediction data shape: (16126,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1990: 0.3197961217642356
INFO:main.py:Prediction Stats:                retq          pred
count  16126.000000  16126.000000
mean      -0.047284      0.032512
std        0.309796      0.032039
min       -0.945652     -0.710880
25%       -0.208333      0.025060
50%       -0.046875      0.045872
75%        0.078226      0.051566
max       15.200000      0.055245
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:transform_data_nn.py:Train_data: (128414, 161)

INFO:transform_data_nn.py:Test data years: [1990]
INFO:transform_data_nn.py:Test_data: (16126, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:transform_data_nn.py:Retrain_data: (144540, 161)

INFO:transform_data_nn.py:Prediction data years: [1991]
INFO:transform_data_nn.py:Prediction_data: (16222, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([128414, 152])
            y_train_tf: torch.Size([128414])

            x_test_tf: torch.Size([16126, 152])
            y_test_tf: torch.Size([16126])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([144540, 152])
            y_retrain_tf: torch.Size([144540])

            x_prediction_tf: torch.Size([16222, 152])
            y_prediction_tf: torch.Size([16222])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:main.py:Testing data year: 1990
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 6635
            device: cpu
            
2024-08-23 19:22:40,784	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 19:22:40,834	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 19:22:40,888	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-23 19:22:40,899	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-23 19:22:42,436	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-23 19:32:18,320	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_19-22-42' in 0.6339s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 1, 'num_embeddings': 6635, 'embedding_dim': 4, 'dropout_rate': 0.2, 'lr': 2.6142275728582447e-05, 'weight_decay': 1.8469889509946742e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 64}
INFO:model_data_nn.py:Best trial training loss: 0.15558873401102374
INFO:model_data_nn.py:Best trial testing loss: 0.19982165724985182
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_19-22-38_291897_2457758/artifacts/2024-08-23_19-22-42/train_fnn_2024-08-23_19-22-42/driver_artifacts/train_fnn_bde57_00045_45_batch_size=64,dropout_rate=0.2000,embedding_dim=4,hidden_dim=55,lr=0.0000,num_layers=1,weight_decay=0.000_2024-08-23_19-22-42
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 1, 'num_embeddings': 6904, 'embedding_dim': 4, 'dropout_rate': 0.2, 'lr': 2.6142275728582447e-05, 'weight_decay': 1.8469889509946742e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 64}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.17024150482841674, 'avg_test_loss': 0.24529847247511383}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.16662844439079214, 'avg_test_loss': 0.2453103005064754}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.16492635350215742, 'avg_test_loss': 0.24410585903628604}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.16369929887268583, 'avg_test_loss': 0.24765343779302018}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.16297353690274, 'avg_test_loss': 0.2487253301197619}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.16227730760883716, 'avg_test_loss': 0.24897444350864945}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.16156975812781058, 'avg_test_loss': 0.24996551598502895}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.1609890484824394, 'avg_test_loss': 0.25197280306867725}
INFO:model_data_nn.py:Early stopping at epoch 8
INFO:main.py:Making prediction for data in year: 1991
INFO:main.py:Prediction data shape: (16222,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1991: 0.4425081411981133
INFO:main.py:Prediction Stats:                retq          pred
count  16222.000000  16222.000000
mean       0.115448     -0.053193
std        0.411550      0.077264
min       -0.988636     -0.520787
25%       -0.078436     -0.099861
50%        0.046431     -0.050094
75%        0.225745      0.004820
max       10.600000      0.370845
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:transform_data_nn.py:Train_data: (144540, 161)

INFO:transform_data_nn.py:Test data years: [1991]
INFO:transform_data_nn.py:Test_data: (16222, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:transform_data_nn.py:Retrain_data: (160762, 161)

INFO:transform_data_nn.py:Prediction data years: [1992]
INFO:transform_data_nn.py:Prediction_data: (16382, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([144540, 152])
            y_train_tf: torch.Size([144540])

            x_test_tf: torch.Size([16222, 152])
            y_test_tf: torch.Size([16222])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([160762, 152])
            y_retrain_tf: torch.Size([160762])

            x_prediction_tf: torch.Size([16382, 152])
            y_prediction_tf: torch.Size([16382])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:main.py:Testing data year: 1991
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 6904
            device: cpu
            
2024-08-23 19:52:37,673	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 19:52:37,724	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 19:52:37,776	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-23 19:52:37,787	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-23 19:52:39,215	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-23 20:10:45,778	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_19-52-39' in 0.3386s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 35, 'num_layers': 4, 'num_embeddings': 6904, 'embedding_dim': 5, 'dropout_rate': 0.45, 'lr': 9.099223287474213e-05, 'weight_decay': 0.0006856364735411887, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 64}
INFO:model_data_nn.py:Best trial training loss: 0.1533945216190984
INFO:model_data_nn.py:Best trial testing loss: 0.23002828226432087
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_19-52-35_175702_2457758/artifacts/2024-08-23_19-52-39/train_fnn_2024-08-23_19-52-39/driver_artifacts/train_fnn_ecdc3_00033_33_batch_size=64,dropout_rate=0.4500,embedding_dim=5,hidden_dim=35,lr=0.0001,num_layers=4,weight_decay=0.000_2024-08-23_19-52-39
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 35, 'num_layers': 4, 'num_embeddings': 7233, 'embedding_dim': 5, 'dropout_rate': 0.45, 'lr': 9.099223287474213e-05, 'weight_decay': 0.0006856364735411887, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 64}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.17940116369275635, 'avg_test_loss': 0.20562661031726748}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.17781084162905986, 'avg_test_loss': 0.20450694594183005}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.17540992226129698, 'avg_test_loss': 0.2031435716780834}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.17328175480730834, 'avg_test_loss': 0.20258331327931955}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.17163383225457501, 'avg_test_loss': 0.20223404874559492}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.1699821055113486, 'avg_test_loss': 0.2025675919430796}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.16888366560687207, 'avg_test_loss': 0.2031173017458059}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.1677439707753811, 'avg_test_loss': 0.20324291262659244}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.1666961882793063, 'avg_test_loss': 0.20389877655543387}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.16601562947153523, 'avg_test_loss': 0.2046322296373546}
INFO:model_data_nn.py:Early stopping at epoch 10
INFO:main.py:Making prediction for data in year: 1992
INFO:main.py:Prediction data shape: (16382,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1992: 0.3443654808993034
INFO:main.py:Prediction Stats:                retq          pred
count  16382.000000  16382.000000
mean       0.062721      0.051659
std        0.346966      0.050339
min       -0.958333     -0.215663
25%       -0.103448      0.020350
50%        0.013034      0.043841
75%        0.162791      0.084519
max        7.000003      0.277442
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:transform_data_nn.py:Train_data: (160762, 161)

INFO:transform_data_nn.py:Test data years: [1992]
INFO:transform_data_nn.py:Test_data: (16382, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Retrain_data: (177144, 161)

INFO:transform_data_nn.py:Prediction data years: [1993]
INFO:transform_data_nn.py:Prediction_data: (17602, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([160762, 152])
            y_train_tf: torch.Size([160762])

            x_test_tf: torch.Size([16382, 152])
            y_test_tf: torch.Size([16382])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([177144, 152])
            y_retrain_tf: torch.Size([177144])

            x_prediction_tf: torch.Size([17602, 152])
            y_prediction_tf: torch.Size([17602])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:main.py:Testing data year: 1992
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 7233
            device: cpu
            
2024-08-23 20:35:05,907	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 20:35:05,958	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 20:35:06,010	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-23 20:35:06,023	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-23 20:35:07,495	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-23 20:59:19,633	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_20-35-07' in 0.3614s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 35, 'num_layers': 4, 'num_embeddings': 7233, 'embedding_dim': 4, 'dropout_rate': 0.46, 'lr': 3.181776224544813e-05, 'weight_decay': 2.0853015275605933e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}
INFO:model_data_nn.py:Best trial training loss: 0.16892676547650223
INFO:model_data_nn.py:Best trial testing loss: 0.20251199116682983
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_20-35-03_525548_2457758/artifacts/2024-08-23_20-35-07/train_fnn_2024-08-23_20-35-07/driver_artifacts/train_fnn_dbc0e_00090_90_batch_size=16,dropout_rate=0.4600,embedding_dim=4,hidden_dim=35,lr=0.0000,num_layers=4,weight_decay=0.000_2024-08-23_20-35-08
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 35, 'num_layers': 4, 'num_embeddings': 7594, 'embedding_dim': 4, 'dropout_rate': 0.46, 'lr': 3.181776224544813e-05, 'weight_decay': 2.0853015275605933e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.1823078688722339, 'avg_test_loss': 0.17797525487264973}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.1813566294023364, 'avg_test_loss': 0.17781744435849134}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.1810448998202585, 'avg_test_loss': 0.17773210875128315}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.18052634434097667, 'avg_test_loss': 0.17777848680868244}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.17987592750104525, 'avg_test_loss': 0.17778335499165276}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.17939631008106394, 'avg_test_loss': 0.178272213201486}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.17859459889506046, 'avg_test_loss': 0.1777978964677786}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.1780357587076108, 'avg_test_loss': 0.17851571699470742}
INFO:model_data_nn.py:Early stopping at epoch 8
INFO:main.py:Making prediction for data in year: 1993
INFO:main.py:Prediction data shape: (17602,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1993: 0.3097747629858985
INFO:main.py:Prediction Stats:                retq          pred
count  17602.000000  17602.000000
mean       0.049683     -0.003089
std        0.303347      0.030103
min       -0.941177     -0.181514
25%       -0.092593     -0.017807
50%        0.012762      0.001159
75%        0.142857      0.018456
max       12.250001      0.058573
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Train_data: (177144, 161)

INFO:transform_data_nn.py:Test data years: [1993]
INFO:transform_data_nn.py:Test_data: (17602, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:transform_data_nn.py:Retrain_data: (194746, 161)

INFO:transform_data_nn.py:Prediction data years: [1994]
INFO:transform_data_nn.py:Prediction_data: (19550, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([177144, 152])
            y_train_tf: torch.Size([177144])

            x_test_tf: torch.Size([17602, 152])
            y_test_tf: torch.Size([17602])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([194746, 152])
            y_retrain_tf: torch.Size([194746])

            x_prediction_tf: torch.Size([19550, 152])
            y_prediction_tf: torch.Size([19550])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:main.py:Testing data year: 1993
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 7594
            device: cpu
            
2024-08-23 21:28:44,477	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 21:28:44,524	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 21:28:44,578	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-23 21:28:44,591	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-23 21:28:46,108	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-23 21:54:49,824	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_21-28-46' in 0.3003s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 95, 'num_layers': 4, 'num_embeddings': 7594, 'embedding_dim': 7, 'dropout_rate': 0.37, 'lr': 5.746834192183511e-06, 'weight_decay': 1.3384496505934229e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 64}
INFO:model_data_nn.py:Best trial training loss: 0.1799101657333424
INFO:model_data_nn.py:Best trial testing loss: 0.17779904474382816
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_21-28-42_032023_2457758/artifacts/2024-08-23_21-28-46/train_fnn_2024-08-23_21-28-46/driver_artifacts/train_fnn_5a325_00074_74_batch_size=64,dropout_rate=0.3700,embedding_dim=7,hidden_dim=95,lr=0.0000,num_layers=4,weight_decay=0.000_2024-08-23_21-28-46
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 95, 'num_layers': 4, 'num_embeddings': 8208, 'embedding_dim': 7, 'dropout_rate': 0.37, 'lr': 5.746834192183511e-06, 'weight_decay': 1.3384496505934229e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 64}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.18828676191552307, 'avg_test_loss': 0.15680329786504016}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.18407789439472377, 'avg_test_loss': 0.15703721850915672}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.18250050092266626, 'avg_test_loss': 0.15700005304092676}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.18170164621274068, 'avg_test_loss': 0.15715067358870133}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.18127164840551288, 'avg_test_loss': 0.15727860531678386}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.18092700641144271, 'avg_test_loss': 0.1574734752522964}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 1994
INFO:main.py:Prediction data shape: (19550,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1994: 0.24690370282620425
INFO:main.py:Prediction Stats:                retq          pred
count  19550.000000  19550.000000
mean      -0.009021      0.009473
std        0.246687      0.013639
min       -0.941176     -1.341438
25%       -0.125000      0.007389
50%       -0.014632      0.011453
75%        0.082227      0.014660
max        6.294121      0.030870
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:transform_data_nn.py:Train_data: (194746, 161)

INFO:transform_data_nn.py:Test data years: [1994]
INFO:transform_data_nn.py:Test_data: (19550, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:transform_data_nn.py:Retrain_data: (214296, 161)

INFO:transform_data_nn.py:Prediction data years: [1995]
INFO:transform_data_nn.py:Prediction_data: (22259, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([194746, 152])
            y_train_tf: torch.Size([194746])

            x_test_tf: torch.Size([19550, 152])
            y_test_tf: torch.Size([19550])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([214296, 152])
            y_retrain_tf: torch.Size([214296])

            x_prediction_tf: torch.Size([22259, 152])
            y_prediction_tf: torch.Size([22259])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:main.py:Testing data year: 1994
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 8208
            device: cpu
            
2024-08-23 22:23:21,398	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 22:23:21,452	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 22:23:21,508	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-23 22:23:21,522	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-23 22:23:23,046	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-23 22:44:50,029	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_22-23-23' in 0.3503s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 175, 'num_layers': 2, 'num_embeddings': 8208, 'embedding_dim': 10, 'dropout_rate': 0.28, 'lr': 8.336150939664184e-06, 'weight_decay': 2.700624012271142e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.17324723786962942
INFO:model_data_nn.py:Best trial testing loss: 0.15316182394464745
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_22-23-18_943000_2457758/artifacts/2024-08-23_22-23-23/train_fnn_2024-08-23_22-23-23/driver_artifacts/train_fnn_fb676_00005_5_batch_size=32,dropout_rate=0.2800,embedding_dim=10,hidden_dim=175,lr=0.0000,num_layers=2,weight_decay=0.00_2024-08-23_22-23-23
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 175, 'num_layers': 2, 'num_embeddings': 9180, 'embedding_dim': 10, 'dropout_rate': 0.28, 'lr': 8.336150939664184e-06, 'weight_decay': 2.700624012271142e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.1853106641850413, 'avg_test_loss': 0.1873037240671358}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.1774596265053183, 'avg_test_loss': 0.1872151857027891}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.17547593971885733, 'avg_test_loss': 0.18705334351665673}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1743122434506155, 'avg_test_loss': 0.18725481423838386}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.17361605550377243, 'avg_test_loss': 0.1873426922522057}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.17286981883700248, 'avg_test_loss': 0.18759434303033284}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.17229776782859363, 'avg_test_loss': 0.1884228822336286}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.1717649080290981, 'avg_test_loss': 0.18807473022961754}
INFO:model_data_nn.py:Early stopping at epoch 8
INFO:main.py:Making prediction for data in year: 1995
INFO:main.py:Prediction data shape: (22259,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1995: 0.3039984152752537
INFO:main.py:Prediction Stats:                retq          pred
count  22259.000000  22259.000000
mean       0.068422     -0.031230
std        0.287634      0.043735
min       -0.950000     -0.366542
25%       -0.062810     -0.055679
50%        0.041558     -0.023962
75%        0.165696      0.000960
max        4.272732      0.082874
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:transform_data_nn.py:Train_data: (214296, 161)

INFO:transform_data_nn.py:Test data years: [1995]
INFO:transform_data_nn.py:Test_data: (22259, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:transform_data_nn.py:Retrain_data: (236555, 161)

INFO:transform_data_nn.py:Prediction data years: [1996]
INFO:transform_data_nn.py:Prediction_data: (22619, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([214296, 152])
            y_train_tf: torch.Size([214296])

            x_test_tf: torch.Size([22259, 152])
            y_test_tf: torch.Size([22259])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([236555, 152])
            y_retrain_tf: torch.Size([236555])

            x_prediction_tf: torch.Size([22619, 152])
            y_prediction_tf: torch.Size([22619])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:main.py:Testing data year: 1995
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 9180
            device: cpu
            
2024-08-23 23:16:46,256	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 23:16:46,305	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 23:16:46,357	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-23 23:16:46,374	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-23 23:16:47,958	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-23 23:31:12,277	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_23-16-47' in 0.3824s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 85, 'num_layers': 5, 'num_embeddings': 9180, 'embedding_dim': 3, 'dropout_rate': 0.51, 'lr': 0.0001784081043570226, 'weight_decay': 0.00010584876203994529, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}
INFO:model_data_nn.py:Best trial training loss: 0.16872457782498682
INFO:model_data_nn.py:Best trial testing loss: 0.177194246958042
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_23-16-43_904275_2457758/artifacts/2024-08-23_23-16-47/train_fnn_2024-08-23_23-16-47/driver_artifacts/train_fnn_71ae1_00014_14_batch_size=256,dropout_rate=0.5100,embedding_dim=3,hidden_dim=85,lr=0.0002,num_layers=5,weight_decay=0.00_2024-08-23_23-16-48
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 85, 'num_layers': 5, 'num_embeddings': 10061, 'embedding_dim': 3, 'dropout_rate': 0.51, 'lr': 0.0001784081043570226, 'weight_decay': 0.00010584876203994529, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.18075283187808414, 'avg_test_loss': 0.17496960350636687}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.1789936652624762, 'avg_test_loss': 0.17461205633838525}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.17798892366679717, 'avg_test_loss': 0.17422581104080329}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.176118889460703, 'avg_test_loss': 0.17376922682095108}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.1747795995889288, 'avg_test_loss': 0.1736830352397447}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.17357542604466022, 'avg_test_loss': 0.17422781918156013}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.1724102526774138, 'avg_test_loss': 0.17469533030571563}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.17145874065818725, 'avg_test_loss': 0.17399736929140733}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.17042785961971138, 'avg_test_loss': 0.1743990621539984}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.16976029154929248, 'avg_test_loss': 0.17451935144287817}
INFO:model_data_nn.py:Early stopping at epoch 10
INFO:main.py:Making prediction for data in year: 1996
INFO:main.py:Prediction data shape: (22619,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1996: 0.28628654974369183
INFO:main.py:Prediction Stats:                retq          pred
count  22619.000000  22619.000000
mean       0.044741      0.035217
std        0.289333      0.043843
min       -0.961538     -0.221958
25%       -0.085714      0.007411
50%        0.018182      0.043154
75%        0.140416      0.065852
max       10.111111      0.127938
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:transform_data_nn.py:Train_data: (236555, 161)

INFO:transform_data_nn.py:Test data years: [1996]
INFO:transform_data_nn.py:Test_data: (22619, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:transform_data_nn.py:Retrain_data: (259174, 161)

INFO:transform_data_nn.py:Prediction data years: [1997]
INFO:transform_data_nn.py:Prediction_data: (23999, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([236555, 152])
            y_train_tf: torch.Size([236555])

            x_test_tf: torch.Size([22619, 152])
            y_test_tf: torch.Size([22619])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([259174, 152])
            y_retrain_tf: torch.Size([259174])

            x_prediction_tf: torch.Size([23999, 152])
            y_prediction_tf: torch.Size([23999])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:main.py:Testing data year: 1996
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 10061
            device: cpu
            
2024-08-24 00:04:34,852	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 00:04:34,901	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 00:04:34,953	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-24 00:04:34,967	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-24 00:04:36,600	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 00:44:33,608	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_00-04-36' in 0.3513s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 5, 'num_embeddings': 10061, 'embedding_dim': 4, 'dropout_rate': 0.35, 'lr': 2.302607565286742e-05, 'weight_decay': 4.960828101925176e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 8}
INFO:model_data_nn.py:Best trial training loss: 0.17617085823286743
INFO:model_data_nn.py:Best trial testing loss: 0.17272498598388136
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_00-04-32_448579_2457758/artifacts/2024-08-24_00-04-36/train_fnn_2024-08-24_00-04-36/driver_artifacts/train_fnn_1f862_00100_100_batch_size=8,dropout_rate=0.3500,embedding_dim=4,hidden_dim=25,lr=0.0000,num_layers=5,weight_decay=0.000_2024-08-24_00-04-37
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 5, 'num_embeddings': 10656, 'embedding_dim': 4, 'dropout_rate': 0.35, 'lr': 2.302607565286742e-05, 'weight_decay': 4.960828101925176e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 8}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.17921898501590197, 'avg_test_loss': 0.2005461609652266}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.1789404273961475, 'avg_test_loss': 0.1999692808125789}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.17876089551980656, 'avg_test_loss': 0.19975443824008107}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.17847717311462116, 'avg_test_loss': 0.19968773682167132}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.17813760510122936, 'avg_test_loss': 0.198804651391382}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.17778480912521133, 'avg_test_loss': 0.1987220105820646}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.17745776358299148, 'avg_test_loss': 0.19846036839547257}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.1771289727961407, 'avg_test_loss': 0.19896020877423387}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.17677266518487064, 'avg_test_loss': 0.1985220734992375}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.17650496722393935, 'avg_test_loss': 0.19817238786506156}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.17625684514744105, 'avg_test_loss': 0.1987198283796509}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.17599193685679915, 'avg_test_loss': 0.19893948018488786}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.17583484466415686, 'avg_test_loss': 0.19879418097436427}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.17560896264324302, 'avg_test_loss': 0.19909835026537379}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.17533909525911542, 'avg_test_loss': 0.1991659364514053}
INFO:model_data_nn.py:Early stopping at epoch 15
INFO:main.py:Making prediction for data in year: 1997
INFO:main.py:Prediction data shape: (23999,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1997: 0.3169586513989892
INFO:main.py:Prediction Stats:                retq          pred
count  23999.000000  23999.000000
mean       0.055567     -0.006877
std        0.312191      0.040198
min       -0.982955     -0.349189
25%       -0.095238     -0.021467
50%        0.035715      0.007752
75%        0.181672      0.014537
max       14.000004      0.226792
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:transform_data_nn.py:Train_data: (259174, 161)

INFO:transform_data_nn.py:Test data years: [1997]
INFO:transform_data_nn.py:Test_data: (23999, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:transform_data_nn.py:Retrain_data: (283173, 161)

INFO:transform_data_nn.py:Prediction data years: [1998]
INFO:transform_data_nn.py:Prediction_data: (24412, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([259174, 152])
            y_train_tf: torch.Size([259174])

            x_test_tf: torch.Size([23999, 152])
            y_test_tf: torch.Size([23999])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([283173, 152])
            y_retrain_tf: torch.Size([283173])

            x_prediction_tf: torch.Size([24412, 152])
            y_prediction_tf: torch.Size([24412])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:main.py:Testing data year: 1997
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 10656
            device: cpu
            
2024-08-24 01:51:38,975	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 01:51:39,028	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 01:51:39,084	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-24 01:51:39,098	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-24 01:51:40,643	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 02:23:43,614	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_01-51-40' in 0.3718s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 75, 'num_layers': 4, 'num_embeddings': 10656, 'embedding_dim': 9, 'dropout_rate': 0.51, 'lr': 1.3553240331512145e-05, 'weight_decay': 1.9007246875956177e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 64}
INFO:model_data_nn.py:Best trial training loss: 0.17513840473501968
INFO:model_data_nn.py:Best trial testing loss: 0.19651787423094114
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_01-51-36_507956_2457758/artifacts/2024-08-24_01-51-40/train_fnn_2024-08-24_01-51-40/driver_artifacts/train_fnn_148d5_00017_17_batch_size=64,dropout_rate=0.5100,embedding_dim=9,hidden_dim=75,lr=0.0000,num_layers=4,weight_decay=0.000_2024-08-24_01-51-40
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 75, 'num_layers': 4, 'num_embeddings': 11533, 'embedding_dim': 9, 'dropout_rate': 0.51, 'lr': 1.3553240331512145e-05, 'weight_decay': 1.9007246875956177e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 64}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.18571633480617247, 'avg_test_loss': 0.2351265021292639}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.18096095393285505, 'avg_test_loss': 0.23479814862549617}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.1804630983684879, 'avg_test_loss': 0.23489176165995174}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1802610907531857, 'avg_test_loss': 0.2354583962776586}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.18000621852005208, 'avg_test_loss': 0.23571168976538467}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.1799245254215776, 'avg_test_loss': 0.23567977976736598}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.17965903551996454, 'avg_test_loss': 0.23572077524131504}
INFO:model_data_nn.py:Early stopping at epoch 7
INFO:main.py:Making prediction for data in year: 1998
INFO:main.py:Prediction data shape: (24412,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1998: 0.3691779868825657
INFO:main.py:Prediction Stats:                retq          pred
count  24412.000000  24412.000000
mean       0.004293      0.026484
std        0.368725      0.014167
min       -0.979592     -0.098849
25%       -0.186753      0.022490
50%       -0.017392      0.032004
75%        0.131659      0.035729
max       10.538459      0.039540
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:transform_data_nn.py:Train_data: (283173, 161)

INFO:transform_data_nn.py:Test data years: [1998]
INFO:transform_data_nn.py:Test_data: (24412, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Retrain_data: (307585, 161)

INFO:transform_data_nn.py:Prediction data years: [1999]
INFO:transform_data_nn.py:Prediction_data: (23257, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([283173, 152])
            y_train_tf: torch.Size([283173])

            x_test_tf: torch.Size([24412, 152])
            y_test_tf: torch.Size([24412])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([307585, 152])
            y_retrain_tf: torch.Size([307585])

            x_prediction_tf: torch.Size([23257, 152])
            y_prediction_tf: torch.Size([23257])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:main.py:Testing data year: 1998
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 11533
            device: cpu
            
2024-08-24 03:03:36,725	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 03:03:36,777	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 03:03:36,831	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-24 03:03:36,845	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-24 03:03:38,446	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 03:54:29,900	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_03-03-38' in 0.3481s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 11533, 'embedding_dim': 10, 'dropout_rate': 0.18, 'lr': 0.0002854193173606708, 'weight_decay': 0.00011013093226265216, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.17245204511392936
INFO:model_data_nn.py:Best trial testing loss: 0.2194030548825489
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_03-03-34_377495_2457758/artifacts/2024-08-24_03-03-38/train_fnn_2024-08-24_03-03-38/driver_artifacts/train_fnn_2229a_00070_70_batch_size=32,dropout_rate=0.1800,embedding_dim=10,hidden_dim=5,lr=0.0003,num_layers=4,weight_decay=0.000_2024-08-24_03-03-39
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 12245, 'embedding_dim': 10, 'dropout_rate': 0.18, 'lr': 0.0002854193173606708, 'weight_decay': 0.00011013093226265216, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.18397082874874646, 'avg_test_loss': 0.2636964779649509}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.1815433115816605, 'avg_test_loss': 0.26380479066252216}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.18003896656405463, 'avg_test_loss': 0.27488277400581185}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.17901796247783772, 'avg_test_loss': 0.27053081369260645}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.17815388473083316, 'avg_test_loss': 0.27181747006418944}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.1778429714072212, 'avg_test_loss': 0.26884990603633563}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 1999
INFO:main.py:Prediction data shape: (23257,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1999: 0.5264655751377709
INFO:main.py:Prediction Stats:                retq          pred
count  23257.000000  23257.000000
mean       0.079897     -0.057662
std        0.505723      0.038369
min       -0.980932     -0.259082
25%       -0.147059     -0.080021
50%        0.000000     -0.058556
75%        0.177420     -0.036490
max       16.624997      0.282272
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Train_data: (307585, 161)

INFO:transform_data_nn.py:Test data years: [1999]
INFO:transform_data_nn.py:Test_data: (23257, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:transform_data_nn.py:Retrain_data: (330842, 161)

INFO:transform_data_nn.py:Prediction data years: [2000]
INFO:transform_data_nn.py:Prediction_data: (22167, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([307585, 152])
            y_train_tf: torch.Size([307585])

            x_test_tf: torch.Size([23257, 152])
            y_test_tf: torch.Size([23257])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([330842, 152])
            y_retrain_tf: torch.Size([330842])

            x_prediction_tf: torch.Size([22167, 152])
            y_prediction_tf: torch.Size([22167])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:main.py:Testing data year: 1999
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 12245
            device: cpu
            
2024-08-24 04:39:21,190	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 04:39:21,241	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 04:39:21,294	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-24 04:39:21,307	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-24 04:39:22,943	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
[36m(train_fnn pid=3579474)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3579474)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3579900)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3579900)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3578917)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3578917)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3582946)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3582946)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3579848)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3579848)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3596018)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3596018)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3610029)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3610029)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3610504)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3610504)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3620200)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3620200)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3609278)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3609278)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3630640)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3630640)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3630150)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3630150)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3650275)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3650275)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3676907)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3676907)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3678289)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3678289)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3679667)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3679667)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3698178)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3698178)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3679781)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.[32m [repeated 2x across cluster] (Ray deduplicates logs by default. Set RAY_DEDUP_LOGS=0 to disable log deduplication, or see https://docs.ray.io/en/master/ray-observability/user-guides/configure-logging.html#log-deduplication for more options.)[0m
[36m(train_fnn pid=3679781)[0m   return F.l1_loss(input, target, reduction=self.reduction)[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=3694974)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3694974)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3741747)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3741747)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3764123)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=3764123)[0m   return F.l1_loss(input, target, reduction=self.reduction)[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=3781553)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3781553)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3781968)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3781968)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3763731)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3763731)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3783269)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3783269)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3795439)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3795439)[0m   return F.l1_loss(input, target, reduction=self.reduction)
2024-08-24 05:31:01,934	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_04-39-22' in 0.3935s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 75, 'num_layers': 5, 'num_embeddings': 12245, 'embedding_dim': 5, 'dropout_rate': 0.49, 'lr': 0.005561631189379234, 'weight_decay': 0.00016957783830711556, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.1852471539661555
INFO:model_data_nn.py:Best trial testing loss: 0.26280867159776544
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_04-39-18_812156_2457758/artifacts/2024-08-24_04-39-22/train_fnn_2024-08-24_04-39-22/driver_artifacts/train_fnn_82267_00027_27_batch_size=32,dropout_rate=0.4900,embedding_dim=5,hidden_dim=75,lr=0.0056,num_layers=5,weight_decay=0.000_2024-08-24_04-39-23
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 75, 'num_layers': 5, 'num_embeddings': 12852, 'embedding_dim': 5, 'dropout_rate': 0.49, 'lr': 0.005561631189379234, 'weight_decay': 0.00016957783830711556, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.19095498649268322, 'avg_test_loss': 0.27960478029553854}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.19071733358794127, 'avg_test_loss': 0.27866912854655307}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.1907382603777253, 'avg_test_loss': 0.27661521697328206}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.19071437536727462, 'avg_test_loss': 0.2797328298548599}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.19072525627863524, 'avg_test_loss': 0.2762105658564389}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.19074097096712453, 'avg_test_loss': 0.27815461897359783}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.19071005721385348, 'avg_test_loss': 0.2763105222221577}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.1907418897286458, 'avg_test_loss': 0.2812891754860658}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.19073819041231957, 'avg_test_loss': 0.27829457529179463}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.1907192709104227, 'avg_test_loss': 0.2770225989590648}
INFO:model_data_nn.py:Early stopping at epoch 10
INFO:main.py:Making prediction for data in year: 2000
INFO:main.py:Prediction data shape: (22167,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2000: 0.4534458326771635
INFO:main.py:Prediction Stats:                retq          pred
count  22167.000000  22167.000000
mean      -0.000670      0.005336
std        0.453416      0.000000
min       -0.980000      0.005336
25%       -0.222436      0.005336
50%       -0.022528      0.005336
75%        0.141851      0.005336
max       10.941179      0.005336
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:transform_data_nn.py:Train_data: (330842, 161)

INFO:transform_data_nn.py:Test data years: [2000]
INFO:transform_data_nn.py:Test_data: (22167, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:transform_data_nn.py:Retrain_data: (353009, 161)

INFO:transform_data_nn.py:Prediction data years: [2001]
INFO:transform_data_nn.py:Prediction_data: (21485, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([330842, 152])
            y_train_tf: torch.Size([330842])

            x_test_tf: torch.Size([22167, 152])
            y_test_tf: torch.Size([22167])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([353009, 152])
            y_retrain_tf: torch.Size([353009])

            x_prediction_tf: torch.Size([21485, 152])
            y_prediction_tf: torch.Size([21485])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:main.py:Testing data year: 2000
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 12852
            device: cpu
            
2024-08-24 06:22:02,527	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 06:22:02,579	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 06:22:02,637	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-24 06:22:02,654	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-24 06:22:04,610	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 06:38:42,767	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_06-22-04' in 0.3818s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 2, 'num_embeddings': 12852, 'embedding_dim': 6, 'dropout_rate': 0.32, 'lr': 8.193371887828038e-05, 'weight_decay': 9.290433949640854e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}
INFO:model_data_nn.py:Best trial training loss: 0.18542148187272137
INFO:model_data_nn.py:Best trial testing loss: 0.2673817452514309
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_06-22-00_141450_2457758/artifacts/2024-08-24_06-22-04/train_fnn_2024-08-24_06-22-04/driver_artifacts/train_fnn_daca3_00010_10_batch_size=128,dropout_rate=0.3200,embedding_dim=6,hidden_dim=45,lr=0.0001,num_layers=2,weight_decay=0.00_2024-08-24_06-22-04
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 2, 'num_embeddings': 13377, 'embedding_dim': 6, 'dropout_rate': 0.32, 'lr': 8.193371887828038e-05, 'weight_decay': 9.290433949640854e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.19460512856058682, 'avg_test_loss': 0.2814012164516108}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.19236581175060086, 'avg_test_loss': 0.2809103906509422}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.19103365033421776, 'avg_test_loss': 0.28479751093047007}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.19017480892096475, 'avg_test_loss': 0.2859924329178674}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.18936779952952945, 'avg_test_loss': 0.2844959485034148}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.18890113304891057, 'avg_test_loss': 0.28690425120294094}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.18832626571020095, 'avg_test_loss': 0.28658612143425716}
INFO:model_data_nn.py:Early stopping at epoch 7
INFO:main.py:Making prediction for data in year: 2001
INFO:main.py:Prediction data shape: (21485,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2001: 0.4836708047688072
INFO:main.py:Prediction Stats:                retq          pred
count  21485.000000  21485.000000
mean       0.078995     -0.011409
std        0.448298      0.176265
min       -0.977966     -1.500937
25%       -0.138629     -0.042567
50%        0.023648      0.034893
75%        0.215909      0.073371
max        7.399999      0.270630
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:transform_data_nn.py:Train_data: (353009, 161)

INFO:transform_data_nn.py:Test data years: [2001]
INFO:transform_data_nn.py:Test_data: (21485, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:transform_data_nn.py:Retrain_data: (374494, 161)

INFO:transform_data_nn.py:Prediction data years: [2002]
INFO:transform_data_nn.py:Prediction_data: (20629, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([353009, 152])
            y_train_tf: torch.Size([353009])

            x_test_tf: torch.Size([21485, 152])
            y_test_tf: torch.Size([21485])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([374494, 152])
            y_retrain_tf: torch.Size([374494])

            x_prediction_tf: torch.Size([20629, 152])
            y_prediction_tf: torch.Size([20629])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:main.py:Testing data year: 2001
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 13377
            device: cpu
            
2024-08-24 07:26:35,631	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 07:26:35,683	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 07:26:35,736	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-24 07:26:35,747	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-24 07:26:37,426	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 08:23:19,159	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_07-26-37' in 0.3393s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 175, 'num_layers': 5, 'num_embeddings': 13377, 'embedding_dim': 6, 'dropout_rate': 0.53, 'lr': 0.005812796563034177, 'weight_decay': 1.3256053033978208e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.19483697031704061
INFO:model_data_nn.py:Best trial testing loss: 0.2767378029280475
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_07-26-33_164789_2457758/artifacts/2024-08-24_07-26-37/train_fnn_2024-08-24_07-26-37/driver_artifacts/train_fnn_df2ae_00061_61_batch_size=32,dropout_rate=0.5300,embedding_dim=6,hidden_dim=175,lr=0.0058,num_layers=5,weight_decay=0.00_2024-08-24_07-26-38
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 175, 'num_layers': 5, 'num_embeddings': 14051, 'embedding_dim': 6, 'dropout_rate': 0.53, 'lr': 0.005812796563034177, 'weight_decay': 1.3256053033978208e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.20080365727325625, 'avg_test_loss': 0.22507404857134633}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.1991842214595587, 'avg_test_loss': 0.2237040987888048}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.1992728881903376, 'avg_test_loss': 0.22842722296021706}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.19923569154362966, 'avg_test_loss': 0.22369183269582055}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.19925917645238583, 'avg_test_loss': 0.22794206211733264}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.199599412573752, 'avg_test_loss': 0.2227620513748753}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.19949551047274974, 'avg_test_loss': 0.22701251483702845}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.1996382234273935, 'avg_test_loss': 0.22320341507131738}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.19969246899344598, 'avg_test_loss': 0.22608691493208094}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.1998674800016853, 'avg_test_loss': 0.2253499074153198}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.199819352220565, 'avg_test_loss': 0.22431067532116128}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main.py:Making prediction for data in year: 2002
INFO:main.py:Prediction data shape: (20629,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2002: 0.34564242308831333
INFO:main.py:Prediction Stats:                retq          pred
count  20629.000000  20629.000000
mean      -0.024597      0.011397
std        0.347899      0.020235
min       -0.987768     -0.169516
25%       -0.201179      0.006026
50%       -0.018143      0.017867
75%        0.112728      0.021936
max        8.604649      0.059554
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:transform_data_nn.py:Train_data: (374494, 161)

INFO:transform_data_nn.py:Test data years: [2002]
INFO:transform_data_nn.py:Test_data: (20629, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:transform_data_nn.py:Retrain_data: (395123, 161)

INFO:transform_data_nn.py:Prediction data years: [2003]
INFO:transform_data_nn.py:Prediction_data: (19044, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([374494, 152])
            y_train_tf: torch.Size([374494])

            x_test_tf: torch.Size([20629, 152])
            y_test_tf: torch.Size([20629])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([395123, 152])
            y_retrain_tf: torch.Size([395123])

            x_prediction_tf: torch.Size([19044, 152])
            y_prediction_tf: torch.Size([19044])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:main.py:Testing data year: 2002
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 14051
            device: cpu
            
2024-08-24 09:23:24,472	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 09:23:24,521	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 09:23:24,571	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-24 09:23:24,585	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-24 09:23:26,818	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 09:51:36,647	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_09-23-26' in 0.3584s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 175, 'num_layers': 3, 'num_embeddings': 14051, 'embedding_dim': 9, 'dropout_rate': 0.34, 'lr': 3.5651639629740656e-06, 'weight_decay': 7.315950900798312e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}
INFO:model_data_nn.py:Best trial training loss: 0.19785064274429257
INFO:model_data_nn.py:Best trial testing loss: 0.2211035512111805
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_09-23-22_119130_2457758/artifacts/2024-08-24_09-23-26/train_fnn_2024-08-24_09-23-26/driver_artifacts/train_fnn_31174_00058_58_batch_size=128,dropout_rate=0.3400,embedding_dim=9,hidden_dim=175,lr=0.0000,num_layers=3,weight_decay=0.0_2024-08-24_09-23-27
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 175, 'num_layers': 3, 'num_embeddings': 14292, 'embedding_dim': 9, 'dropout_rate': 0.34, 'lr': 3.5651639629740656e-06, 'weight_decay': 7.315950900798312e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.2131814429812901, 'avg_test_loss': 0.2385073131162848}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.2074496689809659, 'avg_test_loss': 0.23781021304378575}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.20474897207220266, 'avg_test_loss': 0.23801244505299818}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.203181558347181, 'avg_test_loss': 0.23850689528372465}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.20230716015909372, 'avg_test_loss': 0.2379934343715642}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.20154137290864507, 'avg_test_loss': 0.23797435968514258}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.2010503532057139, 'avg_test_loss': 0.23775345727101269}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.20071696688506174, 'avg_test_loss': 0.2374135486831601}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.20046834363249008, 'avg_test_loss': 0.2376705015565725}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.20023583247533341, 'avg_test_loss': 0.23673091028760743}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.1999860658797442, 'avg_test_loss': 0.23689963503571965}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.19985395465203099, 'avg_test_loss': 0.2366696475636239}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.1996600665610793, 'avg_test_loss': 0.23638155541363978}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.19952501993498398, 'avg_test_loss': 0.23732871722254978}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.1993646335317883, 'avg_test_loss': 0.2359274108737907}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.19924638014738233, 'avg_test_loss': 0.23553182184696198}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.19909366195126935, 'avg_test_loss': 0.23593298045780836}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.19900255268819905, 'avg_test_loss': 0.23577743618680327}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.19881687420996766, 'avg_test_loss': 0.2355113319002542}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.19870174449234138, 'avg_test_loss': 0.23508827868323998}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.19857576507797353, 'avg_test_loss': 0.23490558344645787}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.19846324672848856, 'avg_test_loss': 0.2348433542971643}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.19827418639164657, 'avg_test_loss': 0.23404003754758196}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.19818509623108943, 'avg_test_loss': 0.23389376774930315}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.1981186936292568, 'avg_test_loss': 0.23382202945899644}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.19793492482223066, 'avg_test_loss': 0.23393386722411086}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.1978687814165846, 'avg_test_loss': 0.233232338706519}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.19776296779774105, 'avg_test_loss': 0.23348839781028313}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.1975788693544313, 'avg_test_loss': 0.23290421068668365}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.19762222232249985, 'avg_test_loss': 0.23276877458263565}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.19746819765766332, 'avg_test_loss': 0.23269753743138089}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.19741583432053408, 'avg_test_loss': 0.2326570362752716}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.19735428971936775, 'avg_test_loss': 0.23291278400477147}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.1971379564091206, 'avg_test_loss': 0.23202705508310523}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.19711214150902673, 'avg_test_loss': 0.23246706232128528}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.19697031505256216, 'avg_test_loss': 0.2319472720659019}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.19688958761101796, 'avg_test_loss': 0.23176355754969105}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.1968016215755193, 'avg_test_loss': 0.23174898531412919}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.19669929941076778, 'avg_test_loss': 0.23155740918529114}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.19660258346991114, 'avg_test_loss': 0.2319298213560309}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.19650931995330656, 'avg_test_loss': 0.2317398267004314}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.19641083362074696, 'avg_test_loss': 0.23149887952428536}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.19643403286004485, 'avg_test_loss': 0.23158991446831081}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.19626373123095087, 'avg_test_loss': 0.23106067412651626}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.19620182561221558, 'avg_test_loss': 0.2307792426455741}
INFO:model_data_nn.py:Epoch 46/50, metrics: {'avg_train_loss': 0.1961274728401095, 'avg_test_loss': 0.23147846838371866}
INFO:model_data_nn.py:Epoch 47/50, metrics: {'avg_train_loss': 0.19606136547537956, 'avg_test_loss': 0.23188676110050022}
INFO:model_data_nn.py:Epoch 48/50, metrics: {'avg_train_loss': 0.19590799626366162, 'avg_test_loss': 0.2315312255948982}
INFO:model_data_nn.py:Epoch 49/50, metrics: {'avg_train_loss': 0.19590935540794166, 'avg_test_loss': 0.23106942445839812}
INFO:model_data_nn.py:Epoch 50/50, metrics: {'avg_train_loss': 0.19584903893092973, 'avg_test_loss': 0.2320192625258593}
INFO:model_data_nn.py:Early stopping at epoch 50
INFO:main.py:Making prediction for data in year: 2003
INFO:main.py:Prediction data shape: (19044,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2003: 0.4137582383431326
INFO:main.py:Prediction Stats:                retq          pred
count  19044.000000  19044.000000
mean       0.157039      0.018191
std        0.390767      0.042483
min       -0.964285     -0.421009
25%       -0.023484      0.000077
50%        0.087272      0.018985
75%        0.245431      0.041492
max       11.166664      0.207225
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:transform_data_nn.py:Train_data: (395123, 161)

INFO:transform_data_nn.py:Test data years: [2003]
INFO:transform_data_nn.py:Test_data: (19044, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:transform_data_nn.py:Retrain_data: (414167, 161)

INFO:transform_data_nn.py:Prediction data years: [2004]
INFO:transform_data_nn.py:Prediction_data: (17992, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([395123, 152])
            y_train_tf: torch.Size([395123])

            x_test_tf: torch.Size([19044, 152])
            y_test_tf: torch.Size([19044])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([414167, 152])
            y_retrain_tf: torch.Size([414167])

            x_prediction_tf: torch.Size([17992, 152])
            y_prediction_tf: torch.Size([17992])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:main.py:Testing data year: 2003
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 14292
            device: cpu
            
2024-08-24 11:00:03,067	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 11:00:03,118	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 11:00:03,170	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-24 11:00:03,183	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-24 11:00:05,430	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 11:26:25,382	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_11-00-05' in 0.3489s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 185, 'num_layers': 1, 'num_embeddings': 14292, 'embedding_dim': 5, 'dropout_rate': 0.15, 'lr': 0.00011712099358174698, 'weight_decay': 0.00010855986757693694, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}
INFO:model_data_nn.py:Best trial training loss: 0.1862318822492351
INFO:model_data_nn.py:Best trial testing loss: 0.21645318388938903
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_11-00-00_693759_2457758/artifacts/2024-08-24_11-00-05/train_fnn_2024-08-24_11-00-05/driver_artifacts/train_fnn_b1555_00097_97_batch_size=256,dropout_rate=0.1500,embedding_dim=5,hidden_dim=185,lr=0.0001,num_layers=1,weight_decay=0.0_2024-08-24_11-00-06
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 185, 'num_layers': 1, 'num_embeddings': 14438, 'embedding_dim': 5, 'dropout_rate': 0.15, 'lr': 0.00011712099358174698, 'weight_decay': 0.00010855986757693694, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.19977325128233572, 'avg_test_loss': 0.16232975236546826}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.19550480960362032, 'avg_test_loss': 0.16646859049797058}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.19355189988254837, 'avg_test_loss': 0.1674971715875075}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.19191551999169953, 'avg_test_loss': 0.17215570880913397}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.19070071771731698, 'avg_test_loss': 0.17334587252895597}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.1896042523648758, 'avg_test_loss': 0.1717085635788004}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 2004
INFO:main.py:Prediction data shape: (17992,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2004: 0.28645527508892754
INFO:main.py:Prediction Stats:                retq          pred
count  17992.000000  17992.000000
mean       0.052419      0.058962
std        0.280720      0.070715
min       -0.938679     -0.759137
25%       -0.068413      0.018749
50%        0.026063      0.061802
75%        0.139854      0.103327
max       11.611828      0.327591
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:transform_data_nn.py:Train_data: (414167, 161)

INFO:transform_data_nn.py:Test data years: [2004]
INFO:transform_data_nn.py:Test_data: (17992, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]
INFO:transform_data_nn.py:Retrain_data: (432159, 161)

INFO:transform_data_nn.py:Prediction data years: [2005]
INFO:transform_data_nn.py:Prediction_data: (17457, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([414167, 152])
            y_train_tf: torch.Size([414167])

            x_test_tf: torch.Size([17992, 152])
            y_test_tf: torch.Size([17992])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([432159, 152])
            y_retrain_tf: torch.Size([432159])

            x_prediction_tf: torch.Size([17457, 152])
            y_prediction_tf: torch.Size([17457])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:main.py:Testing data year: 2004
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 14438
            device: cpu
            
2024-08-24 12:18:59,730	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 12:18:59,775	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 12:18:59,829	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip' (5.16MiB) to Ray cluster...
2024-08-24 12:18:59,842	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip'.
2024-08-24 12:19:01,549	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 12:47:15,728	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 30.29 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-24 12:47:36,424	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 50.98 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-24 12:47:46,489	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 61.05 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-24 12:47:56,529	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 71.09 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-24 13:24:25,899	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_12-19-01' in 0.3574s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 14438, 'embedding_dim': 6, 'dropout_rate': 0.52, 'lr': 1.9599606392627504e-05, 'weight_decay': 4.0893546036076844e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 64}
INFO:model_data_nn.py:Best trial training loss: 0.19877785114389246
INFO:model_data_nn.py:Best trial testing loss: 0.15982434272449067
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_12-18-57_471963_2457758/artifacts/2024-08-24_12-19-01/train_fnn_2024-08-24_12-19-01/driver_artifacts/train_fnn_b847c_00067_67_batch_size=64,dropout_rate=0.5200,embedding_dim=6,hidden_dim=85,lr=0.0000,num_layers=4,weight_decay=0.000_2024-08-24_12-19-02
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 14571, 'embedding_dim': 6, 'dropout_rate': 0.52, 'lr': 1.9599606392627504e-05, 'weight_decay': 4.0893546036076844e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 64}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.20438588009838243, 'avg_test_loss': 0.14514516837103464}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.20160862481689426, 'avg_test_loss': 0.14571687006033385}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.20120371562115388, 'avg_test_loss': 0.1463259484468799}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.2007473840232568, 'avg_test_loss': 0.1465847420441362}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.20033456892397483, 'avg_test_loss': 0.14674605303631597}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.19998990295463687, 'avg_test_loss': 0.1469753337921677}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 2005
INFO:main.py:Prediction data shape: (17457,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2005: 0.22395771087447705
INFO:main.py:Prediction Stats:                retq          pred
count  17457.000000  17457.000000
mean       0.011168      0.030042
std        0.223895      0.014755
min       -0.888060     -0.096033
25%       -0.092593      0.027047
50%        0.000000      0.036152
75%        0.096127      0.039146
max        3.573606      0.042156
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]
INFO:transform_data_nn.py:Train_data: (432159, 161)

INFO:transform_data_nn.py:Test data years: [2005]
INFO:transform_data_nn.py:Test_data: (17457, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]
INFO:transform_data_nn.py:Retrain_data: (449616, 161)

INFO:transform_data_nn.py:Prediction data years: [2006]
INFO:transform_data_nn.py:Prediction_data: (17129, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([432159, 152])
            y_train_tf: torch.Size([432159])

            x_test_tf: torch.Size([17457, 152])
            y_test_tf: torch.Size([17457])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([449616, 152])
            y_retrain_tf: torch.Size([449616])

            x_prediction_tf: torch.Size([17129, 152])
            y_prediction_tf: torch.Size([17129])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]
INFO:main.py:Testing data year: 2005
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 14571
            device: cpu
            
2024-08-24 14:21:52,261	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 14:21:52,310	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 14:21:52,366	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip' (5.16MiB) to Ray cluster...
2024-08-24 14:21:52,381	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip'.
2024-08-24 14:21:54,725	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
[36m(train_fnn pid=2312283)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2312283)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2312089)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2312089)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2311761)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2311761)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2312481)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2312481)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2312238)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2312238)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2333697)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=2333697)[0m   return F.l1_loss(input, target, reduction=self.reduction)[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=2311829)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2311829)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2363157)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2363157)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2336951)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2336951)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2333409)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2333409)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2334562)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2334562)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2381059)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2381059)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2353296)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2353296)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2380748)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2380748)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2401115)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2401115)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2361726)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2361726)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2419562)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2419562)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2420294)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2420294)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2401045)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2401045)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2420360)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2420360)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2418642)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2418642)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2447504)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2447504)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2419858)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=2419858)[0m   return F.l1_loss(input, target, reduction=self.reduction)[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=2436206)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2436206)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2466173)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2466173)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2483902)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2483902)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2466662)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2466662)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2420364)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2420364)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2448179)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2448179)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2456505)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2456505)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2484147)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2484147)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2510956)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2510956)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2510123)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2510123)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2529067)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=2529067)[0m   return F.l1_loss(input, target, reduction=self.reduction)[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=2528824)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2528824)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2568318)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2568318)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2573096)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2573096)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2545975)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2545975)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2546877)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=2546877)[0m   return F.l1_loss(input, target, reduction=self.reduction)[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=2546520)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2546520)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2591784)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2591784)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2593136)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2593136)[0m   return F.l1_loss(input, target, reduction=self.reduction)
2024-08-24 15:03:40,884	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_14-21-54' in 0.3579s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 4, 'num_embeddings': 14571, 'embedding_dim': 4, 'dropout_rate': 0.5, 'lr': 0.0013859440267437048, 'weight_decay': 0.00012074802274943952, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 8}
INFO:model_data_nn.py:Best trial training loss: 0.20164217265376355
INFO:model_data_nn.py:Best trial testing loss: 0.14345997072473865
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_14-21-48_880718_2457758/artifacts/2024-08-24_14-21-54/train_fnn_2024-08-24_14-21-54/driver_artifacts/train_fnn_e3090_00070_70_batch_size=8,dropout_rate=0.5000,embedding_dim=4,hidden_dim=55,lr=0.0014,num_layers=4,weight_decay=0.0001_2024-08-24_14-21-55
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 4, 'num_embeddings': 14834, 'embedding_dim': 4, 'dropout_rate': 0.5, 'lr': 0.0013859440267437048, 'weight_decay': 0.00012074802274943952, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 8}

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
  return F.l1_loss(input, target, reduction=self.reduction)
INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.19929562076282084, 'avg_test_loss': 0.14501460497750163}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.19898328093791917, 'avg_test_loss': 0.14564165440983687}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.19897409237702898, 'avg_test_loss': 0.1452582854782792}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.19909815472319325, 'avg_test_loss': 0.14532173671572704}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.1992472897607099, 'avg_test_loss': 0.14559428305578193}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.1992609957273836, 'avg_test_loss': 0.14534404081484628}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 2006
INFO:main.py:Prediction data shape: (17129,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2006: 0.22814727494767173
INFO:main.py:Prediction Stats:                retq          pred
count  17129.000000  17129.000000
mean       0.041924      0.015623
std        0.226924      0.005672
min       -0.891239     -0.034159
25%       -0.066391      0.014404
50%        0.021390      0.018431
75%        0.123542      0.018805
max        3.713501      0.018805
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]
INFO:transform_data_nn.py:Train_data: (449616, 161)

INFO:transform_data_nn.py:Test data years: [2006]
INFO:transform_data_nn.py:Test_data: (17129, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]
INFO:transform_data_nn.py:Retrain_data: (466745, 161)

INFO:transform_data_nn.py:Prediction data years: [2007]
INFO:transform_data_nn.py:Prediction_data: (16760, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([449616, 152])
            y_train_tf: torch.Size([449616])

            x_test_tf: torch.Size([17129, 152])
            y_test_tf: torch.Size([17129])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([466745, 152])
            y_retrain_tf: torch.Size([466745])

            x_prediction_tf: torch.Size([16760, 152])
            y_prediction_tf: torch.Size([16760])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]
INFO:main.py:Testing data year: 2006
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 14834
            device: cpu
            
2024-08-24 16:21:22,444	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 16:21:22,495	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 16:21:22,547	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip' (5.16MiB) to Ray cluster...
2024-08-24 16:21:22,559	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip'.
2024-08-24 16:21:24,969	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
[36m(train_fnn pid=3786232)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3786232)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3821063)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3821063)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3816988)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3816988)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3786770)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3786770)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3813981)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3813981)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3842896)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3842896)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3842091)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3842091)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3860949)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3860949)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3860406)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3860406)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3860397)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3860397)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3847670)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3847670)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3904841)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3904841)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3905356)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3905356)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3941897)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3941897)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3942390)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3942390)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3940996)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3940996)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3968711)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3968711)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3948286)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3948286)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3941117)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3941117)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3941655)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3941655)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3987128)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3987128)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4005482)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4005482)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4050892)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4050892)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4033069)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4033069)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4052609)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4052609)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4050890)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4050890)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4115286)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4115286)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4097330)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4097330)[0m   return F.l1_loss(input, target, reduction=self.reduction)
2024-08-24 17:25:51,732	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_16-21-24' in 0.3660s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 105, 'num_layers': 4, 'num_embeddings': 14834, 'embedding_dim': 10, 'dropout_rate': 0.43, 'lr': 3.848737573901677e-05, 'weight_decay': 0.00013846534553156673, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 8}
INFO:model_data_nn.py:Best trial training loss: 0.1908800774437677
INFO:model_data_nn.py:Best trial testing loss: 0.14441498306977288
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_16-21-20_053976_2457758/artifacts/2024-08-24_16-21-24/train_fnn_2024-08-24_16-21-24/driver_artifacts/train_fnn_94d57_00081_81_batch_size=8,dropout_rate=0.4300,embedding_dim=10,hidden_dim=105,lr=0.0000,num_layers=4,weight_decay=0.00_2024-08-24_16-21-25
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 105, 'num_layers': 4, 'num_embeddings': 15108, 'embedding_dim': 10, 'dropout_rate': 0.43, 'lr': 3.848737573901677e-05, 'weight_decay': 0.00013846534553156673, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 8}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.19773404757300483, 'avg_test_loss': 0.15137174570208375}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.19543779178916348, 'avg_test_loss': 0.15061401354509066}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.1945491989514633, 'avg_test_loss': 0.15076547217219713}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.194034726290198, 'avg_test_loss': 0.15039303361622702}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.19341523879979525, 'avg_test_loss': 0.15026757371098443}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.19284185615290114, 'avg_test_loss': 0.15058840189066877}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.19230359534043576, 'avg_test_loss': 0.1502209479358216}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.19178276017194962, 'avg_test_loss': 0.15084223709200334}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.19138481231698803, 'avg_test_loss': 0.15052318033319953}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.19102241453269575, 'avg_test_loss': 0.15009515854243305}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.19062335355003607, 'avg_test_loss': 0.15101917198901388}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.19052634218002537, 'avg_test_loss': 0.1508021787040131}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.1901501456350512, 'avg_test_loss': 0.15026620787286105}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.18994580158426203, 'avg_test_loss': 0.15023518936321814}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.18974620912582837, 'avg_test_loss': 0.15114703353112097}
INFO:model_data_nn.py:Early stopping at epoch 15
INFO:main.py:Making prediction for data in year: 2007
INFO:main.py:Prediction data shape: (16760,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2007: 0.23070010365324256
INFO:main.py:Prediction Stats:                retq          pred
count  16760.000000  16760.000000
mean      -0.012095      0.020499
std        0.229951      0.019498
min       -0.942307     -0.300571
25%       -0.121358      0.017388
50%       -0.010779      0.023738
75%        0.083408      0.028834
max        8.158734      0.136301
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]
INFO:transform_data_nn.py:Train_data: (466745, 161)

INFO:transform_data_nn.py:Test data years: [2007]
INFO:transform_data_nn.py:Test_data: (16760, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:transform_data_nn.py:Retrain_data: (483505, 161)

INFO:transform_data_nn.py:Prediction data years: [2008]
INFO:transform_data_nn.py:Prediction_data: (16465, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([466745, 152])
            y_train_tf: torch.Size([466745])

            x_test_tf: torch.Size([16760, 152])
            y_test_tf: torch.Size([16760])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([483505, 152])
            y_retrain_tf: torch.Size([483505])

            x_prediction_tf: torch.Size([16465, 152])
            y_prediction_tf: torch.Size([16465])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]
INFO:main.py:Testing data year: 2007
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15108
            device: cpu
            
2024-08-24 19:18:18,380	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 19:18:18,430	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 19:18:18,482	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip' (5.16MiB) to Ray cluster...
2024-08-24 19:18:18,493	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip'.
2024-08-24 19:18:20,184	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 20:13:10,676	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_19-18-20' in 0.3200s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 15108, 'embedding_dim': 7, 'dropout_rate': 0.23, 'lr': 4.4874553741582045e-05, 'weight_decay': 0.00037791516233897607, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 64}
INFO:model_data_nn.py:Best trial training loss: 0.19557327665879023
INFO:model_data_nn.py:Best trial testing loss: 0.1494405182746758
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_19-18-16_071931_2457758/artifacts/2024-08-24_19-18-20/train_fnn_2024-08-24_19-18-20/driver_artifacts/train_fnn_4bfeb_00137_137_batch_size=64,dropout_rate=0.2300,embedding_dim=7,hidden_dim=5,lr=0.0000,num_layers=4,weight_decay=0.000_2024-08-24_19-18-21
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 15361, 'embedding_dim': 7, 'dropout_rate': 0.23, 'lr': 4.4874553741582045e-05, 'weight_decay': 0.00037791516233897607, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 64}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.1962443100402429, 'avg_test_loss': 0.2406267563906289}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.19572366068476496, 'avg_test_loss': 0.2423926211835802}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.19542060095224079, 'avg_test_loss': 0.2433531194521013}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.19503519314013051, 'avg_test_loss': 0.24462328273658604}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.19474855761877405, 'avg_test_loss': 0.24489224098565043}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.19441192730006668, 'avg_test_loss': 0.24625669286925664}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 2008
INFO:main.py:Prediction data shape: (16465,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2008: 0.3490800498273019
INFO:main.py:Prediction Stats:                retq          pred
count  16465.000000  16465.000000
mean      -0.119762      0.021246
std        0.319514      0.009806
min       -0.957296     -0.107594
25%       -0.293863      0.023468
50%       -0.110638      0.024768
75%        0.023365      0.024839
max       10.299695      0.024959
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:transform_data_nn.py:Train_data: (483505, 161)

INFO:transform_data_nn.py:Test data years: [2008]
INFO:transform_data_nn.py:Test_data: (16465, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:transform_data_nn.py:Retrain_data: (499970, 161)

INFO:transform_data_nn.py:Prediction data years: [2009]
INFO:transform_data_nn.py:Prediction_data: (16061, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([483505, 152])
            y_train_tf: torch.Size([483505])

            x_test_tf: torch.Size([16465, 152])
            y_test_tf: torch.Size([16465])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([499970, 152])
            y_retrain_tf: torch.Size([499970])

            x_prediction_tf: torch.Size([16061, 152])
            y_prediction_tf: torch.Size([16061])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:main.py:Testing data year: 2008
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15361
            device: cpu
            
2024-08-24 21:17:32,735	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 21:17:32,785	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 21:17:32,836	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip' (5.16MiB) to Ray cluster...
2024-08-24 21:17:32,849	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip'.
2024-08-24 21:17:35,259	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
[36m(train_fnn pid=3116108)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3116108)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3117407)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3117407)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3116176)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3116176)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3134869)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3134869)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3116970)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3116970)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3120450)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3120450)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3138967)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3138967)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3117341)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3117341)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3117408)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3117408)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3116389)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=3116389)[0m   return F.l1_loss(input, target, reduction=self.reduction)[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=3116517)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3116517)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3120761)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3120761)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3166182)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3166182)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3166671)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3166671)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3139576)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3139576)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3187198)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3187198)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3145491)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3145491)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3165939)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3165939)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3167170)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3167170)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3230517)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3230517)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3184574)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3184574)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3230143)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3230143)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3184807)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3184807)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3235848)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3235848)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3188593)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3188593)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3254391)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3254391)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3250720)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=3250720)[0m   return F.l1_loss(input, target, reduction=self.reduction)[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=3222320)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3222320)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3250046)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3250046)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3250967)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3250967)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3311227)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3311227)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3296031)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3296031)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3310097)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3310097)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3306104)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3306104)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3335206)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3335206)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3297445)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3297445)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3334355)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3334355)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3333931)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3333931)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3361639)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3361639)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3361638)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3361638)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3355224)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3355224)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3396826)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3396826)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3424342)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3424342)[0m   return F.l1_loss(input, target, reduction=self.reduction)
2024-08-24 22:25:07,067	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_21-17-35' in 0.3626s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 155, 'num_layers': 4, 'num_embeddings': 15361, 'embedding_dim': 5, 'dropout_rate': 0.5, 'lr': 0.003806525641211476, 'weight_decay': 0.000772808568616109, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 8}
INFO:model_data_nn.py:Best trial training loss: 0.19643947557529587
INFO:model_data_nn.py:Best trial testing loss: 0.2377373915090578
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_21-17-30_427396_2457758/artifacts/2024-08-24_21-17-35/train_fnn_2024-08-24_21-17-35/driver_artifacts/train_fnn_f4c0a_00105_105_batch_size=8,dropout_rate=0.5000,embedding_dim=5,hidden_dim=155,lr=0.0038,num_layers=4,weight_decay=0.00_2024-08-24_21-17-36
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 155, 'num_layers': 4, 'num_embeddings': 15661, 'embedding_dim': 5, 'dropout_rate': 0.5, 'lr': 0.003806525641211476, 'weight_decay': 0.000772808568616109, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 8}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.19830781861626354, 'avg_test_loss': 0.28115519684130896}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.19789697056473127, 'avg_test_loss': 0.28779076299244216}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.19789578851550355, 'avg_test_loss': 0.2805001062537688}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.19788479288300587, 'avg_test_loss': 0.2834146610261652}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.1978918254337368, 'avg_test_loss': 0.28289147410613663}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.19788883614858244, 'avg_test_loss': 0.2829277567319392}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.19788987197715568, 'avg_test_loss': 0.28114320294313744}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.1978782235792408, 'avg_test_loss': 0.2815071206666952}
INFO:model_data_nn.py:Early stopping at epoch 8
INFO:main.py:Making prediction for data in year: 2009
INFO:main.py:Prediction data shape: (16061,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2009: 0.5287088607430375
INFO:main.py:Prediction Stats:                retq          pred
count  16061.000000  16061.000000
mean       0.139171      0.010299
std        0.512778      0.000000
min       -0.941129      0.010299
25%       -0.088888      0.010299
50%        0.057852      0.010299
75%        0.252000      0.010299
max       18.331762      0.010299
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:transform_data_nn.py:Train_data: (499970, 161)

INFO:transform_data_nn.py:Test data years: [2009]
INFO:transform_data_nn.py:Test_data: (16061, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:transform_data_nn.py:Retrain_data: (516031, 161)

INFO:transform_data_nn.py:Prediction data years: [2010]
INFO:transform_data_nn.py:Prediction_data: (15133, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([499970, 152])
            y_train_tf: torch.Size([499970])

            x_test_tf: torch.Size([16061, 152])
            y_test_tf: torch.Size([16061])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([516031, 152])
            y_retrain_tf: torch.Size([516031])

            x_prediction_tf: torch.Size([15133, 152])
            y_prediction_tf: torch.Size([15133])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:main.py:Testing data year: 2009
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15661
            device: cpu
            
2024-08-25 00:05:26,831	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-25 00:05:26,881	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-25 00:05:26,936	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip' (5.16MiB) to Ray cluster...
2024-08-25 00:05:26,949	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip'.
2024-08-25 00:05:29,048	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-25 00:47:35,144	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_00-05-29' in 0.3619s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 5, 'num_embeddings': 15661, 'embedding_dim': 5, 'dropout_rate': 0.43, 'lr': 0.0016173367106103607, 'weight_decay': 1.9832023101464444e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}
INFO:model_data_nn.py:Best trial training loss: 0.17963758292400525
INFO:model_data_nn.py:Best trial testing loss: 0.2576116432273199
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-25_00-05-24_498819_2457758/artifacts/2024-08-25_00-05-29/train_fnn_2024-08-25_00-05-29/driver_artifacts/train_fnn_6932b_00017_17_batch_size=128,dropout_rate=0.4300,embedding_dim=5,hidden_dim=135,lr=0.0016,num_layers=5,weight_decay=0.0_2024-08-25_00-05-29
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 5, 'num_embeddings': 15845, 'embedding_dim': 5, 'dropout_rate': 0.43, 'lr': 0.0016173367106103607, 'weight_decay': 1.9832023101464444e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.19799890256983801, 'avg_test_loss': 0.17217843685330464}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.19282634413603134, 'avg_test_loss': 0.17212920886378327}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.18992167998486967, 'avg_test_loss': 0.17318994351545303}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.18725734923605114, 'avg_test_loss': 0.174205900365565}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.18544110704580272, 'avg_test_loss': 0.1736174195754428}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.18400791539902783, 'avg_test_loss': 0.17418366545388678}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.18300759819128531, 'avg_test_loss': 0.1740711177347087}
INFO:model_data_nn.py:Early stopping at epoch 7
INFO:main.py:Making prediction for data in year: 2010
INFO:main.py:Prediction data shape: (15133,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2010: 0.2723482883214658
INFO:main.py:Prediction Stats:                retq          pred
count  15133.000000  15133.000000
mean       0.066892      0.051748
std        0.270575      0.061023
min       -0.913334     -0.311605
25%       -0.069767      0.016706
50%        0.041405      0.035266
75%        0.175515      0.082071
max        7.399156      0.445866
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:transform_data_nn.py:Train_data: (516031, 161)

INFO:transform_data_nn.py:Test data years: [2010]
INFO:transform_data_nn.py:Test_data: (15133, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:transform_data_nn.py:Retrain_data: (531164, 161)

INFO:transform_data_nn.py:Prediction data years: [2011]
INFO:transform_data_nn.py:Prediction_data: (14552, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([516031, 152])
            y_train_tf: torch.Size([516031])

            x_test_tf: torch.Size([15133, 152])
            y_test_tf: torch.Size([15133])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([531164, 152])
            y_retrain_tf: torch.Size([531164])

            x_prediction_tf: torch.Size([14552, 152])
            y_prediction_tf: torch.Size([14552])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:main.py:Testing data year: 2010
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15845
            device: cpu
            
2024-08-25 01:56:15,628	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-25 01:56:15,679	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-25 01:56:15,735	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip' (5.16MiB) to Ray cluster...
2024-08-25 01:56:15,747	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip'.
2024-08-25 01:56:17,887	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-25 02:51:56,889	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_01-56-17' in 0.3863s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 5, 'num_embeddings': 15845, 'embedding_dim': 2, 'dropout_rate': 0.39, 'lr': 0.00363648141868106, 'weight_decay': 1.7801832627670042e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}
INFO:model_data_nn.py:Best trial training loss: 0.19280566466605803
INFO:model_data_nn.py:Best trial testing loss: 0.17017760403266474
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-25_01-56-13_256548_2457758/artifacts/2024-08-25_01-56-17/train_fnn_2024-08-25_01-56-17/driver_artifacts/train_fnn_e4371_00000_0_batch_size=128,dropout_rate=0.3900,embedding_dim=2,hidden_dim=25,lr=0.0036,num_layers=5,weight_decay=0.000_2024-08-25_01-56-18
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 5, 'num_embeddings': 15911, 'embedding_dim': 2, 'dropout_rate': 0.39, 'lr': 0.00363648141868106, 'weight_decay': 1.7801832627670042e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.19744807022771194, 'avg_test_loss': 0.18013516310275646}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.19468665576233982, 'avg_test_loss': 0.1771701720069375}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.19335945529531473, 'avg_test_loss': 0.17927409976459385}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1926821872150217, 'avg_test_loss': 0.18020360119510115}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.19216260312012404, 'avg_test_loss': 0.17762682332020058}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.19174625086882052, 'avg_test_loss': 0.1776413672456616}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.19130384647636478, 'avg_test_loss': 0.177253217942882}
INFO:model_data_nn.py:Early stopping at epoch 7
INFO:main.py:Making prediction for data in year: 2011
INFO:main.py:Prediction data shape: (14552,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2011: 0.2536557945872313
INFO:main.py:Prediction Stats:                retq          pred
count  14552.000000  14552.000000
mean      -0.010813      0.018259
std        0.256328      0.031675
min       -0.956637     -0.213190
25%       -0.153673      0.005663
50%       -0.006813      0.013341
75%        0.109958      0.047115
max        3.447154      0.104215
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:transform_data_nn.py:Train_data: (531164, 161)

INFO:transform_data_nn.py:Test data years: [2011]
INFO:transform_data_nn.py:Test_data: (14552, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:transform_data_nn.py:Retrain_data: (545716, 161)

INFO:transform_data_nn.py:Prediction data years: [2012]
INFO:transform_data_nn.py:Prediction_data: (14104, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([531164, 152])
            y_train_tf: torch.Size([531164])

            x_test_tf: torch.Size([14552, 152])
            y_test_tf: torch.Size([14552])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([545716, 152])
            y_retrain_tf: torch.Size([545716])

            x_prediction_tf: torch.Size([14104, 152])
            y_prediction_tf: torch.Size([14104])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:main.py:Testing data year: 2011
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15911
            device: cpu
            
2024-08-25 03:58:39,005	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-25 03:58:39,053	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-25 03:58:39,108	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip' (5.16MiB) to Ray cluster...
2024-08-25 03:58:39,122	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip'.
2024-08-25 03:58:41,282	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-25 07:37:45,254	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_03-58-41' in 0.3798s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 2, 'num_embeddings': 15911, 'embedding_dim': 6, 'dropout_rate': 0.16, 'lr': 1.998444233349325e-06, 'weight_decay': 1.982431895024505e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 8}
INFO:model_data_nn.py:Best trial training loss: 0.1984393645754045
INFO:model_data_nn.py:Best trial testing loss: 0.17854027116672228
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-25_03-58-36_667779_2457758/artifacts/2024-08-25_03-58-41/train_fnn_2024-08-25_03-58-41/driver_artifacts/train_fnn_fd383_00140_140_batch_size=8,dropout_rate=0.1600,embedding_dim=6,hidden_dim=5,lr=0.0000,num_layers=2,weight_decay=0.0000_2024-08-25_03-58-42
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 2, 'num_embeddings': 16081, 'embedding_dim': 6, 'dropout_rate': 0.16, 'lr': 1.998444233349325e-06, 'weight_decay': 1.982431895024505e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 8}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.1992196296078625, 'avg_test_loss': 0.1583387188938823}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.19897672560636787, 'avg_test_loss': 0.15830314728646405}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.1988744707619995, 'avg_test_loss': 0.15835354202049265}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1988236686653283, 'avg_test_loss': 0.15833474823732777}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.1987729698874105, 'avg_test_loss': 0.1583497296898323}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.19873213234428833, 'avg_test_loss': 0.15824260117651992}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.1986571829086118, 'avg_test_loss': 0.15820760580156923}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.19860270637690083, 'avg_test_loss': 0.15819389288965033}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.19857070273946775, 'avg_test_loss': 0.15823226807278729}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.19851909359827974, 'avg_test_loss': 0.15797864097808142}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.19844492597127372, 'avg_test_loss': 0.15809166020863244}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.1984038495560213, 'avg_test_loss': 0.15806886866916936}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.19833488474020122, 'avg_test_loss': 0.15792138278442083}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.1983102885844312, 'avg_test_loss': 0.15785557219480764}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.19827145021615775, 'avg_test_loss': 0.15789334681170336}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.1982012665589851, 'avg_test_loss': 0.1579041821597925}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.1981775109250198, 'avg_test_loss': 0.15784912262274606}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.19810414168680385, 'avg_test_loss': 0.1579087997458651}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.1980992216915814, 'avg_test_loss': 0.15799257649035867}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.19800989510143122, 'avg_test_loss': 0.1578253070362677}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.1980267489144611, 'avg_test_loss': 0.15776038749467833}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.19797391514577148, 'avg_test_loss': 0.15772575598951774}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.19795057305286134, 'avg_test_loss': 0.15780993865224968}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.1978925662820801, 'avg_test_loss': 0.15774504492990143}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.19787155463283984, 'avg_test_loss': 0.15776955900725423}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.19785484605995732, 'avg_test_loss': 0.15765608547300827}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.19780246487985198, 'avg_test_loss': 0.1577446932227721}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.1977342588156217, 'avg_test_loss': 0.1578027704604904}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.1977196440083358, 'avg_test_loss': 0.15786927520924512}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.19768479656542018, 'avg_test_loss': 0.1579003531952778}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.1976629604330732, 'avg_test_loss': 0.15789690522251992}
INFO:model_data_nn.py:Early stopping at epoch 31
INFO:main.py:Making prediction for data in year: 2012
INFO:main.py:Prediction data shape: (14104,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2012: 0.27579883963691393
INFO:main.py:Prediction Stats:                retq          pred
count  14104.000000  14104.000000
mean       0.048736      0.011274
std        0.272076      0.017504
min       -0.918750     -0.108968
25%       -0.066871      0.006953
50%        0.024092      0.015704
75%        0.136884      0.021538
max       10.269234      0.071252
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:transform_data_nn.py:Train_data: (545716, 161)

INFO:transform_data_nn.py:Test data years: [2012]
INFO:transform_data_nn.py:Test_data: (14104, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:transform_data_nn.py:Retrain_data: (559820, 161)

INFO:transform_data_nn.py:Prediction data years: [2013]
INFO:transform_data_nn.py:Prediction_data: (13650, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([545716, 152])
            y_train_tf: torch.Size([545716])

            x_test_tf: torch.Size([14104, 152])
            y_test_tf: torch.Size([14104])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([559820, 152])
            y_retrain_tf: torch.Size([559820])

            x_prediction_tf: torch.Size([13650, 152])
            y_prediction_tf: torch.Size([13650])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:main.py:Testing data year: 2012
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 16081
            device: cpu
            
2024-08-25 10:09:09,210	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-25 10:09:09,260	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-25 10:09:09,313	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip' (5.16MiB) to Ray cluster...
2024-08-25 10:09:09,324	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip'.
2024-08-25 10:09:11,500	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-25 12:02:36,224	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_10-09-11' in 0.3310s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 4, 'num_embeddings': 16081, 'embedding_dim': 6, 'dropout_rate': 0.36, 'lr': 0.003331731198346043, 'weight_decay': 2.7613777800427496e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}
INFO:model_data_nn.py:Best trial training loss: 0.19252907693274224
INFO:model_data_nn.py:Best trial testing loss: 0.15681755146733276
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-25_10-09-06_874891_2457758/artifacts/2024-08-25_10-09-11/train_fnn_2024-08-25_10-09-11/driver_artifacts/train_fnn_bf764_00064_64_batch_size=128,dropout_rate=0.3600,embedding_dim=6,hidden_dim=15,lr=0.0033,num_layers=4,weight_decay=0.00_2024-08-25_10-09-12
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 4, 'num_embeddings': 16225, 'embedding_dim': 6, 'dropout_rate': 0.36, 'lr': 0.003331731198346043, 'weight_decay': 2.7613777800427496e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.19565420190761326, 'avg_test_loss': 0.15091069822556505}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.1932574164675216, 'avg_test_loss': 0.1512551942718363}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.192155948130675, 'avg_test_loss': 0.14990257903515736}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.19162894411256595, 'avg_test_loss': 0.15610947654904606}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.1914010637178046, 'avg_test_loss': 0.15147228713069005}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.1911794407952985, 'avg_test_loss': 0.1564371514821721}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.19099210652829635, 'avg_test_loss': 0.15239593727844897}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.19092139106933023, 'avg_test_loss': 0.1518916865793344}
INFO:model_data_nn.py:Early stopping at epoch 8
INFO:main.py:Making prediction for data in year: 2013
INFO:main.py:Prediction data shape: (13650,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2013: 0.24524992360109207
INFO:main.py:Prediction Stats:                retq          pred
count  13650.000000  13650.000000
mean       0.095489      0.026963
std        0.233383      0.044410
min       -0.927594     -0.141024
25%       -0.012730      0.001624
50%        0.068853      0.018993
75%        0.174490      0.038291
max        3.696775      0.210910
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:transform_data_nn.py:Train_data: (559820, 161)

INFO:transform_data_nn.py:Test data years: [2013]
INFO:transform_data_nn.py:Test_data: (13650, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:transform_data_nn.py:Retrain_data: (573470, 161)

INFO:transform_data_nn.py:Prediction data years: [2014]
INFO:transform_data_nn.py:Prediction_data: (13465, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([559820, 152])
            y_train_tf: torch.Size([559820])

            x_test_tf: torch.Size([13650, 152])
            y_test_tf: torch.Size([13650])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([573470, 152])
            y_retrain_tf: torch.Size([573470])

            x_prediction_tf: torch.Size([13465, 152])
            y_prediction_tf: torch.Size([13465])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:main.py:Testing data year: 2013
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 16225
            device: cpu
            
2024-08-25 13:15:23,367	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-25 13:15:23,418	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-25 13:15:23,472	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip' (5.16MiB) to Ray cluster...
2024-08-25 13:15:23,485	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip'.
2024-08-25 13:15:25,610	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-25 15:23:09,561	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_13-15-25' in 0.3666s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 165, 'num_layers': 5, 'num_embeddings': 16225, 'embedding_dim': 9, 'dropout_rate': 0.55, 'lr': 1.7532489563117073e-05, 'weight_decay': 0.0001932112062570699, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.19157271480993351
INFO:model_data_nn.py:Best trial testing loss: 0.14637494317541636
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-25_13-15-21_022898_2457758/artifacts/2024-08-25_13-15-25/train_fnn_2024-08-25_13-15-25/driver_artifacts/train_fnn_c3c03_00008_8_batch_size=32,dropout_rate=0.5500,embedding_dim=9,hidden_dim=165,lr=0.0000,num_layers=5,weight_decay=0.000_2024-08-25_13-15-25
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 165, 'num_layers': 5, 'num_embeddings': 16362, 'embedding_dim': 9, 'dropout_rate': 0.55, 'lr': 1.7532489563117073e-05, 'weight_decay': 0.0001932112062570699, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.19920517797914467, 'avg_test_loss': 0.1395987284650712}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.19619734895490443, 'avg_test_loss': 0.14061725814771484}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.19548425070159803, 'avg_test_loss': 0.1409276289303484}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.19495125100615301, 'avg_test_loss': 0.14157341043697116}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.1945040843998348, 'avg_test_loss': 0.14200642073168607}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.19403473161510193, 'avg_test_loss': 0.1434378254884354}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 2014
INFO:main.py:Prediction data shape: (13465,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2014: 0.2351634367665737
INFO:main.py:Prediction Stats:                retq          pred
count  13465.000000  13465.000000
mean       0.014125      0.041799
std        0.233495      0.006070
min       -0.876499     -0.157330
25%       -0.083091      0.042714
50%        0.002797      0.043305
75%        0.098080      0.043393
max        6.562500      0.043432
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:transform_data_nn.py:Train_data: (573470, 161)

INFO:transform_data_nn.py:Test data years: [2014]
INFO:transform_data_nn.py:Test_data: (13465, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:transform_data_nn.py:Retrain_data: (586935, 161)

INFO:transform_data_nn.py:Prediction data years: [2015]
INFO:transform_data_nn.py:Prediction_data: (13715, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([573470, 152])
            y_train_tf: torch.Size([573470])

            x_test_tf: torch.Size([13465, 152])
            y_test_tf: torch.Size([13465])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([586935, 152])
            y_retrain_tf: torch.Size([586935])

            x_prediction_tf: torch.Size([13715, 152])
            y_prediction_tf: torch.Size([13715])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:main.py:Testing data year: 2014
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 16362
            device: cpu
            
2024-08-25 16:44:05,742	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-25 16:44:05,792	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-25 16:44:05,845	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip' (5.16MiB) to Ray cluster...
2024-08-25 16:44:05,857	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip'.
2024-08-25 16:44:08,019	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
[36m(train_fnn pid=397386)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=397386)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=393382)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=393382)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=393555)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=393555)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=394340)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=394340)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=394339)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=394339)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=487584)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=487584)[0m   return F.l1_loss(input, target, reduction=self.reduction)[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=443495)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=443495)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=523067)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=523067)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=543936)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=543936)[0m   return F.l1_loss(input, target, reduction=self.reduction)[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=487816)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=487816)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=523441)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=523441)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=567022)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=567022)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=549161)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=549161)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=585912)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=585912)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=629825)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=629825)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=647801)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=647801)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=690981)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=690981)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=709013)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=709013)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=708620)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=708620)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=711633)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=711633)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=743269)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=743269)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=771024)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=771024)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=815852)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=815852)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=815053)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=815053)[0m   return F.l1_loss(input, target, reduction=self.reduction)
2024-08-25 17:50:47,764	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_16-44-08' in 0.3293s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 4, 'num_embeddings': 16362, 'embedding_dim': 5, 'dropout_rate': 0.48, 'lr': 0.001721401524813852, 'weight_decay': 3.6408342855039936e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.19068874313171755
INFO:model_data_nn.py:Best trial testing loss: 0.1375791554443202
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-25_16-44-03_407970_2457758/artifacts/2024-08-25_16-44-08/train_fnn_2024-08-25_16-44-08/driver_artifacts/train_fnn_ebb03_00140_140_batch_size=32,dropout_rate=0.4800,embedding_dim=5,hidden_dim=55,lr=0.0017,num_layers=4,weight_decay=0.00_2024-08-25_16-44-09
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 4, 'num_embeddings': 16543, 'embedding_dim': 5, 'dropout_rate': 0.48, 'lr': 0.001721401524813852, 'weight_decay': 3.6408342855039936e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.19417388649091394, 'avg_test_loss': 0.15522619594748205}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.19140123091867606, 'avg_test_loss': 0.1560065003507065}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.1904540454665055, 'avg_test_loss': 0.16001406179128827}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1900679800446353, 'avg_test_loss': 0.16907633441589373}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.1898996717328074, 'avg_test_loss': 0.1545530067526655}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.1896623068980007, 'avg_test_loss': 0.16177423697807294}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.18952647973777983, 'avg_test_loss': 0.1592020299676415}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.1893851453075134, 'avg_test_loss': 0.16124622929311577}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.18935255722803024, 'avg_test_loss': 0.1556391507421896}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.18926910981702463, 'avg_test_loss': 0.16345420561400884}
INFO:model_data_nn.py:Early stopping at epoch 10
INFO:main.py:Making prediction for data in year: 2015
INFO:main.py:Prediction data shape: (13715,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2015: 0.28995740212371013
INFO:main.py:Prediction Stats:                retq          pred
count  13715.000000  13715.000000
mean      -0.012963      0.050162
std        0.281375      0.046553
min       -0.894256     -0.202958
25%       -0.117383      0.023422
50%       -0.004975      0.033040
75%        0.079168      0.073960
max       16.161400      0.283346
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:transform_data_nn.py:Train_data: (586935, 161)

INFO:transform_data_nn.py:Test data years: [2015]
INFO:transform_data_nn.py:Test_data: (13715, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:transform_data_nn.py:Retrain_data: (600650, 161)

INFO:transform_data_nn.py:Prediction data years: [2016]
INFO:transform_data_nn.py:Prediction_data: (13785, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([586935, 152])
            y_train_tf: torch.Size([586935])

            x_test_tf: torch.Size([13715, 152])
            y_test_tf: torch.Size([13715])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([600650, 152])
            y_retrain_tf: torch.Size([600650])

            x_prediction_tf: torch.Size([13785, 152])
            y_prediction_tf: torch.Size([13785])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:main.py:Testing data year: 2015
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 16543
            device: cpu
            
2024-08-25 19:13:15,289	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-25 19:13:15,339	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-25 19:13:15,395	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip' (5.16MiB) to Ray cluster...
2024-08-25 19:13:15,408	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip'.
2024-08-25 19:13:17,577	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-25 20:29:48,974	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_19-13-17' in 0.3599s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 3, 'num_embeddings': 16543, 'embedding_dim': 3, 'dropout_rate': 0.29, 'lr': 4.274998415797241e-06, 'weight_decay': 0.0001461393658484008, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}
INFO:model_data_nn.py:Best trial training loss: 0.19525926603072602
INFO:model_data_nn.py:Best trial testing loss: 0.15164806886955542
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-25_19-13-12_945691_2457758/artifacts/2024-08-25_19-13-17/train_fnn_2024-08-25_19-13-17/driver_artifacts/train_fnn_c20a5_00040_40_batch_size=256,dropout_rate=0.2900,embedding_dim=3,hidden_dim=15,lr=0.0000,num_layers=3,weight_decay=0.00_2024-08-25_19-13-18
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 3, 'num_embeddings': 16832, 'embedding_dim': 3, 'dropout_rate': 0.29, 'lr': 4.274998415797241e-06, 'weight_decay': 0.0001461393658484008, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.19532688692504285, 'avg_test_loss': 0.16728893198348857}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.19482830953796196, 'avg_test_loss': 0.1672356494322971}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.19461241720176006, 'avg_test_loss': 0.16714193009667927}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1944998836070172, 'avg_test_loss': 0.16708217340487022}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.19443099596438404, 'avg_test_loss': 0.1669372956233996}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.1943646043615268, 'avg_test_loss': 0.16684979462513216}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.19432282144202195, 'avg_test_loss': 0.16674194484949112}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.19427584845950638, 'avg_test_loss': 0.16664352419751663}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.1942364817258139, 'avg_test_loss': 0.16653286900233338}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.19419129861031245, 'avg_test_loss': 0.16641404134807763}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.19412668227819124, 'avg_test_loss': 0.16631463487391118}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.19410826893362954, 'avg_test_loss': 0.16622482198807928}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.19408581396985644, 'avg_test_loss': 0.16613766123299245}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.1940301717445572, 'avg_test_loss': 0.16605247377797408}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.19396691474641173, 'avg_test_loss': 0.16598036871464164}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.19396193540843246, 'avg_test_loss': 0.16589429477850595}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.19386138626630756, 'avg_test_loss': 0.1657856716601937}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.1938392826231341, 'avg_test_loss': 0.16570107914783336}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.19380839518370632, 'avg_test_loss': 0.1656556395744836}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.19376480489181638, 'avg_test_loss': 0.16557004399321698}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.19372371774093777, 'avg_test_loss': 0.16555976136415093}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.19368626736898456, 'avg_test_loss': 0.1654364070682614}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.19364748371150486, 'avg_test_loss': 0.16544270363670807}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.19363861983262465, 'avg_test_loss': 0.16540382567931106}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.19361304424429998, 'avg_test_loss': 0.16534942471318775}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.19356589646849587, 'avg_test_loss': 0.16527850180864334}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.19347778607385338, 'avg_test_loss': 0.16527026257029287}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.19346287774155513, 'avg_test_loss': 0.16520201911528906}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.19345540102358466, 'avg_test_loss': 0.16524135969855167}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.19342841005360886, 'avg_test_loss': 0.16517855171804074}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.19343032420494571, 'avg_test_loss': 0.16517860056073577}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.1933173207027833, 'avg_test_loss': 0.16510074295931393}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.1933456345477982, 'avg_test_loss': 0.1650968788674584}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.19327591331032537, 'avg_test_loss': 0.1651267018859033}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.19326180898650325, 'avg_test_loss': 0.1650803249191355}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.19321574490495147, 'avg_test_loss': 0.1650517353857005}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.19316457013797272, 'avg_test_loss': 0.16502253890589433}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.19314187766391805, 'avg_test_loss': 0.16503212380188484}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.1931427338455136, 'avg_test_loss': 0.16499280805389085}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.19307532381879297, 'avg_test_loss': 0.16490514079729715}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.19300015157014005, 'avg_test_loss': 0.1649126926506007}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.19304276935483083, 'avg_test_loss': 0.16494720001463536}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.19295563475123248, 'avg_test_loss': 0.16493259922221856}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.19299459039453554, 'avg_test_loss': 0.164898496673063}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.19295174074625218, 'avg_test_loss': 0.16490900364738922}
INFO:model_data_nn.py:Epoch 46/50, metrics: {'avg_train_loss': 0.1929539866294499, 'avg_test_loss': 0.16492194696157067}
INFO:model_data_nn.py:Epoch 47/50, metrics: {'avg_train_loss': 0.192883790511152, 'avg_test_loss': 0.16489115771320131}
INFO:model_data_nn.py:Epoch 48/50, metrics: {'avg_train_loss': 0.19286450099609698, 'avg_test_loss': 0.16493542340618592}
INFO:model_data_nn.py:Epoch 49/50, metrics: {'avg_train_loss': 0.19282583862492292, 'avg_test_loss': 0.16485939616406406}
INFO:model_data_nn.py:Epoch 50/50, metrics: {'avg_train_loss': 0.19278298528628376, 'avg_test_loss': 0.16483625990373116}
INFO:main.py:Making prediction for data in year: 2016
INFO:main.py:Prediction data shape: (13785,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2016: 0.3079964985100178
INFO:main.py:Prediction Stats:                retq          pred
count  13785.000000  13785.000000
mean       0.043107      0.017210
std        0.307751      0.020428
min       -0.983828     -0.117263
25%       -0.074501      0.012088
50%        0.023648      0.022152
75%        0.142416      0.029171
max       16.130048      0.076144
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:transform_data_nn.py:Train_data: (600650, 161)

INFO:transform_data_nn.py:Test data years: [2016]
INFO:transform_data_nn.py:Test_data: (13785, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]
INFO:transform_data_nn.py:Retrain_data: (614435, 161)

INFO:transform_data_nn.py:Prediction data years: [2017]
INFO:transform_data_nn.py:Prediction_data: (13498, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([600650, 152])
            y_train_tf: torch.Size([600650])

            x_test_tf: torch.Size([13785, 152])
            y_test_tf: torch.Size([13785])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([614435, 152])
            y_retrain_tf: torch.Size([614435])

            x_prediction_tf: torch.Size([13498, 152])
            y_prediction_tf: torch.Size([13498])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:main.py:Testing data year: 2016
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 16832
            device: cpu
            
2024-08-25 21:59:32,073	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-25 21:59:32,124	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-25 21:59:32,176	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip' (5.16MiB) to Ray cluster...
2024-08-25 21:59:32,191	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip'.
2024-08-25 21:59:34,437	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
[36m(train_fnn pid=4171783)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4171783)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4171784)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4171784)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=9214)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=9214)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=14472)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=14472)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=10020)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=10020)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=71744)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=71744)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=72174)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=72174)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=73168)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=73168)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=73407)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=73407)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=108144)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=108144)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=135033)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=135033)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=134536)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=134536)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=135771)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=135771)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=170663)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=170663)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=170687)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=170687)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=114333)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=114333)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=232764)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=232764)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=232514)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=232514)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=215496)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=215496)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=260260)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=260260)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=323083)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=323083)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=296731)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=296731)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=340894)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=340894)[0m   return F.l1_loss(input, target, reduction=self.reduction)
2024-08-25 23:04:49,289	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_21-59-34' in 0.3860s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 35, 'num_layers': 1, 'num_embeddings': 16832, 'embedding_dim': 9, 'dropout_rate': 0.19, 'lr': 3.0517074835275627e-05, 'weight_decay': 3.127054632075221e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.1848967815825262
INFO:model_data_nn.py:Best trial testing loss: 0.16255380441445486
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-25_21-59-29_636716_2457758/artifacts/2024-08-25_21-59-34/train_fnn_2024-08-25_21-59-34/driver_artifacts/train_fnn_fcb65_00002_2_batch_size=32,dropout_rate=0.1900,embedding_dim=9,hidden_dim=35,lr=0.0000,num_layers=1,weight_decay=0.0000_2024-08-25_21-59-34
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 35, 'num_layers': 1, 'num_embeddings': 17074, 'embedding_dim': 9, 'dropout_rate': 0.19, 'lr': 3.0517074835275627e-05, 'weight_decay': 3.127054632075221e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.19243197139275148, 'avg_test_loss': 0.14876541619793782}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.19113076975077592, 'avg_test_loss': 0.14859503428164816}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.19040296873160498, 'avg_test_loss': 0.14843432255689568}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1897371044886602, 'avg_test_loss': 0.14833535840161038}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.18916276005644778, 'avg_test_loss': 0.14916848009937747}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.1886457890655515, 'avg_test_loss': 0.14866869432313182}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.1883045244184169, 'avg_test_loss': 0.14888865751395294}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.18788264374808467, 'avg_test_loss': 0.14913433234061674}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.18760735634476697, 'avg_test_loss': 0.14922117704958146}
INFO:model_data_nn.py:Early stopping at epoch 9
INFO:main.py:Making prediction for data in year: 2017
INFO:main.py:Prediction data shape: (13498,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2017: 0.2702702823542459
INFO:main.py:Prediction Stats:                retq          pred
count  13498.000000  13498.000000
mean       0.040207     -0.005506
std        0.265685      0.040809
min       -0.907776     -0.265812
25%       -0.067703     -0.019151
50%        0.019797      0.005282
75%        0.118715      0.020502
max        5.661212      0.109113
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]
INFO:transform_data_nn.py:Train_data: (614435, 161)

INFO:transform_data_nn.py:Test data years: [2017]
INFO:transform_data_nn.py:Test_data: (13498, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]
INFO:transform_data_nn.py:Retrain_data: (627933, 161)

INFO:transform_data_nn.py:Prediction data years: [2018]
INFO:transform_data_nn.py:Prediction_data: (13226, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([614435, 152])
            y_train_tf: torch.Size([614435])

            x_test_tf: torch.Size([13498, 152])
            y_test_tf: torch.Size([13498])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([627933, 152])
            y_retrain_tf: torch.Size([627933])

            x_prediction_tf: torch.Size([13226, 152])
            y_prediction_tf: torch.Size([13226])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]
INFO:main.py:Testing data year: 2017
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 17074
            device: cpu
            
2024-08-26 00:25:32,454	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-26 00:25:32,502	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-26 00:25:32,556	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip' (5.16MiB) to Ray cluster...
2024-08-26 00:25:32,567	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip'.
2024-08-26 00:25:34,828	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-26 02:22:32,568	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-26_00-25-34' in 0.3414s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 65, 'num_layers': 4, 'num_embeddings': 17074, 'embedding_dim': 5, 'dropout_rate': 0.25, 'lr': 1.4633228763884286e-05, 'weight_decay': 0.0002775145627553223, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.18673564455861952
INFO:model_data_nn.py:Best trial testing loss: 0.14803638528167354
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-26_00-25-30_093398_2457758/artifacts/2024-08-26_00-25-34/train_fnn_2024-08-26_00-25-34/driver_artifacts/train_fnn_624fe_00031_31_batch_size=32,dropout_rate=0.2500,embedding_dim=5,hidden_dim=65,lr=0.0000,num_layers=4,weight_decay=0.000_2024-08-26_00-25-35
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 65, 'num_layers': 4, 'num_embeddings': 17220, 'embedding_dim': 5, 'dropout_rate': 0.25, 'lr': 1.4633228763884286e-05, 'weight_decay': 0.0002775145627553223, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.19337986741488758, 'avg_test_loss': 0.17820114568595724}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.19201030271172814, 'avg_test_loss': 0.1785878577778017}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.19131940604699108, 'avg_test_loss': 0.1783472417453349}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.19074112825166278, 'avg_test_loss': 0.17732949446940768}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.19013981962347357, 'avg_test_loss': 0.17707819084902315}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.1895129586398243, 'avg_test_loss': 0.17663060074699097}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.18899403965466494, 'avg_test_loss': 0.17649370088165509}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.18849305115885454, 'avg_test_loss': 0.17645429170146082}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.1880228039359095, 'avg_test_loss': 0.17679899795979692}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.18761987964132001, 'avg_test_loss': 0.17732535729157753}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.18720708759722754, 'avg_test_loss': 0.17641775655573694}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.18681311552721225, 'avg_test_loss': 0.17602839853596572}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.18641896222871557, 'avg_test_loss': 0.17624654410325963}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.1860328355289395, 'avg_test_loss': 0.17563607689479124}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.18558864849548848, 'avg_test_loss': 0.17594264339709628}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.18529550151903443, 'avg_test_loss': 0.17597332499597385}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.18486866860330292, 'avg_test_loss': 0.17599042562614892}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.18445593223846016, 'avg_test_loss': 0.1758645493267239}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.18415186477644876, 'avg_test_loss': 0.17713850916583757}
INFO:model_data_nn.py:Early stopping at epoch 19
INFO:main.py:Making prediction for data in year: 2018
INFO:main.py:Prediction data shape: (13226,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2018: 0.2983674518808673
INFO:main.py:Prediction Stats:                retq          pred
count  13226.000000  13226.000000
mean      -0.026920      0.009055
std        0.297287      0.031173
min       -0.999805     -0.318052
25%       -0.157460      0.004597
50%       -0.023134      0.017488
75%        0.081345      0.025840
max       12.032942      0.103255
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]
INFO:transform_data_nn.py:Train_data: (627933, 161)

INFO:transform_data_nn.py:Test data years: [2018]
INFO:transform_data_nn.py:Test_data: (13226, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]
INFO:transform_data_nn.py:Retrain_data: (641159, 161)

INFO:transform_data_nn.py:Prediction data years: [2019]
INFO:transform_data_nn.py:Prediction_data: (13264, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([627933, 152])
            y_train_tf: torch.Size([627933])

            x_test_tf: torch.Size([13226, 152])
            y_test_tf: torch.Size([13226])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([641159, 152])
            y_retrain_tf: torch.Size([641159])

            x_prediction_tf: torch.Size([13264, 152])
            y_prediction_tf: torch.Size([13264])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]
INFO:main.py:Testing data year: 2018
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 17220
            device: cpu
            
2024-08-26 04:02:58,349	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-26 04:02:58,392	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-26 04:02:58,441	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip' (5.16MiB) to Ray cluster...
2024-08-26 04:02:58,452	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip'.
2024-08-26 04:03:00,704	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-26 05:10:23,015	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-26_04-03-00' in 0.3809s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 17220, 'embedding_dim': 4, 'dropout_rate': 0.45, 'lr': 0.0013397036079133239, 'weight_decay': 3.233727302267509e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 64}
INFO:model_data_nn.py:Best trial training loss: 0.18141168777870484
INFO:model_data_nn.py:Best trial testing loss: 0.1735065528664036
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-26_04-02-56_020163_2457758/artifacts/2024-08-26_04-03-00/train_fnn_2024-08-26_04-03-00/driver_artifacts/train_fnn_c2429_00123_123_batch_size=64,dropout_rate=0.4500,embedding_dim=4,hidden_dim=45,lr=0.0013,num_layers=1,weight_decay=0.00_2024-08-26_04-03-01
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 17402, 'embedding_dim': 4, 'dropout_rate': 0.45, 'lr': 0.0013397036079133239, 'weight_decay': 3.233727302267509e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 64}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.18826226726320122, 'avg_test_loss': 0.1840185338559632}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.18550165505463623, 'avg_test_loss': 0.18505935764943177}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.1845393993174644, 'avg_test_loss': 0.1832315347945461}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.18411171811590607, 'avg_test_loss': 0.18984138105924314}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.18373457225101703, 'avg_test_loss': 0.19002422611587322}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.18320435481612662, 'avg_test_loss': 0.1883976417235457}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.18289398479768676, 'avg_test_loss': 0.18406916033619872}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.18261399921003776, 'avg_test_loss': 0.1831829222635581}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.18222956806436155, 'avg_test_loss': 0.18378468183800578}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.1819279336449176, 'avg_test_loss': 0.1865001507819845}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.18181037044356768, 'avg_test_loss': 0.187779041687743}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.18165797501338363, 'avg_test_loss': 0.1838565757498145}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.18140100395609265, 'avg_test_loss': 0.18465575138823345}
INFO:model_data_nn.py:Early stopping at epoch 13
INFO:main.py:Making prediction for data in year: 2019
INFO:main.py:Prediction data shape: (13264,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2019: 0.33272112871564274
INFO:main.py:Prediction Stats:                retq          pred
count  13264.000000  13264.000000
mean       0.056319     -0.027228
std        0.323019      0.050293
min       -0.956827     -0.355949
25%       -0.068035     -0.042456
50%        0.034312     -0.013041
75%        0.149987      0.003798
max        7.044691      0.178711
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]
INFO:transform_data_nn.py:Train_data: (641159, 161)

INFO:transform_data_nn.py:Test data years: [2019]
INFO:transform_data_nn.py:Test_data: (13264, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019]
INFO:transform_data_nn.py:Retrain_data: (654423, 161)

INFO:transform_data_nn.py:Prediction data years: [2020]
INFO:transform_data_nn.py:Prediction_data: (13301, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([641159, 152])
            y_train_tf: torch.Size([641159])

            x_test_tf: torch.Size([13264, 152])
            y_test_tf: torch.Size([13264])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([654423, 152])
            y_retrain_tf: torch.Size([654423])

            x_prediction_tf: torch.Size([13301, 152])
            y_prediction_tf: torch.Size([13301])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]
INFO:main.py:Testing data year: 2019
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 17402
            device: cpu
            
2024-08-26 06:36:45,867	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-26 06:36:45,915	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-26 06:36:45,967	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip' (5.16MiB) to Ray cluster...
2024-08-26 06:36:45,978	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip'.
2024-08-26 06:36:48,216	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-26 09:27:49,103	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-26_06-36-48' in 0.3143s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 115, 'num_layers': 4, 'num_embeddings': 17402, 'embedding_dim': 2, 'dropout_rate': 0.04, 'lr': 0.0008762384724314364, 'weight_decay': 8.356188663041064e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}
INFO:model_data_nn.py:Best trial training loss: 0.16741641407676694
INFO:model_data_nn.py:Best trial testing loss: 0.176510120025621
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-26_06-36-43_532026_2457758/artifacts/2024-08-26_06-36-48/train_fnn_2024-08-26_06-36-48/driver_artifacts/train_fnn_3e493_00012_12_batch_size=128,dropout_rate=0.0400,embedding_dim=2,hidden_dim=115,lr=0.0009,num_layers=4,weight_decay=0.0_2024-08-26_06-36-48
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 115, 'num_layers': 4, 'num_embeddings': 17639, 'embedding_dim': 2, 'dropout_rate': 0.04, 'lr': 0.0008762384724314364, 'weight_decay': 8.356188663041064e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.18538084513972716, 'avg_test_loss': 0.37918792421428055}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.17806308618447916, 'avg_test_loss': 0.3189065603969189}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.17425790716236653, 'avg_test_loss': 0.3472062087832735}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1720132204151606, 'avg_test_loss': 0.33971126879063934}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.17041178689234787, 'avg_test_loss': 0.40639929831601107}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.16909092689204103, 'avg_test_loss': 0.3256555640210326}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.16839374642358607, 'avg_test_loss': 0.33889097125770956}
INFO:model_data_nn.py:Early stopping at epoch 7
INFO:main.py:Making prediction for data in year: 2020
INFO:main.py:Prediction data shape: (13301,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2020: 0.5881901868006003
INFO:main.py:Prediction Stats:                retq          pred
count  13301.000000  13301.000000
mean       0.115792     -0.012704
std        0.562998      0.088558
min       -0.955222     -0.571029
25%       -0.158517     -0.038525
50%        0.046018      0.002345
75%        0.288242      0.041309
max       18.046271      0.362939

 Configuration for experiment     train_fnn_2024-08-23_16-20-02   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_16-20-02
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-23_16-19-56_663767_2457758/artifacts/2024-08-23_16-20-02/train_fnn_2024-08-23_16-20-02/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-23_16-33-31   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_16-33-31
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-23_16-33-27_837067_2457758/artifacts/2024-08-23_16-33-31/train_fnn_2024-08-23_16-33-31/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-23_17-08-15   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_17-08-15
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-23_17-08-11_251971_2457758/artifacts/2024-08-23_17-08-15/train_fnn_2024-08-23_17-08-15/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-23_17-39-12   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_17-39-12
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-23_17-39-08_949258_2457758/artifacts/2024-08-23_17-39-12/train_fnn_2024-08-23_17-39-12/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-23_18-06-11   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_18-06-11
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-23_18-06-08_012139_2457758/artifacts/2024-08-23_18-06-11/train_fnn_2024-08-23_18-06-11/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-23_18-42-13   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_18-42-13
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-23_18-42-09_236353_2457758/artifacts/2024-08-23_18-42-13/train_fnn_2024-08-23_18-42-13/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-23_19-22-42   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_19-22-42
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-23_19-22-38_291897_2457758/artifacts/2024-08-23_19-22-42/train_fnn_2024-08-23_19-22-42/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-23_19-52-39   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_19-52-39
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-23_19-52-35_175702_2457758/artifacts/2024-08-23_19-52-39/train_fnn_2024-08-23_19-52-39/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-23_20-35-07   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_20-35-07
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-23_20-35-03_525548_2457758/artifacts/2024-08-23_20-35-07/train_fnn_2024-08-23_20-35-07/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-23_21-28-46   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_21-28-46
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-23_21-28-42_032023_2457758/artifacts/2024-08-23_21-28-46/train_fnn_2024-08-23_21-28-46/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-23_22-23-23   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_22-23-23
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-23_22-23-18_943000_2457758/artifacts/2024-08-23_22-23-23/train_fnn_2024-08-23_22-23-23/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-23_23-16-47   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_23-16-47
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-23_23-16-43_904275_2457758/artifacts/2024-08-23_23-16-47/train_fnn_2024-08-23_23-16-47/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-24_00-04-36   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_00-04-36
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-24_00-04-32_448579_2457758/artifacts/2024-08-24_00-04-36/train_fnn_2024-08-24_00-04-36/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-24_01-51-40   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_01-51-40
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-24_01-51-36_507956_2457758/artifacts/2024-08-24_01-51-40/train_fnn_2024-08-24_01-51-40/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-24_03-03-38   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_03-03-38
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-24_03-03-34_377495_2457758/artifacts/2024-08-24_03-03-38/train_fnn_2024-08-24_03-03-38/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-24_04-39-22   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_04-39-22
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-24_04-39-18_812156_2457758/artifacts/2024-08-24_04-39-22/train_fnn_2024-08-24_04-39-22/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-24_06-22-04   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_06-22-04
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-24_06-22-00_141450_2457758/artifacts/2024-08-24_06-22-04/train_fnn_2024-08-24_06-22-04/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-24_07-26-37   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_07-26-37
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-24_07-26-33_164789_2457758/artifacts/2024-08-24_07-26-37/train_fnn_2024-08-24_07-26-37/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-24_09-23-26   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_09-23-26
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-24_09-23-22_119130_2457758/artifacts/2024-08-24_09-23-26/train_fnn_2024-08-24_09-23-26/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-24_11-00-05   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_11-00-05
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-24_11-00-00_693759_2457758/artifacts/2024-08-24_11-00-05/train_fnn_2024-08-24_11-00-05/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-24_12-19-01   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_12-19-01
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-24_12-18-57_471963_2457758/artifacts/2024-08-24_12-19-01/train_fnn_2024-08-24_12-19-01/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-24_14-21-54   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_14-21-54
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-24_14-21-48_880718_2457758/artifacts/2024-08-24_14-21-54/train_fnn_2024-08-24_14-21-54/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-24_16-21-24   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_16-21-24
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-24_16-21-20_053976_2457758/artifacts/2024-08-24_16-21-24/train_fnn_2024-08-24_16-21-24/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-24_19-18-20   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_19-18-20
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-24_19-18-16_071931_2457758/artifacts/2024-08-24_19-18-20/train_fnn_2024-08-24_19-18-20/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-24_21-17-35   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_21-17-35
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-24_21-17-30_427396_2457758/artifacts/2024-08-24_21-17-35/train_fnn_2024-08-24_21-17-35/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-25_00-05-29   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_00-05-29
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-25_00-05-24_498819_2457758/artifacts/2024-08-25_00-05-29/train_fnn_2024-08-25_00-05-29/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-25_01-56-17   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_01-56-17
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-25_01-56-13_256548_2457758/artifacts/2024-08-25_01-56-17/train_fnn_2024-08-25_01-56-17/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-25_03-58-41   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_03-58-41
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-25_03-58-36_667779_2457758/artifacts/2024-08-25_03-58-41/train_fnn_2024-08-25_03-58-41/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-25_10-09-11   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_10-09-11
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-25_10-09-06_874891_2457758/artifacts/2024-08-25_10-09-11/train_fnn_2024-08-25_10-09-11/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-25_13-15-25   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_13-15-25
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-25_13-15-21_022898_2457758/artifacts/2024-08-25_13-15-25/train_fnn_2024-08-25_13-15-25/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-25_16-44-08   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_16-44-08
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-25_16-44-03_407970_2457758/artifacts/2024-08-25_16-44-08/train_fnn_2024-08-25_16-44-08/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-25_19-13-17   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_19-13-17
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-25_19-13-12_945691_2457758/artifacts/2024-08-25_19-13-17/train_fnn_2024-08-25_19-13-17/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-25_21-59-34   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_21-59-34
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-25_21-59-29_636716_2457758/artifacts/2024-08-25_21-59-34/train_fnn_2024-08-25_21-59-34/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-26_00-25-34   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-26_00-25-34
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-26_00-25-30_093398_2457758/artifacts/2024-08-26_00-25-34/train_fnn_2024-08-26_00-25-34/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-26_04-03-00   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-26_04-03-00
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-26_04-02-56_020163_2457758/artifacts/2024-08-26_04-03-00/train_fnn_2024-08-26_04-03-00/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-26_06-36-48   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-26_06-36-48
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-26_06-36-43_532026_2457758/artifacts/2024-08-26_06-36-48/train_fnn_2024-08-26_06-36-48/driver_artifacts`

INFO:postprocess_predictions.py:Post processing prediction files
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1985.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1986.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1987.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1988.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1989.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1990.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1991.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1992.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1993.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1994.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1995.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1996.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1997.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1998.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_1999.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2000.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2001.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2002.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2003.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2004.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2005.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2006.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2007.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2008.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2009.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2010.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2011.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2012.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2013.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2014.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2015.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2016.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2017.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2018.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2019.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_vars/quarterly_prediction_2020.csv
INFO:postprocess_predictions.py:Sort the result by date and rank both ascendingly
INFO:postprocess_predictions.py:Saved the result file: result.csv
to the directory: kevin/output/prediction/quarterly_new_vars
