xCurrent working directory
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml
source kevin/venv/bin/activate
which python3
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/bin/python3
2024-07-27 00:15:44,319	PANIC scripts.py:900 -- `--address` is a required flag unless starting a head node with `--head`.
Error: `{}` is a required flag unless starting a head node with `{}`.
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
INFO:preprocess_data_nn.py:

Loading and preprocessing data...

DEBUG:preprocess_data_nn.py:          date   permno
626    1980-01  10006.0
5399   1980-01  10057.0
11398  1980-01  10137.0
12828  1980-01  10145.0
13984  1980-01  10153.0
DEBUG:preprocess_data_nn.py:--------------------------------------------------
INFO:main_restricted.py:preprocessed df: (667724, 161)
INFO:preprocess_data_nn.py:

Applying secondary data preprocessing..

INFO:main_restricted.py:secondary preprocessed df: (667724, 161)
INFO:main_restricted.py:df sample:     permno       pdate        ym  gvkey  sic2    absacc       acc  ...      roea   roavola       ret        mve_m      retq  pyear     date
0  10006.0  1980-01-01  198001.0   1010    37  0.083420  0.083420  ...  0.141715  0.004512  0.211679   303420.750 -0.055806   1980  1980-01
1  10057.0  1980-01-01  198001.0   1098    36  0.088951  0.088951  ...  0.174252  0.035698  0.282297   111423.125 -0.069431   1980  1980-01
2  10137.0  1980-01-01  198001.0   1279    49  0.041008  0.041008  ...  0.097554  0.006254 -0.032258   617349.500 -0.108065   1980  1980-01
3  10145.0  1980-01-01  198001.0   1300    99  0.050486  0.050486  ...  0.122729  0.004320  0.150127  1415193.000 -0.085950   1980  1980-01
4  10153.0  1980-01-01  198001.0   1308    13       NaN       NaN  ...  0.109950  0.009149 -0.122744   429488.500 -0.285199   1980  1980-01

[5 rows x 161 columns]
INFO:main_restricted.py:Train year start: 1980
INFO:main_restricted.py:Prediction data years: [1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020]
INFO:main_restricted.py:

Loop through all the prediction years and build optimized model for each year

INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983]
INFO:transform_data_nn.py:Train_data: (37173, 161)

INFO:transform_data_nn.py:Test data years: [1984]
INFO:transform_data_nn.py:Test_data: (13554, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984]
INFO:transform_data_nn.py:Retrain_data: (50727, 161)

INFO:transform_data_nn.py:Prediction data years: [1985]
INFO:transform_data_nn.py:Prediction_data: (14870, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([37173, 138])
            y_train_tf: torch.Size([37173])

            x_test_tf: torch.Size([13554, 138])
            y_test_tf: torch.Size([13554])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([50727, 138])
            y_retrain_tf: torch.Size([50727])

            x_prediction_tf: torch.Size([14870, 138])
            y_prediction_tf: torch.Size([14870])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([ 0.0532,  0.3675,  0.2276, -1.1851, -0.0859, -0.6627, -0.0880, -0.2748,
         0.0553, -0.1508, -0.7143, -0.2422, -0.4025, -0.2096,  0.1431,  0.6166,
        -0.1558,  0.0891,  0.0000,  0.5221, -0.3975, -0.5730, -0.0420,  0.0741,
        -0.1360, -0.1722, -0.5560,  0.0000,  0.4161,  0.5836,  0.4532, -0.1190,
         0.3308,  0.0000, -0.4383, -0.2031,  0.0581,  0.2170,  0.2272, -1.1552,
        -0.2501, -0.2802,  0.1923, -0.1684, -0.0838, -0.7201, -0.2343, -0.0456,
        -0.5920, -0.4609, -0.6104,  0.6038, -0.1768, -0.7566,  0.0567,  0.4154,
        -0.7654, -0.1756, -0.3131,  0.2321,  0.1090, -0.3835,  0.1363,  0.2755,
         0.2643, -0.1085,  0.1497, -0.0144,  0.6511, -0.3923,  0.0000,  0.0000,
         0.0000, -0.8978, -0.1755,  0.4788,  0.0382, -0.3277, -0.1897, -0.1001,
         0.0000,  0.5454, -0.1682,  0.0746, -0.5464, -0.0594, -0.0453, -0.3985,
        -0.1242,  0.1563, -0.4635, -1.3193,  0.0000,  0.3504,  1.0719,  0.6646,
        -0.4446,  0.3251, -1.2996, -1.3634, -1.4568,  0.3567,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0781, -0.8151,  0.0000, -1.1987, -0.7329, -0.9654,
         0.0675, -0.0623,  0.0000,  0.0000, -0.0258, -0.1355, -0.0767,  0.1613,
         0.1697, -0.4761, -0.4103,  0.0106,  0.1743, -0.5318,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([1447]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-1.2547, -0.7306, -0.4546,  2.3913, -0.7002, -0.9413, -0.1617, -0.3357,
        -0.2258,  0.2562, -0.7941, -0.4672, -1.5882,  0.1179,  0.1496, -1.5545,
        -0.1785, -1.2155,  0.0000, -0.6723,  0.7653, -0.5730, -0.0639, -0.6812,
        -0.1246, -0.0502, -0.6477,  0.0000,  1.1025,  0.5465, -1.0192, -0.6510,
        -0.2751,  0.0000, -0.6835, -0.3870, -0.0381, -0.0292, -1.7292, -0.6582,
        -0.2528,  0.5326, -0.4599, -0.1981, -0.3786, -0.9491,  0.5567, -0.2115,
        -0.7963,  1.1124,  0.0559,  0.7866, -0.3001, -0.7566,  0.0567, -0.0130,
        -0.6629, -0.1438, -0.2388,  0.1045,  0.2321, -0.6524, -0.5977, -0.2180,
        -1.2618, -0.9039,  0.7375, -0.0162, -0.7117, -0.4823,  0.0000,  0.0000,
         0.0000, -1.2167, -0.4863, -1.1590,  0.2582, -0.3679, -0.2020,  1.3561,
         0.0000, -2.2631, -0.5793,  0.7328,  0.9336, -0.0524, -0.0431, -0.4372,
        -0.3054, -0.9095,  0.9153, -0.4669,  0.0000, -1.2514, -1.1650, -1.7189,
         1.3413, -0.7633,  0.9094, -1.7061, -1.3967, -0.7540,  0.0000,  0.0000,
         0.0000,  0.0000, -0.1690, -0.8151,  0.0000,  1.7120,  0.3904,  2.1510,
        -0.0088, -0.0623,  0.0000,  0.0000, -0.2833, -0.1608, -0.0767,  0.7204,
         0.1743, -0.9745, -0.6053, -0.6478, -0.3341, -0.0535,  0.0000,  0.0000,
         0.0000,  0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([1547]), tensor(0.0275))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.0067,  0.3197,  0.2194, -1.2141, -0.1261, -0.6221, -0.0984, -0.2873,
         0.1534, -0.1619, -0.7165, -0.2269, -0.4275, -0.1703,  0.1184,  0.6090,
        -0.1475,  0.0881,  0.0000,  0.5182, -0.3056,  0.0932, -0.0394, -0.0072,
        -0.1154, -0.2093, -0.5687,  0.0000,  0.4274,  0.6948,  0.4798, -0.1521,
         0.3766,  0.0000, -0.4196, -0.1835,  0.0896,  0.2648,  0.1857, -1.1756,
        -0.2486, -0.0574,  0.1861, -0.1307, -0.0974, -0.6779, -0.1000, -0.0419,
        -0.6077, -0.2871, -0.6160,  0.6367, -0.1798, -0.2277,  0.0229,  0.4441,
        -0.7671, -0.1410, -0.3106,  0.1864,  0.0977, -0.3876,  0.1515,  0.3127,
         0.2454, -0.0990,  0.1182, -0.0331,  0.6423, -0.4089,  0.0000,  0.0000,
         0.0000, -0.8463, -0.1161,  0.5137,  0.0479, -0.3351, -0.1862, -0.0302,
         0.0000,  0.5091, -0.0908, -0.0771, -0.5431, -0.0656, -0.0515, -0.3883,
        -0.1546,  0.1526, -0.4652, -1.2916,  0.0000,  0.6123,  1.3429,  0.9783,
        -0.2574,  0.5183, -1.6086, -1.0886, -1.3142,  0.3028,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0558, -0.8242,  0.0000, -1.2617, -1.0052, -1.1608,
         0.0832, -0.0920,  0.0000,  0.0000, -0.0071, -0.1319, -0.0436,  0.1436,
         0.2193, -0.4500, -0.4138,  0.0709,  0.2018, -0.4794,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([1711]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.5541e-02, -3.1473e-02,  6.9044e+00, -4.8718e-01, -3.7399e-02,
         1.8157e+00,  1.8471e+00,  2.0916e+00, -5.1028e-01, -4.6532e-01,
         1.1642e+00,  1.4917e-02,  2.0411e-01,  2.9692e-02,  7.6405e-03,
        -8.2565e-03, -2.2184e-01, -2.1168e+00,  0.0000e+00, -9.0573e-03,
        -2.3354e-01,  9.3180e-02,  8.9928e-03, -1.8666e-02, -9.8145e-03,
        -2.9154e-01,  2.9385e-02,  0.0000e+00, -1.3687e+00, -9.4795e-01,
         1.4198e+00, -3.8788e-02,  1.4494e-01,  0.0000e+00,  3.3448e+00,
         1.7744e-02,  1.6136e-02, -1.7888e-01, -1.7655e-01,  1.3208e+00,
        -8.3496e-02, -1.4023e+00, -1.4078e-02, -4.2197e-01, -1.9644e-02,
         3.2230e-01, -1.3703e+00,  2.5145e-01, -3.6213e-01, -1.5088e+00,
         2.8064e+00, -1.1100e+00, -9.4838e-02, -2.2774e-01,  7.9354e-01,
         3.3974e-01, -2.1428e-02,  2.3160e-02, -2.2957e-02,  2.9556e-02,
        -8.7836e-03, -2.1470e-02,  3.6345e-02,  4.2058e-02, -9.7462e-03,
         1.5879e-02, -2.3376e-02,  1.6198e-02,  6.4233e-01,  3.8849e-02,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  3.2896e-01,  3.0743e-01,
        -1.4042e-02, -2.0656e-01,  1.2085e+00,  6.9330e+00, -3.0173e-02,
         0.0000e+00,  1.5769e-02, -3.4090e-01, -9.1126e-01, -5.2861e-01,
        -6.6146e-02, -5.1157e-02, -5.5830e-02,  5.6105e-01, -2.3373e-02,
        -4.1076e-01,  1.9687e+00,  0.0000e+00, -6.7487e-01, -3.0891e-01,
        -1.0547e+00, -3.5636e+00, -1.0826e+00,  1.0152e+00, -1.2112e+00,
        -5.3489e-01, -3.4670e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00, -6.0399e-03,  2.0349e-03,  0.0000e+00,  6.4186e-01,
        -1.1317e+00,  9.6608e-01, -4.2225e-03, -9.1975e-02,  0.0000e+00,
         0.0000e+00,  3.1905e-02, -1.0698e-02, -4.3647e-02, -1.5213e-02,
         3.4496e-02,  5.0923e-01,  8.7191e-02,  5.3129e-01,  2.3714e-01,
        -4.0068e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([1051]), tensor(0.4426))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983]
INFO:main_restricted.py:Testing data year: 1984
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 120
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 3578
            device: cpu
            
2024-07-27 00:21:27,220	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 00:21:27,267	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 00:21:27,309	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_c118a1eed3fe8d80.zip' (1.37MiB) to Ray cluster...
2024-07-27 00:21:27,314	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_c118a1eed3fe8d80.zip'.
2024-07-27 00:21:28,572	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 00:25:51,328	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_00-21-28' in 0.4365s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 2, 'num_embeddings': 3578, 'embedding_dim': 10, 'dropout_rate': 0.54, 'lr': 0.00034703605955441544, 'weight_decay': 1.3674518065224943e-06, 'num_epochs': 120, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03803866449182471
INFO:model_data_nn.py:Best trial testing loss: 0.033425291520235885
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-27_00-21-24_619107_752378/artifacts/2024-07-27_00-21-28/train_fnn_2024-07-27_00-21-28/driver_artifacts/train_fnn_d71df_00054_54_dropout_rate=0.5400,embedding_dim=10,hidden_dim=45,lr=0.0003,num_layers=2,weight_decay=0.0000_2024-07-27_00-21-28
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 2, 'num_embeddings': 4249, 'embedding_dim': 10, 'dropout_rate': 0.54, 'lr': 0.00034703605955441544, 'weight_decay': 1.3674518065224943e-06, 'num_epochs': 120, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/120, metrics: {'avg_train_loss': 0.045703757483826914, 'avg_test_loss': 0.05447975112706102}
INFO:model_data_nn.py:Epoch 2/120, metrics: {'avg_train_loss': 0.04189574114701148, 'avg_test_loss': 0.05556956675624655}
INFO:model_data_nn.py:Epoch 3/120, metrics: {'avg_train_loss': 0.04065053701144731, 'avg_test_loss': 0.05595444444647079}
INFO:model_data_nn.py:Epoch 4/120, metrics: {'avg_train_loss': 0.03921184752519333, 'avg_test_loss': 0.05547579617830374}
INFO:model_data_nn.py:Epoch 5/120, metrics: {'avg_train_loss': 0.038357926418119276, 'avg_test_loss': 0.057604458813946095}
INFO:model_data_nn.py:Epoch 6/120, metrics: {'avg_train_loss': 0.037756282209053464, 'avg_test_loss': 0.058678465290495786}
INFO:model_data_nn.py:Epoch 7/120, metrics: {'avg_train_loss': 0.03689214057074143, 'avg_test_loss': 0.05627547304836973}
INFO:model_data_nn.py:Epoch 8/120, metrics: {'avg_train_loss': 0.03634437055163753, 'avg_test_loss': 0.06138611647190266}
INFO:model_data_nn.py:Epoch 9/120, metrics: {'avg_train_loss': 0.035738373114193075, 'avg_test_loss': 0.06501786028265312}
INFO:model_data_nn.py:Epoch 10/120, metrics: {'avg_train_loss': 0.035215196918465974, 'avg_test_loss': 0.06379358221686655}
INFO:model_data_nn.py:Epoch 11/120, metrics: {'avg_train_loss': 0.03494811583073131, 'avg_test_loss': 0.06491797004816352}
INFO:model_data_nn.py:Epoch 12/120, metrics: {'avg_train_loss': 0.034673025987779285, 'avg_test_loss': 0.06640617030282174}
INFO:model_data_nn.py:Epoch 13/120, metrics: {'avg_train_loss': 0.03415593022215186, 'avg_test_loss': 0.07253774339233035}
INFO:model_data_nn.py:Epoch 14/120, metrics: {'avg_train_loss': 0.034090910046414236, 'avg_test_loss': 0.07304241693708845}
INFO:model_data_nn.py:Epoch 15/120, metrics: {'avg_train_loss': 0.03367461024667283, 'avg_test_loss': 0.07114301972011085}
INFO:model_data_nn.py:Epoch 16/120, metrics: {'avg_train_loss': 0.033539022766476474, 'avg_test_loss': 0.0815721246704299}
INFO:model_data_nn.py:Epoch 17/120, metrics: {'avg_train_loss': 0.033167298019994025, 'avg_test_loss': 0.0785249171157678}
INFO:model_data_nn.py:Epoch 18/120, metrics: {'avg_train_loss': 0.033130973380782455, 'avg_test_loss': 0.08145828261090222}
INFO:model_data_nn.py:Epoch 19/120, metrics: {'avg_train_loss': 0.03270729086191533, 'avg_test_loss': 0.08230141505438794}
INFO:model_data_nn.py:Epoch 20/120, metrics: {'avg_train_loss': 0.032723111002723605, 'avg_test_loss': 0.0857349891495961}
INFO:model_data_nn.py:Epoch 21/120, metrics: {'avg_train_loss': 0.03270253222576645, 'avg_test_loss': 0.09408602150938203}
INFO:model_data_nn.py:Epoch 22/120, metrics: {'avg_train_loss': 0.032348742097273266, 'avg_test_loss': 0.09681193710414954}
INFO:model_data_nn.py:Epoch 23/120, metrics: {'avg_train_loss': 0.03205258713290565, 'avg_test_loss': 0.09840859250035337}
INFO:model_data_nn.py:Epoch 24/120, metrics: {'avg_train_loss': 0.031804651831139306, 'avg_test_loss': 0.14247192311030563}
INFO:model_data_nn.py:Epoch 25/120, metrics: {'avg_train_loss': 0.031564723820076766, 'avg_test_loss': 0.10771772453301055}
INFO:model_data_nn.py:Epoch 26/120, metrics: {'avg_train_loss': 0.03174048098488881, 'avg_test_loss': 0.09485740174529372}
INFO:model_data_nn.py:Epoch 27/120, metrics: {'avg_train_loss': 0.03151082989793802, 'avg_test_loss': 0.10303824767069791}
INFO:model_data_nn.py:Epoch 28/120, metrics: {'avg_train_loss': 0.03133961141478237, 'avg_test_loss': 0.12086283929485787}
INFO:model_data_nn.py:Epoch 29/120, metrics: {'avg_train_loss': 0.03124356272713778, 'avg_test_loss': 0.12698516387051792}
INFO:model_data_nn.py:Epoch 30/120, metrics: {'avg_train_loss': 0.031014630250975696, 'avg_test_loss': 0.14608562287864504}
INFO:model_data_nn.py:Epoch 31/120, metrics: {'avg_train_loss': 0.030990066185880166, 'avg_test_loss': 0.12389564628722848}
INFO:model_data_nn.py:Early stopping at epoch 31
INFO:main_restricted.py:Making prediction for data in year: 1985
INFO:main_restricted.py:Prediction data shape: (14870,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:350: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1985: 0.35184327634558077
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  14870.000000  14870.000000
mean       0.059184      0.242888
std        0.233633      0.199370
min       -0.916667     -0.235221
25%       -0.069152      0.085972
50%        0.042554      0.212689
75%        0.171429      0.369148
max        4.111109      1.171671
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984]
INFO:transform_data_nn.py:Train_data: (50727, 161)

INFO:transform_data_nn.py:Test data years: [1985]
INFO:transform_data_nn.py:Test_data: (14870, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Retrain_data: (65597, 161)

INFO:transform_data_nn.py:Prediction data years: [1986]
INFO:transform_data_nn.py:Prediction_data: (15019, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([50727, 138])
            y_train_tf: torch.Size([50727])

            x_test_tf: torch.Size([14870, 138])
            y_test_tf: torch.Size([14870])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([65597, 138])
            y_retrain_tf: torch.Size([65597])

            x_prediction_tf: torch.Size([15019, 138])
            y_prediction_tf: torch.Size([15019])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-0.0067,  0.3197,  0.2194, -1.2141, -0.1261, -0.6221, -0.0984, -0.2873,
         0.1534, -0.1619, -0.7165, -0.2269, -0.4275, -0.1703,  0.1184,  0.6090,
        -0.1475,  0.0881,  0.0000,  0.5182, -0.3056,  0.0932, -0.0394, -0.0072,
        -0.1154, -0.2093, -0.5687,  0.0000,  0.4274,  0.6948,  0.4798, -0.1521,
         0.3766,  0.0000, -0.4196, -0.1835,  0.0896,  0.2648,  0.1857, -1.1756,
        -0.2486, -0.0574,  0.1861, -0.1307, -0.0974, -0.6779, -0.1000, -0.0419,
        -0.6077, -0.2871, -0.6160,  0.6367, -0.1798, -0.2277,  0.0229,  0.4441,
        -0.7671, -0.1410, -0.3106,  0.1864,  0.0977, -0.3876,  0.1515,  0.3127,
         0.2454, -0.0990,  0.1182, -0.0331,  0.6423, -0.4089,  0.0000,  0.0000,
         0.0000, -0.8463, -0.1161,  0.5137,  0.0479, -0.3351, -0.1862, -0.0302,
         0.0000,  0.5091, -0.0908, -0.0771, -0.5431, -0.0656, -0.0515, -0.3883,
        -0.1546,  0.1526, -0.4652, -1.2916,  0.0000,  0.6123,  1.3429,  0.9783,
        -0.2574,  0.5183, -1.6086, -1.0886, -1.3142,  0.3028,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0558, -0.8242,  0.0000, -1.2617, -1.0052, -1.1608,
         0.0832, -0.0920,  0.0000,  0.0000, -0.0071, -0.1319, -0.0436,  0.1436,
         0.2193, -0.4500, -0.4138,  0.0709,  0.2018, -0.4794,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([1711]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-3.5541e-02, -3.1473e-02,  6.9044e+00, -4.8718e-01, -3.7399e-02,
         1.8157e+00,  1.8471e+00,  2.0916e+00, -5.1028e-01, -4.6532e-01,
         1.1642e+00,  1.4917e-02,  2.0411e-01,  2.9692e-02,  7.6405e-03,
        -8.2565e-03, -2.2184e-01, -2.1168e+00,  0.0000e+00, -9.0573e-03,
        -2.3354e-01,  9.3180e-02,  8.9928e-03, -1.8666e-02, -9.8145e-03,
        -2.9154e-01,  2.9385e-02,  0.0000e+00, -1.3687e+00, -9.4795e-01,
         1.4198e+00, -3.8788e-02,  1.4494e-01,  0.0000e+00,  3.3448e+00,
         1.7744e-02,  1.6136e-02, -1.7888e-01, -1.7655e-01,  1.3208e+00,
        -8.3496e-02, -1.4023e+00, -1.4078e-02, -4.2197e-01, -1.9644e-02,
         3.2230e-01, -1.3703e+00,  2.5145e-01, -3.6213e-01, -1.5088e+00,
         2.8064e+00, -1.1100e+00, -9.4838e-02, -2.2774e-01,  7.9354e-01,
         3.3974e-01, -2.1428e-02,  2.3160e-02, -2.2957e-02,  2.9556e-02,
        -8.7836e-03, -2.1470e-02,  3.6345e-02,  4.2058e-02, -9.7462e-03,
         1.5879e-02, -2.3376e-02,  1.6198e-02,  6.4233e-01,  3.8849e-02,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  3.2896e-01,  3.0743e-01,
        -1.4042e-02, -2.0656e-01,  1.2085e+00,  6.9330e+00, -3.0173e-02,
         0.0000e+00,  1.5769e-02, -3.4090e-01, -9.1126e-01, -5.2861e-01,
        -6.6146e-02, -5.1157e-02, -5.5830e-02,  5.6105e-01, -2.3373e-02,
        -4.1076e-01,  1.9687e+00,  0.0000e+00, -6.7487e-01, -3.0891e-01,
        -1.0547e+00, -3.5636e+00, -1.0826e+00,  1.0152e+00, -1.2112e+00,
        -5.3489e-01, -3.4670e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00, -6.0399e-03,  2.0349e-03,  0.0000e+00,  6.4186e-01,
        -1.1317e+00,  9.6608e-01, -4.2225e-03, -9.1975e-02,  0.0000e+00,
         0.0000e+00,  3.1905e-02, -1.0698e-02, -4.3647e-02, -1.5213e-02,
         3.4496e-02,  5.0923e-01,  8.7191e-02,  5.3129e-01,  2.3714e-01,
        -4.0068e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([1051]), tensor(0.4426))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.0866e-01,  2.1567e-01,  1.8687e-01, -1.2464e+00, -1.4750e-01,
        -6.0599e-01, -1.1476e-01, -3.0086e-01,  2.0923e-01, -1.6396e-01,
        -7.1105e-01, -1.6450e-01, -4.3970e-01, -9.2192e-02,  9.0120e-02,
         5.5198e-01, -1.4281e-01,  8.2749e-02,  0.0000e+00,  4.3716e-01,
        -3.6548e-01, -2.8282e-01, -1.3577e-03, -7.1517e-04, -1.0327e-01,
        -2.2369e-01, -5.8433e-01,  0.0000e+00,  4.3690e-01,  7.8414e-01,
         4.8983e-01, -1.4383e-01,  3.8715e-01,  0.0000e+00, -4.1197e-01,
        -1.8811e-01,  7.5261e-02,  3.1092e-01,  1.0364e-01, -1.1787e+00,
        -2.5471e-01,  4.8843e-02,  1.3564e-01, -1.0668e-01, -1.4147e-01,
        -6.4896e-01, -3.6768e-02, -2.3174e-03, -6.2742e-01, -2.8325e-01,
        -6.2002e-01,  6.6451e-01, -1.8099e-01, -1.8662e-01,  2.1484e-02,
         4.4240e-01, -7.6693e-01, -1.0270e-01, -2.7572e-01,  1.4888e-01,
         9.8031e-02, -3.4406e-01,  1.6447e-01,  2.9799e-01,  2.0712e-01,
        -9.6412e-02,  6.7037e-02, -5.1608e-02,  6.5689e-01, -4.0800e-01,
         0.0000e+00,  0.0000e+00, -1.5042e-01, -8.0966e-01, -6.3832e-02,
         5.2703e-01,  4.8402e-02, -3.4089e-01, -1.8360e-01, -1.1685e-02,
         0.0000e+00,  3.8418e-01, -4.3338e-02, -1.5994e-01, -5.4566e-01,
        -7.2678e-02, -5.8190e-02, -3.8189e-01, -1.6225e-01,  1.5746e-01,
        -4.7465e-01, -1.2857e+00, -1.7335e+00,  8.5916e-01,  1.5859e+00,
         1.2321e+00,  3.1903e-01,  7.7744e-01, -1.8854e+00, -8.3912e-01,
        -1.1769e+00,  1.9221e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.8057e-02,  4.2140e-02,  0.0000e+00, -1.4389e+00,
        -4.1932e-01, -1.4216e+00,  9.8359e-02, -3.2869e-02,  0.0000e+00,
         0.0000e+00,  1.1453e-02, -1.5504e-01, -6.1259e-02,  1.0941e-01,
         2.4897e-01, -4.3682e-01, -4.0812e-01,  1.0562e-01,  2.0867e-01,
        -3.8885e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([1940]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-4.7985e-01, -1.6106e+00, -5.5060e-01, -4.7226e-03,  4.3003e+00,
        -3.5303e-01,  1.3575e+00,  1.3208e+00, -9.6294e-01, -9.4089e-01,
        -3.5415e-03, -1.7267e-01,  2.3447e-01,  5.6794e-01,  2.5223e+00,
        -1.8668e-03, -2.1744e-01, -3.3228e-01,  0.0000e+00, -5.0880e-02,
        -2.8527e-01, -2.8282e-01,  2.4364e-03,  3.5003e-01,  1.5369e+00,
        -9.0415e-01, -2.9426e-01,  0.0000e+00,  9.5529e-02, -8.8314e-01,
         2.8603e-04,  2.4687e-01, -4.5384e-02,  0.0000e+00,  1.1446e+00,
        -1.0048e-02,  2.4348e+00, -2.1209e-01,  7.2558e-02,  7.3454e-01,
        -2.5444e-01, -5.1495e-01,  1.5967e+00, -3.6739e-01,  5.6767e+00,
        -5.8272e-02,  2.4333e+00,  5.6871e-01, -1.0539e+00,  1.2308e+00,
         7.9871e-01, -4.5356e-01, -1.0711e-01, -1.8662e-01,  7.8078e-01,
         2.3879e-01,  2.1691e+00, -7.9302e-02, -2.0149e+00, -1.8340e+00,
         5.3175e-02, -1.7157e+00, -1.0708e+00, -1.6445e+00,  5.1078e-02,
        -8.4687e-01, -8.4636e-01, -2.4089e-01, -9.0968e-03, -6.6790e-01,
         0.0000e+00,  0.0000e+00,  8.1978e+00, -6.6867e-01, -2.6865e-01,
         8.8454e-03, -2.2079e-01,  6.3787e-01,  6.9349e+00, -1.1685e-02,
         0.0000e+00,  2.8331e-01, -6.1461e-01,  1.0987e+00,  1.6332e+00,
        -6.1567e-02, -5.2940e-02, -2.8137e-01, -1.1726e+00,  4.7360e-01,
         1.9134e+00, -7.8598e-01, -1.7335e+00, -1.9806e+00, -2.0008e+00,
        -1.6215e+00, -1.1878e+00, -1.1509e+00,  2.4348e-01, -5.9449e-01,
        -3.1360e-01, -1.6351e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.9270e-02,  1.3996e-01,  0.0000e+00, -7.9850e-02,
        -1.3016e+00,  8.1629e-01, -8.0799e-04, -3.2869e-02,  0.0000e+00,
         0.0000e+00, -1.7570e+00,  1.4390e+00, -6.1259e-02,  1.3578e+00,
        -1.7508e-03, -4.8388e-01, -1.1590e+00, -7.4953e-02,  1.1934e-01,
         4.9949e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([1041]), tensor(0.2099))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984]
INFO:main_restricted.py:Testing data year: 1985
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 120
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 4249
            device: cpu
            
2024-07-27 00:35:06,187	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 00:35:06,229	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 00:35:06,268	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_c118a1eed3fe8d80.zip' (1.37MiB) to Ray cluster...
2024-07-27 00:35:06,273	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_c118a1eed3fe8d80.zip'.
2024-07-27 00:35:07,474	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 00:50:12,461	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_00-35-07' in 0.2374s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 4249, 'embedding_dim': 6, 'dropout_rate': 0.54, 'lr': 3.4419719400899214e-05, 'weight_decay': 0.00016266799643038432, 'num_epochs': 120, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.04590598991655123
INFO:model_data_nn.py:Best trial testing loss: 0.05483048152659208
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-27_00-35-04_003497_752378/artifacts/2024-07-27_00-35-07/train_fnn_2024-07-27_00-35-07/driver_artifacts/train_fnn_bf3e5_00077_77_dropout_rate=0.5400,embedding_dim=6,hidden_dim=5,lr=0.0000,num_layers=5,weight_decay=0.0002_2024-07-27_00-35-07
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 4799, 'embedding_dim': 6, 'dropout_rate': 0.54, 'lr': 3.4419719400899214e-05, 'weight_decay': 0.00016266799643038432, 'num_epochs': 120, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/120, metrics: {'avg_train_loss': 0.05025764131827689, 'avg_test_loss': 0.06290118848072722}
INFO:model_data_nn.py:Epoch 2/120, metrics: {'avg_train_loss': 0.049586942229056505, 'avg_test_loss': 0.06308367070841028}
INFO:model_data_nn.py:Epoch 3/120, metrics: {'avg_train_loss': 0.04948584730350753, 'avg_test_loss': 0.06323374841322607}
INFO:model_data_nn.py:Epoch 4/120, metrics: {'avg_train_loss': 0.04947972302211494, 'avg_test_loss': 0.06330500744639876}
INFO:model_data_nn.py:Epoch 5/120, metrics: {'avg_train_loss': 0.04948212771063171, 'avg_test_loss': 0.0632501418999535}
INFO:model_data_nn.py:Epoch 6/120, metrics: {'avg_train_loss': 0.049473672449225334, 'avg_test_loss': 0.0632115482887689}
INFO:model_data_nn.py:Epoch 7/120, metrics: {'avg_train_loss': 0.04947738792156664, 'avg_test_loss': 0.06329189297604434}
INFO:model_data_nn.py:Epoch 8/120, metrics: {'avg_train_loss': 0.049474550020403976, 'avg_test_loss': 0.06329422172040064}
INFO:model_data_nn.py:Epoch 9/120, metrics: {'avg_train_loss': 0.0494746876939586, 'avg_test_loss': 0.06332283244924025}
INFO:model_data_nn.py:Epoch 10/120, metrics: {'avg_train_loss': 0.04947204221948618, 'avg_test_loss': 0.06328641939710113}
INFO:model_data_nn.py:Epoch 11/120, metrics: {'avg_train_loss': 0.04946549522849481, 'avg_test_loss': 0.06329753333900837}
INFO:model_data_nn.py:Epoch 12/120, metrics: {'avg_train_loss': 0.04946407520507531, 'avg_test_loss': 0.06331092304094357}
INFO:model_data_nn.py:Epoch 13/120, metrics: {'avg_train_loss': 0.04946026243723747, 'avg_test_loss': 0.06332973791088195}
INFO:model_data_nn.py:Epoch 14/120, metrics: {'avg_train_loss': 0.049451748389387276, 'avg_test_loss': 0.06336790844996242}
INFO:model_data_nn.py:Epoch 15/120, metrics: {'avg_train_loss': 0.04946290832376335, 'avg_test_loss': 0.0633398558429264}
INFO:model_data_nn.py:Epoch 16/120, metrics: {'avg_train_loss': 0.04943807693152893, 'avg_test_loss': 0.06336052858250889}
INFO:model_data_nn.py:Epoch 17/120, metrics: {'avg_train_loss': 0.04944626053477206, 'avg_test_loss': 0.06336488925475389}
INFO:model_data_nn.py:Epoch 18/120, metrics: {'avg_train_loss': 0.04942957289244344, 'avg_test_loss': 0.06335110613045858}
INFO:model_data_nn.py:Epoch 19/120, metrics: {'avg_train_loss': 0.04943829568420968, 'avg_test_loss': 0.06339137224440879}
INFO:model_data_nn.py:Epoch 20/120, metrics: {'avg_train_loss': 0.049438643092971024, 'avg_test_loss': 0.06335157109226318}
INFO:model_data_nn.py:Epoch 21/120, metrics: {'avg_train_loss': 0.049404942237022444, 'avg_test_loss': 0.06342518496663964}
INFO:model_data_nn.py:Epoch 22/120, metrics: {'avg_train_loss': 0.049399282950907945, 'avg_test_loss': 0.06336611239635881}
INFO:model_data_nn.py:Epoch 23/120, metrics: {'avg_train_loss': 0.04939763324744091, 'avg_test_loss': 0.0634177605106317}
INFO:model_data_nn.py:Epoch 24/120, metrics: {'avg_train_loss': 0.04938507528339581, 'avg_test_loss': 0.06339985988439714}
INFO:model_data_nn.py:Epoch 25/120, metrics: {'avg_train_loss': 0.04934196807625817, 'avg_test_loss': 0.06336214208103558}
INFO:model_data_nn.py:Epoch 26/120, metrics: {'avg_train_loss': 0.04934825716085914, 'avg_test_loss': 0.0633960634311463}
INFO:model_data_nn.py:Epoch 27/120, metrics: {'avg_train_loss': 0.04933699692258747, 'avg_test_loss': 0.06340156399664727}
INFO:model_data_nn.py:Epoch 28/120, metrics: {'avg_train_loss': 0.04929754013150203, 'avg_test_loss': 0.06341821592142607}
INFO:model_data_nn.py:Epoch 29/120, metrics: {'avg_train_loss': 0.04932987236622267, 'avg_test_loss': 0.06342402008817868}
INFO:model_data_nn.py:Epoch 30/120, metrics: {'avg_train_loss': 0.04929231506567903, 'avg_test_loss': 0.06339293998725554}
INFO:model_data_nn.py:Epoch 31/120, metrics: {'avg_train_loss': 0.049249493314816456, 'avg_test_loss': 0.06339933223071251}
INFO:model_data_nn.py:Early stopping at epoch 31
INFO:main_restricted.py:Making prediction for data in year: 1986
INFO:main_restricted.py:Prediction data shape: (15019,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:350: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1986: 0.2519080063177109
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  1.501900e+04  15019.000000
mean   2.116020e-02      0.047511
std    2.505653e-01      0.002477
min   -9.375002e-01      0.012725
25%   -1.200001e-01      0.048112
50%    1.000000e-07      0.048357
75%    1.356736e-01      0.048357
max    3.999999e+00      0.048357
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Train_data: (65597, 161)

INFO:transform_data_nn.py:Test data years: [1986]
INFO:transform_data_nn.py:Test_data: (15019, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:transform_data_nn.py:Retrain_data: (80616, 161)

INFO:transform_data_nn.py:Prediction data years: [1987]
INFO:transform_data_nn.py:Prediction_data: (15222, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([65597, 138])
            y_train_tf: torch.Size([65597])

            x_test_tf: torch.Size([15019, 138])
            y_test_tf: torch.Size([15019])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([80616, 138])
            y_retrain_tf: torch.Size([80616])

            x_prediction_tf: torch.Size([15222, 138])
            y_prediction_tf: torch.Size([15222])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.0866e-01,  2.1567e-01,  1.8687e-01, -1.2464e+00, -1.4750e-01,
        -6.0599e-01, -1.1476e-01, -3.0086e-01,  2.0923e-01, -1.6396e-01,
        -7.1105e-01, -1.6450e-01, -4.3970e-01, -9.2192e-02,  9.0120e-02,
         5.5198e-01, -1.4281e-01,  8.2749e-02,  0.0000e+00,  4.3716e-01,
        -3.6548e-01, -2.8282e-01, -1.3577e-03, -7.1517e-04, -1.0327e-01,
        -2.2369e-01, -5.8433e-01,  0.0000e+00,  4.3690e-01,  7.8414e-01,
         4.8983e-01, -1.4383e-01,  3.8715e-01,  0.0000e+00, -4.1197e-01,
        -1.8811e-01,  7.5261e-02,  3.1092e-01,  1.0364e-01, -1.1787e+00,
        -2.5471e-01,  4.8843e-02,  1.3564e-01, -1.0668e-01, -1.4147e-01,
        -6.4896e-01, -3.6768e-02, -2.3174e-03, -6.2742e-01, -2.8325e-01,
        -6.2002e-01,  6.6451e-01, -1.8099e-01, -1.8662e-01,  2.1484e-02,
         4.4240e-01, -7.6693e-01, -1.0270e-01, -2.7572e-01,  1.4888e-01,
         9.8031e-02, -3.4406e-01,  1.6447e-01,  2.9799e-01,  2.0712e-01,
        -9.6412e-02,  6.7037e-02, -5.1608e-02,  6.5689e-01, -4.0800e-01,
         0.0000e+00,  0.0000e+00, -1.5042e-01, -8.0966e-01, -6.3832e-02,
         5.2703e-01,  4.8402e-02, -3.4089e-01, -1.8360e-01, -1.1685e-02,
         0.0000e+00,  3.8418e-01, -4.3338e-02, -1.5994e-01, -5.4566e-01,
        -7.2678e-02, -5.8190e-02, -3.8189e-01, -1.6225e-01,  1.5746e-01,
        -4.7465e-01, -1.2857e+00, -1.7335e+00,  8.5916e-01,  1.5859e+00,
         1.2321e+00,  3.1903e-01,  7.7744e-01, -1.8854e+00, -8.3912e-01,
        -1.1769e+00,  1.9221e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.8057e-02,  4.2140e-02,  0.0000e+00, -1.4389e+00,
        -4.1932e-01, -1.4216e+00,  9.8359e-02, -3.2869e-02,  0.0000e+00,
         0.0000e+00,  1.1453e-02, -1.5504e-01, -6.1259e-02,  1.0941e-01,
         2.4897e-01, -4.3682e-01, -4.0812e-01,  1.0562e-01,  2.0867e-01,
        -3.8885e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([1940]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-4.7985e-01, -1.6106e+00, -5.5060e-01, -4.7226e-03,  4.3003e+00,
        -3.5303e-01,  1.3575e+00,  1.3208e+00, -9.6294e-01, -9.4089e-01,
        -3.5415e-03, -1.7267e-01,  2.3447e-01,  5.6794e-01,  2.5223e+00,
        -1.8668e-03, -2.1744e-01, -3.3228e-01,  0.0000e+00, -5.0880e-02,
        -2.8527e-01, -2.8282e-01,  2.4364e-03,  3.5003e-01,  1.5369e+00,
        -9.0415e-01, -2.9426e-01,  0.0000e+00,  9.5529e-02, -8.8314e-01,
         2.8603e-04,  2.4687e-01, -4.5384e-02,  0.0000e+00,  1.1446e+00,
        -1.0048e-02,  2.4348e+00, -2.1209e-01,  7.2558e-02,  7.3454e-01,
        -2.5444e-01, -5.1495e-01,  1.5967e+00, -3.6739e-01,  5.6767e+00,
        -5.8272e-02,  2.4333e+00,  5.6871e-01, -1.0539e+00,  1.2308e+00,
         7.9871e-01, -4.5356e-01, -1.0711e-01, -1.8662e-01,  7.8078e-01,
         2.3879e-01,  2.1691e+00, -7.9302e-02, -2.0149e+00, -1.8340e+00,
         5.3175e-02, -1.7157e+00, -1.0708e+00, -1.6445e+00,  5.1078e-02,
        -8.4687e-01, -8.4636e-01, -2.4089e-01, -9.0968e-03, -6.6790e-01,
         0.0000e+00,  0.0000e+00,  8.1978e+00, -6.6867e-01, -2.6865e-01,
         8.8454e-03, -2.2079e-01,  6.3787e-01,  6.9349e+00, -1.1685e-02,
         0.0000e+00,  2.8331e-01, -6.1461e-01,  1.0987e+00,  1.6332e+00,
        -6.1567e-02, -5.2940e-02, -2.8137e-01, -1.1726e+00,  4.7360e-01,
         1.9134e+00, -7.8598e-01, -1.7335e+00, -1.9806e+00, -2.0008e+00,
        -1.6215e+00, -1.1878e+00, -1.1509e+00,  2.4348e-01, -5.9449e-01,
        -3.1360e-01, -1.6351e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.9270e-02,  1.3996e-01,  0.0000e+00, -7.9850e-02,
        -1.3016e+00,  8.1629e-01, -8.0799e-04, -3.2869e-02,  0.0000e+00,
         0.0000e+00, -1.7570e+00,  1.4390e+00, -6.1259e-02,  1.3578e+00,
        -1.7508e-03, -4.8388e-01, -1.1590e+00, -7.4953e-02,  1.1934e-01,
         4.9949e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([1041]), tensor(0.2099))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.1414,  0.1986,  0.1728, -1.2784, -0.1442, -0.6168, -0.1266, -0.3134,
         0.2711, -0.1654, -0.7099, -0.1157, -0.4643, -0.0527,  0.0539,  0.5454,
        -0.1487,  0.1052,  0.0000,  0.4468, -0.3606, -0.2099,  0.0230,  0.0144,
        -0.0802, -0.2349, -0.5752,  0.0000,  0.4123,  0.8678,  0.4872, -0.1312,
         0.4094,  0.0000, -0.3989, -0.2029,  0.0721,  0.3417,  0.0772, -1.1731,
        -0.2581,  0.0194,  0.1417, -0.0841, -0.1514, -0.6566, -0.0554, -0.0098,
        -0.5561, -0.2960, -0.6232,  0.6637, -0.1749, -0.0577,  0.0330,  0.4444,
        -0.7661, -0.0492, -0.2734,  0.0823,  0.1064, -0.3426,  0.1596,  0.2937,
         0.2057, -0.1063,  0.0391, -0.0557,  0.7033, -0.4125,  0.0000,  0.0000,
         0.0513, -0.8156, -0.0191,  0.5723,  0.0427, -0.3448, -0.1804, -0.0102,
         0.0000,  0.3570,  0.0039, -0.1845, -0.5544, -0.0788, -0.0637, -0.3736,
        -0.1572,  0.1355, -0.5050, -1.2963,  0.1945,  0.9785,  1.5414,  1.3476,
         0.4970,  0.9783, -2.0705, -0.7350, -1.1693,  0.1734,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0678,  0.3529,  0.0000, -1.5779, -0.1659, -1.6371,
         0.1135,  0.0465,  0.0000,  0.0000,  0.0170, -0.1662, -0.0735,  0.0650,
         0.2120, -0.4261, -0.3975,  0.1463,  0.2233, -0.3880,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([4356]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([ 1.7846e+00,  1.9069e+00,  3.4361e-01, -1.9137e-01,  1.3492e+00,
         2.6575e+00, -8.9253e-01, -7.8656e-01, -4.9982e-01, -6.4854e-01,
        -5.2989e-01, -1.1458e-01,  2.3261e-01, -3.7458e-01,  1.8167e+00,
         2.3084e+00, -2.2699e-01,  3.8054e+00,  0.0000e+00,  3.2725e+00,
        -9.5187e-04, -2.0993e-01,  1.1770e-02, -2.6351e-03,  6.2052e-02,
         1.0155e+00,  2.0266e+00,  0.0000e+00, -1.3806e+00, -8.3095e-01,
        -4.6921e-01, -1.4888e-01,  4.0902e-02,  0.0000e+00,  1.2258e+00,
        -2.0736e-01,  1.9689e-01,  3.9878e-01,  4.5772e+00, -5.7555e-01,
         3.6600e-01, -5.7831e-01,  2.2737e+00, -3.6082e-01,  2.8400e+00,
        -1.0271e+00, -2.3747e-01, -1.0380e+00, -6.8909e-01,  5.0096e-02,
        -6.2317e-01, -1.0957e+00, -1.3055e-01, -5.7724e-02, -7.3486e-01,
         4.8713e-02,  1.0536e+00, -3.2655e-01,  5.9465e-01,  3.3433e+00,
         2.0045e-01,  6.5240e-01,  8.6342e-01,  5.6553e-01, -1.9344e+00,
         3.9479e-01,  1.1737e+00, -5.9419e-01, -1.2752e+00, -3.7517e-01,
         0.0000e+00,  0.0000e+00,  5.1340e-02, -6.4841e-01, -1.0715e-01,
         1.5993e+00, -7.7461e-02, -3.9745e-01,  2.2093e-01, -9.8308e-01,
         0.0000e+00,  2.2845e+00, -2.7875e-01,  2.0295e+00, -6.1026e-02,
        -4.8734e-02, -4.9927e-02, -3.6036e-01, -2.2350e-01, -1.2884e-01,
        -6.0508e-01,  3.0593e+00,  1.9446e-01, -1.6323e+00, -1.7286e+00,
        -1.5430e+00, -6.3486e-01, -1.3849e+00,  2.0114e-01, -3.2475e-01,
        -3.6099e-01,  1.8927e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6502e-02,  3.5288e-01,  0.0000e+00,  7.4865e-01,
        -1.3943e+00,  3.3312e-01, -1.9827e-02,  4.6549e-02,  0.0000e+00,
         0.0000e+00,  2.7868e+00,  5.3752e-01, -7.3545e-02,  3.3132e-01,
         1.7485e+00,  4.2340e-01, -6.2935e-02,  5.9027e-03,  4.3736e-02,
         3.4040e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3608]), tensor(3.2000e-07))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:main_restricted.py:Testing data year: 1986
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 120
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 4799
            device: cpu
            
2024-07-27 01:02:43,312	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 01:02:43,369	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 01:02:43,418	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_c118a1eed3fe8d80.zip' (1.37MiB) to Ray cluster...
2024-07-27 01:02:43,423	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_c118a1eed3fe8d80.zip'.
2024-07-27 01:02:44,754	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 01:22:58,285	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_01-02-44' in 0.2815s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 3, 'num_embeddings': 4799, 'embedding_dim': 6, 'dropout_rate': 0.53, 'lr': 0.007579479953348002, 'weight_decay': 0.0003142880890840113, 'num_epochs': 120, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.049617705833075974
INFO:model_data_nn.py:Best trial testing loss: 0.06294144895918509
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-27_01-02-40_991393_752378/artifacts/2024-07-27_01-02-44/train_fnn_2024-07-27_01-02-44/driver_artifacts/train_fnn_9b0f3_00001_1_dropout_rate=0.5300,embedding_dim=6,hidden_dim=35,lr=0.0076,num_layers=3,weight_decay=0.0003_2024-07-27_01-02-44
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 3, 'num_embeddings': 5134, 'embedding_dim': 6, 'dropout_rate': 0.53, 'lr': 0.007579479953348002, 'weight_decay': 0.0003142880890840113, 'num_epochs': 120, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/120, metrics: {'avg_train_loss': 0.05077707419903683, 'avg_test_loss': 0.09025035536174952}
INFO:model_data_nn.py:Epoch 2/120, metrics: {'avg_train_loss': 0.0506399526290359, 'avg_test_loss': 0.09141705660423373}
INFO:model_data_nn.py:Epoch 3/120, metrics: {'avg_train_loss': 0.0510826980432732, 'avg_test_loss': 0.09137757415022357}
INFO:model_data_nn.py:Epoch 4/120, metrics: {'avg_train_loss': 0.051142315497060144, 'avg_test_loss': 0.09094471551532693}
INFO:model_data_nn.py:Epoch 5/120, metrics: {'avg_train_loss': 0.05111877984433834, 'avg_test_loss': 0.09162052542542522}
INFO:model_data_nn.py:Epoch 6/120, metrics: {'avg_train_loss': 0.05151831561972993, 'avg_test_loss': 0.09149071581841704}
INFO:model_data_nn.py:Epoch 7/120, metrics: {'avg_train_loss': 0.051553713311515155, 'avg_test_loss': 0.09338893794978992}
INFO:model_data_nn.py:Epoch 8/120, metrics: {'avg_train_loss': 0.05196186009764908, 'avg_test_loss': 0.09352104771029235}
INFO:model_data_nn.py:Epoch 9/120, metrics: {'avg_train_loss': 0.05211753670776647, 'avg_test_loss': 0.09297577080027271}
INFO:model_data_nn.py:Epoch 10/120, metrics: {'avg_train_loss': 0.05219477528247923, 'avg_test_loss': 0.09280581610128597}
INFO:model_data_nn.py:Epoch 11/120, metrics: {'avg_train_loss': 0.05218342421465509, 'avg_test_loss': 0.09257028258734327}
INFO:model_data_nn.py:Epoch 12/120, metrics: {'avg_train_loss': 0.05219609930276102, 'avg_test_loss': 0.09729195205189538}
INFO:model_data_nn.py:Epoch 13/120, metrics: {'avg_train_loss': 0.052190883491291765, 'avg_test_loss': 0.09349223900343753}
INFO:model_data_nn.py:Epoch 14/120, metrics: {'avg_train_loss': 0.05218901624976997, 'avg_test_loss': 0.09296358936513234}
INFO:model_data_nn.py:Epoch 15/120, metrics: {'avg_train_loss': 0.05213680514319253, 'avg_test_loss': 0.09236708680410408}
INFO:model_data_nn.py:Epoch 16/120, metrics: {'avg_train_loss': 0.05216429893200892, 'avg_test_loss': 0.09153345590379058}
INFO:model_data_nn.py:Epoch 17/120, metrics: {'avg_train_loss': 0.052169623313516024, 'avg_test_loss': 0.09140397787305425}
INFO:model_data_nn.py:Epoch 18/120, metrics: {'avg_train_loss': 0.0521791727522329, 'avg_test_loss': 0.09264928170190263}
INFO:model_data_nn.py:Epoch 19/120, metrics: {'avg_train_loss': 0.05216592681660716, 'avg_test_loss': 0.09194233119996469}
INFO:model_data_nn.py:Epoch 20/120, metrics: {'avg_train_loss': 0.0522008995041399, 'avg_test_loss': 0.09626860381104052}
INFO:model_data_nn.py:Epoch 21/120, metrics: {'avg_train_loss': 0.05215783002453723, 'avg_test_loss': 0.09270836575888097}
INFO:model_data_nn.py:Epoch 22/120, metrics: {'avg_train_loss': 0.05218880102038383, 'avg_test_loss': 0.0943405036657986}
INFO:model_data_nn.py:Epoch 23/120, metrics: {'avg_train_loss': 0.052184883930483865, 'avg_test_loss': 0.09465637145673528}
INFO:model_data_nn.py:Epoch 24/120, metrics: {'avg_train_loss': 0.0521533943073351, 'avg_test_loss': 0.09236050537443023}
INFO:model_data_nn.py:Epoch 25/120, metrics: {'avg_train_loss': 0.05216504910014688, 'avg_test_loss': 0.0930169676645745}
INFO:model_data_nn.py:Epoch 26/120, metrics: {'avg_train_loss': 0.05218417214798844, 'avg_test_loss': 0.09190288299358129}
INFO:model_data_nn.py:Epoch 27/120, metrics: {'avg_train_loss': 0.05220502824744298, 'avg_test_loss': 0.09279797625133157}
INFO:model_data_nn.py:Epoch 28/120, metrics: {'avg_train_loss': 0.05224139700081968, 'avg_test_loss': 0.09284749854074306}
INFO:model_data_nn.py:Epoch 29/120, metrics: {'avg_train_loss': 0.05215420868129484, 'avg_test_loss': 0.09567256093009555}
INFO:model_data_nn.py:Epoch 30/120, metrics: {'avg_train_loss': 0.05216148183062037, 'avg_test_loss': 0.09299683086221897}
INFO:model_data_nn.py:Epoch 31/120, metrics: {'avg_train_loss': 0.052167725698312836, 'avg_test_loss': 0.09200805534624315}
INFO:model_data_nn.py:Early stopping at epoch 31
INFO:main_restricted.py:Making prediction for data in year: 1987
INFO:main_restricted.py:Prediction data shape: (15222,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:350: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1987: 0.3031646414472665
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  1.522200e+04  15222.000000
mean  -7.633223e-03      0.031614
std    3.006234e-01      0.000000
min   -9.431818e-01      0.031614
25%   -1.803514e-01      0.031614
50%   -7.049888e-07      0.031614
75%    1.343371e-01      0.031614
max    5.466666e+00      0.031614
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:transform_data_nn.py:Train_data: (80616, 161)

INFO:transform_data_nn.py:Test data years: [1987]
INFO:transform_data_nn.py:Test_data: (15222, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:transform_data_nn.py:Retrain_data: (95838, 161)

INFO:transform_data_nn.py:Prediction data years: [1988]
INFO:transform_data_nn.py:Prediction_data: (16210, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([80616, 138])
            y_train_tf: torch.Size([80616])

            x_test_tf: torch.Size([15222, 138])
            y_test_tf: torch.Size([15222])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([95838, 138])
            y_retrain_tf: torch.Size([95838])

            x_prediction_tf: torch.Size([16210, 138])
            y_prediction_tf: torch.Size([16210])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-0.1414,  0.1986,  0.1728, -1.2784, -0.1442, -0.6168, -0.1266, -0.3134,
         0.2711, -0.1654, -0.7099, -0.1157, -0.4643, -0.0527,  0.0539,  0.5454,
        -0.1487,  0.1052,  0.0000,  0.4468, -0.3606, -0.2099,  0.0230,  0.0144,
        -0.0802, -0.2349, -0.5752,  0.0000,  0.4123,  0.8678,  0.4872, -0.1312,
         0.4094,  0.0000, -0.3989, -0.2029,  0.0721,  0.3417,  0.0772, -1.1731,
        -0.2581,  0.0194,  0.1417, -0.0841, -0.1514, -0.6566, -0.0554, -0.0098,
        -0.5561, -0.2960, -0.6232,  0.6637, -0.1749, -0.0577,  0.0330,  0.4444,
        -0.7661, -0.0492, -0.2734,  0.0823,  0.1064, -0.3426,  0.1596,  0.2937,
         0.2057, -0.1063,  0.0391, -0.0557,  0.7033, -0.4125,  0.0000,  0.0000,
         0.0513, -0.8156, -0.0191,  0.5723,  0.0427, -0.3448, -0.1804, -0.0102,
         0.0000,  0.3570,  0.0039, -0.1845, -0.5544, -0.0788, -0.0637, -0.3736,
        -0.1572,  0.1355, -0.5050, -1.2963,  0.1945,  0.9785,  1.5414,  1.3476,
         0.4970,  0.9783, -2.0705, -0.7350, -1.1693,  0.1734,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0678,  0.3529,  0.0000, -1.5779, -0.1659, -1.6371,
         0.1135,  0.0465,  0.0000,  0.0000,  0.0170, -0.1662, -0.0735,  0.0650,
         0.2120, -0.4261, -0.3975,  0.1463,  0.2233, -0.3880,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([4356]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([ 1.7846e+00,  1.9069e+00,  3.4361e-01, -1.9137e-01,  1.3492e+00,
         2.6575e+00, -8.9253e-01, -7.8656e-01, -4.9982e-01, -6.4854e-01,
        -5.2989e-01, -1.1458e-01,  2.3261e-01, -3.7458e-01,  1.8167e+00,
         2.3084e+00, -2.2699e-01,  3.8054e+00,  0.0000e+00,  3.2725e+00,
        -9.5187e-04, -2.0993e-01,  1.1770e-02, -2.6351e-03,  6.2052e-02,
         1.0155e+00,  2.0266e+00,  0.0000e+00, -1.3806e+00, -8.3095e-01,
        -4.6921e-01, -1.4888e-01,  4.0902e-02,  0.0000e+00,  1.2258e+00,
        -2.0736e-01,  1.9689e-01,  3.9878e-01,  4.5772e+00, -5.7555e-01,
         3.6600e-01, -5.7831e-01,  2.2737e+00, -3.6082e-01,  2.8400e+00,
        -1.0271e+00, -2.3747e-01, -1.0380e+00, -6.8909e-01,  5.0096e-02,
        -6.2317e-01, -1.0957e+00, -1.3055e-01, -5.7724e-02, -7.3486e-01,
         4.8713e-02,  1.0536e+00, -3.2655e-01,  5.9465e-01,  3.3433e+00,
         2.0045e-01,  6.5240e-01,  8.6342e-01,  5.6553e-01, -1.9344e+00,
         3.9479e-01,  1.1737e+00, -5.9419e-01, -1.2752e+00, -3.7517e-01,
         0.0000e+00,  0.0000e+00,  5.1340e-02, -6.4841e-01, -1.0715e-01,
         1.5993e+00, -7.7461e-02, -3.9745e-01,  2.2093e-01, -9.8308e-01,
         0.0000e+00,  2.2845e+00, -2.7875e-01,  2.0295e+00, -6.1026e-02,
        -4.8734e-02, -4.9927e-02, -3.6036e-01, -2.2350e-01, -1.2884e-01,
        -6.0508e-01,  3.0593e+00,  1.9446e-01, -1.6323e+00, -1.7286e+00,
        -1.5430e+00, -6.3486e-01, -1.3849e+00,  2.0114e-01, -3.2475e-01,
        -3.6099e-01,  1.8927e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6502e-02,  3.5288e-01,  0.0000e+00,  7.4865e-01,
        -1.3943e+00,  3.3312e-01, -1.9827e-02,  4.6549e-02,  0.0000e+00,
         0.0000e+00,  2.7868e+00,  5.3752e-01, -7.3545e-02,  3.3132e-01,
         1.7485e+00,  4.2340e-01, -6.2935e-02,  5.9027e-03,  4.3736e-02,
         3.4040e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3608]), tensor(3.2000e-07))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.6749e-01,  1.8039e-01,  1.7439e-01, -1.2934e+00, -1.5217e-01,
        -6.2532e-01, -1.4105e-01, -3.2622e-01,  3.3397e-01, -1.7092e-01,
        -7.1138e-01, -7.9930e-02, -4.8715e-01, -2.8729e-02,  5.0620e-02,
         5.3680e-01, -1.5086e-01,  1.3707e-01,  0.0000e+00,  4.4747e-01,
        -3.6798e-01, -2.7737e-02,  1.7979e-02,  3.1756e-03, -6.1519e-02,
        -2.4363e-01, -5.7138e-01,  0.0000e+00,  3.8881e-01,  9.3932e-01,
         4.8111e-01, -1.3014e-01,  4.3260e-01,  0.0000e+00, -3.8304e-01,
        -1.9981e-01,  7.3661e-02,  3.5875e-01,  5.9394e-02, -1.1663e+00,
        -2.6389e-01,  6.3167e-02,  1.5538e-01, -6.6349e-02, -1.6337e-01,
        -6.5926e-01, -3.2849e-02, -9.8768e-03, -5.4961e-01, -2.9247e-01,
        -6.2524e-01,  6.5618e-01, -1.6367e-01, -1.3712e-03,  3.0379e-02,
         4.4666e-01, -7.6340e-01, -1.8507e-02, -2.7156e-01,  4.5804e-02,
         1.0842e-01, -3.4037e-01,  1.5983e-01,  2.9087e-01,  1.9905e-01,
        -1.1055e-01,  1.8707e-02, -6.5066e-02,  7.2838e-01, -4.1396e-01,
         0.0000e+00,  0.0000e+00,  2.9079e-03, -8.1796e-01,  1.3836e-02,
         5.9724e-01,  4.4363e-02, -3.4442e-01, -1.8141e-01, -1.1348e-02,
         0.0000e+00,  3.2837e-01,  4.7142e-02, -2.1021e-01, -5.5949e-01,
        -8.4724e-02, -6.9207e-02, -3.6622e-01, -1.4938e-01,  1.0129e-01,
        -5.1817e-01, -1.3017e+00,  9.1096e-02,  1.0397e+00,  1.5247e+00,
         1.4285e+00,  5.4615e-01,  1.1460e+00, -2.2843e+00, -6.0600e-01,
        -1.2501e+00,  1.5397e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.2503e-02,  7.6798e-02,  0.0000e+00, -1.7350e+00,
         2.3586e-02, -1.8329e+00,  1.2462e-01,  8.6240e-02,  0.0000e+00,
         0.0000e+00,  2.4629e-02, -1.7408e-01, -7.1432e-02,  3.1925e-02,
         2.0089e-01, -4.1318e-01, -3.9079e-01,  1.7856e-01,  2.3805e-01,
        -3.9978e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4852]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-6.8700e-03, -1.3906e-03, -6.2760e-01, -8.1075e-01, -6.9975e-01,
        -1.2774e-01, -1.8530e+00, -1.0250e+00, -1.8833e-02,  3.1154e-04,
        -3.5055e-01, -2.2122e-01,  5.2339e-02, -5.7797e-03,  3.0203e-02,
        -1.4377e+00, -2.2830e-01, -1.2641e-01,  0.0000e+00, -2.4754e-01,
         3.5335e-01, -2.7737e-02,  1.3908e-03,  3.7832e-02,  8.8959e-03,
        -6.3207e-01, -7.4060e-01,  0.0000e+00, -7.5916e-01,  2.7774e-02,
        -9.9067e-01, -3.3856e-01,  4.6256e-02,  0.0000e+00, -2.4031e+00,
         9.2312e-03, -6.2428e-01, -5.2958e-01, -2.9028e-01, -7.8854e-01,
         7.0285e-01, -9.9150e-01, -5.3299e-01, -1.9134e-01,  1.1251e-02,
        -1.0866e-01, -5.3210e-01, -2.8988e-01, -2.8152e-01, -6.9593e-02,
         1.1890e-01, -1.4763e+00, -4.8603e-01, -1.3712e-03, -7.4046e-01,
        -1.6129e+00, -1.0878e+00, -3.7510e-01, -5.6659e-02,  5.8481e-03,
        -2.8530e+00, -5.3244e-02, -9.0868e-02, -5.0486e+00, -4.3985e-03,
        -3.9025e-01, -8.4175e-03,  1.7970e+00, -5.7971e-01, -3.6225e-01,
         0.0000e+00,  0.0000e+00,  2.9079e-03,  1.4063e-01, -1.8985e-01,
        -2.2815e-01, -1.4983e-01,  3.2499e+00, -2.0335e-01, -1.1348e-02,
         0.0000e+00, -9.9196e-01, -3.1309e-02,  2.4329e+00,  3.8119e+00,
        -7.3119e-02, -6.3627e-02, -2.3311e-01,  6.0460e-01, -2.8651e-01,
         7.7305e-01,  5.7043e-01,  9.1096e-02, -7.2100e-01, -5.6034e-01,
        -1.0275e+00,  6.9980e-01, -1.0601e+00,  7.4176e-01, -9.7179e-01,
         5.6117e+00, -3.1374e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.0423e-02,  7.6798e-02,  0.0000e+00, -1.1967e+00,
        -1.4312e+00,  1.0112e-01, -1.5572e-02,  5.0367e+00,  0.0000e+00,
         0.0000e+00, -1.4247e+00, -2.4009e-01, -7.1432e-02,  1.6151e+00,
         5.1085e-03,  7.5954e-01, -3.9705e-01, -7.9781e-02, -1.5664e-02,
         1.0374e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2888]), tensor(0.0613))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:main_restricted.py:Testing data year: 1987
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 120
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 5134
            device: cpu
            
2024-07-27 01:36:56,652	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 01:36:56,697	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 01:36:56,733	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_573cf030409f7e88.zip' (1.38MiB) to Ray cluster...
2024-07-27 01:36:56,739	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_573cf030409f7e88.zip'.
2024-07-27 01:36:57,973	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 01:45:11,100	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_01-36-57' in 0.2298s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 5134, 'embedding_dim': 1, 'dropout_rate': 0.19, 'lr': 0.0005282284718122494, 'weight_decay': 3.915648958243003e-05, 'num_epochs': 120, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03855977329565951
INFO:model_data_nn.py:Best trial testing loss: 0.07061104272382662
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-27_01-36-54_408947_752378/artifacts/2024-07-27_01-36-57/train_fnn_2024-07-27_01-36-57/driver_artifacts/train_fnn_62df8_00022_22_dropout_rate=0.1900,embedding_dim=1,hidden_dim=45,lr=0.0005,num_layers=1,weight_decay=0.0000_2024-07-27_01-36-58
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 5713, 'embedding_dim': 1, 'dropout_rate': 0.19, 'lr': 0.0005282284718122494, 'weight_decay': 3.915648958243003e-05, 'num_epochs': 120, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/120, metrics: {'avg_train_loss': 0.05148182710156914, 'avg_test_loss': 0.06528265419539203}
INFO:model_data_nn.py:Epoch 2/120, metrics: {'avg_train_loss': 0.047259107566685825, 'avg_test_loss': 0.09844051768977555}
INFO:model_data_nn.py:Epoch 3/120, metrics: {'avg_train_loss': 0.0459722960237196, 'avg_test_loss': 0.11033468482431752}
INFO:model_data_nn.py:Epoch 4/120, metrics: {'avg_train_loss': 0.04510812406305329, 'avg_test_loss': 0.11168322313569588}
INFO:model_data_nn.py:Epoch 5/120, metrics: {'avg_train_loss': 0.04448814183000929, 'avg_test_loss': 0.11029586246644957}
INFO:model_data_nn.py:Epoch 6/120, metrics: {'avg_train_loss': 0.04421178020244598, 'avg_test_loss': 0.13139529547358347}
INFO:model_data_nn.py:Epoch 7/120, metrics: {'avg_train_loss': 0.043822095348796684, 'avg_test_loss': 0.1404296954876984}
INFO:model_data_nn.py:Epoch 8/120, metrics: {'avg_train_loss': 0.04359707395127898, 'avg_test_loss': 0.1295003420333479}
INFO:model_data_nn.py:Epoch 9/120, metrics: {'avg_train_loss': 0.043405086865869406, 'avg_test_loss': 0.1221059721617186}
INFO:model_data_nn.py:Epoch 10/120, metrics: {'avg_train_loss': 0.04334010312470525, 'avg_test_loss': 0.13735388969557996}
INFO:model_data_nn.py:Epoch 11/120, metrics: {'avg_train_loss': 0.04322379563868245, 'avg_test_loss': 0.1280796309378314}
INFO:model_data_nn.py:Epoch 12/120, metrics: {'avg_train_loss': 0.04311834674683059, 'avg_test_loss': 0.13019580178741638}
INFO:model_data_nn.py:Epoch 13/120, metrics: {'avg_train_loss': 0.04301506212767904, 'avg_test_loss': 0.12424704921110377}
INFO:model_data_nn.py:Epoch 14/120, metrics: {'avg_train_loss': 0.04298440377556024, 'avg_test_loss': 0.133767810569345}
INFO:model_data_nn.py:Epoch 15/120, metrics: {'avg_train_loss': 0.04291536305224109, 'avg_test_loss': 0.12664819141037953}
INFO:model_data_nn.py:Epoch 16/120, metrics: {'avg_train_loss': 0.04266049032828744, 'avg_test_loss': 0.12725158258023464}
INFO:model_data_nn.py:Epoch 17/120, metrics: {'avg_train_loss': 0.042815767714632476, 'avg_test_loss': 0.14853543062608035}
INFO:model_data_nn.py:Epoch 18/120, metrics: {'avg_train_loss': 0.04293004710675032, 'avg_test_loss': 0.11725552259582504}
INFO:model_data_nn.py:Epoch 19/120, metrics: {'avg_train_loss': 0.042665024032390274, 'avg_test_loss': 0.11840175398619923}
INFO:model_data_nn.py:Epoch 20/120, metrics: {'avg_train_loss': 0.04267503616737454, 'avg_test_loss': 0.11707774373928648}
INFO:model_data_nn.py:Epoch 21/120, metrics: {'avg_train_loss': 0.04256540991098485, 'avg_test_loss': 0.13420124519873536}
INFO:model_data_nn.py:Epoch 22/120, metrics: {'avg_train_loss': 0.042502788102288476, 'avg_test_loss': 0.1300618803308619}
INFO:model_data_nn.py:Epoch 23/120, metrics: {'avg_train_loss': 0.04260074430221508, 'avg_test_loss': 0.12841768278437254}
INFO:model_data_nn.py:Epoch 24/120, metrics: {'avg_train_loss': 0.0425247892376676, 'avg_test_loss': 0.13829362535705933}
INFO:model_data_nn.py:Epoch 25/120, metrics: {'avg_train_loss': 0.04238598664012894, 'avg_test_loss': 0.14566119206257355}
INFO:model_data_nn.py:Epoch 26/120, metrics: {'avg_train_loss': 0.04252094067291097, 'avg_test_loss': 0.12746355185906091}
INFO:model_data_nn.py:Epoch 27/120, metrics: {'avg_train_loss': 0.04246912114259994, 'avg_test_loss': 0.11219406187813545}
INFO:model_data_nn.py:Epoch 28/120, metrics: {'avg_train_loss': 0.042516513816539654, 'avg_test_loss': 0.15144086550899158}
INFO:model_data_nn.py:Epoch 29/120, metrics: {'avg_train_loss': 0.042537772454451984, 'avg_test_loss': 0.1295169116120925}
INFO:model_data_nn.py:Epoch 30/120, metrics: {'avg_train_loss': 0.04241625457747104, 'avg_test_loss': 0.12521273779629544}
INFO:model_data_nn.py:Epoch 31/120, metrics: {'avg_train_loss': 0.04246168568923149, 'avg_test_loss': 0.12512254850163732}
INFO:model_data_nn.py:Early stopping at epoch 31
INFO:main_restricted.py:Making prediction for data in year: 1988
INFO:main_restricted.py:Prediction data shape: (16210,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:350: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1988: 0.3538180779200899
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  16210.000000  16210.000000
mean       0.049695     -0.177238
std        0.249702      0.097032
min       -0.901408     -1.156231
25%       -0.072601     -0.238777
50%        0.019064     -0.168441
75%        0.142858     -0.105625
max        5.000002      0.156142
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:transform_data_nn.py:Train_data: (95838, 161)

INFO:transform_data_nn.py:Test data years: [1988]
INFO:transform_data_nn.py:Test_data: (16210, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:transform_data_nn.py:Retrain_data: (112048, 161)

INFO:transform_data_nn.py:Prediction data years: [1989]
INFO:transform_data_nn.py:Prediction_data: (16366, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([95838, 138])
            y_train_tf: torch.Size([95838])

            x_test_tf: torch.Size([16210, 138])
            y_test_tf: torch.Size([16210])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([112048, 138])
            y_retrain_tf: torch.Size([112048])

            x_prediction_tf: torch.Size([16366, 138])
            y_prediction_tf: torch.Size([16366])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.6749e-01,  1.8039e-01,  1.7439e-01, -1.2934e+00, -1.5217e-01,
        -6.2532e-01, -1.4105e-01, -3.2622e-01,  3.3397e-01, -1.7092e-01,
        -7.1138e-01, -7.9930e-02, -4.8715e-01, -2.8729e-02,  5.0620e-02,
         5.3680e-01, -1.5086e-01,  1.3707e-01,  0.0000e+00,  4.4747e-01,
        -3.6798e-01, -2.7737e-02,  1.7979e-02,  3.1756e-03, -6.1519e-02,
        -2.4363e-01, -5.7138e-01,  0.0000e+00,  3.8881e-01,  9.3932e-01,
         4.8111e-01, -1.3014e-01,  4.3260e-01,  0.0000e+00, -3.8304e-01,
        -1.9981e-01,  7.3661e-02,  3.5875e-01,  5.9394e-02, -1.1663e+00,
        -2.6389e-01,  6.3167e-02,  1.5538e-01, -6.6349e-02, -1.6337e-01,
        -6.5926e-01, -3.2849e-02, -9.8768e-03, -5.4961e-01, -2.9247e-01,
        -6.2524e-01,  6.5618e-01, -1.6367e-01, -1.3712e-03,  3.0379e-02,
         4.4666e-01, -7.6340e-01, -1.8507e-02, -2.7156e-01,  4.5804e-02,
         1.0842e-01, -3.4037e-01,  1.5983e-01,  2.9087e-01,  1.9905e-01,
        -1.1055e-01,  1.8707e-02, -6.5066e-02,  7.2838e-01, -4.1396e-01,
         0.0000e+00,  0.0000e+00,  2.9079e-03, -8.1796e-01,  1.3836e-02,
         5.9724e-01,  4.4363e-02, -3.4442e-01, -1.8141e-01, -1.1348e-02,
         0.0000e+00,  3.2837e-01,  4.7142e-02, -2.1021e-01, -5.5949e-01,
        -8.4724e-02, -6.9207e-02, -3.6622e-01, -1.4938e-01,  1.0129e-01,
        -5.1817e-01, -1.3017e+00,  9.1096e-02,  1.0397e+00,  1.5247e+00,
         1.4285e+00,  5.4615e-01,  1.1460e+00, -2.2843e+00, -6.0600e-01,
        -1.2501e+00,  1.5397e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.2503e-02,  7.6798e-02,  0.0000e+00, -1.7350e+00,
         2.3586e-02, -1.8329e+00,  1.2462e-01,  8.6240e-02,  0.0000e+00,
         0.0000e+00,  2.4629e-02, -1.7408e-01, -7.1432e-02,  3.1925e-02,
         2.0089e-01, -4.1318e-01, -3.9079e-01,  1.7856e-01,  2.3805e-01,
        -3.9978e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4852]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-6.8700e-03, -1.3906e-03, -6.2760e-01, -8.1075e-01, -6.9975e-01,
        -1.2774e-01, -1.8530e+00, -1.0250e+00, -1.8833e-02,  3.1154e-04,
        -3.5055e-01, -2.2122e-01,  5.2339e-02, -5.7797e-03,  3.0203e-02,
        -1.4377e+00, -2.2830e-01, -1.2641e-01,  0.0000e+00, -2.4754e-01,
         3.5335e-01, -2.7737e-02,  1.3908e-03,  3.7832e-02,  8.8959e-03,
        -6.3207e-01, -7.4060e-01,  0.0000e+00, -7.5916e-01,  2.7774e-02,
        -9.9067e-01, -3.3856e-01,  4.6256e-02,  0.0000e+00, -2.4031e+00,
         9.2312e-03, -6.2428e-01, -5.2958e-01, -2.9028e-01, -7.8854e-01,
         7.0285e-01, -9.9150e-01, -5.3299e-01, -1.9134e-01,  1.1251e-02,
        -1.0866e-01, -5.3210e-01, -2.8988e-01, -2.8152e-01, -6.9593e-02,
         1.1890e-01, -1.4763e+00, -4.8603e-01, -1.3712e-03, -7.4046e-01,
        -1.6129e+00, -1.0878e+00, -3.7510e-01, -5.6659e-02,  5.8481e-03,
        -2.8530e+00, -5.3244e-02, -9.0868e-02, -5.0486e+00, -4.3985e-03,
        -3.9025e-01, -8.4175e-03,  1.7970e+00, -5.7971e-01, -3.6225e-01,
         0.0000e+00,  0.0000e+00,  2.9079e-03,  1.4063e-01, -1.8985e-01,
        -2.2815e-01, -1.4983e-01,  3.2499e+00, -2.0335e-01, -1.1348e-02,
         0.0000e+00, -9.9196e-01, -3.1309e-02,  2.4329e+00,  3.8119e+00,
        -7.3119e-02, -6.3627e-02, -2.3311e-01,  6.0460e-01, -2.8651e-01,
         7.7305e-01,  5.7043e-01,  9.1096e-02, -7.2100e-01, -5.6034e-01,
        -1.0275e+00,  6.9980e-01, -1.0601e+00,  7.4176e-01, -9.7179e-01,
         5.6117e+00, -3.1374e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.0423e-02,  7.6798e-02,  0.0000e+00, -1.1967e+00,
        -1.4312e+00,  1.0112e-01, -1.5572e-02,  5.0367e+00,  0.0000e+00,
         0.0000e+00, -1.4247e+00, -2.4009e-01, -7.1432e-02,  1.6151e+00,
         5.1085e-03,  7.5954e-01, -3.9705e-01, -7.9781e-02, -1.5664e-02,
         1.0374e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2888]), tensor(0.0613))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-2.0368e-01,  1.4613e-01,  1.6670e-01, -1.2996e+00, -1.5581e-01,
        -6.3490e-01, -1.5167e-01, -3.3234e-01,  3.4130e-01, -1.6509e-01,
        -7.1113e-01, -3.0598e-02, -4.9210e-01,  1.7698e-02,  2.7621e-02,
         5.2354e-01, -1.4034e-01,  1.7132e-01,  0.0000e+00,  4.3357e-01,
        -3.6155e-01,  7.5280e-02,  1.7328e-02,  8.9085e-03, -6.4428e-02,
        -2.5203e-01, -5.6494e-01,  0.0000e+00,  4.0549e-01,  9.9060e-01,
         4.7090e-01, -1.2756e-01,  4.3668e-01,  0.0000e+00, -3.7373e-01,
        -1.9599e-01,  6.2056e-02,  3.9172e-01,  3.1288e-02, -1.1685e+00,
        -2.7627e-01,  2.4020e-01,  1.8337e-01, -6.8351e-02, -1.7270e-01,
        -6.6981e-01,  7.0629e-02, -5.5404e-02, -5.4842e-01, -2.0600e-01,
        -6.1664e-01,  6.6804e-01, -1.6028e-01,  2.4212e-03,  2.3795e-02,
         4.4623e-01, -7.5902e-01, -7.9499e-06, -2.6507e-01,  1.4397e-02,
         1.1498e-01, -3.3111e-01,  1.5373e-01,  2.8344e-01,  1.5654e-01,
        -1.1914e-01, -4.6283e-03, -7.3628e-02,  7.4786e-01, -4.1645e-01,
         0.0000e+00,  0.0000e+00, -1.9676e-01, -8.1574e-01,  3.7799e-02,
         5.7971e-01,  4.3629e-02, -3.4559e-01, -1.8308e-01, -4.2580e-03,
         0.0000e+00,  2.7307e-01,  5.3735e-02, -2.4523e-01, -5.5063e-01,
        -9.1112e-02, -7.4417e-02, -3.6511e-01, -1.3978e-01,  1.0272e-01,
        -5.1587e-01, -1.2930e+00,  3.7267e-02,  1.1955e+00,  1.6803e+00,
         1.5826e+00,  5.7628e-01,  1.3009e+00, -2.4806e+00, -4.5262e-01,
        -1.0432e+00,  1.1783e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.2399e-02,  2.5983e-01,  0.0000e+00, -1.4926e+00,
         2.5113e-01, -2.0098e+00,  1.3238e-01,  2.3763e-02,  0.0000e+00,
         0.0000e+00,  2.7788e-02, -1.7916e-01,  1.6315e-02,  6.6375e-03,
         1.8096e-01, -4.1411e-01, -3.8277e-01,  1.9860e-01,  2.4497e-01,
        -3.9885e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5373]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-1.0328e-02, -4.5945e-03, -6.1175e-01, -4.2919e-01, -2.9979e-01,
        -5.8820e-02, -1.9398e+00, -1.0548e+00, -4.8105e-02,  9.2327e-02,
        -1.9427e-02,  1.6832e-02, -3.9303e-02, -1.2090e-02,  3.2950e-02,
         3.7676e-01, -2.2029e-01, -4.9129e-01,  0.0000e+00,  5.6969e-03,
        -8.4695e-02,  7.5280e-02,  3.7865e-02,  9.6094e-01, -7.9298e-03,
        -4.5620e-03, -7.2574e-01,  0.0000e+00, -1.4182e+00,  3.7398e-02,
         4.2706e-01, -1.7737e-01,  2.7372e-01,  0.0000e+00,  1.7543e-03,
        -6.5350e-01,  7.9022e-03, -5.5227e-01, -8.4291e-01, -7.9602e-01,
         8.6959e-01,  7.0136e-02,  1.2240e-02,  2.1631e-02, -3.8938e-03,
         3.6990e-01,  6.9289e-02, -2.2570e-01, -4.2325e-01,  3.5530e-02,
         8.9260e-01, -1.3853e+00, -5.1862e-01, -2.5414e+00, -7.4346e-01,
         1.2464e-02, -1.0845e+00,  6.9339e-01,  7.3179e-03, -4.0037e-01,
        -5.0445e-03,  7.0648e-03,  7.1479e-03,  9.0722e-03, -1.6392e-02,
        -3.6987e-04, -9.4731e-03,  1.7388e+00,  1.3989e+00, -9.5058e-03,
         0.0000e+00,  0.0000e+00, -1.9676e-01,  6.6468e-01,  1.7143e-02,
        -8.8511e-02,  3.6591e-04, -1.2622e-03,  7.1653e-04, -4.2580e-03,
         0.0000e+00, -3.3035e-01, -6.4811e-02, -4.3878e-01, -5.6962e-01,
        -7.8317e-02, -6.8695e-02,  2.3996e-02, -1.0220e-04, -9.2791e-02,
        -6.5617e-01,  6.2750e-01,  3.7267e-02, -6.8854e-01,  8.3982e-02,
        -1.0567e+00, -1.3036e+00, -1.2722e-01, -6.6624e-01, -1.0806e+00,
        -9.2166e-01, -6.2909e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0426e-02,  2.5983e-01,  0.0000e+00, -1.3044e+00,
        -1.2224e+00,  4.1615e-01,  6.2709e-02,  2.3763e-02,  0.0000e+00,
         0.0000e+00,  1.2651e-02, -2.0436e-01,  1.6315e-02, -2.0294e-02,
        -8.1752e-04,  1.9352e-03, -2.3160e-02,  2.4850e-01,  1.9696e-01,
         1.4419e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2823]), tensor(0.0776))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:main_restricted.py:Testing data year: 1988
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 120
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 5713
            device: cpu
            
2024-07-27 01:59:48,212	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 01:59:48,252	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 01:59:48,287	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_573cf030409f7e88.zip' (1.38MiB) to Ray cluster...
2024-07-27 01:59:48,291	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_573cf030409f7e88.zip'.
2024-07-27 01:59:49,541	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 02:26:40,650	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_01-59-49' in 0.2740s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 165, 'num_layers': 5, 'num_embeddings': 5713, 'embedding_dim': 3, 'dropout_rate': 0.33, 'lr': 2.0016356344817164e-06, 'weight_decay': 8.262111618519667e-06, 'num_epochs': 120, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.0574519807625195
INFO:model_data_nn.py:Best trial testing loss: 0.06243757361957631
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-27_01-59-46_000072_752378/artifacts/2024-07-27_01-59-49/train_fnn_2024-07-27_01-59-49/driver_artifacts/train_fnn_94642_00038_38_dropout_rate=0.3300,embedding_dim=3,hidden_dim=165,lr=0.0000,num_layers=5,weight_decay=0.0000_2024-07-27_01-59-49
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 165, 'num_layers': 5, 'num_embeddings': 6323, 'embedding_dim': 3, 'dropout_rate': 0.33, 'lr': 2.0016356344817164e-06, 'weight_decay': 8.262111618519667e-06, 'num_epochs': 120, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/120, metrics: {'avg_train_loss': 0.06752618547818325, 'avg_test_loss': 0.0638499286287697}
INFO:model_data_nn.py:Epoch 2/120, metrics: {'avg_train_loss': 0.06536128516253116, 'avg_test_loss': 0.06355425805304549}
INFO:model_data_nn.py:Epoch 3/120, metrics: {'avg_train_loss': 0.06404556570865048, 'avg_test_loss': 0.0634031016179506}
INFO:model_data_nn.py:Epoch 4/120, metrics: {'avg_train_loss': 0.06312496894209947, 'avg_test_loss': 0.0633146771324391}
INFO:model_data_nn.py:Epoch 5/120, metrics: {'avg_train_loss': 0.0625095549438453, 'avg_test_loss': 0.06327144000897533}
INFO:model_data_nn.py:Epoch 6/120, metrics: {'avg_train_loss': 0.06188064084538838, 'avg_test_loss': 0.06316127593709098}
INFO:model_data_nn.py:Epoch 7/120, metrics: {'avg_train_loss': 0.06148837789944211, 'avg_test_loss': 0.06314726162236184}
INFO:model_data_nn.py:Epoch 8/120, metrics: {'avg_train_loss': 0.06108548305769143, 'avg_test_loss': 0.06311168095271569}
INFO:model_data_nn.py:Epoch 9/120, metrics: {'avg_train_loss': 0.06064030179527319, 'avg_test_loss': 0.06305663460079813}
INFO:model_data_nn.py:Epoch 10/120, metrics: {'avg_train_loss': 0.06052626643610692, 'avg_test_loss': 0.06309620197680488}
INFO:model_data_nn.py:Epoch 11/120, metrics: {'avg_train_loss': 0.06018526055693184, 'avg_test_loss': 0.06305809136028984}
INFO:model_data_nn.py:Epoch 12/120, metrics: {'avg_train_loss': 0.060088421569138274, 'avg_test_loss': 0.0630569095719693}
INFO:model_data_nn.py:Epoch 13/120, metrics: {'avg_train_loss': 0.05986134492276797, 'avg_test_loss': 0.06307505362201482}
INFO:model_data_nn.py:Epoch 14/120, metrics: {'avg_train_loss': 0.059776751778228394, 'avg_test_loss': 0.0630155713406566}
INFO:model_data_nn.py:Epoch 15/120, metrics: {'avg_train_loss': 0.05948609640813304, 'avg_test_loss': 0.06304070269470685}
INFO:model_data_nn.py:Epoch 16/120, metrics: {'avg_train_loss': 0.05950544289643554, 'avg_test_loss': 0.06301188568068028}
INFO:model_data_nn.py:Epoch 17/120, metrics: {'avg_train_loss': 0.05932160649956047, 'avg_test_loss': 0.06297868109140836}
INFO:model_data_nn.py:Epoch 18/120, metrics: {'avg_train_loss': 0.059277275314970505, 'avg_test_loss': 0.06301051324953733}
INFO:model_data_nn.py:Epoch 19/120, metrics: {'avg_train_loss': 0.05915736072382404, 'avg_test_loss': 0.0629480291991058}
INFO:model_data_nn.py:Epoch 20/120, metrics: {'avg_train_loss': 0.059120429545451596, 'avg_test_loss': 0.06295700921509706}
INFO:model_data_nn.py:Epoch 21/120, metrics: {'avg_train_loss': 0.059010003034402, 'avg_test_loss': 0.06295839233280276}
INFO:model_data_nn.py:Epoch 22/120, metrics: {'avg_train_loss': 0.0589399996760388, 'avg_test_loss': 0.06301169745347579}
INFO:model_data_nn.py:Epoch 23/120, metrics: {'avg_train_loss': 0.05883748328360037, 'avg_test_loss': 0.06294131250069768}
INFO:model_data_nn.py:Epoch 24/120, metrics: {'avg_train_loss': 0.05876734876512698, 'avg_test_loss': 0.0629511215047387}
INFO:model_data_nn.py:Epoch 25/120, metrics: {'avg_train_loss': 0.05874396659149818, 'avg_test_loss': 0.06292296398351027}
INFO:model_data_nn.py:Epoch 26/120, metrics: {'avg_train_loss': 0.058667429860070695, 'avg_test_loss': 0.0628731415636139}
INFO:model_data_nn.py:Epoch 27/120, metrics: {'avg_train_loss': 0.058586269235722445, 'avg_test_loss': 0.06291776335092436}
INFO:model_data_nn.py:Epoch 28/120, metrics: {'avg_train_loss': 0.05852580135411608, 'avg_test_loss': 0.062900789997002}
INFO:model_data_nn.py:Epoch 29/120, metrics: {'avg_train_loss': 0.058401184613688255, 'avg_test_loss': 0.06288702303936589}
INFO:model_data_nn.py:Epoch 30/120, metrics: {'avg_train_loss': 0.05837316287634655, 'avg_test_loss': 0.06288135466820677}
INFO:model_data_nn.py:Epoch 31/120, metrics: {'avg_train_loss': 0.05829052521534975, 'avg_test_loss': 0.06286670556255558}
INFO:model_data_nn.py:Epoch 32/120, metrics: {'avg_train_loss': 0.05816738408480131, 'avg_test_loss': 0.0628156677048537}
INFO:model_data_nn.py:Epoch 33/120, metrics: {'avg_train_loss': 0.05819639181085293, 'avg_test_loss': 0.06280260299354268}
INFO:model_data_nn.py:Epoch 34/120, metrics: {'avg_train_loss': 0.0580543000828145, 'avg_test_loss': 0.06278924171238032}
INFO:model_data_nn.py:Epoch 35/120, metrics: {'avg_train_loss': 0.05804307017685991, 'avg_test_loss': 0.06278997263507335}
INFO:model_data_nn.py:Epoch 36/120, metrics: {'avg_train_loss': 0.05794809978436157, 'avg_test_loss': 0.06276361184245616}
INFO:model_data_nn.py:Epoch 37/120, metrics: {'avg_train_loss': 0.05783975564995446, 'avg_test_loss': 0.06276984373107553}
INFO:model_data_nn.py:Epoch 38/120, metrics: {'avg_train_loss': 0.0577396277557933, 'avg_test_loss': 0.06270114476501476}
INFO:model_data_nn.py:Epoch 39/120, metrics: {'avg_train_loss': 0.05774977094659221, 'avg_test_loss': 0.06274199697691074}
INFO:model_data_nn.py:Epoch 40/120, metrics: {'avg_train_loss': 0.05762005087253087, 'avg_test_loss': 0.06275758259289432}
INFO:model_data_nn.py:Epoch 41/120, metrics: {'avg_train_loss': 0.05760665583705635, 'avg_test_loss': 0.06266660079018038}
INFO:model_data_nn.py:Epoch 42/120, metrics: {'avg_train_loss': 0.05738522046336586, 'avg_test_loss': 0.06268405910668662}
INFO:model_data_nn.py:Epoch 43/120, metrics: {'avg_train_loss': 0.05743003940754392, 'avg_test_loss': 0.06268627441568242}
INFO:model_data_nn.py:Epoch 44/120, metrics: {'avg_train_loss': 0.05722422209668847, 'avg_test_loss': 0.06264638725224358}
INFO:model_data_nn.py:Epoch 45/120, metrics: {'avg_train_loss': 0.05723037435856676, 'avg_test_loss': 0.06262222478289914}
INFO:model_data_nn.py:Epoch 46/120, metrics: {'avg_train_loss': 0.05715244012203457, 'avg_test_loss': 0.06263946623039374}
INFO:model_data_nn.py:Epoch 47/120, metrics: {'avg_train_loss': 0.05707772563412139, 'avg_test_loss': 0.06258089241600828}
INFO:model_data_nn.py:Epoch 48/120, metrics: {'avg_train_loss': 0.05692428257795043, 'avg_test_loss': 0.06257286490108527}
INFO:model_data_nn.py:Epoch 49/120, metrics: {'avg_train_loss': 0.05691058731248027, 'avg_test_loss': 0.06260901436326094}
INFO:model_data_nn.py:Epoch 50/120, metrics: {'avg_train_loss': 0.05679830762667785, 'avg_test_loss': 0.06259640250573284}
INFO:model_data_nn.py:Epoch 51/120, metrics: {'avg_train_loss': 0.05671834401192749, 'avg_test_loss': 0.062551863007684}
INFO:model_data_nn.py:Epoch 52/120, metrics: {'avg_train_loss': 0.05664384837763896, 'avg_test_loss': 0.06258982029066829}
INFO:model_data_nn.py:Epoch 53/120, metrics: {'avg_train_loss': 0.056465648074258336, 'avg_test_loss': 0.06255116587817611}
INFO:model_data_nn.py:Epoch 54/120, metrics: {'avg_train_loss': 0.056461917948103305, 'avg_test_loss': 0.06255300034536049}
INFO:model_data_nn.py:Epoch 55/120, metrics: {'avg_train_loss': 0.05639019815133154, 'avg_test_loss': 0.06251895357854664}
INFO:model_data_nn.py:Epoch 56/120, metrics: {'avg_train_loss': 0.05643341558794467, 'avg_test_loss': 0.062464632021146826}
INFO:model_data_nn.py:Epoch 57/120, metrics: {'avg_train_loss': 0.05624947118211744, 'avg_test_loss': 0.06244421594783489}
INFO:model_data_nn.py:Epoch 58/120, metrics: {'avg_train_loss': 0.056183385831872476, 'avg_test_loss': 0.06246637752155948}
INFO:model_data_nn.py:Epoch 59/120, metrics: {'avg_train_loss': 0.05615064803099229, 'avg_test_loss': 0.062370927993470104}
INFO:model_data_nn.py:Epoch 60/120, metrics: {'avg_train_loss': 0.055994417775009596, 'avg_test_loss': 0.06240858224373369}
INFO:model_data_nn.py:Epoch 61/120, metrics: {'avg_train_loss': 0.05596148998671765, 'avg_test_loss': 0.06237766043523152}
INFO:model_data_nn.py:Epoch 62/120, metrics: {'avg_train_loss': 0.055923496320607544, 'avg_test_loss': 0.062395694618317066}
INFO:model_data_nn.py:Epoch 63/120, metrics: {'avg_train_loss': 0.055784383634991434, 'avg_test_loss': 0.06241186150509748}
INFO:model_data_nn.py:Epoch 64/120, metrics: {'avg_train_loss': 0.05566608372422575, 'avg_test_loss': 0.062292506809171755}
INFO:model_data_nn.py:Epoch 65/120, metrics: {'avg_train_loss': 0.05560899092504666, 'avg_test_loss': 0.06241883064103604}
INFO:model_data_nn.py:Epoch 66/120, metrics: {'avg_train_loss': 0.05563375141991803, 'avg_test_loss': 0.062290871426739614}
INFO:model_data_nn.py:Epoch 67/120, metrics: {'avg_train_loss': 0.055505649392774435, 'avg_test_loss': 0.0623144232085906}
INFO:model_data_nn.py:Epoch 68/120, metrics: {'avg_train_loss': 0.055350296790772746, 'avg_test_loss': 0.062452941507217474}
INFO:model_data_nn.py:Epoch 69/120, metrics: {'avg_train_loss': 0.05539805382577386, 'avg_test_loss': 0.06228546038437344}
INFO:model_data_nn.py:Epoch 70/120, metrics: {'avg_train_loss': 0.05534886973120191, 'avg_test_loss': 0.062213917462941026}
INFO:model_data_nn.py:Epoch 71/120, metrics: {'avg_train_loss': 0.05528853510877172, 'avg_test_loss': 0.062253589123429265}
INFO:model_data_nn.py:Epoch 72/120, metrics: {'avg_train_loss': 0.055161762018573667, 'avg_test_loss': 0.062253422214780585}
INFO:model_data_nn.py:Epoch 73/120, metrics: {'avg_train_loss': 0.05509576728053685, 'avg_test_loss': 0.06218285629438469}
INFO:model_data_nn.py:Epoch 74/120, metrics: {'avg_train_loss': 0.0550522754715595, 'avg_test_loss': 0.06216183040305623}
INFO:model_data_nn.py:Epoch 75/120, metrics: {'avg_train_loss': 0.05493376825509039, 'avg_test_loss': 0.06216493469764828}
INFO:model_data_nn.py:Epoch 76/120, metrics: {'avg_train_loss': 0.05490282437083833, 'avg_test_loss': 0.06220629812560219}
INFO:model_data_nn.py:Epoch 77/120, metrics: {'avg_train_loss': 0.054751723260644806, 'avg_test_loss': 0.06224191732144391}
INFO:model_data_nn.py:Epoch 78/120, metrics: {'avg_train_loss': 0.054755214592713174, 'avg_test_loss': 0.06209912392478145}
INFO:model_data_nn.py:Epoch 79/120, metrics: {'avg_train_loss': 0.0546805122923074, 'avg_test_loss': 0.061939767487274366}
INFO:model_data_nn.py:Epoch 80/120, metrics: {'avg_train_loss': 0.054788045199010316, 'avg_test_loss': 0.062075088015262736}
INFO:model_data_nn.py:Epoch 81/120, metrics: {'avg_train_loss': 0.05461737349563449, 'avg_test_loss': 0.06197094360868505}
INFO:model_data_nn.py:Epoch 82/120, metrics: {'avg_train_loss': 0.05469719229796864, 'avg_test_loss': 0.06225902550613682}
INFO:model_data_nn.py:Epoch 83/120, metrics: {'avg_train_loss': 0.0545478488434572, 'avg_test_loss': 0.06193510104822053}
INFO:model_data_nn.py:Epoch 84/120, metrics: {'avg_train_loss': 0.0544040435316123, 'avg_test_loss': 0.062132646484315046}
INFO:model_data_nn.py:Epoch 85/120, metrics: {'avg_train_loss': 0.054512226112667726, 'avg_test_loss': 0.06198444987239782}
INFO:model_data_nn.py:Epoch 86/120, metrics: {'avg_train_loss': 0.054505157518200044, 'avg_test_loss': 0.06205337685059931}
INFO:model_data_nn.py:Epoch 87/120, metrics: {'avg_train_loss': 0.054227587897522, 'avg_test_loss': 0.06204380354574823}
INFO:model_data_nn.py:Epoch 88/120, metrics: {'avg_train_loss': 0.054309132493509014, 'avg_test_loss': 0.06213281865893805}
INFO:model_data_nn.py:Epoch 89/120, metrics: {'avg_train_loss': 0.05421761701496234, 'avg_test_loss': 0.061897684950963594}
INFO:model_data_nn.py:Epoch 90/120, metrics: {'avg_train_loss': 0.05415515408163485, 'avg_test_loss': 0.06212632771348581}
INFO:model_data_nn.py:Epoch 91/120, metrics: {'avg_train_loss': 0.054046809561082564, 'avg_test_loss': 0.06193402537610382}
INFO:model_data_nn.py:Epoch 92/120, metrics: {'avg_train_loss': 0.053996258540539604, 'avg_test_loss': 0.06225320615885721}
INFO:model_data_nn.py:Epoch 93/120, metrics: {'avg_train_loss': 0.054006326147145046, 'avg_test_loss': 0.06212288196729787}
INFO:model_data_nn.py:Epoch 94/120, metrics: {'avg_train_loss': 0.05391866382108262, 'avg_test_loss': 0.06216427314575412}
INFO:model_data_nn.py:Epoch 95/120, metrics: {'avg_train_loss': 0.05390028588591874, 'avg_test_loss': 0.06185563368489966}
INFO:model_data_nn.py:Epoch 96/120, metrics: {'avg_train_loss': 0.053936959106553835, 'avg_test_loss': 0.0618869155041466}
INFO:model_data_nn.py:Epoch 97/120, metrics: {'avg_train_loss': 0.05380923469268479, 'avg_test_loss': 0.061914237681776285}
INFO:model_data_nn.py:Epoch 98/120, metrics: {'avg_train_loss': 0.053767428954936636, 'avg_test_loss': 0.06223292221875454}
INFO:model_data_nn.py:Epoch 99/120, metrics: {'avg_train_loss': 0.05371528061538688, 'avg_test_loss': 0.06213166496854683}
INFO:model_data_nn.py:Epoch 100/120, metrics: {'avg_train_loss': 0.05370604959734078, 'avg_test_loss': 0.062126399810949806}
INFO:model_data_nn.py:Epoch 101/120, metrics: {'avg_train_loss': 0.053720081476882946, 'avg_test_loss': 0.06189529157563811}
INFO:model_data_nn.py:Epoch 102/120, metrics: {'avg_train_loss': 0.05361292134201327, 'avg_test_loss': 0.06224673848191742}
INFO:model_data_nn.py:Epoch 103/120, metrics: {'avg_train_loss': 0.053620966200289694, 'avg_test_loss': 0.062275700376630994}
INFO:model_data_nn.py:Epoch 104/120, metrics: {'avg_train_loss': 0.053587765683143954, 'avg_test_loss': 0.06191037013741152}
INFO:model_data_nn.py:Epoch 105/120, metrics: {'avg_train_loss': 0.053551871018927825, 'avg_test_loss': 0.061801261916116346}
INFO:model_data_nn.py:Epoch 106/120, metrics: {'avg_train_loss': 0.053433989233436806, 'avg_test_loss': 0.06189857422577916}
INFO:model_data_nn.py:Epoch 107/120, metrics: {'avg_train_loss': 0.05335694486684863, 'avg_test_loss': 0.06214594216544356}
INFO:model_data_nn.py:Epoch 108/120, metrics: {'avg_train_loss': 0.053303762538510685, 'avg_test_loss': 0.06180922408566403}
INFO:model_data_nn.py:Epoch 109/120, metrics: {'avg_train_loss': 0.053444489203223255, 'avg_test_loss': 0.062032857262238394}
INFO:model_data_nn.py:Epoch 110/120, metrics: {'avg_train_loss': 0.05326611586292724, 'avg_test_loss': 0.06217207314148254}
INFO:model_data_nn.py:Epoch 111/120, metrics: {'avg_train_loss': 0.05335027975179702, 'avg_test_loss': 0.06197604491899256}
INFO:model_data_nn.py:Epoch 112/120, metrics: {'avg_train_loss': 0.053258244255116195, 'avg_test_loss': 0.06206854658194061}
INFO:model_data_nn.py:Epoch 113/120, metrics: {'avg_train_loss': 0.053032492628924205, 'avg_test_loss': 0.06268138518680644}
INFO:model_data_nn.py:Epoch 114/120, metrics: {'avg_train_loss': 0.05307325665218844, 'avg_test_loss': 0.06200383952818811}
INFO:model_data_nn.py:Epoch 115/120, metrics: {'avg_train_loss': 0.053174971994321085, 'avg_test_loss': 0.06212053929630201}
INFO:model_data_nn.py:Epoch 116/120, metrics: {'avg_train_loss': 0.05303927278385494, 'avg_test_loss': 0.061990161701032775}
INFO:model_data_nn.py:Epoch 117/120, metrics: {'avg_train_loss': 0.05316341733283388, 'avg_test_loss': 0.06181893371285696}
INFO:model_data_nn.py:Epoch 118/120, metrics: {'avg_train_loss': 0.05301734245808286, 'avg_test_loss': 0.06180176223097078}
INFO:model_data_nn.py:Epoch 119/120, metrics: {'avg_train_loss': 0.05316617998024869, 'avg_test_loss': 0.06195552390454395}
INFO:model_data_nn.py:Epoch 120/120, metrics: {'avg_train_loss': 0.052891910141030764, 'avg_test_loss': 0.06205550185768516}
INFO:main_restricted.py:Making prediction for data in year: 1989
INFO:main_restricted.py:Prediction data shape: (16366,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:350: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1989: 0.2490963982171056
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  16366.000000  16366.000000
mean       0.032052      0.004678
std        0.251212      0.049396
min       -0.945313     -0.274692
25%       -0.090909     -0.025880
50%        0.016642      0.009320
75%        0.132440      0.041054
max        3.923078      0.184041
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:transform_data_nn.py:Train_data: (112048, 161)

INFO:transform_data_nn.py:Test data years: [1989]
INFO:transform_data_nn.py:Test_data: (16366, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:transform_data_nn.py:Retrain_data: (128414, 161)

INFO:transform_data_nn.py:Prediction data years: [1990]
INFO:transform_data_nn.py:Prediction_data: (16126, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([112048, 138])
            y_train_tf: torch.Size([112048])

            x_test_tf: torch.Size([16366, 138])
            y_test_tf: torch.Size([16366])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([128414, 138])
            y_retrain_tf: torch.Size([128414])

            x_prediction_tf: torch.Size([16126, 138])
            y_prediction_tf: torch.Size([16126])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-2.0368e-01,  1.4613e-01,  1.6670e-01, -1.2996e+00, -1.5581e-01,
        -6.3490e-01, -1.5167e-01, -3.3234e-01,  3.4130e-01, -1.6509e-01,
        -7.1113e-01, -3.0598e-02, -4.9210e-01,  1.7698e-02,  2.7621e-02,
         5.2354e-01, -1.4034e-01,  1.7132e-01,  0.0000e+00,  4.3357e-01,
        -3.6155e-01,  7.5280e-02,  1.7328e-02,  8.9085e-03, -6.4428e-02,
        -2.5203e-01, -5.6494e-01,  0.0000e+00,  4.0549e-01,  9.9060e-01,
         4.7090e-01, -1.2756e-01,  4.3668e-01,  0.0000e+00, -3.7373e-01,
        -1.9599e-01,  6.2056e-02,  3.9172e-01,  3.1288e-02, -1.1685e+00,
        -2.7627e-01,  2.4020e-01,  1.8337e-01, -6.8351e-02, -1.7270e-01,
        -6.6981e-01,  7.0629e-02, -5.5404e-02, -5.4842e-01, -2.0600e-01,
        -6.1664e-01,  6.6804e-01, -1.6028e-01,  2.4212e-03,  2.3795e-02,
         4.4623e-01, -7.5902e-01, -7.9499e-06, -2.6507e-01,  1.4397e-02,
         1.1498e-01, -3.3111e-01,  1.5373e-01,  2.8344e-01,  1.5654e-01,
        -1.1914e-01, -4.6283e-03, -7.3628e-02,  7.4786e-01, -4.1645e-01,
         0.0000e+00,  0.0000e+00, -1.9676e-01, -8.1574e-01,  3.7799e-02,
         5.7971e-01,  4.3629e-02, -3.4559e-01, -1.8308e-01, -4.2580e-03,
         0.0000e+00,  2.7307e-01,  5.3735e-02, -2.4523e-01, -5.5063e-01,
        -9.1112e-02, -7.4417e-02, -3.6511e-01, -1.3978e-01,  1.0272e-01,
        -5.1587e-01, -1.2930e+00,  3.7267e-02,  1.1955e+00,  1.6803e+00,
         1.5826e+00,  5.7628e-01,  1.3009e+00, -2.4806e+00, -4.5262e-01,
        -1.0432e+00,  1.1783e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.2399e-02,  2.5983e-01,  0.0000e+00, -1.4926e+00,
         2.5113e-01, -2.0098e+00,  1.3238e-01,  2.3763e-02,  0.0000e+00,
         0.0000e+00,  2.7788e-02, -1.7916e-01,  1.6315e-02,  6.6375e-03,
         1.8096e-01, -4.1411e-01, -3.8277e-01,  1.9860e-01,  2.4497e-01,
        -3.9885e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5373]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-1.0328e-02, -4.5945e-03, -6.1175e-01, -4.2919e-01, -2.9979e-01,
        -5.8820e-02, -1.9398e+00, -1.0548e+00, -4.8105e-02,  9.2327e-02,
        -1.9427e-02,  1.6832e-02, -3.9303e-02, -1.2090e-02,  3.2950e-02,
         3.7676e-01, -2.2029e-01, -4.9129e-01,  0.0000e+00,  5.6969e-03,
        -8.4695e-02,  7.5280e-02,  3.7865e-02,  9.6094e-01, -7.9298e-03,
        -4.5620e-03, -7.2574e-01,  0.0000e+00, -1.4182e+00,  3.7398e-02,
         4.2706e-01, -1.7737e-01,  2.7372e-01,  0.0000e+00,  1.7543e-03,
        -6.5350e-01,  7.9022e-03, -5.5227e-01, -8.4291e-01, -7.9602e-01,
         8.6959e-01,  7.0136e-02,  1.2240e-02,  2.1631e-02, -3.8938e-03,
         3.6990e-01,  6.9289e-02, -2.2570e-01, -4.2325e-01,  3.5530e-02,
         8.9260e-01, -1.3853e+00, -5.1862e-01, -2.5414e+00, -7.4346e-01,
         1.2464e-02, -1.0845e+00,  6.9339e-01,  7.3179e-03, -4.0037e-01,
        -5.0445e-03,  7.0648e-03,  7.1479e-03,  9.0722e-03, -1.6392e-02,
        -3.6987e-04, -9.4731e-03,  1.7388e+00,  1.3989e+00, -9.5058e-03,
         0.0000e+00,  0.0000e+00, -1.9676e-01,  6.6468e-01,  1.7143e-02,
        -8.8511e-02,  3.6591e-04, -1.2622e-03,  7.1653e-04, -4.2580e-03,
         0.0000e+00, -3.3035e-01, -6.4811e-02, -4.3878e-01, -5.6962e-01,
        -7.8317e-02, -6.8695e-02,  2.3996e-02, -1.0220e-04, -9.2791e-02,
        -6.5617e-01,  6.2750e-01,  3.7267e-02, -6.8854e-01,  8.3982e-02,
        -1.0567e+00, -1.3036e+00, -1.2722e-01, -6.6624e-01, -1.0806e+00,
        -9.2166e-01, -6.2909e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0426e-02,  2.5983e-01,  0.0000e+00, -1.3044e+00,
        -1.2224e+00,  4.1615e-01,  6.2709e-02,  2.3763e-02,  0.0000e+00,
         0.0000e+00,  1.2651e-02, -2.0436e-01,  1.6315e-02, -2.0294e-02,
        -8.1752e-04,  1.9352e-03, -2.3160e-02,  2.4850e-01,  1.9696e-01,
         1.4419e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2823]), tensor(0.0776))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.9888e-01,  2.4175e-01,  1.5162e-01, -1.3099e+00, -1.4741e-01,
        -6.3165e-01, -1.6069e-01, -3.3851e-01,  3.5518e-01, -1.6748e-01,
        -7.0992e-01, -1.6779e-02, -4.9800e-01, -2.6410e-02,  5.4492e-02,
         5.1524e-01, -1.3399e-01,  1.9059e-01, -2.4120e-02,  4.2271e-01,
        -3.6509e-01,  6.2610e-02,  2.5325e-02,  1.1384e-02, -6.3968e-02,
        -2.5729e-01, -5.7182e-01, -8.8892e-02,  4.0815e-01,  1.0331e+00,
         4.6613e-01, -1.1249e-01,  4.4130e-01,  6.9937e-02, -3.7023e-01,
        -1.9514e-01,  6.5328e-02,  4.2076e-01,  1.4483e-02, -1.1635e+00,
        -2.8302e-01,  2.5730e-01,  2.0227e-01, -6.9445e-02, -1.7670e-01,
        -6.6391e-01,  7.2989e-02, -5.6736e-02, -4.9058e-01, -2.0618e-01,
        -6.2754e-01,  6.7258e-01, -1.5462e-01, -8.1040e-02,  2.3827e-02,
         4.4010e-01, -7.5521e-01,  1.3362e-02, -2.5698e-01, -1.0978e-02,
         1.2090e-01, -3.2007e-01,  1.4735e-01,  2.7103e-01,  1.3328e-01,
        -1.2598e-01,  6.7935e-02, -8.1626e-02,  7.4496e-01, -4.1644e-01,
         0.0000e+00,  0.0000e+00, -1.1640e-01, -8.0519e-01,  5.6881e-02,
         5.7511e-01,  3.9681e-02, -3.4605e-01, -1.8426e-01, -2.1421e-03,
        -1.4698e-02,  2.4485e-01,  5.8111e-02, -2.7826e-01, -5.5057e-01,
        -9.6684e-02, -7.8830e-02, -3.5740e-01, -1.2274e-01,  1.1675e-01,
        -5.1316e-01, -1.2843e+00,  8.6597e-03,  1.3297e+00,  1.8072e+00,
         1.7105e+00,  7.2289e-01,  1.4011e+00, -2.3735e+00, -2.5662e-01,
        -9.9383e-01,  9.8230e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.3717e-02,  3.4823e-01,  0.0000e+00, -1.2770e+00,
         3.9812e-01, -2.1813e+00,  1.3916e-01,  2.8586e-02,  0.0000e+00,
         0.0000e+00,  2.1786e-02, -1.8152e-01,  1.6267e-02, -1.8414e-02,
         8.2592e-02, -4.2343e-01, -3.7704e-01,  2.1237e-01,  2.4886e-01,
        -4.0087e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5633]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([ 1.4584e-02,  6.3886e-02, -7.9550e-01, -1.1657e-01,  7.9758e-01,
        -7.0532e-01, -1.9870e+00, -1.0734e+00, -3.6949e-01, -1.4820e-01,
        -1.3949e-02,  1.1311e-02, -4.0241e-02, -5.3472e-02,  2.8244e-02,
         5.4960e-01, -1.9454e-01,  7.6766e-01,  4.7940e-01,  1.0482e-02,
         7.1274e-01, -2.1217e-01,  4.4143e-02, -4.2309e-01,  5.0684e-01,
        -5.9167e-03, -7.2234e-01, -8.8892e-02, -7.8899e-01,  3.2734e-02,
         1.8189e-01,  4.2959e-03,  3.3217e-01,  6.9937e-02, -2.7940e-04,
        -1.1348e+00,  1.0277e-02, -5.7281e-01,  6.2460e-01, -7.1152e-01,
        -1.3769e-01,  1.3250e-01,  1.1561e-02,  2.2164e-02, -2.5906e-03,
        -4.3427e-01,  9.3256e-01,  2.4867e-01, -4.2093e-01,  1.1561e+00,
         1.6633e+00, -1.0965e+00, -6.3259e-01, -1.2558e+00, -7.4224e-01,
         9.6668e-03, -1.0816e+00,  1.1522e+00,  9.5753e-04,  5.6143e-02,
        -3.8307e-03,  7.1953e-04,  4.4287e-03,  1.3628e-02, -3.1390e-03,
        -2.6362e-03,  3.9700e-02, -2.5201e+00,  9.2752e-02, -9.2406e-03,
         0.0000e+00,  0.0000e+00, -1.1640e-01, -5.4046e-01,  1.2246e-02,
         3.0416e-01,  9.7548e-04, -2.2895e-03,  2.6460e-03, -2.1421e-03,
         1.9614e-01,  5.8838e-01, -1.5876e-01,  2.9465e-02, -4.6237e-01,
        -8.5136e-02, -7.3785e-02,  2.9507e-02,  6.0131e-03,  2.8181e-01,
        -5.4587e-01, -1.2843e+00,  8.6597e-03, -1.1177e+00, -8.7787e-01,
        -1.2271e+00, -5.5954e-01, -2.9398e-01, -8.9560e-01, -1.1520e+00,
        -6.3334e-01,  2.2149e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.5919e-02,  4.1491e-01,  0.0000e+00, -9.6291e-01,
        -9.4916e-01,  2.5299e-01,  1.1801e-01,  2.8586e-02,  0.0000e+00,
         0.0000e+00,  1.0858e-02,  2.3569e-01,  1.6267e-02, -1.9918e-02,
        -4.3167e-02,  1.1825e-03, -2.1146e-02,  3.4402e-01,  3.6973e-01,
        -2.7416e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2770]), tensor(-0.0123))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:main_restricted.py:Testing data year: 1989
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 120
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 6323
            device: cpu
            
2024-07-27 03:16:34,334	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 03:16:34,385	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 03:16:34,425	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_573cf030409f7e88.zip' (1.38MiB) to Ray cluster...
2024-07-27 03:16:34,430	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_573cf030409f7e88.zip'.
2024-07-27 03:16:35,702	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 03:45:10,626	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_03-16-35' in 0.2220s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 6323, 'embedding_dim': 5, 'dropout_rate': 0.49, 'lr': 0.00979404150646356, 'weight_decay': 6.314559252945832e-06, 'num_epochs': 120, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.05307545640592547
INFO:model_data_nn.py:Best trial testing loss: 0.0609909167396836
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-27_03-16-32_111074_752378/artifacts/2024-07-27_03-16-35/train_fnn_2024-07-27_03-16-35/driver_artifacts/train_fnn_4de0a_00021_21_dropout_rate=0.4900,embedding_dim=5,hidden_dim=25,lr=0.0098,num_layers=1,weight_decay=0.0000_2024-07-27_03-16-35
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 6635, 'embedding_dim': 5, 'dropout_rate': 0.49, 'lr': 0.00979404150646356, 'weight_decay': 6.314559252945832e-06, 'num_epochs': 120, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/120, metrics: {'avg_train_loss': 0.05547537956917795, 'avg_test_loss': 0.10398833224335538}
INFO:model_data_nn.py:Epoch 2/120, metrics: {'avg_train_loss': 0.054362215793074486, 'avg_test_loss': 0.1064307788157806}
INFO:model_data_nn.py:Epoch 3/120, metrics: {'avg_train_loss': 0.054138321545761314, 'avg_test_loss': 0.10615237963770235}
INFO:model_data_nn.py:Epoch 4/120, metrics: {'avg_train_loss': 0.05413255238394517, 'avg_test_loss': 0.10469363977955211}
INFO:model_data_nn.py:Epoch 5/120, metrics: {'avg_train_loss': 0.05403667187711343, 'avg_test_loss': 0.10345671794909451}
INFO:model_data_nn.py:Epoch 6/120, metrics: {'avg_train_loss': 0.053871560403174396, 'avg_test_loss': 0.10417456717954741}
INFO:model_data_nn.py:Epoch 7/120, metrics: {'avg_train_loss': 0.05385939527647382, 'avg_test_loss': 0.10706687275882042}
INFO:model_data_nn.py:Epoch 8/120, metrics: {'avg_train_loss': 0.05382164824478293, 'avg_test_loss': 0.10726809514767771}
INFO:model_data_nn.py:Epoch 9/120, metrics: {'avg_train_loss': 0.05400917347341427, 'avg_test_loss': 0.10303670385601146}
INFO:model_data_nn.py:Epoch 10/120, metrics: {'avg_train_loss': 0.05400696082596258, 'avg_test_loss': 0.10028381299020515}
INFO:model_data_nn.py:Epoch 11/120, metrics: {'avg_train_loss': 0.053924820497502066, 'avg_test_loss': 0.10385590991640967}
INFO:model_data_nn.py:Epoch 12/120, metrics: {'avg_train_loss': 0.054007583419165055, 'avg_test_loss': 0.10140402594559073}
INFO:model_data_nn.py:Epoch 13/120, metrics: {'avg_train_loss': 0.05398222857470297, 'avg_test_loss': 0.10335652668228638}
INFO:model_data_nn.py:Epoch 14/120, metrics: {'avg_train_loss': 0.05404052299435986, 'avg_test_loss': 0.10362050644609899}
INFO:model_data_nn.py:Epoch 15/120, metrics: {'avg_train_loss': 0.0540370342850596, 'avg_test_loss': 0.10743402807219397}
INFO:model_data_nn.py:Epoch 16/120, metrics: {'avg_train_loss': 0.05399026697278283, 'avg_test_loss': 0.10148558202790954}
INFO:model_data_nn.py:Epoch 17/120, metrics: {'avg_train_loss': 0.05413867582894496, 'avg_test_loss': 0.10148768815293258}
INFO:model_data_nn.py:Epoch 18/120, metrics: {'avg_train_loss': 0.054057902418153114, 'avg_test_loss': 0.10572753182708448}
INFO:model_data_nn.py:Epoch 19/120, metrics: {'avg_train_loss': 0.05388571713755635, 'avg_test_loss': 0.1044623001833402}
INFO:model_data_nn.py:Epoch 20/120, metrics: {'avg_train_loss': 0.054039455189745816, 'avg_test_loss': 0.10562963697261044}
INFO:model_data_nn.py:Epoch 21/120, metrics: {'avg_train_loss': 0.05402653305165873, 'avg_test_loss': 0.11150786236837684}
INFO:model_data_nn.py:Epoch 22/120, metrics: {'avg_train_loss': 0.05407215685043145, 'avg_test_loss': 0.10417022738450517}
INFO:model_data_nn.py:Epoch 23/120, metrics: {'avg_train_loss': 0.05424852647725562, 'avg_test_loss': 0.1073850511466079}
INFO:model_data_nn.py:Epoch 24/120, metrics: {'avg_train_loss': 0.05417162534652462, 'avg_test_loss': 0.10471712064648432}
INFO:model_data_nn.py:Epoch 25/120, metrics: {'avg_train_loss': 0.05408866689376832, 'avg_test_loss': 0.10255810756435883}
INFO:model_data_nn.py:Epoch 26/120, metrics: {'avg_train_loss': 0.05427120077738679, 'avg_test_loss': 0.10383784634962914}
INFO:model_data_nn.py:Epoch 27/120, metrics: {'avg_train_loss': 0.05422846204096462, 'avg_test_loss': 0.10196769705951392}
INFO:model_data_nn.py:Epoch 28/120, metrics: {'avg_train_loss': 0.05417748919458178, 'avg_test_loss': 0.10434247247712125}
INFO:model_data_nn.py:Epoch 29/120, metrics: {'avg_train_loss': 0.054175274622984694, 'avg_test_loss': 0.10610484269388493}
INFO:model_data_nn.py:Epoch 30/120, metrics: {'avg_train_loss': 0.05401165869900176, 'avg_test_loss': 0.11167686290868986}
INFO:model_data_nn.py:Epoch 31/120, metrics: {'avg_train_loss': 0.054127965872996384, 'avg_test_loss': 0.10175564312486954}
INFO:model_data_nn.py:Epoch 32/120, metrics: {'avg_train_loss': 0.05409036763267693, 'avg_test_loss': 0.10989713378339297}
INFO:model_data_nn.py:Epoch 33/120, metrics: {'avg_train_loss': 0.05403792791100116, 'avg_test_loss': 0.10976551166580369}
INFO:model_data_nn.py:Epoch 34/120, metrics: {'avg_train_loss': 0.05401885268433215, 'avg_test_loss': 0.1006024038855223}
INFO:model_data_nn.py:Epoch 35/120, metrics: {'avg_train_loss': 0.05433648872778002, 'avg_test_loss': 0.10056860887053763}
INFO:model_data_nn.py:Epoch 36/120, metrics: {'avg_train_loss': 0.05422447499355643, 'avg_test_loss': 0.10589348714214765}
INFO:model_data_nn.py:Epoch 37/120, metrics: {'avg_train_loss': 0.05413449052284958, 'avg_test_loss': 0.1028455251103474}
INFO:model_data_nn.py:Epoch 38/120, metrics: {'avg_train_loss': 0.05427818306889538, 'avg_test_loss': 0.10219721321297424}
INFO:model_data_nn.py:Epoch 39/120, metrics: {'avg_train_loss': 0.05413027218996238, 'avg_test_loss': 0.10177913398688866}
INFO:model_data_nn.py:Epoch 40/120, metrics: {'avg_train_loss': 0.05425858046996892, 'avg_test_loss': 0.10512246657162905}
INFO:model_data_nn.py:Early stopping at epoch 40
INFO:main_restricted.py:Making prediction for data in year: 1990
INFO:main_restricted.py:Prediction data shape: (16126,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:350: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1990: 0.32421961516095
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  16126.000000  16126.000000
mean      -0.047284      0.051427
std        0.309796      0.027671
min       -0.945652     -0.197607
25%       -0.208333      0.045619
50%       -0.046875      0.047919
75%        0.078226      0.059694
max       15.200000      0.229421
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:transform_data_nn.py:Train_data: (128414, 161)

INFO:transform_data_nn.py:Test data years: [1990]
INFO:transform_data_nn.py:Test_data: (16126, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:transform_data_nn.py:Retrain_data: (144540, 161)

INFO:transform_data_nn.py:Prediction data years: [1991]
INFO:transform_data_nn.py:Prediction_data: (16222, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([128414, 138])
            y_train_tf: torch.Size([128414])

            x_test_tf: torch.Size([16126, 138])
            y_test_tf: torch.Size([16126])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([144540, 138])
            y_retrain_tf: torch.Size([144540])

            x_prediction_tf: torch.Size([16222, 138])
            y_prediction_tf: torch.Size([16222])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.9888e-01,  2.4175e-01,  1.5162e-01, -1.3099e+00, -1.4741e-01,
        -6.3165e-01, -1.6069e-01, -3.3851e-01,  3.5518e-01, -1.6748e-01,
        -7.0992e-01, -1.6779e-02, -4.9800e-01, -2.6410e-02,  5.4492e-02,
         5.1524e-01, -1.3399e-01,  1.9059e-01, -2.4120e-02,  4.2271e-01,
        -3.6509e-01,  6.2610e-02,  2.5325e-02,  1.1384e-02, -6.3968e-02,
        -2.5729e-01, -5.7182e-01, -8.8892e-02,  4.0815e-01,  1.0331e+00,
         4.6613e-01, -1.1249e-01,  4.4130e-01,  6.9937e-02, -3.7023e-01,
        -1.9514e-01,  6.5328e-02,  4.2076e-01,  1.4483e-02, -1.1635e+00,
        -2.8302e-01,  2.5730e-01,  2.0227e-01, -6.9445e-02, -1.7670e-01,
        -6.6391e-01,  7.2989e-02, -5.6736e-02, -4.9058e-01, -2.0618e-01,
        -6.2754e-01,  6.7258e-01, -1.5462e-01, -8.1040e-02,  2.3827e-02,
         4.4010e-01, -7.5521e-01,  1.3362e-02, -2.5698e-01, -1.0978e-02,
         1.2090e-01, -3.2007e-01,  1.4735e-01,  2.7103e-01,  1.3328e-01,
        -1.2598e-01,  6.7935e-02, -8.1626e-02,  7.4496e-01, -4.1644e-01,
         0.0000e+00,  0.0000e+00, -1.1640e-01, -8.0519e-01,  5.6881e-02,
         5.7511e-01,  3.9681e-02, -3.4605e-01, -1.8426e-01, -2.1421e-03,
        -1.4698e-02,  2.4485e-01,  5.8111e-02, -2.7826e-01, -5.5057e-01,
        -9.6684e-02, -7.8830e-02, -3.5740e-01, -1.2274e-01,  1.1675e-01,
        -5.1316e-01, -1.2843e+00,  8.6597e-03,  1.3297e+00,  1.8072e+00,
         1.7105e+00,  7.2289e-01,  1.4011e+00, -2.3735e+00, -2.5662e-01,
        -9.9383e-01,  9.8230e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.3717e-02,  3.4823e-01,  0.0000e+00, -1.2770e+00,
         3.9812e-01, -2.1813e+00,  1.3916e-01,  2.8586e-02,  0.0000e+00,
         0.0000e+00,  2.1786e-02, -1.8152e-01,  1.6267e-02, -1.8414e-02,
         8.2592e-02, -4.2343e-01, -3.7704e-01,  2.1237e-01,  2.4886e-01,
        -4.0087e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5633]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([ 1.4584e-02,  6.3886e-02, -7.9550e-01, -1.1657e-01,  7.9758e-01,
        -7.0532e-01, -1.9870e+00, -1.0734e+00, -3.6949e-01, -1.4820e-01,
        -1.3949e-02,  1.1311e-02, -4.0241e-02, -5.3472e-02,  2.8244e-02,
         5.4960e-01, -1.9454e-01,  7.6766e-01,  4.7940e-01,  1.0482e-02,
         7.1274e-01, -2.1217e-01,  4.4143e-02, -4.2309e-01,  5.0684e-01,
        -5.9167e-03, -7.2234e-01, -8.8892e-02, -7.8899e-01,  3.2734e-02,
         1.8189e-01,  4.2959e-03,  3.3217e-01,  6.9937e-02, -2.7940e-04,
        -1.1348e+00,  1.0277e-02, -5.7281e-01,  6.2460e-01, -7.1152e-01,
        -1.3769e-01,  1.3250e-01,  1.1561e-02,  2.2164e-02, -2.5906e-03,
        -4.3427e-01,  9.3256e-01,  2.4867e-01, -4.2093e-01,  1.1561e+00,
         1.6633e+00, -1.0965e+00, -6.3259e-01, -1.2558e+00, -7.4224e-01,
         9.6668e-03, -1.0816e+00,  1.1522e+00,  9.5753e-04,  5.6143e-02,
        -3.8307e-03,  7.1953e-04,  4.4287e-03,  1.3628e-02, -3.1390e-03,
        -2.6362e-03,  3.9700e-02, -2.5201e+00,  9.2752e-02, -9.2406e-03,
         0.0000e+00,  0.0000e+00, -1.1640e-01, -5.4046e-01,  1.2246e-02,
         3.0416e-01,  9.7548e-04, -2.2895e-03,  2.6460e-03, -2.1421e-03,
         1.9614e-01,  5.8838e-01, -1.5876e-01,  2.9465e-02, -4.6237e-01,
        -8.5136e-02, -7.3785e-02,  2.9507e-02,  6.0131e-03,  2.8181e-01,
        -5.4587e-01, -1.2843e+00,  8.6597e-03, -1.1177e+00, -8.7787e-01,
        -1.2271e+00, -5.5954e-01, -2.9398e-01, -8.9560e-01, -1.1520e+00,
        -6.3334e-01,  2.2149e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.5919e-02,  4.1491e-01,  0.0000e+00, -9.6291e-01,
        -9.4916e-01,  2.5299e-01,  1.1801e-01,  2.8586e-02,  0.0000e+00,
         0.0000e+00,  1.0858e-02,  2.3569e-01,  1.6267e-02, -1.9918e-02,
        -4.3167e-02,  1.1825e-03, -2.1146e-02,  3.4402e-01,  3.6973e-01,
        -2.7416e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2770]), tensor(-0.0123))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.8127e-01,  3.5956e-01,  1.4748e-01, -1.3199e+00, -1.3889e-01,
        -6.3833e-01, -1.6951e-01, -3.4585e-01,  3.3324e-01, -1.6478e-01,
        -7.0628e-01, -3.0352e-03, -4.9006e-01, -1.0081e-01,  6.9917e-02,
         5.1296e-01, -1.2890e-01,  1.9683e-01, -5.3400e-02,  4.3029e-01,
        -3.4217e-01,  2.6293e-02,  2.9814e-02,  1.4656e-02, -5.7687e-02,
        -2.6135e-01, -5.6682e-01, -2.7892e-03,  4.1402e-01,  1.0375e+00,
         4.6537e-01, -1.0050e-01,  4.4065e-01, -1.7268e-03, -3.6984e-01,
        -1.9264e-01,  6.9834e-02,  4.4125e-01,  1.0406e-02, -1.1532e+00,
        -2.9090e-01,  3.2361e-01,  2.2406e-01, -8.0628e-02, -1.7584e-01,
        -6.6210e-01,  1.0551e-01, -3.7356e-02, -4.5092e-01, -1.6225e-01,
        -6.4144e-01,  6.7715e-01, -1.4747e-01, -5.9432e-02,  2.6581e-02,
         4.3425e-01, -7.5034e-01,  3.6750e-02, -2.5420e-01, -2.4406e-02,
         1.2572e-01, -3.1598e-01,  1.4020e-01,  2.6296e-01,  1.2433e-01,
        -1.3243e-01,  1.5329e-01, -6.8269e-02,  7.3781e-01, -4.1781e-01,
         0.0000e+00,  0.0000e+00, -7.4018e-02, -8.0028e-01,  6.9763e-02,
         5.7405e-01,  3.3836e-02, -3.4724e-01, -1.8399e-01, -2.5441e-04,
        -3.6230e-03,  2.3486e-01,  4.0894e-02, -3.0437e-01, -5.4985e-01,
        -1.0212e-01, -8.3575e-02, -3.4775e-01, -1.0388e-01,  1.3574e-01,
        -5.0724e-01, -1.2705e+00, -6.6341e-04,  1.4422e+00,  1.9335e+00,
         1.8332e+00,  7.8078e-01,  1.5128e+00, -2.3936e+00, -1.2649e-01,
        -1.0045e+00,  1.0076e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0662e-02,  3.4013e-01,  0.0000e+00, -1.1694e+00,
         5.1689e-01, -2.2414e+00,  1.4424e-01,  2.6814e-02,  0.0000e+00,
         0.0000e+00,  1.6278e-02, -1.8149e-01,  1.8735e-02, -4.0309e-02,
         4.2391e-02, -4.3083e-01, -3.6705e-01,  2.2432e-01,  2.5494e-01,
        -4.0724e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5862]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([ 1.0049e-02,  5.1942e-02,  5.4218e-01,  1.4344e-01, -3.8141e-01,
        -3.1417e-01, -2.0959e+00, -1.0820e+00, -2.3176e-01, -3.2281e-01,
        -1.3056e-02,  9.9614e-03, -2.9154e-02, -4.8064e-02,  2.6795e-02,
        -1.3662e+00, -1.4158e-01,  5.7737e-02,  1.1894e-01,  1.4866e-02,
         6.1920e-02, -1.2541e-01,  5.5872e-01, -2.9872e-01, -3.4182e-01,
        -5.4803e-03, -6.6215e-01, -2.7892e-03, -1.0539e+00,  2.2103e-02,
        -2.0981e-01, -5.3803e-02,  2.9685e-01, -1.7268e-03,  2.0650e-04,
        -5.2036e-01,  6.9215e-03, -5.8960e-01, -1.1895e-01, -9.4741e-01,
         9.0662e-02, -7.8324e-01,  1.2031e-02,  1.2732e-02,  1.2096e-03,
         9.2210e-02, -2.8657e-01, -2.7115e-02,  7.1776e-01, -1.6502e-01,
         9.0143e-01, -1.0782e+00, -5.6287e-01, -9.5281e-01, -7.4076e-01,
         8.7588e-03, -1.0777e+00, -3.4752e-01,  6.9650e-05,  1.3055e-01,
        -4.4525e-03, -1.2021e-03,  5.7498e-03,  9.2681e-03,  2.1116e-04,
        -8.8350e-04,  3.2723e-02, -4.0264e-01,  8.1723e-02, -8.4904e-03,
         0.0000e+00,  0.0000e+00, -7.4018e-02,  4.3080e-02,  1.0297e-02,
        -3.9166e-01,  1.4043e-03, -2.8493e-03,  9.1460e-04, -2.5441e-04,
         1.6154e-01, -5.3648e-01, -1.7969e-01,  6.1375e-01, -4.9153e-01,
        -9.2394e-02, -7.8904e-02,  2.4872e-02,  4.7694e-03,  1.0059e-01,
        -6.5150e-01,  9.6492e-01, -6.6341e-04, -2.9424e-01, -7.9551e-01,
        -7.1778e-01,  5.1068e-02, -6.3808e-01, -1.2960e-01,  2.0901e-02,
        -7.3395e-01,  8.3138e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.8489e-02,  2.6498e-01,  0.0000e+00, -1.0782e+00,
        -1.5875e+00, -1.8571e+00,  1.1898e-01,  2.6814e-02,  0.0000e+00,
         0.0000e+00,  1.1161e-02, -2.3206e-01,  1.8735e-02, -1.7987e-02,
         1.1591e-02,  8.5840e-04, -1.4908e-02,  2.6827e-01,  2.6579e-01,
        -2.8380e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2798]), tensor(0.0145))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:main_restricted.py:Testing data year: 1990
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 120
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 6635
            device: cpu
            
2024-07-27 04:05:21,026	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 04:05:21,073	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 04:05:21,116	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_573cf030409f7e88.zip' (1.38MiB) to Ray cluster...
2024-07-27 04:05:21,121	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_573cf030409f7e88.zip'.
2024-07-27 04:05:22,552	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 04:38:20,367	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_04-05-22' in 0.3221s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 3, 'num_embeddings': 6635, 'embedding_dim': 4, 'dropout_rate': 0.18, 'lr': 4.622338301677029e-06, 'weight_decay': 4.471233183495595e-06, 'num_epochs': 120, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.05199888875578485
INFO:model_data_nn.py:Best trial testing loss: 0.09992244310625312
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-27_04-05-18_737006_752378/artifacts/2024-07-27_04-05-22/train_fnn_2024-07-27_04-05-22/driver_artifacts/train_fnn_1e6a6_00076_76_dropout_rate=0.1800,embedding_dim=4,hidden_dim=25,lr=0.0000,num_layers=3,weight_decay=0.0000_2024-07-27_04-05-22
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 3, 'num_embeddings': 6904, 'embedding_dim': 4, 'dropout_rate': 0.18, 'lr': 4.622338301677029e-06, 'weight_decay': 4.471233183495595e-06, 'num_epochs': 120, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/120, metrics: {'avg_train_loss': 0.06517826423411029, 'avg_test_loss': 0.1790023856342603}
INFO:model_data_nn.py:Epoch 2/120, metrics: {'avg_train_loss': 0.06454052873127342, 'avg_test_loss': 0.17900343091985765}
INFO:model_data_nn.py:Epoch 3/120, metrics: {'avg_train_loss': 0.0642823540226849, 'avg_test_loss': 0.17846787906264705}
INFO:model_data_nn.py:Epoch 4/120, metrics: {'avg_train_loss': 0.06413031316500258, 'avg_test_loss': 0.17843070696429505}
INFO:model_data_nn.py:Epoch 5/120, metrics: {'avg_train_loss': 0.06396182959201176, 'avg_test_loss': 0.17823113986388348}
INFO:model_data_nn.py:Epoch 6/120, metrics: {'avg_train_loss': 0.063875731974568, 'avg_test_loss': 0.17761292302323398}
INFO:model_data_nn.py:Epoch 7/120, metrics: {'avg_train_loss': 0.0637771090241477, 'avg_test_loss': 0.17893651248317732}
INFO:model_data_nn.py:Epoch 8/120, metrics: {'avg_train_loss': 0.06362016731388628, 'avg_test_loss': 0.17926836951362077}
INFO:model_data_nn.py:Epoch 9/120, metrics: {'avg_train_loss': 0.06354529439589804, 'avg_test_loss': 0.17871562921105932}
INFO:model_data_nn.py:Epoch 10/120, metrics: {'avg_train_loss': 0.06339443888525956, 'avg_test_loss': 0.1804899747871024}
INFO:model_data_nn.py:Epoch 11/120, metrics: {'avg_train_loss': 0.06326324446693818, 'avg_test_loss': 0.17836730931637554}
INFO:model_data_nn.py:Epoch 12/120, metrics: {'avg_train_loss': 0.06313584229702908, 'avg_test_loss': 0.18036341169000378}
INFO:model_data_nn.py:Epoch 13/120, metrics: {'avg_train_loss': 0.06304339160233446, 'avg_test_loss': 0.17945402140565642}
INFO:model_data_nn.py:Epoch 14/120, metrics: {'avg_train_loss': 0.06285394418890633, 'avg_test_loss': 0.1795339934064968}
INFO:model_data_nn.py:Epoch 15/120, metrics: {'avg_train_loss': 0.06272611652210418, 'avg_test_loss': 0.18043232572501933}
INFO:model_data_nn.py:Epoch 16/120, metrics: {'avg_train_loss': 0.06261419225319187, 'avg_test_loss': 0.18021404573829805}
INFO:model_data_nn.py:Epoch 17/120, metrics: {'avg_train_loss': 0.062471598357899095, 'avg_test_loss': 0.17988895043671954}
INFO:model_data_nn.py:Epoch 18/120, metrics: {'avg_train_loss': 0.0623931949510791, 'avg_test_loss': 0.18124557963225263}
INFO:model_data_nn.py:Epoch 19/120, metrics: {'avg_train_loss': 0.06227205545621482, 'avg_test_loss': 0.18088741743793854}
INFO:model_data_nn.py:Epoch 20/120, metrics: {'avg_train_loss': 0.06220847415435339, 'avg_test_loss': 0.18187851098015229}
INFO:model_data_nn.py:Epoch 21/120, metrics: {'avg_train_loss': 0.062006606983269555, 'avg_test_loss': 0.18185912942627713}
INFO:model_data_nn.py:Epoch 22/120, metrics: {'avg_train_loss': 0.06196158666300588, 'avg_test_loss': 0.18089227713056688}
INFO:model_data_nn.py:Epoch 23/120, metrics: {'avg_train_loss': 0.061789884827024896, 'avg_test_loss': 0.18015617195009834}
INFO:model_data_nn.py:Epoch 24/120, metrics: {'avg_train_loss': 0.06170738685689743, 'avg_test_loss': 0.18143054964553557}
INFO:model_data_nn.py:Epoch 25/120, metrics: {'avg_train_loss': 0.06158393638289744, 'avg_test_loss': 0.18312745948764816}
INFO:model_data_nn.py:Epoch 26/120, metrics: {'avg_train_loss': 0.061433636329578226, 'avg_test_loss': 0.1833907136844225}
INFO:model_data_nn.py:Epoch 27/120, metrics: {'avg_train_loss': 0.06128635076145755, 'avg_test_loss': 0.18257112404665884}
INFO:model_data_nn.py:Epoch 28/120, metrics: {'avg_train_loss': 0.06127562254043789, 'avg_test_loss': 0.18380965768952928}
INFO:model_data_nn.py:Epoch 29/120, metrics: {'avg_train_loss': 0.06111968565032872, 'avg_test_loss': 0.18401028984455903}
INFO:model_data_nn.py:Epoch 30/120, metrics: {'avg_train_loss': 0.061035320903996215, 'avg_test_loss': 0.1831860873899634}
INFO:model_data_nn.py:Epoch 31/120, metrics: {'avg_train_loss': 0.0609938162691332, 'avg_test_loss': 0.18404100031116188}
INFO:model_data_nn.py:Epoch 32/120, metrics: {'avg_train_loss': 0.06082402201910013, 'avg_test_loss': 0.18232436563371437}
INFO:model_data_nn.py:Epoch 33/120, metrics: {'avg_train_loss': 0.06071228000488176, 'avg_test_loss': 0.1841804976565892}
INFO:model_data_nn.py:Epoch 34/120, metrics: {'avg_train_loss': 0.06070752487469853, 'avg_test_loss': 0.1842668898058302}
INFO:model_data_nn.py:Epoch 35/120, metrics: {'avg_train_loss': 0.060580303334978026, 'avg_test_loss': 0.18417308609602015}
INFO:model_data_nn.py:Epoch 36/120, metrics: {'avg_train_loss': 0.060457854022024304, 'avg_test_loss': 0.18198375799555397}
INFO:model_data_nn.py:Early stopping at epoch 36
INFO:main_restricted.py:Making prediction for data in year: 1991
INFO:main_restricted.py:Prediction data shape: (16222,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:350: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1991: 0.42659854746665476
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  16222.000000  16222.000000
mean       0.115448     -0.007764
std        0.411550      0.057133
min       -0.988636     -0.397264
25%       -0.078436     -0.046844
50%        0.046431     -0.008209
75%        0.225745      0.035721
max       10.600000      0.192414
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:transform_data_nn.py:Train_data: (144540, 161)

INFO:transform_data_nn.py:Test data years: [1991]
INFO:transform_data_nn.py:Test_data: (16222, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:transform_data_nn.py:Retrain_data: (160762, 161)

INFO:transform_data_nn.py:Prediction data years: [1992]
INFO:transform_data_nn.py:Prediction_data: (16382, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([144540, 138])
            y_train_tf: torch.Size([144540])

            x_test_tf: torch.Size([16222, 138])
            y_test_tf: torch.Size([16222])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([160762, 138])
            y_retrain_tf: torch.Size([160762])

            x_prediction_tf: torch.Size([16382, 138])
            y_prediction_tf: torch.Size([16382])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.8127e-01,  3.5956e-01,  1.4748e-01, -1.3199e+00, -1.3889e-01,
        -6.3833e-01, -1.6951e-01, -3.4585e-01,  3.3324e-01, -1.6478e-01,
        -7.0628e-01, -3.0352e-03, -4.9006e-01, -1.0081e-01,  6.9917e-02,
         5.1296e-01, -1.2890e-01,  1.9683e-01, -5.3400e-02,  4.3029e-01,
        -3.4217e-01,  2.6293e-02,  2.9814e-02,  1.4656e-02, -5.7687e-02,
        -2.6135e-01, -5.6682e-01, -2.7892e-03,  4.1402e-01,  1.0375e+00,
         4.6537e-01, -1.0050e-01,  4.4065e-01, -1.7268e-03, -3.6984e-01,
        -1.9264e-01,  6.9834e-02,  4.4125e-01,  1.0406e-02, -1.1532e+00,
        -2.9090e-01,  3.2361e-01,  2.2406e-01, -8.0628e-02, -1.7584e-01,
        -6.6210e-01,  1.0551e-01, -3.7356e-02, -4.5092e-01, -1.6225e-01,
        -6.4144e-01,  6.7715e-01, -1.4747e-01, -5.9432e-02,  2.6581e-02,
         4.3425e-01, -7.5034e-01,  3.6750e-02, -2.5420e-01, -2.4406e-02,
         1.2572e-01, -3.1598e-01,  1.4020e-01,  2.6296e-01,  1.2433e-01,
        -1.3243e-01,  1.5329e-01, -6.8269e-02,  7.3781e-01, -4.1781e-01,
         0.0000e+00,  0.0000e+00, -7.4018e-02, -8.0028e-01,  6.9763e-02,
         5.7405e-01,  3.3836e-02, -3.4724e-01, -1.8399e-01, -2.5441e-04,
        -3.6230e-03,  2.3486e-01,  4.0894e-02, -3.0437e-01, -5.4985e-01,
        -1.0212e-01, -8.3575e-02, -3.4775e-01, -1.0388e-01,  1.3574e-01,
        -5.0724e-01, -1.2705e+00, -6.6341e-04,  1.4422e+00,  1.9335e+00,
         1.8332e+00,  7.8078e-01,  1.5128e+00, -2.3936e+00, -1.2649e-01,
        -1.0045e+00,  1.0076e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0662e-02,  3.4013e-01,  0.0000e+00, -1.1694e+00,
         5.1689e-01, -2.2414e+00,  1.4424e-01,  2.6814e-02,  0.0000e+00,
         0.0000e+00,  1.6278e-02, -1.8149e-01,  1.8735e-02, -4.0309e-02,
         4.2391e-02, -4.3083e-01, -3.6705e-01,  2.2432e-01,  2.5494e-01,
        -4.0724e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5862]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([ 1.0049e-02,  5.1942e-02,  5.4218e-01,  1.4344e-01, -3.8141e-01,
        -3.1417e-01, -2.0959e+00, -1.0820e+00, -2.3176e-01, -3.2281e-01,
        -1.3056e-02,  9.9614e-03, -2.9154e-02, -4.8064e-02,  2.6795e-02,
        -1.3662e+00, -1.4158e-01,  5.7737e-02,  1.1894e-01,  1.4866e-02,
         6.1920e-02, -1.2541e-01,  5.5872e-01, -2.9872e-01, -3.4182e-01,
        -5.4803e-03, -6.6215e-01, -2.7892e-03, -1.0539e+00,  2.2103e-02,
        -2.0981e-01, -5.3803e-02,  2.9685e-01, -1.7268e-03,  2.0650e-04,
        -5.2036e-01,  6.9215e-03, -5.8960e-01, -1.1895e-01, -9.4741e-01,
         9.0662e-02, -7.8324e-01,  1.2031e-02,  1.2732e-02,  1.2096e-03,
         9.2210e-02, -2.8657e-01, -2.7115e-02,  7.1776e-01, -1.6502e-01,
         9.0143e-01, -1.0782e+00, -5.6287e-01, -9.5281e-01, -7.4076e-01,
         8.7588e-03, -1.0777e+00, -3.4752e-01,  6.9650e-05,  1.3055e-01,
        -4.4525e-03, -1.2021e-03,  5.7498e-03,  9.2681e-03,  2.1116e-04,
        -8.8350e-04,  3.2723e-02, -4.0264e-01,  8.1723e-02, -8.4904e-03,
         0.0000e+00,  0.0000e+00, -7.4018e-02,  4.3080e-02,  1.0297e-02,
        -3.9166e-01,  1.4043e-03, -2.8493e-03,  9.1460e-04, -2.5441e-04,
         1.6154e-01, -5.3648e-01, -1.7969e-01,  6.1375e-01, -4.9153e-01,
        -9.2394e-02, -7.8904e-02,  2.4872e-02,  4.7694e-03,  1.0059e-01,
        -6.5150e-01,  9.6492e-01, -6.6341e-04, -2.9424e-01, -7.9551e-01,
        -7.1778e-01,  5.1068e-02, -6.3808e-01, -1.2960e-01,  2.0901e-02,
        -7.3395e-01,  8.3138e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.8489e-02,  2.6498e-01,  0.0000e+00, -1.0782e+00,
        -1.5875e+00, -1.8571e+00,  1.1898e-01,  2.6814e-02,  0.0000e+00,
         0.0000e+00,  1.1161e-02, -2.3206e-01,  1.8735e-02, -1.7987e-02,
         1.1591e-02,  8.5840e-04, -1.4908e-02,  2.6827e-01,  2.6579e-01,
        -2.8380e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2798]), tensor(0.0145))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.7734e-01,  4.5340e-01,  1.3377e-01, -1.3261e+00, -1.2311e-01,
        -6.5098e-01, -1.7753e-01, -3.5516e-01,  3.0045e-01, -1.6351e-01,
        -7.0341e-01,  6.8448e-03, -4.7901e-01, -1.6231e-01,  8.0110e-02,
         5.0950e-01, -1.2548e-01,  1.9564e-01, -7.2714e-02,  4.4782e-01,
        -3.5735e-01, -6.6628e-03,  9.3140e-03,  2.0648e-02, -5.6081e-02,
        -2.6397e-01, -5.6231e-01, -2.1161e-02,  4.1490e-01,  1.0341e+00,
         4.3785e-01, -9.1039e-02,  4.4138e-01, -1.3588e-02, -3.7245e-01,
        -1.8960e-01,  7.6126e-02,  4.6096e-01,  1.4997e-02, -1.1373e+00,
        -2.9925e-01,  3.4205e-01,  2.5111e-01, -9.3056e-02, -1.6665e-01,
        -6.6268e-01,  1.1682e-01, -4.0390e-02, -4.3304e-01, -1.7197e-01,
        -6.6367e-01,  6.7888e-01, -1.3982e-01, -4.4105e-02,  3.2892e-02,
         4.3293e-01, -7.4493e-01,  5.0402e-02, -2.5059e-01, -3.0483e-02,
         1.2759e-01, -3.1220e-01,  1.3602e-01,  2.5551e-01,  1.2531e-01,
        -1.3906e-01,  2.2288e-01, -7.8586e-02,  7.3184e-01, -4.1788e-01,
        -1.0879e-01, -4.0737e-02, -6.1110e-02, -7.9729e-01,  8.3312e-02,
         5.8354e-01,  2.7448e-02, -3.4959e-01, -1.8488e-01, -3.8435e-03,
        -1.4837e-02,  2.4283e-01,  1.9573e-02, -3.2015e-01, -5.4688e-01,
        -1.0675e-01, -8.8442e-02, -3.3864e-01, -8.7835e-02,  1.5286e-01,
        -5.0111e-01, -1.2624e+00, -3.4320e-06,  1.5509e+00,  1.9771e+00,
         1.9546e+00,  7.1260e-01,  1.6179e+00, -2.5331e+00, -5.9443e-02,
        -9.7327e-01,  1.1628e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.5478e-02,  3.8159e-01,  0.0000e+00, -1.1082e+00,
         6.1212e-01, -2.1870e+00,  1.4742e-01,  3.0443e-02,  0.0000e+00,
         0.0000e+00,  1.3705e-02, -1.7713e-01,  1.9624e-02, -6.0341e-02,
         4.7219e-02, -4.3803e-01, -3.5763e-01,  2.3778e-01,  2.6301e-01,
        -4.1376e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6147]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([ 4.5884e-03,  4.9765e-02, -6.3958e-01,  3.6238e-01, -2.6211e-01,
        -4.5410e-01, -2.1801e+00, -1.0535e+00, -5.0918e-01, -3.2670e-01,
        -1.2268e-02,  5.0461e-03, -3.9376e-02, -4.0670e-02,  2.3914e-02,
         2.5567e-01, -1.9601e-01,  5.6621e-02,  2.0582e-01,  1.9670e-02,
         5.4303e-01, -8.8635e-02,  2.0365e-02, -2.9322e-01, -1.5510e-01,
        -5.2580e-03, -6.9155e-01, -9.9206e-01, -6.1416e-01,  2.8934e-02,
        -2.4629e-02, -8.9173e-02,  2.2688e-01, -1.3588e-02, -8.6521e-04,
        -5.1289e-01,  1.0675e-02, -6.0930e-01, -1.5761e-01, -1.0796e+00,
         2.5863e-02,  2.4820e-01,  1.7210e-02,  2.4536e-02,  6.8984e-03,
        -2.3126e-01,  9.4793e-01, -9.2326e-02,  3.9157e-01,  1.1064e+00,
         1.6536e+00, -8.2409e-01, -6.2094e-01, -8.1102e-01, -7.3726e-01,
         7.6105e-03, -1.0737e+00,  1.1574e+00, -7.0059e-04, -7.3457e-01,
        -4.5052e-03, -1.5322e-03,  3.9907e-03,  6.2976e-03,  8.2498e-04,
        -2.7221e-03,  2.9387e-02, -5.5122e+00,  7.3184e-01, -7.9588e-03,
        -1.0879e-01, -4.0737e-02, -6.1110e-02, -9.3162e-02,  9.2216e-03,
        -2.9512e-02,  1.1943e-03, -4.6854e-03,  2.6733e-04, -3.8435e-03,
         1.3799e-01, -2.4547e-01, -3.6935e-01,  7.1472e-01, -3.3434e-01,
        -4.0610e-03, -2.5000e-03,  2.9221e-02,  5.3267e-03,  1.0881e-01,
        -4.2178e-01, -3.7129e-01, -3.4320e-06, -1.3317e+00, -2.4169e+00,
        -9.3624e-01,  1.9813e+00, -1.6256e+00,  8.2424e-01, -9.8591e-01,
         3.8318e-01,  1.1111e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  4.1856e-02,  7.7902e-01,  0.0000e+00, -2.4267e-01,
        -1.7175e-01, -1.5689e+00,  1.2207e-01,  3.0443e-02,  0.0000e+00,
         0.0000e+00,  1.2271e-02, -2.0077e-01,  1.9624e-02, -1.5370e-02,
         4.4105e-03, -2.2916e-04, -2.4002e-02,  2.8235e-01,  2.6622e-01,
        -4.0010e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2864]), tensor(-0.1793))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:main_restricted.py:Testing data year: 1991
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 120
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 6904
            device: cpu
            
2024-07-27 05:03:08,427	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 05:03:08,470	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 05:03:08,510	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_573cf030409f7e88.zip' (1.38MiB) to Ray cluster...
2024-07-27 05:03:08,515	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_573cf030409f7e88.zip'.
2024-07-27 05:03:09,824	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 05:20:37,354	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_05-03-09' in 0.2600s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 6904, 'embedding_dim': 5, 'dropout_rate': 0.49, 'lr': 0.00979404150646356, 'weight_decay': 6.314559252945832e-06, 'num_epochs': 120, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.06156163064126673
INFO:model_data_nn.py:Best trial testing loss: 0.17025986889880554
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-27_05-03-06_215162_752378/artifacts/2024-07-27_05-03-09/train_fnn_2024-07-27_05-03-09/driver_artifacts/train_fnn_31122_00021_21_dropout_rate=0.4900,embedding_dim=5,hidden_dim=25,lr=0.0098,num_layers=1,weight_decay=0.0000_2024-07-27_05-03-10
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 7233, 'embedding_dim': 5, 'dropout_rate': 0.49, 'lr': 0.00979404150646356, 'weight_decay': 6.314559252945832e-06, 'num_epochs': 120, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/120, metrics: {'avg_train_loss': 0.07169474076919383, 'avg_test_loss': 0.11717516052522114}
INFO:model_data_nn.py:Epoch 2/120, metrics: {'avg_train_loss': 0.07020645506200263, 'avg_test_loss': 0.1174591750586842}
INFO:model_data_nn.py:Epoch 3/120, metrics: {'avg_train_loss': 0.07004804004674813, 'avg_test_loss': 0.11812586202540842}
INFO:model_data_nn.py:Epoch 4/120, metrics: {'avg_train_loss': 0.07062016122464304, 'avg_test_loss': 0.11535052791441558}
INFO:model_data_nn.py:Epoch 5/120, metrics: {'avg_train_loss': 0.07038582091877432, 'avg_test_loss': 0.11602785943250638}
INFO:model_data_nn.py:Epoch 6/120, metrics: {'avg_train_loss': 0.07037479525423093, 'avg_test_loss': 0.11946709805306455}
INFO:model_data_nn.py:Epoch 7/120, metrics: {'avg_train_loss': 0.07050422063263453, 'avg_test_loss': 0.1174354462636984}
INFO:model_data_nn.py:Epoch 8/120, metrics: {'avg_train_loss': 0.0705308362346285, 'avg_test_loss': 0.11889679045088997}
INFO:model_data_nn.py:Epoch 9/120, metrics: {'avg_train_loss': 0.07058131935410084, 'avg_test_loss': 0.11865280782694754}
INFO:model_data_nn.py:Epoch 10/120, metrics: {'avg_train_loss': 0.07063773317317401, 'avg_test_loss': 0.11596763525994902}
INFO:model_data_nn.py:Epoch 11/120, metrics: {'avg_train_loss': 0.0718015072419409, 'avg_test_loss': 0.12024875371571397}
INFO:model_data_nn.py:Epoch 12/120, metrics: {'avg_train_loss': 0.07213990975992167, 'avg_test_loss': 0.11814376859547338}
INFO:model_data_nn.py:Epoch 13/120, metrics: {'avg_train_loss': 0.07242989784776185, 'avg_test_loss': 0.1193019381371414}
INFO:model_data_nn.py:Epoch 14/120, metrics: {'avg_train_loss': 0.07219962237898118, 'avg_test_loss': 0.11974333851139818}
INFO:model_data_nn.py:Epoch 15/120, metrics: {'avg_train_loss': 0.07219356767166625, 'avg_test_loss': 0.11809565526891674}
INFO:model_data_nn.py:Epoch 16/120, metrics: {'avg_train_loss': 0.07216415138841772, 'avg_test_loss': 0.11770894431901979}
INFO:model_data_nn.py:Epoch 17/120, metrics: {'avg_train_loss': 0.07200562403015318, 'avg_test_loss': 0.11850165757095965}
INFO:model_data_nn.py:Epoch 18/120, metrics: {'avg_train_loss': 0.07211397413871026, 'avg_test_loss': 0.11833716675937467}
INFO:model_data_nn.py:Epoch 19/120, metrics: {'avg_train_loss': 0.07215538310594441, 'avg_test_loss': 0.11823504230778781}
INFO:model_data_nn.py:Epoch 20/120, metrics: {'avg_train_loss': 0.07213497537156348, 'avg_test_loss': 0.1192814745099895}
INFO:model_data_nn.py:Epoch 21/120, metrics: {'avg_train_loss': 0.07215534275431768, 'avg_test_loss': 0.11827552711110911}
INFO:model_data_nn.py:Epoch 22/120, metrics: {'avg_train_loss': 0.07215247652567568, 'avg_test_loss': 0.11968111691203376}
INFO:model_data_nn.py:Epoch 23/120, metrics: {'avg_train_loss': 0.0720997741723961, 'avg_test_loss': 0.11764411389049201}
INFO:model_data_nn.py:Epoch 24/120, metrics: {'avg_train_loss': 0.07203496072462101, 'avg_test_loss': 0.11853721789702831}
INFO:model_data_nn.py:Epoch 25/120, metrics: {'avg_train_loss': 0.07204219304243174, 'avg_test_loss': 0.11632786427071551}
INFO:model_data_nn.py:Epoch 26/120, metrics: {'avg_train_loss': 0.07228266163788451, 'avg_test_loss': 0.1179329862115992}
INFO:model_data_nn.py:Epoch 27/120, metrics: {'avg_train_loss': 0.07207154486403254, 'avg_test_loss': 0.11922204365146172}
INFO:model_data_nn.py:Epoch 28/120, metrics: {'avg_train_loss': 0.07208456144394548, 'avg_test_loss': 0.11977247392132995}
INFO:model_data_nn.py:Epoch 29/120, metrics: {'avg_train_loss': 0.07213743557044228, 'avg_test_loss': 0.12333600717101945}
INFO:model_data_nn.py:Epoch 30/120, metrics: {'avg_train_loss': 0.07208558596718083, 'avg_test_loss': 0.11751222469865752}
INFO:model_data_nn.py:Epoch 31/120, metrics: {'avg_train_loss': 0.07208489914051001, 'avg_test_loss': 0.1177960141285439}
INFO:model_data_nn.py:Epoch 32/120, metrics: {'avg_train_loss': 0.07202255206718702, 'avg_test_loss': 0.11814299061188649}
INFO:model_data_nn.py:Epoch 33/120, metrics: {'avg_train_loss': 0.07213304953717858, 'avg_test_loss': 0.12149591520574177}
INFO:model_data_nn.py:Epoch 34/120, metrics: {'avg_train_loss': 0.0719940697775774, 'avg_test_loss': 0.11990869370856672}
INFO:model_data_nn.py:Early stopping at epoch 34
INFO:main_restricted.py:Making prediction for data in year: 1992
INFO:main_restricted.py:Prediction data shape: (16382,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:350: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1992: 0.3462702131661842
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  16382.000000  16382.000000
mean       0.062721      0.024651
std        0.346966      0.051318
min       -0.958333     -0.020655
25%       -0.103448     -0.006038
50%        0.013034     -0.003550
75%        0.162791      0.036876
max        7.000003      0.422275
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:transform_data_nn.py:Train_data: (160762, 161)

INFO:transform_data_nn.py:Test data years: [1992]
INFO:transform_data_nn.py:Test_data: (16382, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Retrain_data: (177144, 161)

INFO:transform_data_nn.py:Prediction data years: [1993]
INFO:transform_data_nn.py:Prediction_data: (17602, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([160762, 138])
            y_train_tf: torch.Size([160762])

            x_test_tf: torch.Size([16382, 138])
            y_test_tf: torch.Size([16382])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([177144, 138])
            y_retrain_tf: torch.Size([177144])

            x_prediction_tf: torch.Size([17602, 138])
            y_prediction_tf: torch.Size([17602])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.7734e-01,  4.5340e-01,  1.3377e-01, -1.3261e+00, -1.2311e-01,
        -6.5098e-01, -1.7753e-01, -3.5516e-01,  3.0045e-01, -1.6351e-01,
        -7.0341e-01,  6.8448e-03, -4.7901e-01, -1.6231e-01,  8.0110e-02,
         5.0950e-01, -1.2548e-01,  1.9564e-01, -7.2714e-02,  4.4782e-01,
        -3.5735e-01, -6.6628e-03,  9.3140e-03,  2.0648e-02, -5.6081e-02,
        -2.6397e-01, -5.6231e-01, -2.1161e-02,  4.1490e-01,  1.0341e+00,
         4.3785e-01, -9.1039e-02,  4.4138e-01, -1.3588e-02, -3.7245e-01,
        -1.8960e-01,  7.6126e-02,  4.6096e-01,  1.4997e-02, -1.1373e+00,
        -2.9925e-01,  3.4205e-01,  2.5111e-01, -9.3056e-02, -1.6665e-01,
        -6.6268e-01,  1.1682e-01, -4.0390e-02, -4.3304e-01, -1.7197e-01,
        -6.6367e-01,  6.7888e-01, -1.3982e-01, -4.4105e-02,  3.2892e-02,
         4.3293e-01, -7.4493e-01,  5.0402e-02, -2.5059e-01, -3.0483e-02,
         1.2759e-01, -3.1220e-01,  1.3602e-01,  2.5551e-01,  1.2531e-01,
        -1.3906e-01,  2.2288e-01, -7.8586e-02,  7.3184e-01, -4.1788e-01,
        -1.0879e-01, -4.0737e-02, -6.1110e-02, -7.9729e-01,  8.3312e-02,
         5.8354e-01,  2.7448e-02, -3.4959e-01, -1.8488e-01, -3.8435e-03,
        -1.4837e-02,  2.4283e-01,  1.9573e-02, -3.2015e-01, -5.4688e-01,
        -1.0675e-01, -8.8442e-02, -3.3864e-01, -8.7835e-02,  1.5286e-01,
        -5.0111e-01, -1.2624e+00, -3.4320e-06,  1.5509e+00,  1.9771e+00,
         1.9546e+00,  7.1260e-01,  1.6179e+00, -2.5331e+00, -5.9443e-02,
        -9.7327e-01,  1.1628e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.5478e-02,  3.8159e-01,  0.0000e+00, -1.1082e+00,
         6.1212e-01, -2.1870e+00,  1.4742e-01,  3.0443e-02,  0.0000e+00,
         0.0000e+00,  1.3705e-02, -1.7713e-01,  1.9624e-02, -6.0341e-02,
         4.7219e-02, -4.3803e-01, -3.5763e-01,  2.3778e-01,  2.6301e-01,
        -4.1376e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6147]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([ 4.5884e-03,  4.9765e-02, -6.3958e-01,  3.6238e-01, -2.6211e-01,
        -4.5410e-01, -2.1801e+00, -1.0535e+00, -5.0918e-01, -3.2670e-01,
        -1.2268e-02,  5.0461e-03, -3.9376e-02, -4.0670e-02,  2.3914e-02,
         2.5567e-01, -1.9601e-01,  5.6621e-02,  2.0582e-01,  1.9670e-02,
         5.4303e-01, -8.8635e-02,  2.0365e-02, -2.9322e-01, -1.5510e-01,
        -5.2580e-03, -6.9155e-01, -9.9206e-01, -6.1416e-01,  2.8934e-02,
        -2.4629e-02, -8.9173e-02,  2.2688e-01, -1.3588e-02, -8.6521e-04,
        -5.1289e-01,  1.0675e-02, -6.0930e-01, -1.5761e-01, -1.0796e+00,
         2.5863e-02,  2.4820e-01,  1.7210e-02,  2.4536e-02,  6.8984e-03,
        -2.3126e-01,  9.4793e-01, -9.2326e-02,  3.9157e-01,  1.1064e+00,
         1.6536e+00, -8.2409e-01, -6.2094e-01, -8.1102e-01, -7.3726e-01,
         7.6105e-03, -1.0737e+00,  1.1574e+00, -7.0059e-04, -7.3457e-01,
        -4.5052e-03, -1.5322e-03,  3.9907e-03,  6.2976e-03,  8.2498e-04,
        -2.7221e-03,  2.9387e-02, -5.5122e+00,  7.3184e-01, -7.9588e-03,
        -1.0879e-01, -4.0737e-02, -6.1110e-02, -9.3162e-02,  9.2216e-03,
        -2.9512e-02,  1.1943e-03, -4.6854e-03,  2.6733e-04, -3.8435e-03,
         1.3799e-01, -2.4547e-01, -3.6935e-01,  7.1472e-01, -3.3434e-01,
        -4.0610e-03, -2.5000e-03,  2.9221e-02,  5.3267e-03,  1.0881e-01,
        -4.2178e-01, -3.7129e-01, -3.4320e-06, -1.3317e+00, -2.4169e+00,
        -9.3624e-01,  1.9813e+00, -1.6256e+00,  8.2424e-01, -9.8591e-01,
         3.8318e-01,  1.1111e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  4.1856e-02,  7.7902e-01,  0.0000e+00, -2.4267e-01,
        -1.7175e-01, -1.5689e+00,  1.2207e-01,  3.0443e-02,  0.0000e+00,
         0.0000e+00,  1.2271e-02, -2.0077e-01,  1.9624e-02, -1.5370e-02,
         4.4105e-03, -2.2916e-04, -2.4002e-02,  2.8235e-01,  2.6622e-01,
        -4.0010e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2864]), tensor(-0.1793))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.7511e-01,  5.3032e-01,  1.2118e-01, -1.3279e+00, -1.1473e-01,
        -6.6547e-01, -1.7965e-01, -3.5902e-01,  3.0039e-01, -1.6157e-01,
        -7.0364e-01,  1.3287e-02, -4.8032e-01, -2.1689e-01,  9.2752e-02,
         5.1136e-01, -1.2770e-01,  2.0288e-01, -8.6807e-02,  4.6755e-01,
        -3.3014e-01, -3.0899e-03,  1.2939e-02,  1.7989e-02, -5.1916e-02,
        -2.6816e-01, -5.6058e-01, -1.8181e-02,  4.0599e-01,  1.0573e+00,
         4.2291e-01, -9.3946e-02,  4.4649e-01, -2.1402e-02, -3.7431e-01,
        -1.8455e-01,  9.1704e-02,  4.7506e-01,  2.3524e-02, -1.1254e+00,
        -3.0536e-01,  2.8104e-01,  2.7996e-01, -9.3432e-02, -1.5500e-01,
        -6.7113e-01,  8.9885e-02, -3.4669e-02, -4.0734e-01, -1.7358e-01,
        -6.8742e-01,  6.7090e-01, -1.3187e-01, -3.4868e-02,  2.6621e-02,
         4.3297e-01, -7.3884e-01,  5.0399e-02, -2.5586e-01, -3.3450e-02,
         1.2930e-01, -3.1684e-01,  1.3231e-01,  2.5136e-01,  1.2800e-01,
        -1.4296e-01,  2.7904e-01, -8.9100e-02,  7.2144e-01, -4.1733e-01,
        -1.5802e-01, -6.1594e-02, -4.7980e-02, -8.0352e-01,  9.5446e-02,
         6.0000e-01,  2.5124e-02, -3.5209e-01, -1.8562e-01,  6.4939e-04,
        -1.6890e-02,  2.5546e-01,  1.9693e-02, -3.2662e-01, -5.4653e-01,
        -1.1026e-01, -9.2396e-02, -3.3079e-01, -7.5383e-02,  1.6134e-01,
        -5.0113e-01, -1.2592e+00,  2.9665e-03,  1.6367e+00,  1.9011e+00,
         2.0545e+00,  4.0982e-01,  1.6419e+00, -2.5976e+00,  5.4995e-02,
        -9.5135e-01,  1.2901e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0600e-02,  5.5131e-01,  0.0000e+00, -1.1747e+00,
         6.5082e-01, -2.0948e+00,  1.5020e-01,  1.9927e-02,  0.0000e+00,
         0.0000e+00,  1.6984e-02, -1.7085e-01,  2.0595e-02, -7.1156e-02,
         5.0707e-02, -4.4174e-01, -3.5503e-01,  2.4983e-01,  2.6954e-01,
        -4.1798e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6456]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([ 6.2201e-03,  4.0160e-02, -4.9216e-01,  5.4931e-01,  2.8609e-01,
        -6.0069e-01, -2.2084e+00, -1.0302e+00, -4.7065e-01, -2.4710e-01,
        -1.4308e-02,  4.9625e-03, -3.6213e-02, -3.3412e-02,  2.1304e-02,
        -1.0237e+00, -1.7729e-01,  6.1705e-01,  1.6484e-01,  1.1458e-02,
         7.6160e-01, -7.4634e-02, -2.4968e-02, -3.4868e-01,  1.4408e-01,
        -8.4063e-03, -6.4430e-01, -7.3839e-01, -1.2763e+00,  3.1663e-02,
        -2.8039e-02, -2.1211e-01,  1.8460e-01, -2.1402e-02,  1.1698e-03,
         1.3698e+00,  1.4487e-02, -6.2328e-01,  4.0902e-01, -1.0097e+00,
        -3.1756e-02, -2.4244e-01,  1.2191e-02,  2.9435e-02,  4.8104e-03,
        -5.0599e-01, -2.1340e-01, -1.4904e-01,  3.2076e-01,  5.2773e-01,
         1.6373e+00, -8.3324e-01, -5.9558e-01, -7.2872e-01, -7.3904e-01,
         5.1056e-03, -1.0694e+00, -4.4086e-02, -7.2391e-03,  2.6464e-01,
        -4.8327e-03, -7.3293e-03,  6.8518e-03,  1.0950e-02,  9.3378e-04,
         3.1050e-03,  2.2322e-02,  1.1238e+00,  5.7967e-02, -1.1165e-02,
        -1.5802e-01, -6.1594e-02, -4.7980e-02, -4.3363e-01,  8.7659e-03,
         2.5548e-02,  6.8801e-04, -4.4530e-03,  6.7547e-04,  6.4939e-04,
         1.2073e-01, -4.7145e-01, -3.6522e-01, -1.7265e-01, -5.0460e-01,
        -4.0603e-03, -3.1113e-03,  2.9184e-02,  4.2500e-03,  1.2579e-01,
        -6.3919e-01,  9.8457e-01,  2.9665e-03, -1.3392e+00, -1.5266e+00,
        -9.6352e-01,  1.8288e+00, -1.6627e+00,  1.2169e+00, -1.1459e+00,
        -9.4967e-01,  2.1429e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.3449e-02,  3.4491e-01,  0.0000e+00,  5.3013e-01,
        -2.8294e-02,  4.7908e-01,  1.0045e-01,  1.9927e-02,  0.0000e+00,
         0.0000e+00,  1.3357e-02,  2.3455e-02,  2.0595e-02, -9.1336e-03,
         8.4218e-03,  1.6526e-03, -2.1462e-02,  1.1496e-01,  1.7460e-01,
        -3.3093e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3069]), tensor(0.0291))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:main_restricted.py:Testing data year: 1992
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 120
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 7233
            device: cpu
            
2024-07-27 05:45:36,603	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 05:45:36,648	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 05:45:36,687	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_573cf030409f7e88.zip' (1.38MiB) to Ray cluster...
2024-07-27 05:45:36,692	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_573cf030409f7e88.zip'.
2024-07-27 05:45:38,028	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 06:02:05,722	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_05-45-38' in 0.2652s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 165, 'num_layers': 1, 'num_embeddings': 7233, 'embedding_dim': 1, 'dropout_rate': 0.53, 'lr': 0.0017996169659044356, 'weight_decay': 0.0001132905062949675, 'num_epochs': 120, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.06713613384283908
INFO:model_data_nn.py:Best trial testing loss: 0.11744405060744612
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-27_05-45-34_334477_752378/artifacts/2024-07-27_05-45-38/train_fnn_2024-07-27_05-45-38/driver_artifacts/train_fnn_1feb5_00080_80_dropout_rate=0.5300,embedding_dim=1,hidden_dim=165,lr=0.0018,num_layers=1,weight_decay=0.0001_2024-07-27_05-45-38
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 165, 'num_layers': 1, 'num_embeddings': 7594, 'embedding_dim': 1, 'dropout_rate': 0.53, 'lr': 0.0017996169659044356, 'weight_decay': 0.0001132905062949675, 'num_epochs': 120, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/120, metrics: {'avg_train_loss': 0.07541811005955944, 'avg_test_loss': 0.09559217908211769}
INFO:model_data_nn.py:Epoch 2/120, metrics: {'avg_train_loss': 0.07214021041647482, 'avg_test_loss': 0.09387424052566182}
INFO:model_data_nn.py:Epoch 3/120, metrics: {'avg_train_loss': 0.0718998996984359, 'avg_test_loss': 0.093745960362979}
INFO:model_data_nn.py:Epoch 4/120, metrics: {'avg_train_loss': 0.07171027657170134, 'avg_test_loss': 0.09463767094973698}
INFO:model_data_nn.py:Epoch 5/120, metrics: {'avg_train_loss': 0.07188161164088137, 'avg_test_loss': 0.09275207067662326}
INFO:model_data_nn.py:Epoch 6/120, metrics: {'avg_train_loss': 0.07169611768048752, 'avg_test_loss': 0.09465936245988317}
INFO:model_data_nn.py:Epoch 7/120, metrics: {'avg_train_loss': 0.07179155935213034, 'avg_test_loss': 0.09372308345582546}
INFO:model_data_nn.py:Epoch 8/120, metrics: {'avg_train_loss': 0.07186008303667112, 'avg_test_loss': 0.09331635532126561}
INFO:model_data_nn.py:Epoch 9/120, metrics: {'avg_train_loss': 0.07172598933492857, 'avg_test_loss': 0.09402894249993855}
INFO:model_data_nn.py:Epoch 10/120, metrics: {'avg_train_loss': 0.07195597025986379, 'avg_test_loss': 0.09386707896775753}
INFO:model_data_nn.py:Epoch 11/120, metrics: {'avg_train_loss': 0.07178404686684489, 'avg_test_loss': 0.09527212909732129}
INFO:model_data_nn.py:Epoch 12/120, metrics: {'avg_train_loss': 0.07186351319360466, 'avg_test_loss': 0.09302303448028713}
INFO:model_data_nn.py:Epoch 13/120, metrics: {'avg_train_loss': 0.07163130095974822, 'avg_test_loss': 0.09350992823797134}
INFO:model_data_nn.py:Epoch 14/120, metrics: {'avg_train_loss': 0.07194489336032905, 'avg_test_loss': 0.09390718237954968}
INFO:model_data_nn.py:Epoch 15/120, metrics: {'avg_train_loss': 0.07181411149717781, 'avg_test_loss': 0.09647216367114424}
INFO:model_data_nn.py:Epoch 16/120, metrics: {'avg_train_loss': 0.07187207957552719, 'avg_test_loss': 0.09262142036137207}
INFO:model_data_nn.py:Epoch 17/120, metrics: {'avg_train_loss': 0.07163568701264664, 'avg_test_loss': 0.0933697524847304}
INFO:model_data_nn.py:Epoch 18/120, metrics: {'avg_train_loss': 0.07183076621243875, 'avg_test_loss': 0.0953503754987177}
INFO:model_data_nn.py:Epoch 19/120, metrics: {'avg_train_loss': 0.07166894393666201, 'avg_test_loss': 0.09326890811912324}
INFO:model_data_nn.py:Epoch 20/120, metrics: {'avg_train_loss': 0.071951635082648, 'avg_test_loss': 0.09330060805097737}
INFO:model_data_nn.py:Epoch 21/120, metrics: {'avg_train_loss': 0.07196675493809895, 'avg_test_loss': 0.09504023483851265}
INFO:model_data_nn.py:Epoch 22/120, metrics: {'avg_train_loss': 0.07182824536549019, 'avg_test_loss': 0.09613678478948542}
INFO:model_data_nn.py:Epoch 23/120, metrics: {'avg_train_loss': 0.07190196547587267, 'avg_test_loss': 0.09701315774337242}
INFO:model_data_nn.py:Epoch 24/120, metrics: {'avg_train_loss': 0.07189699784903707, 'avg_test_loss': 0.09366994871742712}
INFO:model_data_nn.py:Epoch 25/120, metrics: {'avg_train_loss': 0.07192236329196694, 'avg_test_loss': 0.09282149575623648}
INFO:model_data_nn.py:Epoch 26/120, metrics: {'avg_train_loss': 0.07185115898297184, 'avg_test_loss': 0.09371769995328898}
INFO:model_data_nn.py:Epoch 27/120, metrics: {'avg_train_loss': 0.07188971756504596, 'avg_test_loss': 0.0933642321927118}
INFO:model_data_nn.py:Epoch 28/120, metrics: {'avg_train_loss': 0.07185764256945537, 'avg_test_loss': 0.09305710664624095}
INFO:model_data_nn.py:Epoch 29/120, metrics: {'avg_train_loss': 0.07190952981981003, 'avg_test_loss': 0.09583050112988793}
INFO:model_data_nn.py:Epoch 30/120, metrics: {'avg_train_loss': 0.07166006356074658, 'avg_test_loss': 0.09444901347667412}
INFO:model_data_nn.py:Epoch 31/120, metrics: {'avg_train_loss': 0.07190649097043794, 'avg_test_loss': 0.09549634887443048}
INFO:model_data_nn.py:Epoch 32/120, metrics: {'avg_train_loss': 0.0717403501212648, 'avg_test_loss': 0.09592087122488314}
INFO:model_data_nn.py:Epoch 33/120, metrics: {'avg_train_loss': 0.07167713623695786, 'avg_test_loss': 0.0958463574477392}
INFO:model_data_nn.py:Epoch 34/120, metrics: {'avg_train_loss': 0.0718770383467233, 'avg_test_loss': 0.09522294176881034}
INFO:model_data_nn.py:Epoch 35/120, metrics: {'avg_train_loss': 0.07195395024660221, 'avg_test_loss': 0.09347825678244585}
INFO:model_data_nn.py:Epoch 36/120, metrics: {'avg_train_loss': 0.0718681144136451, 'avg_test_loss': 0.09624432604726127}
INFO:model_data_nn.py:Epoch 37/120, metrics: {'avg_train_loss': 0.07226098751305397, 'avg_test_loss': 0.09584003700257808}
INFO:model_data_nn.py:Epoch 38/120, metrics: {'avg_train_loss': 0.07181337941252906, 'avg_test_loss': 0.09828574143809869}
INFO:model_data_nn.py:Epoch 39/120, metrics: {'avg_train_loss': 0.07158165019391793, 'avg_test_loss': 0.09592936241056114}
INFO:model_data_nn.py:Epoch 40/120, metrics: {'avg_train_loss': 0.07179052052892222, 'avg_test_loss': 0.09563754510114175}
INFO:model_data_nn.py:Epoch 41/120, metrics: {'avg_train_loss': 0.07181680094799958, 'avg_test_loss': 0.09487352617923339}
INFO:model_data_nn.py:Epoch 42/120, metrics: {'avg_train_loss': 0.0719288167268821, 'avg_test_loss': 0.09337664012055161}
INFO:model_data_nn.py:Epoch 43/120, metrics: {'avg_train_loss': 0.07180387327650083, 'avg_test_loss': 0.09638930423803857}
INFO:model_data_nn.py:Epoch 44/120, metrics: {'avg_train_loss': 0.07183346845346875, 'avg_test_loss': 0.09487752525132494}
INFO:model_data_nn.py:Epoch 45/120, metrics: {'avg_train_loss': 0.07189608448840451, 'avg_test_loss': 0.09381604179766996}
INFO:model_data_nn.py:Epoch 46/120, metrics: {'avg_train_loss': 0.07183807566671126, 'avg_test_loss': 0.0937077528332274}
INFO:model_data_nn.py:Early stopping at epoch 46
INFO:main_restricted.py:Making prediction for data in year: 1993
INFO:main_restricted.py:Prediction data shape: (17602,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:350: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1993: 0.3061258490850097
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  17602.000000  17602.000000
mean       0.049683      0.024826
std        0.303347      0.048887
min       -0.941177     -0.401559
25%       -0.092593      0.003276
50%        0.012762      0.026452
75%        0.142857      0.044297
max       12.250001      0.462221
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Train_data: (177144, 161)

INFO:transform_data_nn.py:Test data years: [1993]
INFO:transform_data_nn.py:Test_data: (17602, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:transform_data_nn.py:Retrain_data: (194746, 161)

INFO:transform_data_nn.py:Prediction data years: [1994]
INFO:transform_data_nn.py:Prediction_data: (19550, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([177144, 138])
            y_train_tf: torch.Size([177144])

            x_test_tf: torch.Size([17602, 138])
            y_test_tf: torch.Size([17602])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([194746, 138])
            y_retrain_tf: torch.Size([194746])

            x_prediction_tf: torch.Size([19550, 138])
            y_prediction_tf: torch.Size([19550])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.7511e-01,  5.3032e-01,  1.2118e-01, -1.3279e+00, -1.1473e-01,
        -6.6547e-01, -1.7965e-01, -3.5902e-01,  3.0039e-01, -1.6157e-01,
        -7.0364e-01,  1.3287e-02, -4.8032e-01, -2.1689e-01,  9.2752e-02,
         5.1136e-01, -1.2770e-01,  2.0288e-01, -8.6807e-02,  4.6755e-01,
        -3.3014e-01, -3.0899e-03,  1.2939e-02,  1.7989e-02, -5.1916e-02,
        -2.6816e-01, -5.6058e-01, -1.8181e-02,  4.0599e-01,  1.0573e+00,
         4.2291e-01, -9.3946e-02,  4.4649e-01, -2.1402e-02, -3.7431e-01,
        -1.8455e-01,  9.1704e-02,  4.7506e-01,  2.3524e-02, -1.1254e+00,
        -3.0536e-01,  2.8104e-01,  2.7996e-01, -9.3432e-02, -1.5500e-01,
        -6.7113e-01,  8.9885e-02, -3.4669e-02, -4.0734e-01, -1.7358e-01,
        -6.8742e-01,  6.7090e-01, -1.3187e-01, -3.4868e-02,  2.6621e-02,
         4.3297e-01, -7.3884e-01,  5.0399e-02, -2.5586e-01, -3.3450e-02,
         1.2930e-01, -3.1684e-01,  1.3231e-01,  2.5136e-01,  1.2800e-01,
        -1.4296e-01,  2.7904e-01, -8.9100e-02,  7.2144e-01, -4.1733e-01,
        -1.5802e-01, -6.1594e-02, -4.7980e-02, -8.0352e-01,  9.5446e-02,
         6.0000e-01,  2.5124e-02, -3.5209e-01, -1.8562e-01,  6.4939e-04,
        -1.6890e-02,  2.5546e-01,  1.9693e-02, -3.2662e-01, -5.4653e-01,
        -1.1026e-01, -9.2396e-02, -3.3079e-01, -7.5383e-02,  1.6134e-01,
        -5.0113e-01, -1.2592e+00,  2.9665e-03,  1.6367e+00,  1.9011e+00,
         2.0545e+00,  4.0982e-01,  1.6419e+00, -2.5976e+00,  5.4995e-02,
        -9.5135e-01,  1.2901e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0600e-02,  5.5131e-01,  0.0000e+00, -1.1747e+00,
         6.5082e-01, -2.0948e+00,  1.5020e-01,  1.9927e-02,  0.0000e+00,
         0.0000e+00,  1.6984e-02, -1.7085e-01,  2.0595e-02, -7.1156e-02,
         5.0707e-02, -4.4174e-01, -3.5503e-01,  2.4983e-01,  2.6954e-01,
        -4.1798e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6456]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([ 6.2201e-03,  4.0160e-02, -4.9216e-01,  5.4931e-01,  2.8609e-01,
        -6.0069e-01, -2.2084e+00, -1.0302e+00, -4.7065e-01, -2.4710e-01,
        -1.4308e-02,  4.9625e-03, -3.6213e-02, -3.3412e-02,  2.1304e-02,
        -1.0237e+00, -1.7729e-01,  6.1705e-01,  1.6484e-01,  1.1458e-02,
         7.6160e-01, -7.4634e-02, -2.4968e-02, -3.4868e-01,  1.4408e-01,
        -8.4063e-03, -6.4430e-01, -7.3839e-01, -1.2763e+00,  3.1663e-02,
        -2.8039e-02, -2.1211e-01,  1.8460e-01, -2.1402e-02,  1.1698e-03,
         1.3698e+00,  1.4487e-02, -6.2328e-01,  4.0902e-01, -1.0097e+00,
        -3.1756e-02, -2.4244e-01,  1.2191e-02,  2.9435e-02,  4.8104e-03,
        -5.0599e-01, -2.1340e-01, -1.4904e-01,  3.2076e-01,  5.2773e-01,
         1.6373e+00, -8.3324e-01, -5.9558e-01, -7.2872e-01, -7.3904e-01,
         5.1056e-03, -1.0694e+00, -4.4086e-02, -7.2391e-03,  2.6464e-01,
        -4.8327e-03, -7.3293e-03,  6.8518e-03,  1.0950e-02,  9.3378e-04,
         3.1050e-03,  2.2322e-02,  1.1238e+00,  5.7967e-02, -1.1165e-02,
        -1.5802e-01, -6.1594e-02, -4.7980e-02, -4.3363e-01,  8.7659e-03,
         2.5548e-02,  6.8801e-04, -4.4530e-03,  6.7547e-04,  6.4939e-04,
         1.2073e-01, -4.7145e-01, -3.6522e-01, -1.7265e-01, -5.0460e-01,
        -4.0603e-03, -3.1113e-03,  2.9184e-02,  4.2500e-03,  1.2579e-01,
        -6.3919e-01,  9.8457e-01,  2.9665e-03, -1.3392e+00, -1.5266e+00,
        -9.6352e-01,  1.8288e+00, -1.6627e+00,  1.2169e+00, -1.1459e+00,
        -9.4967e-01,  2.1429e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.3449e-02,  3.4491e-01,  0.0000e+00,  5.3013e-01,
        -2.8294e-02,  4.7908e-01,  1.0045e-01,  1.9927e-02,  0.0000e+00,
         0.0000e+00,  1.3357e-02,  2.3455e-02,  2.0595e-02, -9.1336e-03,
         8.4218e-03,  1.6526e-03, -2.1462e-02,  1.1496e-01,  1.7460e-01,
        -3.3093e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3069]), tensor(0.0291))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.1669,  0.5888,  0.1036, -1.3219, -0.1143, -0.6813, -0.1850, -0.3644,
         0.3208, -0.1635, -0.7034,  0.0227, -0.4865, -0.2572,  0.1009,  0.5067,
        -0.1305,  0.2120, -0.0732,  0.4743, -0.3380,  0.0057,  0.0149,  0.0136,
        -0.0537, -0.2743, -0.5612, -0.0210,  0.3845,  1.0975,  0.4100, -0.0973,
         0.4536, -0.0351, -0.3724, -0.1814,  0.0980,  0.4924,  0.0227, -1.1218,
        -0.3089,  0.2602,  0.2824, -0.0835, -0.1526, -0.6815,  0.0777, -0.0463,
        -0.4050, -0.1860, -0.7059,  0.6565, -0.1252, -0.0294,  0.0189,  0.4337,
        -0.7312,  0.0518, -0.2591, -0.0319,  0.1302, -0.3191,  0.1327,  0.2513,
         0.1271, -0.1443,  0.3185, -0.0992,  0.7069, -0.4184, -0.1927, -0.0776,
        -0.0450, -0.8111,  0.1075,  0.6137,  0.0222, -0.3556, -0.1870,  0.0038,
        -0.0102,  0.2538,  0.0352, -0.3280, -0.5492, -0.1148, -0.0973, -0.3225,
        -0.0634,  0.1735, -0.5036, -1.2598,  0.0066,  1.6984,  1.9427,  2.1325,
         0.2193,  1.6729, -2.6897,  0.1787, -0.8928,  0.1270,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0538,  0.5436,  0.0000, -1.2410,  0.6873, -2.1641,
         0.1521,  0.0133,  0.0000,  0.0000,  0.0265, -0.1685,  0.0193, -0.0752,
         0.0659, -0.4429, -0.3589,  0.2582,  0.2740, -0.4163,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([6978]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-1.0950e+00, -1.5362e-01, -7.1802e-01,  7.1595e-01, -7.3885e-02,
        -4.5583e-01, -2.1670e+00, -9.9111e-01, -5.6359e-01, -3.7633e-01,
        -5.5989e-01,  7.3728e-03,  1.0031e-01,  2.8742e-01, -2.1712e-01,
        -3.9971e-02, -2.1449e-01,  2.2596e-01, -7.3246e-02,  1.8080e-01,
        -1.1654e-01, -7.5538e-02, -3.7054e-01,  1.9298e-01,  9.2301e-02,
        -5.2914e-01, -5.9192e-01, -5.7700e-01, -1.0409e+00,  3.7015e-01,
        -4.2835e-01, -3.7255e-02,  2.4777e-01, -3.5072e-02, -7.3016e-01,
         2.6784e-03,  4.2254e-01, -6.3613e-01, -1.4406e-01, -9.4372e-01,
        -1.0650e-01, -1.9294e-01,  6.3178e-01, -2.7989e-01, -1.4918e-01,
        -1.4076e-01,  1.9851e-01,  6.3793e-01,  3.5250e-01, -6.9402e-02,
         7.0255e-02, -7.0042e-01, -5.8644e-01, -6.7527e-01, -7.3775e-01,
         4.5410e-01, -1.0644e+00,  3.5916e-01, -4.3311e-01,  1.6513e-01,
         3.9582e-01, -5.8113e-01, -3.9604e-01, -8.5332e-01, -2.4208e-03,
        -4.9585e-01, -2.8668e-02,  2.7000e+00,  1.3721e+00, -4.1798e-01,
        -1.9274e-01, -7.7553e-02, -4.5049e-02, -8.9308e-02,  4.3926e-02,
         4.8803e-02, -1.8841e-01, -1.3370e-01, -7.9591e-02,  3.7770e-03,
         1.1047e-01,  1.2347e-01, -3.8610e-01,  1.4558e+00,  4.0162e-01,
        -1.0213e-01, -8.9866e-02, -2.9537e-01, -5.4278e-01,  1.9339e-02,
        -6.3314e-02,  1.4176e-01,  6.5806e-03, -1.4075e+00, -1.1267e+00,
        -1.2399e+00,  1.8304e+00, -1.4574e+00,  7.6483e-01, -1.1369e+00,
        -1.0717e+00,  4.8402e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6488e-02, -5.7104e-02,  0.0000e+00,  4.8339e-01,
        -2.0257e-01,  2.5994e-01,  1.3269e-01,  2.1396e+00,  0.0000e+00,
         0.0000e+00, -5.9865e-01, -1.8242e-01, -3.9370e+00,  7.0672e-01,
        -4.0138e-01, -4.5708e-01, -4.2166e-01,  2.4906e-01,  3.2776e-01,
        -3.5330e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5021]), tensor(-0.0517))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:main_restricted.py:Testing data year: 1993
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 120
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 7594
            device: cpu
            
2024-07-27 06:32:42,294	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 06:32:42,339	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 06:32:42,380	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_573cf030409f7e88.zip' (1.38MiB) to Ray cluster...
2024-07-27 06:32:42,385	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_573cf030409f7e88.zip'.
2024-07-27 06:32:43,727	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 07:33:31,706	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_06-32-43' in 0.8218s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 7594, 'embedding_dim': 5, 'dropout_rate': 0.49, 'lr': 0.00979404150646356, 'weight_decay': 6.314559252945832e-06, 'num_epochs': 120, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07695814790631472
INFO:model_data_nn.py:Best trial testing loss: 0.0918582556110058
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-27_06-32-40_012826_752378/artifacts/2024-07-27_06-32-43/train_fnn_2024-07-27_06-32-43/driver_artifacts/train_fnn_b42ac_00021_21_dropout_rate=0.4900,embedding_dim=5,hidden_dim=25,lr=0.0098,num_layers=1,weight_decay=0.0000_2024-07-27_06-32-43
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 8208, 'embedding_dim': 5, 'dropout_rate': 0.49, 'lr': 0.00979404150646356, 'weight_decay': 6.314559252945832e-06, 'num_epochs': 120, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/120, metrics: {'avg_train_loss': 0.07800121746670835, 'avg_test_loss': 0.0982327292469039}
INFO:model_data_nn.py:Epoch 2/120, metrics: {'avg_train_loss': 0.0773855006974772, 'avg_test_loss': 0.0939939485644882}
INFO:model_data_nn.py:Epoch 3/120, metrics: {'avg_train_loss': 0.07715555252749112, 'avg_test_loss': 0.06081060047448901}
INFO:model_data_nn.py:Epoch 4/120, metrics: {'avg_train_loss': 0.077389592323036, 'avg_test_loss': 0.06697814584040554}
INFO:model_data_nn.py:Epoch 5/120, metrics: {'avg_train_loss': 0.07691771360166245, 'avg_test_loss': 0.10694929601475231}
INFO:model_data_nn.py:Epoch 6/120, metrics: {'avg_train_loss': 0.07814724195850789, 'avg_test_loss': 0.08434900785102806}
INFO:model_data_nn.py:Epoch 7/120, metrics: {'avg_train_loss': 0.07827192523727586, 'avg_test_loss': 0.0715099951761444}
INFO:model_data_nn.py:Epoch 8/120, metrics: {'avg_train_loss': 0.07815779609736662, 'avg_test_loss': 0.100249523876933}
INFO:model_data_nn.py:Epoch 9/120, metrics: {'avg_train_loss': 0.0781073314319859, 'avg_test_loss': 0.08041884401834488}
INFO:model_data_nn.py:Epoch 10/120, metrics: {'avg_train_loss': 0.07834844283910784, 'avg_test_loss': 0.09071379625992987}
INFO:model_data_nn.py:Epoch 11/120, metrics: {'avg_train_loss': 0.07818400896635767, 'avg_test_loss': 0.07059402430487977}
INFO:model_data_nn.py:Epoch 12/120, metrics: {'avg_train_loss': 0.0781722619131543, 'avg_test_loss': 0.07654810327740841}
INFO:model_data_nn.py:Epoch 13/120, metrics: {'avg_train_loss': 0.07813459214170758, 'avg_test_loss': 0.07423378354542066}
INFO:model_data_nn.py:Epoch 14/120, metrics: {'avg_train_loss': 0.07827458958359722, 'avg_test_loss': 0.0828533900418485}
INFO:model_data_nn.py:Epoch 15/120, metrics: {'avg_train_loss': 0.07825748807029273, 'avg_test_loss': 0.06667831648787431}
INFO:model_data_nn.py:Epoch 16/120, metrics: {'avg_train_loss': 0.07810686584568184, 'avg_test_loss': 0.073649428383967}
INFO:model_data_nn.py:Epoch 17/120, metrics: {'avg_train_loss': 0.07814121493874433, 'avg_test_loss': 0.07248802845322096}
INFO:model_data_nn.py:Epoch 18/120, metrics: {'avg_train_loss': 0.07811538939772225, 'avg_test_loss': 0.06716700841835814}
INFO:model_data_nn.py:Epoch 19/120, metrics: {'avg_train_loss': 0.0781262859570813, 'avg_test_loss': 0.06375507603257699}
INFO:model_data_nn.py:Epoch 20/120, metrics: {'avg_train_loss': 0.07805203127154772, 'avg_test_loss': 0.06735627898876288}
INFO:model_data_nn.py:Epoch 21/120, metrics: {'avg_train_loss': 0.07793228993558968, 'avg_test_loss': 0.06279971207600275}
INFO:model_data_nn.py:Epoch 22/120, metrics: {'avg_train_loss': 0.07807240341405923, 'avg_test_loss': 0.06378765367794594}
INFO:model_data_nn.py:Epoch 23/120, metrics: {'avg_train_loss': 0.07825339414611474, 'avg_test_loss': 0.06524851358207567}
INFO:model_data_nn.py:Epoch 24/120, metrics: {'avg_train_loss': 0.07820033962690527, 'avg_test_loss': 0.0657524779429827}
INFO:model_data_nn.py:Epoch 25/120, metrics: {'avg_train_loss': 0.078115156863645, 'avg_test_loss': 0.06413430819644574}
INFO:model_data_nn.py:Epoch 26/120, metrics: {'avg_train_loss': 0.078262829877812, 'avg_test_loss': 0.07109366420735704}
INFO:model_data_nn.py:Epoch 27/120, metrics: {'avg_train_loss': 0.07812918487610616, 'avg_test_loss': 0.09860017904386827}
INFO:model_data_nn.py:Epoch 28/120, metrics: {'avg_train_loss': 0.07826565070698455, 'avg_test_loss': 0.06468087980301164}
INFO:model_data_nn.py:Epoch 29/120, metrics: {'avg_train_loss': 0.07813635668734158, 'avg_test_loss': 0.0750325916437112}
INFO:model_data_nn.py:Epoch 30/120, metrics: {'avg_train_loss': 0.07836006144937, 'avg_test_loss': 0.07177890709916865}
INFO:model_data_nn.py:Epoch 31/120, metrics: {'avg_train_loss': 0.07830684445170986, 'avg_test_loss': 0.08026301894343035}
INFO:model_data_nn.py:Epoch 32/120, metrics: {'avg_train_loss': 0.07818855663545422, 'avg_test_loss': 0.07662026849826843}
INFO:model_data_nn.py:Epoch 33/120, metrics: {'avg_train_loss': 0.07833436644393393, 'avg_test_loss': 0.11440715889725377}
INFO:model_data_nn.py:Early stopping at epoch 33
INFO:main_restricted.py:Making prediction for data in year: 1994
INFO:main_restricted.py:Prediction data shape: (19550,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:350: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1994: 0.3382325209514815
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  19550.000000  19550.000000
mean      -0.009021      0.037110
std        0.246687      0.224937
min       -0.941176      0.032103
25%       -0.125000      0.032103
50%       -0.014632      0.032103
75%        0.082227      0.032103
max        6.294121     31.448370
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:transform_data_nn.py:Train_data: (194746, 161)

INFO:transform_data_nn.py:Test data years: [1994]
INFO:transform_data_nn.py:Test_data: (19550, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:transform_data_nn.py:Retrain_data: (214296, 161)

INFO:transform_data_nn.py:Prediction data years: [1995]
INFO:transform_data_nn.py:Prediction_data: (22259, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([194746, 138])
            y_train_tf: torch.Size([194746])

            x_test_tf: torch.Size([19550, 138])
            y_test_tf: torch.Size([19550])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([214296, 138])
            y_retrain_tf: torch.Size([214296])

            x_prediction_tf: torch.Size([22259, 138])
            y_prediction_tf: torch.Size([22259])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-0.1669,  0.5888,  0.1036, -1.3219, -0.1143, -0.6813, -0.1850, -0.3644,
         0.3208, -0.1635, -0.7034,  0.0227, -0.4865, -0.2572,  0.1009,  0.5067,
        -0.1305,  0.2120, -0.0732,  0.4743, -0.3380,  0.0057,  0.0149,  0.0136,
        -0.0537, -0.2743, -0.5612, -0.0210,  0.3845,  1.0975,  0.4100, -0.0973,
         0.4536, -0.0351, -0.3724, -0.1814,  0.0980,  0.4924,  0.0227, -1.1218,
        -0.3089,  0.2602,  0.2824, -0.0835, -0.1526, -0.6815,  0.0777, -0.0463,
        -0.4050, -0.1860, -0.7059,  0.6565, -0.1252, -0.0294,  0.0189,  0.4337,
        -0.7312,  0.0518, -0.2591, -0.0319,  0.1302, -0.3191,  0.1327,  0.2513,
         0.1271, -0.1443,  0.3185, -0.0992,  0.7069, -0.4184, -0.1927, -0.0776,
        -0.0450, -0.8111,  0.1075,  0.6137,  0.0222, -0.3556, -0.1870,  0.0038,
        -0.0102,  0.2538,  0.0352, -0.3280, -0.5492, -0.1148, -0.0973, -0.3225,
        -0.0634,  0.1735, -0.5036, -1.2598,  0.0066,  1.6984,  1.9427,  2.1325,
         0.2193,  1.6729, -2.6897,  0.1787, -0.8928,  0.1270,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0538,  0.5436,  0.0000, -1.2410,  0.6873, -2.1641,
         0.1521,  0.0133,  0.0000,  0.0000,  0.0265, -0.1685,  0.0193, -0.0752,
         0.0659, -0.4429, -0.3589,  0.2582,  0.2740, -0.4163,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([6978]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-1.0950e+00, -1.5362e-01, -7.1802e-01,  7.1595e-01, -7.3885e-02,
        -4.5583e-01, -2.1670e+00, -9.9111e-01, -5.6359e-01, -3.7633e-01,
        -5.5989e-01,  7.3728e-03,  1.0031e-01,  2.8742e-01, -2.1712e-01,
        -3.9971e-02, -2.1449e-01,  2.2596e-01, -7.3246e-02,  1.8080e-01,
        -1.1654e-01, -7.5538e-02, -3.7054e-01,  1.9298e-01,  9.2301e-02,
        -5.2914e-01, -5.9192e-01, -5.7700e-01, -1.0409e+00,  3.7015e-01,
        -4.2835e-01, -3.7255e-02,  2.4777e-01, -3.5072e-02, -7.3016e-01,
         2.6784e-03,  4.2254e-01, -6.3613e-01, -1.4406e-01, -9.4372e-01,
        -1.0650e-01, -1.9294e-01,  6.3178e-01, -2.7989e-01, -1.4918e-01,
        -1.4076e-01,  1.9851e-01,  6.3793e-01,  3.5250e-01, -6.9402e-02,
         7.0255e-02, -7.0042e-01, -5.8644e-01, -6.7527e-01, -7.3775e-01,
         4.5410e-01, -1.0644e+00,  3.5916e-01, -4.3311e-01,  1.6513e-01,
         3.9582e-01, -5.8113e-01, -3.9604e-01, -8.5332e-01, -2.4208e-03,
        -4.9585e-01, -2.8668e-02,  2.7000e+00,  1.3721e+00, -4.1798e-01,
        -1.9274e-01, -7.7553e-02, -4.5049e-02, -8.9308e-02,  4.3926e-02,
         4.8803e-02, -1.8841e-01, -1.3370e-01, -7.9591e-02,  3.7770e-03,
         1.1047e-01,  1.2347e-01, -3.8610e-01,  1.4558e+00,  4.0162e-01,
        -1.0213e-01, -8.9866e-02, -2.9537e-01, -5.4278e-01,  1.9339e-02,
        -6.3314e-02,  1.4176e-01,  6.5806e-03, -1.4075e+00, -1.1267e+00,
        -1.2399e+00,  1.8304e+00, -1.4574e+00,  7.6483e-01, -1.1369e+00,
        -1.0717e+00,  4.8402e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6488e-02, -5.7104e-02,  0.0000e+00,  4.8339e-01,
        -2.0257e-01,  2.5994e-01,  1.3269e-01,  2.1396e+00,  0.0000e+00,
         0.0000e+00, -5.9865e-01, -1.8242e-01, -3.9370e+00,  7.0672e-01,
        -4.0138e-01, -4.5708e-01, -4.2166e-01,  2.4906e-01,  3.2776e-01,
        -3.5330e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5021]), tensor(-0.0517))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.6138e-01,  6.3450e-01,  9.6981e-02, -1.3080e+00, -1.1959e-01,
        -6.9455e-01, -1.8408e-01, -3.6603e-01,  3.4602e-01, -1.6517e-01,
        -7.0044e-01,  3.5450e-02, -4.9125e-01, -2.8845e-01,  1.0510e-01,
         5.0456e-01, -1.3299e-01,  2.2204e-01, -6.2827e-02,  4.7706e-01,
        -3.3099e-01,  1.1276e-02,  6.6511e-03,  8.8014e-03, -5.7867e-02,
        -2.7626e-01, -5.6481e-01, -1.7767e-02,  3.6237e-01,  1.1400e+00,
         4.0725e-01, -1.0241e-01,  4.6180e-01, -2.9825e-02, -3.6021e-01,
        -1.8733e-01,  9.5078e-02,  5.2221e-01,  1.4196e-02, -1.1223e+00,
        -3.1014e-01,  2.8018e-01,  2.7811e-01, -7.3863e-02, -1.5659e-01,
        -6.8839e-01,  8.3863e-02, -3.2747e-02, -4.1685e-01, -1.7848e-01,
        -7.2196e-01,  6.4307e-01, -1.2036e-01, -2.1798e-02,  1.4097e-02,
         4.3111e-01, -7.2384e-01,  6.8795e-02, -2.5934e-01, -3.0069e-02,
         1.2961e-01, -3.1864e-01,  1.3157e-01,  2.5408e-01,  1.2160e-01,
        -1.4858e-01,  3.4747e-01, -1.0941e-01,  6.8888e-01, -4.1828e-01,
        -2.1984e-01, -3.1756e-02, -4.4639e-02, -8.1988e-01,  1.2150e-01,
         6.2742e-01,  2.0417e-02, -3.5962e-01, -1.8665e-01,  6.7417e-03,
        -1.1077e-03,  2.4425e-01,  5.6884e-02, -3.2948e-01, -5.5073e-01,
        -1.1984e-01, -1.0287e-01, -3.1502e-01, -4.3851e-02,  1.7717e-01,
        -5.0642e-01, -1.2600e+00,  1.0965e-02,  1.7803e+00,  2.0508e+00,
         2.2045e+00,  8.3752e-02,  1.7561e+00, -2.8150e+00,  2.9148e-01,
        -8.5039e-01,  1.2211e-01,  0.0000e+00, -1.0546e+00,  0.0000e+00,
         1.5404e+00,  5.2180e-02,  6.0691e-01,  0.0000e+00, -1.3295e+00,
         7.3676e-01, -2.2904e+00,  1.5304e-01,  1.7361e-02,  0.0000e+00,
        -3.9607e-01,  4.4101e-02, -1.6949e-01,  3.3249e-02, -8.2228e-02,
         8.3000e-02, -4.3063e-01, -3.5525e-01,  2.6693e-01,  2.7907e-01,
        -4.1393e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([7813]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-4.8294e-01, -5.4073e-01, -7.6601e-01,  8.6777e-01, -3.0059e-01,
        -2.2299e-01, -1.5585e+00, -9.6941e-01, -4.3036e-01, -3.6043e-01,
        -6.6956e-01,  6.8434e-03, -5.5438e-03,  5.4760e-01, -7.4776e-02,
        -4.6272e-01, -1.7317e-01,  4.1447e-01, -6.2827e-02, -7.4029e-02,
         2.4118e-03, -6.9747e-02, -1.4708e-01, -2.2730e-01, -5.5682e-02,
        -5.5428e-01, -5.8687e-01, -1.7767e-02, -1.3436e+00,  6.6675e-01,
        -3.2284e-02, -1.1997e-01,  2.4504e-01, -2.9825e-02, -7.5459e-01,
        -7.5051e-04,  2.6271e-02, -6.3358e-01,  3.1237e-01, -8.3944e-01,
         2.2254e-01, -1.1148e+00,  9.9344e-02, -2.4154e-01, -3.0358e-01,
        -3.9225e-01, -3.8217e-01, -2.8421e-01,  4.2144e-02, -2.4167e-01,
         1.5758e+00, -7.7319e-01, -4.8150e-01, -6.3692e-01, -7.3569e-01,
         3.6909e-01, -1.0605e+00,  1.0941e-01, -3.3120e-01, -2.1883e-01,
         1.1599e-01, -4.1932e-01, -1.9770e-01,  2.1818e-01, -2.3513e-03,
        -4.2883e-01, -2.6993e-01,  6.9062e-01,  1.3538e+00, -4.6101e-01,
        -2.1984e-01, -3.1756e-02, -4.4639e-02, -8.4792e-02,  3.8531e-02,
        -3.0587e-01, -1.0111e-01, -1.8760e-01, -5.2785e-02,  6.7417e-03,
        -1.1077e-03, -5.0326e-01, -3.4607e-01, -4.9446e-01, -6.5240e-01,
        -1.0350e-01, -9.3501e-02, -3.2932e-01, -6.4154e-01,  1.1695e-01,
        -7.0328e-01,  5.0377e-01,  1.0965e-02, -9.9174e-01, -5.9269e-02,
        -1.1645e+00,  3.5015e-01, -4.5817e-01, -6.3622e-03, -1.2639e+00,
        -6.3468e-01, -2.5567e-01,  0.0000e+00, -1.0546e+00,  0.0000e+00,
         1.5404e+00,  2.0201e-02, -1.3220e-01,  0.0000e+00, -1.8752e-01,
        -4.9769e-01,  8.6243e-01,  1.3005e-01,  7.6998e-01,  0.0000e+00,
        -3.9607e-01, -4.5139e-01, -1.9572e-01, -3.8074e+00,  7.7426e-01,
         2.9990e-01, -5.2928e-01, -4.7617e-01,  2.0270e-01,  2.6195e-01,
        -3.6208e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5537]), tensor(-0.0506))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:main_restricted.py:Testing data year: 1994
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 120
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 8208
            device: cpu
            
2024-07-27 08:05:27,652	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 08:05:27,833	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 08:05:27,883	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_573cf030409f7e88.zip' (1.38MiB) to Ray cluster...
2024-07-27 08:05:27,888	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_573cf030409f7e88.zip'.
2024-07-27 08:05:31,270	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 08:44:28,009	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_08-05-31' in 0.2529s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 8208, 'embedding_dim': 1, 'dropout_rate': 0.49, 'lr': 1.036720427012069e-05, 'weight_decay': 5.503363365456109e-06, 'num_epochs': 120, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07215791919234696
INFO:model_data_nn.py:Best trial testing loss: 0.05990778530700934
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-27_08-05-23_892482_752378/artifacts/2024-07-27_08-05-31/train_fnn_2024-07-27_08-05-31/driver_artifacts/train_fnn_aaae3_00020_20_dropout_rate=0.4900,embedding_dim=1,hidden_dim=85,lr=0.0000,num_layers=4,weight_decay=0.0000_2024-07-27_08-05-31
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 9180, 'embedding_dim': 1, 'dropout_rate': 0.49, 'lr': 1.036720427012069e-05, 'weight_decay': 5.503363365456109e-06, 'num_epochs': 120, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/120, metrics: {'avg_train_loss': 0.08262945254072847, 'avg_test_loss': 0.0845027122882077}
INFO:model_data_nn.py:Epoch 2/120, metrics: {'avg_train_loss': 0.07982683948181236, 'avg_test_loss': 0.08474224623380999}
INFO:model_data_nn.py:Epoch 3/120, metrics: {'avg_train_loss': 0.07937865279299525, 'avg_test_loss': 0.08485613323228926}
INFO:model_data_nn.py:Epoch 4/120, metrics: {'avg_train_loss': 0.07925780257578659, 'avg_test_loss': 0.08455461182366607}
INFO:model_data_nn.py:Epoch 5/120, metrics: {'avg_train_loss': 0.07916600028047642, 'avg_test_loss': 0.0848868850795231}
INFO:model_data_nn.py:Epoch 6/120, metrics: {'avg_train_loss': 0.07906128344613748, 'avg_test_loss': 0.08518142683228114}
INFO:model_data_nn.py:Epoch 7/120, metrics: {'avg_train_loss': 0.07889505987771371, 'avg_test_loss': 0.08518989466869369}
INFO:model_data_nn.py:Epoch 8/120, metrics: {'avg_train_loss': 0.07866050982457036, 'avg_test_loss': 0.08563960536086032}
INFO:model_data_nn.py:Epoch 9/120, metrics: {'avg_train_loss': 0.07842106076742582, 'avg_test_loss': 0.08599189176002046}
INFO:model_data_nn.py:Epoch 10/120, metrics: {'avg_train_loss': 0.07808273342004575, 'avg_test_loss': 0.08677371359502511}
INFO:model_data_nn.py:Epoch 11/120, metrics: {'avg_train_loss': 0.07786717594220036, 'avg_test_loss': 0.08649142378347059}
INFO:model_data_nn.py:Epoch 12/120, metrics: {'avg_train_loss': 0.07763229280919375, 'avg_test_loss': 0.08723105165248352}
INFO:model_data_nn.py:Epoch 13/120, metrics: {'avg_train_loss': 0.07731390018246949, 'avg_test_loss': 0.08714072771662118}
INFO:model_data_nn.py:Epoch 14/120, metrics: {'avg_train_loss': 0.07705881456654406, 'avg_test_loss': 0.08810556279736217}
INFO:model_data_nn.py:Epoch 15/120, metrics: {'avg_train_loss': 0.07673842983179342, 'avg_test_loss': 0.0877575545528925}
INFO:model_data_nn.py:Epoch 16/120, metrics: {'avg_train_loss': 0.07665059376203166, 'avg_test_loss': 0.0877674319219358}
INFO:model_data_nn.py:Epoch 17/120, metrics: {'avg_train_loss': 0.0764656714297919, 'avg_test_loss': 0.08817085222375912}
INFO:model_data_nn.py:Epoch 18/120, metrics: {'avg_train_loss': 0.07626123907820795, 'avg_test_loss': 0.08843290028978545}
INFO:model_data_nn.py:Epoch 19/120, metrics: {'avg_train_loss': 0.07607262123810572, 'avg_test_loss': 0.08852728059777626}
INFO:model_data_nn.py:Epoch 20/120, metrics: {'avg_train_loss': 0.07585463056704331, 'avg_test_loss': 0.08880913940702576}
INFO:model_data_nn.py:Epoch 21/120, metrics: {'avg_train_loss': 0.07581294282054846, 'avg_test_loss': 0.08858610581119555}
INFO:model_data_nn.py:Epoch 22/120, metrics: {'avg_train_loss': 0.07558942193962824, 'avg_test_loss': 0.08799610374864705}
INFO:model_data_nn.py:Epoch 23/120, metrics: {'avg_train_loss': 0.07549895927931892, 'avg_test_loss': 0.0892591724552257}
INFO:model_data_nn.py:Epoch 24/120, metrics: {'avg_train_loss': 0.07538803509421668, 'avg_test_loss': 0.08943133860433089}
INFO:model_data_nn.py:Epoch 25/120, metrics: {'avg_train_loss': 0.07528185612557249, 'avg_test_loss': 0.08933295180550081}
INFO:model_data_nn.py:Epoch 26/120, metrics: {'avg_train_loss': 0.07516275997342739, 'avg_test_loss': 0.08883627615373946}
INFO:model_data_nn.py:Epoch 27/120, metrics: {'avg_train_loss': 0.07504397168256564, 'avg_test_loss': 0.0888584703207016}
INFO:model_data_nn.py:Epoch 28/120, metrics: {'avg_train_loss': 0.0747976427586582, 'avg_test_loss': 0.08918997090331268}
INFO:model_data_nn.py:Epoch 29/120, metrics: {'avg_train_loss': 0.07477342551544908, 'avg_test_loss': 0.08909830684712071}
INFO:model_data_nn.py:Epoch 30/120, metrics: {'avg_train_loss': 0.07473820086420628, 'avg_test_loss': 0.08934274380196999}
INFO:model_data_nn.py:Epoch 31/120, metrics: {'avg_train_loss': 0.07457849620975641, 'avg_test_loss': 0.08885984178886738}
INFO:model_data_nn.py:Early stopping at epoch 31
INFO:main_restricted.py:Making prediction for data in year: 1995
INFO:main_restricted.py:Prediction data shape: (22259,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:350: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1995: 0.2981191847799295
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  22259.000000  22259.000000
mean       0.068422     -0.014275
std        0.287634      0.028809
min       -0.950000     -0.210673
25%       -0.062810     -0.032186
50%        0.041558     -0.015358
75%        0.165696      0.004063
max        4.272732      0.170837
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:transform_data_nn.py:Train_data: (214296, 161)

INFO:transform_data_nn.py:Test data years: [1995]
INFO:transform_data_nn.py:Test_data: (22259, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:transform_data_nn.py:Retrain_data: (236555, 161)

INFO:transform_data_nn.py:Prediction data years: [1996]
INFO:transform_data_nn.py:Prediction_data: (22619, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([214296, 138])
            y_train_tf: torch.Size([214296])

            x_test_tf: torch.Size([22259, 138])
            y_test_tf: torch.Size([22259])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([236555, 138])
            y_retrain_tf: torch.Size([236555])

            x_prediction_tf: torch.Size([22619, 138])
            y_prediction_tf: torch.Size([22619])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.6138e-01,  6.3450e-01,  9.6981e-02, -1.3080e+00, -1.1959e-01,
        -6.9455e-01, -1.8408e-01, -3.6603e-01,  3.4602e-01, -1.6517e-01,
        -7.0044e-01,  3.5450e-02, -4.9125e-01, -2.8845e-01,  1.0510e-01,
         5.0456e-01, -1.3299e-01,  2.2204e-01, -6.2827e-02,  4.7706e-01,
        -3.3099e-01,  1.1276e-02,  6.6511e-03,  8.8014e-03, -5.7867e-02,
        -2.7626e-01, -5.6481e-01, -1.7767e-02,  3.6237e-01,  1.1400e+00,
         4.0725e-01, -1.0241e-01,  4.6180e-01, -2.9825e-02, -3.6021e-01,
        -1.8733e-01,  9.5078e-02,  5.2221e-01,  1.4196e-02, -1.1223e+00,
        -3.1014e-01,  2.8018e-01,  2.7811e-01, -7.3863e-02, -1.5659e-01,
        -6.8839e-01,  8.3863e-02, -3.2747e-02, -4.1685e-01, -1.7848e-01,
        -7.2196e-01,  6.4307e-01, -1.2036e-01, -2.1798e-02,  1.4097e-02,
         4.3111e-01, -7.2384e-01,  6.8795e-02, -2.5934e-01, -3.0069e-02,
         1.2961e-01, -3.1864e-01,  1.3157e-01,  2.5408e-01,  1.2160e-01,
        -1.4858e-01,  3.4747e-01, -1.0941e-01,  6.8888e-01, -4.1828e-01,
        -2.1984e-01, -3.1756e-02, -4.4639e-02, -8.1988e-01,  1.2150e-01,
         6.2742e-01,  2.0417e-02, -3.5962e-01, -1.8665e-01,  6.7417e-03,
        -1.1077e-03,  2.4425e-01,  5.6884e-02, -3.2948e-01, -5.5073e-01,
        -1.1984e-01, -1.0287e-01, -3.1502e-01, -4.3851e-02,  1.7717e-01,
        -5.0642e-01, -1.2600e+00,  1.0965e-02,  1.7803e+00,  2.0508e+00,
         2.2045e+00,  8.3752e-02,  1.7561e+00, -2.8150e+00,  2.9148e-01,
        -8.5039e-01,  1.2211e-01,  0.0000e+00, -1.0546e+00,  0.0000e+00,
         1.5404e+00,  5.2180e-02,  6.0691e-01,  0.0000e+00, -1.3295e+00,
         7.3676e-01, -2.2904e+00,  1.5304e-01,  1.7361e-02,  0.0000e+00,
        -3.9607e-01,  4.4101e-02, -1.6949e-01,  3.3249e-02, -8.2228e-02,
         8.3000e-02, -4.3063e-01, -3.5525e-01,  2.6693e-01,  2.7907e-01,
        -4.1393e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([7813]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-4.8294e-01, -5.4073e-01, -7.6601e-01,  8.6777e-01, -3.0059e-01,
        -2.2299e-01, -1.5585e+00, -9.6941e-01, -4.3036e-01, -3.6043e-01,
        -6.6956e-01,  6.8434e-03, -5.5438e-03,  5.4760e-01, -7.4776e-02,
        -4.6272e-01, -1.7317e-01,  4.1447e-01, -6.2827e-02, -7.4029e-02,
         2.4118e-03, -6.9747e-02, -1.4708e-01, -2.2730e-01, -5.5682e-02,
        -5.5428e-01, -5.8687e-01, -1.7767e-02, -1.3436e+00,  6.6675e-01,
        -3.2284e-02, -1.1997e-01,  2.4504e-01, -2.9825e-02, -7.5459e-01,
        -7.5051e-04,  2.6271e-02, -6.3358e-01,  3.1237e-01, -8.3944e-01,
         2.2254e-01, -1.1148e+00,  9.9344e-02, -2.4154e-01, -3.0358e-01,
        -3.9225e-01, -3.8217e-01, -2.8421e-01,  4.2144e-02, -2.4167e-01,
         1.5758e+00, -7.7319e-01, -4.8150e-01, -6.3692e-01, -7.3569e-01,
         3.6909e-01, -1.0605e+00,  1.0941e-01, -3.3120e-01, -2.1883e-01,
         1.1599e-01, -4.1932e-01, -1.9770e-01,  2.1818e-01, -2.3513e-03,
        -4.2883e-01, -2.6993e-01,  6.9062e-01,  1.3538e+00, -4.6101e-01,
        -2.1984e-01, -3.1756e-02, -4.4639e-02, -8.4792e-02,  3.8531e-02,
        -3.0587e-01, -1.0111e-01, -1.8760e-01, -5.2785e-02,  6.7417e-03,
        -1.1077e-03, -5.0326e-01, -3.4607e-01, -4.9446e-01, -6.5240e-01,
        -1.0350e-01, -9.3501e-02, -3.2932e-01, -6.4154e-01,  1.1695e-01,
        -7.0328e-01,  5.0377e-01,  1.0965e-02, -9.9174e-01, -5.9269e-02,
        -1.1645e+00,  3.5015e-01, -4.5817e-01, -6.3622e-03, -1.2639e+00,
        -6.3468e-01, -2.5567e-01,  0.0000e+00, -1.0546e+00,  0.0000e+00,
         1.5404e+00,  2.0201e-02, -1.3220e-01,  0.0000e+00, -1.8752e-01,
        -4.9769e-01,  8.6243e-01,  1.3005e-01,  7.6998e-01,  0.0000e+00,
        -3.9607e-01, -4.5139e-01, -1.9572e-01, -3.8074e+00,  7.7426e-01,
         2.9990e-01, -5.2928e-01, -4.7617e-01,  2.0270e-01,  2.6195e-01,
        -3.6208e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5537]), tensor(-0.0506))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.5465e-01,  6.6885e-01,  8.5476e-02, -1.2872e+00, -1.2682e-01,
        -7.0710e-01, -1.7775e-01, -3.6445e-01,  3.6850e-01, -1.7035e-01,
        -6.9521e-01,  4.6163e-02, -4.8957e-01, -3.1484e-01,  1.0988e-01,
         5.0111e-01, -1.3360e-01,  2.3042e-01, -5.9369e-02,  4.7335e-01,
        -3.5575e-01,  6.9554e-03, -1.5421e-02,  1.9538e-03, -5.8418e-02,
        -2.7375e-01, -5.7194e-01, -1.5993e-02,  3.4099e-01,  1.1822e+00,
         4.0172e-01, -1.0509e-01,  4.6804e-01, -2.7462e-02, -3.4340e-01,
        -1.9804e-01,  8.5568e-02,  5.5779e-01,  3.2951e-03, -1.1233e+00,
        -3.1047e-01,  3.0597e-01,  2.6816e-01, -7.1363e-02, -1.6457e-01,
        -6.9600e-01,  9.3016e-02, -4.4227e-02, -4.1794e-01, -1.8607e-01,
        -7.3816e-01,  6.3137e-01, -1.1456e-01, -1.6210e-02,  2.6085e-03,
         4.2819e-01, -7.1177e-01,  7.6150e-02, -2.5529e-01, -2.0217e-02,
         1.2886e-01, -3.1347e-01,  1.3228e-01,  2.5872e-01,  1.1666e-01,
        -1.5427e-01,  3.6959e-01, -1.1485e-01,  6.7589e-01, -4.1543e-01,
        -2.3957e-01, -4.1940e-02, -8.1201e-03, -8.2637e-01,  1.3267e-01,
         6.3311e-01,  1.7659e-02, -3.6415e-01, -1.8467e-01,  6.6376e-03,
        -2.0541e-03,  2.3300e-01,  7.8207e-02, -3.3225e-01, -5.5213e-01,
        -1.2473e-01, -1.0838e-01, -3.0840e-01, -2.1037e-02,  1.7360e-01,
        -5.0841e-01, -1.2612e+00,  1.2012e-02,  1.8212e+00,  2.1685e+00,
         2.2888e+00,  7.5983e-02,  1.8721e+00, -2.8702e+00,  4.0568e-01,
        -7.9586e-01,  1.1003e-01,  7.1534e-01,  1.9921e-01, -2.0874e-01,
         2.9136e-01,  4.8129e-02,  4.9181e-01,  0.0000e+00, -1.3169e+00,
         8.2750e-01, -2.4208e+00,  1.5395e-01,  3.5656e-02,  0.0000e+00,
        -1.1729e-01,  7.0280e-02, -1.7483e-01,  1.7692e-02, -9.2213e-02,
         9.6501e-02, -4.1147e-01, -3.4738e-01,  2.7235e-01,  2.8255e-01,
        -4.1445e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([8551]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.4706e-01, -5.8692e-01, -5.1251e-01,  1.0123e+00, -8.8275e-02,
        -1.8575e-01, -6.2726e-01, -6.5006e-01, -4.6369e-01, -4.1597e-01,
        -7.1277e-01,  2.3876e-02, -1.2728e-01,  5.5995e-01,  1.4051e-01,
         6.9417e-02, -2.1466e-01,  3.2960e-01, -1.8060e-01,  1.3972e-01,
         2.0362e-01, -6.4095e-02, -2.0622e-02, -2.2984e-01,  8.8198e-02,
        -5.9688e-01, -6.0876e-01, -1.5993e-02, -1.2960e+00,  5.8608e-01,
        -4.4832e-01, -6.6236e-02,  2.4729e-01, -2.7462e-02, -7.3220e-01,
        -5.9738e-02,  2.4769e-01, -6.3787e-01, -6.7517e-02, -8.8688e-01,
        -1.0564e-03,  1.8863e-01,  2.6198e-01, -2.5534e-01, -1.5373e-01,
         2.0762e-01, -9.4873e-03,  5.7696e-01, -1.2216e-01,  2.9324e-02,
         1.5413e+00, -6.9475e-01, -5.9335e-01, -6.0518e-01, -7.3726e-01,
         3.9733e-01, -1.0525e+00,  3.6123e-01, -5.0060e-01, -3.7416e-01,
         1.0904e-01, -5.2580e-01, -2.1244e-01,  6.7539e-02, -3.0935e-03,
        -4.0521e-01, -2.7154e-01, -5.1469e-02,  1.3419e+00, -5.0704e-01,
        -2.3957e-01, -4.1940e-02, -8.1201e-03,  8.1635e-02,  5.7545e-02,
        -8.2888e-02,  8.5503e-02, -2.2786e-01, -5.5072e-02,  6.6376e-03,
         1.2189e-01, -6.5599e-02, -3.4642e-01,  1.1322e+00, -4.0199e-01,
        -1.0438e-01, -9.7048e-02, -3.5142e-01, -5.6331e-01,  2.5259e-01,
        -5.2920e-01, -6.4311e-01,  1.2012e-02, -1.8836e+00, -6.2020e-01,
        -1.2011e+00,  3.0616e-01, -5.9280e-01, -9.7377e-01, -1.0392e+00,
        -4.6702e-01,  9.3573e-02,  7.1534e-01, -3.6527e+00, -2.0874e-01,
         5.5889e+00,  2.1032e-02,  7.4366e-01,  0.0000e+00, -3.4124e-01,
        -8.1074e-01,  4.4621e-01,  1.3354e-01,  1.2521e+00,  0.0000e+00,
        -1.1729e-01, -3.9310e-01, -1.5445e-01, -3.7710e+00,  7.2779e-01,
         5.2095e-02, -4.8817e-01, -5.1235e-01,  2.2483e-01,  2.8419e-01,
        -3.8822e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5674]), tensor(0.0223))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:main_restricted.py:Testing data year: 1995
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 120
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 9180
            device: cpu
            
2024-07-27 09:22:51,947	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 09:22:52,021	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 09:22:52,059	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_573cf030409f7e88.zip' (1.38MiB) to Ray cluster...
2024-07-27 09:22:52,065	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_573cf030409f7e88.zip'.
2024-07-27 09:22:53,478	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 10:46:33,207	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_09-22-53' in 0.2313s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 9180, 'embedding_dim': 5, 'dropout_rate': 0.49, 'lr': 0.00979404150646356, 'weight_decay': 6.314559252945832e-06, 'num_epochs': 120, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07659698148213946
INFO:model_data_nn.py:Best trial testing loss: 0.08371409084634512
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-27_09-22-49_526013_752378/artifacts/2024-07-27_09-22-53/train_fnn_2024-07-27_09-22-53/driver_artifacts/train_fnn_79a70_00021_21_dropout_rate=0.4900,embedding_dim=5,hidden_dim=25,lr=0.0098,num_layers=1,weight_decay=0.0000_2024-07-27_09-22-53
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 10061, 'embedding_dim': 5, 'dropout_rate': 0.49, 'lr': 0.00979404150646356, 'weight_decay': 6.314559252945832e-06, 'num_epochs': 120, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/120, metrics: {'avg_train_loss': 0.07737040232708779, 'avg_test_loss': 0.08558250395936794}
INFO:model_data_nn.py:Epoch 2/120, metrics: {'avg_train_loss': 0.07624821473229472, 'avg_test_loss': 0.08584600145753363}
INFO:model_data_nn.py:Epoch 3/120, metrics: {'avg_train_loss': 0.07627921406936515, 'avg_test_loss': 0.09039231117082368}
INFO:model_data_nn.py:Epoch 4/120, metrics: {'avg_train_loss': 0.07622982453502967, 'avg_test_loss': 0.09092520749989418}
INFO:model_data_nn.py:Epoch 5/120, metrics: {'avg_train_loss': 0.07649142336479269, 'avg_test_loss': 0.0879701076396853}
INFO:model_data_nn.py:Epoch 6/120, metrics: {'avg_train_loss': 0.07680150035775801, 'avg_test_loss': 0.08485465149541387}
INFO:model_data_nn.py:Epoch 7/120, metrics: {'avg_train_loss': 0.077430515421206, 'avg_test_loss': 0.0846881825829918}
INFO:model_data_nn.py:Epoch 8/120, metrics: {'avg_train_loss': 0.07775901475900865, 'avg_test_loss': 0.08538107028365388}
INFO:model_data_nn.py:Epoch 9/120, metrics: {'avg_train_loss': 0.07770081222874659, 'avg_test_loss': 0.08393785557966506}
INFO:model_data_nn.py:Epoch 10/120, metrics: {'avg_train_loss': 0.077669508703054, 'avg_test_loss': 0.08555769357076798}
INFO:model_data_nn.py:Epoch 11/120, metrics: {'avg_train_loss': 0.07767245856923868, 'avg_test_loss': 0.08436200104764488}
INFO:model_data_nn.py:Epoch 12/120, metrics: {'avg_train_loss': 0.07780419797991184, 'avg_test_loss': 0.08687060258497485}
INFO:model_data_nn.py:Epoch 13/120, metrics: {'avg_train_loss': 0.07779712014199593, 'avg_test_loss': 0.0840964173052402}
INFO:model_data_nn.py:Epoch 14/120, metrics: {'avg_train_loss': 0.07769175673811422, 'avg_test_loss': 0.08521346511026842}
INFO:model_data_nn.py:Epoch 15/120, metrics: {'avg_train_loss': 0.0777687298521464, 'avg_test_loss': 0.08553995457747912}
INFO:model_data_nn.py:Epoch 16/120, metrics: {'avg_train_loss': 0.07777104577172815, 'avg_test_loss': 0.08627878337086849}
INFO:model_data_nn.py:Epoch 17/120, metrics: {'avg_train_loss': 0.07778070859263851, 'avg_test_loss': 0.08398267366466293}
INFO:model_data_nn.py:Epoch 18/120, metrics: {'avg_train_loss': 0.07773670757419421, 'avg_test_loss': 0.08548392724677857}
INFO:model_data_nn.py:Epoch 19/120, metrics: {'avg_train_loss': 0.07766507067762332, 'avg_test_loss': 0.08559439702900035}
INFO:model_data_nn.py:Epoch 20/120, metrics: {'avg_train_loss': 0.07780336972953893, 'avg_test_loss': 0.08396268553394282}
INFO:model_data_nn.py:Epoch 21/120, metrics: {'avg_train_loss': 0.07785160784041097, 'avg_test_loss': 0.08590762152256183}
INFO:model_data_nn.py:Epoch 22/120, metrics: {'avg_train_loss': 0.07766781787816462, 'avg_test_loss': 0.08421646476666611}
INFO:model_data_nn.py:Epoch 23/120, metrics: {'avg_train_loss': 0.07786330058047039, 'avg_test_loss': 0.08647397603797483}
INFO:model_data_nn.py:Epoch 24/120, metrics: {'avg_train_loss': 0.07789372021477757, 'avg_test_loss': 0.08511550259108548}
INFO:model_data_nn.py:Epoch 25/120, metrics: {'avg_train_loss': 0.07783966472121222, 'avg_test_loss': 0.08489278903892303}
INFO:model_data_nn.py:Epoch 26/120, metrics: {'avg_train_loss': 0.07786431494053671, 'avg_test_loss': 0.0846543486086491}
INFO:model_data_nn.py:Epoch 27/120, metrics: {'avg_train_loss': 0.0777772045615558, 'avg_test_loss': 0.08517748555708597}
INFO:model_data_nn.py:Epoch 28/120, metrics: {'avg_train_loss': 0.0778121317915813, 'avg_test_loss': 0.08671536241938614}
INFO:model_data_nn.py:Epoch 29/120, metrics: {'avg_train_loss': 0.07781514997524647, 'avg_test_loss': 0.08416377262066117}
INFO:model_data_nn.py:Epoch 30/120, metrics: {'avg_train_loss': 0.07768940008397207, 'avg_test_loss': 0.08501457109852381}
INFO:model_data_nn.py:Epoch 31/120, metrics: {'avg_train_loss': 0.07787855223212257, 'avg_test_loss': 0.08423414807028995}
INFO:model_data_nn.py:Epoch 32/120, metrics: {'avg_train_loss': 0.07773517689962546, 'avg_test_loss': 0.0843050577974176}
INFO:model_data_nn.py:Epoch 33/120, metrics: {'avg_train_loss': 0.07792261131858609, 'avg_test_loss': 0.08586677592616565}
INFO:model_data_nn.py:Epoch 34/120, metrics: {'avg_train_loss': 0.07778606661549424, 'avg_test_loss': 0.08438908871226382}
INFO:model_data_nn.py:Epoch 35/120, metrics: {'avg_train_loss': 0.07781814365440759, 'avg_test_loss': 0.08401605883241754}
INFO:model_data_nn.py:Epoch 36/120, metrics: {'avg_train_loss': 0.07768811360248472, 'avg_test_loss': 0.0840869749826412}
INFO:model_data_nn.py:Epoch 37/120, metrics: {'avg_train_loss': 0.07781142706421075, 'avg_test_loss': 0.08436604620048399}
INFO:model_data_nn.py:Epoch 38/120, metrics: {'avg_train_loss': 0.07777021908985211, 'avg_test_loss': 0.08415141768221344}
INFO:model_data_nn.py:Epoch 39/120, metrics: {'avg_train_loss': 0.0777914123004989, 'avg_test_loss': 0.08544813446394962}
INFO:model_data_nn.py:Early stopping at epoch 39
INFO:main_restricted.py:Making prediction for data in year: 1996
INFO:main_restricted.py:Prediction data shape: (22619,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:350: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1996: 0.2923002729012173
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  22619.000000  22619.000000
mean       0.044741      0.030248
std        0.289333      0.039120
min       -0.961538      0.006239
25%       -0.085714      0.023723
50%        0.018182      0.023723
75%        0.140416      0.023723
max       10.111111      1.229592
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:transform_data_nn.py:Train_data: (236555, 161)

INFO:transform_data_nn.py:Test data years: [1996]
INFO:transform_data_nn.py:Test_data: (22619, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:transform_data_nn.py:Retrain_data: (259174, 161)

INFO:transform_data_nn.py:Prediction data years: [1997]
INFO:transform_data_nn.py:Prediction_data: (23999, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([236555, 138])
            y_train_tf: torch.Size([236555])

            x_test_tf: torch.Size([22619, 138])
            y_test_tf: torch.Size([22619])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([259174, 138])
            y_retrain_tf: torch.Size([259174])

            x_prediction_tf: torch.Size([23999, 138])
            y_prediction_tf: torch.Size([23999])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.5465e-01,  6.6885e-01,  8.5476e-02, -1.2872e+00, -1.2682e-01,
        -7.0710e-01, -1.7775e-01, -3.6445e-01,  3.6850e-01, -1.7035e-01,
        -6.9521e-01,  4.6163e-02, -4.8957e-01, -3.1484e-01,  1.0988e-01,
         5.0111e-01, -1.3360e-01,  2.3042e-01, -5.9369e-02,  4.7335e-01,
        -3.5575e-01,  6.9554e-03, -1.5421e-02,  1.9538e-03, -5.8418e-02,
        -2.7375e-01, -5.7194e-01, -1.5993e-02,  3.4099e-01,  1.1822e+00,
         4.0172e-01, -1.0509e-01,  4.6804e-01, -2.7462e-02, -3.4340e-01,
        -1.9804e-01,  8.5568e-02,  5.5779e-01,  3.2951e-03, -1.1233e+00,
        -3.1047e-01,  3.0597e-01,  2.6816e-01, -7.1363e-02, -1.6457e-01,
        -6.9600e-01,  9.3016e-02, -4.4227e-02, -4.1794e-01, -1.8607e-01,
        -7.3816e-01,  6.3137e-01, -1.1456e-01, -1.6210e-02,  2.6085e-03,
         4.2819e-01, -7.1177e-01,  7.6150e-02, -2.5529e-01, -2.0217e-02,
         1.2886e-01, -3.1347e-01,  1.3228e-01,  2.5872e-01,  1.1666e-01,
        -1.5427e-01,  3.6959e-01, -1.1485e-01,  6.7589e-01, -4.1543e-01,
        -2.3957e-01, -4.1940e-02, -8.1201e-03, -8.2637e-01,  1.3267e-01,
         6.3311e-01,  1.7659e-02, -3.6415e-01, -1.8467e-01,  6.6376e-03,
        -2.0541e-03,  2.3300e-01,  7.8207e-02, -3.3225e-01, -5.5213e-01,
        -1.2473e-01, -1.0838e-01, -3.0840e-01, -2.1037e-02,  1.7360e-01,
        -5.0841e-01, -1.2612e+00,  1.2012e-02,  1.8212e+00,  2.1685e+00,
         2.2888e+00,  7.5983e-02,  1.8721e+00, -2.8702e+00,  4.0568e-01,
        -7.9586e-01,  1.1003e-01,  7.1534e-01,  1.9921e-01, -2.0874e-01,
         2.9136e-01,  4.8129e-02,  4.9181e-01,  0.0000e+00, -1.3169e+00,
         8.2750e-01, -2.4208e+00,  1.5395e-01,  3.5656e-02,  0.0000e+00,
        -1.1729e-01,  7.0280e-02, -1.7483e-01,  1.7692e-02, -9.2213e-02,
         9.6501e-02, -4.1147e-01, -3.4738e-01,  2.7235e-01,  2.8255e-01,
        -4.1445e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([8551]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-3.4706e-01, -5.8692e-01, -5.1251e-01,  1.0123e+00, -8.8275e-02,
        -1.8575e-01, -6.2726e-01, -6.5006e-01, -4.6369e-01, -4.1597e-01,
        -7.1277e-01,  2.3876e-02, -1.2728e-01,  5.5995e-01,  1.4051e-01,
         6.9417e-02, -2.1466e-01,  3.2960e-01, -1.8060e-01,  1.3972e-01,
         2.0362e-01, -6.4095e-02, -2.0622e-02, -2.2984e-01,  8.8198e-02,
        -5.9688e-01, -6.0876e-01, -1.5993e-02, -1.2960e+00,  5.8608e-01,
        -4.4832e-01, -6.6236e-02,  2.4729e-01, -2.7462e-02, -7.3220e-01,
        -5.9738e-02,  2.4769e-01, -6.3787e-01, -6.7517e-02, -8.8688e-01,
        -1.0564e-03,  1.8863e-01,  2.6198e-01, -2.5534e-01, -1.5373e-01,
         2.0762e-01, -9.4873e-03,  5.7696e-01, -1.2216e-01,  2.9324e-02,
         1.5413e+00, -6.9475e-01, -5.9335e-01, -6.0518e-01, -7.3726e-01,
         3.9733e-01, -1.0525e+00,  3.6123e-01, -5.0060e-01, -3.7416e-01,
         1.0904e-01, -5.2580e-01, -2.1244e-01,  6.7539e-02, -3.0935e-03,
        -4.0521e-01, -2.7154e-01, -5.1469e-02,  1.3419e+00, -5.0704e-01,
        -2.3957e-01, -4.1940e-02, -8.1201e-03,  8.1635e-02,  5.7545e-02,
        -8.2888e-02,  8.5503e-02, -2.2786e-01, -5.5072e-02,  6.6376e-03,
         1.2189e-01, -6.5599e-02, -3.4642e-01,  1.1322e+00, -4.0199e-01,
        -1.0438e-01, -9.7048e-02, -3.5142e-01, -5.6331e-01,  2.5259e-01,
        -5.2920e-01, -6.4311e-01,  1.2012e-02, -1.8836e+00, -6.2020e-01,
        -1.2011e+00,  3.0616e-01, -5.9280e-01, -9.7377e-01, -1.0392e+00,
        -4.6702e-01,  9.3573e-02,  7.1534e-01, -3.6527e+00, -2.0874e-01,
         5.5889e+00,  2.1032e-02,  7.4366e-01,  0.0000e+00, -3.4124e-01,
        -8.1074e-01,  4.4621e-01,  1.3354e-01,  1.2521e+00,  0.0000e+00,
        -1.1729e-01, -3.9310e-01, -1.5445e-01, -3.7710e+00,  7.2779e-01,
         5.2095e-02, -4.8817e-01, -5.1235e-01,  2.2483e-01,  2.8419e-01,
        -3.8822e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5674]), tensor(0.0223))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.4880e-01,  6.9521e-01,  7.9073e-02, -1.2731e+00, -1.3749e-01,
        -7.1969e-01, -1.7195e-01, -3.6190e-01,  3.9376e-01, -1.7017e-01,
        -6.9037e-01,  5.3550e-02, -4.9331e-01, -3.3738e-01,  1.1412e-01,
         5.0071e-01, -1.3906e-01,  2.3610e-01, -4.8212e-02,  4.7460e-01,
        -3.4819e-01,  1.5372e-02, -3.9827e-02,  1.2964e-04, -5.6493e-02,
        -2.7282e-01, -5.7808e-01, -2.0449e-02,  3.1053e-01,  1.2282e+00,
         3.9251e-01, -1.1274e-01,  4.7515e-01, -3.3248e-02, -3.2932e-01,
        -2.0729e-01,  8.0102e-02,  5.8961e-01, -7.0135e-03, -1.1219e+00,
        -3.0714e-01,  2.6452e-01,  2.6121e-01, -6.4193e-02, -1.6986e-01,
        -7.0253e-01,  7.4020e-02, -4.5559e-02, -4.0965e-01, -1.9228e-01,
        -7.4970e-01,  6.1298e-01, -1.0643e-01, -1.4157e-02, -8.2136e-03,
         4.2601e-01, -6.9788e-01,  7.6248e-02, -2.5865e-01, -1.6434e-02,
         1.3006e-01, -3.1513e-01,  1.3385e-01,  2.5961e-01,  1.0734e-01,
        -1.5899e-01,  3.8703e-01, -1.2239e-01,  6.7389e-01, -4.1416e-01,
        -2.5506e-01, -5.0796e-02,  1.4470e-03, -8.3424e-01,  1.4112e-01,
         6.4460e-01,  1.5110e-02, -3.6804e-01, -1.8318e-01,  5.6013e-03,
        -1.8051e-03,  2.2095e-01,  9.8807e-02, -3.2572e-01, -5.5546e-01,
        -1.2895e-01, -1.1314e-01, -3.0071e-01, -3.5542e-03,  1.7228e-01,
        -5.1372e-01, -1.2628e+00,  1.4299e-02,  1.7954e+00,  2.2832e+00,
         2.3517e+00,  2.2862e-02,  1.9832e+00, -2.9241e+00,  4.9539e-01,
        -7.8563e-01,  1.0158e-01, -5.3760e-01,  7.9158e-02,  3.8423e-01,
         1.8522e-01,  4.8789e-02,  4.3421e-01,  0.0000e+00, -1.3807e+00,
         8.8076e-01, -2.5454e+00,  1.5510e-01,  2.4301e-02,  0.0000e+00,
        -5.9034e-02,  9.6087e-02, -1.7846e-01,  2.8494e-02, -1.0019e-01,
         1.0179e-01, -3.9550e-01, -3.4418e-01,  2.7712e-01,  2.8553e-01,
        -4.1652e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([9057]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-8.5434e-01,  1.5356e-01,  2.0732e-01,  1.1448e+00, -8.4316e-02,
        -4.7100e-01, -6.1442e-01, -6.4004e-01, -3.1435e-01, -2.9830e-01,
        -7.4604e-01,  1.2911e-02, -2.1747e+00,  8.2419e-02, -4.1931e-01,
        -4.5306e-01, -1.8767e-01, -1.3225e-01,  7.9684e-02, -7.1321e-03,
         3.2981e-01, -6.0564e-02, -1.3137e-01, -2.3293e-01,  5.4243e-02,
        -5.9473e-01, -6.2350e-01, -5.4848e-01, -8.9352e-01,  8.8011e-01,
        -4.3661e-01, -1.2415e-01,  2.4384e-01, -2.4274e+00, -7.7629e-01,
        -1.1264e-01,  4.8749e-02, -6.3743e-01, -2.5934e-01, -8.7099e-01,
         9.1009e-02, -1.3482e-01,  2.8138e-01, -1.8172e-01, -1.2515e-01,
        -1.6322e-01, -3.3947e-01, -4.8949e-01, -2.5839e-01,  1.2283e-01,
         1.5612e-02, -7.6832e-01, -5.8544e-01, -5.8243e-01, -7.3674e-01,
         2.8582e-01, -1.0422e+00,  1.0387e-01, -2.0648e-01, -3.5042e-01,
         5.7477e-02, -1.6340e-01, -1.1582e-01, -6.6688e-02, -3.1892e-03,
        -3.5912e-01,  1.6965e-01, -6.0161e-01,  6.4383e-03, -5.0308e-01,
        -2.5506e-01, -5.0796e-02,  1.4470e-03,  4.1342e-01,  5.0155e-02,
         3.8097e-02,  1.1700e+00, -2.6240e-01, -9.8077e-02,  5.6013e-03,
         1.1876e-01, -3.0161e-01, -2.7645e-01,  1.6201e-03, -5.0708e-01,
        -1.1001e-01, -1.0270e-01, -3.6406e-01, -6.1253e-01,  2.2928e-02,
        -5.5082e-01, -9.6781e-01,  1.4299e-02, -1.9548e+00, -7.3393e-01,
        -1.2708e+00,  6.6421e-01, -6.3947e-01, -3.1675e-01, -9.0903e-01,
         4.1027e-01,  9.7794e-02, -5.3760e-01, -2.9017e+00,  3.8423e-01,
         4.3736e+00,  1.5561e-02, -3.2619e-01,  0.0000e+00,  7.6622e-01,
         5.7234e-01,  9.8142e-01,  1.2886e-01,  6.8689e-01,  0.0000e+00,
        -5.9034e-02, -2.7421e-01, -1.7482e-01, -3.7708e+00,  7.8676e-01,
        -7.5419e-01, -5.5688e-01, -5.5884e-01,  1.7163e-01,  2.3172e-01,
        -4.0256e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6047]), tensor(0.0745))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:main_restricted.py:Testing data year: 1996
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 120
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 10061
            device: cpu
            
2024-07-27 11:24:05,751	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 11:24:05,795	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 11:24:05,832	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_573cf030409f7e88.zip' (1.38MiB) to Ray cluster...
2024-07-27 11:24:05,836	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_573cf030409f7e88.zip'.
2024-07-27 11:24:07,196	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 12:19:12,341	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_11-24-07' in 0.3509s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 75, 'num_layers': 3, 'num_embeddings': 10061, 'embedding_dim': 1, 'dropout_rate': 0.36, 'lr': 5.3572800696018355e-06, 'weight_decay': 0.00018453732926615942, 'num_epochs': 120, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07020808756326276
INFO:model_data_nn.py:Best trial testing loss: 0.08211702456015467
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-27_11-24-03_490453_752378/artifacts/2024-07-27_11-24-07/train_fnn_2024-07-27_11-24-07/driver_artifacts/train_fnn_69205_00006_6_dropout_rate=0.3600,embedding_dim=1,hidden_dim=75,lr=0.0000,num_layers=3,weight_decay=0.0002_2024-07-27_11-24-07
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 75, 'num_layers': 3, 'num_embeddings': 10656, 'embedding_dim': 1, 'dropout_rate': 0.36, 'lr': 5.3572800696018355e-06, 'weight_decay': 0.00018453732926615942, 'num_epochs': 120, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/120, metrics: {'avg_train_loss': 0.08237720596994974, 'avg_test_loss': 0.0983660446194311}
INFO:model_data_nn.py:Epoch 2/120, metrics: {'avg_train_loss': 0.08073399875864938, 'avg_test_loss': 0.09845249884327252}
INFO:model_data_nn.py:Epoch 3/120, metrics: {'avg_train_loss': 0.08028663585019977, 'avg_test_loss': 0.09863367646063367}
INFO:model_data_nn.py:Epoch 4/120, metrics: {'avg_train_loss': 0.08006680807213724, 'avg_test_loss': 0.09854774994775653}
INFO:model_data_nn.py:Epoch 5/120, metrics: {'avg_train_loss': 0.07987552117349372, 'avg_test_loss': 0.09862574908634027}
INFO:model_data_nn.py:Epoch 6/120, metrics: {'avg_train_loss': 0.07973223180659575, 'avg_test_loss': 0.09863033802062272}
INFO:model_data_nn.py:Epoch 7/120, metrics: {'avg_train_loss': 0.079611449767548, 'avg_test_loss': 0.09867465887839595}
INFO:model_data_nn.py:Epoch 8/120, metrics: {'avg_train_loss': 0.0794021470758512, 'avg_test_loss': 0.09880716175834338}
INFO:model_data_nn.py:Epoch 9/120, metrics: {'avg_train_loss': 0.07924851467131556, 'avg_test_loss': 0.09898658214136959}
INFO:model_data_nn.py:Epoch 10/120, metrics: {'avg_train_loss': 0.07903241205615578, 'avg_test_loss': 0.09934153132637343}
INFO:model_data_nn.py:Epoch 11/120, metrics: {'avg_train_loss': 0.07877560164836914, 'avg_test_loss': 0.09954306017979979}
INFO:model_data_nn.py:Epoch 12/120, metrics: {'avg_train_loss': 0.07870717498899242, 'avg_test_loss': 0.09957918949176868}
INFO:model_data_nn.py:Epoch 13/120, metrics: {'avg_train_loss': 0.07857951479653517, 'avg_test_loss': 0.09954646630336841}
INFO:model_data_nn.py:Epoch 14/120, metrics: {'avg_train_loss': 0.07832191556370184, 'avg_test_loss': 0.09961951961865027}
INFO:model_data_nn.py:Epoch 15/120, metrics: {'avg_train_loss': 0.07813325388357044, 'avg_test_loss': 0.09971824520950516}
INFO:model_data_nn.py:Epoch 16/120, metrics: {'avg_train_loss': 0.0780753481193779, 'avg_test_loss': 0.09959144329776366}
INFO:model_data_nn.py:Epoch 17/120, metrics: {'avg_train_loss': 0.07784875424176363, 'avg_test_loss': 0.09997306183104714}
INFO:model_data_nn.py:Epoch 18/120, metrics: {'avg_train_loss': 0.07776980475626058, 'avg_test_loss': 0.10032497126609087}
INFO:model_data_nn.py:Epoch 19/120, metrics: {'avg_train_loss': 0.0775554511471893, 'avg_test_loss': 0.10031913365920385}
INFO:model_data_nn.py:Epoch 20/120, metrics: {'avg_train_loss': 0.07745871951332155, 'avg_test_loss': 0.10008532200505336}
INFO:model_data_nn.py:Epoch 21/120, metrics: {'avg_train_loss': 0.07735474317622038, 'avg_test_loss': 0.10039263228078683}
INFO:model_data_nn.py:Epoch 22/120, metrics: {'avg_train_loss': 0.07716038440492141, 'avg_test_loss': 0.10033786721651752}
INFO:model_data_nn.py:Epoch 23/120, metrics: {'avg_train_loss': 0.07712305658899339, 'avg_test_loss': 0.10025362631181876}
INFO:model_data_nn.py:Epoch 24/120, metrics: {'avg_train_loss': 0.0768639401147533, 'avg_test_loss': 0.10093936429545283}
INFO:model_data_nn.py:Epoch 25/120, metrics: {'avg_train_loss': 0.0768463033127288, 'avg_test_loss': 0.10094106821715831}
INFO:model_data_nn.py:Epoch 26/120, metrics: {'avg_train_loss': 0.07672905615829852, 'avg_test_loss': 0.1005867100643615}
INFO:model_data_nn.py:Epoch 27/120, metrics: {'avg_train_loss': 0.07672420740679459, 'avg_test_loss': 0.10112629877279203}
INFO:model_data_nn.py:Epoch 28/120, metrics: {'avg_train_loss': 0.07649119334364379, 'avg_test_loss': 0.10099647619575262}
INFO:model_data_nn.py:Epoch 29/120, metrics: {'avg_train_loss': 0.07639421654278758, 'avg_test_loss': 0.10062964952612917}
INFO:model_data_nn.py:Epoch 30/120, metrics: {'avg_train_loss': 0.07640131517278928, 'avg_test_loss': 0.1012662256831924}
INFO:model_data_nn.py:Epoch 31/120, metrics: {'avg_train_loss': 0.07631431299687168, 'avg_test_loss': 0.10123642477268974}
INFO:model_data_nn.py:Early stopping at epoch 31
INFO:main_restricted.py:Making prediction for data in year: 1997
INFO:main_restricted.py:Prediction data shape: (23999,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:350: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1997: 0.31817944282966765
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  23999.000000  23999.000000
mean       0.055567     -0.002813
std        0.312191      0.050327
min       -0.982955     -0.404833
25%       -0.095238     -0.025039
50%        0.035715      0.004805
75%        0.181672      0.024277
max       14.000004      0.480433
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:transform_data_nn.py:Train_data: (259174, 161)

INFO:transform_data_nn.py:Test data years: [1997]
INFO:transform_data_nn.py:Test_data: (23999, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:transform_data_nn.py:Retrain_data: (283173, 161)

INFO:transform_data_nn.py:Prediction data years: [1998]
INFO:transform_data_nn.py:Prediction_data: (24412, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([259174, 138])
            y_train_tf: torch.Size([259174])

            x_test_tf: torch.Size([23999, 138])
            y_test_tf: torch.Size([23999])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([283173, 138])
            y_retrain_tf: torch.Size([283173])

            x_prediction_tf: torch.Size([24412, 138])
            y_prediction_tf: torch.Size([24412])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.4880e-01,  6.9521e-01,  7.9073e-02, -1.2731e+00, -1.3749e-01,
        -7.1969e-01, -1.7195e-01, -3.6190e-01,  3.9376e-01, -1.7017e-01,
        -6.9037e-01,  5.3550e-02, -4.9331e-01, -3.3738e-01,  1.1412e-01,
         5.0071e-01, -1.3906e-01,  2.3610e-01, -4.8212e-02,  4.7460e-01,
        -3.4819e-01,  1.5372e-02, -3.9827e-02,  1.2964e-04, -5.6493e-02,
        -2.7282e-01, -5.7808e-01, -2.0449e-02,  3.1053e-01,  1.2282e+00,
         3.9251e-01, -1.1274e-01,  4.7515e-01, -3.3248e-02, -3.2932e-01,
        -2.0729e-01,  8.0102e-02,  5.8961e-01, -7.0135e-03, -1.1219e+00,
        -3.0714e-01,  2.6452e-01,  2.6121e-01, -6.4193e-02, -1.6986e-01,
        -7.0253e-01,  7.4020e-02, -4.5559e-02, -4.0965e-01, -1.9228e-01,
        -7.4970e-01,  6.1298e-01, -1.0643e-01, -1.4157e-02, -8.2136e-03,
         4.2601e-01, -6.9788e-01,  7.6248e-02, -2.5865e-01, -1.6434e-02,
         1.3006e-01, -3.1513e-01,  1.3385e-01,  2.5961e-01,  1.0734e-01,
        -1.5899e-01,  3.8703e-01, -1.2239e-01,  6.7389e-01, -4.1416e-01,
        -2.5506e-01, -5.0796e-02,  1.4470e-03, -8.3424e-01,  1.4112e-01,
         6.4460e-01,  1.5110e-02, -3.6804e-01, -1.8318e-01,  5.6013e-03,
        -1.8051e-03,  2.2095e-01,  9.8807e-02, -3.2572e-01, -5.5546e-01,
        -1.2895e-01, -1.1314e-01, -3.0071e-01, -3.5542e-03,  1.7228e-01,
        -5.1372e-01, -1.2628e+00,  1.4299e-02,  1.7954e+00,  2.2832e+00,
         2.3517e+00,  2.2862e-02,  1.9832e+00, -2.9241e+00,  4.9539e-01,
        -7.8563e-01,  1.0158e-01, -5.3760e-01,  7.9158e-02,  3.8423e-01,
         1.8522e-01,  4.8789e-02,  4.3421e-01,  0.0000e+00, -1.3807e+00,
         8.8076e-01, -2.5454e+00,  1.5510e-01,  2.4301e-02,  0.0000e+00,
        -5.9034e-02,  9.6087e-02, -1.7846e-01,  2.8494e-02, -1.0019e-01,
         1.0179e-01, -3.9550e-01, -3.4418e-01,  2.7712e-01,  2.8553e-01,
        -4.1652e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([9057]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-8.5434e-01,  1.5356e-01,  2.0732e-01,  1.1448e+00, -8.4316e-02,
        -4.7100e-01, -6.1442e-01, -6.4004e-01, -3.1435e-01, -2.9830e-01,
        -7.4604e-01,  1.2911e-02, -2.1747e+00,  8.2419e-02, -4.1931e-01,
        -4.5306e-01, -1.8767e-01, -1.3225e-01,  7.9684e-02, -7.1321e-03,
         3.2981e-01, -6.0564e-02, -1.3137e-01, -2.3293e-01,  5.4243e-02,
        -5.9473e-01, -6.2350e-01, -5.4848e-01, -8.9352e-01,  8.8011e-01,
        -4.3661e-01, -1.2415e-01,  2.4384e-01, -2.4274e+00, -7.7629e-01,
        -1.1264e-01,  4.8749e-02, -6.3743e-01, -2.5934e-01, -8.7099e-01,
         9.1009e-02, -1.3482e-01,  2.8138e-01, -1.8172e-01, -1.2515e-01,
        -1.6322e-01, -3.3947e-01, -4.8949e-01, -2.5839e-01,  1.2283e-01,
         1.5612e-02, -7.6832e-01, -5.8544e-01, -5.8243e-01, -7.3674e-01,
         2.8582e-01, -1.0422e+00,  1.0387e-01, -2.0648e-01, -3.5042e-01,
         5.7477e-02, -1.6340e-01, -1.1582e-01, -6.6688e-02, -3.1892e-03,
        -3.5912e-01,  1.6965e-01, -6.0161e-01,  6.4383e-03, -5.0308e-01,
        -2.5506e-01, -5.0796e-02,  1.4470e-03,  4.1342e-01,  5.0155e-02,
         3.8097e-02,  1.1700e+00, -2.6240e-01, -9.8077e-02,  5.6013e-03,
         1.1876e-01, -3.0161e-01, -2.7645e-01,  1.6201e-03, -5.0708e-01,
        -1.1001e-01, -1.0270e-01, -3.6406e-01, -6.1253e-01,  2.2928e-02,
        -5.5082e-01, -9.6781e-01,  1.4299e-02, -1.9548e+00, -7.3393e-01,
        -1.2708e+00,  6.6421e-01, -6.3947e-01, -3.1675e-01, -9.0903e-01,
         4.1027e-01,  9.7794e-02, -5.3760e-01, -2.9017e+00,  3.8423e-01,
         4.3736e+00,  1.5561e-02, -3.2619e-01,  0.0000e+00,  7.6622e-01,
         5.7234e-01,  9.8142e-01,  1.2886e-01,  6.8689e-01,  0.0000e+00,
        -5.9034e-02, -2.7421e-01, -1.7482e-01, -3.7708e+00,  7.8676e-01,
        -7.5419e-01, -5.5688e-01, -5.5884e-01,  1.7163e-01,  2.3172e-01,
        -4.0256e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6047]), tensor(0.0745))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.4875e-01,  7.2061e-01,  7.2912e-02, -1.2606e+00, -1.4886e-01,
        -7.3204e-01, -1.6850e-01, -3.6069e-01,  4.2156e-01, -1.6996e-01,
        -6.8732e-01,  6.2069e-02, -4.9929e-01, -3.5319e-01,  1.1656e-01,
         4.9707e-01, -1.4139e-01,  2.4484e-01, -4.3315e-02,  4.8274e-01,
        -3.5553e-01,  1.5676e-02, -4.0194e-02, -3.8391e-03, -5.8610e-02,
        -2.7463e-01, -5.8303e-01, -1.6828e-02,  2.8067e-01,  1.2710e+00,
         3.8739e-01, -1.1953e-01,  4.8341e-01, -4.5972e-02, -3.1644e-01,
        -2.1355e-01,  7.1828e-02,  6.2033e-01, -1.9624e-02, -1.1225e+00,
        -3.0338e-01,  2.7821e-01,  2.4991e-01, -5.3326e-02, -1.7550e-01,
        -7.1020e-01,  7.6894e-02, -5.2911e-02, -4.1289e-01, -1.9440e-01,
        -7.6091e-01,  5.9169e-01, -9.4990e-02, -1.2033e-02, -1.4167e-02,
         4.2622e-01, -6.8477e-01,  8.1612e-02, -2.6019e-01, -1.7514e-02,
         1.2912e-01, -3.1628e-01,  1.3074e-01,  2.5888e-01,  1.0887e-01,
        -1.6674e-01,  4.0211e-01, -1.2470e-01,  6.6961e-01, -4.1523e-01,
        -2.6985e-01, -6.1165e-02, -9.8828e-04, -8.4282e-01,  1.5168e-01,
         6.5720e-01,  1.5584e-02, -3.7219e-01, -1.8143e-01,  5.0605e-03,
        -1.8819e-03,  2.0476e-01,  1.2074e-01, -3.1400e-01, -5.6006e-01,
        -1.3345e-01, -1.1882e-01, -2.9322e-01,  7.9855e-03,  1.7296e-01,
        -5.2195e-01, -1.2660e+00,  1.6970e-02,  1.7147e+00,  2.3702e+00,
         2.4034e+00, -7.6860e-03,  2.0941e+00, -3.0161e+00,  5.8447e-01,
        -8.6387e-01,  1.0094e-01, -3.3009e-01,  6.7510e-02,  2.8525e-01,
         1.5178e-01,  4.9893e-02,  3.3440e-01,  0.0000e+00, -1.4748e+00,
         8.9989e-01, -2.5525e+00,  1.5741e-01,  8.5457e-03,  0.0000e+00,
        -1.8565e-02,  1.2020e-01, -1.8193e-01,  1.3378e-02, -1.0678e-01,
         1.0540e-01, -3.8029e-01, -3.4150e-01,  2.8398e-01,  2.9023e-01,
        -4.1761e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([9815]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-4.9754e-01,  4.5230e-01, -7.9629e-01,  1.2705e+00, -3.4419e-02,
        -8.0852e-01, -1.2732e+00, -8.7504e-01, -3.5972e-01, -1.0120e-01,
        -7.5125e-01,  1.0637e-02, -4.6192e+00, -1.6720e-01, -4.3450e-01,
         1.6455e-01, -1.7177e-01, -1.1868e-02, -4.3315e-02,  1.0907e+00,
         1.4642e-01, -6.0401e-02, -4.8681e-02, -1.6256e-01, -6.2277e-02,
        -4.3124e-01, -6.4073e-01, -1.6828e-02, -1.2184e+00,  8.5124e-01,
        -1.3525e-01, -1.9557e-01,  2.3175e-01, -4.5972e-02, -7.8088e-01,
        -3.9932e-01, -2.3895e-01, -6.1120e-01, -2.4745e-01, -9.0022e-01,
        -2.2962e-01,  1.3594e-01,  3.5618e-01, -1.5770e-01, -5.3546e-02,
        -6.5398e-01, -5.5200e-02,  2.5113e-01, -2.6188e-01,  2.1419e-02,
         9.0682e-03, -7.2800e-01, -6.8018e-01, -5.6584e-01, -7.3715e-01,
         2.8444e-01, -1.0327e+00, -1.4410e-01,  1.2377e+00, -4.4250e-01,
        -1.9594e-02,  3.1610e-01, -1.1760e+00,  5.3322e-01,  1.1959e-03,
        -7.9654e-01,  4.2208e-01,  1.3068e+00, -2.0039e+00, -4.5196e-01,
        -2.6985e-01, -6.1165e-02, -9.8828e-04, -7.6262e-01,  5.3793e-02,
         1.4250e-02,  5.2743e+00, -3.4692e-01, -4.9553e-03,  5.0605e-03,
        -1.8819e-03,  9.3164e-02, -2.2469e-01,  1.1796e+00,  3.0917e-01,
        -1.1656e-01, -1.0947e-01, -3.6519e-01, -6.1414e-01,  1.1825e-03,
        -2.3899e-01, -6.9905e-01,  1.6970e-02, -2.2883e+00, -1.4159e+00,
        -1.2488e+00,  2.3878e-01, -5.0993e-01, -9.9969e-01, -1.1059e+00,
         8.7936e-01,  5.0583e-01, -3.3009e-01,  3.3646e+00,  2.8525e-01,
         1.5399e+00,  2.3916e-02,  9.1798e-01,  0.0000e+00,  4.0425e-01,
        -6.9032e-01,  1.3071e+00,  1.2843e-01,  1.3725e+00,  0.0000e+00,
        -1.8565e-02, -5.1438e-02, -1.3765e-01, -3.7524e+00,  7.0168e-01,
        -3.1048e-01, -4.7103e-01, -4.3587e-01,  1.6012e-01,  2.3185e-01,
        -4.0248e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6105]), tensor(-0.0156))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:main_restricted.py:Testing data year: 1997
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 120
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 10656
            device: cpu
            
2024-07-27 13:02:59,068	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 13:02:59,110	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 13:02:59,155	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_e94a6bf814c02768.zip' (1.39MiB) to Ray cluster...
2024-07-27 13:02:59,160	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_e94a6bf814c02768.zip'.
2024-07-27 13:03:00,583	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 14:57:54,542	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_13-03-00' in 0.2775s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 3, 'num_embeddings': 10656, 'embedding_dim': 9, 'dropout_rate': 0.49, 'lr': 2.1456816483566953e-06, 'weight_decay': 3.8468952779413876e-05, 'num_epochs': 120, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07987649916096326
INFO:model_data_nn.py:Best trial testing loss: 0.097901179159681
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-27_13-02-56_764808_752378/artifacts/2024-07-27_13-03-00/train_fnn_2024-07-27_13-03-00/driver_artifacts/train_fnn_39b36_00074_74_dropout_rate=0.4900,embedding_dim=9,hidden_dim=5,lr=0.0000,num_layers=3,weight_decay=0.0000_2024-07-27_13-03-00
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 3, 'num_embeddings': 11533, 'embedding_dim': 9, 'dropout_rate': 0.49, 'lr': 2.1456816483566953e-06, 'weight_decay': 3.8468952779413876e-05, 'num_epochs': 120, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/120, metrics: {'avg_train_loss': 0.08316835837123, 'avg_test_loss': 0.13587160436021528}
INFO:model_data_nn.py:Epoch 2/120, metrics: {'avg_train_loss': 0.08214876398191613, 'avg_test_loss': 0.13600086265635405}
INFO:model_data_nn.py:Epoch 3/120, metrics: {'avg_train_loss': 0.08180527450653624, 'avg_test_loss': 0.13619676157453758}
INFO:model_data_nn.py:Epoch 4/120, metrics: {'avg_train_loss': 0.08168336837515656, 'avg_test_loss': 0.1363613320951537}
INFO:model_data_nn.py:Epoch 5/120, metrics: {'avg_train_loss': 0.08161574399088231, 'avg_test_loss': 0.13652053960815053}
INFO:model_data_nn.py:Epoch 6/120, metrics: {'avg_train_loss': 0.08157687950479446, 'avg_test_loss': 0.1366368442991087}
INFO:model_data_nn.py:Epoch 7/120, metrics: {'avg_train_loss': 0.08155412989326537, 'avg_test_loss': 0.13669775750214627}
INFO:model_data_nn.py:Epoch 8/120, metrics: {'avg_train_loss': 0.08154548131739774, 'avg_test_loss': 0.13672273877280647}
INFO:model_data_nn.py:Epoch 9/120, metrics: {'avg_train_loss': 0.0815292152060501, 'avg_test_loss': 0.13678791470396018}
INFO:model_data_nn.py:Epoch 10/120, metrics: {'avg_train_loss': 0.08153823513695496, 'avg_test_loss': 0.1368115033886028}
INFO:model_data_nn.py:Epoch 11/120, metrics: {'avg_train_loss': 0.08155831304699772, 'avg_test_loss': 0.13687009142460313}
INFO:model_data_nn.py:Epoch 12/120, metrics: {'avg_train_loss': 0.08153935508781486, 'avg_test_loss': 0.13686639771016795}
INFO:model_data_nn.py:Epoch 13/120, metrics: {'avg_train_loss': 0.08152501068619937, 'avg_test_loss': 0.13685746102924623}
INFO:model_data_nn.py:Epoch 14/120, metrics: {'avg_train_loss': 0.08152866656234288, 'avg_test_loss': 0.13685392774763575}
INFO:model_data_nn.py:Epoch 15/120, metrics: {'avg_train_loss': 0.08154701266269394, 'avg_test_loss': 0.13685439522152335}
INFO:model_data_nn.py:Epoch 16/120, metrics: {'avg_train_loss': 0.08151602514172342, 'avg_test_loss': 0.13689383167314537}
INFO:model_data_nn.py:Epoch 17/120, metrics: {'avg_train_loss': 0.08151790172377296, 'avg_test_loss': 0.13686758851776507}
INFO:model_data_nn.py:Epoch 18/120, metrics: {'avg_train_loss': 0.08154874810780594, 'avg_test_loss': 0.13686790698370255}
INFO:model_data_nn.py:Epoch 19/120, metrics: {'avg_train_loss': 0.08152030735050386, 'avg_test_loss': 0.13684473375315007}
INFO:model_data_nn.py:Epoch 20/120, metrics: {'avg_train_loss': 0.0815085101360192, 'avg_test_loss': 0.13681266574020623}
INFO:model_data_nn.py:Epoch 21/120, metrics: {'avg_train_loss': 0.08149029651488372, 'avg_test_loss': 0.13680851345132367}
INFO:model_data_nn.py:Epoch 22/120, metrics: {'avg_train_loss': 0.08149400583084272, 'avg_test_loss': 0.1367856674726325}
INFO:model_data_nn.py:Epoch 23/120, metrics: {'avg_train_loss': 0.08149445021125136, 'avg_test_loss': 0.1367263233418507}
INFO:model_data_nn.py:Epoch 24/120, metrics: {'avg_train_loss': 0.08147666386344422, 'avg_test_loss': 0.13669637345060764}
INFO:model_data_nn.py:Epoch 25/120, metrics: {'avg_train_loss': 0.08145568632462856, 'avg_test_loss': 0.13672265701904054}
INFO:model_data_nn.py:Epoch 26/120, metrics: {'avg_train_loss': 0.08146862069071181, 'avg_test_loss': 0.13670705908941175}
INFO:model_data_nn.py:Epoch 27/120, metrics: {'avg_train_loss': 0.08146667462873594, 'avg_test_loss': 0.13665059993597697}
INFO:model_data_nn.py:Epoch 28/120, metrics: {'avg_train_loss': 0.08145040787935341, 'avg_test_loss': 0.13664679363892362}
INFO:model_data_nn.py:Epoch 29/120, metrics: {'avg_train_loss': 0.08144398251169567, 'avg_test_loss': 0.13664630643881828}
INFO:model_data_nn.py:Epoch 30/120, metrics: {'avg_train_loss': 0.08144405771467814, 'avg_test_loss': 0.13663009734797446}
INFO:model_data_nn.py:Epoch 31/120, metrics: {'avg_train_loss': 0.08146905775566055, 'avg_test_loss': 0.13660890299602269}
INFO:model_data_nn.py:Early stopping at epoch 31
INFO:main_restricted.py:Making prediction for data in year: 1998
INFO:main_restricted.py:Prediction data shape: (24412,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:350: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1998: 0.3696026957039229
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  24412.000000  24412.000000
mean       0.004293      0.037127
std        0.368725      0.003653
min       -0.979592      0.035039
25%       -0.186753      0.035192
50%       -0.017392      0.035238
75%        0.131659      0.037554
max       10.538459      0.078556
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:transform_data_nn.py:Train_data: (283173, 161)

INFO:transform_data_nn.py:Test data years: [1998]
INFO:transform_data_nn.py:Test_data: (24412, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Retrain_data: (307585, 161)

INFO:transform_data_nn.py:Prediction data years: [1999]
INFO:transform_data_nn.py:Prediction_data: (23257, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([283173, 138])
            y_train_tf: torch.Size([283173])

            x_test_tf: torch.Size([24412, 138])
            y_test_tf: torch.Size([24412])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([307585, 138])
            y_retrain_tf: torch.Size([307585])

            x_prediction_tf: torch.Size([23257, 138])
            y_prediction_tf: torch.Size([23257])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.4875e-01,  7.2061e-01,  7.2912e-02, -1.2606e+00, -1.4886e-01,
        -7.3204e-01, -1.6850e-01, -3.6069e-01,  4.2156e-01, -1.6996e-01,
        -6.8732e-01,  6.2069e-02, -4.9929e-01, -3.5319e-01,  1.1656e-01,
         4.9707e-01, -1.4139e-01,  2.4484e-01, -4.3315e-02,  4.8274e-01,
        -3.5553e-01,  1.5676e-02, -4.0194e-02, -3.8391e-03, -5.8610e-02,
        -2.7463e-01, -5.8303e-01, -1.6828e-02,  2.8067e-01,  1.2710e+00,
         3.8739e-01, -1.1953e-01,  4.8341e-01, -4.5972e-02, -3.1644e-01,
        -2.1355e-01,  7.1828e-02,  6.2033e-01, -1.9624e-02, -1.1225e+00,
        -3.0338e-01,  2.7821e-01,  2.4991e-01, -5.3326e-02, -1.7550e-01,
        -7.1020e-01,  7.6894e-02, -5.2911e-02, -4.1289e-01, -1.9440e-01,
        -7.6091e-01,  5.9169e-01, -9.4990e-02, -1.2033e-02, -1.4167e-02,
         4.2622e-01, -6.8477e-01,  8.1612e-02, -2.6019e-01, -1.7514e-02,
         1.2912e-01, -3.1628e-01,  1.3074e-01,  2.5888e-01,  1.0887e-01,
        -1.6674e-01,  4.0211e-01, -1.2470e-01,  6.6961e-01, -4.1523e-01,
        -2.6985e-01, -6.1165e-02, -9.8828e-04, -8.4282e-01,  1.5168e-01,
         6.5720e-01,  1.5584e-02, -3.7219e-01, -1.8143e-01,  5.0605e-03,
        -1.8819e-03,  2.0476e-01,  1.2074e-01, -3.1400e-01, -5.6006e-01,
        -1.3345e-01, -1.1882e-01, -2.9322e-01,  7.9855e-03,  1.7296e-01,
        -5.2195e-01, -1.2660e+00,  1.6970e-02,  1.7147e+00,  2.3702e+00,
         2.4034e+00, -7.6860e-03,  2.0941e+00, -3.0161e+00,  5.8447e-01,
        -8.6387e-01,  1.0094e-01, -3.3009e-01,  6.7510e-02,  2.8525e-01,
         1.5178e-01,  4.9893e-02,  3.3440e-01,  0.0000e+00, -1.4748e+00,
         8.9989e-01, -2.5525e+00,  1.5741e-01,  8.5457e-03,  0.0000e+00,
        -1.8565e-02,  1.2020e-01, -1.8193e-01,  1.3378e-02, -1.0678e-01,
         1.0540e-01, -3.8029e-01, -3.4150e-01,  2.8398e-01,  2.9023e-01,
        -4.1761e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([9815]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-4.9754e-01,  4.5230e-01, -7.9629e-01,  1.2705e+00, -3.4419e-02,
        -8.0852e-01, -1.2732e+00, -8.7504e-01, -3.5972e-01, -1.0120e-01,
        -7.5125e-01,  1.0637e-02, -4.6192e+00, -1.6720e-01, -4.3450e-01,
         1.6455e-01, -1.7177e-01, -1.1868e-02, -4.3315e-02,  1.0907e+00,
         1.4642e-01, -6.0401e-02, -4.8681e-02, -1.6256e-01, -6.2277e-02,
        -4.3124e-01, -6.4073e-01, -1.6828e-02, -1.2184e+00,  8.5124e-01,
        -1.3525e-01, -1.9557e-01,  2.3175e-01, -4.5972e-02, -7.8088e-01,
        -3.9932e-01, -2.3895e-01, -6.1120e-01, -2.4745e-01, -9.0022e-01,
        -2.2962e-01,  1.3594e-01,  3.5618e-01, -1.5770e-01, -5.3546e-02,
        -6.5398e-01, -5.5200e-02,  2.5113e-01, -2.6188e-01,  2.1419e-02,
         9.0682e-03, -7.2800e-01, -6.8018e-01, -5.6584e-01, -7.3715e-01,
         2.8444e-01, -1.0327e+00, -1.4410e-01,  1.2377e+00, -4.4250e-01,
        -1.9594e-02,  3.1610e-01, -1.1760e+00,  5.3322e-01,  1.1959e-03,
        -7.9654e-01,  4.2208e-01,  1.3068e+00, -2.0039e+00, -4.5196e-01,
        -2.6985e-01, -6.1165e-02, -9.8828e-04, -7.6262e-01,  5.3793e-02,
         1.4250e-02,  5.2743e+00, -3.4692e-01, -4.9553e-03,  5.0605e-03,
        -1.8819e-03,  9.3164e-02, -2.2469e-01,  1.1796e+00,  3.0917e-01,
        -1.1656e-01, -1.0947e-01, -3.6519e-01, -6.1414e-01,  1.1825e-03,
        -2.3899e-01, -6.9905e-01,  1.6970e-02, -2.2883e+00, -1.4159e+00,
        -1.2488e+00,  2.3878e-01, -5.0993e-01, -9.9969e-01, -1.1059e+00,
         8.7936e-01,  5.0583e-01, -3.3009e-01,  3.3646e+00,  2.8525e-01,
         1.5399e+00,  2.3916e-02,  9.1798e-01,  0.0000e+00,  4.0425e-01,
        -6.9032e-01,  1.3071e+00,  1.2843e-01,  1.3725e+00,  0.0000e+00,
        -1.8565e-02, -5.1438e-02, -1.3765e-01, -3.7524e+00,  7.0168e-01,
        -3.1048e-01, -4.7103e-01, -4.3587e-01,  1.6012e-01,  2.3185e-01,
        -4.0248e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6105]), tensor(-0.0156))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.1509,  0.7440,  0.0739, -1.2498, -0.1583, -0.7484, -0.1661, -0.3605,
         0.4437, -0.1689, -0.6865,  0.0739, -0.5083, -0.3612,  0.1127,  0.4919,
        -0.1471,  0.2453, -0.0326,  0.4865, -0.3329,  0.0062, -0.0411, -0.0063,
        -0.0596, -0.2770, -0.5903, -0.0243,  0.2523,  1.3025,  0.3879, -0.1208,
         0.4900, -0.0370, -0.3052, -0.2211,  0.0571,  0.6507, -0.0367, -1.1276,
        -0.3000,  0.2835,  0.2404, -0.0413, -0.1868, -0.7212,  0.0792, -0.0531,
        -0.4181, -0.1738, -0.7727,  0.5697, -0.0804, -0.0112, -0.0218,  0.4249,
        -0.6743,  0.0835, -0.2571, -0.0244,  0.1277, -0.3128,  0.1321,  0.2572,
         0.1087, -0.1698,  0.4162, -0.1267,  0.6665, -0.4178, -0.2836, -0.0720,
        -0.0133, -0.8554,  0.1637,  0.6658,  0.0178, -0.3752, -0.1796,  0.0047,
        -0.0033,  0.1852,  0.1404, -0.3015, -0.5638, -0.1380, -0.1245, -0.2873,
         0.0166,  0.1728, -0.5317, -1.2685,  0.0185,  1.6282,  2.3471,  2.4638,
        -0.0452,  2.2006, -2.9314,  0.6653, -0.6964,  0.0989, -0.1149,  0.0153,
         0.3349,  0.1291,  0.0518,  0.2270,  0.0000, -1.5009,  0.9768, -2.5665,
         0.1609,  0.0047,  0.0000, -0.0273,  0.1423, -0.1884, -0.0187, -0.1151,
         0.1141, -0.3668, -0.3363,  0.2919,  0.2945, -0.4157,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([10414]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-2.4279e-01, -5.4056e-01, -3.7466e-01,  1.3921e+00, -3.4530e-01,
        -8.1114e-01, -1.6376e+00, -9.1233e-01, -3.5750e-01, -3.1677e-01,
        -7.4018e-01,  2.4990e-02, -1.1498e+00,  6.9382e-01,  2.6771e-01,
         4.5418e-01, -1.8631e-01, -3.0621e-01,  1.3363e-01, -8.3417e-01,
         3.2863e-01, -6.1122e-02, -3.8941e-02, -5.3512e-02, -1.3785e-01,
        -4.2425e-01, -6.3906e-01, -2.4296e-02, -8.5865e-01,  8.6023e-01,
         3.1274e-01, -1.6124e-01,  2.5772e-01, -2.2774e+00, -7.4574e-01,
        -4.0902e-01, -4.6274e-01, -5.9875e-01, -7.1793e-01, -1.0732e+00,
        -2.4376e-01, -5.9177e-01, -5.9555e-01, -1.6706e-01, -3.2865e-01,
        -7.9236e-01, -1.0617e-01,  1.7908e-01, -3.3487e-01,  1.4255e-01,
         7.7668e-01, -7.0627e-01, -7.1038e-01, -5.5264e-01, -7.3689e-01,
         3.2908e-01, -1.0253e+00, -9.0320e-02, -1.1286e-01, -1.8251e-01,
        -5.3808e-03,  3.2517e-01,  7.9990e-01, -7.9642e-01, -1.0776e-03,
         6.7643e-01, -3.7252e-01,  4.9175e-01,  6.6652e-01, -3.8839e-01,
        -2.8357e-01, -7.1964e-02, -1.3280e-02, -7.9567e-01,  7.6774e-02,
         7.0727e-01,  1.6970e+00, -2.8202e-01, -1.4733e-01,  4.6881e-03,
         1.1976e-01,  5.9480e-02, -1.5375e-01,  4.9903e-01, -5.1187e-02,
        -1.2330e-01, -1.1638e-01, -3.5442e-01, -5.4464e-01,  1.8507e-01,
        -3.9372e-01,  1.6076e-01,  1.8480e-02, -2.3308e+00, -2.0402e+00,
        -1.1560e+00,  4.3587e-01, -7.7550e-01, -7.9302e-01, -2.6511e-02,
         1.1223e+00, -5.6112e-01, -1.1486e-01,  1.8025e+00,  3.3495e-01,
         2.7049e+00,  2.8338e-02,  4.0988e-01,  0.0000e+00, -1.3899e+00,
        -4.1890e-01,  1.0006e+00,  1.2894e-01,  2.7026e+00,  0.0000e+00,
        -2.7314e-02,  4.5218e-02, -2.3823e-01, -3.6706e+00,  6.3616e-01,
         9.8503e-01, -2.8688e-01, -3.9455e-01,  2.0078e-01,  2.6829e-01,
        -4.0594e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5891]), tensor(-0.0790))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:main_restricted.py:Testing data year: 1998
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 120
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 11533
            device: cpu
            
2024-07-27 15:44:28,548	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 15:44:28,605	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 15:44:28,652	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_341f1673add3bf67.zip' (1.40MiB) to Ray cluster...
2024-07-27 15:44:28,658	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_341f1673add3bf67.zip'.
2024-07-27 15:44:30,248	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 16:21:39,900	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_15-44-30' in 0.3136s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 95, 'num_layers': 2, 'num_embeddings': 11533, 'embedding_dim': 5, 'dropout_rate': 0.55, 'lr': 4.415912570685772e-05, 'weight_decay': 0.0002151824516145355, 'num_epochs': 120, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.0766716870713958
INFO:model_data_nn.py:Best trial testing loss: 0.13195131678710328
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-27_15-44-26_245187_752378/artifacts/2024-07-27_15-44-30/train_fnn_2024-07-27_15-44-30/driver_artifacts/train_fnn_c930d_00082_82_dropout_rate=0.5500,embedding_dim=5,hidden_dim=95,lr=0.0000,num_layers=2,weight_decay=0.0002_2024-07-27_15-44-30
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 95, 'num_layers': 2, 'num_embeddings': 12245, 'embedding_dim': 5, 'dropout_rate': 0.55, 'lr': 4.415912570685772e-05, 'weight_decay': 0.0002151824516145355, 'num_epochs': 120, 'num_gpus': 0}

ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 95])
ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 95])
INFO:main_restricted.py:Making prediction for data in year: 1999
INFO:main_restricted.py:Prediction data shape: (23257,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:350: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1999: 0.5104873909909642
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  23257.000000  23257.000000
mean       0.079897      0.019754
std        0.505723      0.020754
min       -0.980932     -0.104005
25%       -0.147059      0.009619
50%        0.000000      0.020435
75%        0.177420      0.030775
max       16.624997      0.141596
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Train_data: (307585, 161)

INFO:transform_data_nn.py:Test data years: [1999]
INFO:transform_data_nn.py:Test_data: (23257, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:transform_data_nn.py:Retrain_data: (330842, 161)

INFO:transform_data_nn.py:Prediction data years: [2000]
INFO:transform_data_nn.py:Prediction_data: (22167, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([307585, 138])
            y_train_tf: torch.Size([307585])

            x_test_tf: torch.Size([23257, 138])
            y_test_tf: torch.Size([23257])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([330842, 138])
            y_retrain_tf: torch.Size([330842])

            x_prediction_tf: torch.Size([22167, 138])
            y_prediction_tf: torch.Size([22167])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-0.1509,  0.7440,  0.0739, -1.2498, -0.1583, -0.7484, -0.1661, -0.3605,
         0.4437, -0.1689, -0.6865,  0.0739, -0.5083, -0.3612,  0.1127,  0.4919,
        -0.1471,  0.2453, -0.0326,  0.4865, -0.3329,  0.0062, -0.0411, -0.0063,
        -0.0596, -0.2770, -0.5903, -0.0243,  0.2523,  1.3025,  0.3879, -0.1208,
         0.4900, -0.0370, -0.3052, -0.2211,  0.0571,  0.6507, -0.0367, -1.1276,
        -0.3000,  0.2835,  0.2404, -0.0413, -0.1868, -0.7212,  0.0792, -0.0531,
        -0.4181, -0.1738, -0.7727,  0.5697, -0.0804, -0.0112, -0.0218,  0.4249,
        -0.6743,  0.0835, -0.2571, -0.0244,  0.1277, -0.3128,  0.1321,  0.2572,
         0.1087, -0.1698,  0.4162, -0.1267,  0.6665, -0.4178, -0.2836, -0.0720,
        -0.0133, -0.8554,  0.1637,  0.6658,  0.0178, -0.3752, -0.1796,  0.0047,
        -0.0033,  0.1852,  0.1404, -0.3015, -0.5638, -0.1380, -0.1245, -0.2873,
         0.0166,  0.1728, -0.5317, -1.2685,  0.0185,  1.6282,  2.3471,  2.4638,
        -0.0452,  2.2006, -2.9314,  0.6653, -0.6964,  0.0989, -0.1149,  0.0153,
         0.3349,  0.1291,  0.0518,  0.2270,  0.0000, -1.5009,  0.9768, -2.5665,
         0.1609,  0.0047,  0.0000, -0.0273,  0.1423, -0.1884, -0.0187, -0.1151,
         0.1141, -0.3668, -0.3363,  0.2919,  0.2945, -0.4157,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([10414]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-2.4279e-01, -5.4056e-01, -3.7466e-01,  1.3921e+00, -3.4530e-01,
        -8.1114e-01, -1.6376e+00, -9.1233e-01, -3.5750e-01, -3.1677e-01,
        -7.4018e-01,  2.4990e-02, -1.1498e+00,  6.9382e-01,  2.6771e-01,
         4.5418e-01, -1.8631e-01, -3.0621e-01,  1.3363e-01, -8.3417e-01,
         3.2863e-01, -6.1122e-02, -3.8941e-02, -5.3512e-02, -1.3785e-01,
        -4.2425e-01, -6.3906e-01, -2.4296e-02, -8.5865e-01,  8.6023e-01,
         3.1274e-01, -1.6124e-01,  2.5772e-01, -2.2774e+00, -7.4574e-01,
        -4.0902e-01, -4.6274e-01, -5.9875e-01, -7.1793e-01, -1.0732e+00,
        -2.4376e-01, -5.9177e-01, -5.9555e-01, -1.6706e-01, -3.2865e-01,
        -7.9236e-01, -1.0617e-01,  1.7908e-01, -3.3487e-01,  1.4255e-01,
         7.7668e-01, -7.0627e-01, -7.1038e-01, -5.5264e-01, -7.3689e-01,
         3.2908e-01, -1.0253e+00, -9.0320e-02, -1.1286e-01, -1.8251e-01,
        -5.3808e-03,  3.2517e-01,  7.9990e-01, -7.9642e-01, -1.0776e-03,
         6.7643e-01, -3.7252e-01,  4.9175e-01,  6.6652e-01, -3.8839e-01,
        -2.8357e-01, -7.1964e-02, -1.3280e-02, -7.9567e-01,  7.6774e-02,
         7.0727e-01,  1.6970e+00, -2.8202e-01, -1.4733e-01,  4.6881e-03,
         1.1976e-01,  5.9480e-02, -1.5375e-01,  4.9903e-01, -5.1187e-02,
        -1.2330e-01, -1.1638e-01, -3.5442e-01, -5.4464e-01,  1.8507e-01,
        -3.9372e-01,  1.6076e-01,  1.8480e-02, -2.3308e+00, -2.0402e+00,
        -1.1560e+00,  4.3587e-01, -7.7550e-01, -7.9302e-01, -2.6511e-02,
         1.1223e+00, -5.6112e-01, -1.1486e-01,  1.8025e+00,  3.3495e-01,
         2.7049e+00,  2.8338e-02,  4.0988e-01,  0.0000e+00, -1.3899e+00,
        -4.1890e-01,  1.0006e+00,  1.2894e-01,  2.7026e+00,  0.0000e+00,
        -2.7314e-02,  4.5218e-02, -2.3823e-01, -3.6706e+00,  6.3616e-01,
         9.8503e-01, -2.8688e-01, -3.9455e-01,  2.0078e-01,  2.6829e-01,
        -4.0594e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5891]), tensor(-0.0790))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.1517,  0.7643,  0.0741, -1.2420, -0.1630, -0.7659, -0.1644, -0.3590,
         0.4438, -0.1655, -0.6851,  0.0833, -0.5092, -0.3713,  0.1118,  0.4894,
        -0.1436,  0.2420, -0.0348,  0.4922, -0.3416,  0.0049, -0.0404, -0.0039,
        -0.0545, -0.2778, -0.5963, -0.0290,  0.2277,  1.3229,  0.3730, -0.1190,
         0.4949, -0.0264, -0.2939, -0.2278,  0.0436,  0.6775, -0.0490, -1.1350,
        -0.2977,  0.3173,  0.2359, -0.0378, -0.1943, -0.7313,  0.0980, -0.0503,
        -0.4175, -0.1673, -0.7843,  0.5522, -0.0630, -0.0116, -0.0237,  0.4228,
        -0.6646,  0.0795, -0.2531, -0.0328,  0.1284, -0.3086,  0.1336,  0.2554,
         0.1134, -0.1725,  0.4281, -0.1310,  0.6667, -0.4198, -0.2946, -0.0809,
        -0.0220, -0.8696,  0.1742,  0.6666,  0.0194, -0.3778, -0.1779,  0.0063,
        -0.0066,  0.1756,  0.1491, -0.2889, -0.5626, -0.1416, -0.1292, -0.2838,
         0.0285,  0.1826, -0.5358, -1.2721,  0.0191,  1.5680,  2.2776,  2.5200,
        -0.0780,  2.2929, -2.9799,  0.7094, -0.7643,  0.0997, -0.1145,  0.0057,
         0.3502,  0.1574,  0.0542,  0.2523,  0.0000, -1.4063,  1.0355, -2.5828,
         0.1644,  0.0092,  0.0000, -0.0067,  0.1611, -0.1942, -0.0167, -0.1234,
         0.1210, -0.3549, -0.3292,  0.2991,  0.2976, -0.4133,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([10935]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-1.7463e-02, -6.8208e-01, -5.1292e-01,  1.5087e+00, -2.6048e-01,
        -8.0411e-01, -1.6087e+00, -9.1082e-01, -2.2046e-01, -2.4390e-01,
        -6.8325e-01,  3.3706e-02, -3.0564e-01,  9.8559e-01,  5.3074e-01,
         6.0774e-01, -2.2486e-01,  1.4532e-01,  7.0841e-02, -9.6938e-01,
         1.8550e-01, -6.4694e-02, -4.3657e-02, -5.4047e-02,  4.0327e-02,
        -4.7776e-01, -6.5774e-01, -2.8979e-02, -8.9603e-01,  1.1710e+00,
        -4.1486e-02, -1.5411e-01,  2.9379e-01, -2.2267e+00, -7.8194e-01,
        -2.8490e-01, -1.8904e-01, -5.4945e-01, -1.7000e-01, -1.1194e+00,
        -4.3445e-02, -3.1549e-01, -3.6533e-01, -9.9723e-02, -2.6630e-01,
        -3.6560e-01, -3.6423e-01, -8.0028e-02, -4.8426e-02, -1.1814e-01,
         7.7213e-01, -7.7487e-01, -5.6102e-01, -5.4456e-01, -7.3591e-01,
         2.6051e-01, -1.0184e+00,  1.2153e-01, -4.1426e-01, -4.3467e-01,
        -1.7693e-01, -1.1241e-01,  1.0690e+00,  1.0657e-01,  2.6272e-04,
         1.3289e+00, -4.8393e-01,  2.0586e+00,  6.6670e-01, -3.8214e-01,
        -2.9457e-01, -8.0898e-02, -2.2006e-02, -4.1936e-01,  7.0712e-02,
         7.8962e-01,  5.5825e-02, -1.0734e-01, -1.5332e-01,  6.2512e-03,
         1.2375e-01,  8.8372e-02,  3.8248e-02,  2.4160e-01, -5.7003e-01,
        -1.3262e-01, -1.2374e-01, -3.0045e-01, -5.1220e-01, -3.7390e-01,
        -5.9571e-01, -1.1923e-01,  1.9131e-02, -2.2531e+00, -1.5614e+00,
        -1.1678e+00,  3.0509e-01, -4.1689e-01, -3.4242e-01, -8.5690e-01,
        -3.2235e-01, -9.6125e-01, -1.1448e-01,  8.6509e-01,  3.5022e-01,
         1.9737e+00,  3.2488e-02, -1.0175e+00,  0.0000e+00, -6.5791e-01,
         4.5432e-02,  1.3014e+00,  1.1926e-01,  5.0540e+00,  0.0000e+00,
        -6.7208e-03, -1.5726e-01, -2.2692e-01, -3.6150e+00,  6.4678e-01,
         1.4428e-01, -1.0529e-01, -4.0449e-01,  2.0893e-01,  2.7106e-01,
        -4.2404e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5585]), tensor(-0.0447))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:main_restricted.py:Testing data year: 1999
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 120
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 12245
            device: cpu
            
2024-07-27 16:59:42,269	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 16:59:42,325	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 16:59:42,380	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_341f1673add3bf67.zip' (1.40MiB) to Ray cluster...
2024-07-27 16:59:42,385	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_341f1673add3bf67.zip'.
2024-07-27 16:59:44,094	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=4115078)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 45])
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/numpy/lib/function_base.py:4655: RuntimeWarning: invalid value encountered in subtract
  diff_b_a = subtract(b, a)
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=4113475)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 65])[32m [repeated 4x across cluster] (Ray deduplicates logs by default. Set RAY_DEDUP_LOGS=0 to disable log deduplication, or see https://docs.ray.io/en/master/ray-observability/user-guides/configure-logging.html#log-deduplication for more options.)[0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=4114981)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 65])[32m [repeated 7x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=4115685)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 55])[32m [repeated 3x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=4114391)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 35])[32m [repeated 7x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=4114142)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 155])
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=4112150)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 185])
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=465943)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 75])
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=598430)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 25])
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=421781)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 45])[32m [repeated 3x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=442127)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 85])
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=672672)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 165])
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=697765)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 25])[32m [repeated 4x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=598419)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 165])[32m [repeated 6x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=720161)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 145])[32m [repeated 3x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=1009964)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 185])
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=1031585)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 155])
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=924937)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 145])[32m [repeated 3x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=1203096)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 15])[32m [repeated 2x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=1028256)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 85])
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=1168937)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 45])
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=1068458)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 135])[32m [repeated 6x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=1203853)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 185])[32m [repeated 2x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=1531663)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 65])[32m [repeated 2x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=1373083)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 35])[32m [repeated 4x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=1498150)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 105])[32m [repeated 2x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=1688110)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 165])[32m [repeated 3x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=1687297)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 75])[32m [repeated 3x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=1804435)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 125])[32m [repeated 4x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=1688459)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 135])[32m [repeated 2x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=1909842)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 135])[32m [repeated 4x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=1672672)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 115])
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=2025219)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 195])
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=2127016)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 55])[32m [repeated 5x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=2062244)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 155])[32m [repeated 3x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=2145468)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 125])[32m [repeated 2x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
[36m(train_fnn pid=2080125)[0m ERROR:model_data_nn.py:Training failed with exception: Expected more than 1 value per channel when training, got input size torch.Size([1, 175])[32m [repeated 3x across cluster][0m
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
WARNING:tensorboardX.x2num:NaN or Inf found in input tensor.
2024-07-27 17:04:17,506	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_16-59-44' in 0.2522s.
2024-07-27 17:04:17,696	WARNING experiment_analysis.py:558 -- Could not find best trial. Did you pass the correct `metric` parameter?

 Configuration for experiment     train_fnn_2024-07-27_00-21-28   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_00-21-28
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_00-21-24_619107_752378/artifacts/2024-07-27_00-21-28/train_fnn_2024-07-27_00-21-28/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_00-35-07   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_00-35-07
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_00-35-04_003497_752378/artifacts/2024-07-27_00-35-07/train_fnn_2024-07-27_00-35-07/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_01-02-44   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_01-02-44
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_01-02-40_991393_752378/artifacts/2024-07-27_01-02-44/train_fnn_2024-07-27_01-02-44/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_01-36-57   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_01-36-57
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_01-36-54_408947_752378/artifacts/2024-07-27_01-36-57/train_fnn_2024-07-27_01-36-57/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_01-59-49   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_01-59-49
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_01-59-46_000072_752378/artifacts/2024-07-27_01-59-49/train_fnn_2024-07-27_01-59-49/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_03-16-35   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_03-16-35
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_03-16-32_111074_752378/artifacts/2024-07-27_03-16-35/train_fnn_2024-07-27_03-16-35/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_04-05-22   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_04-05-22
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_04-05-18_737006_752378/artifacts/2024-07-27_04-05-22/train_fnn_2024-07-27_04-05-22/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_05-03-09   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_05-03-09
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_05-03-06_215162_752378/artifacts/2024-07-27_05-03-09/train_fnn_2024-07-27_05-03-09/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_05-45-38   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_05-45-38
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_05-45-34_334477_752378/artifacts/2024-07-27_05-45-38/train_fnn_2024-07-27_05-45-38/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_06-32-43   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_06-32-43
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_06-32-40_012826_752378/artifacts/2024-07-27_06-32-43/train_fnn_2024-07-27_06-32-43/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_08-05-31   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_08-05-31
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_08-05-23_892482_752378/artifacts/2024-07-27_08-05-31/train_fnn_2024-07-27_08-05-31/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_09-22-53   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_09-22-53
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_09-22-49_526013_752378/artifacts/2024-07-27_09-22-53/train_fnn_2024-07-27_09-22-53/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_11-24-07   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_11-24-07
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_11-24-03_490453_752378/artifacts/2024-07-27_11-24-07/train_fnn_2024-07-27_11-24-07/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_13-03-00   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_13-03-00
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_13-02-56_764808_752378/artifacts/2024-07-27_13-03-00/train_fnn_2024-07-27_13-03-00/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_15-44-30   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_15-44-30
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_15-44-26_245187_752378/artifacts/2024-07-27_15-44-30/train_fnn_2024-07-27_15-44-30/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_16-59-44   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_16-59-44
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_16-59-39_741850_752378/artifacts/2024-07-27_16-59-44/train_fnn_2024-07-27_16-59-44/driver_artifacts`

Traceback (most recent call last):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py", line 362, in <module>
    main()
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py", line 309, in main
    best_trial = data_modeler.get_best_trial(
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/model_data_nn.py", line 312, in get_best_trial
    logger.info(f"Best trial config: {best_trial.config}")
AttributeError: 'NoneType' object has no attribute 'config'
INFO:postprocess_predictions.py:Post processing prediction files
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1985.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1986.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1987.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1988.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1989.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1990.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1991.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1992.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1993.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1994.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1995.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1996.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1997.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1998.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1999.csv
INFO:postprocess_predictions.py:Sort the result by date and rank both ascendingly
INFO:postprocess_predictions.py:Saved the result file: result.csv
to the directory: kevin/output/prediction/quarterly_new_restricted
