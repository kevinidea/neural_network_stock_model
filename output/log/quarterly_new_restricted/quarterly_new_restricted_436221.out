Current working directory
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml
source kevin/venv/bin/activate
which python3
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/bin/python3
2024-08-01 19:45:05,623	PANIC scripts.py:900 -- `--address` is a required flag unless starting a head node with `--head`.
Error: `{}` is a required flag unless starting a head node with `{}`.
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
INFO:preprocess_data_nn.py:

Loading and preprocessing data...

DEBUG:preprocess_data_nn.py:          date   permno
626    1980-01  10006.0
5399   1980-01  10057.0
11398  1980-01  10137.0
12828  1980-01  10145.0
13984  1980-01  10153.0
DEBUG:preprocess_data_nn.py:--------------------------------------------------
INFO:main_restricted.py:preprocessed df: (667724, 161)
INFO:preprocess_data_nn.py:

Applying secondary data preprocessing..

INFO:main_restricted.py:secondary preprocessed df: (667724, 161)
INFO:main_restricted.py:df sample:     permno       pdate        ym  gvkey  sic2    absacc       acc  ...      roea   roavola       ret        mve_m      retq  pyear     date
0  10006.0  1980-01-01  198001.0   1010    37  0.083420  0.083420  ...  0.141715  0.004512  0.211679   303420.750 -0.055806   1980  1980-01
1  10057.0  1980-01-01  198001.0   1098    36  0.088951  0.088951  ...  0.174252  0.035698  0.282297   111423.125 -0.069431   1980  1980-01
2  10137.0  1980-01-01  198001.0   1279    49  0.041008  0.041008  ...  0.097554  0.006254 -0.032258   617349.500 -0.108065   1980  1980-01
3  10145.0  1980-01-01  198001.0   1300    99  0.050486  0.050486  ...  0.122729  0.004320  0.150127  1415193.000 -0.085950   1980  1980-01
4  10153.0  1980-01-01  198001.0   1308    13       NaN       NaN  ...  0.109950  0.009149 -0.122744   429488.500 -0.285199   1980  1980-01

[5 rows x 161 columns]
INFO:main_restricted.py:Train year start: 1980
INFO:main_restricted.py:Prediction data years: [1986, 1987, 1989, 1991, 1992, 1993, 1994, 1996, 1999, 2000, 2004, 2009, 2010, 2011, 2013, 2015, 2016, 2017]
INFO:main_restricted.py:

Loop through all the prediction years and build optimized model for each year

INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984]
INFO:transform_data_nn.py:Train_data: (50727, 161)

INFO:transform_data_nn.py:Test data years: [1985]
INFO:transform_data_nn.py:Test_data: (14870, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Retrain_data: (65597, 161)

INFO:transform_data_nn.py:Prediction data years: [1986]
INFO:transform_data_nn.py:Prediction_data: (15019, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([50727, 138])
            y_train_tf: torch.Size([50727])

            x_test_tf: torch.Size([14870, 138])
            y_test_tf: torch.Size([14870])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([65597, 138])
            y_retrain_tf: torch.Size([65597])

            x_prediction_tf: torch.Size([15019, 138])
            y_prediction_tf: torch.Size([15019])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-0.0067,  0.3197,  0.2194, -1.2141, -0.1261, -0.6221, -0.0984, -0.2873,
         0.1534, -0.1619, -0.7165, -0.2269, -0.4275, -0.1703,  0.1184,  0.6090,
        -0.1475,  0.0881,  0.0000,  0.5182, -0.3056,  0.0932, -0.0394, -0.0072,
        -0.1154, -0.2093, -0.5687,  0.0000,  0.4274,  0.6948,  0.4798, -0.1521,
         0.3766,  0.0000, -0.4196, -0.1835,  0.0896,  0.2648,  0.1857, -1.1756,
        -0.2486, -0.0574,  0.1861, -0.1307, -0.0974, -0.6779, -0.1000, -0.0419,
        -0.6077, -0.2871, -0.6160,  0.6367, -0.1798, -0.2277,  0.0229,  0.4441,
        -0.7671, -0.1410, -0.3106,  0.1864,  0.0977, -0.3876,  0.1515,  0.3127,
         0.2454, -0.0990,  0.1182, -0.0331,  0.6423, -0.4089,  0.0000,  0.0000,
         0.0000, -0.8463, -0.1161,  0.5137,  0.0479, -0.3351, -0.1862, -0.0302,
         0.0000,  0.5091, -0.0908, -0.0771, -0.5431, -0.0656, -0.0515, -0.3883,
        -0.1546,  0.1526, -0.4652, -1.2916,  0.0000,  0.6123,  1.3429,  0.9783,
        -0.2574,  0.5183, -1.6086, -1.0886, -1.3142,  0.3028,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0558, -0.8242,  0.0000, -1.2617, -1.0052, -1.1608,
         0.0832, -0.0920,  0.0000,  0.0000, -0.0071, -0.1319, -0.0436,  0.1436,
         0.2193, -0.4500, -0.4138,  0.0709,  0.2018, -0.4794,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([1452]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-3.5541e-02, -3.1473e-02,  6.9044e+00, -4.8718e-01, -3.7399e-02,
         1.8157e+00,  1.8471e+00,  2.0916e+00, -5.1028e-01, -4.6532e-01,
         1.1642e+00,  1.4917e-02,  2.0411e-01,  2.9692e-02,  7.6405e-03,
        -8.2565e-03, -2.2184e-01, -2.1168e+00,  0.0000e+00, -9.0573e-03,
        -2.3354e-01,  9.3180e-02,  8.9928e-03, -1.8666e-02, -9.8145e-03,
        -2.9154e-01,  2.9385e-02,  0.0000e+00, -1.3687e+00, -9.4795e-01,
         1.4198e+00, -3.8788e-02,  1.4494e-01,  0.0000e+00,  3.3448e+00,
         1.7744e-02,  1.6136e-02, -1.7888e-01, -1.7655e-01,  1.3208e+00,
        -8.3496e-02, -1.4023e+00, -1.4078e-02, -4.2197e-01, -1.9644e-02,
         3.2230e-01, -1.3703e+00,  2.5145e-01, -3.6213e-01, -1.5088e+00,
         2.8064e+00, -1.1100e+00, -9.4838e-02, -2.2774e-01,  7.9354e-01,
         3.3974e-01, -2.1428e-02,  2.3160e-02, -2.2957e-02,  2.9556e-02,
        -8.7836e-03, -2.1470e-02,  3.6345e-02,  4.2058e-02, -9.7462e-03,
         1.5879e-02, -2.3376e-02,  1.6198e-02,  6.4233e-01,  3.8849e-02,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  3.2896e-01,  3.0743e-01,
        -1.4042e-02, -2.0656e-01,  1.2085e+00,  6.9330e+00, -3.0173e-02,
         0.0000e+00,  1.5769e-02, -3.4090e-01, -9.1126e-01, -5.2861e-01,
        -6.6146e-02, -5.1157e-02, -5.5830e-02,  5.6105e-01, -2.3373e-02,
        -4.1076e-01,  1.9687e+00,  0.0000e+00, -6.7487e-01, -3.0891e-01,
        -1.0547e+00, -3.5636e+00, -1.0826e+00,  1.0152e+00, -1.2112e+00,
        -5.3489e-01, -3.4670e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00, -6.0399e-03,  2.0349e-03,  0.0000e+00,  6.4186e-01,
        -1.1317e+00,  9.6608e-01, -4.2225e-03, -9.1975e-02,  0.0000e+00,
         0.0000e+00,  3.1905e-02, -1.0698e-02, -4.3647e-02, -1.5213e-02,
         3.4496e-02,  5.0923e-01,  8.7191e-02,  5.3129e-01,  2.3714e-01,
        -4.0068e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2865]), tensor(0.4426))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.0866e-01,  2.1567e-01,  1.8687e-01, -1.2464e+00, -1.4750e-01,
        -6.0599e-01, -1.1476e-01, -3.0086e-01,  2.0923e-01, -1.6396e-01,
        -7.1105e-01, -1.6450e-01, -4.3970e-01, -9.2192e-02,  9.0120e-02,
         5.5198e-01, -1.4281e-01,  8.2749e-02,  0.0000e+00,  4.3716e-01,
        -3.6548e-01, -2.8282e-01, -1.3577e-03, -7.1517e-04, -1.0327e-01,
        -2.2369e-01, -5.8433e-01,  0.0000e+00,  4.3690e-01,  7.8414e-01,
         4.8983e-01, -1.4383e-01,  3.8715e-01,  0.0000e+00, -4.1197e-01,
        -1.8811e-01,  7.5261e-02,  3.1092e-01,  1.0364e-01, -1.1787e+00,
        -2.5471e-01,  4.8843e-02,  1.3564e-01, -1.0668e-01, -1.4147e-01,
        -6.4896e-01, -3.6768e-02, -2.3174e-03, -6.2742e-01, -2.8325e-01,
        -6.2002e-01,  6.6451e-01, -1.8099e-01, -1.8662e-01,  2.1484e-02,
         4.4240e-01, -7.6693e-01, -1.0270e-01, -2.7572e-01,  1.4888e-01,
         9.8031e-02, -3.4406e-01,  1.6447e-01,  2.9799e-01,  2.0712e-01,
        -9.6412e-02,  6.7037e-02, -5.1608e-02,  6.5689e-01, -4.0800e-01,
         0.0000e+00,  0.0000e+00, -1.5042e-01, -8.0966e-01, -6.3832e-02,
         5.2703e-01,  4.8402e-02, -3.4089e-01, -1.8360e-01, -1.1685e-02,
         0.0000e+00,  3.8418e-01, -4.3338e-02, -1.5994e-01, -5.4566e-01,
        -7.2678e-02, -5.8190e-02, -3.8189e-01, -1.6225e-01,  1.5746e-01,
        -4.7465e-01, -1.2857e+00, -1.7335e+00,  8.5916e-01,  1.5859e+00,
         1.2321e+00,  3.1903e-01,  7.7744e-01, -1.8854e+00, -8.3912e-01,
        -1.1769e+00,  1.9221e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.8057e-02,  4.2140e-02,  0.0000e+00, -1.4389e+00,
        -4.1932e-01, -1.4216e+00,  9.8359e-02, -3.2869e-02,  0.0000e+00,
         0.0000e+00,  1.1453e-02, -1.5504e-01, -6.1259e-02,  1.0941e-01,
         2.4897e-01, -4.3682e-01, -4.0812e-01,  1.0562e-01,  2.0867e-01,
        -3.8885e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([1643]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-4.7985e-01, -1.6106e+00, -5.5060e-01, -4.7226e-03,  4.3003e+00,
        -3.5303e-01,  1.3575e+00,  1.3208e+00, -9.6294e-01, -9.4089e-01,
        -3.5415e-03, -1.7267e-01,  2.3447e-01,  5.6794e-01,  2.5223e+00,
        -1.8668e-03, -2.1744e-01, -3.3228e-01,  0.0000e+00, -5.0880e-02,
        -2.8527e-01, -2.8282e-01,  2.4364e-03,  3.5003e-01,  1.5369e+00,
        -9.0415e-01, -2.9426e-01,  0.0000e+00,  9.5529e-02, -8.8314e-01,
         2.8603e-04,  2.4687e-01, -4.5384e-02,  0.0000e+00,  1.1446e+00,
        -1.0048e-02,  2.4348e+00, -2.1209e-01,  7.2558e-02,  7.3454e-01,
        -2.5444e-01, -5.1495e-01,  1.5967e+00, -3.6739e-01,  5.6767e+00,
        -5.8272e-02,  2.4333e+00,  5.6871e-01, -1.0539e+00,  1.2308e+00,
         7.9871e-01, -4.5356e-01, -1.0711e-01, -1.8662e-01,  7.8078e-01,
         2.3879e-01,  2.1691e+00, -7.9302e-02, -2.0149e+00, -1.8340e+00,
         5.3175e-02, -1.7157e+00, -1.0708e+00, -1.6445e+00,  5.1078e-02,
        -8.4687e-01, -8.4636e-01, -2.4089e-01, -9.0968e-03, -6.6790e-01,
         0.0000e+00,  0.0000e+00,  8.1978e+00, -6.6867e-01, -2.6865e-01,
         8.8454e-03, -2.2079e-01,  6.3787e-01,  6.9349e+00, -1.1685e-02,
         0.0000e+00,  2.8331e-01, -6.1461e-01,  1.0987e+00,  1.6332e+00,
        -6.1567e-02, -5.2940e-02, -2.8137e-01, -1.1726e+00,  4.7360e-01,
         1.9134e+00, -7.8598e-01, -1.7335e+00, -1.9806e+00, -2.0008e+00,
        -1.6215e+00, -1.1878e+00, -1.1509e+00,  2.4348e-01, -5.9449e-01,
        -3.1360e-01, -1.6351e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.9270e-02,  1.3996e-01,  0.0000e+00, -7.9850e-02,
        -1.3016e+00,  8.1629e-01, -8.0799e-04, -3.2869e-02,  0.0000e+00,
         0.0000e+00, -1.7570e+00,  1.4390e+00, -6.1259e-02,  1.3578e+00,
        -1.7508e-03, -4.8388e-01, -1.1590e+00, -7.4953e-02,  1.1934e-01,
         4.9949e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2889]), tensor(0.2099))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984]
INFO:main_restricted.py:Testing data year: 1985
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 4249
            device: cpu
            
2024-08-01 19:52:57,322	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-01 19:52:57,413	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-01 19:52:57,468	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip' (5.13MiB) to Ray cluster...
2024-08-01 19:52:57,484	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip'.
2024-08-01 19:52:59,031	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-01 20:02:12,634	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_19-52-58' in 0.3400s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 55, 'num_layers': 5, 'num_embeddings': 4249, 'embedding_dim': 4, 'dropout_rate': 0.45, 'lr': 3.2355986782053776e-06, 'weight_decay': 1.5554708319905757e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.04726907245356484
INFO:model_data_nn.py:Best trial testing loss: 0.05449144710456171
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-01_19-52-54_548439_1598840/artifacts/2024-08-01_19-52-58/train_fnn_2024-08-01_19-52-58/driver_artifacts/train_fnn_538ea_00126_126_dropout_rate=0.4500,embedding_dim=4,hidden_dim=55,lr=0.0000,num_layers=5,weight_decay=0.0000_2024-08-01_19-52-59
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 55, 'num_layers': 5, 'num_embeddings': 4799, 'embedding_dim': 4, 'dropout_rate': 0.45, 'lr': 3.2355986782053776e-06, 'weight_decay': 1.5554708319905757e-05, 'num_epochs': 50, 'num_gpus': 0}

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/cuda/__init__.py:619: UserWarning: Can't initialize NVML
  warnings.warn("Can't initialize NVML")
INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.05393109920495106, 'avg_test_loss': 0.0629422710217694}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.05297046929521494, 'avg_test_loss': 0.06303260964044231}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.05237249768461365, 'avg_test_loss': 0.06300178451186166}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.05186006538169945, 'avg_test_loss': 0.06291861174865923}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.05145567515524074, 'avg_test_loss': 0.06297035956002296}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.05104813308683676, 'avg_test_loss': 0.0629535730155383}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.05083029878472572, 'avg_test_loss': 0.06292157836575457}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.050468406382731805, 'avg_test_loss': 0.06296197345797369}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.05039742536181034, 'avg_test_loss': 0.06298276775100446}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.050272282596137564, 'avg_test_loss': 0.06308085022969766}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.050169457121047235, 'avg_test_loss': 0.0629918620366841}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.05010598637081824, 'avg_test_loss': 0.06298499206635863}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.04992693012444827, 'avg_test_loss': 0.0630821521037278}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.0498888523569226, 'avg_test_loss': 0.06307509326514729}
INFO:model_data_nn.py:Early stopping at epoch 14
INFO:main_restricted.py:Making prediction for data in year: 1986
INFO:main_restricted.py:Prediction data shape: (15019,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1986: 0.2512600300206067
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  1.501900e+04  15019.000000
mean   2.116020e-02      0.035935
std    2.505653e-01      0.007739
min   -9.375002e-01     -0.135238
25%   -1.200001e-01      0.031334
50%    1.000000e-07      0.037870
75%    1.356736e-01      0.041629
max    3.999999e+00      0.060416
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Train_data: (65597, 161)

INFO:transform_data_nn.py:Test data years: [1986]
INFO:transform_data_nn.py:Test_data: (15019, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:transform_data_nn.py:Retrain_data: (80616, 161)

INFO:transform_data_nn.py:Prediction data years: [1987]
INFO:transform_data_nn.py:Prediction_data: (15222, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([65597, 138])
            y_train_tf: torch.Size([65597])

            x_test_tf: torch.Size([15019, 138])
            y_test_tf: torch.Size([15019])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([80616, 138])
            y_retrain_tf: torch.Size([80616])

            x_prediction_tf: torch.Size([15222, 138])
            y_prediction_tf: torch.Size([15222])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.0866e-01,  2.1567e-01,  1.8687e-01, -1.2464e+00, -1.4750e-01,
        -6.0599e-01, -1.1476e-01, -3.0086e-01,  2.0923e-01, -1.6396e-01,
        -7.1105e-01, -1.6450e-01, -4.3970e-01, -9.2192e-02,  9.0120e-02,
         5.5198e-01, -1.4281e-01,  8.2749e-02,  0.0000e+00,  4.3716e-01,
        -3.6548e-01, -2.8282e-01, -1.3577e-03, -7.1517e-04, -1.0327e-01,
        -2.2369e-01, -5.8433e-01,  0.0000e+00,  4.3690e-01,  7.8414e-01,
         4.8983e-01, -1.4383e-01,  3.8715e-01,  0.0000e+00, -4.1197e-01,
        -1.8811e-01,  7.5261e-02,  3.1092e-01,  1.0364e-01, -1.1787e+00,
        -2.5471e-01,  4.8843e-02,  1.3564e-01, -1.0668e-01, -1.4147e-01,
        -6.4896e-01, -3.6768e-02, -2.3174e-03, -6.2742e-01, -2.8325e-01,
        -6.2002e-01,  6.6451e-01, -1.8099e-01, -1.8662e-01,  2.1484e-02,
         4.4240e-01, -7.6693e-01, -1.0270e-01, -2.7572e-01,  1.4888e-01,
         9.8031e-02, -3.4406e-01,  1.6447e-01,  2.9799e-01,  2.0712e-01,
        -9.6412e-02,  6.7037e-02, -5.1608e-02,  6.5689e-01, -4.0800e-01,
         0.0000e+00,  0.0000e+00, -1.5042e-01, -8.0966e-01, -6.3832e-02,
         5.2703e-01,  4.8402e-02, -3.4089e-01, -1.8360e-01, -1.1685e-02,
         0.0000e+00,  3.8418e-01, -4.3338e-02, -1.5994e-01, -5.4566e-01,
        -7.2678e-02, -5.8190e-02, -3.8189e-01, -1.6225e-01,  1.5746e-01,
        -4.7465e-01, -1.2857e+00, -1.7335e+00,  8.5916e-01,  1.5859e+00,
         1.2321e+00,  3.1903e-01,  7.7744e-01, -1.8854e+00, -8.3912e-01,
        -1.1769e+00,  1.9221e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.8057e-02,  4.2140e-02,  0.0000e+00, -1.4389e+00,
        -4.1932e-01, -1.4216e+00,  9.8359e-02, -3.2869e-02,  0.0000e+00,
         0.0000e+00,  1.1453e-02, -1.5504e-01, -6.1259e-02,  1.0941e-01,
         2.4897e-01, -4.3682e-01, -4.0812e-01,  1.0562e-01,  2.0867e-01,
        -3.8885e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([1643]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-4.7985e-01, -1.6106e+00, -5.5060e-01, -4.7226e-03,  4.3003e+00,
        -3.5303e-01,  1.3575e+00,  1.3208e+00, -9.6294e-01, -9.4089e-01,
        -3.5415e-03, -1.7267e-01,  2.3447e-01,  5.6794e-01,  2.5223e+00,
        -1.8668e-03, -2.1744e-01, -3.3228e-01,  0.0000e+00, -5.0880e-02,
        -2.8527e-01, -2.8282e-01,  2.4364e-03,  3.5003e-01,  1.5369e+00,
        -9.0415e-01, -2.9426e-01,  0.0000e+00,  9.5529e-02, -8.8314e-01,
         2.8603e-04,  2.4687e-01, -4.5384e-02,  0.0000e+00,  1.1446e+00,
        -1.0048e-02,  2.4348e+00, -2.1209e-01,  7.2558e-02,  7.3454e-01,
        -2.5444e-01, -5.1495e-01,  1.5967e+00, -3.6739e-01,  5.6767e+00,
        -5.8272e-02,  2.4333e+00,  5.6871e-01, -1.0539e+00,  1.2308e+00,
         7.9871e-01, -4.5356e-01, -1.0711e-01, -1.8662e-01,  7.8078e-01,
         2.3879e-01,  2.1691e+00, -7.9302e-02, -2.0149e+00, -1.8340e+00,
         5.3175e-02, -1.7157e+00, -1.0708e+00, -1.6445e+00,  5.1078e-02,
        -8.4687e-01, -8.4636e-01, -2.4089e-01, -9.0968e-03, -6.6790e-01,
         0.0000e+00,  0.0000e+00,  8.1978e+00, -6.6867e-01, -2.6865e-01,
         8.8454e-03, -2.2079e-01,  6.3787e-01,  6.9349e+00, -1.1685e-02,
         0.0000e+00,  2.8331e-01, -6.1461e-01,  1.0987e+00,  1.6332e+00,
        -6.1567e-02, -5.2940e-02, -2.8137e-01, -1.1726e+00,  4.7360e-01,
         1.9134e+00, -7.8598e-01, -1.7335e+00, -1.9806e+00, -2.0008e+00,
        -1.6215e+00, -1.1878e+00, -1.1509e+00,  2.4348e-01, -5.9449e-01,
        -3.1360e-01, -1.6351e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.9270e-02,  1.3996e-01,  0.0000e+00, -7.9850e-02,
        -1.3016e+00,  8.1629e-01, -8.0799e-04, -3.2869e-02,  0.0000e+00,
         0.0000e+00, -1.7570e+00,  1.4390e+00, -6.1259e-02,  1.3578e+00,
        -1.7508e-03, -4.8388e-01, -1.1590e+00, -7.4953e-02,  1.1934e-01,
         4.9949e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2889]), tensor(0.2099))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.1414,  0.1986,  0.1728, -1.2784, -0.1442, -0.6168, -0.1266, -0.3134,
         0.2711, -0.1654, -0.7099, -0.1157, -0.4643, -0.0527,  0.0539,  0.5454,
        -0.1487,  0.1052,  0.0000,  0.4468, -0.3606, -0.2099,  0.0230,  0.0144,
        -0.0802, -0.2349, -0.5752,  0.0000,  0.4123,  0.8678,  0.4872, -0.1312,
         0.4094,  0.0000, -0.3989, -0.2029,  0.0721,  0.3417,  0.0772, -1.1731,
        -0.2581,  0.0194,  0.1417, -0.0841, -0.1514, -0.6566, -0.0554, -0.0098,
        -0.5561, -0.2960, -0.6232,  0.6637, -0.1749, -0.0577,  0.0330,  0.4444,
        -0.7661, -0.0492, -0.2734,  0.0823,  0.1064, -0.3426,  0.1596,  0.2937,
         0.2057, -0.1063,  0.0391, -0.0557,  0.7033, -0.4125,  0.0000,  0.0000,
         0.0513, -0.8156, -0.0191,  0.5723,  0.0427, -0.3448, -0.1804, -0.0102,
         0.0000,  0.3570,  0.0039, -0.1845, -0.5544, -0.0788, -0.0637, -0.3736,
        -0.1572,  0.1355, -0.5050, -1.2963,  0.1945,  0.9785,  1.5414,  1.3476,
         0.4970,  0.9783, -2.0705, -0.7350, -1.1693,  0.1734,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0678,  0.3529,  0.0000, -1.5779, -0.1659, -1.6371,
         0.1135,  0.0465,  0.0000,  0.0000,  0.0170, -0.1662, -0.0735,  0.0650,
         0.2120, -0.4261, -0.3975,  0.1463,  0.2233, -0.3880,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([1780]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([ 1.7846e+00,  1.9069e+00,  3.4361e-01, -1.9137e-01,  1.3492e+00,
         2.6575e+00, -8.9253e-01, -7.8656e-01, -4.9982e-01, -6.4854e-01,
        -5.2989e-01, -1.1458e-01,  2.3261e-01, -3.7458e-01,  1.8167e+00,
         2.3084e+00, -2.2699e-01,  3.8054e+00,  0.0000e+00,  3.2725e+00,
        -9.5187e-04, -2.0993e-01,  1.1770e-02, -2.6351e-03,  6.2052e-02,
         1.0155e+00,  2.0266e+00,  0.0000e+00, -1.3806e+00, -8.3095e-01,
        -4.6921e-01, -1.4888e-01,  4.0902e-02,  0.0000e+00,  1.2258e+00,
        -2.0736e-01,  1.9689e-01,  3.9878e-01,  4.5772e+00, -5.7555e-01,
         3.6600e-01, -5.7831e-01,  2.2737e+00, -3.6082e-01,  2.8400e+00,
        -1.0271e+00, -2.3747e-01, -1.0380e+00, -6.8909e-01,  5.0096e-02,
        -6.2317e-01, -1.0957e+00, -1.3055e-01, -5.7724e-02, -7.3486e-01,
         4.8713e-02,  1.0536e+00, -3.2655e-01,  5.9465e-01,  3.3433e+00,
         2.0045e-01,  6.5240e-01,  8.6342e-01,  5.6553e-01, -1.9344e+00,
         3.9479e-01,  1.1737e+00, -5.9419e-01, -1.2752e+00, -3.7517e-01,
         0.0000e+00,  0.0000e+00,  5.1340e-02, -6.4841e-01, -1.0715e-01,
         1.5993e+00, -7.7461e-02, -3.9745e-01,  2.2093e-01, -9.8308e-01,
         0.0000e+00,  2.2845e+00, -2.7875e-01,  2.0295e+00, -6.1026e-02,
        -4.8734e-02, -4.9927e-02, -3.6036e-01, -2.2350e-01, -1.2884e-01,
        -6.0508e-01,  3.0593e+00,  1.9446e-01, -1.6323e+00, -1.7286e+00,
        -1.5430e+00, -6.3486e-01, -1.3849e+00,  2.0114e-01, -3.2475e-01,
        -3.6099e-01,  1.8927e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6502e-02,  3.5288e-01,  0.0000e+00,  7.4865e-01,
        -1.3943e+00,  3.3312e-01, -1.9827e-02,  4.6549e-02,  0.0000e+00,
         0.0000e+00,  2.7868e+00,  5.3752e-01, -7.3545e-02,  3.3132e-01,
         1.7485e+00,  4.2340e-01, -6.2935e-02,  5.9027e-03,  4.3736e-02,
         3.4040e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3870]), tensor(3.2000e-07))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:main_restricted.py:Testing data year: 1986
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 4799
            device: cpu
            
2024-08-01 20:13:43,619	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-01 20:13:43,666	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-01 20:13:43,719	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip' (5.13MiB) to Ray cluster...
2024-08-01 20:13:43,735	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip'.
2024-08-01 20:13:45,083	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-01 20:25:49,828	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_20-13-45' in 0.3285s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 2, 'num_embeddings': 4799, 'embedding_dim': 5, 'dropout_rate': 0.4, 'lr': 8.243308697155099e-06, 'weight_decay': 4.251556274263093e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.04734222816367915
INFO:model_data_nn.py:Best trial testing loss: 0.06279229271086924
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-01_20-13-41_353335_1598840/artifacts/2024-08-01_20-13-45/train_fnn_2024-08-01_20-13-45/driver_artifacts/train_fnn_3a49e_00122_122_dropout_rate=0.4000,embedding_dim=5,hidden_dim=5,lr=0.0000,num_layers=2,weight_decay=0.0000_2024-08-01_20-13-45
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 2, 'num_embeddings': 5134, 'embedding_dim': 5, 'dropout_rate': 0.4, 'lr': 8.243308697155099e-06, 'weight_decay': 4.251556274263093e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.05321868831671127, 'avg_test_loss': 0.09183316407803477}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.05249834894459605, 'avg_test_loss': 0.09228753011689342}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.052197490595488165, 'avg_test_loss': 0.09225098420122341}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.05211100356195621, 'avg_test_loss': 0.09254390778638297}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.051989675574551836, 'avg_test_loss': 0.09242096977472744}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.051925551014279106, 'avg_test_loss': 0.09245283379289909}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.05186616414074637, 'avg_test_loss': 0.09247092270887136}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.05182241414255474, 'avg_test_loss': 0.0922895447241471}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.05180291301427012, 'avg_test_loss': 0.09214277980270005}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.05172917348158566, 'avg_test_loss': 0.09209970052612304}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.051661440082938485, 'avg_test_loss': 0.09197156314988535}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main_restricted.py:Making prediction for data in year: 1987
INFO:main_restricted.py:Prediction data shape: (15222,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1987: 0.30310329361648486
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  1.522200e+04  15222.000000
mean  -7.633223e-03      0.037487
std    3.006234e-01      0.012627
min   -9.431818e-01     -0.066055
25%   -1.803514e-01      0.032083
50%   -7.049888e-07      0.040449
75%    1.343371e-01      0.044913
max    5.466666e+00      0.086856
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:transform_data_nn.py:Train_data: (95838, 161)

INFO:transform_data_nn.py:Test data years: [1988]
INFO:transform_data_nn.py:Test_data: (16210, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:transform_data_nn.py:Retrain_data: (112048, 161)

INFO:transform_data_nn.py:Prediction data years: [1989]
INFO:transform_data_nn.py:Prediction_data: (16366, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([95838, 138])
            y_train_tf: torch.Size([95838])

            x_test_tf: torch.Size([16210, 138])
            y_test_tf: torch.Size([16210])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([112048, 138])
            y_retrain_tf: torch.Size([112048])

            x_prediction_tf: torch.Size([16366, 138])
            y_prediction_tf: torch.Size([16366])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.6749e-01,  1.8039e-01,  1.7439e-01, -1.2934e+00, -1.5217e-01,
        -6.2532e-01, -1.4105e-01, -3.2622e-01,  3.3397e-01, -1.7092e-01,
        -7.1138e-01, -7.9930e-02, -4.8715e-01, -2.8729e-02,  5.0620e-02,
         5.3680e-01, -1.5086e-01,  1.3707e-01,  0.0000e+00,  4.4747e-01,
        -3.6798e-01, -2.7737e-02,  1.7979e-02,  3.1756e-03, -6.1519e-02,
        -2.4363e-01, -5.7138e-01,  0.0000e+00,  3.8881e-01,  9.3932e-01,
         4.8111e-01, -1.3014e-01,  4.3260e-01,  0.0000e+00, -3.8304e-01,
        -1.9981e-01,  7.3661e-02,  3.5875e-01,  5.9394e-02, -1.1663e+00,
        -2.6389e-01,  6.3167e-02,  1.5538e-01, -6.6349e-02, -1.6337e-01,
        -6.5926e-01, -3.2849e-02, -9.8768e-03, -5.4961e-01, -2.9247e-01,
        -6.2524e-01,  6.5618e-01, -1.6367e-01, -1.3712e-03,  3.0379e-02,
         4.4666e-01, -7.6340e-01, -1.8507e-02, -2.7156e-01,  4.5804e-02,
         1.0842e-01, -3.4037e-01,  1.5983e-01,  2.9087e-01,  1.9905e-01,
        -1.1055e-01,  1.8707e-02, -6.5066e-02,  7.2838e-01, -4.1396e-01,
         0.0000e+00,  0.0000e+00,  2.9079e-03, -8.1796e-01,  1.3836e-02,
         5.9724e-01,  4.4363e-02, -3.4442e-01, -1.8141e-01, -1.1348e-02,
         0.0000e+00,  3.2837e-01,  4.7142e-02, -2.1021e-01, -5.5949e-01,
        -8.4724e-02, -6.9207e-02, -3.6622e-01, -1.4938e-01,  1.0129e-01,
        -5.1817e-01, -1.3017e+00,  9.1096e-02,  1.0397e+00,  1.5247e+00,
         1.4285e+00,  5.4615e-01,  1.1460e+00, -2.2843e+00, -6.0600e-01,
        -1.2501e+00,  1.5397e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.2503e-02,  7.6798e-02,  0.0000e+00, -1.7350e+00,
         2.3586e-02, -1.8329e+00,  1.2462e-01,  8.6240e-02,  0.0000e+00,
         0.0000e+00,  2.4629e-02, -1.7408e-01, -7.1432e-02,  3.1925e-02,
         2.0089e-01, -4.1318e-01, -3.9079e-01,  1.7856e-01,  2.3805e-01,
        -3.9978e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([1973]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-6.8700e-03, -1.3906e-03, -6.2760e-01, -8.1075e-01, -6.9975e-01,
        -1.2774e-01, -1.8530e+00, -1.0250e+00, -1.8833e-02,  3.1154e-04,
        -3.5055e-01, -2.2122e-01,  5.2339e-02, -5.7797e-03,  3.0203e-02,
        -1.4377e+00, -2.2830e-01, -1.2641e-01,  0.0000e+00, -2.4754e-01,
         3.5335e-01, -2.7737e-02,  1.3908e-03,  3.7832e-02,  8.8959e-03,
        -6.3207e-01, -7.4060e-01,  0.0000e+00, -7.5916e-01,  2.7774e-02,
        -9.9067e-01, -3.3856e-01,  4.6256e-02,  0.0000e+00, -2.4031e+00,
         9.2312e-03, -6.2428e-01, -5.2958e-01, -2.9028e-01, -7.8854e-01,
         7.0285e-01, -9.9150e-01, -5.3299e-01, -1.9134e-01,  1.1251e-02,
        -1.0866e-01, -5.3210e-01, -2.8988e-01, -2.8152e-01, -6.9593e-02,
         1.1890e-01, -1.4763e+00, -4.8603e-01, -1.3712e-03, -7.4046e-01,
        -1.6129e+00, -1.0878e+00, -3.7510e-01, -5.6659e-02,  5.8481e-03,
        -2.8530e+00, -5.3244e-02, -9.0868e-02, -5.0486e+00, -4.3985e-03,
        -3.9025e-01, -8.4175e-03,  1.7970e+00, -5.7971e-01, -3.6225e-01,
         0.0000e+00,  0.0000e+00,  2.9079e-03,  1.4063e-01, -1.8985e-01,
        -2.2815e-01, -1.4983e-01,  3.2499e+00, -2.0335e-01, -1.1348e-02,
         0.0000e+00, -9.9196e-01, -3.1309e-02,  2.4329e+00,  3.8119e+00,
        -7.3119e-02, -6.3627e-02, -2.3311e-01,  6.0460e-01, -2.8651e-01,
         7.7305e-01,  5.7043e-01,  9.1096e-02, -7.2100e-01, -5.6034e-01,
        -1.0275e+00,  6.9980e-01, -1.0601e+00,  7.4176e-01, -9.7179e-01,
         5.6117e+00, -3.1374e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.0423e-02,  7.6798e-02,  0.0000e+00, -1.1967e+00,
        -1.4312e+00,  1.0112e-01, -1.5572e-02,  5.0367e+00,  0.0000e+00,
         0.0000e+00, -1.4247e+00, -2.4009e-01, -7.1432e-02,  1.6151e+00,
         5.1085e-03,  7.5954e-01, -3.9705e-01, -7.9781e-02, -1.5664e-02,
         1.0374e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4072]), tensor(0.0613))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-2.0368e-01,  1.4613e-01,  1.6670e-01, -1.2996e+00, -1.5581e-01,
        -6.3490e-01, -1.5167e-01, -3.3234e-01,  3.4130e-01, -1.6509e-01,
        -7.1113e-01, -3.0598e-02, -4.9210e-01,  1.7698e-02,  2.7621e-02,
         5.2354e-01, -1.4034e-01,  1.7132e-01,  0.0000e+00,  4.3357e-01,
        -3.6155e-01,  7.5280e-02,  1.7328e-02,  8.9085e-03, -6.4428e-02,
        -2.5203e-01, -5.6494e-01,  0.0000e+00,  4.0549e-01,  9.9060e-01,
         4.7090e-01, -1.2756e-01,  4.3668e-01,  0.0000e+00, -3.7373e-01,
        -1.9599e-01,  6.2056e-02,  3.9172e-01,  3.1288e-02, -1.1685e+00,
        -2.7627e-01,  2.4020e-01,  1.8337e-01, -6.8351e-02, -1.7270e-01,
        -6.6981e-01,  7.0629e-02, -5.5404e-02, -5.4842e-01, -2.0600e-01,
        -6.1664e-01,  6.6804e-01, -1.6028e-01,  2.4212e-03,  2.3795e-02,
         4.4623e-01, -7.5902e-01, -7.9499e-06, -2.6507e-01,  1.4397e-02,
         1.1498e-01, -3.3111e-01,  1.5373e-01,  2.8344e-01,  1.5654e-01,
        -1.1914e-01, -4.6283e-03, -7.3628e-02,  7.4786e-01, -4.1645e-01,
         0.0000e+00,  0.0000e+00, -1.9676e-01, -8.1574e-01,  3.7799e-02,
         5.7971e-01,  4.3629e-02, -3.4559e-01, -1.8308e-01, -4.2580e-03,
         0.0000e+00,  2.7307e-01,  5.3735e-02, -2.4523e-01, -5.5063e-01,
        -9.1112e-02, -7.4417e-02, -3.6511e-01, -1.3978e-01,  1.0272e-01,
        -5.1587e-01, -1.2930e+00,  3.7267e-02,  1.1955e+00,  1.6803e+00,
         1.5826e+00,  5.7628e-01,  1.3009e+00, -2.4806e+00, -4.5262e-01,
        -1.0432e+00,  1.1783e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.2399e-02,  2.5983e-01,  0.0000e+00, -1.4926e+00,
         2.5113e-01, -2.0098e+00,  1.3238e-01,  2.3763e-02,  0.0000e+00,
         0.0000e+00,  2.7788e-02, -1.7916e-01,  1.6315e-02,  6.6375e-03,
         1.8096e-01, -4.1411e-01, -3.8277e-01,  1.9860e-01,  2.4497e-01,
        -3.9885e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2168]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-1.0328e-02, -4.5945e-03, -6.1175e-01, -4.2919e-01, -2.9979e-01,
        -5.8820e-02, -1.9398e+00, -1.0548e+00, -4.8105e-02,  9.2327e-02,
        -1.9427e-02,  1.6832e-02, -3.9303e-02, -1.2090e-02,  3.2950e-02,
         3.7676e-01, -2.2029e-01, -4.9129e-01,  0.0000e+00,  5.6969e-03,
        -8.4695e-02,  7.5280e-02,  3.7865e-02,  9.6094e-01, -7.9298e-03,
        -4.5620e-03, -7.2574e-01,  0.0000e+00, -1.4182e+00,  3.7398e-02,
         4.2706e-01, -1.7737e-01,  2.7372e-01,  0.0000e+00,  1.7543e-03,
        -6.5350e-01,  7.9022e-03, -5.5227e-01, -8.4291e-01, -7.9602e-01,
         8.6959e-01,  7.0136e-02,  1.2240e-02,  2.1631e-02, -3.8938e-03,
         3.6990e-01,  6.9289e-02, -2.2570e-01, -4.2325e-01,  3.5530e-02,
         8.9260e-01, -1.3853e+00, -5.1862e-01, -2.5414e+00, -7.4346e-01,
         1.2464e-02, -1.0845e+00,  6.9339e-01,  7.3179e-03, -4.0037e-01,
        -5.0445e-03,  7.0648e-03,  7.1479e-03,  9.0722e-03, -1.6392e-02,
        -3.6987e-04, -9.4731e-03,  1.7388e+00,  1.3989e+00, -9.5058e-03,
         0.0000e+00,  0.0000e+00, -1.9676e-01,  6.6468e-01,  1.7143e-02,
        -8.8511e-02,  3.6591e-04, -1.2622e-03,  7.1653e-04, -4.2580e-03,
         0.0000e+00, -3.3035e-01, -6.4811e-02, -4.3878e-01, -5.6962e-01,
        -7.8317e-02, -6.8695e-02,  2.3996e-02, -1.0220e-04, -9.2791e-02,
        -6.5617e-01,  6.2750e-01,  3.7267e-02, -6.8854e-01,  8.3982e-02,
        -1.0567e+00, -1.3036e+00, -1.2722e-01, -6.6624e-01, -1.0806e+00,
        -9.2166e-01, -6.2909e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0426e-02,  2.5983e-01,  0.0000e+00, -1.3044e+00,
        -1.2224e+00,  4.1615e-01,  6.2709e-02,  2.3763e-02,  0.0000e+00,
         0.0000e+00,  1.2651e-02, -2.0436e-01,  1.6315e-02, -2.0294e-02,
        -8.1752e-04,  1.9352e-03, -2.3160e-02,  2.4850e-01,  1.9696e-01,
         1.4419e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3954]), tensor(0.0776))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:main_restricted.py:Testing data year: 1988
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 5713
            device: cpu
            
2024-08-01 20:39:38,276	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-01 20:39:38,330	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-01 20:39:38,391	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip' (5.13MiB) to Ray cluster...
2024-08-01 20:39:38,406	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip'.
2024-08-01 20:39:39,808	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-01 20:57:36,389	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_20-39-39' in 0.3503s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 3, 'num_embeddings': 5713, 'embedding_dim': 4, 'dropout_rate': 0.18, 'lr': 4.622338301677029e-06, 'weight_decay': 4.471233183495595e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.05321248484596252
INFO:model_data_nn.py:Best trial testing loss: 0.06097145991939941
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-01_20-39-35_787086_1598840/artifacts/2024-08-01_20-39-39/train_fnn_2024-08-01_20-39-39/driver_artifacts/train_fnn_d8fa1_00076_76_dropout_rate=0.1800,embedding_dim=4,hidden_dim=25,lr=0.0000,num_layers=3,weight_decay=0.0000_2024-08-01_20-39-40
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 3, 'num_embeddings': 6323, 'embedding_dim': 4, 'dropout_rate': 0.18, 'lr': 4.622338301677029e-06, 'weight_decay': 4.471233183495595e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.06005005461239101, 'avg_test_loss': 0.06331031987610913}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.059264700208843536, 'avg_test_loss': 0.0631489199186035}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.059035686809826037, 'avg_test_loss': 0.06307246588767157}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.05881312002407393, 'avg_test_loss': 0.06302921335918654}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.05872418008685129, 'avg_test_loss': 0.06299689502702677}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.058645618223962664, 'avg_test_loss': 0.06298324111412512}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.05838687209371489, 'avg_test_loss': 0.06298609466648486}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.05826328057871311, 'avg_test_loss': 0.06294762638935936}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.058219248253104094, 'avg_test_loss': 0.06293976855340588}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.0580122570188807, 'avg_test_loss': 0.06298322136353818}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.05788626889167505, 'avg_test_loss': 0.06294542014984472}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.057765628906300465, 'avg_test_loss': 0.06296686850873812}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.05762949422766901, 'avg_test_loss': 0.06296109912182146}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.05748927368819969, 'avg_test_loss': 0.06299785203373176}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.057345998270495115, 'avg_test_loss': 0.06309721821162384}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.05725600051416163, 'avg_test_loss': 0.06300392640878272}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.05710356189797254, 'avg_test_loss': 0.06304013386579754}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.056943579334036785, 'avg_test_loss': 0.06313089215109358}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.05685941104438519, 'avg_test_loss': 0.06309917813450738}
INFO:model_data_nn.py:Early stopping at epoch 19
INFO:main_restricted.py:Making prediction for data in year: 1989
INFO:main_restricted.py:Prediction data shape: (16366,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1989: 0.2511559003479678
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  16366.000000  16366.000000
mean       0.032052      0.013335
std        0.251212      0.029288
min       -0.945313     -0.257555
25%       -0.090909     -0.002894
50%        0.016642      0.014746
75%        0.132440      0.032104
max        3.923078      0.294008
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:transform_data_nn.py:Train_data: (128414, 161)

INFO:transform_data_nn.py:Test data years: [1990]
INFO:transform_data_nn.py:Test_data: (16126, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:transform_data_nn.py:Retrain_data: (144540, 161)

INFO:transform_data_nn.py:Prediction data years: [1991]
INFO:transform_data_nn.py:Prediction_data: (16222, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([128414, 138])
            y_train_tf: torch.Size([128414])

            x_test_tf: torch.Size([16126, 138])
            y_test_tf: torch.Size([16126])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([144540, 138])
            y_retrain_tf: torch.Size([144540])

            x_prediction_tf: torch.Size([16222, 138])
            y_prediction_tf: torch.Size([16222])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.9888e-01,  2.4175e-01,  1.5162e-01, -1.3099e+00, -1.4741e-01,
        -6.3165e-01, -1.6069e-01, -3.3851e-01,  3.5518e-01, -1.6748e-01,
        -7.0992e-01, -1.6779e-02, -4.9800e-01, -2.6410e-02,  5.4492e-02,
         5.1524e-01, -1.3399e-01,  1.9059e-01, -2.4120e-02,  4.2271e-01,
        -3.6509e-01,  6.2610e-02,  2.5325e-02,  1.1384e-02, -6.3968e-02,
        -2.5729e-01, -5.7182e-01, -8.8892e-02,  4.0815e-01,  1.0331e+00,
         4.6613e-01, -1.1249e-01,  4.4130e-01,  6.9937e-02, -3.7023e-01,
        -1.9514e-01,  6.5328e-02,  4.2076e-01,  1.4483e-02, -1.1635e+00,
        -2.8302e-01,  2.5730e-01,  2.0227e-01, -6.9445e-02, -1.7670e-01,
        -6.6391e-01,  7.2989e-02, -5.6736e-02, -4.9058e-01, -2.0618e-01,
        -6.2754e-01,  6.7258e-01, -1.5462e-01, -8.1040e-02,  2.3827e-02,
         4.4010e-01, -7.5521e-01,  1.3362e-02, -2.5698e-01, -1.0978e-02,
         1.2090e-01, -3.2007e-01,  1.4735e-01,  2.7103e-01,  1.3328e-01,
        -1.2598e-01,  6.7935e-02, -8.1626e-02,  7.4496e-01, -4.1644e-01,
         0.0000e+00,  0.0000e+00, -1.1640e-01, -8.0519e-01,  5.6881e-02,
         5.7511e-01,  3.9681e-02, -3.4605e-01, -1.8426e-01, -2.1421e-03,
        -1.4698e-02,  2.4485e-01,  5.8111e-02, -2.7826e-01, -5.5057e-01,
        -9.6684e-02, -7.8830e-02, -3.5740e-01, -1.2274e-01,  1.1675e-01,
        -5.1316e-01, -1.2843e+00,  8.6597e-03,  1.3297e+00,  1.8072e+00,
         1.7105e+00,  7.2289e-01,  1.4011e+00, -2.3735e+00, -2.5662e-01,
        -9.9383e-01,  9.8230e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.3717e-02,  3.4823e-01,  0.0000e+00, -1.2770e+00,
         3.9812e-01, -2.1813e+00,  1.3916e-01,  2.8586e-02,  0.0000e+00,
         0.0000e+00,  2.1786e-02, -1.8152e-01,  1.6267e-02, -1.8414e-02,
         8.2592e-02, -4.2343e-01, -3.7704e-01,  2.1237e-01,  2.4886e-01,
        -4.0087e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2277]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([ 1.4584e-02,  6.3886e-02, -7.9550e-01, -1.1657e-01,  7.9758e-01,
        -7.0532e-01, -1.9870e+00, -1.0734e+00, -3.6949e-01, -1.4820e-01,
        -1.3949e-02,  1.1311e-02, -4.0241e-02, -5.3472e-02,  2.8244e-02,
         5.4960e-01, -1.9454e-01,  7.6766e-01,  4.7940e-01,  1.0482e-02,
         7.1274e-01, -2.1217e-01,  4.4143e-02, -4.2309e-01,  5.0684e-01,
        -5.9167e-03, -7.2234e-01, -8.8892e-02, -7.8899e-01,  3.2734e-02,
         1.8189e-01,  4.2959e-03,  3.3217e-01,  6.9937e-02, -2.7940e-04,
        -1.1348e+00,  1.0277e-02, -5.7281e-01,  6.2460e-01, -7.1152e-01,
        -1.3769e-01,  1.3250e-01,  1.1561e-02,  2.2164e-02, -2.5906e-03,
        -4.3427e-01,  9.3256e-01,  2.4867e-01, -4.2093e-01,  1.1561e+00,
         1.6633e+00, -1.0965e+00, -6.3259e-01, -1.2558e+00, -7.4224e-01,
         9.6668e-03, -1.0816e+00,  1.1522e+00,  9.5753e-04,  5.6143e-02,
        -3.8307e-03,  7.1953e-04,  4.4287e-03,  1.3628e-02, -3.1390e-03,
        -2.6362e-03,  3.9700e-02, -2.5201e+00,  9.2752e-02, -9.2406e-03,
         0.0000e+00,  0.0000e+00, -1.1640e-01, -5.4046e-01,  1.2246e-02,
         3.0416e-01,  9.7548e-04, -2.2895e-03,  2.6460e-03, -2.1421e-03,
         1.9614e-01,  5.8838e-01, -1.5876e-01,  2.9465e-02, -4.6237e-01,
        -8.5136e-02, -7.3785e-02,  2.9507e-02,  6.0131e-03,  2.8181e-01,
        -5.4587e-01, -1.2843e+00,  8.6597e-03, -1.1177e+00, -8.7787e-01,
        -1.2271e+00, -5.5954e-01, -2.9398e-01, -8.9560e-01, -1.1520e+00,
        -6.3334e-01,  2.2149e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.5919e-02,  4.1491e-01,  0.0000e+00, -9.6291e-01,
        -9.4916e-01,  2.5299e-01,  1.1801e-01,  2.8586e-02,  0.0000e+00,
         0.0000e+00,  1.0858e-02,  2.3569e-01,  1.6267e-02, -1.9918e-02,
        -4.3167e-02,  1.1825e-03, -2.1146e-02,  3.4402e-01,  3.6973e-01,
        -2.7416e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3877]), tensor(-0.0123))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.8127e-01,  3.5956e-01,  1.4748e-01, -1.3199e+00, -1.3889e-01,
        -6.3833e-01, -1.6951e-01, -3.4585e-01,  3.3324e-01, -1.6478e-01,
        -7.0628e-01, -3.0352e-03, -4.9006e-01, -1.0081e-01,  6.9917e-02,
         5.1296e-01, -1.2890e-01,  1.9683e-01, -5.3400e-02,  4.3029e-01,
        -3.4217e-01,  2.6293e-02,  2.9814e-02,  1.4656e-02, -5.7687e-02,
        -2.6135e-01, -5.6682e-01, -2.7892e-03,  4.1402e-01,  1.0375e+00,
         4.6537e-01, -1.0050e-01,  4.4065e-01, -1.7268e-03, -3.6984e-01,
        -1.9264e-01,  6.9834e-02,  4.4125e-01,  1.0406e-02, -1.1532e+00,
        -2.9090e-01,  3.2361e-01,  2.2406e-01, -8.0628e-02, -1.7584e-01,
        -6.6210e-01,  1.0551e-01, -3.7356e-02, -4.5092e-01, -1.6225e-01,
        -6.4144e-01,  6.7715e-01, -1.4747e-01, -5.9432e-02,  2.6581e-02,
         4.3425e-01, -7.5034e-01,  3.6750e-02, -2.5420e-01, -2.4406e-02,
         1.2572e-01, -3.1598e-01,  1.4020e-01,  2.6296e-01,  1.2433e-01,
        -1.3243e-01,  1.5329e-01, -6.8269e-02,  7.3781e-01, -4.1781e-01,
         0.0000e+00,  0.0000e+00, -7.4018e-02, -8.0028e-01,  6.9763e-02,
         5.7405e-01,  3.3836e-02, -3.4724e-01, -1.8399e-01, -2.5441e-04,
        -3.6230e-03,  2.3486e-01,  4.0894e-02, -3.0437e-01, -5.4985e-01,
        -1.0212e-01, -8.3575e-02, -3.4775e-01, -1.0388e-01,  1.3574e-01,
        -5.0724e-01, -1.2705e+00, -6.6341e-04,  1.4422e+00,  1.9335e+00,
         1.8332e+00,  7.8078e-01,  1.5128e+00, -2.3936e+00, -1.2649e-01,
        -1.0045e+00,  1.0076e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0662e-02,  3.4013e-01,  0.0000e+00, -1.1694e+00,
         5.1689e-01, -2.2414e+00,  1.4424e-01,  2.6814e-02,  0.0000e+00,
         0.0000e+00,  1.6278e-02, -1.8149e-01,  1.8735e-02, -4.0309e-02,
         4.2391e-02, -4.3083e-01, -3.6705e-01,  2.2432e-01,  2.5494e-01,
        -4.0724e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2365]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([ 1.0049e-02,  5.1942e-02,  5.4218e-01,  1.4344e-01, -3.8141e-01,
        -3.1417e-01, -2.0959e+00, -1.0820e+00, -2.3176e-01, -3.2281e-01,
        -1.3056e-02,  9.9614e-03, -2.9154e-02, -4.8064e-02,  2.6795e-02,
        -1.3662e+00, -1.4158e-01,  5.7737e-02,  1.1894e-01,  1.4866e-02,
         6.1920e-02, -1.2541e-01,  5.5872e-01, -2.9872e-01, -3.4182e-01,
        -5.4803e-03, -6.6215e-01, -2.7892e-03, -1.0539e+00,  2.2103e-02,
        -2.0981e-01, -5.3803e-02,  2.9685e-01, -1.7268e-03,  2.0650e-04,
        -5.2036e-01,  6.9215e-03, -5.8960e-01, -1.1895e-01, -9.4741e-01,
         9.0662e-02, -7.8324e-01,  1.2031e-02,  1.2732e-02,  1.2096e-03,
         9.2210e-02, -2.8657e-01, -2.7115e-02,  7.1776e-01, -1.6502e-01,
         9.0143e-01, -1.0782e+00, -5.6287e-01, -9.5281e-01, -7.4076e-01,
         8.7588e-03, -1.0777e+00, -3.4752e-01,  6.9650e-05,  1.3055e-01,
        -4.4525e-03, -1.2021e-03,  5.7498e-03,  9.2681e-03,  2.1116e-04,
        -8.8350e-04,  3.2723e-02, -4.0264e-01,  8.1723e-02, -8.4904e-03,
         0.0000e+00,  0.0000e+00, -7.4018e-02,  4.3080e-02,  1.0297e-02,
        -3.9166e-01,  1.4043e-03, -2.8493e-03,  9.1460e-04, -2.5441e-04,
         1.6154e-01, -5.3648e-01, -1.7969e-01,  6.1375e-01, -4.9153e-01,
        -9.2394e-02, -7.8904e-02,  2.4872e-02,  4.7694e-03,  1.0059e-01,
        -6.5150e-01,  9.6492e-01, -6.6341e-04, -2.9424e-01, -7.9551e-01,
        -7.1778e-01,  5.1068e-02, -6.3808e-01, -1.2960e-01,  2.0901e-02,
        -7.3395e-01,  8.3138e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.8489e-02,  2.6498e-01,  0.0000e+00, -1.0782e+00,
        -1.5875e+00, -1.8571e+00,  1.1898e-01,  2.6814e-02,  0.0000e+00,
         0.0000e+00,  1.1161e-02, -2.3206e-01,  1.8735e-02, -1.7987e-02,
         1.1591e-02,  8.5840e-04, -1.4908e-02,  2.6827e-01,  2.6579e-01,
        -2.8380e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3912]), tensor(0.0145))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:main_restricted.py:Testing data year: 1990
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 6635
            device: cpu
            
2024-08-01 21:17:40,697	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-01 21:17:40,742	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-01 21:17:40,789	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip' (5.13MiB) to Ray cluster...
2024-08-01 21:17:40,804	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip'.
2024-08-01 21:17:42,176	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-01 21:38:01,058	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_21-17-42' in 0.3251s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 175, 'num_layers': 4, 'num_embeddings': 6635, 'embedding_dim': 10, 'dropout_rate': 0.2, 'lr': 2.9872506553136517e-06, 'weight_decay': 2.2520536912838046e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.0535135463287298
INFO:model_data_nn.py:Best trial testing loss: 0.09739352066794203
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-01_21-17-38_515518_1598840/artifacts/2024-08-01_21-17-42/train_fnn_2024-08-01_21-17-42/driver_artifacts/train_fnn_295fd_00073_73_dropout_rate=0.2000,embedding_dim=10,hidden_dim=175,lr=0.0000,num_layers=4,weight_decay=0.0000_2024-08-01_21-17-43
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 175, 'num_layers': 4, 'num_embeddings': 6904, 'embedding_dim': 10, 'dropout_rate': 0.2, 'lr': 2.9872506553136517e-06, 'weight_decay': 2.2520536912838046e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.07004999224652525, 'avg_test_loss': 0.17982499344417682}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.06769925210479749, 'avg_test_loss': 0.18080849268820864}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.06658167482178041, 'avg_test_loss': 0.18132562555475584}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.06570286080063847, 'avg_test_loss': 0.18048428877071282}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.06508120500104811, 'avg_test_loss': 0.1802821405474427}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.06452333770153683, 'avg_test_loss': 0.18069389112352502}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.06397729341363068, 'avg_test_loss': 0.18073567019544057}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.06369802337412064, 'avg_test_loss': 0.18100786904567445}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.06330204668328615, 'avg_test_loss': 0.1804555721022556}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.06295741732732167, 'avg_test_loss': 0.18051215241014723}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.0628393045296617, 'avg_test_loss': 0.18161500568999459}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main_restricted.py:Making prediction for data in year: 1991
INFO:main_restricted.py:Prediction data shape: (16222,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1991: 0.42616592997316827
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  16222.000000  16222.000000
mean       0.115448     -0.000330
std        0.411550      0.037056
min       -0.988636     -0.207766
25%       -0.078436     -0.022585
50%        0.046431      0.002879
75%        0.225745      0.025964
max       10.600000      0.131277
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:transform_data_nn.py:Train_data: (144540, 161)

INFO:transform_data_nn.py:Test data years: [1991]
INFO:transform_data_nn.py:Test_data: (16222, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:transform_data_nn.py:Retrain_data: (160762, 161)

INFO:transform_data_nn.py:Prediction data years: [1992]
INFO:transform_data_nn.py:Prediction_data: (16382, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([144540, 138])
            y_train_tf: torch.Size([144540])

            x_test_tf: torch.Size([16222, 138])
            y_test_tf: torch.Size([16222])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([160762, 138])
            y_retrain_tf: torch.Size([160762])

            x_prediction_tf: torch.Size([16382, 138])
            y_prediction_tf: torch.Size([16382])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.8127e-01,  3.5956e-01,  1.4748e-01, -1.3199e+00, -1.3889e-01,
        -6.3833e-01, -1.6951e-01, -3.4585e-01,  3.3324e-01, -1.6478e-01,
        -7.0628e-01, -3.0352e-03, -4.9006e-01, -1.0081e-01,  6.9917e-02,
         5.1296e-01, -1.2890e-01,  1.9683e-01, -5.3400e-02,  4.3029e-01,
        -3.4217e-01,  2.6293e-02,  2.9814e-02,  1.4656e-02, -5.7687e-02,
        -2.6135e-01, -5.6682e-01, -2.7892e-03,  4.1402e-01,  1.0375e+00,
         4.6537e-01, -1.0050e-01,  4.4065e-01, -1.7268e-03, -3.6984e-01,
        -1.9264e-01,  6.9834e-02,  4.4125e-01,  1.0406e-02, -1.1532e+00,
        -2.9090e-01,  3.2361e-01,  2.2406e-01, -8.0628e-02, -1.7584e-01,
        -6.6210e-01,  1.0551e-01, -3.7356e-02, -4.5092e-01, -1.6225e-01,
        -6.4144e-01,  6.7715e-01, -1.4747e-01, -5.9432e-02,  2.6581e-02,
         4.3425e-01, -7.5034e-01,  3.6750e-02, -2.5420e-01, -2.4406e-02,
         1.2572e-01, -3.1598e-01,  1.4020e-01,  2.6296e-01,  1.2433e-01,
        -1.3243e-01,  1.5329e-01, -6.8269e-02,  7.3781e-01, -4.1781e-01,
         0.0000e+00,  0.0000e+00, -7.4018e-02, -8.0028e-01,  6.9763e-02,
         5.7405e-01,  3.3836e-02, -3.4724e-01, -1.8399e-01, -2.5441e-04,
        -3.6230e-03,  2.3486e-01,  4.0894e-02, -3.0437e-01, -5.4985e-01,
        -1.0212e-01, -8.3575e-02, -3.4775e-01, -1.0388e-01,  1.3574e-01,
        -5.0724e-01, -1.2705e+00, -6.6341e-04,  1.4422e+00,  1.9335e+00,
         1.8332e+00,  7.8078e-01,  1.5128e+00, -2.3936e+00, -1.2649e-01,
        -1.0045e+00,  1.0076e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0662e-02,  3.4013e-01,  0.0000e+00, -1.1694e+00,
         5.1689e-01, -2.2414e+00,  1.4424e-01,  2.6814e-02,  0.0000e+00,
         0.0000e+00,  1.6278e-02, -1.8149e-01,  1.8735e-02, -4.0309e-02,
         4.2391e-02, -4.3083e-01, -3.6705e-01,  2.2432e-01,  2.5494e-01,
        -4.0724e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2365]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([ 1.0049e-02,  5.1942e-02,  5.4218e-01,  1.4344e-01, -3.8141e-01,
        -3.1417e-01, -2.0959e+00, -1.0820e+00, -2.3176e-01, -3.2281e-01,
        -1.3056e-02,  9.9614e-03, -2.9154e-02, -4.8064e-02,  2.6795e-02,
        -1.3662e+00, -1.4158e-01,  5.7737e-02,  1.1894e-01,  1.4866e-02,
         6.1920e-02, -1.2541e-01,  5.5872e-01, -2.9872e-01, -3.4182e-01,
        -5.4803e-03, -6.6215e-01, -2.7892e-03, -1.0539e+00,  2.2103e-02,
        -2.0981e-01, -5.3803e-02,  2.9685e-01, -1.7268e-03,  2.0650e-04,
        -5.2036e-01,  6.9215e-03, -5.8960e-01, -1.1895e-01, -9.4741e-01,
         9.0662e-02, -7.8324e-01,  1.2031e-02,  1.2732e-02,  1.2096e-03,
         9.2210e-02, -2.8657e-01, -2.7115e-02,  7.1776e-01, -1.6502e-01,
         9.0143e-01, -1.0782e+00, -5.6287e-01, -9.5281e-01, -7.4076e-01,
         8.7588e-03, -1.0777e+00, -3.4752e-01,  6.9650e-05,  1.3055e-01,
        -4.4525e-03, -1.2021e-03,  5.7498e-03,  9.2681e-03,  2.1116e-04,
        -8.8350e-04,  3.2723e-02, -4.0264e-01,  8.1723e-02, -8.4904e-03,
         0.0000e+00,  0.0000e+00, -7.4018e-02,  4.3080e-02,  1.0297e-02,
        -3.9166e-01,  1.4043e-03, -2.8493e-03,  9.1460e-04, -2.5441e-04,
         1.6154e-01, -5.3648e-01, -1.7969e-01,  6.1375e-01, -4.9153e-01,
        -9.2394e-02, -7.8904e-02,  2.4872e-02,  4.7694e-03,  1.0059e-01,
        -6.5150e-01,  9.6492e-01, -6.6341e-04, -2.9424e-01, -7.9551e-01,
        -7.1778e-01,  5.1068e-02, -6.3808e-01, -1.2960e-01,  2.0901e-02,
        -7.3395e-01,  8.3138e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.8489e-02,  2.6498e-01,  0.0000e+00, -1.0782e+00,
        -1.5875e+00, -1.8571e+00,  1.1898e-01,  2.6814e-02,  0.0000e+00,
         0.0000e+00,  1.1161e-02, -2.3206e-01,  1.8735e-02, -1.7987e-02,
         1.1591e-02,  8.5840e-04, -1.4908e-02,  2.6827e-01,  2.6579e-01,
        -2.8380e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3912]), tensor(0.0145))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.7734e-01,  4.5340e-01,  1.3377e-01, -1.3261e+00, -1.2311e-01,
        -6.5098e-01, -1.7753e-01, -3.5516e-01,  3.0045e-01, -1.6351e-01,
        -7.0341e-01,  6.8448e-03, -4.7901e-01, -1.6231e-01,  8.0110e-02,
         5.0950e-01, -1.2548e-01,  1.9564e-01, -7.2714e-02,  4.4782e-01,
        -3.5735e-01, -6.6628e-03,  9.3140e-03,  2.0648e-02, -5.6081e-02,
        -2.6397e-01, -5.6231e-01, -2.1161e-02,  4.1490e-01,  1.0341e+00,
         4.3785e-01, -9.1039e-02,  4.4138e-01, -1.3588e-02, -3.7245e-01,
        -1.8960e-01,  7.6126e-02,  4.6096e-01,  1.4997e-02, -1.1373e+00,
        -2.9925e-01,  3.4205e-01,  2.5111e-01, -9.3056e-02, -1.6665e-01,
        -6.6268e-01,  1.1682e-01, -4.0390e-02, -4.3304e-01, -1.7197e-01,
        -6.6367e-01,  6.7888e-01, -1.3982e-01, -4.4105e-02,  3.2892e-02,
         4.3293e-01, -7.4493e-01,  5.0402e-02, -2.5059e-01, -3.0483e-02,
         1.2759e-01, -3.1220e-01,  1.3602e-01,  2.5551e-01,  1.2531e-01,
        -1.3906e-01,  2.2288e-01, -7.8586e-02,  7.3184e-01, -4.1788e-01,
        -1.0879e-01, -4.0737e-02, -6.1110e-02, -7.9729e-01,  8.3312e-02,
         5.8354e-01,  2.7448e-02, -3.4959e-01, -1.8488e-01, -3.8435e-03,
        -1.4837e-02,  2.4283e-01,  1.9573e-02, -3.2015e-01, -5.4688e-01,
        -1.0675e-01, -8.8442e-02, -3.3864e-01, -8.7835e-02,  1.5286e-01,
        -5.0111e-01, -1.2624e+00, -3.4320e-06,  1.5509e+00,  1.9771e+00,
         1.9546e+00,  7.1260e-01,  1.6179e+00, -2.5331e+00, -5.9443e-02,
        -9.7327e-01,  1.1628e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.5478e-02,  3.8159e-01,  0.0000e+00, -1.1082e+00,
         6.1212e-01, -2.1870e+00,  1.4742e-01,  3.0443e-02,  0.0000e+00,
         0.0000e+00,  1.3705e-02, -1.7713e-01,  1.9624e-02, -6.0341e-02,
         4.7219e-02, -4.3803e-01, -3.5763e-01,  2.3778e-01,  2.6301e-01,
        -4.1376e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2480]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([ 4.5884e-03,  4.9765e-02, -6.3958e-01,  3.6238e-01, -2.6211e-01,
        -4.5410e-01, -2.1801e+00, -1.0535e+00, -5.0918e-01, -3.2670e-01,
        -1.2268e-02,  5.0461e-03, -3.9376e-02, -4.0670e-02,  2.3914e-02,
         2.5567e-01, -1.9601e-01,  5.6621e-02,  2.0582e-01,  1.9670e-02,
         5.4303e-01, -8.8635e-02,  2.0365e-02, -2.9322e-01, -1.5510e-01,
        -5.2580e-03, -6.9155e-01, -9.9206e-01, -6.1416e-01,  2.8934e-02,
        -2.4629e-02, -8.9173e-02,  2.2688e-01, -1.3588e-02, -8.6521e-04,
        -5.1289e-01,  1.0675e-02, -6.0930e-01, -1.5761e-01, -1.0796e+00,
         2.5863e-02,  2.4820e-01,  1.7210e-02,  2.4536e-02,  6.8984e-03,
        -2.3126e-01,  9.4793e-01, -9.2326e-02,  3.9157e-01,  1.1064e+00,
         1.6536e+00, -8.2409e-01, -6.2094e-01, -8.1102e-01, -7.3726e-01,
         7.6105e-03, -1.0737e+00,  1.1574e+00, -7.0059e-04, -7.3457e-01,
        -4.5052e-03, -1.5322e-03,  3.9907e-03,  6.2976e-03,  8.2498e-04,
        -2.7221e-03,  2.9387e-02, -5.5122e+00,  7.3184e-01, -7.9588e-03,
        -1.0879e-01, -4.0737e-02, -6.1110e-02, -9.3162e-02,  9.2216e-03,
        -2.9512e-02,  1.1943e-03, -4.6854e-03,  2.6733e-04, -3.8435e-03,
         1.3799e-01, -2.4547e-01, -3.6935e-01,  7.1472e-01, -3.3434e-01,
        -4.0610e-03, -2.5000e-03,  2.9221e-02,  5.3267e-03,  1.0881e-01,
        -4.2178e-01, -3.7129e-01, -3.4320e-06, -1.3317e+00, -2.4169e+00,
        -9.3624e-01,  1.9813e+00, -1.6256e+00,  8.2424e-01, -9.8591e-01,
         3.8318e-01,  1.1111e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  4.1856e-02,  7.7902e-01,  0.0000e+00, -2.4267e-01,
        -1.7175e-01, -1.5689e+00,  1.2207e-01,  3.0443e-02,  0.0000e+00,
         0.0000e+00,  1.2271e-02, -2.0077e-01,  1.9624e-02, -1.5370e-02,
         4.4105e-03, -2.2916e-04, -2.4002e-02,  2.8235e-01,  2.6622e-01,
        -4.0010e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4005]), tensor(-0.1793))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:main_restricted.py:Testing data year: 1991
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 6904
            device: cpu
            
2024-08-01 22:00:11,885	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-01 22:00:11,930	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-01 22:00:11,982	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip' (5.13MiB) to Ray cluster...
2024-08-01 22:00:11,995	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip'.
2024-08-01 22:00:13,320	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-01 22:17:36,502	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_22-00-13' in 0.7013s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 6904, 'embedding_dim': 6, 'dropout_rate': 0.02, 'lr': 0.0011215915868662768, 'weight_decay': 0.00042687125437871845, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.05470961369235857
INFO:model_data_nn.py:Best trial testing loss: 0.16065540605571849
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-01_22-00-09_563408_1598840/artifacts/2024-08-01_22-00-13/train_fnn_2024-08-01_22-00-13/driver_artifacts/train_fnn_19f96_00125_125_dropout_rate=0.0200,embedding_dim=6,hidden_dim=5,lr=0.0011,num_layers=4,weight_decay=0.0004_2024-08-01_22-00-14
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 7233, 'embedding_dim': 6, 'dropout_rate': 0.02, 'lr': 0.0011215915868662768, 'weight_decay': 0.00042687125437871845, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.06957086348706286, 'avg_test_loss': 0.11468523056646518}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.06665582043863573, 'avg_test_loss': 0.11648946746754518}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.06572585088011192, 'avg_test_loss': 0.12020295704496675}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.06544898492833864, 'avg_test_loss': 0.12155913442802557}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.06500727992627948, 'avg_test_loss': 0.13953180971657275}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.06527312776834372, 'avg_test_loss': 0.12126585130499734}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.06519776036587964, 'avg_test_loss': 0.12109912271625944}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.06503123139434873, 'avg_test_loss': 0.12489134672432556}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.0650440168643206, 'avg_test_loss': 0.1411388943051861}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.06500723697790231, 'avg_test_loss': 0.13209878401357855}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.06512751858907642, 'avg_test_loss': 0.13673268720231135}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main_restricted.py:Making prediction for data in year: 1992
INFO:main_restricted.py:Prediction data shape: (16382,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1992: 0.3697739700003543
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  16382.000000  16382.000000
mean       0.062721      0.177386
std        0.346966      0.121982
min       -0.958333     -0.171268
25%       -0.103448      0.079726
50%        0.013034      0.167897
75%        0.162791      0.259511
max        7.000003      0.850231
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:transform_data_nn.py:Train_data: (160762, 161)

INFO:transform_data_nn.py:Test data years: [1992]
INFO:transform_data_nn.py:Test_data: (16382, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Retrain_data: (177144, 161)

INFO:transform_data_nn.py:Prediction data years: [1993]
INFO:transform_data_nn.py:Prediction_data: (17602, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([160762, 138])
            y_train_tf: torch.Size([160762])

            x_test_tf: torch.Size([16382, 138])
            y_test_tf: torch.Size([16382])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([177144, 138])
            y_retrain_tf: torch.Size([177144])

            x_prediction_tf: torch.Size([17602, 138])
            y_prediction_tf: torch.Size([17602])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.7734e-01,  4.5340e-01,  1.3377e-01, -1.3261e+00, -1.2311e-01,
        -6.5098e-01, -1.7753e-01, -3.5516e-01,  3.0045e-01, -1.6351e-01,
        -7.0341e-01,  6.8448e-03, -4.7901e-01, -1.6231e-01,  8.0110e-02,
         5.0950e-01, -1.2548e-01,  1.9564e-01, -7.2714e-02,  4.4782e-01,
        -3.5735e-01, -6.6628e-03,  9.3140e-03,  2.0648e-02, -5.6081e-02,
        -2.6397e-01, -5.6231e-01, -2.1161e-02,  4.1490e-01,  1.0341e+00,
         4.3785e-01, -9.1039e-02,  4.4138e-01, -1.3588e-02, -3.7245e-01,
        -1.8960e-01,  7.6126e-02,  4.6096e-01,  1.4997e-02, -1.1373e+00,
        -2.9925e-01,  3.4205e-01,  2.5111e-01, -9.3056e-02, -1.6665e-01,
        -6.6268e-01,  1.1682e-01, -4.0390e-02, -4.3304e-01, -1.7197e-01,
        -6.6367e-01,  6.7888e-01, -1.3982e-01, -4.4105e-02,  3.2892e-02,
         4.3293e-01, -7.4493e-01,  5.0402e-02, -2.5059e-01, -3.0483e-02,
         1.2759e-01, -3.1220e-01,  1.3602e-01,  2.5551e-01,  1.2531e-01,
        -1.3906e-01,  2.2288e-01, -7.8586e-02,  7.3184e-01, -4.1788e-01,
        -1.0879e-01, -4.0737e-02, -6.1110e-02, -7.9729e-01,  8.3312e-02,
         5.8354e-01,  2.7448e-02, -3.4959e-01, -1.8488e-01, -3.8435e-03,
        -1.4837e-02,  2.4283e-01,  1.9573e-02, -3.2015e-01, -5.4688e-01,
        -1.0675e-01, -8.8442e-02, -3.3864e-01, -8.7835e-02,  1.5286e-01,
        -5.0111e-01, -1.2624e+00, -3.4320e-06,  1.5509e+00,  1.9771e+00,
         1.9546e+00,  7.1260e-01,  1.6179e+00, -2.5331e+00, -5.9443e-02,
        -9.7327e-01,  1.1628e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.5478e-02,  3.8159e-01,  0.0000e+00, -1.1082e+00,
         6.1212e-01, -2.1870e+00,  1.4742e-01,  3.0443e-02,  0.0000e+00,
         0.0000e+00,  1.3705e-02, -1.7713e-01,  1.9624e-02, -6.0341e-02,
         4.7219e-02, -4.3803e-01, -3.5763e-01,  2.3778e-01,  2.6301e-01,
        -4.1376e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2480]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([ 4.5884e-03,  4.9765e-02, -6.3958e-01,  3.6238e-01, -2.6211e-01,
        -4.5410e-01, -2.1801e+00, -1.0535e+00, -5.0918e-01, -3.2670e-01,
        -1.2268e-02,  5.0461e-03, -3.9376e-02, -4.0670e-02,  2.3914e-02,
         2.5567e-01, -1.9601e-01,  5.6621e-02,  2.0582e-01,  1.9670e-02,
         5.4303e-01, -8.8635e-02,  2.0365e-02, -2.9322e-01, -1.5510e-01,
        -5.2580e-03, -6.9155e-01, -9.9206e-01, -6.1416e-01,  2.8934e-02,
        -2.4629e-02, -8.9173e-02,  2.2688e-01, -1.3588e-02, -8.6521e-04,
        -5.1289e-01,  1.0675e-02, -6.0930e-01, -1.5761e-01, -1.0796e+00,
         2.5863e-02,  2.4820e-01,  1.7210e-02,  2.4536e-02,  6.8984e-03,
        -2.3126e-01,  9.4793e-01, -9.2326e-02,  3.9157e-01,  1.1064e+00,
         1.6536e+00, -8.2409e-01, -6.2094e-01, -8.1102e-01, -7.3726e-01,
         7.6105e-03, -1.0737e+00,  1.1574e+00, -7.0059e-04, -7.3457e-01,
        -4.5052e-03, -1.5322e-03,  3.9907e-03,  6.2976e-03,  8.2498e-04,
        -2.7221e-03,  2.9387e-02, -5.5122e+00,  7.3184e-01, -7.9588e-03,
        -1.0879e-01, -4.0737e-02, -6.1110e-02, -9.3162e-02,  9.2216e-03,
        -2.9512e-02,  1.1943e-03, -4.6854e-03,  2.6733e-04, -3.8435e-03,
         1.3799e-01, -2.4547e-01, -3.6935e-01,  7.1472e-01, -3.3434e-01,
        -4.0610e-03, -2.5000e-03,  2.9221e-02,  5.3267e-03,  1.0881e-01,
        -4.2178e-01, -3.7129e-01, -3.4320e-06, -1.3317e+00, -2.4169e+00,
        -9.3624e-01,  1.9813e+00, -1.6256e+00,  8.2424e-01, -9.8591e-01,
         3.8318e-01,  1.1111e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  4.1856e-02,  7.7902e-01,  0.0000e+00, -2.4267e-01,
        -1.7175e-01, -1.5689e+00,  1.2207e-01,  3.0443e-02,  0.0000e+00,
         0.0000e+00,  1.2271e-02, -2.0077e-01,  1.9624e-02, -1.5370e-02,
         4.4105e-03, -2.2916e-04, -2.4002e-02,  2.8235e-01,  2.6622e-01,
        -4.0010e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4005]), tensor(-0.1793))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.7511e-01,  5.3032e-01,  1.2118e-01, -1.3279e+00, -1.1473e-01,
        -6.6547e-01, -1.7965e-01, -3.5902e-01,  3.0039e-01, -1.6157e-01,
        -7.0364e-01,  1.3287e-02, -4.8032e-01, -2.1689e-01,  9.2752e-02,
         5.1136e-01, -1.2770e-01,  2.0288e-01, -8.6807e-02,  4.6755e-01,
        -3.3014e-01, -3.0899e-03,  1.2939e-02,  1.7989e-02, -5.1916e-02,
        -2.6816e-01, -5.6058e-01, -1.8181e-02,  4.0599e-01,  1.0573e+00,
         4.2291e-01, -9.3946e-02,  4.4649e-01, -2.1402e-02, -3.7431e-01,
        -1.8455e-01,  9.1704e-02,  4.7506e-01,  2.3524e-02, -1.1254e+00,
        -3.0536e-01,  2.8104e-01,  2.7996e-01, -9.3432e-02, -1.5500e-01,
        -6.7113e-01,  8.9885e-02, -3.4669e-02, -4.0734e-01, -1.7358e-01,
        -6.8742e-01,  6.7090e-01, -1.3187e-01, -3.4868e-02,  2.6621e-02,
         4.3297e-01, -7.3884e-01,  5.0399e-02, -2.5586e-01, -3.3450e-02,
         1.2930e-01, -3.1684e-01,  1.3231e-01,  2.5136e-01,  1.2800e-01,
        -1.4296e-01,  2.7904e-01, -8.9100e-02,  7.2144e-01, -4.1733e-01,
        -1.5802e-01, -6.1594e-02, -4.7980e-02, -8.0352e-01,  9.5446e-02,
         6.0000e-01,  2.5124e-02, -3.5209e-01, -1.8562e-01,  6.4939e-04,
        -1.6890e-02,  2.5546e-01,  1.9693e-02, -3.2662e-01, -5.4653e-01,
        -1.1026e-01, -9.2396e-02, -3.3079e-01, -7.5383e-02,  1.6134e-01,
        -5.0113e-01, -1.2592e+00,  2.9665e-03,  1.6367e+00,  1.9011e+00,
         2.0545e+00,  4.0982e-01,  1.6419e+00, -2.5976e+00,  5.4995e-02,
        -9.5135e-01,  1.2901e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0600e-02,  5.5131e-01,  0.0000e+00, -1.1747e+00,
         6.5082e-01, -2.0948e+00,  1.5020e-01,  1.9927e-02,  0.0000e+00,
         0.0000e+00,  1.6984e-02, -1.7085e-01,  2.0595e-02, -7.1156e-02,
         5.0707e-02, -4.4174e-01, -3.5503e-01,  2.4983e-01,  2.6954e-01,
        -4.1798e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2601]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([ 6.2201e-03,  4.0160e-02, -4.9216e-01,  5.4931e-01,  2.8609e-01,
        -6.0069e-01, -2.2084e+00, -1.0302e+00, -4.7065e-01, -2.4710e-01,
        -1.4308e-02,  4.9625e-03, -3.6213e-02, -3.3412e-02,  2.1304e-02,
        -1.0237e+00, -1.7729e-01,  6.1705e-01,  1.6484e-01,  1.1458e-02,
         7.6160e-01, -7.4634e-02, -2.4968e-02, -3.4868e-01,  1.4408e-01,
        -8.4063e-03, -6.4430e-01, -7.3839e-01, -1.2763e+00,  3.1663e-02,
        -2.8039e-02, -2.1211e-01,  1.8460e-01, -2.1402e-02,  1.1698e-03,
         1.3698e+00,  1.4487e-02, -6.2328e-01,  4.0902e-01, -1.0097e+00,
        -3.1756e-02, -2.4244e-01,  1.2191e-02,  2.9435e-02,  4.8104e-03,
        -5.0599e-01, -2.1340e-01, -1.4904e-01,  3.2076e-01,  5.2773e-01,
         1.6373e+00, -8.3324e-01, -5.9558e-01, -7.2872e-01, -7.3904e-01,
         5.1056e-03, -1.0694e+00, -4.4086e-02, -7.2391e-03,  2.6464e-01,
        -4.8327e-03, -7.3293e-03,  6.8518e-03,  1.0950e-02,  9.3378e-04,
         3.1050e-03,  2.2322e-02,  1.1238e+00,  5.7967e-02, -1.1165e-02,
        -1.5802e-01, -6.1594e-02, -4.7980e-02, -4.3363e-01,  8.7659e-03,
         2.5548e-02,  6.8801e-04, -4.4530e-03,  6.7547e-04,  6.4939e-04,
         1.2073e-01, -4.7145e-01, -3.6522e-01, -1.7265e-01, -5.0460e-01,
        -4.0603e-03, -3.1113e-03,  2.9184e-02,  4.2500e-03,  1.2579e-01,
        -6.3919e-01,  9.8457e-01,  2.9665e-03, -1.3392e+00, -1.5266e+00,
        -9.6352e-01,  1.8288e+00, -1.6627e+00,  1.2169e+00, -1.1459e+00,
        -9.4967e-01,  2.1429e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.3449e-02,  3.4491e-01,  0.0000e+00,  5.3013e-01,
        -2.8294e-02,  4.7908e-01,  1.0045e-01,  1.9927e-02,  0.0000e+00,
         0.0000e+00,  1.3357e-02,  2.3455e-02,  2.0595e-02, -9.1336e-03,
         8.4218e-03,  1.6526e-03, -2.1462e-02,  1.1496e-01,  1.7460e-01,
        -3.3093e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4294]), tensor(0.0291))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:main_restricted.py:Testing data year: 1992
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 7233
            device: cpu
            
2024-08-01 22:42:15,926	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-01 22:42:15,975	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-01 22:42:16,025	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip' (5.13MiB) to Ray cluster...
2024-08-01 22:42:16,042	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip'.
2024-08-01 22:42:17,408	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-01 23:17:11,040	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_22-42-17' in 0.3132s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 3, 'num_embeddings': 7233, 'embedding_dim': 4, 'dropout_rate': 0.52, 'lr': 0.0004702627143647236, 'weight_decay': 4.12052815772156e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.06184959872294808
INFO:model_data_nn.py:Best trial testing loss: 0.1169871051897644
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-01_22-42-13_565395_1598840/artifacts/2024-08-01_22-42-17/train_fnn_2024-08-01_22-42-17/driver_artifacts/train_fnn_fa72a_00146_146_dropout_rate=0.5200,embedding_dim=4,hidden_dim=25,lr=0.0005,num_layers=3,weight_decay=0.0000_2024-08-01_22-42-18
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 3, 'num_embeddings': 7594, 'embedding_dim': 4, 'dropout_rate': 0.52, 'lr': 0.0004702627143647236, 'weight_decay': 4.12052815772156e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.0793932379927577, 'avg_test_loss': 0.09216522781039756}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.07700070844998527, 'avg_test_loss': 0.09299353979352165}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.07549275120732045, 'avg_test_loss': 0.0948968188424752}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.07443321734252903, 'avg_test_loss': 0.09362206312264916}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.07364077699061924, 'avg_test_loss': 0.09384967723080445}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.07300017715432591, 'avg_test_loss': 0.09344457346648519}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.07229865971875277, 'avg_test_loss': 0.09306890571391896}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.0713785340144638, 'avg_test_loss': 0.09333112648943483}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.07087669505854663, 'avg_test_loss': 0.09312737211855483}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.07025348358091839, 'avg_test_loss': 0.09424398740763673}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.07000131257561513, 'avg_test_loss': 0.09277023250970672}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main_restricted.py:Making prediction for data in year: 1993
INFO:main_restricted.py:Prediction data shape: (17602,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1993: 0.30477851559386787
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  17602.000000  17602.000000
mean       0.049683      0.021562
std        0.303347      0.045706
min       -0.941177     -0.180104
25%       -0.092593     -0.005520
50%        0.012762      0.016956
75%        0.142857      0.043094
max       12.250001      0.464808
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Train_data: (177144, 161)

INFO:transform_data_nn.py:Test data years: [1993]
INFO:transform_data_nn.py:Test_data: (17602, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:transform_data_nn.py:Retrain_data: (194746, 161)

INFO:transform_data_nn.py:Prediction data years: [1994]
INFO:transform_data_nn.py:Prediction_data: (19550, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([177144, 138])
            y_train_tf: torch.Size([177144])

            x_test_tf: torch.Size([17602, 138])
            y_test_tf: torch.Size([17602])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([194746, 138])
            y_retrain_tf: torch.Size([194746])

            x_prediction_tf: torch.Size([19550, 138])
            y_prediction_tf: torch.Size([19550])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.7511e-01,  5.3032e-01,  1.2118e-01, -1.3279e+00, -1.1473e-01,
        -6.6547e-01, -1.7965e-01, -3.5902e-01,  3.0039e-01, -1.6157e-01,
        -7.0364e-01,  1.3287e-02, -4.8032e-01, -2.1689e-01,  9.2752e-02,
         5.1136e-01, -1.2770e-01,  2.0288e-01, -8.6807e-02,  4.6755e-01,
        -3.3014e-01, -3.0899e-03,  1.2939e-02,  1.7989e-02, -5.1916e-02,
        -2.6816e-01, -5.6058e-01, -1.8181e-02,  4.0599e-01,  1.0573e+00,
         4.2291e-01, -9.3946e-02,  4.4649e-01, -2.1402e-02, -3.7431e-01,
        -1.8455e-01,  9.1704e-02,  4.7506e-01,  2.3524e-02, -1.1254e+00,
        -3.0536e-01,  2.8104e-01,  2.7996e-01, -9.3432e-02, -1.5500e-01,
        -6.7113e-01,  8.9885e-02, -3.4669e-02, -4.0734e-01, -1.7358e-01,
        -6.8742e-01,  6.7090e-01, -1.3187e-01, -3.4868e-02,  2.6621e-02,
         4.3297e-01, -7.3884e-01,  5.0399e-02, -2.5586e-01, -3.3450e-02,
         1.2930e-01, -3.1684e-01,  1.3231e-01,  2.5136e-01,  1.2800e-01,
        -1.4296e-01,  2.7904e-01, -8.9100e-02,  7.2144e-01, -4.1733e-01,
        -1.5802e-01, -6.1594e-02, -4.7980e-02, -8.0352e-01,  9.5446e-02,
         6.0000e-01,  2.5124e-02, -3.5209e-01, -1.8562e-01,  6.4939e-04,
        -1.6890e-02,  2.5546e-01,  1.9693e-02, -3.2662e-01, -5.4653e-01,
        -1.1026e-01, -9.2396e-02, -3.3079e-01, -7.5383e-02,  1.6134e-01,
        -5.0113e-01, -1.2592e+00,  2.9665e-03,  1.6367e+00,  1.9011e+00,
         2.0545e+00,  4.0982e-01,  1.6419e+00, -2.5976e+00,  5.4995e-02,
        -9.5135e-01,  1.2901e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0600e-02,  5.5131e-01,  0.0000e+00, -1.1747e+00,
         6.5082e-01, -2.0948e+00,  1.5020e-01,  1.9927e-02,  0.0000e+00,
         0.0000e+00,  1.6984e-02, -1.7085e-01,  2.0595e-02, -7.1156e-02,
         5.0707e-02, -4.4174e-01, -3.5503e-01,  2.4983e-01,  2.6954e-01,
        -4.1798e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2601]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([ 6.2201e-03,  4.0160e-02, -4.9216e-01,  5.4931e-01,  2.8609e-01,
        -6.0069e-01, -2.2084e+00, -1.0302e+00, -4.7065e-01, -2.4710e-01,
        -1.4308e-02,  4.9625e-03, -3.6213e-02, -3.3412e-02,  2.1304e-02,
        -1.0237e+00, -1.7729e-01,  6.1705e-01,  1.6484e-01,  1.1458e-02,
         7.6160e-01, -7.4634e-02, -2.4968e-02, -3.4868e-01,  1.4408e-01,
        -8.4063e-03, -6.4430e-01, -7.3839e-01, -1.2763e+00,  3.1663e-02,
        -2.8039e-02, -2.1211e-01,  1.8460e-01, -2.1402e-02,  1.1698e-03,
         1.3698e+00,  1.4487e-02, -6.2328e-01,  4.0902e-01, -1.0097e+00,
        -3.1756e-02, -2.4244e-01,  1.2191e-02,  2.9435e-02,  4.8104e-03,
        -5.0599e-01, -2.1340e-01, -1.4904e-01,  3.2076e-01,  5.2773e-01,
         1.6373e+00, -8.3324e-01, -5.9558e-01, -7.2872e-01, -7.3904e-01,
         5.1056e-03, -1.0694e+00, -4.4086e-02, -7.2391e-03,  2.6464e-01,
        -4.8327e-03, -7.3293e-03,  6.8518e-03,  1.0950e-02,  9.3378e-04,
         3.1050e-03,  2.2322e-02,  1.1238e+00,  5.7967e-02, -1.1165e-02,
        -1.5802e-01, -6.1594e-02, -4.7980e-02, -4.3363e-01,  8.7659e-03,
         2.5548e-02,  6.8801e-04, -4.4530e-03,  6.7547e-04,  6.4939e-04,
         1.2073e-01, -4.7145e-01, -3.6522e-01, -1.7265e-01, -5.0460e-01,
        -4.0603e-03, -3.1113e-03,  2.9184e-02,  4.2500e-03,  1.2579e-01,
        -6.3919e-01,  9.8457e-01,  2.9665e-03, -1.3392e+00, -1.5266e+00,
        -9.6352e-01,  1.8288e+00, -1.6627e+00,  1.2169e+00, -1.1459e+00,
        -9.4967e-01,  2.1429e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.3449e-02,  3.4491e-01,  0.0000e+00,  5.3013e-01,
        -2.8294e-02,  4.7908e-01,  1.0045e-01,  1.9927e-02,  0.0000e+00,
         0.0000e+00,  1.3357e-02,  2.3455e-02,  2.0595e-02, -9.1336e-03,
         8.4218e-03,  1.6526e-03, -2.1462e-02,  1.1496e-01,  1.7460e-01,
        -3.3093e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4294]), tensor(0.0291))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.1669,  0.5888,  0.1036, -1.3219, -0.1143, -0.6813, -0.1850, -0.3644,
         0.3208, -0.1635, -0.7034,  0.0227, -0.4865, -0.2572,  0.1009,  0.5067,
        -0.1305,  0.2120, -0.0732,  0.4743, -0.3380,  0.0057,  0.0149,  0.0136,
        -0.0537, -0.2743, -0.5612, -0.0210,  0.3845,  1.0975,  0.4100, -0.0973,
         0.4536, -0.0351, -0.3724, -0.1814,  0.0980,  0.4924,  0.0227, -1.1218,
        -0.3089,  0.2602,  0.2824, -0.0835, -0.1526, -0.6815,  0.0777, -0.0463,
        -0.4050, -0.1860, -0.7059,  0.6565, -0.1252, -0.0294,  0.0189,  0.4337,
        -0.7312,  0.0518, -0.2591, -0.0319,  0.1302, -0.3191,  0.1327,  0.2513,
         0.1271, -0.1443,  0.3185, -0.0992,  0.7069, -0.4184, -0.1927, -0.0776,
        -0.0450, -0.8111,  0.1075,  0.6137,  0.0222, -0.3556, -0.1870,  0.0038,
        -0.0102,  0.2538,  0.0352, -0.3280, -0.5492, -0.1148, -0.0973, -0.3225,
        -0.0634,  0.1735, -0.5036, -1.2598,  0.0066,  1.6984,  1.9427,  2.1325,
         0.2193,  1.6729, -2.6897,  0.1787, -0.8928,  0.1270,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0538,  0.5436,  0.0000, -1.2410,  0.6873, -2.1641,
         0.1521,  0.0133,  0.0000,  0.0000,  0.0265, -0.1685,  0.0193, -0.0752,
         0.0659, -0.4429, -0.3589,  0.2582,  0.2740, -0.4163,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([2798]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-1.0950e+00, -1.5362e-01, -7.1802e-01,  7.1595e-01, -7.3885e-02,
        -4.5583e-01, -2.1670e+00, -9.9111e-01, -5.6359e-01, -3.7633e-01,
        -5.5989e-01,  7.3728e-03,  1.0031e-01,  2.8742e-01, -2.1712e-01,
        -3.9971e-02, -2.1449e-01,  2.2596e-01, -7.3246e-02,  1.8080e-01,
        -1.1654e-01, -7.5538e-02, -3.7054e-01,  1.9298e-01,  9.2301e-02,
        -5.2914e-01, -5.9192e-01, -5.7700e-01, -1.0409e+00,  3.7015e-01,
        -4.2835e-01, -3.7255e-02,  2.4777e-01, -3.5072e-02, -7.3016e-01,
         2.6784e-03,  4.2254e-01, -6.3613e-01, -1.4406e-01, -9.4372e-01,
        -1.0650e-01, -1.9294e-01,  6.3178e-01, -2.7989e-01, -1.4918e-01,
        -1.4076e-01,  1.9851e-01,  6.3793e-01,  3.5250e-01, -6.9402e-02,
         7.0255e-02, -7.0042e-01, -5.8644e-01, -6.7527e-01, -7.3775e-01,
         4.5410e-01, -1.0644e+00,  3.5916e-01, -4.3311e-01,  1.6513e-01,
         3.9582e-01, -5.8113e-01, -3.9604e-01, -8.5332e-01, -2.4208e-03,
        -4.9585e-01, -2.8668e-02,  2.7000e+00,  1.3721e+00, -4.1798e-01,
        -1.9274e-01, -7.7553e-02, -4.5049e-02, -8.9308e-02,  4.3926e-02,
         4.8803e-02, -1.8841e-01, -1.3370e-01, -7.9591e-02,  3.7770e-03,
         1.1047e-01,  1.2347e-01, -3.8610e-01,  1.4558e+00,  4.0162e-01,
        -1.0213e-01, -8.9866e-02, -2.9537e-01, -5.4278e-01,  1.9339e-02,
        -6.3314e-02,  1.4176e-01,  6.5806e-03, -1.4075e+00, -1.1267e+00,
        -1.2399e+00,  1.8304e+00, -1.4574e+00,  7.6483e-01, -1.1369e+00,
        -1.0717e+00,  4.8402e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6488e-02, -5.7104e-02,  0.0000e+00,  4.8339e-01,
        -2.0257e-01,  2.5994e-01,  1.3269e-01,  2.1396e+00,  0.0000e+00,
         0.0000e+00, -5.9865e-01, -1.8242e-01, -3.9370e+00,  7.0672e-01,
        -4.0138e-01, -4.5708e-01, -4.2166e-01,  2.4906e-01,  3.2776e-01,
        -3.5330e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5369]), tensor(-0.0517))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:main_restricted.py:Testing data year: 1993
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 7594
            device: cpu
            
2024-08-01 23:43:05,640	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-01 23:43:05,694	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-01 23:43:05,752	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip' (5.13MiB) to Ray cluster...
2024-08-01 23:43:05,768	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip'.
2024-08-01 23:43:07,249	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-02 00:12:01,958	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_23-43-07' in 0.2831s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 7594, 'embedding_dim': 6, 'dropout_rate': 0.54, 'lr': 3.4419719400899214e-05, 'weight_decay': 0.00016266799643038432, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07784010042060359
INFO:model_data_nn.py:Best trial testing loss: 0.09182231135821872
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-01_23-43-03_260133_1598840/artifacts/2024-08-01_23-43-07/train_fnn_2024-08-01_23-43-07/driver_artifacts/train_fnn_79ec3_00077_77_dropout_rate=0.5400,embedding_dim=6,hidden_dim=5,lr=0.0000,num_layers=5,weight_decay=0.0002_2024-08-01_23-43-07
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 8208, 'embedding_dim': 6, 'dropout_rate': 0.54, 'lr': 3.4419719400899214e-05, 'weight_decay': 0.00016266799643038432, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.08143796989726379, 'avg_test_loss': 0.06301129903604692}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.08095123223660418, 'avg_test_loss': 0.06316426295006675}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.08094561316574952, 'avg_test_loss': 0.06306487869672514}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.08093312559274371, 'avg_test_loss': 0.06316749797143201}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.08094004438095707, 'avg_test_loss': 0.06315555684375172}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.08092619539387738, 'avg_test_loss': 0.06301812831397777}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.08093302080234789, 'avg_test_loss': 0.06302977991389468}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.08089599079064468, 'avg_test_loss': 0.06286583956538314}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.0808911355640877, 'avg_test_loss': 0.06288653675622251}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.08085160416213454, 'avg_test_loss': 0.06283966682503783}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.08085223185196948, 'avg_test_loss': 0.06290461114148949}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.08080431094336504, 'avg_test_loss': 0.06278081054215467}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.08072319936784766, 'avg_test_loss': 0.0627824649452529}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.08077874276159529, 'avg_test_loss': 0.0627804954182631}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.08073782756275688, 'avg_test_loss': 0.06274548495026784}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.08065053312874712, 'avg_test_loss': 0.06273979304812592}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.08062332990099488, 'avg_test_loss': 0.0626719545995216}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.08060033312717861, 'avg_test_loss': 0.06257485946847671}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.08056121574884668, 'avg_test_loss': 0.0627752308438055}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.08055669272665911, 'avg_test_loss': 0.06253030801454099}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.08050042999404787, 'avg_test_loss': 0.06271855518337699}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.0804926285423773, 'avg_test_loss': 0.0626984735190222}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.08040174542342358, 'avg_test_loss': 0.06259534794626889}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.08035261002319483, 'avg_test_loss': 0.06245596795807762}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.08029285807196195, 'avg_test_loss': 0.062467754698082585}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.08020709865820658, 'avg_test_loss': 0.06240645635556033}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.08013660824087035, 'avg_test_loss': 0.06251342253875347}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.08017247169597676, 'avg_test_loss': 0.06243683239246937}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.08008271959214644, 'avg_test_loss': 0.06241587902923799}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.08003013380064691, 'avg_test_loss': 0.06245887589773526}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.07995436006610572, 'avg_test_loss': 0.06228743145720951}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.08003679767217343, 'avg_test_loss': 0.06237785349129021}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.07998807922391345, 'avg_test_loss': 0.062439796503377186}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.07981896577747316, 'avg_test_loss': 0.062350373362296194}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.07987637334260646, 'avg_test_loss': 0.06234877018422596}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.07981219577557892, 'avg_test_loss': 0.062405159966730545}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.07978432046688769, 'avg_test_loss': 0.06243046251416767}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.07970749376297315, 'avg_test_loss': 0.06258607936608446}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.07965897535438433, 'avg_test_loss': 0.06235428936870955}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.07967871957555744, 'avg_test_loss': 0.06242014453311964}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.07966448799029739, 'avg_test_loss': 0.06229344194940918}
INFO:model_data_nn.py:Early stopping at epoch 41
INFO:main_restricted.py:Making prediction for data in year: 1994
INFO:main_restricted.py:Prediction data shape: (19550,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1994: 0.24956450822222542
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  19550.000000  19550.000000
mean      -0.009021      0.025895
std        0.246687      0.012747
min       -0.941176      0.025712
25%       -0.125000      0.025712
50%       -0.014632      0.025712
75%        0.082227      0.025712
max        6.294121      1.798481
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:transform_data_nn.py:Train_data: (214296, 161)

INFO:transform_data_nn.py:Test data years: [1995]
INFO:transform_data_nn.py:Test_data: (22259, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:transform_data_nn.py:Retrain_data: (236555, 161)

INFO:transform_data_nn.py:Prediction data years: [1996]
INFO:transform_data_nn.py:Prediction_data: (22619, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([214296, 138])
            y_train_tf: torch.Size([214296])

            x_test_tf: torch.Size([22259, 138])
            y_test_tf: torch.Size([22259])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([236555, 138])
            y_retrain_tf: torch.Size([236555])

            x_prediction_tf: torch.Size([22619, 138])
            y_prediction_tf: torch.Size([22619])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.6138e-01,  6.3450e-01,  9.6981e-02, -1.3080e+00, -1.1959e-01,
        -6.9455e-01, -1.8408e-01, -3.6603e-01,  3.4602e-01, -1.6517e-01,
        -7.0044e-01,  3.5450e-02, -4.9125e-01, -2.8845e-01,  1.0510e-01,
         5.0456e-01, -1.3299e-01,  2.2204e-01, -6.2827e-02,  4.7706e-01,
        -3.3099e-01,  1.1276e-02,  6.6511e-03,  8.8014e-03, -5.7867e-02,
        -2.7626e-01, -5.6481e-01, -1.7767e-02,  3.6237e-01,  1.1400e+00,
         4.0725e-01, -1.0241e-01,  4.6180e-01, -2.9825e-02, -3.6021e-01,
        -1.8733e-01,  9.5078e-02,  5.2221e-01,  1.4196e-02, -1.1223e+00,
        -3.1014e-01,  2.8018e-01,  2.7811e-01, -7.3863e-02, -1.5659e-01,
        -6.8839e-01,  8.3863e-02, -3.2747e-02, -4.1685e-01, -1.7848e-01,
        -7.2196e-01,  6.4307e-01, -1.2036e-01, -2.1798e-02,  1.4097e-02,
         4.3111e-01, -7.2384e-01,  6.8795e-02, -2.5934e-01, -3.0069e-02,
         1.2961e-01, -3.1864e-01,  1.3157e-01,  2.5408e-01,  1.2160e-01,
        -1.4858e-01,  3.4747e-01, -1.0941e-01,  6.8888e-01, -4.1828e-01,
        -2.1984e-01, -3.1756e-02, -4.4639e-02, -8.1988e-01,  1.2150e-01,
         6.2742e-01,  2.0417e-02, -3.5962e-01, -1.8665e-01,  6.7417e-03,
        -1.1077e-03,  2.4425e-01,  5.6884e-02, -3.2948e-01, -5.5073e-01,
        -1.1984e-01, -1.0287e-01, -3.1502e-01, -4.3851e-02,  1.7717e-01,
        -5.0642e-01, -1.2600e+00,  1.0965e-02,  1.7803e+00,  2.0508e+00,
         2.2045e+00,  8.3752e-02,  1.7561e+00, -2.8150e+00,  2.9148e-01,
        -8.5039e-01,  1.2211e-01,  0.0000e+00, -1.0546e+00,  0.0000e+00,
         1.5404e+00,  5.2180e-02,  6.0691e-01,  0.0000e+00, -1.3295e+00,
         7.3676e-01, -2.2904e+00,  1.5304e-01,  1.7361e-02,  0.0000e+00,
        -3.9607e-01,  4.4101e-02, -1.6949e-01,  3.3249e-02, -8.2228e-02,
         8.3000e-02, -4.3063e-01, -3.5525e-01,  2.6693e-01,  2.7907e-01,
        -4.1393e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3128]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-4.8294e-01, -5.4073e-01, -7.6601e-01,  8.6777e-01, -3.0059e-01,
        -2.2299e-01, -1.5585e+00, -9.6941e-01, -4.3036e-01, -3.6043e-01,
        -6.6956e-01,  6.8434e-03, -5.5438e-03,  5.4760e-01, -7.4776e-02,
        -4.6272e-01, -1.7317e-01,  4.1447e-01, -6.2827e-02, -7.4029e-02,
         2.4118e-03, -6.9747e-02, -1.4708e-01, -2.2730e-01, -5.5682e-02,
        -5.5428e-01, -5.8687e-01, -1.7767e-02, -1.3436e+00,  6.6675e-01,
        -3.2284e-02, -1.1997e-01,  2.4504e-01, -2.9825e-02, -7.5459e-01,
        -7.5051e-04,  2.6271e-02, -6.3358e-01,  3.1237e-01, -8.3944e-01,
         2.2254e-01, -1.1148e+00,  9.9344e-02, -2.4154e-01, -3.0358e-01,
        -3.9225e-01, -3.8217e-01, -2.8421e-01,  4.2144e-02, -2.4167e-01,
         1.5758e+00, -7.7319e-01, -4.8150e-01, -6.3692e-01, -7.3569e-01,
         3.6909e-01, -1.0605e+00,  1.0941e-01, -3.3120e-01, -2.1883e-01,
         1.1599e-01, -4.1932e-01, -1.9770e-01,  2.1818e-01, -2.3513e-03,
        -4.2883e-01, -2.6993e-01,  6.9062e-01,  1.3538e+00, -4.6101e-01,
        -2.1984e-01, -3.1756e-02, -4.4639e-02, -8.4792e-02,  3.8531e-02,
        -3.0587e-01, -1.0111e-01, -1.8760e-01, -5.2785e-02,  6.7417e-03,
        -1.1077e-03, -5.0326e-01, -3.4607e-01, -4.9446e-01, -6.5240e-01,
        -1.0350e-01, -9.3501e-02, -3.2932e-01, -6.4154e-01,  1.1695e-01,
        -7.0328e-01,  5.0377e-01,  1.0965e-02, -9.9174e-01, -5.9269e-02,
        -1.1645e+00,  3.5015e-01, -4.5817e-01, -6.3622e-03, -1.2639e+00,
        -6.3468e-01, -2.5567e-01,  0.0000e+00, -1.0546e+00,  0.0000e+00,
         1.5404e+00,  2.0201e-02, -1.3220e-01,  0.0000e+00, -1.8752e-01,
        -4.9769e-01,  8.6243e-01,  1.3005e-01,  7.6998e-01,  0.0000e+00,
        -3.9607e-01, -4.5139e-01, -1.9572e-01, -3.8074e+00,  7.7426e-01,
         2.9990e-01, -5.2928e-01, -4.7617e-01,  2.0270e-01,  2.6195e-01,
        -3.6208e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5926]), tensor(-0.0506))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.5465e-01,  6.6885e-01,  8.5476e-02, -1.2872e+00, -1.2682e-01,
        -7.0710e-01, -1.7775e-01, -3.6445e-01,  3.6850e-01, -1.7035e-01,
        -6.9521e-01,  4.6163e-02, -4.8957e-01, -3.1484e-01,  1.0988e-01,
         5.0111e-01, -1.3360e-01,  2.3042e-01, -5.9369e-02,  4.7335e-01,
        -3.5575e-01,  6.9554e-03, -1.5421e-02,  1.9538e-03, -5.8418e-02,
        -2.7375e-01, -5.7194e-01, -1.5993e-02,  3.4099e-01,  1.1822e+00,
         4.0172e-01, -1.0509e-01,  4.6804e-01, -2.7462e-02, -3.4340e-01,
        -1.9804e-01,  8.5568e-02,  5.5779e-01,  3.2951e-03, -1.1233e+00,
        -3.1047e-01,  3.0597e-01,  2.6816e-01, -7.1363e-02, -1.6457e-01,
        -6.9600e-01,  9.3016e-02, -4.4227e-02, -4.1794e-01, -1.8607e-01,
        -7.3816e-01,  6.3137e-01, -1.1456e-01, -1.6210e-02,  2.6085e-03,
         4.2819e-01, -7.1177e-01,  7.6150e-02, -2.5529e-01, -2.0217e-02,
         1.2886e-01, -3.1347e-01,  1.3228e-01,  2.5872e-01,  1.1666e-01,
        -1.5427e-01,  3.6959e-01, -1.1485e-01,  6.7589e-01, -4.1543e-01,
        -2.3957e-01, -4.1940e-02, -8.1201e-03, -8.2637e-01,  1.3267e-01,
         6.3311e-01,  1.7659e-02, -3.6415e-01, -1.8467e-01,  6.6376e-03,
        -2.0541e-03,  2.3300e-01,  7.8207e-02, -3.3225e-01, -5.5213e-01,
        -1.2473e-01, -1.0838e-01, -3.0840e-01, -2.1037e-02,  1.7360e-01,
        -5.0841e-01, -1.2612e+00,  1.2012e-02,  1.8212e+00,  2.1685e+00,
         2.2888e+00,  7.5983e-02,  1.8721e+00, -2.8702e+00,  4.0568e-01,
        -7.9586e-01,  1.1003e-01,  7.1534e-01,  1.9921e-01, -2.0874e-01,
         2.9136e-01,  4.8129e-02,  4.9181e-01,  0.0000e+00, -1.3169e+00,
         8.2750e-01, -2.4208e+00,  1.5395e-01,  3.5656e-02,  0.0000e+00,
        -1.1729e-01,  7.0280e-02, -1.7483e-01,  1.7692e-02, -9.2213e-02,
         9.6501e-02, -4.1147e-01, -3.4738e-01,  2.7235e-01,  2.8255e-01,
        -4.1445e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3425]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.4706e-01, -5.8692e-01, -5.1251e-01,  1.0123e+00, -8.8275e-02,
        -1.8575e-01, -6.2726e-01, -6.5006e-01, -4.6369e-01, -4.1597e-01,
        -7.1277e-01,  2.3876e-02, -1.2728e-01,  5.5995e-01,  1.4051e-01,
         6.9417e-02, -2.1466e-01,  3.2960e-01, -1.8060e-01,  1.3972e-01,
         2.0362e-01, -6.4095e-02, -2.0622e-02, -2.2984e-01,  8.8198e-02,
        -5.9688e-01, -6.0876e-01, -1.5993e-02, -1.2960e+00,  5.8608e-01,
        -4.4832e-01, -6.6236e-02,  2.4729e-01, -2.7462e-02, -7.3220e-01,
        -5.9738e-02,  2.4769e-01, -6.3787e-01, -6.7517e-02, -8.8688e-01,
        -1.0564e-03,  1.8863e-01,  2.6198e-01, -2.5534e-01, -1.5373e-01,
         2.0762e-01, -9.4873e-03,  5.7696e-01, -1.2216e-01,  2.9324e-02,
         1.5413e+00, -6.9475e-01, -5.9335e-01, -6.0518e-01, -7.3726e-01,
         3.9733e-01, -1.0525e+00,  3.6123e-01, -5.0060e-01, -3.7416e-01,
         1.0904e-01, -5.2580e-01, -2.1244e-01,  6.7539e-02, -3.0935e-03,
        -4.0521e-01, -2.7154e-01, -5.1469e-02,  1.3419e+00, -5.0704e-01,
        -2.3957e-01, -4.1940e-02, -8.1201e-03,  8.1635e-02,  5.7545e-02,
        -8.2888e-02,  8.5503e-02, -2.2786e-01, -5.5072e-02,  6.6376e-03,
         1.2189e-01, -6.5599e-02, -3.4642e-01,  1.1322e+00, -4.0199e-01,
        -1.0438e-01, -9.7048e-02, -3.5142e-01, -5.6331e-01,  2.5259e-01,
        -5.2920e-01, -6.4311e-01,  1.2012e-02, -1.8836e+00, -6.2020e-01,
        -1.2011e+00,  3.0616e-01, -5.9280e-01, -9.7377e-01, -1.0392e+00,
        -4.6702e-01,  9.3573e-02,  7.1534e-01, -3.6527e+00, -2.0874e-01,
         5.5889e+00,  2.1032e-02,  7.4366e-01,  0.0000e+00, -3.4124e-01,
        -8.1074e-01,  4.4621e-01,  1.3354e-01,  1.2521e+00,  0.0000e+00,
        -1.1729e-01, -3.9310e-01, -1.5445e-01, -3.7710e+00,  7.2779e-01,
         5.2095e-02, -4.8817e-01, -5.1235e-01,  2.2483e-01,  2.8419e-01,
        -3.8822e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6064]), tensor(0.0223))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:main_restricted.py:Testing data year: 1995
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 9180
            device: cpu
            
2024-08-02 00:56:50,399	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-02 00:56:50,449	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-02 00:56:50,507	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip' (5.13MiB) to Ray cluster...
2024-08-02 00:56:50,520	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip'.
2024-08-02 00:56:52,186	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-02 01:35:33,245	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_00-56-52' in 0.3095s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 9180, 'embedding_dim': 6, 'dropout_rate': 0.54, 'lr': 3.4419719400899214e-05, 'weight_decay': 0.00016266799643038432, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07789628226265508
INFO:model_data_nn.py:Best trial testing loss: 0.08338477804617228
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-02_00-56-48_053334_1598840/artifacts/2024-08-02_00-56-52/train_fnn_2024-08-02_00-56-52/driver_artifacts/train_fnn_c7642_00077_77_dropout_rate=0.5400,embedding_dim=6,hidden_dim=5,lr=0.0000,num_layers=5,weight_decay=0.0002_2024-08-02_00-56-52
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 10061, 'embedding_dim': 6, 'dropout_rate': 0.54, 'lr': 3.4419719400899214e-05, 'weight_decay': 0.00016266799643038432, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.07999961612997093, 'avg_test_loss': 0.08379503446624548}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.07971930231692903, 'avg_test_loss': 0.08380539375034594}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.07971665774823823, 'avg_test_loss': 0.08377879497475259}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.0797066435396008, 'avg_test_loss': 0.08377872471324836}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.0796741933461825, 'avg_test_loss': 0.08378002393985486}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.0796691484456263, 'avg_test_loss': 0.08381682708516949}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.07964434326516497, 'avg_test_loss': 0.08383453289202324}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.07959264419376709, 'avg_test_loss': 0.08385430367813673}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.07954834456073254, 'avg_test_loss': 0.08382209211118952}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.07886866411510189, 'avg_test_loss': 0.08388400980688979}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.07946073497747358, 'avg_test_loss': 0.0838615103194008}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.07944847303490533, 'avg_test_loss': 0.08387133404296392}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.07936971559208411, 'avg_test_loss': 0.08389508984772201}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.0792928157505041, 'avg_test_loss': 0.08390426194582457}
INFO:model_data_nn.py:Early stopping at epoch 14
INFO:main_restricted.py:Making prediction for data in year: 1996
INFO:main_restricted.py:Prediction data shape: (22619,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1996: 0.28965291681737076
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  22619.000000  22619.000000
mean       0.044741      0.031942
std        0.289333      0.003583
min       -0.961538      0.031552
25%       -0.085714      0.031552
50%        0.018182      0.031552
75%        0.140416      0.031552
max       10.111111      0.181336
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:transform_data_nn.py:Train_data: (283173, 161)

INFO:transform_data_nn.py:Test data years: [1998]
INFO:transform_data_nn.py:Test_data: (24412, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Retrain_data: (307585, 161)

INFO:transform_data_nn.py:Prediction data years: [1999]
INFO:transform_data_nn.py:Prediction_data: (23257, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([283173, 138])
            y_train_tf: torch.Size([283173])

            x_test_tf: torch.Size([24412, 138])
            y_test_tf: torch.Size([24412])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([307585, 138])
            y_retrain_tf: torch.Size([307585])

            x_prediction_tf: torch.Size([23257, 138])
            y_prediction_tf: torch.Size([23257])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.4875e-01,  7.2061e-01,  7.2912e-02, -1.2606e+00, -1.4886e-01,
        -7.3204e-01, -1.6850e-01, -3.6069e-01,  4.2156e-01, -1.6996e-01,
        -6.8732e-01,  6.2069e-02, -4.9929e-01, -3.5319e-01,  1.1656e-01,
         4.9707e-01, -1.4139e-01,  2.4484e-01, -4.3315e-02,  4.8274e-01,
        -3.5553e-01,  1.5676e-02, -4.0194e-02, -3.8391e-03, -5.8610e-02,
        -2.7463e-01, -5.8303e-01, -1.6828e-02,  2.8067e-01,  1.2710e+00,
         3.8739e-01, -1.1953e-01,  4.8341e-01, -4.5972e-02, -3.1644e-01,
        -2.1355e-01,  7.1828e-02,  6.2033e-01, -1.9624e-02, -1.1225e+00,
        -3.0338e-01,  2.7821e-01,  2.4991e-01, -5.3326e-02, -1.7550e-01,
        -7.1020e-01,  7.6894e-02, -5.2911e-02, -4.1289e-01, -1.9440e-01,
        -7.6091e-01,  5.9169e-01, -9.4990e-02, -1.2033e-02, -1.4167e-02,
         4.2622e-01, -6.8477e-01,  8.1612e-02, -2.6019e-01, -1.7514e-02,
         1.2912e-01, -3.1628e-01,  1.3074e-01,  2.5888e-01,  1.0887e-01,
        -1.6674e-01,  4.0211e-01, -1.2470e-01,  6.6961e-01, -4.1523e-01,
        -2.6985e-01, -6.1165e-02, -9.8828e-04, -8.4282e-01,  1.5168e-01,
         6.5720e-01,  1.5584e-02, -3.7219e-01, -1.8143e-01,  5.0605e-03,
        -1.8819e-03,  2.0476e-01,  1.2074e-01, -3.1400e-01, -5.6006e-01,
        -1.3345e-01, -1.1882e-01, -2.9322e-01,  7.9855e-03,  1.7296e-01,
        -5.2195e-01, -1.2660e+00,  1.6970e-02,  1.7147e+00,  2.3702e+00,
         2.4034e+00, -7.6860e-03,  2.0941e+00, -3.0161e+00,  5.8447e-01,
        -8.6387e-01,  1.0094e-01, -3.3009e-01,  6.7510e-02,  2.8525e-01,
         1.5178e-01,  4.9893e-02,  3.3440e-01,  0.0000e+00, -1.4748e+00,
         8.9989e-01, -2.5525e+00,  1.5741e-01,  8.5457e-03,  0.0000e+00,
        -1.8565e-02,  1.2020e-01, -1.8193e-01,  1.3378e-02, -1.0678e-01,
         1.0540e-01, -3.8029e-01, -3.4150e-01,  2.8398e-01,  2.9023e-01,
        -4.1761e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3901]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-4.9754e-01,  4.5230e-01, -7.9629e-01,  1.2705e+00, -3.4419e-02,
        -8.0852e-01, -1.2732e+00, -8.7504e-01, -3.5972e-01, -1.0120e-01,
        -7.5125e-01,  1.0637e-02, -4.6192e+00, -1.6720e-01, -4.3450e-01,
         1.6455e-01, -1.7177e-01, -1.1868e-02, -4.3315e-02,  1.0907e+00,
         1.4642e-01, -6.0401e-02, -4.8681e-02, -1.6256e-01, -6.2277e-02,
        -4.3124e-01, -6.4073e-01, -1.6828e-02, -1.2184e+00,  8.5124e-01,
        -1.3525e-01, -1.9557e-01,  2.3175e-01, -4.5972e-02, -7.8088e-01,
        -3.9932e-01, -2.3895e-01, -6.1120e-01, -2.4745e-01, -9.0022e-01,
        -2.2962e-01,  1.3594e-01,  3.5618e-01, -1.5770e-01, -5.3546e-02,
        -6.5398e-01, -5.5200e-02,  2.5113e-01, -2.6188e-01,  2.1419e-02,
         9.0682e-03, -7.2800e-01, -6.8018e-01, -5.6584e-01, -7.3715e-01,
         2.8444e-01, -1.0327e+00, -1.4410e-01,  1.2377e+00, -4.4250e-01,
        -1.9594e-02,  3.1610e-01, -1.1760e+00,  5.3322e-01,  1.1959e-03,
        -7.9654e-01,  4.2208e-01,  1.3068e+00, -2.0039e+00, -4.5196e-01,
        -2.6985e-01, -6.1165e-02, -9.8828e-04, -7.6262e-01,  5.3793e-02,
         1.4250e-02,  5.2743e+00, -3.4692e-01, -4.9553e-03,  5.0605e-03,
        -1.8819e-03,  9.3164e-02, -2.2469e-01,  1.1796e+00,  3.0917e-01,
        -1.1656e-01, -1.0947e-01, -3.6519e-01, -6.1414e-01,  1.1825e-03,
        -2.3899e-01, -6.9905e-01,  1.6970e-02, -2.2883e+00, -1.4159e+00,
        -1.2488e+00,  2.3878e-01, -5.0993e-01, -9.9969e-01, -1.1059e+00,
         8.7936e-01,  5.0583e-01, -3.3009e-01,  3.3646e+00,  2.8525e-01,
         1.5399e+00,  2.3916e-02,  9.1798e-01,  0.0000e+00,  4.0425e-01,
        -6.9032e-01,  1.3071e+00,  1.2843e-01,  1.3725e+00,  0.0000e+00,
        -1.8565e-02, -5.1438e-02, -1.3765e-01, -3.7524e+00,  7.0168e-01,
        -3.1048e-01, -4.7103e-01, -4.3587e-01,  1.6012e-01,  2.3185e-01,
        -4.0248e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6521]), tensor(-0.0156))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.1509,  0.7440,  0.0739, -1.2498, -0.1583, -0.7484, -0.1661, -0.3605,
         0.4437, -0.1689, -0.6865,  0.0739, -0.5083, -0.3612,  0.1127,  0.4919,
        -0.1471,  0.2453, -0.0326,  0.4865, -0.3329,  0.0062, -0.0411, -0.0063,
        -0.0596, -0.2770, -0.5903, -0.0243,  0.2523,  1.3025,  0.3879, -0.1208,
         0.4900, -0.0370, -0.3052, -0.2211,  0.0571,  0.6507, -0.0367, -1.1276,
        -0.3000,  0.2835,  0.2404, -0.0413, -0.1868, -0.7212,  0.0792, -0.0531,
        -0.4181, -0.1738, -0.7727,  0.5697, -0.0804, -0.0112, -0.0218,  0.4249,
        -0.6743,  0.0835, -0.2571, -0.0244,  0.1277, -0.3128,  0.1321,  0.2572,
         0.1087, -0.1698,  0.4162, -0.1267,  0.6665, -0.4178, -0.2836, -0.0720,
        -0.0133, -0.8554,  0.1637,  0.6658,  0.0178, -0.3752, -0.1796,  0.0047,
        -0.0033,  0.1852,  0.1404, -0.3015, -0.5638, -0.1380, -0.1245, -0.2873,
         0.0166,  0.1728, -0.5317, -1.2685,  0.0185,  1.6282,  2.3471,  2.4638,
        -0.0452,  2.2006, -2.9314,  0.6653, -0.6964,  0.0989, -0.1149,  0.0153,
         0.3349,  0.1291,  0.0518,  0.2270,  0.0000, -1.5009,  0.9768, -2.5665,
         0.1609,  0.0047,  0.0000, -0.0273,  0.1423, -0.1884, -0.0187, -0.1151,
         0.1141, -0.3668, -0.3363,  0.2919,  0.2945, -0.4157,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([4130]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-2.4279e-01, -5.4056e-01, -3.7466e-01,  1.3921e+00, -3.4530e-01,
        -8.1114e-01, -1.6376e+00, -9.1233e-01, -3.5750e-01, -3.1677e-01,
        -7.4018e-01,  2.4990e-02, -1.1498e+00,  6.9382e-01,  2.6771e-01,
         4.5418e-01, -1.8631e-01, -3.0621e-01,  1.3363e-01, -8.3417e-01,
         3.2863e-01, -6.1122e-02, -3.8941e-02, -5.3512e-02, -1.3785e-01,
        -4.2425e-01, -6.3906e-01, -2.4296e-02, -8.5865e-01,  8.6023e-01,
         3.1274e-01, -1.6124e-01,  2.5772e-01, -2.2774e+00, -7.4574e-01,
        -4.0902e-01, -4.6274e-01, -5.9875e-01, -7.1793e-01, -1.0732e+00,
        -2.4376e-01, -5.9177e-01, -5.9555e-01, -1.6706e-01, -3.2865e-01,
        -7.9236e-01, -1.0617e-01,  1.7908e-01, -3.3487e-01,  1.4255e-01,
         7.7668e-01, -7.0627e-01, -7.1038e-01, -5.5264e-01, -7.3689e-01,
         3.2908e-01, -1.0253e+00, -9.0320e-02, -1.1286e-01, -1.8251e-01,
        -5.3808e-03,  3.2517e-01,  7.9990e-01, -7.9642e-01, -1.0776e-03,
         6.7643e-01, -3.7252e-01,  4.9175e-01,  6.6652e-01, -3.8839e-01,
        -2.8357e-01, -7.1964e-02, -1.3280e-02, -7.9567e-01,  7.6774e-02,
         7.0727e-01,  1.6970e+00, -2.8202e-01, -1.4733e-01,  4.6881e-03,
         1.1976e-01,  5.9480e-02, -1.5375e-01,  4.9903e-01, -5.1187e-02,
        -1.2330e-01, -1.1638e-01, -3.5442e-01, -5.4464e-01,  1.8507e-01,
        -3.9372e-01,  1.6076e-01,  1.8480e-02, -2.3308e+00, -2.0402e+00,
        -1.1560e+00,  4.3587e-01, -7.7550e-01, -7.9302e-01, -2.6511e-02,
         1.1223e+00, -5.6112e-01, -1.1486e-01,  1.8025e+00,  3.3495e-01,
         2.7049e+00,  2.8338e-02,  4.0988e-01,  0.0000e+00, -1.3899e+00,
        -4.1890e-01,  1.0006e+00,  1.2894e-01,  2.7026e+00,  0.0000e+00,
        -2.7314e-02,  4.5218e-02, -2.3823e-01, -3.6706e+00,  6.3616e-01,
         9.8503e-01, -2.8688e-01, -3.9455e-01,  2.0078e-01,  2.6829e-01,
        -4.0594e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6283]), tensor(-0.0790))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:main_restricted.py:Testing data year: 1998
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 11533
            device: cpu
            
2024-08-02 02:16:53,062	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-02 02:16:53,114	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-02 02:16:53,167	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip' (5.13MiB) to Ray cluster...
2024-08-02 02:16:53,181	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip'.
2024-08-02 02:16:54,907	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-02 02:42:37,284	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_02-16-54' in 0.3321s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 195, 'num_layers': 1, 'num_embeddings': 11533, 'embedding_dim': 5, 'dropout_rate': 0.26, 'lr': 2.1577279477693504e-05, 'weight_decay': 1.564970230997268e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07048030421762971
INFO:model_data_nn.py:Best trial testing loss: 0.1300074407528124
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-02_02-16-50_760108_1598840/artifacts/2024-08-02_02-16-54/train_fnn_2024-08-02_02-16-54/driver_artifacts/train_fnn_f6092_00134_134_dropout_rate=0.2600,embedding_dim=5,hidden_dim=195,lr=0.0000,num_layers=1,weight_decay=0.0000_2024-08-02_02-16-55
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 195, 'num_layers': 1, 'num_embeddings': 12245, 'embedding_dim': 5, 'dropout_rate': 0.26, 'lr': 2.1577279477693504e-05, 'weight_decay': 1.564970230997268e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.08564084415096143, 'avg_test_loss': 0.2588415529906873}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.08296629603259588, 'avg_test_loss': 0.2622467189478948}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.08227563060130622, 'avg_test_loss': 0.26365473900794817}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.08174597359819728, 'avg_test_loss': 0.2671433072793394}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.08134800190597469, 'avg_test_loss': 0.27134341499326237}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.08101745777117353, 'avg_test_loss': 0.27101324542721494}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.08059041903321672, 'avg_test_loss': 0.27425887839461294}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.08041495514196072, 'avg_test_loss': 0.27602763008710607}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.08016973131013042, 'avg_test_loss': 0.2794834086838008}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.07995924610304296, 'avg_test_loss': 0.28536994409128674}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.07967788667142503, 'avg_test_loss': 0.2862962604048143}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main_restricted.py:Making prediction for data in year: 1999
INFO:main_restricted.py:Prediction data shape: (23257,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1999: 0.5350952327600643
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  23257.000000  23257.000000
mean       0.079897     -0.089181
std        0.505723      0.070717
min       -0.980932     -0.535448
25%       -0.147059     -0.131123
50%        0.000000     -0.088316
75%        0.177420     -0.048242
max       16.624997      0.452367
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Train_data: (307585, 161)

INFO:transform_data_nn.py:Test data years: [1999]
INFO:transform_data_nn.py:Test_data: (23257, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:transform_data_nn.py:Retrain_data: (330842, 161)

INFO:transform_data_nn.py:Prediction data years: [2000]
INFO:transform_data_nn.py:Prediction_data: (22167, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([307585, 138])
            y_train_tf: torch.Size([307585])

            x_test_tf: torch.Size([23257, 138])
            y_test_tf: torch.Size([23257])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([330842, 138])
            y_retrain_tf: torch.Size([330842])

            x_prediction_tf: torch.Size([22167, 138])
            y_prediction_tf: torch.Size([22167])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-0.1509,  0.7440,  0.0739, -1.2498, -0.1583, -0.7484, -0.1661, -0.3605,
         0.4437, -0.1689, -0.6865,  0.0739, -0.5083, -0.3612,  0.1127,  0.4919,
        -0.1471,  0.2453, -0.0326,  0.4865, -0.3329,  0.0062, -0.0411, -0.0063,
        -0.0596, -0.2770, -0.5903, -0.0243,  0.2523,  1.3025,  0.3879, -0.1208,
         0.4900, -0.0370, -0.3052, -0.2211,  0.0571,  0.6507, -0.0367, -1.1276,
        -0.3000,  0.2835,  0.2404, -0.0413, -0.1868, -0.7212,  0.0792, -0.0531,
        -0.4181, -0.1738, -0.7727,  0.5697, -0.0804, -0.0112, -0.0218,  0.4249,
        -0.6743,  0.0835, -0.2571, -0.0244,  0.1277, -0.3128,  0.1321,  0.2572,
         0.1087, -0.1698,  0.4162, -0.1267,  0.6665, -0.4178, -0.2836, -0.0720,
        -0.0133, -0.8554,  0.1637,  0.6658,  0.0178, -0.3752, -0.1796,  0.0047,
        -0.0033,  0.1852,  0.1404, -0.3015, -0.5638, -0.1380, -0.1245, -0.2873,
         0.0166,  0.1728, -0.5317, -1.2685,  0.0185,  1.6282,  2.3471,  2.4638,
        -0.0452,  2.2006, -2.9314,  0.6653, -0.6964,  0.0989, -0.1149,  0.0153,
         0.3349,  0.1291,  0.0518,  0.2270,  0.0000, -1.5009,  0.9768, -2.5665,
         0.1609,  0.0047,  0.0000, -0.0273,  0.1423, -0.1884, -0.0187, -0.1151,
         0.1141, -0.3668, -0.3363,  0.2919,  0.2945, -0.4157,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([4130]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-2.4279e-01, -5.4056e-01, -3.7466e-01,  1.3921e+00, -3.4530e-01,
        -8.1114e-01, -1.6376e+00, -9.1233e-01, -3.5750e-01, -3.1677e-01,
        -7.4018e-01,  2.4990e-02, -1.1498e+00,  6.9382e-01,  2.6771e-01,
         4.5418e-01, -1.8631e-01, -3.0621e-01,  1.3363e-01, -8.3417e-01,
         3.2863e-01, -6.1122e-02, -3.8941e-02, -5.3512e-02, -1.3785e-01,
        -4.2425e-01, -6.3906e-01, -2.4296e-02, -8.5865e-01,  8.6023e-01,
         3.1274e-01, -1.6124e-01,  2.5772e-01, -2.2774e+00, -7.4574e-01,
        -4.0902e-01, -4.6274e-01, -5.9875e-01, -7.1793e-01, -1.0732e+00,
        -2.4376e-01, -5.9177e-01, -5.9555e-01, -1.6706e-01, -3.2865e-01,
        -7.9236e-01, -1.0617e-01,  1.7908e-01, -3.3487e-01,  1.4255e-01,
         7.7668e-01, -7.0627e-01, -7.1038e-01, -5.5264e-01, -7.3689e-01,
         3.2908e-01, -1.0253e+00, -9.0320e-02, -1.1286e-01, -1.8251e-01,
        -5.3808e-03,  3.2517e-01,  7.9990e-01, -7.9642e-01, -1.0776e-03,
         6.7643e-01, -3.7252e-01,  4.9175e-01,  6.6652e-01, -3.8839e-01,
        -2.8357e-01, -7.1964e-02, -1.3280e-02, -7.9567e-01,  7.6774e-02,
         7.0727e-01,  1.6970e+00, -2.8202e-01, -1.4733e-01,  4.6881e-03,
         1.1976e-01,  5.9480e-02, -1.5375e-01,  4.9903e-01, -5.1187e-02,
        -1.2330e-01, -1.1638e-01, -3.5442e-01, -5.4464e-01,  1.8507e-01,
        -3.9372e-01,  1.6076e-01,  1.8480e-02, -2.3308e+00, -2.0402e+00,
        -1.1560e+00,  4.3587e-01, -7.7550e-01, -7.9302e-01, -2.6511e-02,
         1.1223e+00, -5.6112e-01, -1.1486e-01,  1.8025e+00,  3.3495e-01,
         2.7049e+00,  2.8338e-02,  4.0988e-01,  0.0000e+00, -1.3899e+00,
        -4.1890e-01,  1.0006e+00,  1.2894e-01,  2.7026e+00,  0.0000e+00,
        -2.7314e-02,  4.5218e-02, -2.3823e-01, -3.6706e+00,  6.3616e-01,
         9.8503e-01, -2.8688e-01, -3.9455e-01,  2.0078e-01,  2.6829e-01,
        -4.0594e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6283]), tensor(-0.0790))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.1517,  0.7643,  0.0741, -1.2420, -0.1630, -0.7659, -0.1644, -0.3590,
         0.4438, -0.1655, -0.6851,  0.0833, -0.5092, -0.3713,  0.1118,  0.4894,
        -0.1436,  0.2420, -0.0348,  0.4922, -0.3416,  0.0049, -0.0404, -0.0039,
        -0.0545, -0.2778, -0.5963, -0.0290,  0.2277,  1.3229,  0.3730, -0.1190,
         0.4949, -0.0264, -0.2939, -0.2278,  0.0436,  0.6775, -0.0490, -1.1350,
        -0.2977,  0.3173,  0.2359, -0.0378, -0.1943, -0.7313,  0.0980, -0.0503,
        -0.4175, -0.1673, -0.7843,  0.5522, -0.0630, -0.0116, -0.0237,  0.4228,
        -0.6646,  0.0795, -0.2531, -0.0328,  0.1284, -0.3086,  0.1336,  0.2554,
         0.1134, -0.1725,  0.4281, -0.1310,  0.6667, -0.4198, -0.2946, -0.0809,
        -0.0220, -0.8696,  0.1742,  0.6666,  0.0194, -0.3778, -0.1779,  0.0063,
        -0.0066,  0.1756,  0.1491, -0.2889, -0.5626, -0.1416, -0.1292, -0.2838,
         0.0285,  0.1826, -0.5358, -1.2721,  0.0191,  1.5680,  2.2776,  2.5200,
        -0.0780,  2.2929, -2.9799,  0.7094, -0.7643,  0.0997, -0.1145,  0.0057,
         0.3502,  0.1574,  0.0542,  0.2523,  0.0000, -1.4063,  1.0355, -2.5828,
         0.1644,  0.0092,  0.0000, -0.0067,  0.1611, -0.1942, -0.0167, -0.1234,
         0.1210, -0.3549, -0.3292,  0.2991,  0.2976, -0.4133,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([4353]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-1.7463e-02, -6.8208e-01, -5.1292e-01,  1.5087e+00, -2.6048e-01,
        -8.0411e-01, -1.6087e+00, -9.1082e-01, -2.2046e-01, -2.4390e-01,
        -6.8325e-01,  3.3706e-02, -3.0564e-01,  9.8559e-01,  5.3074e-01,
         6.0774e-01, -2.2486e-01,  1.4532e-01,  7.0841e-02, -9.6938e-01,
         1.8550e-01, -6.4694e-02, -4.3657e-02, -5.4047e-02,  4.0327e-02,
        -4.7776e-01, -6.5774e-01, -2.8979e-02, -8.9603e-01,  1.1710e+00,
        -4.1486e-02, -1.5411e-01,  2.9379e-01, -2.2267e+00, -7.8194e-01,
        -2.8490e-01, -1.8904e-01, -5.4945e-01, -1.7000e-01, -1.1194e+00,
        -4.3445e-02, -3.1549e-01, -3.6533e-01, -9.9723e-02, -2.6630e-01,
        -3.6560e-01, -3.6423e-01, -8.0028e-02, -4.8426e-02, -1.1814e-01,
         7.7213e-01, -7.7487e-01, -5.6102e-01, -5.4456e-01, -7.3591e-01,
         2.6051e-01, -1.0184e+00,  1.2153e-01, -4.1426e-01, -4.3467e-01,
        -1.7693e-01, -1.1241e-01,  1.0690e+00,  1.0657e-01,  2.6272e-04,
         1.3289e+00, -4.8393e-01,  2.0586e+00,  6.6670e-01, -3.8214e-01,
        -2.9457e-01, -8.0898e-02, -2.2006e-02, -4.1936e-01,  7.0712e-02,
         7.8962e-01,  5.5825e-02, -1.0734e-01, -1.5332e-01,  6.2512e-03,
         1.2375e-01,  8.8372e-02,  3.8248e-02,  2.4160e-01, -5.7003e-01,
        -1.3262e-01, -1.2374e-01, -3.0045e-01, -5.1220e-01, -3.7390e-01,
        -5.9571e-01, -1.1923e-01,  1.9131e-02, -2.2531e+00, -1.5614e+00,
        -1.1678e+00,  3.0509e-01, -4.1689e-01, -3.4242e-01, -8.5690e-01,
        -3.2235e-01, -9.6125e-01, -1.1448e-01,  8.6509e-01,  3.5022e-01,
         1.9737e+00,  3.2488e-02, -1.0175e+00,  0.0000e+00, -6.5791e-01,
         4.5432e-02,  1.3014e+00,  1.1926e-01,  5.0540e+00,  0.0000e+00,
        -6.7208e-03, -1.5726e-01, -2.2692e-01, -3.6150e+00,  6.4678e-01,
         1.4428e-01, -1.0529e-01, -4.0449e-01,  2.0893e-01,  2.7106e-01,
        -4.2404e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5972]), tensor(-0.0447))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:main_restricted.py:Testing data year: 1999
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 12245
            device: cpu
            
2024-08-02 03:24:32,228	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-02 03:24:32,279	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-02 03:24:32,331	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip' (5.13MiB) to Ray cluster...
2024-08-02 03:24:32,343	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip'.
2024-08-02 03:24:34,136	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-02 04:30:59,270	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_03-24-34' in 0.3481s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 3, 'num_embeddings': 12245, 'embedding_dim': 8, 'dropout_rate': 0.48, 'lr': 0.0028350066892508428, 'weight_decay': 0.000437602612330489, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.08605337136249122
INFO:model_data_nn.py:Best trial testing loss: 0.25679706192307655
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-02_03-24-29_777916_1598840/artifacts/2024-08-02_03-24-34/train_fnn_2024-08-02_03-24-34/driver_artifacts/train_fnn_69865_00070_70_dropout_rate=0.4800,embedding_dim=8,hidden_dim=45,lr=0.0028,num_layers=3,weight_decay=0.0004_2024-08-02_03-24-34
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 3, 'num_embeddings': 12852, 'embedding_dim': 8, 'dropout_rate': 0.48, 'lr': 0.0028350066892508428, 'weight_decay': 0.000437602612330489, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.09743524893668233, 'avg_test_loss': 0.20527208083098242}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.09751620981716157, 'avg_test_loss': 0.2067171549894894}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.0976185683540468, 'avg_test_loss': 0.2078262290838047}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.09767258893550711, 'avg_test_loss': 0.20623032458148047}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.09757029833931538, 'avg_test_loss': 0.2071575369271967}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.09760981887844902, 'avg_test_loss': 0.2076434934052167}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.09771597345858167, 'avg_test_loss': 0.20801545322898232}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.09797199110065033, 'avg_test_loss': 0.20701518241439718}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.09801384670772328, 'avg_test_loss': 0.20845346401403908}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.09807649692533112, 'avg_test_loss': 0.20698635592185832}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.09808615518329908, 'avg_test_loss': 0.20820006784078535}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main_restricted.py:Making prediction for data in year: 2000
INFO:main_restricted.py:Prediction data shape: (22167,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2000: 0.45634963345431245
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  22167.000000  22167.000000
mean      -0.000670      0.051079
std        0.453416      0.000000
min       -0.980000      0.051079
25%       -0.222436      0.051079
50%       -0.022528      0.051079
75%        0.141851      0.051079
max       10.941179      0.051079
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:transform_data_nn.py:Train_data: (395123, 161)

INFO:transform_data_nn.py:Test data years: [2003]
INFO:transform_data_nn.py:Test_data: (19044, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:transform_data_nn.py:Retrain_data: (414167, 161)

INFO:transform_data_nn.py:Prediction data years: [2004]
INFO:transform_data_nn.py:Prediction_data: (17992, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([395123, 138])
            y_train_tf: torch.Size([395123])

            x_test_tf: torch.Size([19044, 138])
            y_test_tf: torch.Size([19044])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([414167, 138])
            y_retrain_tf: torch.Size([414167])

            x_prediction_tf: torch.Size([17992, 138])
            y_prediction_tf: torch.Size([17992])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-0.1721,  0.8169,  0.0877, -1.2257, -0.1545, -0.8123, -0.1512, -0.3522,
         0.3872, -0.1460, -0.6854,  0.1167, -0.5019, -0.3625,  0.0933,  0.4887,
        -0.1408,  0.2354, -0.0296,  0.5302, -0.3156, -0.0091, -0.0217,  0.0065,
        -0.0416, -0.2792, -0.5852, -0.0476,  0.1669,  1.2601,  0.3529, -0.1106,
         0.4891, -0.0130, -0.2599, -0.2270,  0.0428,  0.7302, -0.0530, -1.1471,
        -0.2949,  0.3037,  0.2660, -0.0537, -0.1905, -0.7562,  0.1054, -0.0320,
        -0.3746, -0.1430, -0.8155,  0.5058, -0.0278, -0.0101, -0.0254,  0.4245,
        -0.6363,  0.0705, -0.2477, -0.0593,  0.1311, -0.3040,  0.1315,  0.2389,
         0.1082, -0.1871,  0.4608, -0.1317,  0.6682, -0.4242, -0.3163, -0.0290,
        -0.0281, -0.9017,  0.2114,  0.6740,  0.0206, -0.3871, -0.1750,  0.0070,
         0.0030,  0.1589,  0.1422, -0.2264, -0.5652, -0.1529, -0.1430, -0.2799,
         0.0578,  0.1904, -0.5441, -1.2752,  0.0177,  1.6195,  2.2608,  2.6944,
        -0.0770,  2.4012, -2.8918,  0.7793, -0.8087,  0.1255, -0.0708,  0.0343,
         0.2038,  0.1479,  0.0641,  0.3696,  0.0000, -1.1930,  0.5757, -2.7203,
         0.1787, -0.0059,  0.1861, -0.0220,  0.2206, -0.1949, -0.0243, -0.1542,
         0.1332, -0.3190, -0.3039,  0.3248,  0.3097, -0.4046,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([4852]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-2.5336e-02, -5.8967e-01,  2.6355e-01,  1.8283e+00, -7.8493e-01,
        -5.6450e-01, -1.5599e+00, -8.6559e-01, -6.3206e-03, -4.0300e-01,
        -7.3615e-01,  4.7545e-02, -3.8138e+00,  1.1509e+00,  4.0747e-01,
        -1.9625e+00, -1.8073e-01, -3.7805e-01, -2.9584e-02, -1.6946e+00,
        -1.4442e-01, -5.4114e-02, -2.8901e-02, -5.3617e-01,  5.9445e-02,
        -5.3774e-01, -6.4346e-01, -4.7607e-02, -9.3981e-01,  1.6137e+00,
        -5.0386e-01, -2.2148e-01,  2.2793e-01, -1.3010e-02, -7.7083e-01,
        -2.8453e-01, -1.1733e-01, -5.9279e-01, -4.4790e-01, -1.0745e+00,
        -2.3711e-01, -9.7715e-01, -4.8021e-01, -1.9589e-02, -6.5586e-01,
        -7.2864e-01, -6.4279e-01, -7.3818e-01,  1.8440e-01, -4.9875e-01,
         7.6192e-01, -8.4593e-01, -5.3885e-01, -5.3208e-01, -7.3365e-01,
         2.0043e-01, -9.9670e-01,  2.1175e-01, -3.4891e-01, -3.2963e-01,
         1.3873e-02, -3.8471e-01,  4.2228e-01,  2.2273e-01,  1.1131e-03,
         3.3247e-01, -1.3915e+00,  9.3603e-01, -3.8710e-03, -4.8603e-01,
        -3.1634e-01, -2.9030e-02, -2.8083e-02, -6.2110e-01,  1.0375e-01,
        -1.2465e+00,  2.4416e+00, -1.9944e-01,  1.7855e-01,  6.9553e-03,
         3.0438e-03, -8.5565e-01,  6.1390e-01,  7.9496e-02, -4.7733e-01,
        -1.4182e-01, -1.3799e-01, -3.4533e-01, -3.7077e-01,  1.5252e+00,
        -4.8922e-01,  1.1568e+00,  1.7699e-02, -6.5983e-01, -1.2441e+00,
        -3.9940e-01,  7.6469e-01, -1.8165e+00,  1.1497e+00,  5.8451e-01,
         3.2179e-01, -1.7415e+00, -7.0821e-02,  1.8081e+00,  2.0381e-01,
         2.4351e+00,  1.5858e-02,  3.6960e-01,  0.0000e+00, -1.4863e+00,
        -7.2142e-01, -4.2507e-01,  1.2173e-01,  9.6193e+00,  1.8612e-01,
        -2.1954e-02, -1.0043e-01, -2.6332e-01, -3.3450e+00,  7.2723e-01,
         3.0019e-01,  5.6778e-01, -3.6925e-01,  1.5503e-01,  1.5877e-01,
        -3.6994e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4932]), tensor(0.0590))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.7691e-01,  8.3472e-01,  8.5007e-02, -1.2235e+00, -1.4235e-01,
        -8.1628e-01, -1.4754e-01, -3.5021e-01,  3.8305e-01, -1.4563e-01,
        -6.8896e-01,  1.2245e-01, -5.0418e-01, -3.6553e-01,  9.3019e-02,
         4.8990e-01, -1.3791e-01,  2.3091e-01, -3.0420e-02,  5.4392e-01,
        -3.3311e-01, -5.8796e-03, -7.6251e-03,  5.1652e-03, -3.5088e-02,
        -2.7885e-01, -5.8781e-01, -5.2735e-02,  1.5159e-01,  1.2634e+00,
         3.4677e-01, -1.0361e-01,  4.9157e-01, -1.4596e-03, -2.5149e-01,
        -2.1879e-01,  6.4771e-02,  7.4599e-01, -4.2716e-02, -1.1523e+00,
        -2.9324e-01,  3.0206e-01,  2.8339e-01, -5.5354e-02, -1.8354e-01,
        -7.5452e-01,  1.0882e-01, -3.2442e-02, -3.6424e-01, -1.5474e-01,
        -8.2628e-01,  4.9218e-01, -2.3628e-02, -1.0290e-02, -2.6877e-02,
         4.2518e-01, -6.2827e-01,  6.3533e-02, -2.4676e-01, -5.2799e-02,
         1.2926e-01, -3.0352e-01,  1.3475e-01,  2.3676e-01,  1.0897e-01,
        -1.8733e-01,  4.7246e-01, -1.3229e-01,  6.5685e-01, -4.2552e-01,
        -3.2324e-01, -3.1691e-02, -2.9137e-02, -9.0115e-01,  2.1909e-01,
         6.8209e-01,  2.4920e-02, -3.8959e-01, -1.7514e-01,  9.7928e-03,
        -4.8798e-03,  1.6975e-01,  1.4553e-01, -2.0250e-01, -5.6435e-01,
        -1.5537e-01, -1.4633e-01, -2.8138e-01,  6.3534e-02,  1.8839e-01,
        -5.4800e-01, -1.2762e+00,  1.6181e-02,  1.6713e+00,  2.3090e+00,
         2.7658e+00, -8.5525e-02,  2.3631e+00, -2.9202e+00,  7.7779e-01,
        -8.3307e-01,  1.3847e-01,  2.7372e-01,  5.5249e-02,  4.1898e-01,
         1.3040e-01,  5.1610e-02,  2.9600e-01,  0.0000e+00, -1.0849e+00,
         6.1663e-01, -2.7300e+00,  1.8042e-01, -2.3450e-03,  1.6970e-01,
        -2.1652e-02,  2.4078e-01, -1.9235e-01, -4.7087e-02, -1.5893e-01,
         1.3417e-01, -3.0851e-01, -2.9324e-01,  3.3125e-01,  3.1256e-01,
        -4.0709e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4909]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.3032e-01, -3.2863e-01, -5.4621e-01,  1.9187e+00, -1.3604e-02,
        -4.1048e-01, -1.4297e+00, -8.5045e-01,  2.0488e-01,  2.9088e-01,
        -3.9718e-01,  5.2314e-02, -8.5454e-02,  8.8066e-01,  3.4494e-01,
        -2.8047e-01, -2.1841e-01,  2.1148e-01, -3.0420e-02, -1.2082e-01,
         2.7830e-01, -5.4898e-02, -2.0056e-03,  3.0199e-01, -1.1484e-02,
        -5.4956e-01, -6.3334e-01, -5.2735e-02, -9.7430e-01,  1.5681e+00,
         5.7532e-02, -2.3687e-01,  1.8167e-01, -1.4596e-03, -8.5417e-01,
        -2.5726e-01, -1.6822e-01, -5.9864e-01, -2.9938e-01, -6.4472e-01,
        -2.4293e-01,  6.3351e-01,  7.7548e-02,  2.3678e-01, -3.4791e-02,
        -6.7028e-01, -5.2449e-01, -5.4741e-02, -5.2849e-01, -1.7863e-01,
         7.5579e-01, -9.5859e-01, -7.0035e-01, -5.3131e-01, -2.6877e-02,
         1.0805e-01, -9.9068e-01,  1.2342e-02, -2.4363e-01,  2.7336e-02,
         1.1204e-01, -8.0581e-02, -4.9904e-02, -4.7279e-02, -8.4790e-04,
        -3.4607e-01, -2.5287e+00,  5.8546e-01,  1.3277e+00, -4.7879e-01,
        -3.2324e-01, -3.1691e-02, -2.9137e-02, -6.9785e-01,  7.2630e-02,
         5.1817e-01, -1.7032e-01, -2.5562e-01,  5.3902e-02,  9.7928e-03,
        -4.8798e-03, -5.1251e-01,  6.5282e-01, -1.5843e-01, -9.1988e-02,
        -1.3942e-01, -1.3948e-01,  2.7220e-01, -3.3671e-01, -3.1625e+00,
        -2.2754e-01, -2.3453e-01,  1.6181e-02, -9.7372e-01, -4.0657e-01,
        -6.9811e-01, -2.8577e-01, -1.7511e+00,  1.4865e+00, -6.6536e-02,
        -6.1298e-01, -1.3437e-01, -3.7728e+00,  1.1455e-01,  2.1749e+00,
         1.6659e+00,  5.7954e-02,  2.9600e-01,  1.0163e+00, -1.8067e+00,
        -1.0412e+00,  1.2836e-01,  1.1798e-01,  7.2003e+00,  1.6970e-01,
        -2.1652e-02, -2.6242e-01, -1.3663e-01, -3.3328e+00,  7.9554e-01,
        -4.1379e-01,  3.2971e-02, -4.7902e-01,  1.1867e-01,  1.0595e-01,
        -3.5654e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4256]), tensor(0.2185))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:main_restricted.py:Testing data year: 2003
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 14292
            device: cpu
            
2024-08-02 05:26:07,639	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-02 05:26:07,692	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-02 05:26:07,747	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip' (5.13MiB) to Ray cluster...
2024-08-02 05:26:07,761	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip'.
2024-08-02 05:26:09,509	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-02 06:03:47,686	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_05-26-09' in 0.3618s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 195, 'num_layers': 1, 'num_embeddings': 14292, 'embedding_dim': 5, 'dropout_rate': 0.26, 'lr': 2.1577279477693504e-05, 'weight_decay': 1.564970230997268e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.09849716952744779
INFO:model_data_nn.py:Best trial testing loss: 0.1451595446919935
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-02_05-26-05_135284_1598840/artifacts/2024-08-02_05-26-09/train_fnn_2024-08-02_05-26-09/driver_artifacts/train_fnn_65e7e_00134_134_dropout_rate=0.2600,embedding_dim=5,hidden_dim=195,lr=0.0000,num_layers=1,weight_decay=0.0000_2024-08-02_05-26-10
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 195, 'num_layers': 1, 'num_embeddings': 14438, 'embedding_dim': 5, 'dropout_rate': 0.26, 'lr': 2.1577279477693504e-05, 'weight_decay': 1.564970230997268e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.1126588519375925, 'avg_test_loss': 0.08077036386742843}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10943753925084336, 'avg_test_loss': 0.07984283596085348}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10854563225962233, 'avg_test_loss': 0.0810501298852278}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10797392459549707, 'avg_test_loss': 0.08124922042907766}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10737475911951234, 'avg_test_loss': 0.08253605149150371}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10695252650335496, 'avg_test_loss': 0.08348679347675075}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10651836741038946, 'avg_test_loss': 0.0841986964395531}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10605384550018349, 'avg_test_loss': 0.08561131225974956}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10574659841499844, 'avg_test_loss': 0.08838095607940723}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.10538512317111433, 'avg_test_loss': 0.08774518236835516}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10514268541885326, 'avg_test_loss': 0.08843767108498257}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10482446606836729, 'avg_test_loss': 0.088044495806495}
INFO:model_data_nn.py:Early stopping at epoch 12
INFO:main_restricted.py:Making prediction for data in year: 2004
INFO:main_restricted.py:Prediction data shape: (17992,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2004: 0.29678298639560724
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  17992.000000  17992.000000
mean       0.052419      0.116409
std        0.280720      0.079873
min       -0.938679     -0.435655
25%       -0.068413      0.066594
50%        0.026063      0.113947
75%        0.139854      0.163817
max       11.611828      0.511658
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:transform_data_nn.py:Train_data: (483505, 161)

INFO:transform_data_nn.py:Test data years: [2008]
INFO:transform_data_nn.py:Test_data: (16465, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:transform_data_nn.py:Retrain_data: (499970, 161)

INFO:transform_data_nn.py:Prediction data years: [2009]
INFO:transform_data_nn.py:Prediction_data: (16061, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([483505, 138])
            y_train_tf: torch.Size([483505])

            x_test_tf: torch.Size([16465, 138])
            y_test_tf: torch.Size([16465])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([499970, 138])
            y_retrain_tf: torch.Size([499970])

            x_prediction_tf: torch.Size([16061, 138])
            y_prediction_tf: torch.Size([16061])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.4447e-01,  8.7784e-01,  7.0549e-02, -1.5962e+00, -1.3840e-01,
        -8.0299e-01, -1.4802e-01, -3.5038e-01,  4.4537e-01, -1.9072e-01,
        -7.0250e-01,  7.7724e-02, -7.1651e-01, -5.1140e-01,  7.8370e-02,
         5.0638e-01, -1.3471e-01,  1.9865e-01, -7.4812e-02,  5.7213e-01,
        -4.1515e-01, -5.0482e-02, -1.7344e-01,  1.0633e-03, -9.7778e-02,
        -3.4116e-01, -5.9356e-01, -6.2545e-02,  4.1664e-01,  1.4043e+00,
         3.5357e-01, -1.4228e-01,  7.8786e-01,  2.9236e-01, -2.3153e-01,
        -2.4999e-01,  1.0389e-01,  7.8851e-01, -3.1875e-02, -1.1260e+00,
        -2.7656e-01,  2.5082e-01,  3.2160e-01,  5.3495e-02, -1.7702e-01,
        -7.2774e-01,  8.6251e-02, -4.3586e-02, -3.8267e-01, -1.6381e-01,
        -8.3520e-01,  3.9844e-01, -4.7255e-01,  9.1401e-02, -2.6911e-02,
         5.0135e-01, -5.9667e-01, -1.9442e-01, -2.5200e-01, -3.7946e-02,
        -1.7973e-03, -3.0818e-01,  5.1986e-02,  2.1737e-01,  8.3061e-02,
        -1.9872e-01,  7.0662e-01, -2.6441e-01,  6.3368e-01, -5.7020e-01,
        -3.3779e-01, -1.7063e-01, -2.6298e-02, -8.6899e-01,  1.7090e-01,
         7.3874e-01,  8.5342e-01, -1.1580e+00,  2.8058e-01,  1.3099e-02,
        -8.4987e-01,  1.6969e-01,  3.5410e-01, -9.9312e-02, -5.6964e-01,
        -4.4404e-01, -5.4320e-01, -2.7422e-01,  8.0564e-02,  1.0877e-01,
        -5.8058e-01, -1.3402e+00,  2.3778e-01, -7.7716e-16, -7.7716e-16,
         3.0116e+00, -4.9175e-06,  2.4971e+00, -2.8295e+00,  8.8496e-01,
        -7.9040e-01,  1.6298e-01,  4.4413e-02,  5.7049e-02,  2.2784e-01,
         1.0374e-01, -1.3021e-01,  2.8527e-01, -1.3746e-01, -1.0443e+00,
         7.5886e-01,  7.1054e-15,  3.3668e-01, -1.1245e-02,  5.5238e-02,
         1.6508e-02,  3.0458e-01, -2.3623e-01,  1.8253e-02, -5.7129e-01,
         1.3756e-01, -2.7085e-01, -3.9073e-01,  3.5460e-01,  3.6764e-01,
        -4.1046e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5230]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-2.8202e-01,  7.6730e-01, -6.4354e-01,  1.2929e+00, -7.5015e-01,
        -2.9721e-01, -3.8841e-01, -5.0400e-01, -2.8395e-01, -5.5864e-02,
        -6.0834e-01, -6.4708e-03, -1.5971e-02, -2.5511e-01, -5.5967e-01,
        -8.3973e-01, -1.6966e-01, -5.0427e-01, -7.4812e-02, -8.6902e-01,
        -8.7255e-01, -1.2840e-01,  1.7909e-01, -1.9877e-01, -4.0563e-01,
        -2.7000e-01, -6.6181e-01, -6.2545e-02, -6.1957e-01,  6.7965e-01,
         1.9095e-01, -4.0029e-02,  3.6092e-01,  2.9236e-01, -5.7341e-01,
        -4.6189e-01, -1.5415e+00, -6.2257e-01, -9.8021e-01, -2.3680e-01,
        -1.8251e-01, -1.4659e-01, -1.8004e+00, -4.2294e-01, -7.6837e-01,
        -4.5417e-01,  3.5019e-01, -7.0584e-02,  3.6539e-01, -2.4956e-01,
        -4.3711e-02, -5.6617e-01, -4.7255e-01, -6.7074e-01, -2.6911e-02,
         1.7198e-01, -9.6937e-01, -3.5464e-01,  9.7623e-01,  3.9905e-01,
         4.3880e-01,  9.9803e-01, -1.3649e-01,  1.9927e-01, -2.6573e-02,
        -3.0099e-01,  6.4649e-01, -1.0991e+00, -3.8886e-02, -5.2024e-01,
        -3.3779e-01, -1.7063e-01, -2.6298e-02, -2.8941e-01,  2.1040e-01,
        -2.6077e-01,  8.5342e-01, -6.6354e-01,  1.4931e+00,  1.3099e-02,
        -8.4987e-01, -8.5983e-01, -2.7300e-01,  7.9895e-01, -5.0996e-01,
        -3.1457e-01, -4.4987e-01, -2.7171e-01, -3.3127e-01,  2.4969e-01,
        -6.0498e-01, -9.9415e-01,  2.3778e-01, -7.7716e-16, -7.7716e-16,
        -5.4053e-01, -2.9537e+00, -8.5046e-01, -4.0666e-01,  4.6162e-01,
         2.3150e-01, -5.8334e-01, -9.7529e-01,  3.0603e+00,  1.9120e+00,
         2.1252e-01, -1.5037e-01,  2.8527e-01,  7.3946e-01, -1.9158e-01,
        -4.4185e-01,  7.1054e-15,  2.4794e-01,  4.6009e+00,  5.5238e-02,
         1.6508e-02, -1.4692e-01, -4.9452e-01,  1.8253e-02, -2.5265e-01,
        -1.3463e+00, -4.5101e-02, -1.2896e-01,  3.6594e-01,  2.8635e-01,
        -2.9174e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3963]), tensor(-0.0378))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.3834e-01,  8.8641e-01,  7.0010e-02, -1.6107e+00, -1.3694e-01,
        -8.1424e-01, -1.4822e-01, -3.5060e-01,  4.4198e-01, -1.8868e-01,
        -7.0388e-01,  7.9521e-02, -7.1558e-01, -5.1497e-01,  7.7327e-02,
         5.1104e-01, -1.3124e-01,  2.0309e-01, -7.7387e-02,  5.8002e-01,
        -4.1119e-01, -5.1090e-02, -1.7515e-01,  3.4879e-03, -9.8594e-02,
        -3.4145e-01, -5.9437e-01, -6.8377e-02,  3.9758e-01,  1.3974e+00,
         3.5190e-01, -1.4045e-01,  7.8751e-01,  2.9673e-01, -2.2549e-01,
        -2.4982e-01,  1.0686e-01,  7.9445e-01, -3.0162e-02, -1.1197e+00,
        -2.7480e-01,  2.8297e-01,  3.2759e-01,  4.8487e-02, -1.7661e-01,
        -7.3139e-01,  1.0241e-01, -2.8907e-02, -3.8290e-01, -1.5081e-01,
        -8.3637e-01,  3.8202e-01, -4.7150e-01,  9.0745e-02, -2.2174e-02,
         4.9990e-01, -5.8836e-01, -1.9193e-01, -2.5136e-01, -3.6155e-02,
         1.6557e-04, -3.0746e-01,  5.3572e-02,  2.1627e-01,  8.3302e-02,
        -1.9868e-01,  7.1773e-01, -2.6358e-01,  6.3520e-01, -5.7163e-01,
        -3.4078e-01, -1.7289e-01, -2.6737e-02, -8.7677e-01,  1.7389e-01,
         7.4455e-01,  8.6284e-01, -1.1669e+00,  2.8036e-01,  1.2859e-02,
        -8.5991e-01,  1.7080e-01,  3.6011e-01, -7.8064e-02, -5.7476e-01,
        -4.5096e-01, -5.4846e-01, -2.7239e-01,  8.5494e-02,  1.1281e-01,
        -5.8858e-01, -1.3406e+00,  2.4175e-01, -5.5511e-16, -5.5511e-16,
         3.0668e+00,  9.5409e-02,  2.5114e+00, -2.8713e+00,  8.4400e-01,
        -6.2231e-01,  1.7089e-01,  3.4541e-02,  5.3086e-02,  2.1588e-01,
         9.5705e-02, -1.3112e-01,  2.9994e-01, -1.7642e-01, -1.0326e+00,
         7.8098e-01,  0.0000e+00,  3.3523e-01, -1.0222e-02,  4.7863e-02,
         1.4473e-02,  3.1692e-01, -2.3714e-01,  1.7989e-02, -5.6940e-01,
         1.3832e-01, -2.6259e-01, -3.8416e-01,  3.5537e-01,  3.6571e-01,
        -4.1004e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5325]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-8.5753e-01,  1.5961e-01, -4.3739e-01,  1.2697e+00,  8.5082e-01,
         2.0544e+00,  4.6894e-01,  1.7200e-01,  2.5960e-01, -1.1830e+00,
        -5.1503e-01, -2.6796e-01, -7.1558e-01,  1.7722e-01, -8.3372e-02,
         6.6050e-03, -2.1357e-01,  1.7785e+00,  6.2039e-03,  1.8107e-01,
         3.4686e+00, -1.3305e+00, -1.6590e-01, -1.4806e-01,  4.9132e-01,
        -7.2803e-01, -5.3560e-01, -6.8377e-02,  4.9681e-01,  3.0521e-01,
        -2.7679e+00,  7.3610e-01,  1.6269e-01, -1.1482e+00, -9.2375e-01,
        -1.2168e-01, -2.2495e-01, -3.5334e-02,  1.5339e+00,  3.4492e-01,
        -2.6568e-01, -1.5550e+00, -1.0451e-01,  1.7504e+00,  3.7970e-01,
         1.6249e+00, -9.8430e-02,  1.2935e+00, -7.7177e-01,  2.4360e+00,
         1.5402e+00,  3.0646e-01, -4.7150e-01, -3.5738e-01, -7.3471e-01,
        -1.0689e-01, -9.0435e-01, -3.1847e-01, -1.7835e-01,  4.4553e-01,
        -2.5940e-02, -2.2741e-01, -2.2083e+00, -4.8825e-01, -6.4925e-01,
        -1.3467e+00, -4.9602e-01,  5.9803e-02,  6.3520e-01, -5.1032e-01,
        -3.4078e-01, -1.7289e-01, -2.6737e-02,  2.5981e+00, -1.9809e-01,
        -6.2049e-02, -1.4252e+00, -1.6032e+00, -1.7082e+00,  1.2859e-02,
         7.9165e-01,  2.6852e-01, -5.8745e-01, -2.9587e-01, -1.5509e-01,
         7.7953e-01,  1.5779e+00, -3.8589e-01,  4.3100e-01, -1.8140e-01,
        -3.4341e-03, -6.7040e-01,  2.4175e-01, -5.5511e-16, -5.5511e-16,
        -6.8856e-02, -1.6627e+00, -1.8867e+00,  6.4900e-01,  6.2618e+00,
         6.6340e+00,  2.4243e-03, -2.3343e+00,  1.0756e-01, -3.4580e+00,
        -3.4296e-01, -2.5899e-01, -1.9375e-01,  1.7223e+00, -1.4476e+00,
        -2.8876e-01,  0.0000e+00,  4.0441e-01, -1.0222e-02, -1.0005e+00,
        -7.0403e-01, -1.1265e+00,  9.3009e-02,  1.7989e-02,  3.2092e-01,
         1.7459e-02, -1.2012e+00, -1.1096e+00,  1.0037e-01, -8.1572e-03,
        -4.1262e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([885]), tensor(-0.5694))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:main_restricted.py:Testing data year: 2008
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15361
            device: cpu
            
2024-08-02 07:05:20,332	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-02 07:05:20,381	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-02 07:05:20,434	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip' (5.13MiB) to Ray cluster...
2024-08-02 07:05:20,446	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip'.
2024-08-02 07:05:22,289	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-02 07:40:38,639	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 30.29 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:40:48,881	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 40.53 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:40:58,917	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 50.57 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:41:09,039	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 60.69 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
[33m(raylet)[0m [2024-08-02 07:41:14,024 E 4034215 4034215] (raylet) worker_pool.cc:565: Some workers of the worker process(655281) have not registered within the timeout. The process is still alive, probably it's hanging during start.
2024-08-02 07:41:19,151	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 70.80 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
[33m(raylet)[0m [2024-08-02 07:41:25,026 E 4034215 4034215] (raylet) worker_pool.cc:565: Some workers of the worker process(660221) have not registered within the timeout. The process is still alive, probably it's hanging during start.[32m [repeated 2x across cluster] (Ray deduplicates logs by default. Set RAY_DEDUP_LOGS=0 to disable log deduplication, or see https://docs.ray.io/en/master/ray-observability/user-guides/configure-logging.html#log-deduplication for more options.)[0m
2024-08-02 07:41:29,239	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 80.89 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
[33m(raylet)[0m [2024-08-02 07:41:39,026 E 4034215 4034215] (raylet) worker_pool.cc:565: Some workers of the worker process(662944) have not registered within the timeout. The process is still alive, probably it's hanging during start.
2024-08-02 07:41:59,020	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 110.67 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:46:00,659	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 30.19 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:46:16,213	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 45.74 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:46:26,317	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 55.85 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
[33m(raylet)[0m [2024-08-02 07:46:30,061 E 4034215 4034215] (raylet) worker_pool.cc:565: Some workers of the worker process(768343) have not registered within the timeout. The process is still alive, probably it's hanging during start.
2024-08-02 07:46:48,485	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 78.01 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
[33m(raylet)[0m [2024-08-02 07:47:30,070 E 4034215 4034215] (raylet) worker_pool.cc:565: Some workers of the worker process(799550) have not registered within the timeout. The process is still alive, probably it's hanging during start.
2024-08-02 07:49:57,053	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 30.29 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:51:17,370	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 110.61 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:51:44,874	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 138.11 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 09:25:16,891	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_07-05-22' in 0.3550s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 195, 'num_layers': 3, 'num_embeddings': 15361, 'embedding_dim': 5, 'dropout_rate': 0.36, 'lr': 0.006092256381316039, 'weight_decay': 0.00022074361547391359, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10617320106733827
INFO:model_data_nn.py:Best trial testing loss: 0.12020098797759964
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-02_07-05-17_912778_1598840/artifacts/2024-08-02_07-05-22/train_fnn_2024-08-02_07-05-22/driver_artifacts/train_fnn_420a1_00066_66_dropout_rate=0.3600,embedding_dim=5,hidden_dim=195,lr=0.0061,num_layers=3,weight_decay=0.0002_2024-08-02_07-05-22
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 195, 'num_layers': 3, 'num_embeddings': 15661, 'embedding_dim': 5, 'dropout_rate': 0.36, 'lr': 0.006092256381316039, 'weight_decay': 0.00022074361547391359, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10724372627897664, 'avg_test_loss': 0.2733997297695879}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10689064057751788, 'avg_test_loss': 0.27300265636406396}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10686237932181895, 'avg_test_loss': 0.27761026506916997}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10684690372981427, 'avg_test_loss': 0.27490719600183616}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10685246069747496, 'avg_test_loss': 0.27422897118622386}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10685683025180229, 'avg_test_loss': 0.27590126793022707}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10687038702883124, 'avg_test_loss': 0.27743695409545505}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10685519669406426, 'avg_test_loss': 0.27238584688838674}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10684187842973618, 'avg_test_loss': 0.2724850557009834}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.1068485047019917, 'avg_test_loss': 0.27180709779277384}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10685281732779604, 'avg_test_loss': 0.2788632331300987}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10684012903601095, 'avg_test_loss': 0.2733276098988861}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10685544742900292, 'avg_test_loss': 0.273639238784572}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.1068381796722957, 'avg_test_loss': 0.27237630428085885}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10685054387747517, 'avg_test_loss': 0.2726790445200001}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.10684939639364344, 'avg_test_loss': 0.2749473607998742}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.10684774537301106, 'avg_test_loss': 0.27118900950916436}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.10684919613556573, 'avg_test_loss': 0.2760796157394599}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.10685900560048725, 'avg_test_loss': 0.28123033925727664}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.10684961851371984, 'avg_test_loss': 0.27369165252819955}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.10684633619641752, 'avg_test_loss': 0.273525308138613}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.10684467656117055, 'avg_test_loss': 0.2745284925036845}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.10685780245385858, 'avg_test_loss': 0.27262498699944926}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.10682720649203965, 'avg_test_loss': 0.2780558535220673}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.10683670484097756, 'avg_test_loss': 0.27594807838271573}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.10684756274169137, 'avg_test_loss': 0.277570726913938}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.1068449309544592, 'avg_test_loss': 0.27023703945741295}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.10684470928633415, 'avg_test_loss': 0.2699666783302666}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.10683037215892437, 'avg_test_loss': 0.27022777832821904}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.106842879915104, 'avg_test_loss': 0.27221085257509137}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.10684842904449068, 'avg_test_loss': 0.27689007019060125}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.10684397674468, 'avg_test_loss': 0.27473130938504264}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.10684490810814602, 'avg_test_loss': 0.2762344735860082}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.10684032135912971, 'avg_test_loss': 0.27367989509273694}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.10684435607163742, 'avg_test_loss': 0.2782319179843681}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.10684307918785386, 'avg_test_loss': 0.2727849963269534}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.10686402594370466, 'avg_test_loss': 0.2767109987196101}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.1068486509815095, 'avg_test_loss': 0.27128941019388486}
INFO:model_data_nn.py:Early stopping at epoch 38
INFO:main_restricted.py:Making prediction for data in year: 2009
INFO:main_restricted.py:Prediction data shape: (16061,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2009: 0.5208835456411975
INFO:main_restricted.py:Prediction Stats:                retq         pred
count  16061.000000  16061.00000
mean       0.139171      0.04755
std        0.512778      0.00000
min       -0.941129      0.04755
25%       -0.088888      0.04755
50%        0.057852      0.04755
75%        0.252000      0.04755
max       18.331762      0.04755
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:transform_data_nn.py:Train_data: (499970, 161)

INFO:transform_data_nn.py:Test data years: [2009]
INFO:transform_data_nn.py:Test_data: (16061, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:transform_data_nn.py:Retrain_data: (516031, 161)

INFO:transform_data_nn.py:Prediction data years: [2010]
INFO:transform_data_nn.py:Prediction_data: (15133, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([499970, 138])
            y_train_tf: torch.Size([499970])

            x_test_tf: torch.Size([16061, 138])
            y_test_tf: torch.Size([16061])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([516031, 138])
            y_retrain_tf: torch.Size([516031])

            x_prediction_tf: torch.Size([15133, 138])
            y_prediction_tf: torch.Size([15133])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.3834e-01,  8.8641e-01,  7.0010e-02, -1.6107e+00, -1.3694e-01,
        -8.1424e-01, -1.4822e-01, -3.5060e-01,  4.4198e-01, -1.8868e-01,
        -7.0388e-01,  7.9521e-02, -7.1558e-01, -5.1497e-01,  7.7327e-02,
         5.1104e-01, -1.3124e-01,  2.0309e-01, -7.7387e-02,  5.8002e-01,
        -4.1119e-01, -5.1090e-02, -1.7515e-01,  3.4879e-03, -9.8594e-02,
        -3.4145e-01, -5.9437e-01, -6.8377e-02,  3.9758e-01,  1.3974e+00,
         3.5190e-01, -1.4045e-01,  7.8751e-01,  2.9673e-01, -2.2549e-01,
        -2.4982e-01,  1.0686e-01,  7.9445e-01, -3.0162e-02, -1.1197e+00,
        -2.7480e-01,  2.8297e-01,  3.2759e-01,  4.8487e-02, -1.7661e-01,
        -7.3139e-01,  1.0241e-01, -2.8907e-02, -3.8290e-01, -1.5081e-01,
        -8.3637e-01,  3.8202e-01, -4.7150e-01,  9.0745e-02, -2.2174e-02,
         4.9990e-01, -5.8836e-01, -1.9193e-01, -2.5136e-01, -3.6155e-02,
         1.6557e-04, -3.0746e-01,  5.3572e-02,  2.1627e-01,  8.3302e-02,
        -1.9868e-01,  7.1773e-01, -2.6358e-01,  6.3520e-01, -5.7163e-01,
        -3.4078e-01, -1.7289e-01, -2.6737e-02, -8.7677e-01,  1.7389e-01,
         7.4455e-01,  8.6284e-01, -1.1669e+00,  2.8036e-01,  1.2859e-02,
        -8.5991e-01,  1.7080e-01,  3.6011e-01, -7.8064e-02, -5.7476e-01,
        -4.5096e-01, -5.4846e-01, -2.7239e-01,  8.5494e-02,  1.1281e-01,
        -5.8858e-01, -1.3406e+00,  2.4175e-01, -5.5511e-16, -5.5511e-16,
         3.0668e+00,  9.5409e-02,  2.5114e+00, -2.8713e+00,  8.4400e-01,
        -6.2231e-01,  1.7089e-01,  3.4541e-02,  5.3086e-02,  2.1588e-01,
         9.5705e-02, -1.3112e-01,  2.9994e-01, -1.7642e-01, -1.0326e+00,
         7.8098e-01,  0.0000e+00,  3.3523e-01, -1.0222e-02,  4.7863e-02,
         1.4473e-02,  3.1692e-01, -2.3714e-01,  1.7989e-02, -5.6940e-01,
         1.3832e-01, -2.6259e-01, -3.8416e-01,  3.5537e-01,  3.6571e-01,
        -4.1004e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5325]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-8.5753e-01,  1.5961e-01, -4.3739e-01,  1.2697e+00,  8.5082e-01,
         2.0544e+00,  4.6894e-01,  1.7200e-01,  2.5960e-01, -1.1830e+00,
        -5.1503e-01, -2.6796e-01, -7.1558e-01,  1.7722e-01, -8.3372e-02,
         6.6050e-03, -2.1357e-01,  1.7785e+00,  6.2039e-03,  1.8107e-01,
         3.4686e+00, -1.3305e+00, -1.6590e-01, -1.4806e-01,  4.9132e-01,
        -7.2803e-01, -5.3560e-01, -6.8377e-02,  4.9681e-01,  3.0521e-01,
        -2.7679e+00,  7.3610e-01,  1.6269e-01, -1.1482e+00, -9.2375e-01,
        -1.2168e-01, -2.2495e-01, -3.5334e-02,  1.5339e+00,  3.4492e-01,
        -2.6568e-01, -1.5550e+00, -1.0451e-01,  1.7504e+00,  3.7970e-01,
         1.6249e+00, -9.8430e-02,  1.2935e+00, -7.7177e-01,  2.4360e+00,
         1.5402e+00,  3.0646e-01, -4.7150e-01, -3.5738e-01, -7.3471e-01,
        -1.0689e-01, -9.0435e-01, -3.1847e-01, -1.7835e-01,  4.4553e-01,
        -2.5940e-02, -2.2741e-01, -2.2083e+00, -4.8825e-01, -6.4925e-01,
        -1.3467e+00, -4.9602e-01,  5.9803e-02,  6.3520e-01, -5.1032e-01,
        -3.4078e-01, -1.7289e-01, -2.6737e-02,  2.5981e+00, -1.9809e-01,
        -6.2049e-02, -1.4252e+00, -1.6032e+00, -1.7082e+00,  1.2859e-02,
         7.9165e-01,  2.6852e-01, -5.8745e-01, -2.9587e-01, -1.5509e-01,
         7.7953e-01,  1.5779e+00, -3.8589e-01,  4.3100e-01, -1.8140e-01,
        -3.4341e-03, -6.7040e-01,  2.4175e-01, -5.5511e-16, -5.5511e-16,
        -6.8856e-02, -1.6627e+00, -1.8867e+00,  6.4900e-01,  6.2618e+00,
         6.6340e+00,  2.4243e-03, -2.3343e+00,  1.0756e-01, -3.4580e+00,
        -3.4296e-01, -2.5899e-01, -1.9375e-01,  1.7223e+00, -1.4476e+00,
        -2.8876e-01,  0.0000e+00,  4.0441e-01, -1.0222e-02, -1.0005e+00,
        -7.0403e-01, -1.1265e+00,  9.3009e-02,  1.7989e-02,  3.2092e-01,
         1.7459e-02, -1.2012e+00, -1.1096e+00,  1.0037e-01, -8.1572e-03,
        -4.1262e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([885]), tensor(-0.5694))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.4121e-01,  8.9528e-01,  7.1463e-02, -1.6241e+00, -1.2727e-01,
        -8.2640e-01, -1.4643e-01, -3.4830e-01,  4.1360e-01, -1.8449e-01,
        -7.0624e-01,  8.7671e-02, -7.0982e-01, -5.1635e-01,  7.4806e-02,
         5.1213e-01, -1.2865e-01,  2.0872e-01, -8.1535e-02,  5.9056e-01,
        -4.1575e-01, -5.5161e-02, -1.7422e-01,  8.9817e-03, -9.5227e-02,
        -3.4136e-01, -5.9477e-01, -8.0225e-02,  3.8121e-01,  1.3623e+00,
         3.4425e-01, -1.3246e-01,  7.8188e-01,  3.0258e-01, -2.2237e-01,
        -2.4719e-01,  1.1713e-01,  7.9888e-01, -2.5969e-02, -1.1252e+00,
        -2.7520e-01,  3.2236e-01,  3.3716e-01,  3.5944e-02, -1.7170e-01,
        -7.3785e-01,  1.2651e-01, -3.9350e-02, -3.7240e-01, -1.4075e-01,
        -8.4013e-01,  3.7359e-01, -4.7051e-01,  8.8480e-02, -1.6546e-02,
         4.9786e-01, -5.8096e-01, -1.8873e-01, -2.5121e-01, -3.9380e-02,
         4.0694e-03, -3.0703e-01,  6.0828e-02,  2.1111e-01,  8.6529e-02,
        -1.9613e-01,  7.3131e-01, -2.6322e-01,  6.4098e-01, -5.7237e-01,
        -3.4422e-01, -1.7451e-01, -2.6886e-02, -8.8361e-01,  1.8117e-01,
         7.4646e-01,  8.7196e-01, -1.1736e+00,  2.7550e-01,  1.1739e-02,
        -9.2036e-01,  1.7764e-01,  3.5238e-01, -6.2739e-02, -5.7678e-01,
        -4.5776e-01, -5.5306e-01, -2.7362e-01,  9.0321e-02,  1.1504e-01,
        -5.9541e-01, -1.3428e+00,  2.4559e-01, -9.9920e-16, -9.9920e-16,
         3.1114e+00,  1.3849e-01,  2.4813e+00, -2.8954e+00,  5.9632e-01,
        -5.6662e-01,  1.8169e-01, -3.2624e-03,  2.0718e-02,  2.1226e-01,
         9.2872e-02, -1.3143e-01,  2.7299e-01,  2.4228e-01, -9.6495e-01,
         7.9448e-01,  5.3291e-15,  3.3665e-01, -1.1475e-03,  9.2821e-02,
         1.1428e-02,  3.2856e-01, -2.3612e-01,  1.7756e-02, -5.6831e-01,
         1.4121e-01, -2.5690e-01, -3.7294e-01,  3.5968e-01,  3.6648e-01,
        -4.1146e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5387]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-2.5344e-01, -3.1096e-01, -6.7341e-01,  1.2490e+00, -4.1006e-01,
        -2.5781e-01, -5.0459e-01, -5.6837e-01, -9.2668e-02, -1.3391e-01,
        -3.0494e-01,  5.2440e-02, -7.0982e-01,  5.5361e-01,  2.3954e-01,
         1.5969e+00, -1.1194e-01,  1.4900e+00, -8.1535e-02, -1.3064e+00,
         2.7600e-01, -1.2736e-01, -5.1178e-01, -4.3434e-01,  3.2039e-01,
        -7.4341e-01, -6.4548e-01, -8.0225e-02, -6.0723e-01,  1.0306e-02,
        -3.0019e-01, -2.3412e-01,  4.1398e-01,  3.0258e-01, -5.5404e-01,
         4.7722e-01,  6.7906e-01, -6.4132e-01,  1.2262e+00, -4.8690e-01,
        -2.7090e-01,  1.5761e-02, -4.2001e-01, -3.7687e-01, -3.9244e-01,
         6.7322e-01,  3.8929e-02,  1.0615e+00, -1.0189e-01,  2.6221e-02,
         2.3339e+00, -5.3937e-01, -4.7051e-01, -6.7241e-01, -7.3405e-01,
         2.5985e-01, -9.5832e-01,  8.8949e-01, -2.1402e-01, -3.7729e-01,
         2.0044e+00,  2.0470e-01,  2.2179e+00,  2.0581e+00, -2.3054e-02,
         1.5396e+00, -4.9340e-01, -3.0781e-01,  6.4098e-01, -6.6845e-01,
        -3.4422e-01, -1.7451e-01, -2.6886e-02,  1.5724e-01,  1.7281e-01,
        -8.0240e-01,  8.7196e-01,  1.6555e-01,  1.4933e+00,  1.1739e-02,
        -9.2036e-01,  7.3198e-01, -1.6257e-01,  6.6372e-01,  9.9439e-01,
        -3.1379e-01, -4.5383e-01, -3.7081e-02, -2.5262e-01, -4.8432e-01,
         4.7028e-01, -9.4676e-01,  2.4559e-01, -9.9920e-16, -9.9920e-16,
        -2.0504e-01,  1.4241e-01, -1.7596e+00,  1.7051e+00,  1.4704e-01,
        -4.3362e-01, -1.4750e+00, -3.2624e-03, -1.1227e+00,  2.1226e-01,
         7.0597e-03, -1.9757e-01,  2.7299e-01, -1.7608e+00, -1.5179e+00,
         1.0186e+00,  5.3291e-15,  2.7466e-01,  4.5938e+00,  9.2821e-02,
         1.1428e-02, -3.0758e-01, -3.1646e-01,  1.7756e-02, -4.3565e-01,
         1.0607e+00, -8.0701e-02, -3.8260e-01,  3.5104e-01,  2.5291e-01,
        -3.3628e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3537]), tensor(0.0007))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:main_restricted.py:Testing data year: 2009
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15661
            device: cpu
            
2024-08-02 11:10:52,521	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-02 11:10:52,573	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-02 11:10:52,620	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip' (5.13MiB) to Ray cluster...
2024-08-02 11:10:52,631	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip'.
2024-08-02 11:10:54,583	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-02 13:30:35,877	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_11-10-54' in 0.2717s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 55, 'num_layers': 4, 'num_embeddings': 15661, 'embedding_dim': 4, 'dropout_rate': 0.3, 'lr': 0.0034128801361227265, 'weight_decay': 9.397991827316035e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10215413810739402
INFO:model_data_nn.py:Best trial testing loss: 0.2420041498086189
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-02_11-10-50_199790_1598840/artifacts/2024-08-02_11-10-54/train_fnn_2024-08-02_11-10-54/driver_artifacts/train_fnn_8f2ba_00017_17_dropout_rate=0.3000,embedding_dim=4,hidden_dim=55,lr=0.0034,num_layers=4,weight_decay=0.0000_2024-08-02_11-10-54
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 55, 'num_layers': 4, 'num_embeddings': 15845, 'embedding_dim': 4, 'dropout_rate': 0.3, 'lr': 0.0034128801361227265, 'weight_decay': 9.397991827316035e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10920223281411237, 'avg_test_loss': 0.07429737276663456}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10711663934305425, 'avg_test_loss': 0.07957398287861374}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10695328231762315, 'avg_test_loss': 0.07653280285760036}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1067927699284267, 'avg_test_loss': 0.07478605444891571}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10676918145430873, 'avg_test_loss': 0.07515623440757299}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10683033798900686, 'avg_test_loss': 0.07525056925745992}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.1066646019093288, 'avg_test_loss': 0.07444367596355855}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10668728937664929, 'avg_test_loss': 0.07432016811036282}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10673515001233927, 'avg_test_loss': 0.0747981698549575}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.1068652309888555, 'avg_test_loss': 0.07533420251394932}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10692086734460998, 'avg_test_loss': 0.07512620029317306}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main_restricted.py:Making prediction for data in year: 2010
INFO:main_restricted.py:Prediction data shape: (15133,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2010: 0.27410717649881833
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  15133.000000  15133.000000
mean       0.066892      0.082492
std        0.270575      0.052362
min       -0.913334     -0.137700
25%       -0.069767      0.048130
50%        0.041405      0.076129
75%        0.175515      0.112404
max        7.399156      0.478782
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:transform_data_nn.py:Train_data: (516031, 161)

INFO:transform_data_nn.py:Test data years: [2010]
INFO:transform_data_nn.py:Test_data: (15133, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:transform_data_nn.py:Retrain_data: (531164, 161)

INFO:transform_data_nn.py:Prediction data years: [2011]
INFO:transform_data_nn.py:Prediction_data: (14552, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([516031, 138])
            y_train_tf: torch.Size([516031])

            x_test_tf: torch.Size([15133, 138])
            y_test_tf: torch.Size([15133])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([531164, 138])
            y_retrain_tf: torch.Size([531164])

            x_prediction_tf: torch.Size([14552, 138])
            y_prediction_tf: torch.Size([14552])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.4121e-01,  8.9528e-01,  7.1463e-02, -1.6241e+00, -1.2727e-01,
        -8.2640e-01, -1.4643e-01, -3.4830e-01,  4.1360e-01, -1.8449e-01,
        -7.0624e-01,  8.7671e-02, -7.0982e-01, -5.1635e-01,  7.4806e-02,
         5.1213e-01, -1.2865e-01,  2.0872e-01, -8.1535e-02,  5.9056e-01,
        -4.1575e-01, -5.5161e-02, -1.7422e-01,  8.9817e-03, -9.5227e-02,
        -3.4136e-01, -5.9477e-01, -8.0225e-02,  3.8121e-01,  1.3623e+00,
         3.4425e-01, -1.3246e-01,  7.8188e-01,  3.0258e-01, -2.2237e-01,
        -2.4719e-01,  1.1713e-01,  7.9888e-01, -2.5969e-02, -1.1252e+00,
        -2.7520e-01,  3.2236e-01,  3.3716e-01,  3.5944e-02, -1.7170e-01,
        -7.3785e-01,  1.2651e-01, -3.9350e-02, -3.7240e-01, -1.4075e-01,
        -8.4013e-01,  3.7359e-01, -4.7051e-01,  8.8480e-02, -1.6546e-02,
         4.9786e-01, -5.8096e-01, -1.8873e-01, -2.5121e-01, -3.9380e-02,
         4.0694e-03, -3.0703e-01,  6.0828e-02,  2.1111e-01,  8.6529e-02,
        -1.9613e-01,  7.3131e-01, -2.6322e-01,  6.4098e-01, -5.7237e-01,
        -3.4422e-01, -1.7451e-01, -2.6886e-02, -8.8361e-01,  1.8117e-01,
         7.4646e-01,  8.7196e-01, -1.1736e+00,  2.7550e-01,  1.1739e-02,
        -9.2036e-01,  1.7764e-01,  3.5238e-01, -6.2739e-02, -5.7678e-01,
        -4.5776e-01, -5.5306e-01, -2.7362e-01,  9.0321e-02,  1.1504e-01,
        -5.9541e-01, -1.3428e+00,  2.4559e-01, -9.9920e-16, -9.9920e-16,
         3.1114e+00,  1.3849e-01,  2.4813e+00, -2.8954e+00,  5.9632e-01,
        -5.6662e-01,  1.8169e-01, -3.2624e-03,  2.0718e-02,  2.1226e-01,
         9.2872e-02, -1.3143e-01,  2.7299e-01,  2.4228e-01, -9.6495e-01,
         7.9448e-01,  5.3291e-15,  3.3665e-01, -1.1475e-03,  9.2821e-02,
         1.1428e-02,  3.2856e-01, -2.3612e-01,  1.7756e-02, -5.6831e-01,
         1.4121e-01, -2.5690e-01, -3.7294e-01,  3.5968e-01,  3.6648e-01,
        -4.1146e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5387]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-2.5344e-01, -3.1096e-01, -6.7341e-01,  1.2490e+00, -4.1006e-01,
        -2.5781e-01, -5.0459e-01, -5.6837e-01, -9.2668e-02, -1.3391e-01,
        -3.0494e-01,  5.2440e-02, -7.0982e-01,  5.5361e-01,  2.3954e-01,
         1.5969e+00, -1.1194e-01,  1.4900e+00, -8.1535e-02, -1.3064e+00,
         2.7600e-01, -1.2736e-01, -5.1178e-01, -4.3434e-01,  3.2039e-01,
        -7.4341e-01, -6.4548e-01, -8.0225e-02, -6.0723e-01,  1.0306e-02,
        -3.0019e-01, -2.3412e-01,  4.1398e-01,  3.0258e-01, -5.5404e-01,
         4.7722e-01,  6.7906e-01, -6.4132e-01,  1.2262e+00, -4.8690e-01,
        -2.7090e-01,  1.5761e-02, -4.2001e-01, -3.7687e-01, -3.9244e-01,
         6.7322e-01,  3.8929e-02,  1.0615e+00, -1.0189e-01,  2.6221e-02,
         2.3339e+00, -5.3937e-01, -4.7051e-01, -6.7241e-01, -7.3405e-01,
         2.5985e-01, -9.5832e-01,  8.8949e-01, -2.1402e-01, -3.7729e-01,
         2.0044e+00,  2.0470e-01,  2.2179e+00,  2.0581e+00, -2.3054e-02,
         1.5396e+00, -4.9340e-01, -3.0781e-01,  6.4098e-01, -6.6845e-01,
        -3.4422e-01, -1.7451e-01, -2.6886e-02,  1.5724e-01,  1.7281e-01,
        -8.0240e-01,  8.7196e-01,  1.6555e-01,  1.4933e+00,  1.1739e-02,
        -9.2036e-01,  7.3198e-01, -1.6257e-01,  6.6372e-01,  9.9439e-01,
        -3.1379e-01, -4.5383e-01, -3.7081e-02, -2.5262e-01, -4.8432e-01,
         4.7028e-01, -9.4676e-01,  2.4559e-01, -9.9920e-16, -9.9920e-16,
        -2.0504e-01,  1.4241e-01, -1.7596e+00,  1.7051e+00,  1.4704e-01,
        -4.3362e-01, -1.4750e+00, -3.2624e-03, -1.1227e+00,  2.1226e-01,
         7.0597e-03, -1.9757e-01,  2.7299e-01, -1.7608e+00, -1.5179e+00,
         1.0186e+00,  5.3291e-15,  2.7466e-01,  4.5938e+00,  9.2821e-02,
         1.1428e-02, -3.0758e-01, -3.1646e-01,  1.7756e-02, -4.3565e-01,
         1.0607e+00, -8.0701e-02, -3.8260e-01,  3.5104e-01,  2.5291e-01,
        -3.3628e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3537]), tensor(0.0007))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.4204e-01,  9.0497e-01,  7.1025e-02, -1.6388e+00, -1.2056e-01,
        -8.2879e-01, -1.4566e-01, -3.4674e-01,  4.0978e-01, -1.8283e-01,
        -7.1041e-01,  9.1306e-02, -7.0798e-01, -5.2311e-01,  7.6981e-02,
         5.1650e-01, -1.2718e-01,  2.1020e-01, -8.0993e-02,  6.0212e-01,
        -4.0567e-01, -5.9257e-02, -1.7616e-01,  8.1113e-03, -9.1650e-02,
        -3.4175e-01, -5.9556e-01, -8.3323e-02,  3.6245e-01,  1.3576e+00,
         3.4575e-01, -1.2974e-01,  7.8350e-01,  3.0756e-01, -2.2172e-01,
        -2.3947e-01,  1.3213e-01,  8.0166e-01, -1.8019e-02, -1.1316e+00,
        -2.7344e-01,  2.8652e-01,  3.4979e-01,  3.1012e-02, -1.6565e-01,
        -7.3752e-01,  1.1264e-01, -4.6470e-02, -3.5081e-01, -1.4099e-01,
        -8.4408e-01,  3.6004e-01, -4.7003e-01,  8.6631e-02, -1.6777e-02,
         4.9713e-01, -5.7405e-01, -1.8628e-01, -2.5300e-01, -3.9390e-02,
         3.9095e-03, -3.0957e-01,  6.7811e-02,  2.1479e-01,  8.9776e-02,
        -1.9308e-01,  7.4305e-01, -2.6158e-01,  6.3569e-01, -5.7392e-01,
        -3.4702e-01, -1.7552e-01, -2.6984e-02, -8.8324e-01,  1.8516e-01,
         7.5307e-01,  8.8312e-01, -1.1774e+00,  2.7376e-01,  1.3360e-02,
        -9.5882e-01,  1.8817e-01,  3.5765e-01, -4.4799e-02, -5.7842e-01,
        -4.6241e-01, -5.5628e-01, -2.7512e-01,  9.2996e-02,  1.1420e-01,
        -6.0227e-01, -1.3410e+00,  2.4940e-01,  0.0000e+00,  0.0000e+00,
         3.1545e+00,  1.2984e-01,  2.4640e+00, -2.8995e+00,  5.9741e-01,
        -5.7146e-01,  1.9291e-01,  1.4458e-03, -3.1282e-02,  2.0882e-01,
         9.1615e-02, -1.4229e-01,  2.7212e-01,  1.4418e-01, -9.0940e-01,
         7.9023e-01,  3.5527e-15,  3.3744e-01,  6.4198e-03,  8.5865e-02,
         1.7372e-02,  3.3998e-01, -2.3104e-01,  1.7550e-02, -5.6647e-01,
         1.4017e-01, -2.4964e-01, -3.6628e-01,  3.6211e-01,  3.6720e-01,
        -4.1350e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5406]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-1.4866e-01, -3.8436e-01,  1.6939e+00,  1.2290e+00,  1.2932e+00,
        -8.5364e-01, -5.5220e-01, -5.9230e-01, -1.4163e-01, -9.1641e-02,
        -4.8680e-01,  2.7352e-01, -7.0798e-01,  5.9831e-01,  8.0353e-02,
        -9.4614e-01,  2.0258e+00,  1.4897e+00, -8.0993e-02, -5.6157e-02,
        -2.1391e-01, -1.3037e-01, -1.5752e-01, -9.0284e-01,  8.5135e-01,
        -8.5961e-01, -5.7532e-01, -8.3323e-02,  6.7166e-01,  3.8547e-01,
         9.5406e-04,  7.4984e-01,  5.5137e-01,  3.0756e-01, -6.4749e-01,
         6.8013e-01,  4.3329e-01, -6.4366e-01,  1.1155e+00, -3.9802e-01,
        -2.7352e-01, -1.7590e-01,  3.4984e-01, -3.8674e-01,  6.9995e-01,
        -8.6480e-01, -1.8046e-01,  3.0750e-01, -8.9476e-02, -3.0337e-01,
         2.3328e+00, -2.6145e-01, -4.7003e-01, -6.7361e-01, -7.3673e-01,
         1.4283e-01, -9.5341e-01,  9.1073e-02, -7.1060e-01, -3.6045e-01,
         6.3468e-01, -5.5225e-01, -6.2751e-02, -1.3289e+00, -2.5585e-02,
        -2.5170e-01, -4.9021e-01, -3.8605e-01,  2.6573e+00, -7.2974e-01,
        -3.4702e-01, -1.7552e-01, -2.6984e-02, -1.0522e+00,  1.0922e-01,
         6.5243e-02,  8.8312e-01,  1.1512e-01,  1.4958e+00,  1.3360e-02,
        -9.5882e-01, -2.3551e-01, -4.1797e-01, -8.7387e-01, -3.8474e-01,
        -3.2019e-01, -4.5914e-01, -1.6928e-01, -5.6706e-01,  5.3923e-01,
        -2.6620e-01, -3.5075e-01,  2.4940e-01,  0.0000e+00,  0.0000e+00,
        -6.0167e-02,  2.3365e-01, -1.6341e+00,  1.2753e+00,  7.7413e-02,
        -4.6648e-01, -1.0458e-01,  1.4458e-03, -1.2036e+00,  2.0882e-01,
        -6.2544e-01, -1.6480e-01,  2.7212e-01,  1.0230e+00, -1.2542e+00,
        -8.3681e-01,  3.5527e-15,  3.7054e-01,  1.3856e+00,  8.5865e-02,
         1.7372e-02, -6.1138e-01,  2.4378e-01,  1.7550e-02, -3.4986e-01,
         1.2958e-01, -5.7191e-01, -7.4570e-01,  4.7395e-01,  4.0797e-01,
        -3.0856e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3434]), tensor(0.1286))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:main_restricted.py:Testing data year: 2010
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15845
            device: cpu
            
2024-08-02 14:42:11,130	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-02 14:42:11,183	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-02 14:42:11,252	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_e65415f55bf86f5e.zip' (5.14MiB) to Ray cluster...
2024-08-02 14:42:11,266	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_e65415f55bf86f5e.zip'.
2024-08-02 14:42:13,267	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-02 17:30:08,801	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_14-42-13' in 0.3554s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 3, 'num_embeddings': 15845, 'embedding_dim': 2, 'dropout_rate': 0.25, 'lr': 3.791105473537746e-05, 'weight_decay': 0.0003409097499797901, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10765160795774802
INFO:model_data_nn.py:Best trial testing loss: 0.07075860874873072
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-02_14-42-08_812439_1598840/artifacts/2024-08-02_14-42-13/train_fnn_2024-08-02_14-42-13/driver_artifacts/train_fnn_14415_00039_39_dropout_rate=0.2500,embedding_dim=2,hidden_dim=5,lr=0.0000,num_layers=3,weight_decay=0.0003_2024-08-02_14-42-13
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 3, 'num_embeddings': 15911, 'embedding_dim': 2, 'dropout_rate': 0.25, 'lr': 3.791105473537746e-05, 'weight_decay': 0.0003409097499797901, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.11071084982522864, 'avg_test_loss': 0.06794973274099303}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.11051638318246615, 'avg_test_loss': 0.06845150878345901}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.11011797334488914, 'avg_test_loss': 0.06879246015470107}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10952594888095023, 'avg_test_loss': 0.06902261827714168}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10897508407287018, 'avg_test_loss': 0.06877959658606694}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10867490638240478, 'avg_test_loss': 0.06866763428181083}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10832659520247215, 'avg_test_loss': 0.0686130730394315}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10811624036458164, 'avg_test_loss': 0.06871096669890724}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10792025771192468, 'avg_test_loss': 0.0687668799023543}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.10763306313144172, 'avg_test_loss': 0.06859743358301265}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10759721708676229, 'avg_test_loss': 0.06907906839931077}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main_restricted.py:Making prediction for data in year: 2011
INFO:main_restricted.py:Prediction data shape: (14552,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2011: 0.2628220587744252
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  14552.000000  14552.000000
mean      -0.010813      0.045612
std        0.256328      0.026741
min       -0.956637     -0.078061
25%       -0.153673      0.034213
50%       -0.006813      0.038987
75%        0.109958      0.057065
max        3.447154      0.234681
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:transform_data_nn.py:Train_data: (545716, 161)

INFO:transform_data_nn.py:Test data years: [2012]
INFO:transform_data_nn.py:Test_data: (14104, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:transform_data_nn.py:Retrain_data: (559820, 161)

INFO:transform_data_nn.py:Prediction data years: [2013]
INFO:transform_data_nn.py:Prediction_data: (13650, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([545716, 138])
            y_train_tf: torch.Size([545716])

            x_test_tf: torch.Size([14104, 138])
            y_test_tf: torch.Size([14104])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([559820, 138])
            y_retrain_tf: torch.Size([559820])

            x_prediction_tf: torch.Size([13650, 138])
            y_prediction_tf: torch.Size([13650])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.3689e-01,  9.1157e-01,  6.9369e-02, -1.6528e+00, -1.1841e-01,
        -8.2997e-01, -1.4522e-01, -3.4551e-01,  4.0898e-01, -1.8154e-01,
        -7.1409e-01,  8.8285e-02, -7.0755e-01, -5.3051e-01,  7.9484e-02,
         5.1566e-01, -1.2543e-01,  2.0740e-01, -8.1313e-02,  6.0604e-01,
        -4.0398e-01, -6.3847e-02, -1.7607e-01,  7.2938e-03, -9.3163e-02,
        -3.4207e-01, -5.9572e-01, -8.5288e-02,  3.4276e-01,  1.3574e+00,
         3.4760e-01, -1.2902e-01,  7.8441e-01,  3.1260e-01, -2.2243e-01,
        -2.3153e-01,  1.4059e-01,  8.0375e-01, -1.4506e-02, -1.1356e+00,
        -2.7169e-01,  2.8390e-01,  3.5667e-01,  2.7859e-02, -1.6326e-01,
        -7.3498e-01,  1.0962e-01, -4.3715e-02, -3.4253e-01, -1.4341e-01,
        -8.4501e-01,  3.4471e-01, -4.6989e-01,  8.6626e-02, -1.6034e-02,
         4.9646e-01, -5.6699e-01, -1.8578e-01, -2.5334e-01, -3.5828e-02,
         8.2573e-04, -3.0962e-01,  7.1605e-02,  2.1474e-01,  8.6633e-02,
        -1.9115e-01,  7.5164e-01, -2.5935e-01,  6.2505e-01, -5.7514e-01,
        -3.4902e-01, -1.7629e-01, -2.6399e-02, -8.8201e-01,  1.8375e-01,
         7.5769e-01,  8.9317e-01, -1.1798e+00,  2.7173e-01,  1.4574e-02,
        -9.7922e-01,  1.9013e-01,  3.6375e-01, -2.7009e-02, -5.7969e-01,
        -4.6671e-01, -5.5887e-01, -2.7655e-01,  9.6208e-02,  1.1249e-01,
        -6.0925e-01, -1.3408e+00,  2.5293e-01,  1.2212e-15,  1.2212e-15,
         3.1977e+00,  1.2540e-01,  2.4540e+00, -2.9155e+00,  6.0812e-01,
        -5.8052e-01,  1.9693e-01,  7.3229e-03,  2.6452e-02,  1.9573e-01,
         5.2888e-02, -1.4760e-01,  3.1676e-01,  2.2975e-01, -8.9574e-01,
         8.0794e-01, -3.5527e-15,  3.3442e-01,  1.9658e-02,  7.4325e-02,
         1.9734e-02,  3.5144e-01, -2.2905e-01,  1.7363e-02, -5.6395e-01,
         1.4048e-01, -2.4261e-01, -3.6250e-01,  3.6109e-01,  3.6553e-01,
        -4.1516e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5471]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-9.1540e-01,  2.4769e-01, -3.3152e-01,  1.2101e+00,  5.1742e-02,
        -8.5674e-01, -1.2410e+00, -8.2972e-01,  4.9757e-02,  1.0736e-01,
        -3.8931e-01,  1.0250e-01, -7.0755e-01,  1.1292e-01, -2.7881e-01,
        -4.2093e-01, -2.1141e-01,  4.3789e-01, -2.4972e-03, -2.1453e-02,
        -2.5788e-01, -1.3231e-01, -2.2300e-01,  1.1090e-01, -2.4793e-01,
        -7.1905e-01, -6.5163e-01, -8.5288e-02, -2.5324e-01,  6.7568e-01,
         1.0699e-02,  2.7583e-01,  4.0599e-01,  3.1260e-01, -6.5606e-01,
        -3.2582e-01,  2.2114e+00, -6.4318e-01,  3.8407e-02, -8.1228e-01,
        -2.6887e-01, -2.1768e-02,  1.5608e+00, -4.0965e-01, -2.8912e-01,
        -8.5881e-01, -7.5526e-02,  3.0800e-01,  1.4610e-01, -2.5192e-01,
        -5.1011e-02, -2.1669e-01, -4.6989e-01, -3.7144e-01, -7.3728e-01,
         7.1490e-02, -9.4836e-01, -4.4846e-01,  8.6418e-01, -2.8403e-01,
        -1.4576e-01,  8.3445e-01,  2.5686e-01,  3.0595e-01, -2.4979e-02,
        -1.0063e-01, -8.5363e-02, -1.4782e+00, -7.1970e-01, -6.1788e-01,
        -3.4902e-01, -1.7629e-01, -2.6399e-02, -1.0134e+00,  2.0826e-01,
        -2.3417e-02,  2.6780e-01,  3.3369e-01,  1.4982e+00,  1.4574e-02,
         9.2404e-01,  1.0937e-01, -3.8311e-01, -5.1559e-01, -5.7603e-01,
        -3.3527e-01, -4.6945e-01, -4.1899e-01, -3.8347e-01, -2.3051e-01,
        -5.9140e-01,  1.7751e+00,  2.5293e-01,  1.2212e-15,  1.2212e-15,
        -6.4329e-02, -7.2743e-01, -1.5994e+00,  2.1592e-01,  6.0812e-01,
         8.8690e-02, -7.0430e-02,  7.3229e-03, -8.2229e-01,  1.9573e-01,
         3.9552e+00, -1.6782e-01, -1.9428e-01,  2.0045e+00, -6.9486e-01,
        -4.2603e-01, -3.5527e-15,  3.3997e-01, -7.3946e-02, -6.4652e-01,
        -3.4309e+00, -5.9862e-01, -2.5489e-01,  1.7363e-02, -5.3383e-01,
        -6.4987e-01, -5.3894e-01, -5.1364e-01,  3.4006e-01,  1.9917e-01,
        -3.1055e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00]), tensor([3305]), tensor(0.0332))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.3134e-01,  9.1741e-01,  6.8600e-02, -1.6661e+00, -1.1546e-01,
        -8.2999e-01, -1.4765e-01, -3.4688e-01,  4.0666e-01, -1.8007e-01,
        -7.1706e-01,  8.6669e-02, -7.0631e-01, -5.3659e-01,  8.0938e-02,
         5.1852e-01, -1.2317e-01,  2.0496e-01, -8.0231e-02,  6.1119e-01,
        -4.0744e-01, -6.4498e-02, -1.7740e-01,  8.2663e-03, -9.5221e-02,
        -3.4235e-01, -5.9517e-01, -8.6764e-02,  3.2506e-01,  1.3596e+00,
         3.4679e-01, -1.2692e-01,  7.8438e-01,  3.1710e-01, -2.2289e-01,
        -2.3086e-01,  1.4533e-01,  8.0607e-01, -1.3221e-02, -1.1325e+00,
        -2.7025e-01,  2.9709e-01,  3.6244e-01,  2.4822e-02, -1.6114e-01,
        -7.3257e-01,  1.1550e-01, -4.7342e-02, -3.5036e-01, -1.4263e-01,
        -8.4546e-01,  3.3027e-01, -4.6971e-01,  8.8318e-02, -1.3565e-02,
         4.9486e-01, -5.6010e-01, -1.8500e-01, -2.5326e-01, -3.2945e-02,
         5.2329e-04, -3.0915e-01,  7.4502e-02,  2.1366e-01,  8.6836e-02,
        -1.8950e-01,  7.5984e-01, -2.5695e-01,  6.2041e-01, -5.7606e-01,
        -3.5119e-01, -1.7717e-01, -2.5276e-02, -8.7995e-01,  1.8319e-01,
         7.6310e-01,  9.0150e-01, -1.1813e+00,  2.6892e-01,  1.4756e-02,
        -1.0024e+00,  1.9299e-01,  3.6787e-01, -1.1292e-02, -5.8009e-01,
        -4.7025e-01, -5.6101e-01, -2.7805e-01,  1.0030e-01,  1.1237e-01,
        -6.1468e-01, -1.3391e+00,  2.5619e-01,  1.3323e-15,  1.3323e-15,
         3.2409e+00,  1.5289e-01,  2.4501e+00, -2.9549e+00,  5.9736e-01,
        -5.8456e-01,  2.0129e-01,  1.0080e-02,  2.5722e-02,  1.8887e-01,
         4.4875e-02, -1.4970e-01,  2.9308e-01,  3.5833e-01, -8.7931e-01,
         8.3088e-01,  1.2434e-14,  3.3043e-01,  2.1224e-02,  7.2497e-02,
         1.7726e-02,  3.6186e-01, -2.2825e-01,  2.8958e-02, -5.6168e-01,
         1.4255e-01, -2.3650e-01, -3.5840e-01,  3.6035e-01,  3.6384e-01,
        -4.1619e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5524]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-1.4549e-01, -3.7391e-01,  1.8760e-01,  1.1923e+00, -1.6308e-01,
        -5.1522e-01, -1.2280e+00, -8.2958e-01,  2.8453e-01,  3.7376e-01,
        -7.1323e-01, -3.7186e-02, -7.0631e-01,  5.7672e-01,  9.5974e-02,
        -5.9167e-01, -2.1170e-01,  7.9871e-01, -6.4928e-03, -3.2868e-01,
         4.6456e-02, -1.3384e-01, -8.4167e-02, -2.5031e-01, -2.6656e-01,
        -8.1576e-01, -6.6191e-01, -8.6764e-02,  3.8224e-02,  1.2989e+00,
        -1.4633e+00, -2.4447e-01,  2.4122e-01,  3.1710e-01, -7.5839e-01,
         2.6573e-01,  5.4074e-01, -6.3729e-01,  4.6888e-01, -1.1161e+00,
        -2.6478e-01, -3.2840e-01,  5.7793e-01, -2.9995e-01, -7.8543e-02,
        -7.4276e-01, -4.3808e-01, -1.5116e-01, -8.7587e-02, -2.4871e-01,
         7.4218e-01, -3.2487e-01, -4.6971e-01, -3.7833e-01, -1.3565e-02,
        -4.2524e-02, -9.4346e-01, -4.6739e-01, -5.9257e-01, -2.6549e-01,
        -2.0328e-01, -6.0882e-01,  5.8847e-02, -1.0648e+00, -2.3387e-02,
        -1.8379e-01, -4.8605e-01,  2.0428e-01,  6.2041e-01, -7.0234e-01,
        -3.5119e-01, -1.7717e-01, -2.5276e-02, -8.3436e-01, -2.0635e-02,
        -6.0002e-02,  9.0150e-01,  4.0698e-01,  1.4995e+00,  1.4756e-02,
         8.2353e-01, -6.2025e-01, -3.4493e-01, -8.4149e-01, -5.3665e-01,
        -3.7968e-01, -4.9422e-01, -3.5890e-01, -6.0860e-01, -7.1343e-01,
        -4.9902e-01,  6.7590e-01,  2.5619e-01,  1.3323e-15,  1.3323e-15,
        -1.0106e-01, -9.4955e-01, -1.5124e+00,  1.0751e-01, -1.5377e-01,
        -4.1755e-01, -1.8981e-01,  1.0080e-02, -8.2532e-01,  1.8887e-01,
         3.9336e+00, -2.2935e-01,  8.1304e-01,  2.0392e-01, -9.6015e-01,
        -6.8517e-01,  1.2434e-14,  2.2073e-01, -2.0105e+00, -3.9169e-01,
        -3.3986e+00, -5.0987e-01, -1.5158e-01,  2.8958e-02, -2.0123e-01,
         3.8092e-01, -6.5375e-01, -8.0499e-01,  1.8264e-01,  3.9108e-02,
        -3.3784e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3206]), tensor(0.1081))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:main_restricted.py:Testing data year: 2012
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 16081
            device: cpu
            
2024-08-02 18:42:08,198	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-02 18:42:08,253	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-02 18:42:08,304	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_c0c9c192f51f26da.zip' (5.14MiB) to Ray cluster...
2024-08-02 18:42:08,317	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_c0c9c192f51f26da.zip'.
2024-08-02 18:42:10,291	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-02 21:37:56,005	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_18-42-10' in 0.5758s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 3, 'num_embeddings': 16081, 'embedding_dim': 8, 'dropout_rate': 0.48, 'lr': 0.0028350066892508428, 'weight_decay': 0.000437602612330489, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.1097368031174612
INFO:model_data_nn.py:Best trial testing loss: 0.07405898993298445
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-02_18-42-05_880609_1598840/artifacts/2024-08-02_18-42-10/train_fnn_2024-08-02_18-42-10/driver_artifacts/train_fnn_998cd_00070_70_dropout_rate=0.4800,embedding_dim=8,hidden_dim=45,lr=0.0028,num_layers=3,weight_decay=0.0004_2024-08-02_18-42-10
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 3, 'num_embeddings': 16225, 'embedding_dim': 8, 'dropout_rate': 0.48, 'lr': 0.0028350066892508428, 'weight_decay': 0.000437602612330489, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10854206992791544, 'avg_test_loss': 0.05715187677385098}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.1087432015760481, 'avg_test_loss': 0.05643385075320614}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10884672836618306, 'avg_test_loss': 0.057653541044185956}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10884687708206521, 'avg_test_loss': 0.056343888272847586}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10884563548666512, 'avg_test_loss': 0.057898976652505665}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10884067331592684, 'avg_test_loss': 0.05825870703312566}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10883097916189251, 'avg_test_loss': 0.058562736194886146}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10884196520088268, 'avg_test_loss': 0.058046771826296695}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10884472524762798, 'avg_test_loss': 0.057499999005949466}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.10883898733048947, 'avg_test_loss': 0.0585302921116736}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10884519472220583, 'avg_test_loss': 0.05817323874690913}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10884300112177883, 'avg_test_loss': 0.05745025485343969}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.1088413984148611, 'avg_test_loss': 0.06017657092813865}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10884322774273579, 'avg_test_loss': 0.05760108022154494}
INFO:model_data_nn.py:Early stopping at epoch 14
INFO:main_restricted.py:Making prediction for data in year: 2013
INFO:main_restricted.py:Prediction data shape: (13650,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2013: 0.2400585781441694
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  13650.000000  13650.000000
mean       0.095489      0.039235
std        0.233383      0.000000
min       -0.927594      0.039235
25%       -0.012730      0.039235
50%        0.068853      0.039235
75%        0.174490      0.039235
max        3.696775      0.039235
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:transform_data_nn.py:Train_data: (573470, 161)

INFO:transform_data_nn.py:Test data years: [2014]
INFO:transform_data_nn.py:Test_data: (13465, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:transform_data_nn.py:Retrain_data: (586935, 161)

INFO:transform_data_nn.py:Prediction data years: [2015]
INFO:transform_data_nn.py:Prediction_data: (13715, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([573470, 138])
            y_train_tf: torch.Size([573470])

            x_test_tf: torch.Size([13465, 138])
            y_test_tf: torch.Size([13465])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([586935, 138])
            y_retrain_tf: torch.Size([586935])

            x_prediction_tf: torch.Size([13715, 138])
            y_prediction_tf: torch.Size([13715])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.2712e-01,  9.2409e-01,  6.6992e-02, -1.6785e+00, -1.1233e-01,
        -8.2670e-01, -1.5045e-01, -3.4872e-01,  4.0952e-01, -1.7885e-01,
        -7.1955e-01,  8.7390e-02, -7.0704e-01, -5.4205e-01,  8.3250e-02,
         5.2239e-01, -1.2151e-01,  2.0256e-01, -8.3591e-02,  6.1778e-01,
        -4.1136e-01, -6.7821e-02, -1.8047e-01,  9.7519e-03, -9.5602e-02,
        -3.4241e-01, -5.9448e-01, -8.7497e-02,  3.0576e-01,  1.3617e+00,
         3.4786e-01, -1.2465e-01,  7.8587e-01,  3.2159e-01, -2.2264e-01,
        -2.3219e-01,  1.5006e-01,  8.0883e-01, -1.1515e-02, -1.1254e+00,
        -2.6839e-01,  2.9494e-01,  3.6886e-01,  2.4009e-02, -1.5918e-01,
        -7.2673e-01,  1.1317e-01, -5.1507e-02, -3.5028e-01, -1.4660e-01,
        -8.4682e-01,  3.1403e-01, -4.6974e-01,  9.0548e-02, -1.0862e-02,
         4.9251e-01, -5.5361e-01, -1.8394e-01, -2.5323e-01, -3.0984e-02,
        -3.3121e-04, -3.0907e-01,  7.5793e-02,  2.1515e-01,  8.9659e-02,
        -1.8882e-01,  7.6813e-01, -2.5451e-01,  6.1676e-01, -5.7672e-01,
        -3.5287e-01, -1.7814e-01, -2.5421e-02, -8.7254e-01,  1.8428e-01,
         7.7113e-01,  9.0929e-01, -1.1825e+00,  2.6667e-01,  1.4808e-02,
        -1.0121e+00,  1.9789e-01,  3.7412e-01,  2.4083e-03, -5.8094e-01,
        -4.7349e-01, -5.6256e-01, -2.7868e-01,  1.0453e-01,  1.1347e-01,
        -6.1938e-01, -1.3370e+00,  2.5965e-01,  1.4433e-15,  1.4433e-15,
         3.2826e+00,  1.6600e-01,  2.4501e+00, -2.9904e+00,  6.1111e-01,
        -5.8062e-01,  2.0672e-01,  1.0280e-02, -5.3443e-02,  1.8299e-01,
         6.5259e-02, -1.5122e-01,  2.8433e-01,  4.2051e-01, -8.7025e-01,
         8.4897e-01,  3.5527e-15,  3.2663e-01,  2.2914e-02,  7.2964e-02,
         1.3990e-02,  3.7160e-01, -2.2736e-01,  5.0014e-02, -5.6005e-01,
         1.4389e-01, -2.3080e-01, -3.5506e-01,  3.6060e-01,  3.6296e-01,
        -4.1606e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5576]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-7.5230e-01,  1.3016e-01, -3.0819e-02,  1.1761e+00,  4.5838e-02,
        -4.5548e-01, -1.2282e+00, -8.3242e-01,  4.6186e-01,  6.8586e-01,
        -4.5686e-01,  3.6876e-02, -7.0704e-01,  2.1870e-01, -1.1987e-01,
         3.9091e-01, -1.4981e-01,  2.1797e-01,  2.6314e-01, -1.2643e-01,
        -7.0538e-01, -1.3342e-01, -2.1326e-02, -5.6735e-02, -7.4411e-02,
        -7.3587e-01, -6.6603e-01, -8.7497e-02,  8.8518e-01,  1.1466e+00,
        -3.4410e-01,  1.0060e-01,  3.8847e-01,  3.2159e-01, -7.1518e-01,
         8.0116e-02,  5.6858e-01, -6.3466e-01, -2.3487e-01, -1.2279e+00,
        -2.6888e-01,  3.0810e-01,  1.1066e+00, -2.9368e-01, -1.6622e-01,
        -6.7966e-01, -2.7994e-01, -4.5495e-01, -3.5683e-01, -5.6834e-01,
         7.4103e-01, -2.9223e-01, -4.6974e-01, -3.8495e-01, -7.3774e-01,
        -8.5628e-03, -9.3887e-01, -1.9774e-01,  3.5194e-01, -1.5673e-01,
         4.6068e-02,  5.2244e-01,  6.6486e-01,  8.5647e-01, -2.2974e-02,
         1.1651e-01, -3.4466e-01, -5.7437e-01,  1.9596e+00, -6.1395e-01,
        -3.5287e-01, -1.7814e-01, -2.5421e-02, -6.8455e-01,  6.8765e-02,
         8.2196e-02,  3.1947e-01,  8.8142e-01,  1.5025e+00,  1.4808e-02,
         9.0757e-01,  2.7155e-01, -2.8203e-01, -1.2266e+00, -1.1994e-01,
        -4.0185e-01, -5.1041e-01, -3.5155e-01, -3.3836e-01, -1.8840e-01,
         5.0572e-01, -9.5103e-01,  2.5965e-01,  1.4433e-15,  1.4433e-15,
        -3.1069e-01,  2.4798e-01, -1.4549e+00,  1.0411e+00, -6.3947e-01,
        -4.9844e-01, -3.6311e-01,  1.0280e-02, -4.7432e-01,  1.8299e-01,
         3.3030e+00, -2.0420e-01,  1.0471e-01,  2.9919e-01, -5.0049e-01,
        -1.7612e-01,  3.5527e-15,  2.8477e-01, -1.3643e+00, -1.6462e-01,
        -3.3745e+00, -5.0529e-01, -2.4294e-01,  5.0014e-02, -5.6760e-01,
        -3.4870e-01, -6.2531e-01, -6.7829e-01,  2.5647e-01,  1.1355e-01,
        -3.3697e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3191]), tensor(0.2707))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.2297e-01,  9.3129e-01,  6.5636e-02, -1.6897e+00, -1.1095e-01,
        -8.2298e-01, -1.5324e-01, -3.5066e-01,  4.1632e-01, -1.7877e-01,
        -7.2170e-01,  8.9094e-02, -7.1006e-01, -5.4722e-01,  8.5773e-02,
         5.2549e-01, -1.2008e-01,  2.0266e-01, -8.4213e-02,  6.2454e-01,
        -4.0895e-01, -6.6791e-02, -1.8372e-01,  1.0453e-02, -9.5881e-02,
        -3.4276e-01, -5.9379e-01, -9.0171e-02,  2.8383e-01,  1.3663e+00,
         3.4980e-01, -1.2416e-01,  7.8868e-01,  3.2531e-01, -2.2196e-01,
        -2.3097e-01,  1.5455e-01,  8.0949e-01, -9.3699e-03, -1.1168e+00,
        -2.6601e-01,  2.8564e-01,  3.7528e-01,  2.5188e-02, -1.5746e-01,
        -7.2033e-01,  1.0760e-01, -5.1448e-02, -3.5141e-01, -1.4899e-01,
        -8.4783e-01,  2.9581e-01, -4.6980e-01,  9.2151e-02, -8.2883e-03,
         4.9036e-01, -5.4727e-01, -1.8323e-01, -2.5408e-01, -2.8635e-02,
        -1.4982e-03, -3.0983e-01,  7.3052e-02,  2.1674e-01,  9.1409e-02,
        -1.9114e-01,  7.7571e-01, -2.5242e-01,  6.1363e-01, -5.7728e-01,
        -3.5407e-01, -1.7923e-01, -2.5364e-02, -8.6483e-01,  1.8619e-01,
         7.7950e-01,  9.1719e-01, -1.1852e+00,  2.6439e-01,  1.5025e-02,
        -1.0150e+00,  2.0181e-01,  3.8299e-01,  1.7625e-02, -5.8125e-01,
        -4.7682e-01, -5.6400e-01, -2.7840e-01,  1.0834e-01,  1.1444e-01,
        -6.2445e-01, -1.3359e+00,  2.6316e-01,  1.3323e-15,  1.3323e-15,
         3.3235e+00,  1.6146e-01,  2.4532e+00, -3.0225e+00,  6.3244e-01,
        -5.7335e-01,  2.1253e-01,  1.2189e-02, -5.2237e-02,  1.7609e-01,
         6.5543e-02, -1.5258e-01,  2.8951e-01,  4.8873e-01, -8.6323e-01,
         8.6470e-01,  1.4211e-14,  3.2292e-01,  1.4093e-02,  6.5325e-02,
         1.6333e-02,  3.8096e-01, -2.2697e-01,  6.3748e-02, -5.5838e-01,
         1.4427e-01, -2.2475e-01, -3.5316e-01,  3.6115e-01,  3.6161e-01,
        -4.1541e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5632]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.5774e-01, -1.8605e-01, -5.3812e-01,  1.1617e+00, -2.3422e-01,
        -5.4884e-01, -9.8823e-01, -7.7397e-01,  8.0277e-02,  3.3126e-01,
        -7.4848e-01,  1.0178e-02, -7.1006e-01,  3.6292e-01,  5.4398e-02,
         3.3245e-01, -2.0969e-01,  7.2537e-01, -1.1900e-02, -4.5638e-03,
        -5.9686e-01, -1.2395e+00, -3.6291e-01, -1.8387e-01, -3.4472e-01,
        -8.0183e-01, -6.6412e-01, -9.0171e-02,  1.9067e-01,  8.7317e-01,
        -1.8547e-01, -2.3838e-01,  2.8462e-01,  3.2531e-01, -7.7393e-01,
        -3.7375e-01,  1.5995e-01, -6.3930e-01,  2.8817e-01, -9.8606e-01,
        -2.6549e-01,  1.5027e-02, -2.3144e-01, -3.6104e-01, -1.7781e-01,
        -8.0229e-01,  6.5681e-01, -3.1208e-01, -5.7922e-01,  1.6285e-01,
         1.5337e+00, -1.5721e-01, -4.6980e-01, -3.9189e-01, -8.2883e-03,
        -6.7610e-02, -9.3437e-01,  5.0216e-02, -4.7276e-01,  1.0803e-01,
        -7.0768e-01, -5.1945e-01,  2.9076e-01,  7.5764e-01, -2.3098e-02,
        -9.2962e-02, -4.8128e-01,  1.3564e-01,  6.1363e-01, -6.8169e-01,
        -3.5407e-01, -1.7923e-01, -2.5364e-02, -8.7973e-01,  2.8922e-03,
        -1.0470e-01,  9.1719e-01,  8.8083e-01,  1.5062e+00,  1.5025e-02,
         8.6924e-01,  2.7747e-01, -3.3537e-01, -1.0518e+00, -4.4547e-01,
        -3.8114e-01, -5.0047e-01, -3.3548e-01, -6.4803e-01, -3.9025e-01,
        -3.3281e-01, -2.5707e-01,  2.6316e-01,  1.3323e-15,  1.3323e-15,
        -2.1744e-01, -8.7120e-02, -1.4168e+00,  1.0835e-01, -1.9652e-01,
        -1.1579e-01, -3.6732e-03,  1.2189e-02, -2.0997e-01,  1.7609e-01,
         2.6332e+00, -2.0607e-01,  5.3732e-01,  2.4851e-01, -3.6536e-01,
        -4.3748e-01,  1.4211e-14,  1.2293e-01, -6.7237e-01, -5.1786e-01,
        -6.8808e-01, -4.5964e-01, -2.4675e-01,  6.3748e-02, -3.8448e-01,
         2.9366e-01, -4.9552e-01, -7.1746e-01,  2.3160e-01,  9.2251e-02,
        -3.8407e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3300]), tensor(-0.0839))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:main_restricted.py:Testing data year: 2014
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 16362
            device: cpu
            
2024-08-02 23:04:11,328	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-02 23:04:11,378	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-02 23:04:11,431	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_c0c9c192f51f26da.zip' (5.14MiB) to Ray cluster...
2024-08-02 23:04:11,442	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_c0c9c192f51f26da.zip'.
2024-08-02 23:04:13,497	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-03 02:17:14,635	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_23-04-13' in 0.3160s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 5, 'num_embeddings': 16362, 'embedding_dim': 7, 'dropout_rate': 0.39, 'lr': 4.380580767905661e-05, 'weight_decay': 0.00018477934173519273, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.09901452070807863
INFO:model_data_nn.py:Best trial testing loss: 0.05457318584476719
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-02_23-04-08_955437_1598840/artifacts/2024-08-02_23-04-13/train_fnn_2024-08-02_23-04-13/driver_artifacts/train_fnn_354fb_00015_15_dropout_rate=0.3900,embedding_dim=7,hidden_dim=35,lr=0.0000,num_layers=5,weight_decay=0.0002_2024-08-02_23-04-13
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 5, 'num_embeddings': 16543, 'embedding_dim': 7, 'dropout_rate': 0.39, 'lr': 4.380580767905661e-05, 'weight_decay': 0.00018477934173519273, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10651776522472538, 'avg_test_loss': 0.08130907345919203}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10609421519883824, 'avg_test_loss': 0.08070756694288937}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10524471349104061, 'avg_test_loss': 0.0806062822772889}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10459193787973446, 'avg_test_loss': 0.08114062691224622}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10412701799841825, 'avg_test_loss': 0.08023370065811006}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10351321328146806, 'avg_test_loss': 0.08024681735206352}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10288017084373688, 'avg_test_loss': 0.08016382812333482}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10225265603652674, 'avg_test_loss': 0.08132990313333509}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.1017286285248104, 'avg_test_loss': 0.08427069430285088}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.10137315839564583, 'avg_test_loss': 0.08260900477307799}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10102455427807291, 'avg_test_loss': 0.08280307016637185}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10065047165542332, 'avg_test_loss': 0.08285814658402181}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10036885607994751, 'avg_test_loss': 0.08212125973802034}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10018211234911166, 'avg_test_loss': 0.08333532027748256}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.09999116692939027, 'avg_test_loss': 0.08174317000359992}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.09980500808157192, 'avg_test_loss': 0.08294071951915785}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.09962407957621723, 'avg_test_loss': 0.08258589496618975}
INFO:model_data_nn.py:Early stopping at epoch 17
INFO:main_restricted.py:Making prediction for data in year: 2015
INFO:main_restricted.py:Prediction data shape: (13715,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2015: 0.28736324712249167
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  13715.000000  13715.000000
mean      -0.012963      0.043970
std        0.281375      0.042099
min       -0.894256     -0.123711
25%       -0.117383      0.029394
50%       -0.004975      0.034743
75%        0.079168      0.047472
max       16.161400      0.544376
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:transform_data_nn.py:Train_data: (586935, 161)

INFO:transform_data_nn.py:Test data years: [2015]
INFO:transform_data_nn.py:Test_data: (13715, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:transform_data_nn.py:Retrain_data: (600650, 161)

INFO:transform_data_nn.py:Prediction data years: [2016]
INFO:transform_data_nn.py:Prediction_data: (13785, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([586935, 138])
            y_train_tf: torch.Size([586935])

            x_test_tf: torch.Size([13715, 138])
            y_test_tf: torch.Size([13715])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([600650, 138])
            y_retrain_tf: torch.Size([600650])

            x_prediction_tf: torch.Size([13785, 138])
            y_prediction_tf: torch.Size([13785])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.2297e-01,  9.3129e-01,  6.5636e-02, -1.6897e+00, -1.1095e-01,
        -8.2298e-01, -1.5324e-01, -3.5066e-01,  4.1632e-01, -1.7877e-01,
        -7.2170e-01,  8.9094e-02, -7.1006e-01, -5.4722e-01,  8.5773e-02,
         5.2549e-01, -1.2008e-01,  2.0266e-01, -8.4213e-02,  6.2454e-01,
        -4.0895e-01, -6.6791e-02, -1.8372e-01,  1.0453e-02, -9.5881e-02,
        -3.4276e-01, -5.9379e-01, -9.0171e-02,  2.8383e-01,  1.3663e+00,
         3.4980e-01, -1.2416e-01,  7.8868e-01,  3.2531e-01, -2.2196e-01,
        -2.3097e-01,  1.5455e-01,  8.0949e-01, -9.3699e-03, -1.1168e+00,
        -2.6601e-01,  2.8564e-01,  3.7528e-01,  2.5188e-02, -1.5746e-01,
        -7.2033e-01,  1.0760e-01, -5.1448e-02, -3.5141e-01, -1.4899e-01,
        -8.4783e-01,  2.9581e-01, -4.6980e-01,  9.2151e-02, -8.2883e-03,
         4.9036e-01, -5.4727e-01, -1.8323e-01, -2.5408e-01, -2.8635e-02,
        -1.4982e-03, -3.0983e-01,  7.3052e-02,  2.1674e-01,  9.1409e-02,
        -1.9114e-01,  7.7571e-01, -2.5242e-01,  6.1363e-01, -5.7728e-01,
        -3.5407e-01, -1.7923e-01, -2.5364e-02, -8.6483e-01,  1.8619e-01,
         7.7950e-01,  9.1719e-01, -1.1852e+00,  2.6439e-01,  1.5025e-02,
        -1.0150e+00,  2.0181e-01,  3.8299e-01,  1.7625e-02, -5.8125e-01,
        -4.7682e-01, -5.6400e-01, -2.7840e-01,  1.0834e-01,  1.1444e-01,
        -6.2445e-01, -1.3359e+00,  2.6316e-01,  1.3323e-15,  1.3323e-15,
         3.3235e+00,  1.6146e-01,  2.4532e+00, -3.0225e+00,  6.3244e-01,
        -5.7335e-01,  2.1253e-01,  1.2189e-02, -5.2237e-02,  1.7609e-01,
         6.5543e-02, -1.5258e-01,  2.8951e-01,  4.8873e-01, -8.6323e-01,
         8.6470e-01,  1.4211e-14,  3.2292e-01,  1.4093e-02,  6.5325e-02,
         1.6333e-02,  3.8096e-01, -2.2697e-01,  6.3748e-02, -5.5838e-01,
         1.4427e-01, -2.2475e-01, -3.5316e-01,  3.6115e-01,  3.6161e-01,
        -4.1541e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5632]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-3.5774e-01, -1.8605e-01, -5.3812e-01,  1.1617e+00, -2.3422e-01,
        -5.4884e-01, -9.8823e-01, -7.7397e-01,  8.0277e-02,  3.3126e-01,
        -7.4848e-01,  1.0178e-02, -7.1006e-01,  3.6292e-01,  5.4398e-02,
         3.3245e-01, -2.0969e-01,  7.2537e-01, -1.1900e-02, -4.5638e-03,
        -5.9686e-01, -1.2395e+00, -3.6291e-01, -1.8387e-01, -3.4472e-01,
        -8.0183e-01, -6.6412e-01, -9.0171e-02,  1.9067e-01,  8.7317e-01,
        -1.8547e-01, -2.3838e-01,  2.8462e-01,  3.2531e-01, -7.7393e-01,
        -3.7375e-01,  1.5995e-01, -6.3930e-01,  2.8817e-01, -9.8606e-01,
        -2.6549e-01,  1.5027e-02, -2.3144e-01, -3.6104e-01, -1.7781e-01,
        -8.0229e-01,  6.5681e-01, -3.1208e-01, -5.7922e-01,  1.6285e-01,
         1.5337e+00, -1.5721e-01, -4.6980e-01, -3.9189e-01, -8.2883e-03,
        -6.7610e-02, -9.3437e-01,  5.0216e-02, -4.7276e-01,  1.0803e-01,
        -7.0768e-01, -5.1945e-01,  2.9076e-01,  7.5764e-01, -2.3098e-02,
        -9.2962e-02, -4.8128e-01,  1.3564e-01,  6.1363e-01, -6.8169e-01,
        -3.5407e-01, -1.7923e-01, -2.5364e-02, -8.7973e-01,  2.8922e-03,
        -1.0470e-01,  9.1719e-01,  8.8083e-01,  1.5062e+00,  1.5025e-02,
         8.6924e-01,  2.7747e-01, -3.3537e-01, -1.0518e+00, -4.4547e-01,
        -3.8114e-01, -5.0047e-01, -3.3548e-01, -6.4803e-01, -3.9025e-01,
        -3.3281e-01, -2.5707e-01,  2.6316e-01,  1.3323e-15,  1.3323e-15,
        -2.1744e-01, -8.7120e-02, -1.4168e+00,  1.0835e-01, -1.9652e-01,
        -1.1579e-01, -3.6732e-03,  1.2189e-02, -2.0997e-01,  1.7609e-01,
         2.6332e+00, -2.0607e-01,  5.3732e-01,  2.4851e-01, -3.6536e-01,
        -4.3748e-01,  1.4211e-14,  1.2293e-01, -6.7237e-01, -5.1786e-01,
        -6.8808e-01, -4.5964e-01, -2.4675e-01,  6.3748e-02, -3.8448e-01,
         2.9366e-01, -4.9552e-01, -7.1746e-01,  2.3160e-01,  9.2251e-02,
        -3.8407e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3300]), tensor(-0.0839))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.1961e-01,  9.3757e-01,  6.4268e-02, -1.6984e+00, -1.1011e-01,
        -8.2162e-01, -1.5708e-01, -3.5330e-01,  4.2020e-01, -1.7875e-01,
        -7.2314e-01,  9.2995e-02, -7.1218e-01, -5.4972e-01,  8.8526e-02,
         5.2769e-01, -1.1863e-01,  2.0216e-01, -8.3589e-02,  6.3049e-01,
        -4.0953e-01, -6.9182e-02, -1.8601e-01,  1.1531e-02, -9.7244e-02,
        -3.4346e-01, -5.9328e-01, -9.1453e-02,  2.6184e-01,  1.3700e+00,
         3.5016e-01, -1.2255e-01,  7.9076e-01,  3.2898e-01, -2.2041e-01,
        -2.2986e-01,  1.5796e-01,  8.1345e-01, -8.7550e-03, -1.1073e+00,
        -2.6396e-01,  2.9707e-01,  3.8114e-01,  2.5518e-02, -1.5728e-01,
        -7.1601e-01,  1.1233e-01, -4.8778e-02, -3.5785e-01, -1.4643e-01,
        -8.4844e-01,  2.7867e-01, -4.6977e-01,  9.4329e-02, -5.4672e-03,
         4.8797e-01, -5.4097e-01, -1.8265e-01, -2.5418e-01, -2.7392e-02,
        -1.5689e-03, -3.0952e-01,  7.3888e-02,  2.1626e-01,  9.2406e-02,
        -1.9076e-01,  7.8221e-01, -2.5050e-01,  6.1171e-01, -5.7770e-01,
        -3.5567e-01, -1.8053e-01, -2.5192e-02, -8.6089e-01,  1.8947e-01,
         7.8667e-01,  9.2490e-01, -1.1883e+00,  2.6091e-01,  1.4650e-02,
        -1.0191e+00,  2.0380e-01,  3.9056e-01,  3.2376e-02, -5.8238e-01,
        -4.8121e-01, -5.6566e-01, -2.7834e-01,  1.1208e-01,  1.1501e-01,
        -6.3038e-01, -1.3341e+00,  2.6679e-01,  6.6613e-16,  6.6613e-16,
         3.3653e+00,  1.7775e-01,  2.4586e+00, -3.0597e+00,  6.4007e-01,
        -5.7805e-01,  2.1770e-01,  1.2067e-02, -4.9524e-02,  1.7055e-01,
         5.0943e-02, -1.5363e-01,  2.9591e-01,  5.5555e-01, -8.6319e-01,
         8.8036e-01,  1.2434e-14,  3.2014e-01,  2.2101e-02,  5.9652e-02,
         1.6591e-02,  3.9024e-01, -2.2754e-01,  7.5351e-02, -5.5685e-01,
         1.4538e-01, -2.1852e-01, -3.5035e-01,  3.6248e-01,  3.6039e-01,
        -4.1401e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5730]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.6229e-01, -1.7521e-01, -6.7623e-01,  1.1491e+00, -4.0509e-01,
        -1.6985e-01, -1.0147e+00, -7.8352e-01,  6.3024e-01,  7.4602e-01,
        -6.7768e-01, -7.2364e-02, -7.1218e-01,  4.6291e-01,  8.2450e-02,
        -1.9446e-01, -2.0499e-01, -5.2014e-01, -1.2723e-02, -4.0135e-01,
        -4.1952e-01, -1.3350e-01, -1.5706e-01, -2.1393e-01, -2.2169e-01,
        -8.1077e-01, -6.7251e-01, -9.1453e-02, -3.1085e-01,  1.5761e+00,
        -3.3640e-01, -2.1134e-01,  1.8925e-01,  3.2898e-01, -8.0515e-01,
        -3.1908e-01, -1.3330e-01, -6.4137e-01, -9.1804e-01, -9.9317e-01,
        -2.5921e-01, -6.0989e-01, -1.6154e-01, -2.4723e-01, -4.0859e-01,
         1.0192e+00, -5.3104e-01, -9.6284e-01,  6.7116e-03, -5.1277e-01,
         7.3950e-01, -3.5428e-01, -4.6977e-01, -3.9857e-01, -7.3815e-01,
        -1.3129e-01, -9.2996e-01, -2.0246e-01, -2.0748e-01, -3.1216e-01,
        -3.9450e-02, -2.0333e-01,  3.7004e-01,  4.8472e-01, -2.2548e-02,
         3.4874e-02, -4.7907e-01,  2.5206e-01,  6.1171e-01, -6.8773e-01,
        -3.5567e-01, -1.8053e-01, -2.5192e-02,  3.8409e-01, -6.9357e-02,
        -1.4204e-01,  9.2490e-01,  8.7999e-01,  1.5093e+00,  1.4650e-02,
         8.5072e-01, -5.7528e-01, -1.9657e-01, -5.4947e-01, -2.9009e-01,
        -3.7120e-01, -5.0007e-01, -4.2207e-01, -4.5988e-01, -2.7839e-01,
        -2.6369e-01, -4.1986e-01,  2.6679e-01,  6.6613e-16,  6.6613e-16,
        -2.6331e-01, -1.4962e+00, -1.3056e+00,  1.2026e-01,  1.0249e+00,
         1.4083e-01, -9.4690e-01,  1.2067e-02, -1.6059e-02,  1.7055e-01,
         2.1787e+00,  1.9562e-02, -3.6232e+00,  5.0111e-01, -6.7713e-01,
        -1.9019e-01,  1.2434e-14,  8.9498e-02, -1.5108e+00, -3.0415e-01,
        -6.8249e-01, -5.2500e-01, -3.5868e-01,  7.5351e-02, -2.7896e-01,
        -9.3988e-02, -5.5951e-01, -8.2045e-01,  1.4583e-01, -1.0355e-02,
        -4.0202e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00]), tensor([3300]), tensor(0.0483))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:main_restricted.py:Testing data year: 2015
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 16543
            device: cpu
            
2024-08-03 03:49:40,717	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-03 03:49:40,771	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-03 03:49:40,823	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_c0c9c192f51f26da.zip' (5.14MiB) to Ray cluster...
2024-08-03 03:49:40,838	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_c0c9c192f51f26da.zip'.
2024-08-03 03:49:43,284	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-03 06:36:10,024	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-03_03-49-43' in 0.3557s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 175, 'num_layers': 5, 'num_embeddings': 16543, 'embedding_dim': 10, 'dropout_rate': 0.51, 'lr': 1.457050032975656e-06, 'weight_decay': 3.212219315322692e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.1056804292763241
INFO:model_data_nn.py:Best trial testing loss: 0.08059001503846584
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-03_03-49-38_432662_1598840/artifacts/2024-08-03_03-49-43/train_fnn_2024-08-03_03-49-43/driver_artifacts/train_fnn_1775b_00097_97_dropout_rate=0.5100,embedding_dim=10,hidden_dim=175,lr=0.0000,num_layers=5,weight_decay=0.0000_2024-08-03_03-49-44
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 175, 'num_layers': 5, 'num_embeddings': 16832, 'embedding_dim': 10, 'dropout_rate': 0.51, 'lr': 1.457050032975656e-06, 'weight_decay': 3.212219315322692e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.11872270139074176, 'avg_test_loss': 0.09550480829041857}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.11230876345820547, 'avg_test_loss': 0.09476314762525105}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.1093750964364431, 'avg_test_loss': 0.09465414215000281}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10772601597529097, 'avg_test_loss': 0.09463143276629793}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10695359951374406, 'avg_test_loss': 0.0946197793019499}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10644752419646482, 'avg_test_loss': 0.09464697787654856}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10620493467621303, 'avg_test_loss': 0.09472609046855271}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10605559219314965, 'avg_test_loss': 0.09471481351350411}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10595004938758183, 'avg_test_loss': 0.09473488407248411}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.10589238169603546, 'avg_test_loss': 0.09473778615033647}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.1058486703091108, 'avg_test_loss': 0.09475953470193835}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10583705650642514, 'avg_test_loss': 0.09474412842789824}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.1058142114929323, 'avg_test_loss': 0.09473415593597218}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10580735981373089, 'avg_test_loss': 0.09473134295500625}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10579723273967102, 'avg_test_loss': 0.09474584925595644}
INFO:model_data_nn.py:Early stopping at epoch 15
INFO:main_restricted.py:Making prediction for data in year: 2016
INFO:main_restricted.py:Prediction data shape: (13785,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2016: 0.3078534887838995
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  13785.000000  13785.000000
mean       0.043107      0.031243
std        0.307751      0.001860
min       -0.983828      0.019949
25%       -0.074501      0.030866
50%        0.023648      0.031758
75%        0.142416      0.032370
max       16.130048      0.035847
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:transform_data_nn.py:Train_data: (600650, 161)

INFO:transform_data_nn.py:Test data years: [2016]
INFO:transform_data_nn.py:Test_data: (13785, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]
INFO:transform_data_nn.py:Retrain_data: (614435, 161)

INFO:transform_data_nn.py:Prediction data years: [2017]
INFO:transform_data_nn.py:Prediction_data: (13498, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([600650, 138])
            y_train_tf: torch.Size([600650])

            x_test_tf: torch.Size([13785, 138])
            y_test_tf: torch.Size([13785])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([614435, 138])
            y_retrain_tf: torch.Size([614435])

            x_prediction_tf: torch.Size([13498, 138])
            y_prediction_tf: torch.Size([13498])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.1961e-01,  9.3757e-01,  6.4268e-02, -1.6984e+00, -1.1011e-01,
        -8.2162e-01, -1.5708e-01, -3.5330e-01,  4.2020e-01, -1.7875e-01,
        -7.2314e-01,  9.2995e-02, -7.1218e-01, -5.4972e-01,  8.8526e-02,
         5.2769e-01, -1.1863e-01,  2.0216e-01, -8.3589e-02,  6.3049e-01,
        -4.0953e-01, -6.9182e-02, -1.8601e-01,  1.1531e-02, -9.7244e-02,
        -3.4346e-01, -5.9328e-01, -9.1453e-02,  2.6184e-01,  1.3700e+00,
         3.5016e-01, -1.2255e-01,  7.9076e-01,  3.2898e-01, -2.2041e-01,
        -2.2986e-01,  1.5796e-01,  8.1345e-01, -8.7550e-03, -1.1073e+00,
        -2.6396e-01,  2.9707e-01,  3.8114e-01,  2.5518e-02, -1.5728e-01,
        -7.1601e-01,  1.1233e-01, -4.8778e-02, -3.5785e-01, -1.4643e-01,
        -8.4844e-01,  2.7867e-01, -4.6977e-01,  9.4329e-02, -5.4672e-03,
         4.8797e-01, -5.4097e-01, -1.8265e-01, -2.5418e-01, -2.7392e-02,
        -1.5689e-03, -3.0952e-01,  7.3888e-02,  2.1626e-01,  9.2406e-02,
        -1.9076e-01,  7.8221e-01, -2.5050e-01,  6.1171e-01, -5.7770e-01,
        -3.5567e-01, -1.8053e-01, -2.5192e-02, -8.6089e-01,  1.8947e-01,
         7.8667e-01,  9.2490e-01, -1.1883e+00,  2.6091e-01,  1.4650e-02,
        -1.0191e+00,  2.0380e-01,  3.9056e-01,  3.2376e-02, -5.8238e-01,
        -4.8121e-01, -5.6566e-01, -2.7834e-01,  1.1208e-01,  1.1501e-01,
        -6.3038e-01, -1.3341e+00,  2.6679e-01,  6.6613e-16,  6.6613e-16,
         3.3653e+00,  1.7775e-01,  2.4586e+00, -3.0597e+00,  6.4007e-01,
        -5.7805e-01,  2.1770e-01,  1.2067e-02, -4.9524e-02,  1.7055e-01,
         5.0943e-02, -1.5363e-01,  2.9591e-01,  5.5555e-01, -8.6319e-01,
         8.8036e-01,  1.2434e-14,  3.2014e-01,  2.2101e-02,  5.9652e-02,
         1.6591e-02,  3.9024e-01, -2.2754e-01,  7.5351e-02, -5.5685e-01,
         1.4538e-01, -2.1852e-01, -3.5035e-01,  3.6248e-01,  3.6039e-01,
        -4.1401e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5730]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-3.6229e-01, -1.7521e-01, -6.7623e-01,  1.1491e+00, -4.0509e-01,
        -1.6985e-01, -1.0147e+00, -7.8352e-01,  6.3024e-01,  7.4602e-01,
        -6.7768e-01, -7.2364e-02, -7.1218e-01,  4.6291e-01,  8.2450e-02,
        -1.9446e-01, -2.0499e-01, -5.2014e-01, -1.2723e-02, -4.0135e-01,
        -4.1952e-01, -1.3350e-01, -1.5706e-01, -2.1393e-01, -2.2169e-01,
        -8.1077e-01, -6.7251e-01, -9.1453e-02, -3.1085e-01,  1.5761e+00,
        -3.3640e-01, -2.1134e-01,  1.8925e-01,  3.2898e-01, -8.0515e-01,
        -3.1908e-01, -1.3330e-01, -6.4137e-01, -9.1804e-01, -9.9317e-01,
        -2.5921e-01, -6.0989e-01, -1.6154e-01, -2.4723e-01, -4.0859e-01,
         1.0192e+00, -5.3104e-01, -9.6284e-01,  6.7116e-03, -5.1277e-01,
         7.3950e-01, -3.5428e-01, -4.6977e-01, -3.9857e-01, -7.3815e-01,
        -1.3129e-01, -9.2996e-01, -2.0246e-01, -2.0748e-01, -3.1216e-01,
        -3.9450e-02, -2.0333e-01,  3.7004e-01,  4.8472e-01, -2.2548e-02,
         3.4874e-02, -4.7907e-01,  2.5206e-01,  6.1171e-01, -6.8773e-01,
        -3.5567e-01, -1.8053e-01, -2.5192e-02,  3.8409e-01, -6.9357e-02,
        -1.4204e-01,  9.2490e-01,  8.7999e-01,  1.5093e+00,  1.4650e-02,
         8.5072e-01, -5.7528e-01, -1.9657e-01, -5.4947e-01, -2.9009e-01,
        -3.7120e-01, -5.0007e-01, -4.2207e-01, -4.5988e-01, -2.7839e-01,
        -2.6369e-01, -4.1986e-01,  2.6679e-01,  6.6613e-16,  6.6613e-16,
        -2.6331e-01, -1.4962e+00, -1.3056e+00,  1.2026e-01,  1.0249e+00,
         1.4083e-01, -9.4690e-01,  1.2067e-02, -1.6059e-02,  1.7055e-01,
         2.1787e+00,  1.9562e-02, -3.6232e+00,  5.0111e-01, -6.7713e-01,
        -1.9019e-01,  1.2434e-14,  8.9498e-02, -1.5108e+00, -3.0415e-01,
        -6.8249e-01, -5.2500e-01, -3.5868e-01,  7.5351e-02, -2.7896e-01,
        -9.3988e-02, -5.5951e-01, -8.2045e-01,  1.4583e-01, -1.0355e-02,
        -4.0202e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00]), tensor([3300]), tensor(0.0483))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.1879e-01,  9.4321e-01,  6.3329e-02, -1.7061e+00, -1.0695e-01,
        -8.2167e-01, -1.5971e-01, -3.5496e-01,  4.2319e-01, -1.7800e-01,
        -7.2408e-01,  9.9669e-02, -7.1336e-01, -5.4968e-01,  8.8846e-02,
         5.3097e-01, -1.1696e-01,  2.0172e-01, -8.4957e-02,  6.3770e-01,
        -4.1266e-01, -6.6137e-02, -1.8490e-01,  1.3801e-02, -9.6282e-02,
        -3.4405e-01, -5.9323e-01, -9.3383e-02,  2.4298e-01,  1.3712e+00,
         3.4988e-01, -1.1939e-01,  7.9182e-01,  3.3234e-01, -2.1691e-01,
        -2.2938e-01,  1.6177e-01,  8.1734e-01, -8.6401e-03, -1.0997e+00,
        -2.6202e-01,  3.1273e-01,  3.8902e-01,  2.4981e-02, -1.5612e-01,
        -7.1301e-01,  1.1993e-01, -4.9385e-02, -3.5905e-01, -1.4325e-01,
        -8.4984e-01,  2.6369e-01, -4.6952e-01,  9.7075e-02, -2.3628e-03,
         4.8463e-01, -5.3502e-01, -1.8187e-01, -2.5290e-01, -2.7965e-02,
        -1.2174e-03, -3.0804e-01,  7.3540e-02,  2.1603e-01,  9.4387e-02,
        -1.9113e-01,  7.8985e-01, -2.4873e-01,  6.1106e-01, -5.7785e-01,
        -3.5767e-01, -1.8230e-01, -2.5416e-02, -8.5886e-01,  1.9480e-01,
         7.9362e-01,  9.3213e-01, -1.1916e+00,  2.5685e-01,  1.4150e-02,
        -1.0411e+00,  2.0708e-01,  3.9690e-01,  4.6322e-02, -5.8310e-01,
        -4.8748e-01, -5.6759e-01, -2.7873e-01,  1.1580e-01,  1.1573e-01,
        -6.3564e-01, -1.3330e+00,  2.6992e-01,  6.6613e-16,  6.6613e-16,
         3.4069e+00,  2.1191e-01,  2.4701e+00, -3.0827e+00,  6.3707e-01,
        -5.8285e-01,  2.2507e-01,  1.1436e-02, -4.7594e-02,  1.6806e-01,
         5.0409e-02, -1.5415e-01,  2.5646e-01,  5.9089e-01, -8.5109e-01,
         8.9897e-01,  1.4211e-14,  3.1911e-01,  2.8687e-02,  5.3502e-02,
         1.4085e-02,  3.9967e-01, -2.2706e-01,  8.5841e-02, -5.5557e-01,
         1.4678e-01, -2.1286e-01, -3.4551e-01,  3.6512e-01,  3.5881e-01,
        -4.1247e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5813]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.9730e-01, -1.3769e-01, -5.5384e-01,  1.1374e+00, -4.6372e-01,
        -9.8860e-01, -1.3233e+00, -8.5474e-01, -7.5678e-02,  9.8967e-02,
        -6.5086e-01, -7.0955e-02, -5.8203e-01,  1.1884e-01, -1.9635e-01,
        -2.3451e-01, -2.0460e-01, -1.3992e-01, -1.4783e-02, -2.1873e-01,
         1.7607e+00, -1.3329e-01, -5.5283e-02, -2.8985e-01, -3.1342e-01,
        -7.0902e-01, -6.5367e-01, -9.3383e-02,  6.8746e-01,  8.3982e-01,
         1.1350e-01, -3.2413e-01,  9.5883e-02,  3.3234e-01, -8.5419e-01,
        -6.3044e-01, -3.7395e-01, -6.3469e-01, -5.8384e-01, -9.1900e-02,
        -2.6316e-01,  3.6008e-01, -4.3839e-01, -4.1846e-01, -3.7246e-01,
        -8.9713e-01,  1.0749e+00,  1.9905e-02, -3.0355e-01,  2.1860e+00,
        -5.5439e-02, -1.2342e-01, -4.6952e-01, -4.0506e-01, -7.3820e-01,
        -1.9849e-01, -9.2583e-01, -4.2263e-01,  4.9758e-01,  1.8083e-01,
        -2.3771e-01,  3.5632e-01, -3.0389e-01, -9.9688e-01, -2.2148e-02,
        -3.9293e-01, -4.7732e-01,  9.4118e-01, -7.3251e-01, -6.1703e-01,
        -3.5767e-01, -1.8230e-01, -2.5416e-02, -1.0967e+00, -1.3121e-01,
        -8.7997e-02,  9.3213e-01,  8.7834e-01,  1.5095e+00,  1.4150e-02,
         7.1653e-01, -7.6735e-01, -4.8173e-01, -5.0476e-01, -2.1589e-01,
        -3.7450e-01, -4.9944e-01, -3.2512e-01, -3.4799e-01,  3.2325e-01,
        -2.4932e-01, -4.1668e-01,  2.6992e-01,  6.6613e-16,  6.6613e-16,
        -3.5980e-01, -1.5692e+00, -1.1790e+00, -4.8303e-02, -6.1655e-01,
        -5.6617e-01, -5.0238e-02,  1.0928e+00,  3.6336e-01,  7.6946e-01,
         1.5337e+00, -3.1634e-01, -3.8747e-02,  1.5525e+00, -8.1605e-01,
        -6.8367e-01,  1.4211e-14, -3.9121e-02, -2.4006e+00, -1.0332e+00,
         7.2466e+00, -6.1138e-01, -2.1204e-01,  8.5841e-02, -1.1785e-01,
        -6.9485e-02, -6.4187e-01, -6.3630e-01,  1.0311e-01, -6.0308e-02,
        -3.8034e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3194]), tensor(0.0179))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:main_restricted.py:Testing data year: 2016
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 16832
            device: cpu
            
2024-08-03 08:11:35,291	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-03 08:11:35,339	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-03 08:11:35,389	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_c0c9c192f51f26da.zip' (5.14MiB) to Ray cluster...
2024-08-03 08:11:35,402	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_c0c9c192f51f26da.zip'.
2024-08-03 08:11:37,450	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-03 09:49:03,048	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-03_08-11-37' in 0.3461s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 125, 'num_layers': 3, 'num_embeddings': 16832, 'embedding_dim': 8, 'dropout_rate': 0.36, 'lr': 4.696605981338128e-05, 'weight_decay': 0.000799358605203772, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.09864122832018324
INFO:model_data_nn.py:Best trial testing loss: 0.09413262525586338
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-03_08-11-32_868074_1598840/artifacts/2024-08-03_08-11-37/train_fnn_2024-08-03_08-11-37/driver_artifacts/train_fnn_add54_00060_60_dropout_rate=0.3600,embedding_dim=8,hidden_dim=125,lr=0.0000,num_layers=3,weight_decay=0.0008_2024-08-03_08-11-37
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 125, 'num_layers': 3, 'num_embeddings': 17074, 'embedding_dim': 8, 'dropout_rate': 0.36, 'lr': 4.696605981338128e-05, 'weight_decay': 0.000799358605203772, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10494696442498608, 'avg_test_loss': 0.07091788260235288}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10229268468407901, 'avg_test_loss': 0.07046351539218242}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10033059302276257, 'avg_test_loss': 0.0704384294020727}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.09891667919696459, 'avg_test_loss': 0.07048365856538487}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.09790843412480695, 'avg_test_loss': 0.07043489614960637}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.09696834356208339, 'avg_test_loss': 0.07038784596927782}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.09618659746456708, 'avg_test_loss': 0.07110709323485986}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.0955802496068863, 'avg_test_loss': 0.07081357814190618}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.09501959919741504, 'avg_test_loss': 0.07107486707926397}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.0945378170684787, 'avg_test_loss': 0.07060725118973739}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.09432902231218401, 'avg_test_loss': 0.07056873614604087}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.09403166599239163, 'avg_test_loss': 0.07140210954587183}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.09385595737607867, 'avg_test_loss': 0.0706244633605889}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.09349696194091167, 'avg_test_loss': 0.07071993994897328}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.09346383443465728, 'avg_test_loss': 0.0707727269450494}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.0932991656542044, 'avg_test_loss': 0.071052566331798}
INFO:model_data_nn.py:Early stopping at epoch 16
INFO:main_restricted.py:Making prediction for data in year: 2017
INFO:main_restricted.py:Prediction data shape: (13498,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2017: 0.266479345905827
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  13498.000000  13498.000000
mean       0.040207      0.022754
std        0.265685      0.030521
min       -0.907776     -0.237980
25%       -0.067703      0.011472
50%        0.019797      0.029814
75%        0.118715      0.041546
max        5.661212      0.299105

 Configuration for experiment     train_fnn_2024-08-01_19-52-58   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_19-52-58
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-01_19-52-54_548439_1598840/artifacts/2024-08-01_19-52-58/train_fnn_2024-08-01_19-52-58/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-01_20-13-45   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_20-13-45
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-01_20-13-41_353335_1598840/artifacts/2024-08-01_20-13-45/train_fnn_2024-08-01_20-13-45/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-01_20-39-39   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_20-39-39
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-01_20-39-35_787086_1598840/artifacts/2024-08-01_20-39-39/train_fnn_2024-08-01_20-39-39/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-01_21-17-42   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_21-17-42
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-01_21-17-38_515518_1598840/artifacts/2024-08-01_21-17-42/train_fnn_2024-08-01_21-17-42/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-01_22-00-13   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_22-00-13
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-01_22-00-09_563408_1598840/artifacts/2024-08-01_22-00-13/train_fnn_2024-08-01_22-00-13/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-01_22-42-17   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_22-42-17
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-01_22-42-13_565395_1598840/artifacts/2024-08-01_22-42-17/train_fnn_2024-08-01_22-42-17/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-01_23-43-07   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_23-43-07
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-01_23-43-03_260133_1598840/artifacts/2024-08-01_23-43-07/train_fnn_2024-08-01_23-43-07/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-02_00-56-52   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_00-56-52
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-02_00-56-48_053334_1598840/artifacts/2024-08-02_00-56-52/train_fnn_2024-08-02_00-56-52/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-02_02-16-54   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_02-16-54
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-02_02-16-50_760108_1598840/artifacts/2024-08-02_02-16-54/train_fnn_2024-08-02_02-16-54/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-02_03-24-34   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_03-24-34
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-02_03-24-29_777916_1598840/artifacts/2024-08-02_03-24-34/train_fnn_2024-08-02_03-24-34/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-02_05-26-09   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_05-26-09
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-02_05-26-05_135284_1598840/artifacts/2024-08-02_05-26-09/train_fnn_2024-08-02_05-26-09/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-02_07-05-22   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_07-05-22
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-02_07-05-17_912778_1598840/artifacts/2024-08-02_07-05-22/train_fnn_2024-08-02_07-05-22/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-02_11-10-54   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_11-10-54
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-02_11-10-50_199790_1598840/artifacts/2024-08-02_11-10-54/train_fnn_2024-08-02_11-10-54/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-02_14-42-13   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_14-42-13
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-02_14-42-08_812439_1598840/artifacts/2024-08-02_14-42-13/train_fnn_2024-08-02_14-42-13/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-02_18-42-10   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_18-42-10
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-02_18-42-05_880609_1598840/artifacts/2024-08-02_18-42-10/train_fnn_2024-08-02_18-42-10/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-02_23-04-13   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_23-04-13
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-02_23-04-08_955437_1598840/artifacts/2024-08-02_23-04-13/train_fnn_2024-08-02_23-04-13/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-03_03-49-43   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-03_03-49-43
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-03_03-49-38_432662_1598840/artifacts/2024-08-03_03-49-43/train_fnn_2024-08-03_03-49-43/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-03_08-11-37   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 150                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-03_08-11-37
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-03_08-11-32_868074_1598840/artifacts/2024-08-03_08-11-37/train_fnn_2024-08-03_08-11-37/driver_artifacts`

INFO:postprocess_predictions.py:Post processing prediction files
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1985.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1986.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1987.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1988.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1989.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1990.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1991.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1992.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1993.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1994.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1995.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1996.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1997.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1998.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1999.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2000.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2001.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2002.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2003.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2004.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2005.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2006.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2007.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2008.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2009.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2010.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2011.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2012.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2013.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2014.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2015.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2016.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2017.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2018.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2019.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2020.csv
INFO:postprocess_predictions.py:Sort the result by date and rank both ascendingly
INFO:postprocess_predictions.py:Saved the result file: result.csv
to the directory: kevin/output/prediction/quarterly_new_restricted
