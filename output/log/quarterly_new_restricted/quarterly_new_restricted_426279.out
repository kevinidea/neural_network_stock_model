Current working directory
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml
source kevin/venv/bin/activate
which python3
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/bin/python3
2024-07-28 16:16:44,051	PANIC scripts.py:900 -- `--address` is a required flag unless starting a head node with `--head`.
Error: `{}` is a required flag unless starting a head node with `{}`.
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
INFO:preprocess_data_nn.py:

Loading and preprocessing data...

DEBUG:preprocess_data_nn.py:          date   permno
626    1980-01  10006.0
5399   1980-01  10057.0
11398  1980-01  10137.0
12828  1980-01  10145.0
13984  1980-01  10153.0
DEBUG:preprocess_data_nn.py:--------------------------------------------------
INFO:main_restricted.py:preprocessed df: (667724, 161)
INFO:preprocess_data_nn.py:

Applying secondary data preprocessing..

INFO:main_restricted.py:secondary preprocessed df: (667724, 161)
INFO:main_restricted.py:df sample:     permno       pdate        ym  gvkey  sic2    absacc       acc    aeavol  ...      roaa      roea   roavola       ret        mve_m      retq  pyear     date
0  10006.0  1980-01-01  198001.0   1010    37  0.083420  0.083420  1.001090  ...  0.048684  0.141715  0.004512  0.211679   303420.750 -0.055806   1980  1980-01
1  10057.0  1980-01-01  198001.0   1098    36  0.088951  0.088951 -0.613146  ...  0.092434  0.174252  0.035698  0.282297   111423.125 -0.069431   1980  1980-01
2  10137.0  1980-01-01  198001.0   1279    49  0.041008  0.041008 -0.491307  ...  0.034895  0.097554  0.006254 -0.032258   617349.500 -0.108065   1980  1980-01
3  10145.0  1980-01-01  198001.0   1300    99  0.050486  0.050486 -0.256932  ...  0.049028  0.122729  0.004320  0.150127  1415193.000 -0.085950   1980  1980-01
4  10153.0  1980-01-01  198001.0   1308    13       NaN       NaN  1.631801  ...  0.049860  0.109950  0.009149 -0.122744   429488.500 -0.285199   1980  1980-01

[5 rows x 161 columns]
INFO:main_restricted.py:Train year start: 1980
INFO:main_restricted.py:Prediction data years: [1986, 1994, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020]
INFO:main_restricted.py:

Loop through all the prediction years and build optimized model for each year

INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984]
INFO:transform_data_nn.py:Train_data: (50727, 161)

INFO:transform_data_nn.py:Test data years: [1985]
INFO:transform_data_nn.py:Test_data: (14870, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Retrain_data: (65597, 161)

INFO:transform_data_nn.py:Prediction data years: [1986]
INFO:transform_data_nn.py:Prediction_data: (15019, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([50727, 138])
            y_train_tf: torch.Size([50727])

            x_test_tf: torch.Size([14870, 138])
            y_test_tf: torch.Size([14870])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([65597, 138])
            y_retrain_tf: torch.Size([65597])

            x_prediction_tf: torch.Size([15019, 138])
            y_prediction_tf: torch.Size([15019])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-0.0067,  0.3197,  0.2194, -1.2141, -0.1261, -0.6221, -0.0984, -0.2873,
         0.1534, -0.1619, -0.7165, -0.2269, -0.4275, -0.1703,  0.1184,  0.6090,
        -0.1475,  0.0881,  0.0000,  0.5182, -0.3056,  0.0932, -0.0394, -0.0072,
        -0.1154, -0.2093, -0.5687,  0.0000,  0.4274,  0.6948,  0.4798, -0.1521,
         0.3766,  0.0000, -0.4196, -0.1835,  0.0896,  0.2648,  0.1857, -1.1756,
        -0.2486, -0.0574,  0.1861, -0.1307, -0.0974, -0.6779, -0.1000, -0.0419,
        -0.6077, -0.2871, -0.6160,  0.6367, -0.1798, -0.2277,  0.0229,  0.4441,
        -0.7671, -0.1410, -0.3106,  0.1864,  0.0977, -0.3876,  0.1515,  0.3127,
         0.2454, -0.0990,  0.1182, -0.0331,  0.6423, -0.4089,  0.0000,  0.0000,
         0.0000, -0.8463, -0.1161,  0.5137,  0.0479, -0.3351, -0.1862, -0.0302,
         0.0000,  0.5091, -0.0908, -0.0771, -0.5431, -0.0656, -0.0515, -0.3883,
        -0.1546,  0.1526, -0.4652, -1.2916,  0.0000,  0.6123,  1.3429,  0.9783,
        -0.2574,  0.5183, -1.6086, -1.0886, -1.3142,  0.3028,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0558, -0.8242,  0.0000, -1.2617, -1.0052, -1.1608,
         0.0832, -0.0920,  0.0000,  0.0000, -0.0071, -0.1319, -0.0436,  0.1436,
         0.2193, -0.4500, -0.4138,  0.0709,  0.2018, -0.4794,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([3633]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-3.5541e-02, -3.1473e-02,  6.9044e+00, -4.8718e-01, -3.7399e-02,
         1.8157e+00,  1.8471e+00,  2.0916e+00, -5.1028e-01, -4.6532e-01,
         1.1642e+00,  1.4917e-02,  2.0411e-01,  2.9692e-02,  7.6405e-03,
        -8.2565e-03, -2.2184e-01, -2.1168e+00,  0.0000e+00, -9.0573e-03,
        -2.3354e-01,  9.3180e-02,  8.9928e-03, -1.8666e-02, -9.8145e-03,
        -2.9154e-01,  2.9385e-02,  0.0000e+00, -1.3687e+00, -9.4795e-01,
         1.4198e+00, -3.8788e-02,  1.4494e-01,  0.0000e+00,  3.3448e+00,
         1.7744e-02,  1.6136e-02, -1.7888e-01, -1.7655e-01,  1.3208e+00,
        -8.3496e-02, -1.4023e+00, -1.4078e-02, -4.2197e-01, -1.9644e-02,
         3.2230e-01, -1.3703e+00,  2.5145e-01, -3.6213e-01, -1.5088e+00,
         2.8064e+00, -1.1100e+00, -9.4838e-02, -2.2774e-01,  7.9354e-01,
         3.3974e-01, -2.1428e-02,  2.3160e-02, -2.2957e-02,  2.9556e-02,
        -8.7836e-03, -2.1470e-02,  3.6345e-02,  4.2058e-02, -9.7462e-03,
         1.5879e-02, -2.3376e-02,  1.6198e-02,  6.4233e-01,  3.8849e-02,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  3.2896e-01,  3.0743e-01,
        -1.4042e-02, -2.0656e-01,  1.2085e+00,  6.9330e+00, -3.0173e-02,
         0.0000e+00,  1.5769e-02, -3.4090e-01, -9.1126e-01, -5.2861e-01,
        -6.6146e-02, -5.1157e-02, -5.5830e-02,  5.6105e-01, -2.3373e-02,
        -4.1076e-01,  1.9687e+00,  0.0000e+00, -6.7487e-01, -3.0891e-01,
        -1.0547e+00, -3.5636e+00, -1.0826e+00,  1.0152e+00, -1.2112e+00,
        -5.3489e-01, -3.4670e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00, -6.0399e-03,  2.0349e-03,  0.0000e+00,  6.4186e-01,
        -1.1317e+00,  9.6608e-01, -4.2225e-03, -9.1975e-02,  0.0000e+00,
         0.0000e+00,  3.1905e-02, -1.0698e-02, -4.3647e-02, -1.5213e-02,
         3.4496e-02,  5.0923e-01,  8.7191e-02,  5.3129e-01,  2.3714e-01,
        -4.0068e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3571]), tensor(0.4426))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.0866e-01,  2.1567e-01,  1.8687e-01, -1.2464e+00, -1.4750e-01,
        -6.0599e-01, -1.1476e-01, -3.0086e-01,  2.0923e-01, -1.6396e-01,
        -7.1105e-01, -1.6450e-01, -4.3970e-01, -9.2192e-02,  9.0120e-02,
         5.5198e-01, -1.4281e-01,  8.2749e-02,  0.0000e+00,  4.3716e-01,
        -3.6548e-01, -2.8282e-01, -1.3577e-03, -7.1517e-04, -1.0327e-01,
        -2.2369e-01, -5.8433e-01,  0.0000e+00,  4.3690e-01,  7.8414e-01,
         4.8983e-01, -1.4383e-01,  3.8715e-01,  0.0000e+00, -4.1197e-01,
        -1.8811e-01,  7.5261e-02,  3.1092e-01,  1.0364e-01, -1.1787e+00,
        -2.5471e-01,  4.8843e-02,  1.3564e-01, -1.0668e-01, -1.4147e-01,
        -6.4896e-01, -3.6768e-02, -2.3174e-03, -6.2742e-01, -2.8325e-01,
        -6.2002e-01,  6.6451e-01, -1.8099e-01, -1.8662e-01,  2.1484e-02,
         4.4240e-01, -7.6693e-01, -1.0270e-01, -2.7572e-01,  1.4888e-01,
         9.8031e-02, -3.4406e-01,  1.6447e-01,  2.9799e-01,  2.0712e-01,
        -9.6412e-02,  6.7037e-02, -5.1608e-02,  6.5689e-01, -4.0800e-01,
         0.0000e+00,  0.0000e+00, -1.5042e-01, -8.0966e-01, -6.3832e-02,
         5.2703e-01,  4.8402e-02, -3.4089e-01, -1.8360e-01, -1.1685e-02,
         0.0000e+00,  3.8418e-01, -4.3338e-02, -1.5994e-01, -5.4566e-01,
        -7.2678e-02, -5.8190e-02, -3.8189e-01, -1.6225e-01,  1.5746e-01,
        -4.7465e-01, -1.2857e+00, -1.7335e+00,  8.5916e-01,  1.5859e+00,
         1.2321e+00,  3.1903e-01,  7.7744e-01, -1.8854e+00, -8.3912e-01,
        -1.1769e+00,  1.9221e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.8057e-02,  4.2140e-02,  0.0000e+00, -1.4389e+00,
        -4.1932e-01, -1.4216e+00,  9.8359e-02, -3.2869e-02,  0.0000e+00,
         0.0000e+00,  1.1453e-02, -1.5504e-01, -6.1259e-02,  1.0941e-01,
         2.4897e-01, -4.3682e-01, -4.0812e-01,  1.0562e-01,  2.0867e-01,
        -3.8885e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4096]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-4.7985e-01, -1.6106e+00, -5.5060e-01, -4.7226e-03,  4.3003e+00,
        -3.5303e-01,  1.3575e+00,  1.3208e+00, -9.6294e-01, -9.4089e-01,
        -3.5415e-03, -1.7267e-01,  2.3447e-01,  5.6794e-01,  2.5223e+00,
        -1.8668e-03, -2.1744e-01, -3.3228e-01,  0.0000e+00, -5.0880e-02,
        -2.8527e-01, -2.8282e-01,  2.4364e-03,  3.5003e-01,  1.5369e+00,
        -9.0415e-01, -2.9426e-01,  0.0000e+00,  9.5529e-02, -8.8314e-01,
         2.8603e-04,  2.4687e-01, -4.5384e-02,  0.0000e+00,  1.1446e+00,
        -1.0048e-02,  2.4348e+00, -2.1209e-01,  7.2558e-02,  7.3454e-01,
        -2.5444e-01, -5.1495e-01,  1.5967e+00, -3.6739e-01,  5.6767e+00,
        -5.8272e-02,  2.4333e+00,  5.6871e-01, -1.0539e+00,  1.2308e+00,
         7.9871e-01, -4.5356e-01, -1.0711e-01, -1.8662e-01,  7.8078e-01,
         2.3879e-01,  2.1691e+00, -7.9302e-02, -2.0149e+00, -1.8340e+00,
         5.3175e-02, -1.7157e+00, -1.0708e+00, -1.6445e+00,  5.1078e-02,
        -8.4687e-01, -8.4636e-01, -2.4089e-01, -9.0968e-03, -6.6790e-01,
         0.0000e+00,  0.0000e+00,  8.1978e+00, -6.6867e-01, -2.6865e-01,
         8.8454e-03, -2.2079e-01,  6.3787e-01,  6.9349e+00, -1.1685e-02,
         0.0000e+00,  2.8331e-01, -6.1461e-01,  1.0987e+00,  1.6332e+00,
        -6.1567e-02, -5.2940e-02, -2.8137e-01, -1.1726e+00,  4.7360e-01,
         1.9134e+00, -7.8598e-01, -1.7335e+00, -1.9806e+00, -2.0008e+00,
        -1.6215e+00, -1.1878e+00, -1.1509e+00,  2.4348e-01, -5.9449e-01,
        -3.1360e-01, -1.6351e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.9270e-02,  1.3996e-01,  0.0000e+00, -7.9850e-02,
        -1.3016e+00,  8.1629e-01, -8.0799e-04, -3.2869e-02,  0.0000e+00,
         0.0000e+00, -1.7570e+00,  1.4390e+00, -6.1259e-02,  1.3578e+00,
        -1.7508e-03, -4.8388e-01, -1.1590e+00, -7.4953e-02,  1.1934e-01,
         4.9949e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3567]), tensor(0.2099))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984]
INFO:main_restricted.py:Testing data year: 1985
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 4249
            device: cpu
            
2024-07-28 16:25:46,409	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-28 16:25:46,463	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-28 16:25:46,525	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_a610388c3ad6b596.zip' (1.43MiB) to Ray cluster...
2024-07-28 16:25:46,533	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_a610388c3ad6b596.zip'.
2024-07-28 16:25:48,107	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-28 16:30:16,651	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_16-25-48' in 0.2569s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 4249, 'embedding_dim': 6, 'dropout_rate': 0.54, 'lr': 3.4419719400899214e-05, 'weight_decay': 0.00016266799643038432, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.047400700161233544
INFO:model_data_nn.py:Best trial testing loss: 0.055226010466274275
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-28_16-25-43_414387_592478/artifacts/2024-07-28_16-25-48/train_fnn_2024-07-28_16-25-48/driver_artifacts/train_fnn_b87f6_00077_77_dropout_rate=0.5400,embedding_dim=6,hidden_dim=5,lr=0.0000,num_layers=5,weight_decay=0.0002_2024-07-28_16-25-48
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 4799, 'embedding_dim': 6, 'dropout_rate': 0.54, 'lr': 3.4419719400899214e-05, 'weight_decay': 0.00016266799643038432, 'num_epochs': 50, 'num_gpus': 0}

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/cuda/__init__.py:619: UserWarning: Can't initialize NVML
  warnings.warn("Can't initialize NVML")
INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.0505700678586436, 'avg_test_loss': 0.0628163098417064}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.049709301834809594, 'avg_test_loss': 0.06301649413368804}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.04956502461936907, 'avg_test_loss': 0.06316235496642741}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.04952555814088555, 'avg_test_loss': 0.06320890976472739}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.049502105508508976, 'avg_test_loss': 0.06323800763075656}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.04947529347373347, 'avg_test_loss': 0.06327669622891761}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.049469332307126024, 'avg_test_loss': 0.0633048228443937}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.04949083640894969, 'avg_test_loss': 0.06330894919786047}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.049487076235891436, 'avg_test_loss': 0.06333157364279032}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.049479223605885636, 'avg_test_loss': 0.0633198975208909}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.04947297902072023, 'avg_test_loss': 0.06332202062724118}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.0494823072986037, 'avg_test_loss': 0.06331916051183609}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.04946666190699034, 'avg_test_loss': 0.06333840339583285}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.049486341180454474, 'avg_test_loss': 0.06334448470634983}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.049475414229164016, 'avg_test_loss': 0.06335448797871458}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.04943533292862412, 'avg_test_loss': 0.06332353278598253}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.04946669556557026, 'avg_test_loss': 0.06334845455799332}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.04942505200779124, 'avg_test_loss': 0.06336926821064441}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.04947232725135109, 'avg_test_loss': 0.06334353378637039}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.04945051249342214, 'avg_test_loss': 0.06337800350119459}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.04946466088949819, 'avg_test_loss': 0.06337388000510474}
INFO:model_data_nn.py:Early stopping at epoch 21
INFO:main_restricted.py:Making prediction for data in year: 1986
INFO:main_restricted.py:Prediction data shape: (15019,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1986: 0.2517765105917302
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  1.501900e+04  15019.000000
mean   2.116020e-02      0.045440
std    2.505653e-01      0.001771
min   -9.375002e-01      0.032975
25%   -1.200001e-01      0.045660
50%    1.000000e-07      0.046200
75%    1.356736e-01      0.046281
max    3.999999e+00      0.046402
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Train_data: (177144, 161)

INFO:transform_data_nn.py:Test data years: [1993]
INFO:transform_data_nn.py:Test_data: (17602, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:transform_data_nn.py:Retrain_data: (194746, 161)

INFO:transform_data_nn.py:Prediction data years: [1994]
INFO:transform_data_nn.py:Prediction_data: (19550, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([177144, 138])
            y_train_tf: torch.Size([177144])

            x_test_tf: torch.Size([17602, 138])
            y_test_tf: torch.Size([17602])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([194746, 138])
            y_retrain_tf: torch.Size([194746])

            x_prediction_tf: torch.Size([19550, 138])
            y_prediction_tf: torch.Size([19550])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.7511e-01,  5.3032e-01,  1.2118e-01, -1.3279e+00, -1.1473e-01,
        -6.6547e-01, -1.7965e-01, -3.5902e-01,  3.0039e-01, -1.6157e-01,
        -7.0364e-01,  1.3287e-02, -4.8032e-01, -2.1689e-01,  9.2752e-02,
         5.1136e-01, -1.2770e-01,  2.0288e-01, -8.6807e-02,  4.6755e-01,
        -3.3014e-01, -3.0899e-03,  1.2939e-02,  1.7989e-02, -5.1916e-02,
        -2.6816e-01, -5.6058e-01, -1.8181e-02,  4.0599e-01,  1.0573e+00,
         4.2291e-01, -9.3946e-02,  4.4649e-01, -2.1402e-02, -3.7431e-01,
        -1.8455e-01,  9.1704e-02,  4.7506e-01,  2.3524e-02, -1.1254e+00,
        -3.0536e-01,  2.8104e-01,  2.7996e-01, -9.3432e-02, -1.5500e-01,
        -6.7113e-01,  8.9885e-02, -3.4669e-02, -4.0734e-01, -1.7358e-01,
        -6.8742e-01,  6.7090e-01, -1.3187e-01, -3.4868e-02,  2.6621e-02,
         4.3297e-01, -7.3884e-01,  5.0399e-02, -2.5586e-01, -3.3450e-02,
         1.2930e-01, -3.1684e-01,  1.3231e-01,  2.5136e-01,  1.2800e-01,
        -1.4296e-01,  2.7904e-01, -8.9100e-02,  7.2144e-01, -4.1733e-01,
        -1.5802e-01, -6.1594e-02, -4.7980e-02, -8.0352e-01,  9.5446e-02,
         6.0000e-01,  2.5124e-02, -3.5209e-01, -1.8562e-01,  6.4939e-04,
        -1.6890e-02,  2.5546e-01,  1.9693e-02, -3.2662e-01, -5.4653e-01,
        -1.1026e-01, -9.2396e-02, -3.3079e-01, -7.5383e-02,  1.6134e-01,
        -5.0113e-01, -1.2592e+00,  2.9665e-03,  1.6367e+00,  1.9011e+00,
         2.0545e+00,  4.0982e-01,  1.6419e+00, -2.5976e+00,  5.4995e-02,
        -9.5135e-01,  1.2901e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0600e-02,  5.5131e-01,  0.0000e+00, -1.1747e+00,
         6.5082e-01, -2.0948e+00,  1.5020e-01,  1.9927e-02,  0.0000e+00,
         0.0000e+00,  1.6984e-02, -1.7085e-01,  2.0595e-02, -7.1156e-02,
         5.0707e-02, -4.4174e-01, -3.5503e-01,  2.4983e-01,  2.6954e-01,
        -4.1798e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([7298]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([ 6.2201e-03,  4.0160e-02, -4.9216e-01,  5.4931e-01,  2.8609e-01,
        -6.0069e-01, -2.2084e+00, -1.0302e+00, -4.7065e-01, -2.4710e-01,
        -1.4308e-02,  4.9625e-03, -3.6213e-02, -3.3412e-02,  2.1304e-02,
        -1.0237e+00, -1.7729e-01,  6.1705e-01,  1.6484e-01,  1.1458e-02,
         7.6160e-01, -7.4634e-02, -2.4968e-02, -3.4868e-01,  1.4408e-01,
        -8.4063e-03, -6.4430e-01, -7.3839e-01, -1.2763e+00,  3.1663e-02,
        -2.8039e-02, -2.1211e-01,  1.8460e-01, -2.1402e-02,  1.1698e-03,
         1.3698e+00,  1.4487e-02, -6.2328e-01,  4.0902e-01, -1.0097e+00,
        -3.1756e-02, -2.4244e-01,  1.2191e-02,  2.9435e-02,  4.8104e-03,
        -5.0599e-01, -2.1340e-01, -1.4904e-01,  3.2076e-01,  5.2773e-01,
         1.6373e+00, -8.3324e-01, -5.9558e-01, -7.2872e-01, -7.3904e-01,
         5.1056e-03, -1.0694e+00, -4.4086e-02, -7.2391e-03,  2.6464e-01,
        -4.8327e-03, -7.3293e-03,  6.8518e-03,  1.0950e-02,  9.3378e-04,
         3.1050e-03,  2.2322e-02,  1.1238e+00,  5.7967e-02, -1.1165e-02,
        -1.5802e-01, -6.1594e-02, -4.7980e-02, -4.3363e-01,  8.7659e-03,
         2.5548e-02,  6.8801e-04, -4.4530e-03,  6.7547e-04,  6.4939e-04,
         1.2073e-01, -4.7145e-01, -3.6522e-01, -1.7265e-01, -5.0460e-01,
        -4.0603e-03, -3.1113e-03,  2.9184e-02,  4.2500e-03,  1.2579e-01,
        -6.3919e-01,  9.8457e-01,  2.9665e-03, -1.3392e+00, -1.5266e+00,
        -9.6352e-01,  1.8288e+00, -1.6627e+00,  1.2169e+00, -1.1459e+00,
        -9.4967e-01,  2.1429e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.3449e-02,  3.4491e-01,  0.0000e+00,  5.3013e-01,
        -2.8294e-02,  4.7908e-01,  1.0045e-01,  1.9927e-02,  0.0000e+00,
         0.0000e+00,  1.3357e-02,  2.3455e-02,  2.0595e-02, -9.1336e-03,
         8.4218e-03,  1.6526e-03, -2.1462e-02,  1.1496e-01,  1.7460e-01,
        -3.3093e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3319]), tensor(0.0291))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.1669,  0.5888,  0.1036, -1.3219, -0.1143, -0.6813, -0.1850, -0.3644,
         0.3208, -0.1635, -0.7034,  0.0227, -0.4865, -0.2572,  0.1009,  0.5067,
        -0.1305,  0.2120, -0.0732,  0.4743, -0.3380,  0.0057,  0.0149,  0.0136,
        -0.0537, -0.2743, -0.5612, -0.0210,  0.3845,  1.0975,  0.4100, -0.0973,
         0.4536, -0.0351, -0.3724, -0.1814,  0.0980,  0.4924,  0.0227, -1.1218,
        -0.3089,  0.2602,  0.2824, -0.0835, -0.1526, -0.6815,  0.0777, -0.0463,
        -0.4050, -0.1860, -0.7059,  0.6565, -0.1252, -0.0294,  0.0189,  0.4337,
        -0.7312,  0.0518, -0.2591, -0.0319,  0.1302, -0.3191,  0.1327,  0.2513,
         0.1271, -0.1443,  0.3185, -0.0992,  0.7069, -0.4184, -0.1927, -0.0776,
        -0.0450, -0.8111,  0.1075,  0.6137,  0.0222, -0.3556, -0.1870,  0.0038,
        -0.0102,  0.2538,  0.0352, -0.3280, -0.5492, -0.1148, -0.0973, -0.3225,
        -0.0634,  0.1735, -0.5036, -1.2598,  0.0066,  1.6984,  1.9427,  2.1325,
         0.2193,  1.6729, -2.6897,  0.1787, -0.8928,  0.1270,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0538,  0.5436,  0.0000, -1.2410,  0.6873, -2.1641,
         0.1521,  0.0133,  0.0000,  0.0000,  0.0265, -0.1685,  0.0193, -0.0752,
         0.0659, -0.4429, -0.3589,  0.2582,  0.2740, -0.4163,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([7881]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-1.0950e+00, -1.5362e-01, -7.1802e-01,  7.1595e-01, -7.3885e-02,
        -4.5583e-01, -2.1670e+00, -9.9111e-01, -5.6359e-01, -3.7633e-01,
        -5.5989e-01,  7.3728e-03,  1.0031e-01,  2.8742e-01, -2.1712e-01,
        -3.9971e-02, -2.1449e-01,  2.2596e-01, -7.3246e-02,  1.8080e-01,
        -1.1654e-01, -7.5538e-02, -3.7054e-01,  1.9298e-01,  9.2301e-02,
        -5.2914e-01, -5.9192e-01, -5.7700e-01, -1.0409e+00,  3.7015e-01,
        -4.2835e-01, -3.7255e-02,  2.4777e-01, -3.5072e-02, -7.3016e-01,
         2.6784e-03,  4.2254e-01, -6.3613e-01, -1.4406e-01, -9.4372e-01,
        -1.0650e-01, -1.9294e-01,  6.3178e-01, -2.7989e-01, -1.4918e-01,
        -1.4076e-01,  1.9851e-01,  6.3793e-01,  3.5250e-01, -6.9402e-02,
         7.0255e-02, -7.0042e-01, -5.8644e-01, -6.7527e-01, -7.3775e-01,
         4.5410e-01, -1.0644e+00,  3.5916e-01, -4.3311e-01,  1.6513e-01,
         3.9582e-01, -5.8113e-01, -3.9604e-01, -8.5332e-01, -2.4208e-03,
        -4.9585e-01, -2.8668e-02,  2.7000e+00,  1.3721e+00, -4.1798e-01,
        -1.9274e-01, -7.7553e-02, -4.5049e-02, -8.9308e-02,  4.3926e-02,
         4.8803e-02, -1.8841e-01, -1.3370e-01, -7.9591e-02,  3.7770e-03,
         1.1047e-01,  1.2347e-01, -3.8610e-01,  1.4558e+00,  4.0162e-01,
        -1.0213e-01, -8.9866e-02, -2.9537e-01, -5.4278e-01,  1.9339e-02,
        -6.3314e-02,  1.4176e-01,  6.5806e-03, -1.4075e+00, -1.1267e+00,
        -1.2399e+00,  1.8304e+00, -1.4574e+00,  7.6483e-01, -1.1369e+00,
        -1.0717e+00,  4.8402e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6488e-02, -5.7104e-02,  0.0000e+00,  4.8339e-01,
        -2.0257e-01,  2.5994e-01,  1.3269e-01,  2.1396e+00,  0.0000e+00,
         0.0000e+00, -5.9865e-01, -1.8242e-01, -3.9370e+00,  7.0672e-01,
        -4.0138e-01, -4.5708e-01, -4.2166e-01,  2.4906e-01,  3.2776e-01,
        -3.5330e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2399]), tensor(-0.0517))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:main_restricted.py:Testing data year: 1993
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 7594
            device: cpu
            
2024-07-28 16:58:57,958	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-28 16:58:58,012	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-28 16:58:58,066	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_e0c50538880e59d3.zip' (1.43MiB) to Ray cluster...
2024-07-28 16:58:58,072	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_e0c50538880e59d3.zip'.
2024-07-28 16:58:59,565	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-28 17:15:23,992	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_16-58-59' in 0.2641s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 3, 'num_embeddings': 7594, 'embedding_dim': 6, 'dropout_rate': 0.53, 'lr': 0.007579479953348002, 'weight_decay': 0.0003142880890840113, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.079958142346511
INFO:model_data_nn.py:Best trial testing loss: 0.09200658710619462
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-28_16-58-54_281711_592478/artifacts/2024-07-28_16-58-59/train_fnn_2024-07-28_16-58-59/driver_artifacts/train_fnn_5b864_00001_1_dropout_rate=0.5300,embedding_dim=6,hidden_dim=35,lr=0.0076,num_layers=3,weight_decay=0.0003_2024-07-28_16-58-59
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 3, 'num_embeddings': 8208, 'embedding_dim': 6, 'dropout_rate': 0.53, 'lr': 0.007579479953348002, 'weight_decay': 0.0003142880890840113, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.08052645101628948, 'avg_test_loss': 0.06245526944110596}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.08058607385400132, 'avg_test_loss': 0.0626771688716961}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.081044720702564, 'avg_test_loss': 0.06339038633041424}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.0810904997265619, 'avg_test_loss': 0.06439894379049636}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.08104539593837219, 'avg_test_loss': 0.06275164581579613}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.08107818565763078, 'avg_test_loss': 0.0629838213501072}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.08108923136318479, 'avg_test_loss': 0.06357894840291123}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.08108888723918731, 'avg_test_loss': 0.06315491899689721}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.08107288432706154, 'avg_test_loss': 0.0642355409134301}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.08107770983935539, 'avg_test_loss': 0.0628974494597345}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.08109344131289384, 'avg_test_loss': 0.06269611540597443}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.08107329891378612, 'avg_test_loss': 0.06457957020942487}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.08107926695987847, 'avg_test_loss': 0.06337065379640539}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.08110387192060589, 'avg_test_loss': 0.0645621867144322}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.08105420726023854, 'avg_test_loss': 0.06335027801372062}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.08106230042769495, 'avg_test_loss': 0.062003385044293466}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.08107282075832581, 'avg_test_loss': 0.06360987795127276}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.08105607094570141, 'avg_test_loss': 0.062442333674898334}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.08106729336190702, 'avg_test_loss': 0.06174661197206553}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.08107817784150148, 'avg_test_loss': 0.06519983271806458}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.0810827187940302, 'avg_test_loss': 0.06413099216601623}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.0810496575700549, 'avg_test_loss': 0.06445122155013915}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.08107188281056366, 'avg_test_loss': 0.06256819941906952}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.08106387516558367, 'avg_test_loss': 0.06434090114107319}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.08108452128774238, 'avg_test_loss': 0.06241153773784735}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.08108258103237859, 'avg_test_loss': 0.06226169662489221}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.08107522879662893, 'avg_test_loss': 0.06413954399903518}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.08108133281642947, 'avg_test_loss': 0.06314796946784543}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.08109012750797293, 'avg_test_loss': 0.06241247299875991}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.08108595830622882, 'avg_test_loss': 0.06544099614523302}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.08108668143014172, 'avg_test_loss': 0.06483745413643667}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.08105939167890304, 'avg_test_loss': 0.06544764874064747}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.08104774218302448, 'avg_test_loss': 0.0643687848202592}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.08104401869720178, 'avg_test_loss': 0.06400344005840666}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.08106381394872827, 'avg_test_loss': 0.06293540470472543}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.08108192623117148, 'avg_test_loss': 0.06579786875388688}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.08106641540576916, 'avg_test_loss': 0.0646129876825642}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.08108673988731871, 'avg_test_loss': 0.062306872967728015}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.08102957479702279, 'avg_test_loss': 0.06328598282366894}
INFO:model_data_nn.py:Early stopping at epoch 39
INFO:main_restricted.py:Making prediction for data in year: 1994
INFO:main_restricted.py:Prediction data shape: (19550,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1994: 0.25118814129553646
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  19550.000000  19550.000000
mean      -0.009021      0.038349
std        0.246687      0.000000
min       -0.941176      0.038349
25%       -0.125000      0.038349
50%       -0.014632      0.038349
75%        0.082227      0.038349
max        6.294121      0.038349
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:transform_data_nn.py:Train_data: (214296, 161)

INFO:transform_data_nn.py:Test data years: [1995]
INFO:transform_data_nn.py:Test_data: (22259, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:transform_data_nn.py:Retrain_data: (236555, 161)

INFO:transform_data_nn.py:Prediction data years: [1996]
INFO:transform_data_nn.py:Prediction_data: (22619, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([214296, 138])
            y_train_tf: torch.Size([214296])

            x_test_tf: torch.Size([22259, 138])
            y_test_tf: torch.Size([22259])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([236555, 138])
            y_retrain_tf: torch.Size([236555])

            x_prediction_tf: torch.Size([22619, 138])
            y_prediction_tf: torch.Size([22619])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.6138e-01,  6.3450e-01,  9.6981e-02, -1.3080e+00, -1.1959e-01,
        -6.9455e-01, -1.8408e-01, -3.6603e-01,  3.4602e-01, -1.6517e-01,
        -7.0044e-01,  3.5450e-02, -4.9125e-01, -2.8845e-01,  1.0510e-01,
         5.0456e-01, -1.3299e-01,  2.2204e-01, -6.2827e-02,  4.7706e-01,
        -3.3099e-01,  1.1276e-02,  6.6511e-03,  8.8014e-03, -5.7867e-02,
        -2.7626e-01, -5.6481e-01, -1.7767e-02,  3.6237e-01,  1.1400e+00,
         4.0725e-01, -1.0241e-01,  4.6180e-01, -2.9825e-02, -3.6021e-01,
        -1.8733e-01,  9.5078e-02,  5.2221e-01,  1.4196e-02, -1.1223e+00,
        -3.1014e-01,  2.8018e-01,  2.7811e-01, -7.3863e-02, -1.5659e-01,
        -6.8839e-01,  8.3863e-02, -3.2747e-02, -4.1685e-01, -1.7848e-01,
        -7.2196e-01,  6.4307e-01, -1.2036e-01, -2.1798e-02,  1.4097e-02,
         4.3111e-01, -7.2384e-01,  6.8795e-02, -2.5934e-01, -3.0069e-02,
         1.2961e-01, -3.1864e-01,  1.3157e-01,  2.5408e-01,  1.2160e-01,
        -1.4858e-01,  3.4747e-01, -1.0941e-01,  6.8888e-01, -4.1828e-01,
        -2.1984e-01, -3.1756e-02, -4.4639e-02, -8.1988e-01,  1.2150e-01,
         6.2742e-01,  2.0417e-02, -3.5962e-01, -1.8665e-01,  6.7417e-03,
        -1.1077e-03,  2.4425e-01,  5.6884e-02, -3.2948e-01, -5.5073e-01,
        -1.1984e-01, -1.0287e-01, -3.1502e-01, -4.3851e-02,  1.7717e-01,
        -5.0642e-01, -1.2600e+00,  1.0965e-02,  1.7803e+00,  2.0508e+00,
         2.2045e+00,  8.3752e-02,  1.7561e+00, -2.8150e+00,  2.9148e-01,
        -8.5039e-01,  1.2211e-01,  0.0000e+00, -1.0546e+00,  0.0000e+00,
         1.5404e+00,  5.2180e-02,  6.0691e-01,  0.0000e+00, -1.3295e+00,
         7.3676e-01, -2.2904e+00,  1.5304e-01,  1.7361e-02,  0.0000e+00,
        -3.9607e-01,  4.4101e-02, -1.6949e-01,  3.3249e-02, -8.2228e-02,
         8.3000e-02, -4.3063e-01, -3.5525e-01,  2.6693e-01,  2.7907e-01,
        -4.1393e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([8820]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-4.8294e-01, -5.4073e-01, -7.6601e-01,  8.6777e-01, -3.0059e-01,
        -2.2299e-01, -1.5585e+00, -9.6941e-01, -4.3036e-01, -3.6043e-01,
        -6.6956e-01,  6.8434e-03, -5.5438e-03,  5.4760e-01, -7.4776e-02,
        -4.6272e-01, -1.7317e-01,  4.1447e-01, -6.2827e-02, -7.4029e-02,
         2.4118e-03, -6.9747e-02, -1.4708e-01, -2.2730e-01, -5.5682e-02,
        -5.5428e-01, -5.8687e-01, -1.7767e-02, -1.3436e+00,  6.6675e-01,
        -3.2284e-02, -1.1997e-01,  2.4504e-01, -2.9825e-02, -7.5459e-01,
        -7.5051e-04,  2.6271e-02, -6.3358e-01,  3.1237e-01, -8.3944e-01,
         2.2254e-01, -1.1148e+00,  9.9344e-02, -2.4154e-01, -3.0358e-01,
        -3.9225e-01, -3.8217e-01, -2.8421e-01,  4.2144e-02, -2.4167e-01,
         1.5758e+00, -7.7319e-01, -4.8150e-01, -6.3692e-01, -7.3569e-01,
         3.6909e-01, -1.0605e+00,  1.0941e-01, -3.3120e-01, -2.1883e-01,
         1.1599e-01, -4.1932e-01, -1.9770e-01,  2.1818e-01, -2.3513e-03,
        -4.2883e-01, -2.6993e-01,  6.9062e-01,  1.3538e+00, -4.6101e-01,
        -2.1984e-01, -3.1756e-02, -4.4639e-02, -8.4792e-02,  3.8531e-02,
        -3.0587e-01, -1.0111e-01, -1.8760e-01, -5.2785e-02,  6.7417e-03,
        -1.1077e-03, -5.0326e-01, -3.4607e-01, -4.9446e-01, -6.5240e-01,
        -1.0350e-01, -9.3501e-02, -3.2932e-01, -6.4154e-01,  1.1695e-01,
        -7.0328e-01,  5.0377e-01,  1.0965e-02, -9.9174e-01, -5.9269e-02,
        -1.1645e+00,  3.5015e-01, -4.5817e-01, -6.3622e-03, -1.2639e+00,
        -6.3468e-01, -2.5567e-01,  0.0000e+00, -1.0546e+00,  0.0000e+00,
         1.5404e+00,  2.0201e-02, -1.3220e-01,  0.0000e+00, -1.8752e-01,
        -4.9769e-01,  8.6243e-01,  1.3005e-01,  7.6998e-01,  0.0000e+00,
        -3.9607e-01, -4.5139e-01, -1.9572e-01, -3.8074e+00,  7.7426e-01,
         2.9990e-01, -5.2928e-01, -4.7617e-01,  2.0270e-01,  2.6195e-01,
        -3.6208e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2615]), tensor(-0.0506))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.5465e-01,  6.6885e-01,  8.5476e-02, -1.2872e+00, -1.2682e-01,
        -7.0710e-01, -1.7775e-01, -3.6445e-01,  3.6850e-01, -1.7035e-01,
        -6.9521e-01,  4.6163e-02, -4.8957e-01, -3.1484e-01,  1.0988e-01,
         5.0111e-01, -1.3360e-01,  2.3042e-01, -5.9369e-02,  4.7335e-01,
        -3.5575e-01,  6.9554e-03, -1.5421e-02,  1.9538e-03, -5.8418e-02,
        -2.7375e-01, -5.7194e-01, -1.5993e-02,  3.4099e-01,  1.1822e+00,
         4.0172e-01, -1.0509e-01,  4.6804e-01, -2.7462e-02, -3.4340e-01,
        -1.9804e-01,  8.5568e-02,  5.5779e-01,  3.2951e-03, -1.1233e+00,
        -3.1047e-01,  3.0597e-01,  2.6816e-01, -7.1363e-02, -1.6457e-01,
        -6.9600e-01,  9.3016e-02, -4.4227e-02, -4.1794e-01, -1.8607e-01,
        -7.3816e-01,  6.3137e-01, -1.1456e-01, -1.6210e-02,  2.6085e-03,
         4.2819e-01, -7.1177e-01,  7.6150e-02, -2.5529e-01, -2.0217e-02,
         1.2886e-01, -3.1347e-01,  1.3228e-01,  2.5872e-01,  1.1666e-01,
        -1.5427e-01,  3.6959e-01, -1.1485e-01,  6.7589e-01, -4.1543e-01,
        -2.3957e-01, -4.1940e-02, -8.1201e-03, -8.2637e-01,  1.3267e-01,
         6.3311e-01,  1.7659e-02, -3.6415e-01, -1.8467e-01,  6.6376e-03,
        -2.0541e-03,  2.3300e-01,  7.8207e-02, -3.3225e-01, -5.5213e-01,
        -1.2473e-01, -1.0838e-01, -3.0840e-01, -2.1037e-02,  1.7360e-01,
        -5.0841e-01, -1.2612e+00,  1.2012e-02,  1.8212e+00,  2.1685e+00,
         2.2888e+00,  7.5983e-02,  1.8721e+00, -2.8702e+00,  4.0568e-01,
        -7.9586e-01,  1.1003e-01,  7.1534e-01,  1.9921e-01, -2.0874e-01,
         2.9136e-01,  4.8129e-02,  4.9181e-01,  0.0000e+00, -1.3169e+00,
         8.2750e-01, -2.4208e+00,  1.5395e-01,  3.5656e-02,  0.0000e+00,
        -1.1729e-01,  7.0280e-02, -1.7483e-01,  1.7692e-02, -9.2213e-02,
         9.6501e-02, -4.1147e-01, -3.4738e-01,  2.7235e-01,  2.8255e-01,
        -4.1445e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([9650]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.4706e-01, -5.8692e-01, -5.1251e-01,  1.0123e+00, -8.8275e-02,
        -1.8575e-01, -6.2726e-01, -6.5006e-01, -4.6369e-01, -4.1597e-01,
        -7.1277e-01,  2.3876e-02, -1.2728e-01,  5.5995e-01,  1.4051e-01,
         6.9417e-02, -2.1466e-01,  3.2960e-01, -1.8060e-01,  1.3972e-01,
         2.0362e-01, -6.4095e-02, -2.0622e-02, -2.2984e-01,  8.8198e-02,
        -5.9688e-01, -6.0876e-01, -1.5993e-02, -1.2960e+00,  5.8608e-01,
        -4.4832e-01, -6.6236e-02,  2.4729e-01, -2.7462e-02, -7.3220e-01,
        -5.9738e-02,  2.4769e-01, -6.3787e-01, -6.7517e-02, -8.8688e-01,
        -1.0564e-03,  1.8863e-01,  2.6198e-01, -2.5534e-01, -1.5373e-01,
         2.0762e-01, -9.4873e-03,  5.7696e-01, -1.2216e-01,  2.9324e-02,
         1.5413e+00, -6.9475e-01, -5.9335e-01, -6.0518e-01, -7.3726e-01,
         3.9733e-01, -1.0525e+00,  3.6123e-01, -5.0060e-01, -3.7416e-01,
         1.0904e-01, -5.2580e-01, -2.1244e-01,  6.7539e-02, -3.0935e-03,
        -4.0521e-01, -2.7154e-01, -5.1469e-02,  1.3419e+00, -5.0704e-01,
        -2.3957e-01, -4.1940e-02, -8.1201e-03,  8.1635e-02,  5.7545e-02,
        -8.2888e-02,  8.5503e-02, -2.2786e-01, -5.5072e-02,  6.6376e-03,
         1.2189e-01, -6.5599e-02, -3.4642e-01,  1.1322e+00, -4.0199e-01,
        -1.0438e-01, -9.7048e-02, -3.5142e-01, -5.6331e-01,  2.5259e-01,
        -5.2920e-01, -6.4311e-01,  1.2012e-02, -1.8836e+00, -6.2020e-01,
        -1.2011e+00,  3.0616e-01, -5.9280e-01, -9.7377e-01, -1.0392e+00,
        -4.6702e-01,  9.3573e-02,  7.1534e-01, -3.6527e+00, -2.0874e-01,
         5.5889e+00,  2.1032e-02,  7.4366e-01,  0.0000e+00, -3.4124e-01,
        -8.1074e-01,  4.4621e-01,  1.3354e-01,  1.2521e+00,  0.0000e+00,
        -1.1729e-01, -3.9310e-01, -1.5445e-01, -3.7710e+00,  7.2779e-01,
         5.2095e-02, -4.8817e-01, -5.1235e-01,  2.2483e-01,  2.8419e-01,
        -3.8822e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2691]), tensor(0.0223))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:main_restricted.py:Testing data year: 1995
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 9180
            device: cpu
            
2024-07-28 17:57:36,723	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-28 17:57:36,770	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-28 17:57:36,813	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_e0c50538880e59d3.zip' (1.43MiB) to Ray cluster...
2024-07-28 17:57:36,819	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_e0c50538880e59d3.zip'.
2024-07-28 17:57:38,447	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-28 18:22:08,528	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_17-57-38' in 0.2508s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 3, 'num_embeddings': 9180, 'embedding_dim': 6, 'dropout_rate': 0.53, 'lr': 0.007579479953348002, 'weight_decay': 0.0003142880890840113, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07942900043637398
INFO:model_data_nn.py:Best trial testing loss: 0.0830491871423163
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-28_17-57-33_011767_592478/artifacts/2024-07-28_17-57-38/train_fnn_2024-07-28_17-57-38/driver_artifacts/train_fnn_8cf10_00001_1_dropout_rate=0.5300,embedding_dim=6,hidden_dim=35,lr=0.0076,num_layers=3,weight_decay=0.0003_2024-07-28_17-57-38
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 3, 'num_embeddings': 10061, 'embedding_dim': 6, 'dropout_rate': 0.53, 'lr': 0.007579479953348002, 'weight_decay': 0.0003142880890840113, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.07969781284641829, 'avg_test_loss': 0.08408585770613393}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.07983362403228572, 'avg_test_loss': 0.08409354379032291}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.07985800859373209, 'avg_test_loss': 0.08374981923386624}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.07983505508652787, 'avg_test_loss': 0.08423615206232936}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.07986971133920763, 'avg_test_loss': 0.0838686210882066}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.07984675944921887, 'avg_test_loss': 0.08389105415760965}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.07986601096985144, 'avg_test_loss': 0.0839556425252119}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.07982017158568953, 'avg_test_loss': 0.08375148159730653}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.07986618803654802, 'avg_test_loss': 0.08379007216364061}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.07985258633794981, 'avg_test_loss': 0.08375194165750412}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.07987188226069643, 'avg_test_loss': 0.08403957646740022}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.07984314272351546, 'avg_test_loss': 0.0837622454658277}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.07983768419856488, 'avg_test_loss': 0.08377931125483103}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.07985611398224578, 'avg_test_loss': 0.08426064237857521}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.07983630252608957, 'avg_test_loss': 0.08450271347064083}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.07983866501025033, 'avg_test_loss': 0.08378332225858408}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.07987239880757446, 'avg_test_loss': 0.08381389753661503}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.07984314647299597, 'avg_test_loss': 0.08384828005870015}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.07984849574342692, 'avg_test_loss': 0.08429295955341583}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.07983356727452473, 'avg_test_loss': 0.08375121305280991}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.07985337370214379, 'avg_test_loss': 0.08387260916406068}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.07984816851910784, 'avg_test_loss': 0.08393510959063799}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.0798551362830323, 'avg_test_loss': 0.08398803495565209}
INFO:model_data_nn.py:Early stopping at epoch 23
INFO:main_restricted.py:Making prediction for data in year: 1996
INFO:main_restricted.py:Prediction data shape: (22619,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1996: 0.2897448390335412
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  22619.000000  22619.000000
mean       0.044741      0.029183
std        0.289333      0.000000
min       -0.961538      0.029183
25%       -0.085714      0.029183
50%        0.018182      0.029183
75%        0.140416      0.029183
max       10.111111      0.029183
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:transform_data_nn.py:Train_data: (236555, 161)

INFO:transform_data_nn.py:Test data years: [1996]
INFO:transform_data_nn.py:Test_data: (22619, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:transform_data_nn.py:Retrain_data: (259174, 161)

INFO:transform_data_nn.py:Prediction data years: [1997]
INFO:transform_data_nn.py:Prediction_data: (23999, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([236555, 138])
            y_train_tf: torch.Size([236555])

            x_test_tf: torch.Size([22619, 138])
            y_test_tf: torch.Size([22619])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([259174, 138])
            y_retrain_tf: torch.Size([259174])

            x_prediction_tf: torch.Size([23999, 138])
            y_prediction_tf: torch.Size([23999])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.5465e-01,  6.6885e-01,  8.5476e-02, -1.2872e+00, -1.2682e-01,
        -7.0710e-01, -1.7775e-01, -3.6445e-01,  3.6850e-01, -1.7035e-01,
        -6.9521e-01,  4.6163e-02, -4.8957e-01, -3.1484e-01,  1.0988e-01,
         5.0111e-01, -1.3360e-01,  2.3042e-01, -5.9369e-02,  4.7335e-01,
        -3.5575e-01,  6.9554e-03, -1.5421e-02,  1.9538e-03, -5.8418e-02,
        -2.7375e-01, -5.7194e-01, -1.5993e-02,  3.4099e-01,  1.1822e+00,
         4.0172e-01, -1.0509e-01,  4.6804e-01, -2.7462e-02, -3.4340e-01,
        -1.9804e-01,  8.5568e-02,  5.5779e-01,  3.2951e-03, -1.1233e+00,
        -3.1047e-01,  3.0597e-01,  2.6816e-01, -7.1363e-02, -1.6457e-01,
        -6.9600e-01,  9.3016e-02, -4.4227e-02, -4.1794e-01, -1.8607e-01,
        -7.3816e-01,  6.3137e-01, -1.1456e-01, -1.6210e-02,  2.6085e-03,
         4.2819e-01, -7.1177e-01,  7.6150e-02, -2.5529e-01, -2.0217e-02,
         1.2886e-01, -3.1347e-01,  1.3228e-01,  2.5872e-01,  1.1666e-01,
        -1.5427e-01,  3.6959e-01, -1.1485e-01,  6.7589e-01, -4.1543e-01,
        -2.3957e-01, -4.1940e-02, -8.1201e-03, -8.2637e-01,  1.3267e-01,
         6.3311e-01,  1.7659e-02, -3.6415e-01, -1.8467e-01,  6.6376e-03,
        -2.0541e-03,  2.3300e-01,  7.8207e-02, -3.3225e-01, -5.5213e-01,
        -1.2473e-01, -1.0838e-01, -3.0840e-01, -2.1037e-02,  1.7360e-01,
        -5.0841e-01, -1.2612e+00,  1.2012e-02,  1.8212e+00,  2.1685e+00,
         2.2888e+00,  7.5983e-02,  1.8721e+00, -2.8702e+00,  4.0568e-01,
        -7.9586e-01,  1.1003e-01,  7.1534e-01,  1.9921e-01, -2.0874e-01,
         2.9136e-01,  4.8129e-02,  4.9181e-01,  0.0000e+00, -1.3169e+00,
         8.2750e-01, -2.4208e+00,  1.5395e-01,  3.5656e-02,  0.0000e+00,
        -1.1729e-01,  7.0280e-02, -1.7483e-01,  1.7692e-02, -9.2213e-02,
         9.6501e-02, -4.1147e-01, -3.4738e-01,  2.7235e-01,  2.8255e-01,
        -4.1445e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([9650]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-3.4706e-01, -5.8692e-01, -5.1251e-01,  1.0123e+00, -8.8275e-02,
        -1.8575e-01, -6.2726e-01, -6.5006e-01, -4.6369e-01, -4.1597e-01,
        -7.1277e-01,  2.3876e-02, -1.2728e-01,  5.5995e-01,  1.4051e-01,
         6.9417e-02, -2.1466e-01,  3.2960e-01, -1.8060e-01,  1.3972e-01,
         2.0362e-01, -6.4095e-02, -2.0622e-02, -2.2984e-01,  8.8198e-02,
        -5.9688e-01, -6.0876e-01, -1.5993e-02, -1.2960e+00,  5.8608e-01,
        -4.4832e-01, -6.6236e-02,  2.4729e-01, -2.7462e-02, -7.3220e-01,
        -5.9738e-02,  2.4769e-01, -6.3787e-01, -6.7517e-02, -8.8688e-01,
        -1.0564e-03,  1.8863e-01,  2.6198e-01, -2.5534e-01, -1.5373e-01,
         2.0762e-01, -9.4873e-03,  5.7696e-01, -1.2216e-01,  2.9324e-02,
         1.5413e+00, -6.9475e-01, -5.9335e-01, -6.0518e-01, -7.3726e-01,
         3.9733e-01, -1.0525e+00,  3.6123e-01, -5.0060e-01, -3.7416e-01,
         1.0904e-01, -5.2580e-01, -2.1244e-01,  6.7539e-02, -3.0935e-03,
        -4.0521e-01, -2.7154e-01, -5.1469e-02,  1.3419e+00, -5.0704e-01,
        -2.3957e-01, -4.1940e-02, -8.1201e-03,  8.1635e-02,  5.7545e-02,
        -8.2888e-02,  8.5503e-02, -2.2786e-01, -5.5072e-02,  6.6376e-03,
         1.2189e-01, -6.5599e-02, -3.4642e-01,  1.1322e+00, -4.0199e-01,
        -1.0438e-01, -9.7048e-02, -3.5142e-01, -5.6331e-01,  2.5259e-01,
        -5.2920e-01, -6.4311e-01,  1.2012e-02, -1.8836e+00, -6.2020e-01,
        -1.2011e+00,  3.0616e-01, -5.9280e-01, -9.7377e-01, -1.0392e+00,
        -4.6702e-01,  9.3573e-02,  7.1534e-01, -3.6527e+00, -2.0874e-01,
         5.5889e+00,  2.1032e-02,  7.4366e-01,  0.0000e+00, -3.4124e-01,
        -8.1074e-01,  4.4621e-01,  1.3354e-01,  1.2521e+00,  0.0000e+00,
        -1.1729e-01, -3.9310e-01, -1.5445e-01, -3.7710e+00,  7.2779e-01,
         5.2095e-02, -4.8817e-01, -5.1235e-01,  2.2483e-01,  2.8419e-01,
        -3.8822e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2691]), tensor(0.0223))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.4880e-01,  6.9521e-01,  7.9073e-02, -1.2731e+00, -1.3749e-01,
        -7.1969e-01, -1.7195e-01, -3.6190e-01,  3.9376e-01, -1.7017e-01,
        -6.9037e-01,  5.3550e-02, -4.9331e-01, -3.3738e-01,  1.1412e-01,
         5.0071e-01, -1.3906e-01,  2.3610e-01, -4.8212e-02,  4.7460e-01,
        -3.4819e-01,  1.5372e-02, -3.9827e-02,  1.2964e-04, -5.6493e-02,
        -2.7282e-01, -5.7808e-01, -2.0449e-02,  3.1053e-01,  1.2282e+00,
         3.9251e-01, -1.1274e-01,  4.7515e-01, -3.3248e-02, -3.2932e-01,
        -2.0729e-01,  8.0102e-02,  5.8961e-01, -7.0135e-03, -1.1219e+00,
        -3.0714e-01,  2.6452e-01,  2.6121e-01, -6.4193e-02, -1.6986e-01,
        -7.0253e-01,  7.4020e-02, -4.5559e-02, -4.0965e-01, -1.9228e-01,
        -7.4970e-01,  6.1298e-01, -1.0643e-01, -1.4157e-02, -8.2136e-03,
         4.2601e-01, -6.9788e-01,  7.6248e-02, -2.5865e-01, -1.6434e-02,
         1.3006e-01, -3.1513e-01,  1.3385e-01,  2.5961e-01,  1.0734e-01,
        -1.5899e-01,  3.8703e-01, -1.2239e-01,  6.7389e-01, -4.1416e-01,
        -2.5506e-01, -5.0796e-02,  1.4470e-03, -8.3424e-01,  1.4112e-01,
         6.4460e-01,  1.5110e-02, -3.6804e-01, -1.8318e-01,  5.6013e-03,
        -1.8051e-03,  2.2095e-01,  9.8807e-02, -3.2572e-01, -5.5546e-01,
        -1.2895e-01, -1.1314e-01, -3.0071e-01, -3.5542e-03,  1.7228e-01,
        -5.1372e-01, -1.2628e+00,  1.4299e-02,  1.7954e+00,  2.2832e+00,
         2.3517e+00,  2.2862e-02,  1.9832e+00, -2.9241e+00,  4.9539e-01,
        -7.8563e-01,  1.0158e-01, -5.3760e-01,  7.9158e-02,  3.8423e-01,
         1.8522e-01,  4.8789e-02,  4.3421e-01,  0.0000e+00, -1.3807e+00,
         8.8076e-01, -2.5454e+00,  1.5510e-01,  2.4301e-02,  0.0000e+00,
        -5.9034e-02,  9.6087e-02, -1.7846e-01,  2.8494e-02, -1.0019e-01,
         1.0179e-01, -3.9550e-01, -3.4418e-01,  2.7712e-01,  2.8553e-01,
        -4.1652e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([10219]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-8.5434e-01,  1.5356e-01,  2.0732e-01,  1.1448e+00, -8.4316e-02,
        -4.7100e-01, -6.1442e-01, -6.4004e-01, -3.1435e-01, -2.9830e-01,
        -7.4604e-01,  1.2911e-02, -2.1747e+00,  8.2419e-02, -4.1931e-01,
        -4.5306e-01, -1.8767e-01, -1.3225e-01,  7.9684e-02, -7.1321e-03,
         3.2981e-01, -6.0564e-02, -1.3137e-01, -2.3293e-01,  5.4243e-02,
        -5.9473e-01, -6.2350e-01, -5.4848e-01, -8.9352e-01,  8.8011e-01,
        -4.3661e-01, -1.2415e-01,  2.4384e-01, -2.4274e+00, -7.7629e-01,
        -1.1264e-01,  4.8749e-02, -6.3743e-01, -2.5934e-01, -8.7099e-01,
         9.1009e-02, -1.3482e-01,  2.8138e-01, -1.8172e-01, -1.2515e-01,
        -1.6322e-01, -3.3947e-01, -4.8949e-01, -2.5839e-01,  1.2283e-01,
         1.5612e-02, -7.6832e-01, -5.8544e-01, -5.8243e-01, -7.3674e-01,
         2.8582e-01, -1.0422e+00,  1.0387e-01, -2.0648e-01, -3.5042e-01,
         5.7477e-02, -1.6340e-01, -1.1582e-01, -6.6688e-02, -3.1892e-03,
        -3.5912e-01,  1.6965e-01, -6.0161e-01,  6.4383e-03, -5.0308e-01,
        -2.5506e-01, -5.0796e-02,  1.4470e-03,  4.1342e-01,  5.0155e-02,
         3.8097e-02,  1.1700e+00, -2.6240e-01, -9.8077e-02,  5.6013e-03,
         1.1876e-01, -3.0161e-01, -2.7645e-01,  1.6201e-03, -5.0708e-01,
        -1.1001e-01, -1.0270e-01, -3.6406e-01, -6.1253e-01,  2.2928e-02,
        -5.5082e-01, -9.6781e-01,  1.4299e-02, -1.9548e+00, -7.3393e-01,
        -1.2708e+00,  6.6421e-01, -6.3947e-01, -3.1675e-01, -9.0903e-01,
         4.1027e-01,  9.7794e-02, -5.3760e-01, -2.9017e+00,  3.8423e-01,
         4.3736e+00,  1.5561e-02, -3.2619e-01,  0.0000e+00,  7.6622e-01,
         5.7234e-01,  9.8142e-01,  1.2886e-01,  6.8689e-01,  0.0000e+00,
        -5.9034e-02, -2.7421e-01, -1.7482e-01, -3.7708e+00,  7.8676e-01,
        -7.5419e-01, -5.5688e-01, -5.5884e-01,  1.7163e-01,  2.3172e-01,
        -4.0256e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2861]), tensor(0.0745))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:main_restricted.py:Testing data year: 1996
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 10061
            device: cpu
            
2024-07-28 19:04:31,820	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-28 19:04:31,878	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-28 19:04:31,922	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip' (1.43MiB) to Ray cluster...
2024-07-28 19:04:31,930	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip'.
2024-07-28 19:04:33,571	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-28 19:36:22,507	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_19-04-33' in 0.2549s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 155, 'num_layers': 5, 'num_embeddings': 10061, 'embedding_dim': 3, 'dropout_rate': 0.44, 'lr': 0.00035500125258511626, 'weight_decay': 0.00045881565491609754, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07080861777510672
INFO:model_data_nn.py:Best trial testing loss: 0.08276755082299986
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-28_19-04-29_096764_592478/artifacts/2024-07-28_19-04-33/train_fnn_2024-07-28_19-04-33/driver_artifacts/train_fnn_e6245_00012_12_dropout_rate=0.4400,embedding_dim=3,hidden_dim=155,lr=0.0004,num_layers=5,weight_decay=0.0005_2024-07-28_19-04-33
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 155, 'num_layers': 5, 'num_embeddings': 10656, 'embedding_dim': 3, 'dropout_rate': 0.44, 'lr': 0.00035500125258511626, 'weight_decay': 0.00045881565491609754, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.07910416654968268, 'avg_test_loss': 0.10316497818132242}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.07421659475027279, 'avg_test_loss': 0.10076048845549425}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.07290017963280115, 'avg_test_loss': 0.09986112642288208}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.07254050329288941, 'avg_test_loss': 0.10112669267257055}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.07228460571013076, 'avg_test_loss': 0.1010252601057291}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.07217948983045501, 'avg_test_loss': 0.10367007364829381}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.07209755947169816, 'avg_test_loss': 0.10103564390540123}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.07213418148540808, 'avg_test_loss': 0.09984252840280533}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.07206584617843316, 'avg_test_loss': 0.1012355927626292}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.07196408934674092, 'avg_test_loss': 0.10546824505676826}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.07209692110516136, 'avg_test_loss': 0.10193642572065194}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.07203984801457616, 'avg_test_loss': 0.10212390945851803}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.07199716738984817, 'avg_test_loss': 0.10587809176743031}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.07212152603942837, 'avg_test_loss': 0.10168681553006172}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.07229180040496254, 'avg_test_loss': 0.10235509740312894}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.07201845042782894, 'avg_test_loss': 0.10398395970960458}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.07209150930261665, 'avg_test_loss': 0.09999653915564219}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.07216299482372608, 'avg_test_loss': 0.10067723800241947}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.07225576538024905, 'avg_test_loss': 0.10137295380234718}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.07202737629192792, 'avg_test_loss': 0.10304586033026378}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.0721212650938376, 'avg_test_loss': 0.10168398360908032}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.07205878836064832, 'avg_test_loss': 0.10094068285822869}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.0722469498892608, 'avg_test_loss': 0.10595116355021794}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.07216268229174316, 'avg_test_loss': 0.10272080321113268}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.07227599623211227, 'avg_test_loss': 0.10032020473480224}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.07219466040861786, 'avg_test_loss': 0.10443380792935689}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.07220573488932962, 'avg_test_loss': 0.10375733354687691}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.07219629566799081, 'avg_test_loss': 0.10491381886104743}
INFO:model_data_nn.py:Early stopping at epoch 28
INFO:main_restricted.py:Making prediction for data in year: 1997
INFO:main_restricted.py:Prediction data shape: (23999,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1997: 0.3239067995271374
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  23999.000000  23999.000000
mean       0.055567     -0.021864
std        0.312191      0.088144
min       -0.982955     -0.572017
25%       -0.095238     -0.075288
50%        0.035715      0.017677
75%        0.181672      0.039477
max       14.000004      0.343735
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:transform_data_nn.py:Train_data: (259174, 161)

INFO:transform_data_nn.py:Test data years: [1997]
INFO:transform_data_nn.py:Test_data: (23999, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:transform_data_nn.py:Retrain_data: (283173, 161)

INFO:transform_data_nn.py:Prediction data years: [1998]
INFO:transform_data_nn.py:Prediction_data: (24412, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([259174, 138])
            y_train_tf: torch.Size([259174])

            x_test_tf: torch.Size([23999, 138])
            y_test_tf: torch.Size([23999])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([283173, 138])
            y_retrain_tf: torch.Size([283173])

            x_prediction_tf: torch.Size([24412, 138])
            y_prediction_tf: torch.Size([24412])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.4880e-01,  6.9521e-01,  7.9073e-02, -1.2731e+00, -1.3749e-01,
        -7.1969e-01, -1.7195e-01, -3.6190e-01,  3.9376e-01, -1.7017e-01,
        -6.9037e-01,  5.3550e-02, -4.9331e-01, -3.3738e-01,  1.1412e-01,
         5.0071e-01, -1.3906e-01,  2.3610e-01, -4.8212e-02,  4.7460e-01,
        -3.4819e-01,  1.5372e-02, -3.9827e-02,  1.2964e-04, -5.6493e-02,
        -2.7282e-01, -5.7808e-01, -2.0449e-02,  3.1053e-01,  1.2282e+00,
         3.9251e-01, -1.1274e-01,  4.7515e-01, -3.3248e-02, -3.2932e-01,
        -2.0729e-01,  8.0102e-02,  5.8961e-01, -7.0135e-03, -1.1219e+00,
        -3.0714e-01,  2.6452e-01,  2.6121e-01, -6.4193e-02, -1.6986e-01,
        -7.0253e-01,  7.4020e-02, -4.5559e-02, -4.0965e-01, -1.9228e-01,
        -7.4970e-01,  6.1298e-01, -1.0643e-01, -1.4157e-02, -8.2136e-03,
         4.2601e-01, -6.9788e-01,  7.6248e-02, -2.5865e-01, -1.6434e-02,
         1.3006e-01, -3.1513e-01,  1.3385e-01,  2.5961e-01,  1.0734e-01,
        -1.5899e-01,  3.8703e-01, -1.2239e-01,  6.7389e-01, -4.1416e-01,
        -2.5506e-01, -5.0796e-02,  1.4470e-03, -8.3424e-01,  1.4112e-01,
         6.4460e-01,  1.5110e-02, -3.6804e-01, -1.8318e-01,  5.6013e-03,
        -1.8051e-03,  2.2095e-01,  9.8807e-02, -3.2572e-01, -5.5546e-01,
        -1.2895e-01, -1.1314e-01, -3.0071e-01, -3.5542e-03,  1.7228e-01,
        -5.1372e-01, -1.2628e+00,  1.4299e-02,  1.7954e+00,  2.2832e+00,
         2.3517e+00,  2.2862e-02,  1.9832e+00, -2.9241e+00,  4.9539e-01,
        -7.8563e-01,  1.0158e-01, -5.3760e-01,  7.9158e-02,  3.8423e-01,
         1.8522e-01,  4.8789e-02,  4.3421e-01,  0.0000e+00, -1.3807e+00,
         8.8076e-01, -2.5454e+00,  1.5510e-01,  2.4301e-02,  0.0000e+00,
        -5.9034e-02,  9.6087e-02, -1.7846e-01,  2.8494e-02, -1.0019e-01,
         1.0179e-01, -3.9550e-01, -3.4418e-01,  2.7712e-01,  2.8553e-01,
        -4.1652e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([10219]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-8.5434e-01,  1.5356e-01,  2.0732e-01,  1.1448e+00, -8.4316e-02,
        -4.7100e-01, -6.1442e-01, -6.4004e-01, -3.1435e-01, -2.9830e-01,
        -7.4604e-01,  1.2911e-02, -2.1747e+00,  8.2419e-02, -4.1931e-01,
        -4.5306e-01, -1.8767e-01, -1.3225e-01,  7.9684e-02, -7.1321e-03,
         3.2981e-01, -6.0564e-02, -1.3137e-01, -2.3293e-01,  5.4243e-02,
        -5.9473e-01, -6.2350e-01, -5.4848e-01, -8.9352e-01,  8.8011e-01,
        -4.3661e-01, -1.2415e-01,  2.4384e-01, -2.4274e+00, -7.7629e-01,
        -1.1264e-01,  4.8749e-02, -6.3743e-01, -2.5934e-01, -8.7099e-01,
         9.1009e-02, -1.3482e-01,  2.8138e-01, -1.8172e-01, -1.2515e-01,
        -1.6322e-01, -3.3947e-01, -4.8949e-01, -2.5839e-01,  1.2283e-01,
         1.5612e-02, -7.6832e-01, -5.8544e-01, -5.8243e-01, -7.3674e-01,
         2.8582e-01, -1.0422e+00,  1.0387e-01, -2.0648e-01, -3.5042e-01,
         5.7477e-02, -1.6340e-01, -1.1582e-01, -6.6688e-02, -3.1892e-03,
        -3.5912e-01,  1.6965e-01, -6.0161e-01,  6.4383e-03, -5.0308e-01,
        -2.5506e-01, -5.0796e-02,  1.4470e-03,  4.1342e-01,  5.0155e-02,
         3.8097e-02,  1.1700e+00, -2.6240e-01, -9.8077e-02,  5.6013e-03,
         1.1876e-01, -3.0161e-01, -2.7645e-01,  1.6201e-03, -5.0708e-01,
        -1.1001e-01, -1.0270e-01, -3.6406e-01, -6.1253e-01,  2.2928e-02,
        -5.5082e-01, -9.6781e-01,  1.4299e-02, -1.9548e+00, -7.3393e-01,
        -1.2708e+00,  6.6421e-01, -6.3947e-01, -3.1675e-01, -9.0903e-01,
         4.1027e-01,  9.7794e-02, -5.3760e-01, -2.9017e+00,  3.8423e-01,
         4.3736e+00,  1.5561e-02, -3.2619e-01,  0.0000e+00,  7.6622e-01,
         5.7234e-01,  9.8142e-01,  1.2886e-01,  6.8689e-01,  0.0000e+00,
        -5.9034e-02, -2.7421e-01, -1.7482e-01, -3.7708e+00,  7.8676e-01,
        -7.5419e-01, -5.5688e-01, -5.5884e-01,  1.7163e-01,  2.3172e-01,
        -4.0256e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2861]), tensor(0.0745))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.4875e-01,  7.2061e-01,  7.2912e-02, -1.2606e+00, -1.4886e-01,
        -7.3204e-01, -1.6850e-01, -3.6069e-01,  4.2156e-01, -1.6996e-01,
        -6.8732e-01,  6.2069e-02, -4.9929e-01, -3.5319e-01,  1.1656e-01,
         4.9707e-01, -1.4139e-01,  2.4484e-01, -4.3315e-02,  4.8274e-01,
        -3.5553e-01,  1.5676e-02, -4.0194e-02, -3.8391e-03, -5.8610e-02,
        -2.7463e-01, -5.8303e-01, -1.6828e-02,  2.8067e-01,  1.2710e+00,
         3.8739e-01, -1.1953e-01,  4.8341e-01, -4.5972e-02, -3.1644e-01,
        -2.1355e-01,  7.1828e-02,  6.2033e-01, -1.9624e-02, -1.1225e+00,
        -3.0338e-01,  2.7821e-01,  2.4991e-01, -5.3326e-02, -1.7550e-01,
        -7.1020e-01,  7.6894e-02, -5.2911e-02, -4.1289e-01, -1.9440e-01,
        -7.6091e-01,  5.9169e-01, -9.4990e-02, -1.2033e-02, -1.4167e-02,
         4.2622e-01, -6.8477e-01,  8.1612e-02, -2.6019e-01, -1.7514e-02,
         1.2912e-01, -3.1628e-01,  1.3074e-01,  2.5888e-01,  1.0887e-01,
        -1.6674e-01,  4.0211e-01, -1.2470e-01,  6.6961e-01, -4.1523e-01,
        -2.6985e-01, -6.1165e-02, -9.8828e-04, -8.4282e-01,  1.5168e-01,
         6.5720e-01,  1.5584e-02, -3.7219e-01, -1.8143e-01,  5.0605e-03,
        -1.8819e-03,  2.0476e-01,  1.2074e-01, -3.1400e-01, -5.6006e-01,
        -1.3345e-01, -1.1882e-01, -2.9322e-01,  7.9855e-03,  1.7296e-01,
        -5.2195e-01, -1.2660e+00,  1.6970e-02,  1.7147e+00,  2.3702e+00,
         2.4034e+00, -7.6860e-03,  2.0941e+00, -3.0161e+00,  5.8447e-01,
        -8.6387e-01,  1.0094e-01, -3.3009e-01,  6.7510e-02,  2.8525e-01,
         1.5178e-01,  4.9893e-02,  3.3440e-01,  0.0000e+00, -1.4748e+00,
         8.9989e-01, -2.5525e+00,  1.5741e-01,  8.5457e-03,  0.0000e+00,
        -1.8565e-02,  1.2020e-01, -1.8193e-01,  1.3378e-02, -1.0678e-01,
         1.0540e-01, -3.8029e-01, -3.4150e-01,  2.8398e-01,  2.9023e-01,
        -4.1761e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([11067]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-4.9754e-01,  4.5230e-01, -7.9629e-01,  1.2705e+00, -3.4419e-02,
        -8.0852e-01, -1.2732e+00, -8.7504e-01, -3.5972e-01, -1.0120e-01,
        -7.5125e-01,  1.0637e-02, -4.6192e+00, -1.6720e-01, -4.3450e-01,
         1.6455e-01, -1.7177e-01, -1.1868e-02, -4.3315e-02,  1.0907e+00,
         1.4642e-01, -6.0401e-02, -4.8681e-02, -1.6256e-01, -6.2277e-02,
        -4.3124e-01, -6.4073e-01, -1.6828e-02, -1.2184e+00,  8.5124e-01,
        -1.3525e-01, -1.9557e-01,  2.3175e-01, -4.5972e-02, -7.8088e-01,
        -3.9932e-01, -2.3895e-01, -6.1120e-01, -2.4745e-01, -9.0022e-01,
        -2.2962e-01,  1.3594e-01,  3.5618e-01, -1.5770e-01, -5.3546e-02,
        -6.5398e-01, -5.5200e-02,  2.5113e-01, -2.6188e-01,  2.1419e-02,
         9.0682e-03, -7.2800e-01, -6.8018e-01, -5.6584e-01, -7.3715e-01,
         2.8444e-01, -1.0327e+00, -1.4410e-01,  1.2377e+00, -4.4250e-01,
        -1.9594e-02,  3.1610e-01, -1.1760e+00,  5.3322e-01,  1.1959e-03,
        -7.9654e-01,  4.2208e-01,  1.3068e+00, -2.0039e+00, -4.5196e-01,
        -2.6985e-01, -6.1165e-02, -9.8828e-04, -7.6262e-01,  5.3793e-02,
         1.4250e-02,  5.2743e+00, -3.4692e-01, -4.9553e-03,  5.0605e-03,
        -1.8819e-03,  9.3164e-02, -2.2469e-01,  1.1796e+00,  3.0917e-01,
        -1.1656e-01, -1.0947e-01, -3.6519e-01, -6.1414e-01,  1.1825e-03,
        -2.3899e-01, -6.9905e-01,  1.6970e-02, -2.2883e+00, -1.4159e+00,
        -1.2488e+00,  2.3878e-01, -5.0993e-01, -9.9969e-01, -1.1059e+00,
         8.7936e-01,  5.0583e-01, -3.3009e-01,  3.3646e+00,  2.8525e-01,
         1.5399e+00,  2.3916e-02,  9.1798e-01,  0.0000e+00,  4.0425e-01,
        -6.9032e-01,  1.3071e+00,  1.2843e-01,  1.3725e+00,  0.0000e+00,
        -1.8565e-02, -5.1438e-02, -1.3765e-01, -3.7524e+00,  7.0168e-01,
        -3.1048e-01, -4.7103e-01, -4.3587e-01,  1.6012e-01,  2.3185e-01,
        -4.0248e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2886]), tensor(-0.0156))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:main_restricted.py:Testing data year: 1997
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 10656
            device: cpu
            
2024-07-28 20:29:43,267	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-28 20:29:43,314	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-28 20:29:43,353	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip' (1.43MiB) to Ray cluster...
2024-07-28 20:29:43,360	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip'.
2024-07-28 20:29:45,108	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-28 21:03:27,203	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_20-29-45' in 0.2686s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 3, 'num_embeddings': 10656, 'embedding_dim': 9, 'dropout_rate': 0.49, 'lr': 2.1456816483566953e-06, 'weight_decay': 3.8468952779413876e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07998876096200033
INFO:model_data_nn.py:Best trial testing loss: 0.09761337848504384
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-28_20-29-40_619346_592478/artifacts/2024-07-28_20-29-45/train_fnn_2024-07-28_20-29-45/driver_artifacts/train_fnn_ccdaf_00074_74_dropout_rate=0.4900,embedding_dim=9,hidden_dim=5,lr=0.0000,num_layers=3,weight_decay=0.0000_2024-07-28_20-29-45
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 3, 'num_embeddings': 11533, 'embedding_dim': 9, 'dropout_rate': 0.49, 'lr': 2.1456816483566953e-06, 'weight_decay': 3.8468952779413876e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.08349663233359228, 'avg_test_loss': 0.1359511703906181}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.08257596695393149, 'avg_test_loss': 0.13593029303485968}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.08211780560984332, 'avg_test_loss': 0.13598759267576702}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.08187491932562191, 'avg_test_loss': 0.13612032335992727}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.08174392935747507, 'avg_test_loss': 0.13625738848761426}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.08165653069692227, 'avg_test_loss': 0.1363769905222336}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.08161413070878812, 'avg_test_loss': 0.1364714136269158}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.08158734463581353, 'avg_test_loss': 0.13660635849392694}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.08159491841076699, 'avg_test_loss': 0.13664823228795647}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.081572077070762, 'avg_test_loss': 0.13672858188952763}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.08155854418621168, 'avg_test_loss': 0.13676796407872782}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.08154880563024546, 'avg_test_loss': 0.13679095897921092}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.08156201222685804, 'avg_test_loss': 0.13682193666969605}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.08154993496875651, 'avg_test_loss': 0.13686159347227886}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.08155332243105373, 'avg_test_loss': 0.13686999152487642}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.0815394665118792, 'avg_test_loss': 0.13689112381434254}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.08153423182809452, 'avg_test_loss': 0.13689175730873465}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.08151585810689785, 'avg_test_loss': 0.1368751669624401}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.08152040785218961, 'avg_test_loss': 0.1368896823220384}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.08151922587542769, 'avg_test_loss': 0.1368893905255105}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.08151347766071221, 'avg_test_loss': 0.13688225295219122}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.08151600535607023, 'avg_test_loss': 0.13687406702171914}
INFO:model_data_nn.py:Early stopping at epoch 22
INFO:main_restricted.py:Making prediction for data in year: 1998
INFO:main_restricted.py:Prediction data shape: (24412,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1998: 0.36993161700258986
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  24412.000000  24412.000000
mean       0.004293      0.037820
std        0.368725      0.002255
min       -0.979592      0.036382
25%       -0.186753      0.036629
50%       -0.017392      0.036741
75%        0.131659      0.038101
max       10.538459      0.062189
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:transform_data_nn.py:Train_data: (283173, 161)

INFO:transform_data_nn.py:Test data years: [1998]
INFO:transform_data_nn.py:Test_data: (24412, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Retrain_data: (307585, 161)

INFO:transform_data_nn.py:Prediction data years: [1999]
INFO:transform_data_nn.py:Prediction_data: (23257, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([283173, 138])
            y_train_tf: torch.Size([283173])

            x_test_tf: torch.Size([24412, 138])
            y_test_tf: torch.Size([24412])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([307585, 138])
            y_retrain_tf: torch.Size([307585])

            x_prediction_tf: torch.Size([23257, 138])
            y_prediction_tf: torch.Size([23257])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.4875e-01,  7.2061e-01,  7.2912e-02, -1.2606e+00, -1.4886e-01,
        -7.3204e-01, -1.6850e-01, -3.6069e-01,  4.2156e-01, -1.6996e-01,
        -6.8732e-01,  6.2069e-02, -4.9929e-01, -3.5319e-01,  1.1656e-01,
         4.9707e-01, -1.4139e-01,  2.4484e-01, -4.3315e-02,  4.8274e-01,
        -3.5553e-01,  1.5676e-02, -4.0194e-02, -3.8391e-03, -5.8610e-02,
        -2.7463e-01, -5.8303e-01, -1.6828e-02,  2.8067e-01,  1.2710e+00,
         3.8739e-01, -1.1953e-01,  4.8341e-01, -4.5972e-02, -3.1644e-01,
        -2.1355e-01,  7.1828e-02,  6.2033e-01, -1.9624e-02, -1.1225e+00,
        -3.0338e-01,  2.7821e-01,  2.4991e-01, -5.3326e-02, -1.7550e-01,
        -7.1020e-01,  7.6894e-02, -5.2911e-02, -4.1289e-01, -1.9440e-01,
        -7.6091e-01,  5.9169e-01, -9.4990e-02, -1.2033e-02, -1.4167e-02,
         4.2622e-01, -6.8477e-01,  8.1612e-02, -2.6019e-01, -1.7514e-02,
         1.2912e-01, -3.1628e-01,  1.3074e-01,  2.5888e-01,  1.0887e-01,
        -1.6674e-01,  4.0211e-01, -1.2470e-01,  6.6961e-01, -4.1523e-01,
        -2.6985e-01, -6.1165e-02, -9.8828e-04, -8.4282e-01,  1.5168e-01,
         6.5720e-01,  1.5584e-02, -3.7219e-01, -1.8143e-01,  5.0605e-03,
        -1.8819e-03,  2.0476e-01,  1.2074e-01, -3.1400e-01, -5.6006e-01,
        -1.3345e-01, -1.1882e-01, -2.9322e-01,  7.9855e-03,  1.7296e-01,
        -5.2195e-01, -1.2660e+00,  1.6970e-02,  1.7147e+00,  2.3702e+00,
         2.4034e+00, -7.6860e-03,  2.0941e+00, -3.0161e+00,  5.8447e-01,
        -8.6387e-01,  1.0094e-01, -3.3009e-01,  6.7510e-02,  2.8525e-01,
         1.5178e-01,  4.9893e-02,  3.3440e-01,  0.0000e+00, -1.4748e+00,
         8.9989e-01, -2.5525e+00,  1.5741e-01,  8.5457e-03,  0.0000e+00,
        -1.8565e-02,  1.2020e-01, -1.8193e-01,  1.3378e-02, -1.0678e-01,
         1.0540e-01, -3.8029e-01, -3.4150e-01,  2.8398e-01,  2.9023e-01,
        -4.1761e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([11067]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-4.9754e-01,  4.5230e-01, -7.9629e-01,  1.2705e+00, -3.4419e-02,
        -8.0852e-01, -1.2732e+00, -8.7504e-01, -3.5972e-01, -1.0120e-01,
        -7.5125e-01,  1.0637e-02, -4.6192e+00, -1.6720e-01, -4.3450e-01,
         1.6455e-01, -1.7177e-01, -1.1868e-02, -4.3315e-02,  1.0907e+00,
         1.4642e-01, -6.0401e-02, -4.8681e-02, -1.6256e-01, -6.2277e-02,
        -4.3124e-01, -6.4073e-01, -1.6828e-02, -1.2184e+00,  8.5124e-01,
        -1.3525e-01, -1.9557e-01,  2.3175e-01, -4.5972e-02, -7.8088e-01,
        -3.9932e-01, -2.3895e-01, -6.1120e-01, -2.4745e-01, -9.0022e-01,
        -2.2962e-01,  1.3594e-01,  3.5618e-01, -1.5770e-01, -5.3546e-02,
        -6.5398e-01, -5.5200e-02,  2.5113e-01, -2.6188e-01,  2.1419e-02,
         9.0682e-03, -7.2800e-01, -6.8018e-01, -5.6584e-01, -7.3715e-01,
         2.8444e-01, -1.0327e+00, -1.4410e-01,  1.2377e+00, -4.4250e-01,
        -1.9594e-02,  3.1610e-01, -1.1760e+00,  5.3322e-01,  1.1959e-03,
        -7.9654e-01,  4.2208e-01,  1.3068e+00, -2.0039e+00, -4.5196e-01,
        -2.6985e-01, -6.1165e-02, -9.8828e-04, -7.6262e-01,  5.3793e-02,
         1.4250e-02,  5.2743e+00, -3.4692e-01, -4.9553e-03,  5.0605e-03,
        -1.8819e-03,  9.3164e-02, -2.2469e-01,  1.1796e+00,  3.0917e-01,
        -1.1656e-01, -1.0947e-01, -3.6519e-01, -6.1414e-01,  1.1825e-03,
        -2.3899e-01, -6.9905e-01,  1.6970e-02, -2.2883e+00, -1.4159e+00,
        -1.2488e+00,  2.3878e-01, -5.0993e-01, -9.9969e-01, -1.1059e+00,
         8.7936e-01,  5.0583e-01, -3.3009e-01,  3.3646e+00,  2.8525e-01,
         1.5399e+00,  2.3916e-02,  9.1798e-01,  0.0000e+00,  4.0425e-01,
        -6.9032e-01,  1.3071e+00,  1.2843e-01,  1.3725e+00,  0.0000e+00,
        -1.8565e-02, -5.1438e-02, -1.3765e-01, -3.7524e+00,  7.0168e-01,
        -3.1048e-01, -4.7103e-01, -4.3587e-01,  1.6012e-01,  2.3185e-01,
        -4.0248e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2886]), tensor(-0.0156))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.1509,  0.7440,  0.0739, -1.2498, -0.1583, -0.7484, -0.1661, -0.3605,
         0.4437, -0.1689, -0.6865,  0.0739, -0.5083, -0.3612,  0.1127,  0.4919,
        -0.1471,  0.2453, -0.0326,  0.4865, -0.3329,  0.0062, -0.0411, -0.0063,
        -0.0596, -0.2770, -0.5903, -0.0243,  0.2523,  1.3025,  0.3879, -0.1208,
         0.4900, -0.0370, -0.3052, -0.2211,  0.0571,  0.6507, -0.0367, -1.1276,
        -0.3000,  0.2835,  0.2404, -0.0413, -0.1868, -0.7212,  0.0792, -0.0531,
        -0.4181, -0.1738, -0.7727,  0.5697, -0.0804, -0.0112, -0.0218,  0.4249,
        -0.6743,  0.0835, -0.2571, -0.0244,  0.1277, -0.3128,  0.1321,  0.2572,
         0.1087, -0.1698,  0.4162, -0.1267,  0.6665, -0.4178, -0.2836, -0.0720,
        -0.0133, -0.8554,  0.1637,  0.6658,  0.0178, -0.3752, -0.1796,  0.0047,
        -0.0033,  0.1852,  0.1404, -0.3015, -0.5638, -0.1380, -0.1245, -0.2873,
         0.0166,  0.1728, -0.5317, -1.2685,  0.0185,  1.6282,  2.3471,  2.4638,
        -0.0452,  2.2006, -2.9314,  0.6653, -0.6964,  0.0989, -0.1149,  0.0153,
         0.3349,  0.1291,  0.0518,  0.2270,  0.0000, -1.5009,  0.9768, -2.5665,
         0.1609,  0.0047,  0.0000, -0.0273,  0.1423, -0.1884, -0.0187, -0.1151,
         0.1141, -0.3668, -0.3363,  0.2919,  0.2945, -0.4157,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([11747]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-2.4279e-01, -5.4056e-01, -3.7466e-01,  1.3921e+00, -3.4530e-01,
        -8.1114e-01, -1.6376e+00, -9.1233e-01, -3.5750e-01, -3.1677e-01,
        -7.4018e-01,  2.4990e-02, -1.1498e+00,  6.9382e-01,  2.6771e-01,
         4.5418e-01, -1.8631e-01, -3.0621e-01,  1.3363e-01, -8.3417e-01,
         3.2863e-01, -6.1122e-02, -3.8941e-02, -5.3512e-02, -1.3785e-01,
        -4.2425e-01, -6.3906e-01, -2.4296e-02, -8.5865e-01,  8.6023e-01,
         3.1274e-01, -1.6124e-01,  2.5772e-01, -2.2774e+00, -7.4574e-01,
        -4.0902e-01, -4.6274e-01, -5.9875e-01, -7.1793e-01, -1.0732e+00,
        -2.4376e-01, -5.9177e-01, -5.9555e-01, -1.6706e-01, -3.2865e-01,
        -7.9236e-01, -1.0617e-01,  1.7908e-01, -3.3487e-01,  1.4255e-01,
         7.7668e-01, -7.0627e-01, -7.1038e-01, -5.5264e-01, -7.3689e-01,
         3.2908e-01, -1.0253e+00, -9.0320e-02, -1.1286e-01, -1.8251e-01,
        -5.3808e-03,  3.2517e-01,  7.9990e-01, -7.9642e-01, -1.0776e-03,
         6.7643e-01, -3.7252e-01,  4.9175e-01,  6.6652e-01, -3.8839e-01,
        -2.8357e-01, -7.1964e-02, -1.3280e-02, -7.9567e-01,  7.6774e-02,
         7.0727e-01,  1.6970e+00, -2.8202e-01, -1.4733e-01,  4.6881e-03,
         1.1976e-01,  5.9480e-02, -1.5375e-01,  4.9903e-01, -5.1187e-02,
        -1.2330e-01, -1.1638e-01, -3.5442e-01, -5.4464e-01,  1.8507e-01,
        -3.9372e-01,  1.6076e-01,  1.8480e-02, -2.3308e+00, -2.0402e+00,
        -1.1560e+00,  4.3587e-01, -7.7550e-01, -7.9302e-01, -2.6511e-02,
         1.1223e+00, -5.6112e-01, -1.1486e-01,  1.8025e+00,  3.3495e-01,
         2.7049e+00,  2.8338e-02,  4.0988e-01,  0.0000e+00, -1.3899e+00,
        -4.1890e-01,  1.0006e+00,  1.2894e-01,  2.7026e+00,  0.0000e+00,
        -2.7314e-02,  4.5218e-02, -2.3823e-01, -3.6706e+00,  6.3616e-01,
         9.8503e-01, -2.8688e-01, -3.9455e-01,  2.0078e-01,  2.6829e-01,
        -4.0594e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2789]), tensor(-0.0790))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:main_restricted.py:Testing data year: 1998
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 11533
            device: cpu
            
2024-07-28 21:52:57,556	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-28 21:52:57,614	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-28 21:52:57,656	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip' (1.43MiB) to Ray cluster...
2024-07-28 21:52:57,664	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip'.
2024-07-28 21:52:59,506	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-28 22:05:01,028	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_21-52-59' in 0.2651s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 165, 'num_layers': 1, 'num_embeddings': 11533, 'embedding_dim': 5, 'dropout_rate': 0.06, 'lr': 3.02436916127265e-05, 'weight_decay': 1.1126788925493306e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.07416074816600687
INFO:model_data_nn.py:Best trial testing loss: 0.12861951125580914
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-28_21-52-54_616695_592478/artifacts/2024-07-28_21-52-59/train_fnn_2024-07-28_21-52-59/driver_artifacts/train_fnn_6dbfb_00037_37_dropout_rate=0.0600,embedding_dim=5,hidden_dim=165,lr=0.0000,num_layers=1,weight_decay=0.0000_2024-07-28_21-52-59
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 165, 'num_layers': 1, 'num_embeddings': 12245, 'embedding_dim': 5, 'dropout_rate': 0.06, 'lr': 3.02436916127265e-05, 'weight_decay': 1.1126788925493306e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.08449827245375761, 'avg_test_loss': 0.26808908437429874}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.08204566390973314, 'avg_test_loss': 0.2712877954376841}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.08117078005751309, 'avg_test_loss': 0.2821312973705622}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.08038796601476729, 'avg_test_loss': 0.28744702482248075}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.07978572006268746, 'avg_test_loss': 0.2870741385639041}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.0791168549546489, 'avg_test_loss': 0.28585434457348596}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.07849244698432525, 'avg_test_loss': 0.2958352323058624}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.07797468301215757, 'avg_test_loss': 0.30481060111260677}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.07730953753943301, 'avg_test_loss': 0.3046781740785873}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.07674683710964048, 'avg_test_loss': 0.30429206780352436}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.07618905200428805, 'avg_test_loss': 0.31445456292111795}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.07573710755056334, 'avg_test_loss': 0.30724166288644406}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.07525334273252979, 'avg_test_loss': 0.3193936600953668}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.07493293172394205, 'avg_test_loss': 0.3141274725107456}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.07455830258881976, 'avg_test_loss': 0.3239128339964037}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.07413133453845953, 'avg_test_loss': 0.3168389496373033}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.07373807050328031, 'avg_test_loss': 0.3217536663984532}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.0735427336395252, 'avg_test_loss': 0.3246922232927038}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.07319319905241145, 'avg_test_loss': 0.3324427546749076}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.07293104414823859, 'avg_test_loss': 0.34542260517540213}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.07276791881706335, 'avg_test_loss': 0.3257098988128396}
INFO:model_data_nn.py:Early stopping at epoch 21
INFO:main_restricted.py:Making prediction for data in year: 1999
INFO:main_restricted.py:Prediction data shape: (23257,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1999: 0.570871119557294
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  23257.000000  23257.000000
mean       0.079897     -0.151588
std        0.505723      0.145360
min       -0.980932     -0.786484
25%       -0.147059     -0.243879
50%        0.000000     -0.152907
75%        0.177420     -0.064143
max       16.624997      0.711759
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Train_data: (307585, 161)

INFO:transform_data_nn.py:Test data years: [1999]
INFO:transform_data_nn.py:Test_data: (23257, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:transform_data_nn.py:Retrain_data: (330842, 161)

INFO:transform_data_nn.py:Prediction data years: [2000]
INFO:transform_data_nn.py:Prediction_data: (22167, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([307585, 138])
            y_train_tf: torch.Size([307585])

            x_test_tf: torch.Size([23257, 138])
            y_test_tf: torch.Size([23257])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([330842, 138])
            y_retrain_tf: torch.Size([330842])

            x_prediction_tf: torch.Size([22167, 138])
            y_prediction_tf: torch.Size([22167])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-0.1509,  0.7440,  0.0739, -1.2498, -0.1583, -0.7484, -0.1661, -0.3605,
         0.4437, -0.1689, -0.6865,  0.0739, -0.5083, -0.3612,  0.1127,  0.4919,
        -0.1471,  0.2453, -0.0326,  0.4865, -0.3329,  0.0062, -0.0411, -0.0063,
        -0.0596, -0.2770, -0.5903, -0.0243,  0.2523,  1.3025,  0.3879, -0.1208,
         0.4900, -0.0370, -0.3052, -0.2211,  0.0571,  0.6507, -0.0367, -1.1276,
        -0.3000,  0.2835,  0.2404, -0.0413, -0.1868, -0.7212,  0.0792, -0.0531,
        -0.4181, -0.1738, -0.7727,  0.5697, -0.0804, -0.0112, -0.0218,  0.4249,
        -0.6743,  0.0835, -0.2571, -0.0244,  0.1277, -0.3128,  0.1321,  0.2572,
         0.1087, -0.1698,  0.4162, -0.1267,  0.6665, -0.4178, -0.2836, -0.0720,
        -0.0133, -0.8554,  0.1637,  0.6658,  0.0178, -0.3752, -0.1796,  0.0047,
        -0.0033,  0.1852,  0.1404, -0.3015, -0.5638, -0.1380, -0.1245, -0.2873,
         0.0166,  0.1728, -0.5317, -1.2685,  0.0185,  1.6282,  2.3471,  2.4638,
        -0.0452,  2.2006, -2.9314,  0.6653, -0.6964,  0.0989, -0.1149,  0.0153,
         0.3349,  0.1291,  0.0518,  0.2270,  0.0000, -1.5009,  0.9768, -2.5665,
         0.1609,  0.0047,  0.0000, -0.0273,  0.1423, -0.1884, -0.0187, -0.1151,
         0.1141, -0.3668, -0.3363,  0.2919,  0.2945, -0.4157,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([11747]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-2.4279e-01, -5.4056e-01, -3.7466e-01,  1.3921e+00, -3.4530e-01,
        -8.1114e-01, -1.6376e+00, -9.1233e-01, -3.5750e-01, -3.1677e-01,
        -7.4018e-01,  2.4990e-02, -1.1498e+00,  6.9382e-01,  2.6771e-01,
         4.5418e-01, -1.8631e-01, -3.0621e-01,  1.3363e-01, -8.3417e-01,
         3.2863e-01, -6.1122e-02, -3.8941e-02, -5.3512e-02, -1.3785e-01,
        -4.2425e-01, -6.3906e-01, -2.4296e-02, -8.5865e-01,  8.6023e-01,
         3.1274e-01, -1.6124e-01,  2.5772e-01, -2.2774e+00, -7.4574e-01,
        -4.0902e-01, -4.6274e-01, -5.9875e-01, -7.1793e-01, -1.0732e+00,
        -2.4376e-01, -5.9177e-01, -5.9555e-01, -1.6706e-01, -3.2865e-01,
        -7.9236e-01, -1.0617e-01,  1.7908e-01, -3.3487e-01,  1.4255e-01,
         7.7668e-01, -7.0627e-01, -7.1038e-01, -5.5264e-01, -7.3689e-01,
         3.2908e-01, -1.0253e+00, -9.0320e-02, -1.1286e-01, -1.8251e-01,
        -5.3808e-03,  3.2517e-01,  7.9990e-01, -7.9642e-01, -1.0776e-03,
         6.7643e-01, -3.7252e-01,  4.9175e-01,  6.6652e-01, -3.8839e-01,
        -2.8357e-01, -7.1964e-02, -1.3280e-02, -7.9567e-01,  7.6774e-02,
         7.0727e-01,  1.6970e+00, -2.8202e-01, -1.4733e-01,  4.6881e-03,
         1.1976e-01,  5.9480e-02, -1.5375e-01,  4.9903e-01, -5.1187e-02,
        -1.2330e-01, -1.1638e-01, -3.5442e-01, -5.4464e-01,  1.8507e-01,
        -3.9372e-01,  1.6076e-01,  1.8480e-02, -2.3308e+00, -2.0402e+00,
        -1.1560e+00,  4.3587e-01, -7.7550e-01, -7.9302e-01, -2.6511e-02,
         1.1223e+00, -5.6112e-01, -1.1486e-01,  1.8025e+00,  3.3495e-01,
         2.7049e+00,  2.8338e-02,  4.0988e-01,  0.0000e+00, -1.3899e+00,
        -4.1890e-01,  1.0006e+00,  1.2894e-01,  2.7026e+00,  0.0000e+00,
        -2.7314e-02,  4.5218e-02, -2.3823e-01, -3.6706e+00,  6.3616e-01,
         9.8503e-01, -2.8688e-01, -3.9455e-01,  2.0078e-01,  2.6829e-01,
        -4.0594e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2789]), tensor(-0.0790))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.1517,  0.7643,  0.0741, -1.2420, -0.1630, -0.7659, -0.1644, -0.3590,
         0.4438, -0.1655, -0.6851,  0.0833, -0.5092, -0.3713,  0.1118,  0.4894,
        -0.1436,  0.2420, -0.0348,  0.4922, -0.3416,  0.0049, -0.0404, -0.0039,
        -0.0545, -0.2778, -0.5963, -0.0290,  0.2277,  1.3229,  0.3730, -0.1190,
         0.4949, -0.0264, -0.2939, -0.2278,  0.0436,  0.6775, -0.0490, -1.1350,
        -0.2977,  0.3173,  0.2359, -0.0378, -0.1943, -0.7313,  0.0980, -0.0503,
        -0.4175, -0.1673, -0.7843,  0.5522, -0.0630, -0.0116, -0.0237,  0.4228,
        -0.6646,  0.0795, -0.2531, -0.0328,  0.1284, -0.3086,  0.1336,  0.2554,
         0.1134, -0.1725,  0.4281, -0.1310,  0.6667, -0.4198, -0.2946, -0.0809,
        -0.0220, -0.8696,  0.1742,  0.6666,  0.0194, -0.3778, -0.1779,  0.0063,
        -0.0066,  0.1756,  0.1491, -0.2889, -0.5626, -0.1416, -0.1292, -0.2838,
         0.0285,  0.1826, -0.5358, -1.2721,  0.0191,  1.5680,  2.2776,  2.5200,
        -0.0780,  2.2929, -2.9799,  0.7094, -0.7643,  0.0997, -0.1145,  0.0057,
         0.3502,  0.1574,  0.0542,  0.2523,  0.0000, -1.4063,  1.0355, -2.5828,
         0.1644,  0.0092,  0.0000, -0.0067,  0.1611, -0.1942, -0.0167, -0.1234,
         0.1210, -0.3549, -0.3292,  0.2991,  0.2976, -0.4133,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([12330]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-1.7463e-02, -6.8208e-01, -5.1292e-01,  1.5087e+00, -2.6048e-01,
        -8.0411e-01, -1.6087e+00, -9.1082e-01, -2.2046e-01, -2.4390e-01,
        -6.8325e-01,  3.3706e-02, -3.0564e-01,  9.8559e-01,  5.3074e-01,
         6.0774e-01, -2.2486e-01,  1.4532e-01,  7.0841e-02, -9.6938e-01,
         1.8550e-01, -6.4694e-02, -4.3657e-02, -5.4047e-02,  4.0327e-02,
        -4.7776e-01, -6.5774e-01, -2.8979e-02, -8.9603e-01,  1.1710e+00,
        -4.1486e-02, -1.5411e-01,  2.9379e-01, -2.2267e+00, -7.8194e-01,
        -2.8490e-01, -1.8904e-01, -5.4945e-01, -1.7000e-01, -1.1194e+00,
        -4.3445e-02, -3.1549e-01, -3.6533e-01, -9.9723e-02, -2.6630e-01,
        -3.6560e-01, -3.6423e-01, -8.0028e-02, -4.8426e-02, -1.1814e-01,
         7.7213e-01, -7.7487e-01, -5.6102e-01, -5.4456e-01, -7.3591e-01,
         2.6051e-01, -1.0184e+00,  1.2153e-01, -4.1426e-01, -4.3467e-01,
        -1.7693e-01, -1.1241e-01,  1.0690e+00,  1.0657e-01,  2.6272e-04,
         1.3289e+00, -4.8393e-01,  2.0586e+00,  6.6670e-01, -3.8214e-01,
        -2.9457e-01, -8.0898e-02, -2.2006e-02, -4.1936e-01,  7.0712e-02,
         7.8962e-01,  5.5825e-02, -1.0734e-01, -1.5332e-01,  6.2512e-03,
         1.2375e-01,  8.8372e-02,  3.8248e-02,  2.4160e-01, -5.7003e-01,
        -1.3262e-01, -1.2374e-01, -3.0045e-01, -5.1220e-01, -3.7390e-01,
        -5.9571e-01, -1.1923e-01,  1.9131e-02, -2.2531e+00, -1.5614e+00,
        -1.1678e+00,  3.0509e-01, -4.1689e-01, -3.4242e-01, -8.5690e-01,
        -3.2235e-01, -9.6125e-01, -1.1448e-01,  8.6509e-01,  3.5022e-01,
         1.9737e+00,  3.2488e-02, -1.0175e+00,  0.0000e+00, -6.5791e-01,
         4.5432e-02,  1.3014e+00,  1.1926e-01,  5.0540e+00,  0.0000e+00,
        -6.7208e-03, -1.5726e-01, -2.2692e-01, -3.6150e+00,  6.4678e-01,
         1.4428e-01, -1.0529e-01, -4.0449e-01,  2.0893e-01,  2.7106e-01,
        -4.2404e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2631]), tensor(-0.0447))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:main_restricted.py:Testing data year: 1999
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 12245
            device: cpu
            
2024-07-28 22:55:52,360	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-28 22:55:52,412	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-28 22:55:52,463	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip' (1.43MiB) to Ray cluster...
2024-07-28 22:55:52,473	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip'.
2024-07-28 22:55:54,139	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-28 23:44:16,404	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_22-55-54' in 0.2555s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 3, 'num_embeddings': 12245, 'embedding_dim': 6, 'dropout_rate': 0.53, 'lr': 0.007579479953348002, 'weight_decay': 0.0003142880890840113, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.08611934292593314
INFO:model_data_nn.py:Best trial testing loss: 0.256981080935265
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-28_22-55-48_629691_592478/artifacts/2024-07-28_22-55-54/train_fnn_2024-07-28_22-55-54/driver_artifacts/train_fnn_379b0_00001_1_dropout_rate=0.5300,embedding_dim=6,hidden_dim=35,lr=0.0076,num_layers=3,weight_decay=0.0003_2024-07-28_22-55-54
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 3, 'num_embeddings': 12852, 'embedding_dim': 6, 'dropout_rate': 0.53, 'lr': 0.007579479953348002, 'weight_decay': 0.0003142880890840113, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.09831452379059022, 'avg_test_loss': 0.2096976184256654}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.09818042550055091, 'avg_test_loss': 0.20819142765717136}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.09817840683643869, 'avg_test_loss': 0.20744870578392438}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.09817604877993041, 'avg_test_loss': 0.2093269197050192}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.09818593036721399, 'avg_test_loss': 0.2063471534496082}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.09818597149459184, 'avg_test_loss': 0.2067162334403662}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.09817281880693986, 'avg_test_loss': 0.2060780912659182}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.0981682200510178, 'avg_test_loss': 0.2069388745239901}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.09819337293400447, 'avg_test_loss': 0.20675868063263317}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.09818019978896657, 'avg_test_loss': 0.2080131774011366}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.09818694906294473, 'avg_test_loss': 0.20569277649224663}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.09816993409859635, 'avg_test_loss': 0.20647936558044952}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.09818283496411943, 'avg_test_loss': 0.20767287192839368}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.09817571258815616, 'avg_test_loss': 0.20757686706415515}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.09816623623195504, 'avg_test_loss': 0.20716272069071487}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.09819939108642925, 'avg_test_loss': 0.2067097695141773}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.09817845211972419, 'avg_test_loss': 0.2076977473986939}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.09815319137016056, 'avg_test_loss': 0.20636055451047525}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.09818856726051195, 'avg_test_loss': 0.20583313359994365}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.09817009185264088, 'avg_test_loss': 0.20800208968113065}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.09817518584911644, 'avg_test_loss': 0.20623100623058999}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.09815638406430298, 'avg_test_loss': 0.20671347561976752}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.09819385319556137, 'avg_test_loss': 0.20677575725600425}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.0981812879117413, 'avg_test_loss': 0.20679418082410733}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.09816802405779448, 'avg_test_loss': 0.2065820385532867}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.09816416137930871, 'avg_test_loss': 0.20687267678100024}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.09819141532710475, 'avg_test_loss': 0.20640011127469177}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.09818107428086476, 'avg_test_loss': 0.20809488949669197}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.09818274366856197, 'avg_test_loss': 0.2077387194082098}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.09817451975438264, 'avg_test_loss': 0.20669426223644263}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.09816796206763782, 'avg_test_loss': 0.21155527257696008}
INFO:model_data_nn.py:Early stopping at epoch 31
INFO:main_restricted.py:Making prediction for data in year: 2000
INFO:main_restricted.py:Prediction data shape: (22167,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2000: 0.4602228651507186
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  22167.000000  22167.000000
mean      -0.000670      0.078248
std        0.453416      0.000000
min       -0.980000      0.078248
25%       -0.222436      0.078248
50%       -0.022528      0.078248
75%        0.141851      0.078248
max       10.941179      0.078248
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:transform_data_nn.py:Train_data: (330842, 161)

INFO:transform_data_nn.py:Test data years: [2000]
INFO:transform_data_nn.py:Test_data: (22167, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:transform_data_nn.py:Retrain_data: (353009, 161)

INFO:transform_data_nn.py:Prediction data years: [2001]
INFO:transform_data_nn.py:Prediction_data: (21485, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([330842, 138])
            y_train_tf: torch.Size([330842])

            x_test_tf: torch.Size([22167, 138])
            y_test_tf: torch.Size([22167])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([353009, 138])
            y_retrain_tf: torch.Size([353009])

            x_prediction_tf: torch.Size([21485, 138])
            y_prediction_tf: torch.Size([21485])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-0.1517,  0.7643,  0.0741, -1.2420, -0.1630, -0.7659, -0.1644, -0.3590,
         0.4438, -0.1655, -0.6851,  0.0833, -0.5092, -0.3713,  0.1118,  0.4894,
        -0.1436,  0.2420, -0.0348,  0.4922, -0.3416,  0.0049, -0.0404, -0.0039,
        -0.0545, -0.2778, -0.5963, -0.0290,  0.2277,  1.3229,  0.3730, -0.1190,
         0.4949, -0.0264, -0.2939, -0.2278,  0.0436,  0.6775, -0.0490, -1.1350,
        -0.2977,  0.3173,  0.2359, -0.0378, -0.1943, -0.7313,  0.0980, -0.0503,
        -0.4175, -0.1673, -0.7843,  0.5522, -0.0630, -0.0116, -0.0237,  0.4228,
        -0.6646,  0.0795, -0.2531, -0.0328,  0.1284, -0.3086,  0.1336,  0.2554,
         0.1134, -0.1725,  0.4281, -0.1310,  0.6667, -0.4198, -0.2946, -0.0809,
        -0.0220, -0.8696,  0.1742,  0.6666,  0.0194, -0.3778, -0.1779,  0.0063,
        -0.0066,  0.1756,  0.1491, -0.2889, -0.5626, -0.1416, -0.1292, -0.2838,
         0.0285,  0.1826, -0.5358, -1.2721,  0.0191,  1.5680,  2.2776,  2.5200,
        -0.0780,  2.2929, -2.9799,  0.7094, -0.7643,  0.0997, -0.1145,  0.0057,
         0.3502,  0.1574,  0.0542,  0.2523,  0.0000, -1.4063,  1.0355, -2.5828,
         0.1644,  0.0092,  0.0000, -0.0067,  0.1611, -0.1942, -0.0167, -0.1234,
         0.1210, -0.3549, -0.3292,  0.2991,  0.2976, -0.4133,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([12330]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-1.7463e-02, -6.8208e-01, -5.1292e-01,  1.5087e+00, -2.6048e-01,
        -8.0411e-01, -1.6087e+00, -9.1082e-01, -2.2046e-01, -2.4390e-01,
        -6.8325e-01,  3.3706e-02, -3.0564e-01,  9.8559e-01,  5.3074e-01,
         6.0774e-01, -2.2486e-01,  1.4532e-01,  7.0841e-02, -9.6938e-01,
         1.8550e-01, -6.4694e-02, -4.3657e-02, -5.4047e-02,  4.0327e-02,
        -4.7776e-01, -6.5774e-01, -2.8979e-02, -8.9603e-01,  1.1710e+00,
        -4.1486e-02, -1.5411e-01,  2.9379e-01, -2.2267e+00, -7.8194e-01,
        -2.8490e-01, -1.8904e-01, -5.4945e-01, -1.7000e-01, -1.1194e+00,
        -4.3445e-02, -3.1549e-01, -3.6533e-01, -9.9723e-02, -2.6630e-01,
        -3.6560e-01, -3.6423e-01, -8.0028e-02, -4.8426e-02, -1.1814e-01,
         7.7213e-01, -7.7487e-01, -5.6102e-01, -5.4456e-01, -7.3591e-01,
         2.6051e-01, -1.0184e+00,  1.2153e-01, -4.1426e-01, -4.3467e-01,
        -1.7693e-01, -1.1241e-01,  1.0690e+00,  1.0657e-01,  2.6272e-04,
         1.3289e+00, -4.8393e-01,  2.0586e+00,  6.6670e-01, -3.8214e-01,
        -2.9457e-01, -8.0898e-02, -2.2006e-02, -4.1936e-01,  7.0712e-02,
         7.8962e-01,  5.5825e-02, -1.0734e-01, -1.5332e-01,  6.2512e-03,
         1.2375e-01,  8.8372e-02,  3.8248e-02,  2.4160e-01, -5.7003e-01,
        -1.3262e-01, -1.2374e-01, -3.0045e-01, -5.1220e-01, -3.7390e-01,
        -5.9571e-01, -1.1923e-01,  1.9131e-02, -2.2531e+00, -1.5614e+00,
        -1.1678e+00,  3.0509e-01, -4.1689e-01, -3.4242e-01, -8.5690e-01,
        -3.2235e-01, -9.6125e-01, -1.1448e-01,  8.6509e-01,  3.5022e-01,
         1.9737e+00,  3.2488e-02, -1.0175e+00,  0.0000e+00, -6.5791e-01,
         4.5432e-02,  1.3014e+00,  1.1926e-01,  5.0540e+00,  0.0000e+00,
        -6.7208e-03, -1.5726e-01, -2.2692e-01, -3.6150e+00,  6.4678e-01,
         1.4428e-01, -1.0529e-01, -4.0449e-01,  2.0893e-01,  2.7106e-01,
        -4.2404e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2631]), tensor(-0.0447))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.5170e-01,  7.8169e-01,  7.9342e-02, -1.2365e+00, -1.6841e-01,
        -7.8872e-01, -1.6086e-01, -3.5673e-01,  4.3400e-01, -1.6062e-01,
        -6.8302e-01,  9.1437e-02, -5.0654e-01, -3.8443e-01,  1.1169e-01,
         4.8542e-01, -1.4517e-01,  2.4144e-01, -3.5083e-02,  5.0189e-01,
        -3.2631e-01,  2.2627e-03, -3.7241e-02, -5.7087e-03, -4.9664e-02,
        -2.7789e-01, -5.9548e-01, -3.0669e-02,  1.9746e-01,  1.3382e+00,
         3.6286e-01, -1.2000e-01,  4.9758e-01, -3.5242e-02, -2.8389e-01,
        -2.2792e-01,  3.7222e-02,  6.9911e-01, -5.3938e-02, -1.1400e+00,
        -2.9416e-01,  2.5646e-01,  2.4021e-01, -4.1841e-02, -1.9822e-01,
        -7.4495e-01,  8.4166e-02, -5.5735e-02, -4.0163e-01, -1.6177e-01,
        -7.9419e-01,  5.3171e-01, -4.3740e-02, -9.5275e-03, -2.6106e-02,
         4.2102e-01, -6.5470e-01,  7.9345e-02, -2.5267e-01, -4.1140e-02,
         1.2773e-01, -3.0794e-01,  1.2879e-01,  2.5580e-01,  1.1144e-01,
        -1.8088e-01,  4.3880e-01, -1.3207e-01,  6.6354e-01, -4.2059e-01,
        -3.0142e-01, -2.3224e-02, -2.3187e-02, -8.8797e-01,  1.8281e-01,
         6.6443e-01,  2.1081e-02, -3.8111e-01, -1.7609e-01,  5.5197e-03,
        -3.3395e-03,  1.6638e-01,  1.5014e-01, -2.6760e-01, -5.6123e-01,
        -1.4502e-01, -1.3371e-01, -2.7933e-01,  4.1315e-02,  1.9152e-01,
        -5.3593e-01, -1.2752e+00,  1.9779e-02,  1.5375e+00,  2.3052e+00,
         2.5731e+00, -8.0186e-02,  2.3788e+00, -2.8994e+00,  7.6530e-01,
        -7.7655e-01,  1.0315e-01, -6.5651e-02,  5.4512e-02,  2.1990e-01,
         1.5332e-01,  5.3323e-02,  2.6708e-01,  0.0000e+00, -1.4434e+00,
         9.0323e-01, -2.6043e+00,  1.6773e-01,  3.7569e-04, -3.4438e-01,
         1.5154e-02,  1.7938e-01, -1.9686e-01, -5.1633e-02, -1.2949e-01,
         1.2043e-01, -3.4192e-01, -3.2717e-01,  3.0505e-01,  2.9974e-01,
        -4.1218e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([12833]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-7.8114e-01,  2.9078e-01, -2.6587e-01,  1.6201e+00, -1.3885e-01,
        -6.3873e-01, -1.6337e+00, -9.0372e-01, -2.8292e-01, -5.2687e-01,
        -7.4509e-01,  4.3381e-02, -2.0238e-02,  3.0761e-02, -4.9230e-01,
         6.2448e-01, -2.2009e-01,  9.7809e-02,  2.9115e-01,  3.1294e-01,
         5.2929e-01, -6.0036e-02, -4.0250e-02,  3.9724e-01,  1.5292e-02,
        -5.1123e-01, -6.5124e-01, -3.0669e-02, -8.6758e-01,  1.0285e+00,
         4.2996e-02, -1.3328e-01,  2.8588e-01, -2.1762e+00, -7.4250e-01,
        -1.8188e-01, -7.4501e-02, -4.8264e-01, -2.4550e-01, -1.1541e+00,
        -2.2444e-01,  1.0381e-01,  1.2773e-01, -1.1210e-01, -1.7610e-01,
        -7.0901e-01,  6.1741e-02,  1.6879e-01, -3.2922e-01,  4.3904e-01,
        -7.9419e-01, -7.1193e-01, -7.8809e-01, -5.3828e-01, -7.3540e-01,
         3.0973e-01, -1.0111e+00,  1.3383e-01, -3.5705e-01, -1.2404e-01,
         9.4415e-04, -3.8743e-01, -2.1083e-01,  4.4077e-01, -1.7325e-03,
        -3.9360e-01,  2.4403e-01,  3.5432e-01,  6.6354e-01, -4.2389e-01,
        -3.0142e-01, -2.3224e-02, -2.3187e-02, -6.3793e-01,  9.2474e-02,
         7.7075e-01,  2.2561e-03, -1.5449e-01, -8.9974e-02,  5.5197e-03,
         1.2261e-01,  3.2050e-01,  1.6015e-01, -2.3159e-02, -5.9930e-01,
        -1.3706e-01, -1.2925e-01, -3.5632e-01, -6.0520e-01, -1.3039e-01,
        -6.2087e-01,  1.4415e-03,  1.9779e-02, -1.7158e+00, -1.0605e+00,
        -1.0689e+00, -7.6335e-01, -1.8129e-01, -1.6174e+00, -4.3010e-01,
         2.2089e+00,  5.6988e-01, -6.5651e-02, -9.3425e-02,  2.1990e-01,
         8.1181e-01,  5.3960e-02,  1.4850e+00,  0.0000e+00,  3.7240e+00,
         3.0207e+00,  5.8686e-01,  1.2117e-01,  8.1395e+00, -3.4438e-01,
         1.5154e-02, -1.2073e-01, -1.4820e-01, -3.5350e+00,  6.5671e-01,
        -9.0136e-01,  1.8755e-01, -3.8519e-01,  2.1452e-01,  2.8088e-01,
        -4.2366e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2597]), tensor(0.0385))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:main_restricted.py:Testing data year: 2000
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 12852
            device: cpu
            
2024-07-29 00:46:08,447	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-29 00:46:08,505	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-29 00:46:08,548	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip' (1.43MiB) to Ray cluster...
2024-07-29 00:46:08,556	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip'.
2024-07-29 00:46:10,472	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-29 01:19:20,973	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_00-46-10' in 0.2261s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 105, 'num_layers': 3, 'num_embeddings': 12852, 'embedding_dim': 2, 'dropout_rate': 0.47, 'lr': 3.732215637767077e-06, 'weight_decay': 0.00019254484473270957, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.09517351495241504
INFO:model_data_nn.py:Best trial testing loss: 0.20150180577544727
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-29_00-46-05_552453_592478/artifacts/2024-07-29_00-46-10/train_fnn_2024-07-29_00-46-10/driver_artifacts/train_fnn_9f3f3_00068_68_dropout_rate=0.4700,embedding_dim=2,hidden_dim=105,lr=0.0000,num_layers=3,weight_decay=0.0002_2024-07-29_00-46-11
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 105, 'num_layers': 3, 'num_embeddings': 13377, 'embedding_dim': 2, 'dropout_rate': 0.47, 'lr': 3.732215637767077e-06, 'weight_decay': 0.00019254484473270957, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.11180021694218799, 'avg_test_loss': 0.2055599885172255}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10842762016881247, 'avg_test_loss': 0.20485295414081997}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.1067477410687902, 'avg_test_loss': 0.20465667804680943}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10597368860794594, 'avg_test_loss': 0.20476214282791175}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10544492361673634, 'avg_test_loss': 0.20447077180281104}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10526129063168171, 'avg_test_loss': 0.20435349426476196}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10494235677143064, 'avg_test_loss': 0.2042314440255896}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10491353334928251, 'avg_test_loss': 0.20423983421087974}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10481769617778652, 'avg_test_loss': 0.2044232185885665}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.1047030689730119, 'avg_test_loss': 0.20430516764809864}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10464575286559484, 'avg_test_loss': 0.20430298733879768}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10454127221239067, 'avg_test_loss': 0.20465251319997368}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10446691445614517, 'avg_test_loss': 0.20453759688617928}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10439383476020149, 'avg_test_loss': 0.2046489235446123}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10428738134726544, 'avg_test_loss': 0.20511738384430783}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.10416721443283428, 'avg_test_loss': 0.20498443593359775}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.10405317771325355, 'avg_test_loss': 0.20575923968793913}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.10395548019662891, 'avg_test_loss': 0.20576000291233262}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.10388223756803833, 'avg_test_loss': 0.20620673258478442}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.10376979003298153, 'avg_test_loss': 0.20655293566440897}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.10365111840954717, 'avg_test_loss': 0.20687497494786622}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.10365618627859534, 'avg_test_loss': 0.20742682665253856}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.10353185895759467, 'avg_test_loss': 0.2075341950569834}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.10343471698847989, 'avg_test_loss': 0.20859888162175638}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.10331592965746131, 'avg_test_loss': 0.20904169884133375}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.10327388396248532, 'avg_test_loss': 0.20860033697404323}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.1031167920151977, 'avg_test_loss': 0.21011246165393718}
INFO:model_data_nn.py:Early stopping at epoch 27
INFO:main_restricted.py:Making prediction for data in year: 2001
INFO:main_restricted.py:Prediction data shape: (21485,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2001: 0.45831142606241276
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  21485.000000  21485.000000
mean       0.078995     -0.006771
std        0.448298      0.055472
min       -0.977966     -0.522930
25%       -0.138629     -0.021358
50%        0.023648      0.004757
75%        0.215909      0.021443
max        7.399999      0.802396
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:transform_data_nn.py:Train_data: (353009, 161)

INFO:transform_data_nn.py:Test data years: [2001]
INFO:transform_data_nn.py:Test_data: (21485, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:transform_data_nn.py:Retrain_data: (374494, 161)

INFO:transform_data_nn.py:Prediction data years: [2002]
INFO:transform_data_nn.py:Prediction_data: (20629, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([353009, 138])
            y_train_tf: torch.Size([353009])

            x_test_tf: torch.Size([21485, 138])
            y_test_tf: torch.Size([21485])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([374494, 138])
            y_retrain_tf: torch.Size([374494])

            x_prediction_tf: torch.Size([20629, 138])
            y_prediction_tf: torch.Size([20629])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.5170e-01,  7.8169e-01,  7.9342e-02, -1.2365e+00, -1.6841e-01,
        -7.8872e-01, -1.6086e-01, -3.5673e-01,  4.3400e-01, -1.6062e-01,
        -6.8302e-01,  9.1437e-02, -5.0654e-01, -3.8443e-01,  1.1169e-01,
         4.8542e-01, -1.4517e-01,  2.4144e-01, -3.5083e-02,  5.0189e-01,
        -3.2631e-01,  2.2627e-03, -3.7241e-02, -5.7087e-03, -4.9664e-02,
        -2.7789e-01, -5.9548e-01, -3.0669e-02,  1.9746e-01,  1.3382e+00,
         3.6286e-01, -1.2000e-01,  4.9758e-01, -3.5242e-02, -2.8389e-01,
        -2.2792e-01,  3.7222e-02,  6.9911e-01, -5.3938e-02, -1.1400e+00,
        -2.9416e-01,  2.5646e-01,  2.4021e-01, -4.1841e-02, -1.9822e-01,
        -7.4495e-01,  8.4166e-02, -5.5735e-02, -4.0163e-01, -1.6177e-01,
        -7.9419e-01,  5.3171e-01, -4.3740e-02, -9.5275e-03, -2.6106e-02,
         4.2102e-01, -6.5470e-01,  7.9345e-02, -2.5267e-01, -4.1140e-02,
         1.2773e-01, -3.0794e-01,  1.2879e-01,  2.5580e-01,  1.1144e-01,
        -1.8088e-01,  4.3880e-01, -1.3207e-01,  6.6354e-01, -4.2059e-01,
        -3.0142e-01, -2.3224e-02, -2.3187e-02, -8.8797e-01,  1.8281e-01,
         6.6443e-01,  2.1081e-02, -3.8111e-01, -1.7609e-01,  5.5197e-03,
        -3.3395e-03,  1.6638e-01,  1.5014e-01, -2.6760e-01, -5.6123e-01,
        -1.4502e-01, -1.3371e-01, -2.7933e-01,  4.1315e-02,  1.9152e-01,
        -5.3593e-01, -1.2752e+00,  1.9779e-02,  1.5375e+00,  2.3052e+00,
         2.5731e+00, -8.0186e-02,  2.3788e+00, -2.8994e+00,  7.6530e-01,
        -7.7655e-01,  1.0315e-01, -6.5651e-02,  5.4512e-02,  2.1990e-01,
         1.5332e-01,  5.3323e-02,  2.6708e-01,  0.0000e+00, -1.4434e+00,
         9.0323e-01, -2.6043e+00,  1.6773e-01,  3.7569e-04, -3.4438e-01,
         1.5154e-02,  1.7938e-01, -1.9686e-01, -5.1633e-02, -1.2949e-01,
         1.2043e-01, -3.4192e-01, -3.2717e-01,  3.0505e-01,  2.9974e-01,
        -4.1218e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([12833]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-7.8114e-01,  2.9078e-01, -2.6587e-01,  1.6201e+00, -1.3885e-01,
        -6.3873e-01, -1.6337e+00, -9.0372e-01, -2.8292e-01, -5.2687e-01,
        -7.4509e-01,  4.3381e-02, -2.0238e-02,  3.0761e-02, -4.9230e-01,
         6.2448e-01, -2.2009e-01,  9.7809e-02,  2.9115e-01,  3.1294e-01,
         5.2929e-01, -6.0036e-02, -4.0250e-02,  3.9724e-01,  1.5292e-02,
        -5.1123e-01, -6.5124e-01, -3.0669e-02, -8.6758e-01,  1.0285e+00,
         4.2996e-02, -1.3328e-01,  2.8588e-01, -2.1762e+00, -7.4250e-01,
        -1.8188e-01, -7.4501e-02, -4.8264e-01, -2.4550e-01, -1.1541e+00,
        -2.2444e-01,  1.0381e-01,  1.2773e-01, -1.1210e-01, -1.7610e-01,
        -7.0901e-01,  6.1741e-02,  1.6879e-01, -3.2922e-01,  4.3904e-01,
        -7.9419e-01, -7.1193e-01, -7.8809e-01, -5.3828e-01, -7.3540e-01,
         3.0973e-01, -1.0111e+00,  1.3383e-01, -3.5705e-01, -1.2404e-01,
         9.4415e-04, -3.8743e-01, -2.1083e-01,  4.4077e-01, -1.7325e-03,
        -3.9360e-01,  2.4403e-01,  3.5432e-01,  6.6354e-01, -4.2389e-01,
        -3.0142e-01, -2.3224e-02, -2.3187e-02, -6.3793e-01,  9.2474e-02,
         7.7075e-01,  2.2561e-03, -1.5449e-01, -8.9974e-02,  5.5197e-03,
         1.2261e-01,  3.2050e-01,  1.6015e-01, -2.3159e-02, -5.9930e-01,
        -1.3706e-01, -1.2925e-01, -3.5632e-01, -6.0520e-01, -1.3039e-01,
        -6.2087e-01,  1.4415e-03,  1.9779e-02, -1.7158e+00, -1.0605e+00,
        -1.0689e+00, -7.6335e-01, -1.8129e-01, -1.6174e+00, -4.3010e-01,
         2.2089e+00,  5.6988e-01, -6.5651e-02, -9.3425e-02,  2.1990e-01,
         8.1181e-01,  5.3960e-02,  1.4850e+00,  0.0000e+00,  3.7240e+00,
         3.0207e+00,  5.8686e-01,  1.2117e-01,  8.1395e+00, -3.4438e-01,
         1.5154e-02, -1.2073e-01, -1.4820e-01, -3.5350e+00,  6.5671e-01,
        -9.0136e-01,  1.8755e-01, -3.8519e-01,  2.1452e-01,  2.8088e-01,
        -4.2366e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2597]), tensor(0.0385))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.5948e-01,  7.9738e-01,  8.4846e-02, -1.2304e+00, -1.6902e-01,
        -8.0273e-01, -1.5623e-01, -3.5426e-01,  3.9958e-01, -1.4777e-01,
        -6.8298e-01,  1.0336e-01, -5.0110e-01, -3.7410e-01,  1.0466e-01,
         4.8227e-01, -1.4280e-01,  2.3940e-01, -2.5912e-02,  5.1135e-01,
        -3.2847e-01, -1.0317e-02, -3.5884e-02, -6.6024e-04, -4.8149e-02,
        -2.7864e-01, -5.8734e-01, -4.2626e-02,  1.8062e-01,  1.3197e+00,
         3.5665e-01, -1.1922e-01,  4.9095e-01, -2.4000e-02, -2.7263e-01,
        -2.2900e-01,  3.1229e-02,  7.1063e-01, -5.7610e-02, -1.1426e+00,
        -2.9484e-01,  2.9418e-01,  2.4680e-01, -4.9661e-02, -1.9874e-01,
        -7.5286e-01,  1.0260e-01, -3.4387e-02, -3.8934e-01, -1.5192e-01,
        -8.0408e-01,  5.1870e-01, -3.3780e-02, -1.0439e-02, -2.4128e-02,
         4.2172e-01, -6.4519e-01,  7.6807e-02, -2.5008e-01, -5.1755e-02,
         1.3048e-01, -3.0504e-01,  1.2968e-01,  2.4632e-01,  1.0496e-01,
        -1.8426e-01,  4.4867e-01, -1.2992e-01,  6.6712e-01, -4.2231e-01,
        -3.0861e-01, -2.5502e-02, -2.5970e-02, -8.9653e-01,  1.9598e-01,
         6.6228e-01,  1.7156e-02, -3.8393e-01, -1.7519e-01,  2.7696e-03,
         3.9799e-03,  1.4937e-01,  1.4155e-01, -2.4625e-01, -5.6503e-01,
        -1.4898e-01, -1.3812e-01, -2.7864e-01,  5.1816e-02,  1.9193e-01,
        -5.4084e-01, -1.2749e+00,  2.0026e-02,  1.5713e+00,  2.3191e+00,
         2.6238e+00, -4.8888e-02,  2.4330e+00, -2.8916e+00,  8.0735e-01,
        -7.8575e-01,  1.0866e-01, -8.2531e-02,  4.1074e-02,  2.0973e-01,
         1.6476e-01,  6.7014e-02,  3.2513e-01,  0.0000e+00, -1.2120e+00,
         6.1685e-01, -2.6591e+00,  1.7333e-01, -4.0787e-02,  2.5658e-01,
        -2.8032e-03,  1.9923e-01, -1.9682e-01, -5.6867e-02, -1.3972e-01,
         1.2623e-01, -3.3013e-01, -3.1721e-01,  3.1352e-01,  3.0387e-01,
        -4.0598e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([13485]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-4.4287e-01, -2.9374e-01, -5.4204e-01,  1.7279e+00,  1.1068e-01,
        -7.2087e-01, -1.6152e+00, -8.8289e-01, -3.5977e-01, -4.7237e-01,
        -7.4387e-01,  5.6000e-02, -2.0076e-02,  6.2140e-01,  2.8911e-01,
         2.5104e+00, -8.6857e-02,  1.9387e-01,  2.3250e-01,  1.5336e+00,
        -4.4167e-01, -5.7489e-02, -3.1261e-02,  3.5916e-02, -4.7259e-02,
        -5.0918e-01, -6.4168e-01, -4.2626e-02, -6.3441e-01,  8.1874e-01,
        -2.6701e-01, -1.1631e-01,  3.2025e-01, -2.1190e+00, -7.6737e-01,
        -3.5389e-01, -4.6610e-01, -4.8687e-01, -1.6505e-01, -1.0107e+00,
        -2.2801e-01, -6.4754e-01,  4.9209e-01, -9.0698e-02,  1.8388e-02,
        -7.9447e-01,  1.5812e-01,  1.2287e-02, -2.2565e-01, -1.9925e-01,
        -1.8764e-02, -6.2600e-01, -7.1488e-01, -5.3412e-01, -2.4128e-02,
         3.3318e-01, -1.0038e+00, -6.4378e-03, -1.4118e-01, -2.7862e-01,
        -3.0280e-01, -3.6026e-01, -1.1666e+00,  1.0884e+00, -8.6625e-04,
        -7.0039e-01, -1.5700e-01,  1.0723e+00,  1.3394e+00, -4.5566e-01,
        -3.0861e-01, -2.5502e-02, -2.5970e-02, -7.8798e-01,  9.8336e-02,
         6.7502e-02, -1.6303e-03, -2.7010e-01,  1.2147e-01,  2.7696e-03,
         1.3074e-01,  8.3715e-01,  3.9455e-01, -8.6543e-02, -5.5960e-01,
        -1.3925e-01, -1.3336e-01, -3.5523e-01, -7.8780e-01,  4.8034e-01,
        -5.4792e-01, -1.2749e+00,  2.0026e-02, -1.3436e+00, -2.3871e+00,
        -1.0818e+00,  1.1173e-01, -1.8007e+00,  1.5578e+00,  7.1121e-01,
        -7.1365e-02,  2.5640e-01, -8.2531e-02,  3.6353e+00,  2.0973e-01,
         1.5160e+00,  5.2681e-02,  4.2382e-01,  0.0000e+00,  6.7511e-01,
         1.9415e+00, -2.3518e-01,  1.1899e-01,  1.3992e+01,  2.5658e-01,
        -2.8032e-03,  6.3074e-02, -2.0534e-01, -3.3755e+00,  6.0411e-01,
         5.7346e-01,  6.3479e-01, -3.2757e-01,  2.4583e-01,  3.5075e-01,
        -3.9729e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2365]), tensor(-0.0803))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:main_restricted.py:Testing data year: 2001
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 13377
            device: cpu
            
2024-07-29 02:23:38,416	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-29 02:23:38,482	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-29 02:23:38,539	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip' (1.43MiB) to Ray cluster...
2024-07-29 02:23:38,549	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip'.
2024-07-29 02:23:40,433	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-29 03:08:50,035	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_02-23-40' in 0.2609s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 13377, 'embedding_dim': 5, 'dropout_rate': 0.49, 'lr': 0.00979404150646356, 'weight_decay': 6.314559252945832e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10271587335079882
INFO:model_data_nn.py:Best trial testing loss: 0.20098266689594657
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-29_02-23-34_671161_592478/artifacts/2024-07-29_02-23-40/train_fnn_2024-07-29_02-23-40/driver_artifacts/train_fnn_3e185_00021_21_dropout_rate=0.4900,embedding_dim=5,hidden_dim=25,lr=0.0098,num_layers=1,weight_decay=0.0000_2024-07-29_02-23-40
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 14051, 'embedding_dim': 5, 'dropout_rate': 0.49, 'lr': 0.00979404150646356, 'weight_decay': 6.314559252945832e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10802458013579634, 'avg_test_loss': 0.2119096057149279}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10695836786132983, 'avg_test_loss': 0.15683058643534825}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10669339896700072, 'avg_test_loss': 0.18820601653296143}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1068929202871824, 'avg_test_loss': 0.15832587814206495}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10692520671062664, 'avg_test_loss': 0.14527420399151167}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10679332912541255, 'avg_test_loss': 0.15214895499126277}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10676899671279515, 'avg_test_loss': 0.20013472420558473}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10689309728081166, 'avg_test_loss': 0.15030216324163295}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10688339715969652, 'avg_test_loss': 0.14175376529594877}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.10687086142190826, 'avg_test_loss': 0.1463177099293415}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10685343779540739, 'avg_test_loss': 0.14222705948971004}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10701851710585464, 'avg_test_loss': 0.12486426106685825}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10702865112110033, 'avg_test_loss': 0.14669520330064623}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10701333356559929, 'avg_test_loss': 0.13926823831656399}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10718093947571906, 'avg_test_loss': 0.13755423730187372}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.10696374707132797, 'avg_test_loss': 0.13218058314716483}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.10710649967634195, 'avg_test_loss': 0.1448404596766728}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.10706180418580337, 'avg_test_loss': 0.14327719130613856}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.10735157990347136, 'avg_test_loss': 0.1315428467334793}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.10710243667583957, 'avg_test_loss': 0.13757691825321952}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.10708762601672472, 'avg_test_loss': 0.13690325715247506}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.10721547059285663, 'avg_test_loss': 0.14578903988926403}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.10712843984359097, 'avg_test_loss': 0.13259822764540605}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.10718951506565329, 'avg_test_loss': 0.14552445114581578}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.10704725754796349, 'avg_test_loss': 0.13741825353757886}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.10700020943536726, 'avg_test_loss': 0.18947328336467684}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.1071424922205341, 'avg_test_loss': 0.18597269790598853}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.10706684489769011, 'avg_test_loss': 0.13179175981288724}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.10724924721264356, 'avg_test_loss': 0.15213537416291126}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.1071371584723208, 'avg_test_loss': 0.13129931620838287}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.10700742840013062, 'avg_test_loss': 0.16375545164333777}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.10711375855124622, 'avg_test_loss': 0.1435874846616858}
INFO:model_data_nn.py:Early stopping at epoch 32
INFO:main_restricted.py:Making prediction for data in year: 2002
INFO:main_restricted.py:Prediction data shape: (20629,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2002: 0.37918336691899857
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  20629.000000  20629.000000
mean      -0.024597      0.101080
std        0.347899      0.128021
min       -0.987768     -0.166848
25%       -0.201179      0.011432
50%       -0.018143      0.045105
75%        0.112728      0.155150
max        8.604649      2.623686
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:transform_data_nn.py:Train_data: (374494, 161)

INFO:transform_data_nn.py:Test data years: [2002]
INFO:transform_data_nn.py:Test_data: (20629, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:transform_data_nn.py:Retrain_data: (395123, 161)

INFO:transform_data_nn.py:Prediction data years: [2003]
INFO:transform_data_nn.py:Prediction_data: (19044, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([374494, 138])
            y_train_tf: torch.Size([374494])

            x_test_tf: torch.Size([20629, 138])
            y_test_tf: torch.Size([20629])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([395123, 138])
            y_retrain_tf: torch.Size([395123])

            x_prediction_tf: torch.Size([19044, 138])
            y_prediction_tf: torch.Size([19044])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.5948e-01,  7.9738e-01,  8.4846e-02, -1.2304e+00, -1.6902e-01,
        -8.0273e-01, -1.5623e-01, -3.5426e-01,  3.9958e-01, -1.4777e-01,
        -6.8298e-01,  1.0336e-01, -5.0110e-01, -3.7410e-01,  1.0466e-01,
         4.8227e-01, -1.4280e-01,  2.3940e-01, -2.5912e-02,  5.1135e-01,
        -3.2847e-01, -1.0317e-02, -3.5884e-02, -6.6024e-04, -4.8149e-02,
        -2.7864e-01, -5.8734e-01, -4.2626e-02,  1.8062e-01,  1.3197e+00,
         3.5665e-01, -1.1922e-01,  4.9095e-01, -2.4000e-02, -2.7263e-01,
        -2.2900e-01,  3.1229e-02,  7.1063e-01, -5.7610e-02, -1.1426e+00,
        -2.9484e-01,  2.9418e-01,  2.4680e-01, -4.9661e-02, -1.9874e-01,
        -7.5286e-01,  1.0260e-01, -3.4387e-02, -3.8934e-01, -1.5192e-01,
        -8.0408e-01,  5.1870e-01, -3.3780e-02, -1.0439e-02, -2.4128e-02,
         4.2172e-01, -6.4519e-01,  7.6807e-02, -2.5008e-01, -5.1755e-02,
         1.3048e-01, -3.0504e-01,  1.2968e-01,  2.4632e-01,  1.0496e-01,
        -1.8426e-01,  4.4867e-01, -1.2992e-01,  6.6712e-01, -4.2231e-01,
        -3.0861e-01, -2.5502e-02, -2.5970e-02, -8.9653e-01,  1.9598e-01,
         6.6228e-01,  1.7156e-02, -3.8393e-01, -1.7519e-01,  2.7696e-03,
         3.9799e-03,  1.4937e-01,  1.4155e-01, -2.4625e-01, -5.6503e-01,
        -1.4898e-01, -1.3812e-01, -2.7864e-01,  5.1816e-02,  1.9193e-01,
        -5.4084e-01, -1.2749e+00,  2.0026e-02,  1.5713e+00,  2.3191e+00,
         2.6238e+00, -4.8888e-02,  2.4330e+00, -2.8916e+00,  8.0735e-01,
        -7.8575e-01,  1.0866e-01, -8.2531e-02,  4.1074e-02,  2.0973e-01,
         1.6476e-01,  6.7014e-02,  3.2513e-01,  0.0000e+00, -1.2120e+00,
         6.1685e-01, -2.6591e+00,  1.7333e-01, -4.0787e-02,  2.5658e-01,
        -2.8032e-03,  1.9923e-01, -1.9682e-01, -5.6867e-02, -1.3972e-01,
         1.2623e-01, -3.3013e-01, -3.1721e-01,  3.1352e-01,  3.0387e-01,
        -4.0598e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([13485]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-4.4287e-01, -2.9374e-01, -5.4204e-01,  1.7279e+00,  1.1068e-01,
        -7.2087e-01, -1.6152e+00, -8.8289e-01, -3.5977e-01, -4.7237e-01,
        -7.4387e-01,  5.6000e-02, -2.0076e-02,  6.2140e-01,  2.8911e-01,
         2.5104e+00, -8.6857e-02,  1.9387e-01,  2.3250e-01,  1.5336e+00,
        -4.4167e-01, -5.7489e-02, -3.1261e-02,  3.5916e-02, -4.7259e-02,
        -5.0918e-01, -6.4168e-01, -4.2626e-02, -6.3441e-01,  8.1874e-01,
        -2.6701e-01, -1.1631e-01,  3.2025e-01, -2.1190e+00, -7.6737e-01,
        -3.5389e-01, -4.6610e-01, -4.8687e-01, -1.6505e-01, -1.0107e+00,
        -2.2801e-01, -6.4754e-01,  4.9209e-01, -9.0698e-02,  1.8388e-02,
        -7.9447e-01,  1.5812e-01,  1.2287e-02, -2.2565e-01, -1.9925e-01,
        -1.8764e-02, -6.2600e-01, -7.1488e-01, -5.3412e-01, -2.4128e-02,
         3.3318e-01, -1.0038e+00, -6.4378e-03, -1.4118e-01, -2.7862e-01,
        -3.0280e-01, -3.6026e-01, -1.1666e+00,  1.0884e+00, -8.6625e-04,
        -7.0039e-01, -1.5700e-01,  1.0723e+00,  1.3394e+00, -4.5566e-01,
        -3.0861e-01, -2.5502e-02, -2.5970e-02, -7.8798e-01,  9.8336e-02,
         6.7502e-02, -1.6303e-03, -2.7010e-01,  1.2147e-01,  2.7696e-03,
         1.3074e-01,  8.3715e-01,  3.9455e-01, -8.6543e-02, -5.5960e-01,
        -1.3925e-01, -1.3336e-01, -3.5523e-01, -7.8780e-01,  4.8034e-01,
        -5.4792e-01, -1.2749e+00,  2.0026e-02, -1.3436e+00, -2.3871e+00,
        -1.0818e+00,  1.1173e-01, -1.8007e+00,  1.5578e+00,  7.1121e-01,
        -7.1365e-02,  2.5640e-01, -8.2531e-02,  3.6353e+00,  2.0973e-01,
         1.5160e+00,  5.2681e-02,  4.2382e-01,  0.0000e+00,  6.7511e-01,
         1.9415e+00, -2.3518e-01,  1.1899e-01,  1.3992e+01,  2.5658e-01,
        -2.8032e-03,  6.3074e-02, -2.0534e-01, -3.3755e+00,  6.0411e-01,
         5.7346e-01,  6.3479e-01, -3.2757e-01,  2.4583e-01,  3.5075e-01,
        -3.9729e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2365]), tensor(-0.0803))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.1721,  0.8169,  0.0877, -1.2257, -0.1545, -0.8123, -0.1512, -0.3522,
         0.3872, -0.1460, -0.6854,  0.1167, -0.5019, -0.3625,  0.0933,  0.4887,
        -0.1408,  0.2354, -0.0296,  0.5302, -0.3156, -0.0091, -0.0217,  0.0065,
        -0.0416, -0.2792, -0.5852, -0.0476,  0.1669,  1.2601,  0.3529, -0.1106,
         0.4891, -0.0130, -0.2599, -0.2270,  0.0428,  0.7302, -0.0530, -1.1471,
        -0.2949,  0.3037,  0.2660, -0.0537, -0.1905, -0.7562,  0.1054, -0.0320,
        -0.3746, -0.1430, -0.8155,  0.5058, -0.0278, -0.0101, -0.0254,  0.4245,
        -0.6363,  0.0705, -0.2477, -0.0593,  0.1311, -0.3040,  0.1315,  0.2389,
         0.1082, -0.1871,  0.4608, -0.1317,  0.6682, -0.4242, -0.3163, -0.0290,
        -0.0281, -0.9017,  0.2114,  0.6740,  0.0206, -0.3871, -0.1750,  0.0070,
         0.0030,  0.1589,  0.1422, -0.2264, -0.5652, -0.1529, -0.1430, -0.2799,
         0.0578,  0.1904, -0.5441, -1.2752,  0.0177,  1.6195,  2.2608,  2.6944,
        -0.0770,  2.4012, -2.8918,  0.7793, -0.8087,  0.1255, -0.0708,  0.0343,
         0.2038,  0.1479,  0.0641,  0.3696,  0.0000, -1.1930,  0.5757, -2.7203,
         0.1787, -0.0059,  0.1861, -0.0220,  0.2206, -0.1949, -0.0243, -0.1542,
         0.1332, -0.3190, -0.3039,  0.3248,  0.3097, -0.4046,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([13714]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-2.5336e-02, -5.8967e-01,  2.6355e-01,  1.8283e+00, -7.8493e-01,
        -5.6450e-01, -1.5599e+00, -8.6559e-01, -6.3206e-03, -4.0300e-01,
        -7.3615e-01,  4.7545e-02, -3.8138e+00,  1.1509e+00,  4.0747e-01,
        -1.9625e+00, -1.8073e-01, -3.7805e-01, -2.9584e-02, -1.6946e+00,
        -1.4442e-01, -5.4114e-02, -2.8901e-02, -5.3617e-01,  5.9445e-02,
        -5.3774e-01, -6.4346e-01, -4.7607e-02, -9.3981e-01,  1.6137e+00,
        -5.0386e-01, -2.2148e-01,  2.2793e-01, -1.3010e-02, -7.7083e-01,
        -2.8453e-01, -1.1733e-01, -5.9279e-01, -4.4790e-01, -1.0745e+00,
        -2.3711e-01, -9.7715e-01, -4.8021e-01, -1.9589e-02, -6.5586e-01,
        -7.2864e-01, -6.4279e-01, -7.3818e-01,  1.8440e-01, -4.9875e-01,
         7.6192e-01, -8.4593e-01, -5.3885e-01, -5.3208e-01, -7.3365e-01,
         2.0043e-01, -9.9670e-01,  2.1175e-01, -3.4891e-01, -3.2963e-01,
         1.3873e-02, -3.8471e-01,  4.2228e-01,  2.2273e-01,  1.1131e-03,
         3.3247e-01, -1.3915e+00,  9.3603e-01, -3.8710e-03, -4.8603e-01,
        -3.1634e-01, -2.9030e-02, -2.8083e-02, -6.2110e-01,  1.0375e-01,
        -1.2465e+00,  2.4416e+00, -1.9944e-01,  1.7855e-01,  6.9553e-03,
         3.0438e-03, -8.5565e-01,  6.1390e-01,  7.9496e-02, -4.7733e-01,
        -1.4182e-01, -1.3799e-01, -3.4533e-01, -3.7077e-01,  1.5252e+00,
        -4.8922e-01,  1.1568e+00,  1.7699e-02, -6.5983e-01, -1.2441e+00,
        -3.9940e-01,  7.6469e-01, -1.8165e+00,  1.1497e+00,  5.8451e-01,
         3.2179e-01, -1.7415e+00, -7.0821e-02,  1.8081e+00,  2.0381e-01,
         2.4351e+00,  1.5858e-02,  3.6960e-01,  0.0000e+00, -1.4863e+00,
        -7.2142e-01, -4.2507e-01,  1.2173e-01,  9.6193e+00,  1.8612e-01,
        -2.1954e-02, -1.0043e-01, -2.6332e-01, -3.3450e+00,  7.2723e-01,
         3.0019e-01,  5.6778e-01, -3.6925e-01,  1.5503e-01,  1.5877e-01,
        -3.6994e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2189]), tensor(0.0590))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:main_restricted.py:Testing data year: 2002
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 14051
            device: cpu
            
2024-07-29 04:13:45,008	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-29 04:13:45,065	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-29 04:13:45,117	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip' (1.43MiB) to Ray cluster...
2024-07-29 04:13:45,129	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip'.
2024-07-29 04:13:47,001	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-29 05:13:44,545	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_04-13-46' in 0.2628s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 135, 'num_layers': 4, 'num_embeddings': 14051, 'embedding_dim': 5, 'dropout_rate': 0.47, 'lr': 1.4551749476072273e-06, 'weight_decay': 0.000368452707362187, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.1097411329789083
INFO:model_data_nn.py:Best trial testing loss: 0.12232238027172007
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-29_04-13-42_255409_592478/artifacts/2024-07-29_04-13-46/train_fnn_2024-07-29_04-13-46/driver_artifacts/train_fnn_9feaa_00052_52_dropout_rate=0.4700,embedding_dim=5,hidden_dim=135,lr=0.0000,num_layers=4,weight_decay=0.0004_2024-07-29_04-13-47
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 135, 'num_layers': 4, 'num_embeddings': 14292, 'embedding_dim': 5, 'dropout_rate': 0.47, 'lr': 1.4551749476072273e-06, 'weight_decay': 0.000368452707362187, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.11976171359625007, 'avg_test_loss': 0.17772741153861252}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.11710488443650159, 'avg_test_loss': 0.17502900709291833}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.1154235021633493, 'avg_test_loss': 0.17356147293326438}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1144641565010205, 'avg_test_loss': 0.1722688061066422}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.11366770313121831, 'avg_test_loss': 0.17189037591693984}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.11312065405353829, 'avg_test_loss': 0.17105280394797157}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.1127233826292043, 'avg_test_loss': 0.17098797005194946}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.1123044606127423, 'avg_test_loss': 0.1704904967481458}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.11208390117068162, 'avg_test_loss': 0.1703219726219173}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.11195009227171625, 'avg_test_loss': 0.16911173445616393}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.11177556169373655, 'avg_test_loss': 0.1700004472478524}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.11166176693500411, 'avg_test_loss': 0.16986474802330037}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.11159793430510544, 'avg_test_loss': 0.16993719593765552}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.11151891475383155, 'avg_test_loss': 0.16957067396341755}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.11140039792381229, 'avg_test_loss': 0.1694396777803566}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.1113688846434218, 'avg_test_loss': 0.16943141959307578}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.11132800353006936, 'avg_test_loss': 0.16915826110056784}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.11133548475635384, 'avg_test_loss': 0.16926775297037508}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.11130229091501383, 'avg_test_loss': 0.16903967594715372}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.11126294443871124, 'avg_test_loss': 0.1689751630948994}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.11127966712323248, 'avg_test_loss': 0.1688172683157277}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.11119310956290808, 'avg_test_loss': 0.16885217510463807}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.11120215218641538, 'avg_test_loss': 0.16864699034032807}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.11119390308926969, 'avg_test_loss': 0.1689529733094793}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.11116877977343881, 'avg_test_loss': 0.16873344422111775}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.11113651606521169, 'avg_test_loss': 0.16849561070010766}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.11115308124713857, 'avg_test_loss': 0.16832978505291193}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.11112519783156001, 'avg_test_loss': 0.16847356888871864}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.11105878287967051, 'avg_test_loss': 0.1681641490892476}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.11106534064463003, 'avg_test_loss': 0.16827710686664052}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.11105274422784911, 'avg_test_loss': 0.16810814556259437}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.11102360627595405, 'avg_test_loss': 0.16812325412119994}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.110975498158262, 'avg_test_loss': 0.16773110978155328}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.11098153119740524, 'avg_test_loss': 0.16788287824582335}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.11092717322300188, 'avg_test_loss': 0.16759847333942285}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.11092084360446389, 'avg_test_loss': 0.16758622445991175}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.1108839016379968, 'avg_test_loss': 0.16743249594915233}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.11076099765736705, 'avg_test_loss': 0.16766756264205346}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.11080532119513312, 'avg_test_loss': 0.16716603098449692}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.11079476583732761, 'avg_test_loss': 0.16702031235416864}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.11075447185881401, 'avg_test_loss': 0.16687069678891625}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.11067065819747904, 'avg_test_loss': 0.1668157122979228}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.11066134082279869, 'avg_test_loss': 0.16655670366431244}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.11066925468425079, 'avg_test_loss': 0.1667159987088518}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.11058242318322878, 'avg_test_loss': 0.16613966785371304}
INFO:model_data_nn.py:Epoch 46/50, metrics: {'avg_train_loss': 0.11057027208166359, 'avg_test_loss': 0.1663927322116074}
INFO:model_data_nn.py:Epoch 47/50, metrics: {'avg_train_loss': 0.11051086417753742, 'avg_test_loss': 0.16578721674471694}
INFO:model_data_nn.py:Epoch 48/50, metrics: {'avg_train_loss': 0.11051368444165881, 'avg_test_loss': 0.16564272911031575}
INFO:model_data_nn.py:Epoch 49/50, metrics: {'avg_train_loss': 0.1104470695156671, 'avg_test_loss': 0.1653968899279533}
INFO:model_data_nn.py:Epoch 50/50, metrics: {'avg_train_loss': 0.11038100558925869, 'avg_test_loss': 0.1653214575997835}
INFO:main_restricted.py:Making prediction for data in year: 2003
INFO:main_restricted.py:Prediction data shape: (19044,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2003: 0.40661588854297354
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  19044.000000  19044.000000
mean       0.157039      0.035234
std        0.390767      0.018074
min       -0.964285     -0.145370
25%       -0.023484      0.028843
50%        0.087272      0.032857
75%        0.245431      0.039821
max       11.166664      0.160449
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:transform_data_nn.py:Train_data: (395123, 161)

INFO:transform_data_nn.py:Test data years: [2003]
INFO:transform_data_nn.py:Test_data: (19044, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:transform_data_nn.py:Retrain_data: (414167, 161)

INFO:transform_data_nn.py:Prediction data years: [2004]
INFO:transform_data_nn.py:Prediction_data: (17992, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([395123, 138])
            y_train_tf: torch.Size([395123])

            x_test_tf: torch.Size([19044, 138])
            y_test_tf: torch.Size([19044])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([414167, 138])
            y_retrain_tf: torch.Size([414167])

            x_prediction_tf: torch.Size([17992, 138])
            y_prediction_tf: torch.Size([17992])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-0.1721,  0.8169,  0.0877, -1.2257, -0.1545, -0.8123, -0.1512, -0.3522,
         0.3872, -0.1460, -0.6854,  0.1167, -0.5019, -0.3625,  0.0933,  0.4887,
        -0.1408,  0.2354, -0.0296,  0.5302, -0.3156, -0.0091, -0.0217,  0.0065,
        -0.0416, -0.2792, -0.5852, -0.0476,  0.1669,  1.2601,  0.3529, -0.1106,
         0.4891, -0.0130, -0.2599, -0.2270,  0.0428,  0.7302, -0.0530, -1.1471,
        -0.2949,  0.3037,  0.2660, -0.0537, -0.1905, -0.7562,  0.1054, -0.0320,
        -0.3746, -0.1430, -0.8155,  0.5058, -0.0278, -0.0101, -0.0254,  0.4245,
        -0.6363,  0.0705, -0.2477, -0.0593,  0.1311, -0.3040,  0.1315,  0.2389,
         0.1082, -0.1871,  0.4608, -0.1317,  0.6682, -0.4242, -0.3163, -0.0290,
        -0.0281, -0.9017,  0.2114,  0.6740,  0.0206, -0.3871, -0.1750,  0.0070,
         0.0030,  0.1589,  0.1422, -0.2264, -0.5652, -0.1529, -0.1430, -0.2799,
         0.0578,  0.1904, -0.5441, -1.2752,  0.0177,  1.6195,  2.2608,  2.6944,
        -0.0770,  2.4012, -2.8918,  0.7793, -0.8087,  0.1255, -0.0708,  0.0343,
         0.2038,  0.1479,  0.0641,  0.3696,  0.0000, -1.1930,  0.5757, -2.7203,
         0.1787, -0.0059,  0.1861, -0.0220,  0.2206, -0.1949, -0.0243, -0.1542,
         0.1332, -0.3190, -0.3039,  0.3248,  0.3097, -0.4046,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([13714]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-2.5336e-02, -5.8967e-01,  2.6355e-01,  1.8283e+00, -7.8493e-01,
        -5.6450e-01, -1.5599e+00, -8.6559e-01, -6.3206e-03, -4.0300e-01,
        -7.3615e-01,  4.7545e-02, -3.8138e+00,  1.1509e+00,  4.0747e-01,
        -1.9625e+00, -1.8073e-01, -3.7805e-01, -2.9584e-02, -1.6946e+00,
        -1.4442e-01, -5.4114e-02, -2.8901e-02, -5.3617e-01,  5.9445e-02,
        -5.3774e-01, -6.4346e-01, -4.7607e-02, -9.3981e-01,  1.6137e+00,
        -5.0386e-01, -2.2148e-01,  2.2793e-01, -1.3010e-02, -7.7083e-01,
        -2.8453e-01, -1.1733e-01, -5.9279e-01, -4.4790e-01, -1.0745e+00,
        -2.3711e-01, -9.7715e-01, -4.8021e-01, -1.9589e-02, -6.5586e-01,
        -7.2864e-01, -6.4279e-01, -7.3818e-01,  1.8440e-01, -4.9875e-01,
         7.6192e-01, -8.4593e-01, -5.3885e-01, -5.3208e-01, -7.3365e-01,
         2.0043e-01, -9.9670e-01,  2.1175e-01, -3.4891e-01, -3.2963e-01,
         1.3873e-02, -3.8471e-01,  4.2228e-01,  2.2273e-01,  1.1131e-03,
         3.3247e-01, -1.3915e+00,  9.3603e-01, -3.8710e-03, -4.8603e-01,
        -3.1634e-01, -2.9030e-02, -2.8083e-02, -6.2110e-01,  1.0375e-01,
        -1.2465e+00,  2.4416e+00, -1.9944e-01,  1.7855e-01,  6.9553e-03,
         3.0438e-03, -8.5565e-01,  6.1390e-01,  7.9496e-02, -4.7733e-01,
        -1.4182e-01, -1.3799e-01, -3.4533e-01, -3.7077e-01,  1.5252e+00,
        -4.8922e-01,  1.1568e+00,  1.7699e-02, -6.5983e-01, -1.2441e+00,
        -3.9940e-01,  7.6469e-01, -1.8165e+00,  1.1497e+00,  5.8451e-01,
         3.2179e-01, -1.7415e+00, -7.0821e-02,  1.8081e+00,  2.0381e-01,
         2.4351e+00,  1.5858e-02,  3.6960e-01,  0.0000e+00, -1.4863e+00,
        -7.2142e-01, -4.2507e-01,  1.2173e-01,  9.6193e+00,  1.8612e-01,
        -2.1954e-02, -1.0043e-01, -2.6332e-01, -3.3450e+00,  7.2723e-01,
         3.0019e-01,  5.6778e-01, -3.6925e-01,  1.5503e-01,  1.5877e-01,
        -3.6994e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2189]), tensor(0.0590))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.7691e-01,  8.3472e-01,  8.5007e-02, -1.2235e+00, -1.4235e-01,
        -8.1628e-01, -1.4754e-01, -3.5021e-01,  3.8305e-01, -1.4563e-01,
        -6.8896e-01,  1.2245e-01, -5.0418e-01, -3.6553e-01,  9.3019e-02,
         4.8990e-01, -1.3791e-01,  2.3091e-01, -3.0420e-02,  5.4392e-01,
        -3.3311e-01, -5.8796e-03, -7.6251e-03,  5.1652e-03, -3.5088e-02,
        -2.7885e-01, -5.8781e-01, -5.2735e-02,  1.5159e-01,  1.2634e+00,
         3.4677e-01, -1.0361e-01,  4.9157e-01, -1.4596e-03, -2.5149e-01,
        -2.1879e-01,  6.4771e-02,  7.4599e-01, -4.2716e-02, -1.1523e+00,
        -2.9324e-01,  3.0206e-01,  2.8339e-01, -5.5354e-02, -1.8354e-01,
        -7.5452e-01,  1.0882e-01, -3.2442e-02, -3.6424e-01, -1.5474e-01,
        -8.2628e-01,  4.9218e-01, -2.3628e-02, -1.0290e-02, -2.6877e-02,
         4.2518e-01, -6.2827e-01,  6.3533e-02, -2.4676e-01, -5.2799e-02,
         1.2926e-01, -3.0352e-01,  1.3475e-01,  2.3676e-01,  1.0897e-01,
        -1.8733e-01,  4.7246e-01, -1.3229e-01,  6.5685e-01, -4.2552e-01,
        -3.2324e-01, -3.1691e-02, -2.9137e-02, -9.0115e-01,  2.1909e-01,
         6.8209e-01,  2.4920e-02, -3.8959e-01, -1.7514e-01,  9.7928e-03,
        -4.8798e-03,  1.6975e-01,  1.4553e-01, -2.0250e-01, -5.6435e-01,
        -1.5537e-01, -1.4633e-01, -2.8138e-01,  6.3534e-02,  1.8839e-01,
        -5.4800e-01, -1.2762e+00,  1.6181e-02,  1.6713e+00,  2.3090e+00,
         2.7658e+00, -8.5525e-02,  2.3631e+00, -2.9202e+00,  7.7779e-01,
        -8.3307e-01,  1.3847e-01,  2.7372e-01,  5.5249e-02,  4.1898e-01,
         1.3040e-01,  5.1610e-02,  2.9600e-01,  0.0000e+00, -1.0849e+00,
         6.1663e-01, -2.7300e+00,  1.8042e-01, -2.3450e-03,  1.6970e-01,
        -2.1652e-02,  2.4078e-01, -1.9235e-01, -4.7087e-02, -1.5893e-01,
         1.3417e-01, -3.0851e-01, -2.9324e-01,  3.3125e-01,  3.1256e-01,
        -4.0709e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([13856]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.3032e-01, -3.2863e-01, -5.4621e-01,  1.9187e+00, -1.3604e-02,
        -4.1048e-01, -1.4297e+00, -8.5045e-01,  2.0488e-01,  2.9088e-01,
        -3.9718e-01,  5.2314e-02, -8.5454e-02,  8.8066e-01,  3.4494e-01,
        -2.8047e-01, -2.1841e-01,  2.1148e-01, -3.0420e-02, -1.2082e-01,
         2.7830e-01, -5.4898e-02, -2.0056e-03,  3.0199e-01, -1.1484e-02,
        -5.4956e-01, -6.3334e-01, -5.2735e-02, -9.7430e-01,  1.5681e+00,
         5.7532e-02, -2.3687e-01,  1.8167e-01, -1.4596e-03, -8.5417e-01,
        -2.5726e-01, -1.6822e-01, -5.9864e-01, -2.9938e-01, -6.4472e-01,
        -2.4293e-01,  6.3351e-01,  7.7548e-02,  2.3678e-01, -3.4791e-02,
        -6.7028e-01, -5.2449e-01, -5.4741e-02, -5.2849e-01, -1.7863e-01,
         7.5579e-01, -9.5859e-01, -7.0035e-01, -5.3131e-01, -2.6877e-02,
         1.0805e-01, -9.9068e-01,  1.2342e-02, -2.4363e-01,  2.7336e-02,
         1.1204e-01, -8.0581e-02, -4.9904e-02, -4.7279e-02, -8.4790e-04,
        -3.4607e-01, -2.5287e+00,  5.8546e-01,  1.3277e+00, -4.7879e-01,
        -3.2324e-01, -3.1691e-02, -2.9137e-02, -6.9785e-01,  7.2630e-02,
         5.1817e-01, -1.7032e-01, -2.5562e-01,  5.3902e-02,  9.7928e-03,
        -4.8798e-03, -5.1251e-01,  6.5282e-01, -1.5843e-01, -9.1988e-02,
        -1.3942e-01, -1.3948e-01,  2.7220e-01, -3.3671e-01, -3.1625e+00,
        -2.2754e-01, -2.3453e-01,  1.6181e-02, -9.7372e-01, -4.0657e-01,
        -6.9811e-01, -2.8577e-01, -1.7511e+00,  1.4865e+00, -6.6536e-02,
        -6.1298e-01, -1.3437e-01, -3.7728e+00,  1.1455e-01,  2.1749e+00,
         1.6659e+00,  5.7954e-02,  2.9600e-01,  1.0163e+00, -1.8067e+00,
        -1.0412e+00,  1.2836e-01,  1.1798e-01,  7.2003e+00,  1.6970e-01,
        -2.1652e-02, -2.6242e-01, -1.3663e-01, -3.3328e+00,  7.9554e-01,
        -4.1379e-01,  3.2971e-02, -4.7902e-01,  1.1867e-01,  1.0595e-01,
        -3.5654e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3271]), tensor(0.2185))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:main_restricted.py:Testing data year: 2003
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 14292
            device: cpu
            
2024-07-29 06:44:43,324	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-29 06:44:43,389	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-29 06:44:43,443	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip' (1.43MiB) to Ray cluster...
2024-07-29 06:44:43,450	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip'.
2024-07-29 06:44:45,439	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-29 07:08:01,634	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_06-44-45' in 0.2166s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 2, 'num_embeddings': 14292, 'embedding_dim': 5, 'dropout_rate': 0.02, 'lr': 0.0005456725485601479, 'weight_decay': 2.091498132903563e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.09947542360792637
INFO:model_data_nn.py:Best trial testing loss: 0.14105056461896873
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-29_06-44-40_471988_592478/artifacts/2024-07-29_06-44-45/train_fnn_2024-07-29_06-44-45/driver_artifacts/train_fnn_b72a9_00005_5_dropout_rate=0.0200,embedding_dim=5,hidden_dim=85,lr=0.0005,num_layers=2,weight_decay=0.0000_2024-07-29_06-44-45
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 2, 'num_embeddings': 14438, 'embedding_dim': 5, 'dropout_rate': 0.02, 'lr': 0.0005456725485601479, 'weight_decay': 2.091498132903563e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10575589837209645, 'avg_test_loss': 0.10219342555480858}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.0995417811521108, 'avg_test_loss': 0.09342119590451954}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.09652914557352102, 'avg_test_loss': 0.10720963891040772}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.09463186108762967, 'avg_test_loss': 0.10920239326458239}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.09339240856158956, 'avg_test_loss': 0.11736509270622586}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.09241587979328438, 'avg_test_loss': 0.12360791164509793}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.09179159817493804, 'avg_test_loss': 0.1176436057063282}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.09116554227727419, 'avg_test_loss': 0.1254560601441784}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.09078164982736535, 'avg_test_loss': 0.11900337944005399}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.09037626302812443, 'avg_test_loss': 0.10294552723355327}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.0901382998117909, 'avg_test_loss': 0.13396260255273987}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.0896424152204006, 'avg_test_loss': 0.11968423947956122}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.0894033243582332, 'avg_test_loss': 0.1570003551318713}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.08888735213773068, 'avg_test_loss': 0.12410630530790023}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.08855777847985177, 'avg_test_loss': 0.14108433871668705}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.0882811343032257, 'avg_test_loss': 0.1591939547475665}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.08793718240126965, 'avg_test_loss': 0.10883878152289078}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.08763454178397981, 'avg_test_loss': 0.13411106130914063}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.08761072640205494, 'avg_test_loss': 0.1562982072379995}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.08691732264885926, 'avg_test_loss': 0.11492635799796445}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.08693205969636415, 'avg_test_loss': 0.13073066860463814}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.08655628596889173, 'avg_test_loss': 0.14702281887570384}
INFO:model_data_nn.py:Early stopping at epoch 22
INFO:main_restricted.py:Making prediction for data in year: 2004
INFO:main_restricted.py:Prediction data shape: (17992,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2004: 0.38359916555174456
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  17992.000000  17992.000000
mean       0.052419      0.272081
std        0.280720      0.149261
min       -0.938679     -0.286075
25%       -0.068413      0.180502
50%        0.026063      0.243899
75%        0.139854      0.326548
max       11.611828      2.404580
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:transform_data_nn.py:Train_data: (414167, 161)

INFO:transform_data_nn.py:Test data years: [2004]
INFO:transform_data_nn.py:Test_data: (17992, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]
INFO:transform_data_nn.py:Retrain_data: (432159, 161)

INFO:transform_data_nn.py:Prediction data years: [2005]
INFO:transform_data_nn.py:Prediction_data: (17457, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([414167, 138])
            y_train_tf: torch.Size([414167])

            x_test_tf: torch.Size([17992, 138])
            y_test_tf: torch.Size([17992])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([432159, 138])
            y_retrain_tf: torch.Size([432159])

            x_prediction_tf: torch.Size([17457, 138])
            y_prediction_tf: torch.Size([17457])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.7691e-01,  8.3472e-01,  8.5007e-02, -1.2235e+00, -1.4235e-01,
        -8.1628e-01, -1.4754e-01, -3.5021e-01,  3.8305e-01, -1.4563e-01,
        -6.8896e-01,  1.2245e-01, -5.0418e-01, -3.6553e-01,  9.3019e-02,
         4.8990e-01, -1.3791e-01,  2.3091e-01, -3.0420e-02,  5.4392e-01,
        -3.3311e-01, -5.8796e-03, -7.6251e-03,  5.1652e-03, -3.5088e-02,
        -2.7885e-01, -5.8781e-01, -5.2735e-02,  1.5159e-01,  1.2634e+00,
         3.4677e-01, -1.0361e-01,  4.9157e-01, -1.4596e-03, -2.5149e-01,
        -2.1879e-01,  6.4771e-02,  7.4599e-01, -4.2716e-02, -1.1523e+00,
        -2.9324e-01,  3.0206e-01,  2.8339e-01, -5.5354e-02, -1.8354e-01,
        -7.5452e-01,  1.0882e-01, -3.2442e-02, -3.6424e-01, -1.5474e-01,
        -8.2628e-01,  4.9218e-01, -2.3628e-02, -1.0290e-02, -2.6877e-02,
         4.2518e-01, -6.2827e-01,  6.3533e-02, -2.4676e-01, -5.2799e-02,
         1.2926e-01, -3.0352e-01,  1.3475e-01,  2.3676e-01,  1.0897e-01,
        -1.8733e-01,  4.7246e-01, -1.3229e-01,  6.5685e-01, -4.2552e-01,
        -3.2324e-01, -3.1691e-02, -2.9137e-02, -9.0115e-01,  2.1909e-01,
         6.8209e-01,  2.4920e-02, -3.8959e-01, -1.7514e-01,  9.7928e-03,
        -4.8798e-03,  1.6975e-01,  1.4553e-01, -2.0250e-01, -5.6435e-01,
        -1.5537e-01, -1.4633e-01, -2.8138e-01,  6.3534e-02,  1.8839e-01,
        -5.4800e-01, -1.2762e+00,  1.6181e-02,  1.6713e+00,  2.3090e+00,
         2.7658e+00, -8.5525e-02,  2.3631e+00, -2.9202e+00,  7.7779e-01,
        -8.3307e-01,  1.3847e-01,  2.7372e-01,  5.5249e-02,  4.1898e-01,
         1.3040e-01,  5.1610e-02,  2.9600e-01,  0.0000e+00, -1.0849e+00,
         6.1663e-01, -2.7300e+00,  1.8042e-01, -2.3450e-03,  1.6970e-01,
        -2.1652e-02,  2.4078e-01, -1.9235e-01, -4.7087e-02, -1.5893e-01,
         1.3417e-01, -3.0851e-01, -2.9324e-01,  3.3125e-01,  3.1256e-01,
        -4.0709e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([13856]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-3.3032e-01, -3.2863e-01, -5.4621e-01,  1.9187e+00, -1.3604e-02,
        -4.1048e-01, -1.4297e+00, -8.5045e-01,  2.0488e-01,  2.9088e-01,
        -3.9718e-01,  5.2314e-02, -8.5454e-02,  8.8066e-01,  3.4494e-01,
        -2.8047e-01, -2.1841e-01,  2.1148e-01, -3.0420e-02, -1.2082e-01,
         2.7830e-01, -5.4898e-02, -2.0056e-03,  3.0199e-01, -1.1484e-02,
        -5.4956e-01, -6.3334e-01, -5.2735e-02, -9.7430e-01,  1.5681e+00,
         5.7532e-02, -2.3687e-01,  1.8167e-01, -1.4596e-03, -8.5417e-01,
        -2.5726e-01, -1.6822e-01, -5.9864e-01, -2.9938e-01, -6.4472e-01,
        -2.4293e-01,  6.3351e-01,  7.7548e-02,  2.3678e-01, -3.4791e-02,
        -6.7028e-01, -5.2449e-01, -5.4741e-02, -5.2849e-01, -1.7863e-01,
         7.5579e-01, -9.5859e-01, -7.0035e-01, -5.3131e-01, -2.6877e-02,
         1.0805e-01, -9.9068e-01,  1.2342e-02, -2.4363e-01,  2.7336e-02,
         1.1204e-01, -8.0581e-02, -4.9904e-02, -4.7279e-02, -8.4790e-04,
        -3.4607e-01, -2.5287e+00,  5.8546e-01,  1.3277e+00, -4.7879e-01,
        -3.2324e-01, -3.1691e-02, -2.9137e-02, -6.9785e-01,  7.2630e-02,
         5.1817e-01, -1.7032e-01, -2.5562e-01,  5.3902e-02,  9.7928e-03,
        -4.8798e-03, -5.1251e-01,  6.5282e-01, -1.5843e-01, -9.1988e-02,
        -1.3942e-01, -1.3948e-01,  2.7220e-01, -3.3671e-01, -3.1625e+00,
        -2.2754e-01, -2.3453e-01,  1.6181e-02, -9.7372e-01, -4.0657e-01,
        -6.9811e-01, -2.8577e-01, -1.7511e+00,  1.4865e+00, -6.6536e-02,
        -6.1298e-01, -1.3437e-01, -3.7728e+00,  1.1455e-01,  2.1749e+00,
         1.6659e+00,  5.7954e-02,  2.9600e-01,  1.0163e+00, -1.8067e+00,
        -1.0412e+00,  1.2836e-01,  1.1798e-01,  7.2003e+00,  1.6970e-01,
        -2.1652e-02, -2.6242e-01, -1.3663e-01, -3.3328e+00,  7.9554e-01,
        -4.1379e-01,  3.2971e-02, -4.7902e-01,  1.1867e-01,  1.0595e-01,
        -3.5654e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3271]), tensor(0.2185))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.7339e-01,  8.4992e-01,  8.6402e-02, -1.5400e+00, -1.3984e-01,
        -8.1489e-01, -1.4654e-01, -3.4958e-01,  3.9916e-01, -1.8746e-01,
        -6.9306e-01,  8.2659e-02, -7.0223e-01, -4.8380e-01,  6.9990e-02,
         4.9457e-01, -1.3871e-01,  2.0506e-01, -6.7835e-02,  5.5422e-01,
        -4.0333e-01, -4.8444e-02, -1.4951e-01,  2.5652e-03, -8.8841e-02,
        -3.3848e-01, -5.8921e-01, -5.3741e-02,  4.8661e-01,  1.3565e+00,
         3.4964e-01, -1.4058e-01,  7.6665e-01,  2.7734e-01, -2.4610e-01,
        -2.4994e-01,  8.2909e-02,  7.5973e-01, -3.4617e-02, -1.1520e+00,
        -2.8875e-01,  2.2615e-01,  2.9726e-01,  4.0419e-02, -1.7960e-01,
        -7.4955e-01,  8.0036e-02, -3.8337e-02, -3.6052e-01, -1.6278e-01,
        -8.3355e-01,  4.6937e-01, -4.7447e-01,  9.0737e-02, -2.9689e-02,
         5.0327e-01, -6.2055e-01, -1.9281e-01, -2.5044e-01, -4.9213e-02,
        -2.9842e-05, -3.0736e-01,  5.7393e-02,  2.2353e-01,  9.0457e-02,
        -1.9447e-01,  6.7320e-01, -2.6768e-01,  6.4575e-01, -5.6356e-01,
        -3.2740e-01, -1.6271e-01, -2.9131e-02, -8.9527e-01,  1.7078e-01,
         7.0712e-01,  8.1884e-01, -1.1273e+00,  2.7984e-01,  1.1873e-02,
        -8.0590e-01,  1.7475e-01,  3.0779e-01, -1.7584e-01, -5.6411e-01,
        -4.3099e-01, -5.2815e-01, -2.7993e-01,  6.7890e-02,  1.0498e-01,
        -5.5481e-01, -1.3403e+00,  2.2558e-01, -1.1102e-16, -1.1102e-16,
         2.8310e+00, -8.4100e-02,  2.3541e+00, -2.9417e+00,  8.0874e-01,
        -8.2351e-01,  1.4608e-01,  1.2037e-01,  5.9782e-02,  3.0659e-01,
         1.2993e-01, -1.1979e-01,  2.9014e-01, -7.2199e-01, -1.0192e+00,
         6.5536e-01,  0.0000e+00,  3.4953e-01, -1.1306e-03,  1.4251e-01,
         9.3818e-04,  2.5949e-01, -2.3872e-01,  1.9013e-02, -5.7219e-01,
         1.3201e-01, -2.9745e-01, -3.9589e-01,  3.5383e-01,  3.7347e-01,
        -4.0906e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([13985]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-2.9738e-01,  7.5153e-01, -6.9859e-01,  1.3755e+00, -4.7087e-01,
        -1.8759e-01, -1.3375e+00, -8.3761e-01, -1.2325e-01,  1.9891e-02,
        -6.0898e-01, -2.3867e-01, -7.0223e-01, -1.3589e+00, -1.6912e+00,
        -9.6042e-01, -2.2222e-01, -5.5459e-01, -6.7835e-02,  8.6479e-01,
        -2.0320e-01, -1.2217e-01, -1.4458e-01, -7.0472e-01, -1.4384e-01,
        -7.3254e-01, -6.3916e-01, -5.3741e-02, -9.4243e-01, -4.9568e-01,
        -4.1341e-02, -4.7921e-01, -2.1638e-01,  2.7734e-01, -9.1269e-01,
        -6.3703e-01, -4.3146e-01, -6.1478e-01, -6.3603e-01, -5.6854e-01,
        -2.2993e-01,  1.1130e-01, -5.8439e-02,  3.2993e-01, -3.5401e-01,
         2.4189e-01, -2.4694e-01,  1.0455e+00, -8.3080e-01, -4.6759e-01,
        -1.6254e+00, -9.0452e-01, -4.7447e-01, -6.6976e-01, -7.3519e-01,
        -3.5698e-01, -9.8539e-01, -4.7531e-01,  1.4565e-01, -3.0306e-01,
        -7.5482e-02, -3.7464e-01, -1.7277e+00,  2.4459e-01, -2.7491e-02,
        -8.1128e-01,  1.7903e+00,  9.8129e-01, -2.0372e+00, -6.8266e-01,
        -3.2740e-01, -1.6271e-01, -2.9131e-02, -1.7443e-01, -2.0096e-01,
        -3.0484e-01,  8.1884e-01, -4.3326e-01,  1.4848e+00,  1.1873e-02,
        -8.0590e-01, -5.8506e-01,  6.3879e-01,  1.0993e+00,  1.7163e-01,
        -3.0619e-01, -4.2956e-01, -1.4078e-01, -4.0739e-01,  5.5157e-01,
        -2.6339e-01, -1.0277e+00,  2.2558e-01, -1.1102e-16, -1.1102e-16,
        -4.7159e-01,  5.8371e-02, -1.1678e+00,  3.1160e-01, -8.0709e-01,
        -6.8757e-01,  2.6424e-01,  1.2037e-01, -2.2485e-01,  3.0659e-01,
         8.8114e-01, -2.1660e-01,  2.9014e-01,  1.5035e+00, -5.2377e-01,
        -7.3882e-01,  0.0000e+00, -8.0589e-02,  5.2052e+00,  1.4251e-01,
         9.3818e-04, -1.1305e-01, -2.2258e-01,  1.9013e-02,  1.0175e+00,
        -1.1796e+00,  9.2318e-03, -7.3617e-01, -1.5035e-02, -3.5734e-01,
        -3.1233e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3218]), tensor(0.0304))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:main_restricted.py:Testing data year: 2004
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 14438
            device: cpu
            
2024-07-29 08:16:21,858	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-29 08:16:21,910	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-29 08:16:21,952	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip' (1.43MiB) to Ray cluster...
2024-07-29 08:16:21,961	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip'.
2024-07-29 08:16:23,904	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-29 09:00:46,971	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_08-16-23' in 0.2614s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 14438, 'embedding_dim': 10, 'dropout_rate': 0.22, 'lr': 1.0672476836323728e-06, 'weight_decay': 1.1727009450102268e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.11377765518991532
INFO:model_data_nn.py:Best trial testing loss: 0.07878552067443623
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-29_08-16-18_989366_592478/artifacts/2024-07-29_08-16-23/train_fnn_2024-07-29_08-16-23/driver_artifacts/train_fnn_8481c_00002_2_dropout_rate=0.2200,embedding_dim=10,hidden_dim=5,lr=0.0000,num_layers=4,weight_decay=0.0000_2024-07-29_08-16-24
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 14571, 'embedding_dim': 10, 'dropout_rate': 0.22, 'lr': 1.0672476836323728e-06, 'weight_decay': 1.1727009450102268e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.11443212562874047, 'avg_test_loss': 0.050243532725169765}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.11360874219319753, 'avg_test_loss': 0.0501879539422609}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.11312107024416415, 'avg_test_loss': 0.050229024182964155}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.11280951034321816, 'avg_test_loss': 0.050278822567327554}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.11262075868528998, 'avg_test_loss': 0.05037688939480773}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.11252148553560228, 'avg_test_loss': 0.05050111111021522}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.11247512805292172, 'avg_test_loss': 0.05056631479125757}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.11241851062502853, 'avg_test_loss': 0.05067001672755012}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.11241242132134188, 'avg_test_loss': 0.05069824342612491}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.11242289530495138, 'avg_test_loss': 0.050703352743643765}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.11239660281458455, 'avg_test_loss': 0.05073400993828044}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.11240818324637869, 'avg_test_loss': 0.050753451218562465}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.11240710534312061, 'avg_test_loss': 0.05078848465704001}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.11238822279833434, 'avg_test_loss': 0.05080134520177548}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.11237894131066013, 'avg_test_loss': 0.05078925226129346}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.11237000274473043, 'avg_test_loss': 0.050788307889968486}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.11236844706361213, 'avg_test_loss': 0.050809539963692536}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.11237141367663757, 'avg_test_loss': 0.05082555673675332}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.1123650771628081, 'avg_test_loss': 0.05084872306171027}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.11236638443238847, 'avg_test_loss': 0.05081337686600812}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.1123523257286023, 'avg_test_loss': 0.050860355621811015}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.11235864220989285, 'avg_test_loss': 0.05082710760376065}
INFO:model_data_nn.py:Early stopping at epoch 22
INFO:main_restricted.py:Making prediction for data in year: 2005
INFO:main_restricted.py:Prediction data shape: (17457,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2005: 0.22548286070664364
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  17457.000000  17457.000000
mean       0.011168      0.037970
std        0.223895      0.003471
min       -0.888060      0.030794
25%       -0.092593      0.034971
50%        0.000000      0.039140
75%        0.096127      0.040357
max        3.573606      0.061728
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]
INFO:transform_data_nn.py:Train_data: (432159, 161)

INFO:transform_data_nn.py:Test data years: [2005]
INFO:transform_data_nn.py:Test_data: (17457, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]
INFO:transform_data_nn.py:Retrain_data: (449616, 161)

INFO:transform_data_nn.py:Prediction data years: [2006]
INFO:transform_data_nn.py:Prediction_data: (17129, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([432159, 138])
            y_train_tf: torch.Size([432159])

            x_test_tf: torch.Size([17457, 138])
            y_test_tf: torch.Size([17457])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([449616, 138])
            y_retrain_tf: torch.Size([449616])

            x_prediction_tf: torch.Size([17129, 138])
            y_prediction_tf: torch.Size([17129])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.7339e-01,  8.4992e-01,  8.6402e-02, -1.5400e+00, -1.3984e-01,
        -8.1489e-01, -1.4654e-01, -3.4958e-01,  3.9916e-01, -1.8746e-01,
        -6.9306e-01,  8.2659e-02, -7.0223e-01, -4.8380e-01,  6.9990e-02,
         4.9457e-01, -1.3871e-01,  2.0506e-01, -6.7835e-02,  5.5422e-01,
        -4.0333e-01, -4.8444e-02, -1.4951e-01,  2.5652e-03, -8.8841e-02,
        -3.3848e-01, -5.8921e-01, -5.3741e-02,  4.8661e-01,  1.3565e+00,
         3.4964e-01, -1.4058e-01,  7.6665e-01,  2.7734e-01, -2.4610e-01,
        -2.4994e-01,  8.2909e-02,  7.5973e-01, -3.4617e-02, -1.1520e+00,
        -2.8875e-01,  2.2615e-01,  2.9726e-01,  4.0419e-02, -1.7960e-01,
        -7.4955e-01,  8.0036e-02, -3.8337e-02, -3.6052e-01, -1.6278e-01,
        -8.3355e-01,  4.6937e-01, -4.7447e-01,  9.0737e-02, -2.9689e-02,
         5.0327e-01, -6.2055e-01, -1.9281e-01, -2.5044e-01, -4.9213e-02,
        -2.9842e-05, -3.0736e-01,  5.7393e-02,  2.2353e-01,  9.0457e-02,
        -1.9447e-01,  6.7320e-01, -2.6768e-01,  6.4575e-01, -5.6356e-01,
        -3.2740e-01, -1.6271e-01, -2.9131e-02, -8.9527e-01,  1.7078e-01,
         7.0712e-01,  8.1884e-01, -1.1273e+00,  2.7984e-01,  1.1873e-02,
        -8.0590e-01,  1.7475e-01,  3.0779e-01, -1.7584e-01, -5.6411e-01,
        -4.3099e-01, -5.2815e-01, -2.7993e-01,  6.7890e-02,  1.0498e-01,
        -5.5481e-01, -1.3403e+00,  2.2558e-01, -1.1102e-16, -1.1102e-16,
         2.8310e+00, -8.4100e-02,  2.3541e+00, -2.9417e+00,  8.0874e-01,
        -8.2351e-01,  1.4608e-01,  1.2037e-01,  5.9782e-02,  3.0659e-01,
         1.2993e-01, -1.1979e-01,  2.9014e-01, -7.2199e-01, -1.0192e+00,
         6.5536e-01,  0.0000e+00,  3.4953e-01, -1.1306e-03,  1.4251e-01,
         9.3818e-04,  2.5949e-01, -2.3872e-01,  1.9013e-02, -5.7219e-01,
         1.3201e-01, -2.9745e-01, -3.9589e-01,  3.5383e-01,  3.7347e-01,
        -4.0906e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([13985]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-2.9738e-01,  7.5153e-01, -6.9859e-01,  1.3755e+00, -4.7087e-01,
        -1.8759e-01, -1.3375e+00, -8.3761e-01, -1.2325e-01,  1.9891e-02,
        -6.0898e-01, -2.3867e-01, -7.0223e-01, -1.3589e+00, -1.6912e+00,
        -9.6042e-01, -2.2222e-01, -5.5459e-01, -6.7835e-02,  8.6479e-01,
        -2.0320e-01, -1.2217e-01, -1.4458e-01, -7.0472e-01, -1.4384e-01,
        -7.3254e-01, -6.3916e-01, -5.3741e-02, -9.4243e-01, -4.9568e-01,
        -4.1341e-02, -4.7921e-01, -2.1638e-01,  2.7734e-01, -9.1269e-01,
        -6.3703e-01, -4.3146e-01, -6.1478e-01, -6.3603e-01, -5.6854e-01,
        -2.2993e-01,  1.1130e-01, -5.8439e-02,  3.2993e-01, -3.5401e-01,
         2.4189e-01, -2.4694e-01,  1.0455e+00, -8.3080e-01, -4.6759e-01,
        -1.6254e+00, -9.0452e-01, -4.7447e-01, -6.6976e-01, -7.3519e-01,
        -3.5698e-01, -9.8539e-01, -4.7531e-01,  1.4565e-01, -3.0306e-01,
        -7.5482e-02, -3.7464e-01, -1.7277e+00,  2.4459e-01, -2.7491e-02,
        -8.1128e-01,  1.7903e+00,  9.8129e-01, -2.0372e+00, -6.8266e-01,
        -3.2740e-01, -1.6271e-01, -2.9131e-02, -1.7443e-01, -2.0096e-01,
        -3.0484e-01,  8.1884e-01, -4.3326e-01,  1.4848e+00,  1.1873e-02,
        -8.0590e-01, -5.8506e-01,  6.3879e-01,  1.0993e+00,  1.7163e-01,
        -3.0619e-01, -4.2956e-01, -1.4078e-01, -4.0739e-01,  5.5157e-01,
        -2.6339e-01, -1.0277e+00,  2.2558e-01, -1.1102e-16, -1.1102e-16,
        -4.7159e-01,  5.8371e-02, -1.1678e+00,  3.1160e-01, -8.0709e-01,
        -6.8757e-01,  2.6424e-01,  1.2037e-01, -2.2485e-01,  3.0659e-01,
         8.8114e-01, -2.1660e-01,  2.9014e-01,  1.5035e+00, -5.2377e-01,
        -7.3882e-01,  0.0000e+00, -8.0589e-02,  5.2052e+00,  1.4251e-01,
         9.3818e-04, -1.1305e-01, -2.2258e-01,  1.9013e-02,  1.0175e+00,
        -1.1796e+00,  9.2318e-03, -7.3617e-01, -1.5035e-02, -3.5734e-01,
        -3.1233e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3218]), tensor(0.0304))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.6422e-01,  8.6080e-01,  8.0949e-02, -1.5621e+00, -1.3976e-01,
        -8.1094e-01, -1.4697e-01, -3.4954e-01,  4.1537e-01, -1.8795e-01,
        -6.9693e-01,  8.2605e-02, -7.0770e-01, -4.9074e-01,  7.3805e-02,
         4.9764e-01, -1.3815e-01,  2.0290e-01, -6.9999e-02,  5.5934e-01,
        -4.0490e-01, -4.1744e-02, -1.5407e-01,  1.8748e-03, -9.1832e-02,
        -3.3960e-01, -5.9071e-01, -5.7244e-02,  4.6754e-01,  1.3738e+00,
         3.5024e-01, -1.4165e-01,  7.6981e-01,  2.8198e-01, -2.4116e-01,
        -2.4579e-01,  9.2161e-02,  7.7175e-01, -3.3033e-02, -1.1472e+00,
        -2.8446e-01,  2.3391e-01,  3.0662e-01,  4.5647e-02, -1.7822e-01,
        -7.4199e-01,  8.2041e-02, -4.1488e-02, -3.6932e-01, -1.6307e-01,
        -8.3499e-01,  4.4570e-01, -4.7374e-01,  9.2545e-02, -3.0536e-02,
         5.0296e-01, -6.1273e-01, -1.9017e-01, -2.5170e-01, -4.4054e-02,
        -2.2158e-04, -3.0818e-01,  5.7115e-02,  2.2379e-01,  8.7802e-02,
        -1.9619e-01,  6.8851e-01, -2.6471e-01,  6.3766e-01, -5.6636e-01,
        -3.3152e-01, -1.6558e-01, -2.7076e-02, -8.8590e-01,  1.7233e-01,
         7.1465e-01,  8.3127e-01, -1.1374e+00,  2.8092e-01,  1.2594e-02,
        -8.0267e-01,  1.7327e-01,  3.2426e-01, -1.5055e-01, -5.6491e-01,
        -4.3553e-01, -5.3387e-01, -2.7841e-01,  7.2082e-02,  1.0874e-01,
        -5.6271e-01, -1.3407e+00,  2.2904e-01,  2.2204e-16,  2.2204e-16,
         2.8940e+00, -7.7924e-02,  2.3965e+00, -2.9751e+00,  8.4022e-01,
        -8.0438e-01,  1.5074e-01,  7.5235e-02,  6.0721e-02,  2.6063e-01,
         1.1586e-01, -1.2327e-01,  3.0730e-01, -2.0687e-01, -1.0137e+00,
         6.9188e-01, -1.5987e-14,  3.4390e-01, -1.5249e-02,  9.6888e-02,
         1.0166e-02,  2.7608e-01, -2.3681e-01,  1.8715e-02, -5.6817e-01,
         1.3303e-01, -2.8778e-01, -3.9345e-01,  3.5348e-01,  3.7222e-01,
        -4.1032e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([14243]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-8.9436e-01,  2.7926e-01, -6.7114e-01,  1.3445e+00, -5.2880e-01,
        -4.3378e-01, -1.0141e+00, -7.7123e-01, -2.4467e-01, -4.9815e-02,
        -7.3268e-01, -8.0459e-02, -7.0770e-01,  5.8780e-02, -3.3090e-01,
         2.5502e-01, -1.7869e-01,  5.2572e-02, -6.9999e-02, -3.7305e-01,
        -5.0599e-01, -1.2324e-01, -5.7890e-01,  3.8417e-01, -1.4942e-02,
        -6.2659e-01, -6.4159e-01, -5.7244e-02, -5.2518e-01, -5.3078e-01,
         6.7170e-01,  2.0342e-01,  3.7467e-01,  2.8198e-01, -6.5708e-01,
        -5.2567e-01, -5.6965e-01, -6.2066e-01, -3.9137e-01, -3.1491e-02,
        -2.4998e-01, -1.4061e-01, -2.9828e-01, -1.3421e-01, -5.6056e-01,
        -5.9725e-01,  4.1602e-01,  1.0068e-01, -4.0347e-01, -1.8266e-02,
        -8.3499e-01, -7.0011e-01, -4.7374e-01, -6.6924e-01, -7.3494e-01,
         2.9534e-01, -9.8023e-01, -3.7871e-01,  3.2971e-01, -2.5926e-01,
         2.7893e+00,  5.4242e-02,  2.2839e-01,  5.1967e-01, -2.6811e-02,
        -8.7968e-02,  4.2001e-02,  1.5137e+00,  6.3766e-01, -6.5300e-01,
        -3.3152e-01, -1.6558e-01, -2.7076e-02, -6.4940e-01,  2.6099e-02,
        -4.2064e-01,  8.3127e-01, -2.4464e-01,  1.4851e+00,  1.2594e-02,
        -8.0267e-01, -3.1879e-01,  1.5017e-01,  1.7888e-01, -2.6315e-01,
        -3.2150e-01, -4.4246e-01, -3.3687e-01, -4.3354e-01, -7.1419e-01,
        -1.7664e-01, -3.3816e-01,  2.2904e-01,  2.2204e-16,  2.2204e-16,
        -2.8560e-01, -5.1299e-01, -5.2471e-01, -1.0677e+00, -1.0559e-01,
        -8.2387e-01, -7.1678e-01, -2.5612e+00, -1.0892e+00,  1.6737e+00,
        -2.9122e-01, -1.2170e-01,  3.0730e-01,  1.4516e-01, -2.1263e-01,
        -8.4793e-01, -1.5987e-14,  1.4162e-01,  5.7856e+00,  9.6888e-02,
         1.0166e-02, -1.0840e-02, -4.4751e-01,  1.8715e-02,  9.5791e-02,
         8.6070e-01,  7.2908e-02, -4.6831e-01,  2.5641e-01,  2.8608e-01,
        -3.3344e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3166]), tensor(0.1390))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]
INFO:main_restricted.py:Testing data year: 2005
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 14571
            device: cpu
            
2024-07-29 10:13:40,836	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-29 10:13:40,896	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-29 10:13:40,960	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_eb0c34e50646badb.zip' (1.43MiB) to Ray cluster...
2024-07-29 10:13:40,968	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_eb0c34e50646badb.zip'.
2024-07-29 10:13:42,932	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-29 11:08:38,798	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 30.28 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-07-29 11:16:23,928	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_10-13-42' in 0.2825s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 175, 'num_layers': 5, 'num_embeddings': 14571, 'embedding_dim': 10, 'dropout_rate': 0.51, 'lr': 1.457050032975656e-06, 'weight_decay': 3.212219315322692e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.11185569800403393
INFO:model_data_nn.py:Best trial testing loss: 0.050175365937307426
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-29_10-13-37_102683_592478/artifacts/2024-07-29_10-13-42/train_fnn_2024-07-29_10-13-42/driver_artifacts/train_fnn_e8183_00097_97_dropout_rate=0.5100,embedding_dim=10,hidden_dim=175,lr=0.0000,num_layers=5,weight_decay=0.0000_2024-07-29_10-13-43
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 175, 'num_layers': 5, 'num_embeddings': 14834, 'embedding_dim': 10, 'dropout_rate': 0.51, 'lr': 1.457050032975656e-06, 'weight_decay': 3.212219315322692e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.12175944692405517, 'avg_test_loss': 0.051848614963688956}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.11806885517735922, 'avg_test_loss': 0.05182574811016223}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.11568905366167055, 'avg_test_loss': 0.051562842972048405}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.11409184704153563, 'avg_test_loss': 0.05154362860580545}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.1129318032360692, 'avg_test_loss': 0.05148688863281772}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.11215003810292673, 'avg_test_loss': 0.051488838436554614}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.1116306614234142, 'avg_test_loss': 0.051512393179530304}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.11127132633482222, 'avg_test_loss': 0.05152099978512348}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.11084903033576189, 'avg_test_loss': 0.05151931161005328}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.11065505357346501, 'avg_test_loss': 0.0515195000569211}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.1105104313302931, 'avg_test_loss': 0.0515391325557243}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.11036491859505397, 'avg_test_loss': 0.05150326812264523}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.11030975727768767, 'avg_test_loss': 0.05151766812804141}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.11019222567964915, 'avg_test_loss': 0.051555095125795966}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.1101407284896781, 'avg_test_loss': 0.05151776720269291}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.11011244261657216, 'avg_test_loss': 0.05152760197603102}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.11009094842175997, 'avg_test_loss': 0.051528405790814934}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.11006437489385071, 'avg_test_loss': 0.0515150732270428}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.11003710527437013, 'avg_test_loss': 0.05151346961467235}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.11003270656798446, 'avg_test_loss': 0.05153784995773501}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.11002971114743222, 'avg_test_loss': 0.05150820436512134}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.11000162526302278, 'avg_test_loss': 0.05151547130489194}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.10995803015538594, 'avg_test_loss': 0.05152026839457007}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.10998190189304088, 'avg_test_loss': 0.051520310807973146}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.10997149515751206, 'avg_test_loss': 0.05153937089090138}
INFO:model_data_nn.py:Early stopping at epoch 25
INFO:main_restricted.py:Making prediction for data in year: 2006
INFO:main_restricted.py:Prediction data shape: (17129,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2006: 0.22712575952067196
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  17129.000000  17129.000000
mean       0.041924      0.030328
std        0.226924      0.002054
min       -0.891239      0.016718
25%       -0.066391      0.029409
50%        0.021390      0.030762
75%        0.123542      0.031710
max        3.713501      0.035018
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]
INFO:transform_data_nn.py:Train_data: (449616, 161)

INFO:transform_data_nn.py:Test data years: [2006]
INFO:transform_data_nn.py:Test_data: (17129, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]
INFO:transform_data_nn.py:Retrain_data: (466745, 161)

INFO:transform_data_nn.py:Prediction data years: [2007]
INFO:transform_data_nn.py:Prediction_data: (16760, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([449616, 138])
            y_train_tf: torch.Size([449616])

            x_test_tf: torch.Size([17129, 138])
            y_test_tf: torch.Size([17129])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([466745, 138])
            y_retrain_tf: torch.Size([466745])

            x_prediction_tf: torch.Size([16760, 138])
            y_prediction_tf: torch.Size([16760])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.6422e-01,  8.6080e-01,  8.0949e-02, -1.5621e+00, -1.3976e-01,
        -8.1094e-01, -1.4697e-01, -3.4954e-01,  4.1537e-01, -1.8795e-01,
        -6.9693e-01,  8.2605e-02, -7.0770e-01, -4.9074e-01,  7.3805e-02,
         4.9764e-01, -1.3815e-01,  2.0290e-01, -6.9999e-02,  5.5934e-01,
        -4.0490e-01, -4.1744e-02, -1.5407e-01,  1.8748e-03, -9.1832e-02,
        -3.3960e-01, -5.9071e-01, -5.7244e-02,  4.6754e-01,  1.3738e+00,
         3.5024e-01, -1.4165e-01,  7.6981e-01,  2.8198e-01, -2.4116e-01,
        -2.4579e-01,  9.2161e-02,  7.7175e-01, -3.3033e-02, -1.1472e+00,
        -2.8446e-01,  2.3391e-01,  3.0662e-01,  4.5647e-02, -1.7822e-01,
        -7.4199e-01,  8.2041e-02, -4.1488e-02, -3.6932e-01, -1.6307e-01,
        -8.3499e-01,  4.4570e-01, -4.7374e-01,  9.2545e-02, -3.0536e-02,
         5.0296e-01, -6.1273e-01, -1.9017e-01, -2.5170e-01, -4.4054e-02,
        -2.2158e-04, -3.0818e-01,  5.7115e-02,  2.2379e-01,  8.7802e-02,
        -1.9619e-01,  6.8851e-01, -2.6471e-01,  6.3766e-01, -5.6636e-01,
        -3.3152e-01, -1.6558e-01, -2.7076e-02, -8.8590e-01,  1.7233e-01,
         7.1465e-01,  8.3127e-01, -1.1374e+00,  2.8092e-01,  1.2594e-02,
        -8.0267e-01,  1.7327e-01,  3.2426e-01, -1.5055e-01, -5.6491e-01,
        -4.3553e-01, -5.3387e-01, -2.7841e-01,  7.2082e-02,  1.0874e-01,
        -5.6271e-01, -1.3407e+00,  2.2904e-01,  2.2204e-16,  2.2204e-16,
         2.8940e+00, -7.7924e-02,  2.3965e+00, -2.9751e+00,  8.4022e-01,
        -8.0438e-01,  1.5074e-01,  7.5235e-02,  6.0721e-02,  2.6063e-01,
         1.1586e-01, -1.2327e-01,  3.0730e-01, -2.0687e-01, -1.0137e+00,
         6.9188e-01, -1.5987e-14,  3.4390e-01, -1.5249e-02,  9.6888e-02,
         1.0166e-02,  2.7608e-01, -2.3681e-01,  1.8715e-02, -5.6817e-01,
         1.3303e-01, -2.8778e-01, -3.9345e-01,  3.5348e-01,  3.7222e-01,
        -4.1032e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([14243]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-8.9436e-01,  2.7926e-01, -6.7114e-01,  1.3445e+00, -5.2880e-01,
        -4.3378e-01, -1.0141e+00, -7.7123e-01, -2.4467e-01, -4.9815e-02,
        -7.3268e-01, -8.0459e-02, -7.0770e-01,  5.8780e-02, -3.3090e-01,
         2.5502e-01, -1.7869e-01,  5.2572e-02, -6.9999e-02, -3.7305e-01,
        -5.0599e-01, -1.2324e-01, -5.7890e-01,  3.8417e-01, -1.4942e-02,
        -6.2659e-01, -6.4159e-01, -5.7244e-02, -5.2518e-01, -5.3078e-01,
         6.7170e-01,  2.0342e-01,  3.7467e-01,  2.8198e-01, -6.5708e-01,
        -5.2567e-01, -5.6965e-01, -6.2066e-01, -3.9137e-01, -3.1491e-02,
        -2.4998e-01, -1.4061e-01, -2.9828e-01, -1.3421e-01, -5.6056e-01,
        -5.9725e-01,  4.1602e-01,  1.0068e-01, -4.0347e-01, -1.8266e-02,
        -8.3499e-01, -7.0011e-01, -4.7374e-01, -6.6924e-01, -7.3494e-01,
         2.9534e-01, -9.8023e-01, -3.7871e-01,  3.2971e-01, -2.5926e-01,
         2.7893e+00,  5.4242e-02,  2.2839e-01,  5.1967e-01, -2.6811e-02,
        -8.7968e-02,  4.2001e-02,  1.5137e+00,  6.3766e-01, -6.5300e-01,
        -3.3152e-01, -1.6558e-01, -2.7076e-02, -6.4940e-01,  2.6099e-02,
        -4.2064e-01,  8.3127e-01, -2.4464e-01,  1.4851e+00,  1.2594e-02,
        -8.0267e-01, -3.1879e-01,  1.5017e-01,  1.7888e-01, -2.6315e-01,
        -3.2150e-01, -4.4246e-01, -3.3687e-01, -4.3354e-01, -7.1419e-01,
        -1.7664e-01, -3.3816e-01,  2.2904e-01,  2.2204e-16,  2.2204e-16,
        -2.8560e-01, -5.1299e-01, -5.2471e-01, -1.0677e+00, -1.0559e-01,
        -8.2387e-01, -7.1678e-01, -2.5612e+00, -1.0892e+00,  1.6737e+00,
        -2.9122e-01, -1.2170e-01,  3.0730e-01,  1.4516e-01, -2.1263e-01,
        -8.4793e-01, -1.5987e-14,  1.4162e-01,  5.7856e+00,  9.6888e-02,
         1.0166e-02, -1.0840e-02, -4.4751e-01,  1.8715e-02,  9.5791e-02,
         8.6070e-01,  7.2908e-02, -4.6831e-01,  2.5641e-01,  2.8608e-01,
        -3.3344e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3166]), tensor(0.1390))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.5343e-01,  8.7000e-01,  7.6211e-02, -1.5806e+00, -1.3913e-01,
        -8.0726e-01, -1.4754e-01, -3.4986e-01,  4.3093e-01, -1.8867e-01,
        -7.0019e-01,  8.0590e-02, -7.1244e-01, -4.9952e-01,  7.7213e-02,
         5.0212e-01, -1.3682e-01,  2.0030e-01, -6.9934e-02,  5.6579e-01,
        -4.0727e-01, -5.0676e-02, -1.6227e-01,  2.0041e-04, -9.4665e-02,
        -3.4049e-01, -5.9238e-01, -6.0616e-02,  4.4348e-01,  1.3890e+00,
         3.5124e-01, -1.4152e-01,  7.7590e-01,  2.8717e-01, -2.3646e-01,
        -2.4760e-01,  9.9282e-02,  7.8200e-01, -3.2885e-02, -1.1374e+00,
        -2.8039e-01,  2.4230e-01,  3.1494e-01,  5.0172e-02, -1.7757e-01,
        -7.3537e-01,  8.4181e-02, -4.3410e-02, -3.8147e-01, -1.6263e-01,
        -8.3534e-01,  4.2180e-01, -4.7317e-01,  9.1894e-02, -2.9973e-02,
         5.0152e-01, -6.0461e-01, -1.9013e-01, -2.5178e-01, -4.0858e-02,
         4.3791e-04, -3.0818e-01,  5.4131e-02,  2.2176e-01,  8.4850e-02,
        -1.9804e-01,  6.9975e-01, -2.6370e-01,  6.3515e-01, -5.6858e-01,
        -3.3489e-01, -1.6822e-01, -2.6428e-02, -8.7792e-01,  1.7216e-01,
         7.2411e-01,  8.4288e-01, -1.1481e+00,  2.8117e-01,  1.2946e-02,
        -8.2220e-01,  1.7050e-01,  3.3951e-01, -1.2513e-01, -5.6740e-01,
        -4.3948e-01, -5.3860e-01, -2.7657e-01,  7.6140e-02,  1.1048e-01,
        -5.7134e-01, -1.3411e+00,  2.3318e-01, -9.9920e-16, -9.9920e-16,
         2.9549e+00, -4.9379e-02,  2.4481e+00, -2.8995e+00,  8.6308e-01,
        -7.9107e-01,  1.5704e-01,  5.7232e-02,  6.2791e-02,  2.4593e-01,
         1.1269e-01, -1.2646e-01,  2.9148e-01, -1.9699e-01, -1.0220e+00,
         7.2637e-01, -1.0658e-14,  3.3912e-01, -2.5082e-02,  7.5466e-02,
         1.1656e-02,  2.9105e-01, -2.3589e-01,  1.8516e-02, -5.6718e-01,
         1.3557e-01, -2.7903e-01, -3.9206e-01,  3.5332e-01,  3.6987e-01,
        -4.1061e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([14500]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([ 7.1211e-02, -6.1130e-01, -4.7646e-01,  1.3171e+00, -4.1827e-01,
        -7.8553e-01, -8.0019e-01, -7.0121e-01, -2.4937e-01,  2.1620e-02,
        -7.1667e-01, -1.2501e-02, -7.1244e-01,  9.5090e-01,  6.5651e-01,
         9.0636e-01, -1.9072e-01, -1.0538e-01, -6.9934e-02,  2.3074e-01,
         5.8622e-01, -1.2556e-01, -8.5769e-02,  3.2947e-01, -8.9437e-03,
        -5.9910e-01, -6.5054e-01, -6.0616e-02, -6.4972e-01, -5.2826e-01,
        -1.7061e-01, -8.3638e-02,  4.5501e-01,  2.8717e-01, -5.8623e-01,
        -4.0731e-01, -4.1114e-01, -6.2183e-01, -5.7554e-01, -2.0258e-01,
         3.2559e+00,  2.4016e-01, -1.4834e-01, -2.3366e-01, -4.3862e-01,
        -7.6208e-01,  1.5164e-01, -2.9741e-01,  3.2750e-01,  6.8283e-01,
         7.4742e-01, -6.4967e-01, -4.7317e-01, -6.6924e-01, -7.3534e-01,
         3.9064e-01, -9.7479e-01, -3.9734e-01, -4.4041e-02, -3.5243e-01,
         3.2130e-02, -3.5033e-01, -8.3366e-02,  6.3097e-01, -2.6374e-02,
        -2.5894e-01, -5.0549e-01, -5.4346e-01,  1.3068e+00, -6.8622e-01,
        -3.3489e-01, -1.6822e-01, -2.6428e-02, -7.5642e-01,  1.0301e-01,
        -2.3588e-01,  8.4288e-01, -3.0027e-01,  1.4885e+00,  1.2946e-02,
        -8.2220e-01, -1.4700e-01,  1.2884e-01,  2.7042e+00, -5.3054e-01,
        -3.4474e-01, -4.6334e-01, -3.2356e-01, -3.1648e-01,  4.2150e-01,
        -6.1911e-01, -1.3411e+00,  2.3318e-01, -9.9920e-16, -9.9920e-16,
        -4.1690e-01, -1.5493e+00, -1.7221e-01, -1.4833e+00, -2.2984e-01,
        -8.5130e-01, -6.3868e-01,  1.8285e+00, -1.8076e+00,  2.9315e+00,
        -7.3680e-01, -1.3374e-01,  2.9148e-01,  1.1806e+00,  5.4483e-02,
        -9.5343e-01, -1.0658e-14,  1.6770e-01,  8.4219e+00,  7.5466e-02,
         1.1656e-02, -1.1986e-01, -3.5522e-01,  1.8516e-02,  1.2237e-01,
         1.0057e+00,  2.5211e-01, -3.4174e-01,  3.3789e-01,  3.8331e-01,
        -2.9598e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3116]), tensor(0.3165))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]
INFO:main_restricted.py:Testing data year: 2006
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 14834
            device: cpu
            
2024-07-29 12:42:53,355	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-29 12:42:53,419	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-29 12:42:53,487	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_9a4e17f35fae1a4c.zip' (1.43MiB) to Ray cluster...
2024-07-29 12:42:53,495	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_9a4e17f35fae1a4c.zip'.
2024-07-29 12:42:55,446	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-29 13:21:11,716	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_12-42-55' in 0.2793s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 14834, 'embedding_dim': 1, 'dropout_rate': 0.19, 'lr': 0.0005282284718122494, 'weight_decay': 3.915648958243003e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.09429787666135836
INFO:model_data_nn.py:Best trial testing loss: 0.04941754531699108
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-29_12-42-49_360834_592478/artifacts/2024-07-29_12-42-55/train_fnn_2024-07-29_12-42-55/driver_artifacts/train_fnn_c0359_00022_22_dropout_rate=0.1900,embedding_dim=1,hidden_dim=45,lr=0.0005,num_layers=1,weight_decay=0.0000_2024-07-29_12-42-55
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 15108, 'embedding_dim': 1, 'dropout_rate': 0.19, 'lr': 0.0005282284718122494, 'weight_decay': 3.915648958243003e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10376672718486965, 'avg_test_loss': 0.055707452520159365}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10055194705447823, 'avg_test_loss': 0.055368706974990044}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.09895084583156068, 'avg_test_loss': 0.056702564601992606}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.09783257474306434, 'avg_test_loss': 0.05658307873096516}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.09710505989968196, 'avg_test_loss': 0.054628844333826816}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.09648131305945488, 'avg_test_loss': 0.054979029712302764}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.09606833524825241, 'avg_test_loss': 0.05578992715930097}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.09573411406337136, 'avg_test_loss': 0.05557960323733455}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.09539679800238393, 'avg_test_loss': 0.058454154087728215}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.09504507102345046, 'avg_test_loss': 0.0556034499189269}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.09483237663417793, 'avg_test_loss': 0.054609060017320944}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.0945629033584963, 'avg_test_loss': 0.05548594547933294}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.0945996148064753, 'avg_test_loss': 0.058547438531118726}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.09411084698896305, 'avg_test_loss': 0.0564710914285299}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.09401865248955088, 'avg_test_loss': 0.057483822644069676}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.09398364832443944, 'avg_test_loss': 0.05668209883818076}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.09402206418647528, 'avg_test_loss': 0.056945444088258586}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.09402203876438316, 'avg_test_loss': 0.05665601267770843}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.09377153073623981, 'avg_test_loss': 0.056359064466682554}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.09369675123331495, 'avg_test_loss': 0.05538909692843338}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.09374484364546169, 'avg_test_loss': 0.05598042928791456}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.09360710883260721, 'avg_test_loss': 0.05494010930113096}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.09375552492966192, 'avg_test_loss': 0.05752741680871553}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.0934235474416088, 'avg_test_loss': 0.05640078628194014}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.09350445432240043, 'avg_test_loss': 0.05739612763264138}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.0934765814830106, 'avg_test_loss': 0.055456149654875275}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.09347468773281131, 'avg_test_loss': 0.05616313481760275}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.09348564322611794, 'avg_test_loss': 0.05689181766351898}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.09350336794917703, 'avg_test_loss': 0.05749944005275273}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.09334689409825062, 'avg_test_loss': 0.05792282382381781}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.09325235471251005, 'avg_test_loss': 0.055703191932660476}
INFO:model_data_nn.py:Early stopping at epoch 31
INFO:main_restricted.py:Making prediction for data in year: 2007
INFO:main_restricted.py:Prediction data shape: (16760,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2007: 0.23597732889455092
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  16760.000000  16760.000000
mean      -0.012095      0.054248
std        0.229951      0.055094
min       -0.942307     -0.286479
25%       -0.121358      0.025065
50%       -0.010779      0.048293
75%        0.083408      0.087215
max        8.158734      0.573734
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]
INFO:transform_data_nn.py:Train_data: (466745, 161)

INFO:transform_data_nn.py:Test data years: [2007]
INFO:transform_data_nn.py:Test_data: (16760, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:transform_data_nn.py:Retrain_data: (483505, 161)

INFO:transform_data_nn.py:Prediction data years: [2008]
INFO:transform_data_nn.py:Prediction_data: (16465, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([466745, 138])
            y_train_tf: torch.Size([466745])

            x_test_tf: torch.Size([16760, 138])
            y_test_tf: torch.Size([16760])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([483505, 138])
            y_retrain_tf: torch.Size([483505])

            x_prediction_tf: torch.Size([16465, 138])
            y_prediction_tf: torch.Size([16465])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.5343e-01,  8.7000e-01,  7.6211e-02, -1.5806e+00, -1.3913e-01,
        -8.0726e-01, -1.4754e-01, -3.4986e-01,  4.3093e-01, -1.8867e-01,
        -7.0019e-01,  8.0590e-02, -7.1244e-01, -4.9952e-01,  7.7213e-02,
         5.0212e-01, -1.3682e-01,  2.0030e-01, -6.9934e-02,  5.6579e-01,
        -4.0727e-01, -5.0676e-02, -1.6227e-01,  2.0041e-04, -9.4665e-02,
        -3.4049e-01, -5.9238e-01, -6.0616e-02,  4.4348e-01,  1.3890e+00,
         3.5124e-01, -1.4152e-01,  7.7590e-01,  2.8717e-01, -2.3646e-01,
        -2.4760e-01,  9.9282e-02,  7.8200e-01, -3.2885e-02, -1.1374e+00,
        -2.8039e-01,  2.4230e-01,  3.1494e-01,  5.0172e-02, -1.7757e-01,
        -7.3537e-01,  8.4181e-02, -4.3410e-02, -3.8147e-01, -1.6263e-01,
        -8.3534e-01,  4.2180e-01, -4.7317e-01,  9.1894e-02, -2.9973e-02,
         5.0152e-01, -6.0461e-01, -1.9013e-01, -2.5178e-01, -4.0858e-02,
         4.3791e-04, -3.0818e-01,  5.4131e-02,  2.2176e-01,  8.4850e-02,
        -1.9804e-01,  6.9975e-01, -2.6370e-01,  6.3515e-01, -5.6858e-01,
        -3.3489e-01, -1.6822e-01, -2.6428e-02, -8.7792e-01,  1.7216e-01,
         7.2411e-01,  8.4288e-01, -1.1481e+00,  2.8117e-01,  1.2946e-02,
        -8.2220e-01,  1.7050e-01,  3.3951e-01, -1.2513e-01, -5.6740e-01,
        -4.3948e-01, -5.3860e-01, -2.7657e-01,  7.6140e-02,  1.1048e-01,
        -5.7134e-01, -1.3411e+00,  2.3318e-01, -9.9920e-16, -9.9920e-16,
         2.9549e+00, -4.9379e-02,  2.4481e+00, -2.8995e+00,  8.6308e-01,
        -7.9107e-01,  1.5704e-01,  5.7232e-02,  6.2791e-02,  2.4593e-01,
         1.1269e-01, -1.2646e-01,  2.9148e-01, -1.9699e-01, -1.0220e+00,
         7.2637e-01, -1.0658e-14,  3.3912e-01, -2.5082e-02,  7.5466e-02,
         1.1656e-02,  2.9105e-01, -2.3589e-01,  1.8516e-02, -5.6718e-01,
         1.3557e-01, -2.7903e-01, -3.9206e-01,  3.5332e-01,  3.6987e-01,
        -4.1061e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([14500]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([ 7.1211e-02, -6.1130e-01, -4.7646e-01,  1.3171e+00, -4.1827e-01,
        -7.8553e-01, -8.0019e-01, -7.0121e-01, -2.4937e-01,  2.1620e-02,
        -7.1667e-01, -1.2501e-02, -7.1244e-01,  9.5090e-01,  6.5651e-01,
         9.0636e-01, -1.9072e-01, -1.0538e-01, -6.9934e-02,  2.3074e-01,
         5.8622e-01, -1.2556e-01, -8.5769e-02,  3.2947e-01, -8.9437e-03,
        -5.9910e-01, -6.5054e-01, -6.0616e-02, -6.4972e-01, -5.2826e-01,
        -1.7061e-01, -8.3638e-02,  4.5501e-01,  2.8717e-01, -5.8623e-01,
        -4.0731e-01, -4.1114e-01, -6.2183e-01, -5.7554e-01, -2.0258e-01,
         3.2559e+00,  2.4016e-01, -1.4834e-01, -2.3366e-01, -4.3862e-01,
        -7.6208e-01,  1.5164e-01, -2.9741e-01,  3.2750e-01,  6.8283e-01,
         7.4742e-01, -6.4967e-01, -4.7317e-01, -6.6924e-01, -7.3534e-01,
         3.9064e-01, -9.7479e-01, -3.9734e-01, -4.4041e-02, -3.5243e-01,
         3.2130e-02, -3.5033e-01, -8.3366e-02,  6.3097e-01, -2.6374e-02,
        -2.5894e-01, -5.0549e-01, -5.4346e-01,  1.3068e+00, -6.8622e-01,
        -3.3489e-01, -1.6822e-01, -2.6428e-02, -7.5642e-01,  1.0301e-01,
        -2.3588e-01,  8.4288e-01, -3.0027e-01,  1.4885e+00,  1.2946e-02,
        -8.2220e-01, -1.4700e-01,  1.2884e-01,  2.7042e+00, -5.3054e-01,
        -3.4474e-01, -4.6334e-01, -3.2356e-01, -3.1648e-01,  4.2150e-01,
        -6.1911e-01, -1.3411e+00,  2.3318e-01, -9.9920e-16, -9.9920e-16,
        -4.1690e-01, -1.5493e+00, -1.7221e-01, -1.4833e+00, -2.2984e-01,
        -8.5130e-01, -6.3868e-01,  1.8285e+00, -1.8076e+00,  2.9315e+00,
        -7.3680e-01, -1.3374e-01,  2.9148e-01,  1.1806e+00,  5.4483e-02,
        -9.5343e-01, -1.0658e-14,  1.6770e-01,  8.4219e+00,  7.5466e-02,
         1.1656e-02, -1.1986e-01, -3.5522e-01,  1.8516e-02,  1.2237e-01,
         1.0057e+00,  2.5211e-01, -3.4174e-01,  3.3789e-01,  3.8331e-01,
        -2.9598e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3116]), tensor(0.3165))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.4447e-01,  8.7784e-01,  7.0549e-02, -1.5962e+00, -1.3840e-01,
        -8.0299e-01, -1.4802e-01, -3.5038e-01,  4.4537e-01, -1.9072e-01,
        -7.0250e-01,  7.7724e-02, -7.1651e-01, -5.1140e-01,  7.8370e-02,
         5.0638e-01, -1.3471e-01,  1.9865e-01, -7.4812e-02,  5.7213e-01,
        -4.1515e-01, -5.0482e-02, -1.7344e-01,  1.0633e-03, -9.7778e-02,
        -3.4116e-01, -5.9356e-01, -6.2545e-02,  4.1664e-01,  1.4043e+00,
         3.5357e-01, -1.4228e-01,  7.8786e-01,  2.9236e-01, -2.3153e-01,
        -2.4999e-01,  1.0389e-01,  7.8851e-01, -3.1875e-02, -1.1260e+00,
        -2.7656e-01,  2.5082e-01,  3.2160e-01,  5.3495e-02, -1.7702e-01,
        -7.2774e-01,  8.6251e-02, -4.3586e-02, -3.8267e-01, -1.6381e-01,
        -8.3520e-01,  3.9844e-01, -4.7255e-01,  9.1401e-02, -2.6911e-02,
         5.0135e-01, -5.9667e-01, -1.9442e-01, -2.5200e-01, -3.7946e-02,
        -1.7973e-03, -3.0818e-01,  5.1986e-02,  2.1737e-01,  8.3061e-02,
        -1.9872e-01,  7.0662e-01, -2.6441e-01,  6.3368e-01, -5.7020e-01,
        -3.3779e-01, -1.7063e-01, -2.6298e-02, -8.6899e-01,  1.7090e-01,
         7.3874e-01,  8.5342e-01, -1.1580e+00,  2.8058e-01,  1.3099e-02,
        -8.4987e-01,  1.6969e-01,  3.5410e-01, -9.9312e-02, -5.6964e-01,
        -4.4404e-01, -5.4320e-01, -2.7422e-01,  8.0564e-02,  1.0877e-01,
        -5.8058e-01, -1.3402e+00,  2.3778e-01, -7.7716e-16, -7.7716e-16,
         3.0116e+00, -4.9175e-06,  2.4971e+00, -2.8295e+00,  8.8496e-01,
        -7.9040e-01,  1.6298e-01,  4.4413e-02,  5.7049e-02,  2.2784e-01,
         1.0374e-01, -1.3021e-01,  2.8527e-01, -1.3746e-01, -1.0443e+00,
         7.5886e-01,  7.1054e-15,  3.3668e-01, -1.1245e-02,  5.5238e-02,
         1.6508e-02,  3.0458e-01, -2.3623e-01,  1.8253e-02, -5.7129e-01,
         1.3756e-01, -2.7085e-01, -3.9073e-01,  3.5460e-01,  3.6764e-01,
        -4.1046e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([14746]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-2.8202e-01,  7.6730e-01, -6.4354e-01,  1.2929e+00, -7.5015e-01,
        -2.9721e-01, -3.8841e-01, -5.0400e-01, -2.8395e-01, -5.5864e-02,
        -6.0834e-01, -6.4708e-03, -1.5971e-02, -2.5511e-01, -5.5967e-01,
        -8.3973e-01, -1.6966e-01, -5.0427e-01, -7.4812e-02, -8.6902e-01,
        -8.7255e-01, -1.2840e-01,  1.7909e-01, -1.9877e-01, -4.0563e-01,
        -2.7000e-01, -6.6181e-01, -6.2545e-02, -6.1957e-01,  6.7965e-01,
         1.9095e-01, -4.0029e-02,  3.6092e-01,  2.9236e-01, -5.7341e-01,
        -4.6189e-01, -1.5415e+00, -6.2257e-01, -9.8021e-01, -2.3680e-01,
        -1.8251e-01, -1.4659e-01, -1.8004e+00, -4.2294e-01, -7.6837e-01,
        -4.5417e-01,  3.5019e-01, -7.0584e-02,  3.6539e-01, -2.4956e-01,
        -4.3711e-02, -5.6617e-01, -4.7255e-01, -6.7074e-01, -2.6911e-02,
         1.7198e-01, -9.6937e-01, -3.5464e-01,  9.7623e-01,  3.9905e-01,
         4.3880e-01,  9.9803e-01, -1.3649e-01,  1.9927e-01, -2.6573e-02,
        -3.0099e-01,  6.4649e-01, -1.0991e+00, -3.8886e-02, -5.2024e-01,
        -3.3779e-01, -1.7063e-01, -2.6298e-02, -2.8941e-01,  2.1040e-01,
        -2.6077e-01,  8.5342e-01, -6.6354e-01,  1.4931e+00,  1.3099e-02,
        -8.4987e-01, -8.5983e-01, -2.7300e-01,  7.9895e-01, -5.0996e-01,
        -3.1457e-01, -4.4987e-01, -2.7171e-01, -3.3127e-01,  2.4969e-01,
        -6.0498e-01, -9.9415e-01,  2.3778e-01, -7.7716e-16, -7.7716e-16,
        -5.4053e-01, -2.9537e+00, -8.5046e-01, -4.0666e-01,  4.6162e-01,
         2.3150e-01, -5.8334e-01, -9.7529e-01,  3.0603e+00,  1.9120e+00,
         2.1252e-01, -1.5037e-01,  2.8527e-01,  7.3946e-01, -1.9158e-01,
        -4.4185e-01,  7.1054e-15,  2.4794e-01,  4.6009e+00,  5.5238e-02,
         1.6508e-02, -1.4692e-01, -4.9452e-01,  1.8253e-02, -2.5265e-01,
        -1.3463e+00, -4.5101e-02, -1.2896e-01,  3.6594e-01,  2.8635e-01,
        -2.9174e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3065]), tensor(-0.0378))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]
INFO:main_restricted.py:Testing data year: 2007
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15108
            device: cpu
            
2024-07-29 14:37:14,336	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-29 14:37:14,395	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-29 14:37:14,443	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_0c8076d172043e24.zip' (1.46MiB) to Ray cluster...
2024-07-29 14:37:14,453	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_0c8076d172043e24.zip'.
2024-07-29 14:37:16,405	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-29 15:31:10,406	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_14-37-16' in 0.2722s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 3, 'num_embeddings': 15108, 'embedding_dim': 10, 'dropout_rate': 0.26, 'lr': 2.0941612348457702e-05, 'weight_decay': 2.0107382219282292e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.09861619282565966
INFO:model_data_nn.py:Best trial testing loss: 0.053490300214927615
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-29_14-37-10_607286_592478/artifacts/2024-07-29_14-37-16/train_fnn_2024-07-29_14-37-16/driver_artifacts/train_fnn_b9a8c_00072_72_dropout_rate=0.2600,embedding_dim=10,hidden_dim=65,lr=0.0000,num_layers=3,weight_decay=0.0000_2024-07-29_14-37-17
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 3, 'num_embeddings': 15361, 'embedding_dim': 10, 'dropout_rate': 0.26, 'lr': 2.0941612348457702e-05, 'weight_decay': 2.0107382219282292e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10631931095236362, 'avg_test_loss': 0.13348468386589787}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10527375377251069, 'avg_test_loss': 0.14492537473263437}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10462730097258205, 'avg_test_loss': 0.1672503832770988}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10409219157708198, 'avg_test_loss': 0.18298059647050938}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10365485022106372, 'avg_test_loss': 0.20585678062986495}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.103226476498609, 'avg_test_loss': 0.23156005441564922}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10302871485433827, 'avg_test_loss': 0.22220267647112063}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10270898802457923, 'avg_test_loss': 0.23766328354705443}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10248770175029755, 'avg_test_loss': 0.2616580539462409}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.1023416486165595, 'avg_test_loss': 0.2487863508493517}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10202664260964309, 'avg_test_loss': 0.2749819538967554}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10180550128584474, 'avg_test_loss': 0.251124555858704}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10166424692124879, 'avg_test_loss': 0.2793282082073333}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10140851828762075, 'avg_test_loss': 0.27231237786829243}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10131391730043136, 'avg_test_loss': 0.2772806127837231}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.1011853491108759, 'avg_test_loss': 0.3057867750496596}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.10101114945234185, 'avg_test_loss': 0.2940758289769292}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.10079558037057704, 'avg_test_loss': 0.30790087614612754}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.10081933721971986, 'avg_test_loss': 0.2807894875548145}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.10049462638896965, 'avg_test_loss': 0.314924978073542}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.10037315985977428, 'avg_test_loss': 0.29805081365124664}
INFO:model_data_nn.py:Early stopping at epoch 21
INFO:main_restricted.py:Making prediction for data in year: 2008
INFO:main_restricted.py:Prediction data shape: (16465,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2008: 0.5446092184223051
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  16465.000000  16465.000000
mean      -0.119762      0.211898
std        0.319514      0.212855
min       -0.957296     -0.209836
25%       -0.293863      0.052330
50%       -0.110638      0.124956
75%        0.023365      0.375995
max       10.299695      0.942481
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:transform_data_nn.py:Train_data: (483505, 161)

INFO:transform_data_nn.py:Test data years: [2008]
INFO:transform_data_nn.py:Test_data: (16465, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:transform_data_nn.py:Retrain_data: (499970, 161)

INFO:transform_data_nn.py:Prediction data years: [2009]
INFO:transform_data_nn.py:Prediction_data: (16061, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([483505, 138])
            y_train_tf: torch.Size([483505])

            x_test_tf: torch.Size([16465, 138])
            y_test_tf: torch.Size([16465])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([499970, 138])
            y_retrain_tf: torch.Size([499970])

            x_prediction_tf: torch.Size([16061, 138])
            y_prediction_tf: torch.Size([16061])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.4447e-01,  8.7784e-01,  7.0549e-02, -1.5962e+00, -1.3840e-01,
        -8.0299e-01, -1.4802e-01, -3.5038e-01,  4.4537e-01, -1.9072e-01,
        -7.0250e-01,  7.7724e-02, -7.1651e-01, -5.1140e-01,  7.8370e-02,
         5.0638e-01, -1.3471e-01,  1.9865e-01, -7.4812e-02,  5.7213e-01,
        -4.1515e-01, -5.0482e-02, -1.7344e-01,  1.0633e-03, -9.7778e-02,
        -3.4116e-01, -5.9356e-01, -6.2545e-02,  4.1664e-01,  1.4043e+00,
         3.5357e-01, -1.4228e-01,  7.8786e-01,  2.9236e-01, -2.3153e-01,
        -2.4999e-01,  1.0389e-01,  7.8851e-01, -3.1875e-02, -1.1260e+00,
        -2.7656e-01,  2.5082e-01,  3.2160e-01,  5.3495e-02, -1.7702e-01,
        -7.2774e-01,  8.6251e-02, -4.3586e-02, -3.8267e-01, -1.6381e-01,
        -8.3520e-01,  3.9844e-01, -4.7255e-01,  9.1401e-02, -2.6911e-02,
         5.0135e-01, -5.9667e-01, -1.9442e-01, -2.5200e-01, -3.7946e-02,
        -1.7973e-03, -3.0818e-01,  5.1986e-02,  2.1737e-01,  8.3061e-02,
        -1.9872e-01,  7.0662e-01, -2.6441e-01,  6.3368e-01, -5.7020e-01,
        -3.3779e-01, -1.7063e-01, -2.6298e-02, -8.6899e-01,  1.7090e-01,
         7.3874e-01,  8.5342e-01, -1.1580e+00,  2.8058e-01,  1.3099e-02,
        -8.4987e-01,  1.6969e-01,  3.5410e-01, -9.9312e-02, -5.6964e-01,
        -4.4404e-01, -5.4320e-01, -2.7422e-01,  8.0564e-02,  1.0877e-01,
        -5.8058e-01, -1.3402e+00,  2.3778e-01, -7.7716e-16, -7.7716e-16,
         3.0116e+00, -4.9175e-06,  2.4971e+00, -2.8295e+00,  8.8496e-01,
        -7.9040e-01,  1.6298e-01,  4.4413e-02,  5.7049e-02,  2.2784e-01,
         1.0374e-01, -1.3021e-01,  2.8527e-01, -1.3746e-01, -1.0443e+00,
         7.5886e-01,  7.1054e-15,  3.3668e-01, -1.1245e-02,  5.5238e-02,
         1.6508e-02,  3.0458e-01, -2.3623e-01,  1.8253e-02, -5.7129e-01,
         1.3756e-01, -2.7085e-01, -3.9073e-01,  3.5460e-01,  3.6764e-01,
        -4.1046e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([14746]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-2.8202e-01,  7.6730e-01, -6.4354e-01,  1.2929e+00, -7.5015e-01,
        -2.9721e-01, -3.8841e-01, -5.0400e-01, -2.8395e-01, -5.5864e-02,
        -6.0834e-01, -6.4708e-03, -1.5971e-02, -2.5511e-01, -5.5967e-01,
        -8.3973e-01, -1.6966e-01, -5.0427e-01, -7.4812e-02, -8.6902e-01,
        -8.7255e-01, -1.2840e-01,  1.7909e-01, -1.9877e-01, -4.0563e-01,
        -2.7000e-01, -6.6181e-01, -6.2545e-02, -6.1957e-01,  6.7965e-01,
         1.9095e-01, -4.0029e-02,  3.6092e-01,  2.9236e-01, -5.7341e-01,
        -4.6189e-01, -1.5415e+00, -6.2257e-01, -9.8021e-01, -2.3680e-01,
        -1.8251e-01, -1.4659e-01, -1.8004e+00, -4.2294e-01, -7.6837e-01,
        -4.5417e-01,  3.5019e-01, -7.0584e-02,  3.6539e-01, -2.4956e-01,
        -4.3711e-02, -5.6617e-01, -4.7255e-01, -6.7074e-01, -2.6911e-02,
         1.7198e-01, -9.6937e-01, -3.5464e-01,  9.7623e-01,  3.9905e-01,
         4.3880e-01,  9.9803e-01, -1.3649e-01,  1.9927e-01, -2.6573e-02,
        -3.0099e-01,  6.4649e-01, -1.0991e+00, -3.8886e-02, -5.2024e-01,
        -3.3779e-01, -1.7063e-01, -2.6298e-02, -2.8941e-01,  2.1040e-01,
        -2.6077e-01,  8.5342e-01, -6.6354e-01,  1.4931e+00,  1.3099e-02,
        -8.4987e-01, -8.5983e-01, -2.7300e-01,  7.9895e-01, -5.0996e-01,
        -3.1457e-01, -4.4987e-01, -2.7171e-01, -3.3127e-01,  2.4969e-01,
        -6.0498e-01, -9.9415e-01,  2.3778e-01, -7.7716e-16, -7.7716e-16,
        -5.4053e-01, -2.9537e+00, -8.5046e-01, -4.0666e-01,  4.6162e-01,
         2.3150e-01, -5.8334e-01, -9.7529e-01,  3.0603e+00,  1.9120e+00,
         2.1252e-01, -1.5037e-01,  2.8527e-01,  7.3946e-01, -1.9158e-01,
        -4.4185e-01,  7.1054e-15,  2.4794e-01,  4.6009e+00,  5.5238e-02,
         1.6508e-02, -1.4692e-01, -4.9452e-01,  1.8253e-02, -2.5265e-01,
        -1.3463e+00, -4.5101e-02, -1.2896e-01,  3.6594e-01,  2.8635e-01,
        -2.9174e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3065]), tensor(-0.0378))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.3834e-01,  8.8641e-01,  7.0010e-02, -1.6107e+00, -1.3694e-01,
        -8.1424e-01, -1.4822e-01, -3.5060e-01,  4.4198e-01, -1.8868e-01,
        -7.0388e-01,  7.9521e-02, -7.1558e-01, -5.1497e-01,  7.7327e-02,
         5.1104e-01, -1.3124e-01,  2.0309e-01, -7.7387e-02,  5.8002e-01,
        -4.1119e-01, -5.1090e-02, -1.7515e-01,  3.4879e-03, -9.8594e-02,
        -3.4145e-01, -5.9437e-01, -6.8377e-02,  3.9758e-01,  1.3974e+00,
         3.5190e-01, -1.4045e-01,  7.8751e-01,  2.9673e-01, -2.2549e-01,
        -2.4982e-01,  1.0686e-01,  7.9445e-01, -3.0162e-02, -1.1197e+00,
        -2.7480e-01,  2.8297e-01,  3.2759e-01,  4.8487e-02, -1.7661e-01,
        -7.3139e-01,  1.0241e-01, -2.8907e-02, -3.8290e-01, -1.5081e-01,
        -8.3637e-01,  3.8202e-01, -4.7150e-01,  9.0745e-02, -2.2174e-02,
         4.9990e-01, -5.8836e-01, -1.9193e-01, -2.5136e-01, -3.6155e-02,
         1.6557e-04, -3.0746e-01,  5.3572e-02,  2.1627e-01,  8.3302e-02,
        -1.9868e-01,  7.1773e-01, -2.6358e-01,  6.3520e-01, -5.7163e-01,
        -3.4078e-01, -1.7289e-01, -2.6737e-02, -8.7677e-01,  1.7389e-01,
         7.4455e-01,  8.6284e-01, -1.1669e+00,  2.8036e-01,  1.2859e-02,
        -8.5991e-01,  1.7080e-01,  3.6011e-01, -7.8064e-02, -5.7476e-01,
        -4.5096e-01, -5.4846e-01, -2.7239e-01,  8.5494e-02,  1.1281e-01,
        -5.8858e-01, -1.3406e+00,  2.4175e-01, -5.5511e-16, -5.5511e-16,
         3.0668e+00,  9.5409e-02,  2.5114e+00, -2.8713e+00,  8.4400e-01,
        -6.2231e-01,  1.7089e-01,  3.4541e-02,  5.3086e-02,  2.1588e-01,
         9.5705e-02, -1.3112e-01,  2.9994e-01, -1.7642e-01, -1.0326e+00,
         7.8098e-01,  0.0000e+00,  3.3523e-01, -1.0222e-02,  4.7863e-02,
         1.4473e-02,  3.1692e-01, -2.3714e-01,  1.7989e-02, -5.6940e-01,
         1.3832e-01, -2.6259e-01, -3.8416e-01,  3.5537e-01,  3.6571e-01,
        -4.1004e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([15036]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-8.5753e-01,  1.5961e-01, -4.3739e-01,  1.2697e+00,  8.5082e-01,
         2.0544e+00,  4.6894e-01,  1.7200e-01,  2.5960e-01, -1.1830e+00,
        -5.1503e-01, -2.6796e-01, -7.1558e-01,  1.7722e-01, -8.3372e-02,
         6.6050e-03, -2.1357e-01,  1.7785e+00,  6.2039e-03,  1.8107e-01,
         3.4686e+00, -1.3305e+00, -1.6590e-01, -1.4806e-01,  4.9132e-01,
        -7.2803e-01, -5.3560e-01, -6.8377e-02,  4.9681e-01,  3.0521e-01,
        -2.7679e+00,  7.3610e-01,  1.6269e-01, -1.1482e+00, -9.2375e-01,
        -1.2168e-01, -2.2495e-01, -3.5334e-02,  1.5339e+00,  3.4492e-01,
        -2.6568e-01, -1.5550e+00, -1.0451e-01,  1.7504e+00,  3.7970e-01,
         1.6249e+00, -9.8430e-02,  1.2935e+00, -7.7177e-01,  2.4360e+00,
         1.5402e+00,  3.0646e-01, -4.7150e-01, -3.5738e-01, -7.3471e-01,
        -1.0689e-01, -9.0435e-01, -3.1847e-01, -1.7835e-01,  4.4553e-01,
        -2.5940e-02, -2.2741e-01, -2.2083e+00, -4.8825e-01, -6.4925e-01,
        -1.3467e+00, -4.9602e-01,  5.9803e-02,  6.3520e-01, -5.1032e-01,
        -3.4078e-01, -1.7289e-01, -2.6737e-02,  2.5981e+00, -1.9809e-01,
        -6.2049e-02, -1.4252e+00, -1.6032e+00, -1.7082e+00,  1.2859e-02,
         7.9165e-01,  2.6852e-01, -5.8745e-01, -2.9587e-01, -1.5509e-01,
         7.7953e-01,  1.5779e+00, -3.8589e-01,  4.3100e-01, -1.8140e-01,
        -3.4341e-03, -6.7040e-01,  2.4175e-01, -5.5511e-16, -5.5511e-16,
        -6.8856e-02, -1.6627e+00, -1.8867e+00,  6.4900e-01,  6.2618e+00,
         6.6340e+00,  2.4243e-03, -2.3343e+00,  1.0756e-01, -3.4580e+00,
        -3.4296e-01, -2.5899e-01, -1.9375e-01,  1.7223e+00, -1.4476e+00,
        -2.8876e-01,  0.0000e+00,  4.0441e-01, -1.0222e-02, -1.0005e+00,
        -7.0403e-01, -1.1265e+00,  9.3009e-02,  1.7989e-02,  3.2092e-01,
         1.7459e-02, -1.2012e+00, -1.1096e+00,  1.0037e-01, -8.1572e-03,
        -4.1262e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3744]), tensor(-0.5694))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:main_restricted.py:Testing data year: 2008
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15361
            device: cpu
            
2024-07-29 16:51:05,514	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-29 16:51:05,575	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-29 16:51:05,635	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_51ce461daf09c2d4.zip' (1.46MiB) to Ray cluster...
2024-07-29 16:51:05,646	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_51ce461daf09c2d4.zip'.
2024-07-29 16:51:07,878	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-29 17:57:45,728	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_16-51-07' in 0.2685s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 175, 'num_layers': 5, 'num_embeddings': 15361, 'embedding_dim': 10, 'dropout_rate': 0.51, 'lr': 1.457050032975656e-06, 'weight_decay': 3.212219315322692e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10572369446470517
INFO:model_data_nn.py:Best trial testing loss: 0.1267489146426782
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-29_16-51-01_615620_592478/artifacts/2024-07-29_16-51-07/train_fnn_2024-07-29_16-51-07/driver_artifacts/train_fnn_6cca3_00097_97_dropout_rate=0.5100,embedding_dim=10,hidden_dim=175,lr=0.0000,num_layers=5,weight_decay=0.0000_2024-07-29_16-51-08
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 175, 'num_layers': 5, 'num_embeddings': 15661, 'embedding_dim': 10, 'dropout_rate': 0.51, 'lr': 1.457050032975656e-06, 'weight_decay': 3.212219315322692e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.12208635703251872, 'avg_test_loss': 0.2750641789242803}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.11674370526784866, 'avg_test_loss': 0.2747118580544672}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.11329659132841981, 'avg_test_loss': 0.27469548232022273}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.11123990150611071, 'avg_test_loss': 0.27467213059400775}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10979496897567832, 'avg_test_loss': 0.2748837001562356}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10896186643106986, 'avg_test_loss': 0.2742945968147471}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10828234696631066, 'avg_test_loss': 0.2747800752104991}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10776518090354842, 'avg_test_loss': 0.2745052259118552}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10744334310669923, 'avg_test_loss': 0.27481418199080276}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.10730081304780952, 'avg_test_loss': 0.2748460807648313}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10712582164043938, 'avg_test_loss': 0.2745192451662276}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10699394227091855, 'avg_test_loss': 0.2750508884984659}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10695240539591616, 'avg_test_loss': 0.2749969282473226}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10689150254827239, 'avg_test_loss': 0.27514652621401736}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10682862497440787, 'avg_test_loss': 0.2750787564527347}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.10679880398670398, 'avg_test_loss': 0.27472125096209493}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.1067842715026413, 'avg_test_loss': 0.27490595667307594}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.10676025760804025, 'avg_test_loss': 0.27489134438142954}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.10674237102390297, 'avg_test_loss': 0.27471571702851477}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.10673394484523659, 'avg_test_loss': 0.27486902619322456}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.1067255205921619, 'avg_test_loss': 0.2747184652612504}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.10670253365761727, 'avg_test_loss': 0.2745608861272435}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.10668474584302869, 'avg_test_loss': 0.2747679678982947}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.10669796444910554, 'avg_test_loss': 0.2745904470812455}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.10668599394808632, 'avg_test_loss': 0.27440325459799325}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.1066697373579953, 'avg_test_loss': 0.2746003113494095}
INFO:model_data_nn.py:Early stopping at epoch 26
INFO:main_restricted.py:Making prediction for data in year: 2009
INFO:main_restricted.py:Prediction data shape: (16061,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2009: 0.5240536387423892
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  16061.000000  16061.000000
mean       0.139171      0.031174
std        0.512778      0.003263
min       -0.941129      0.012590
25%       -0.088888      0.029415
50%        0.057852      0.031838
75%        0.252000      0.033508
max       18.331762      0.038325
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:transform_data_nn.py:Train_data: (499970, 161)

INFO:transform_data_nn.py:Test data years: [2009]
INFO:transform_data_nn.py:Test_data: (16061, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:transform_data_nn.py:Retrain_data: (516031, 161)

INFO:transform_data_nn.py:Prediction data years: [2010]
INFO:transform_data_nn.py:Prediction_data: (15133, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([499970, 138])
            y_train_tf: torch.Size([499970])

            x_test_tf: torch.Size([16061, 138])
            y_test_tf: torch.Size([16061])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([516031, 138])
            y_retrain_tf: torch.Size([516031])

            x_prediction_tf: torch.Size([15133, 138])
            y_prediction_tf: torch.Size([15133])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.3834e-01,  8.8641e-01,  7.0010e-02, -1.6107e+00, -1.3694e-01,
        -8.1424e-01, -1.4822e-01, -3.5060e-01,  4.4198e-01, -1.8868e-01,
        -7.0388e-01,  7.9521e-02, -7.1558e-01, -5.1497e-01,  7.7327e-02,
         5.1104e-01, -1.3124e-01,  2.0309e-01, -7.7387e-02,  5.8002e-01,
        -4.1119e-01, -5.1090e-02, -1.7515e-01,  3.4879e-03, -9.8594e-02,
        -3.4145e-01, -5.9437e-01, -6.8377e-02,  3.9758e-01,  1.3974e+00,
         3.5190e-01, -1.4045e-01,  7.8751e-01,  2.9673e-01, -2.2549e-01,
        -2.4982e-01,  1.0686e-01,  7.9445e-01, -3.0162e-02, -1.1197e+00,
        -2.7480e-01,  2.8297e-01,  3.2759e-01,  4.8487e-02, -1.7661e-01,
        -7.3139e-01,  1.0241e-01, -2.8907e-02, -3.8290e-01, -1.5081e-01,
        -8.3637e-01,  3.8202e-01, -4.7150e-01,  9.0745e-02, -2.2174e-02,
         4.9990e-01, -5.8836e-01, -1.9193e-01, -2.5136e-01, -3.6155e-02,
         1.6557e-04, -3.0746e-01,  5.3572e-02,  2.1627e-01,  8.3302e-02,
        -1.9868e-01,  7.1773e-01, -2.6358e-01,  6.3520e-01, -5.7163e-01,
        -3.4078e-01, -1.7289e-01, -2.6737e-02, -8.7677e-01,  1.7389e-01,
         7.4455e-01,  8.6284e-01, -1.1669e+00,  2.8036e-01,  1.2859e-02,
        -8.5991e-01,  1.7080e-01,  3.6011e-01, -7.8064e-02, -5.7476e-01,
        -4.5096e-01, -5.4846e-01, -2.7239e-01,  8.5494e-02,  1.1281e-01,
        -5.8858e-01, -1.3406e+00,  2.4175e-01, -5.5511e-16, -5.5511e-16,
         3.0668e+00,  9.5409e-02,  2.5114e+00, -2.8713e+00,  8.4400e-01,
        -6.2231e-01,  1.7089e-01,  3.4541e-02,  5.3086e-02,  2.1588e-01,
         9.5705e-02, -1.3112e-01,  2.9994e-01, -1.7642e-01, -1.0326e+00,
         7.8098e-01,  0.0000e+00,  3.3523e-01, -1.0222e-02,  4.7863e-02,
         1.4473e-02,  3.1692e-01, -2.3714e-01,  1.7989e-02, -5.6940e-01,
         1.3832e-01, -2.6259e-01, -3.8416e-01,  3.5537e-01,  3.6571e-01,
        -4.1004e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([15036]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-8.5753e-01,  1.5961e-01, -4.3739e-01,  1.2697e+00,  8.5082e-01,
         2.0544e+00,  4.6894e-01,  1.7200e-01,  2.5960e-01, -1.1830e+00,
        -5.1503e-01, -2.6796e-01, -7.1558e-01,  1.7722e-01, -8.3372e-02,
         6.6050e-03, -2.1357e-01,  1.7785e+00,  6.2039e-03,  1.8107e-01,
         3.4686e+00, -1.3305e+00, -1.6590e-01, -1.4806e-01,  4.9132e-01,
        -7.2803e-01, -5.3560e-01, -6.8377e-02,  4.9681e-01,  3.0521e-01,
        -2.7679e+00,  7.3610e-01,  1.6269e-01, -1.1482e+00, -9.2375e-01,
        -1.2168e-01, -2.2495e-01, -3.5334e-02,  1.5339e+00,  3.4492e-01,
        -2.6568e-01, -1.5550e+00, -1.0451e-01,  1.7504e+00,  3.7970e-01,
         1.6249e+00, -9.8430e-02,  1.2935e+00, -7.7177e-01,  2.4360e+00,
         1.5402e+00,  3.0646e-01, -4.7150e-01, -3.5738e-01, -7.3471e-01,
        -1.0689e-01, -9.0435e-01, -3.1847e-01, -1.7835e-01,  4.4553e-01,
        -2.5940e-02, -2.2741e-01, -2.2083e+00, -4.8825e-01, -6.4925e-01,
        -1.3467e+00, -4.9602e-01,  5.9803e-02,  6.3520e-01, -5.1032e-01,
        -3.4078e-01, -1.7289e-01, -2.6737e-02,  2.5981e+00, -1.9809e-01,
        -6.2049e-02, -1.4252e+00, -1.6032e+00, -1.7082e+00,  1.2859e-02,
         7.9165e-01,  2.6852e-01, -5.8745e-01, -2.9587e-01, -1.5509e-01,
         7.7953e-01,  1.5779e+00, -3.8589e-01,  4.3100e-01, -1.8140e-01,
        -3.4341e-03, -6.7040e-01,  2.4175e-01, -5.5511e-16, -5.5511e-16,
        -6.8856e-02, -1.6627e+00, -1.8867e+00,  6.4900e-01,  6.2618e+00,
         6.6340e+00,  2.4243e-03, -2.3343e+00,  1.0756e-01, -3.4580e+00,
        -3.4296e-01, -2.5899e-01, -1.9375e-01,  1.7223e+00, -1.4476e+00,
        -2.8876e-01,  0.0000e+00,  4.0441e-01, -1.0222e-02, -1.0005e+00,
        -7.0403e-01, -1.1265e+00,  9.3009e-02,  1.7989e-02,  3.2092e-01,
         1.7459e-02, -1.2012e+00, -1.1096e+00,  1.0037e-01, -8.1572e-03,
        -4.1262e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3744]), tensor(-0.5694))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.4121e-01,  8.9528e-01,  7.1463e-02, -1.6241e+00, -1.2727e-01,
        -8.2640e-01, -1.4643e-01, -3.4830e-01,  4.1360e-01, -1.8449e-01,
        -7.0624e-01,  8.7671e-02, -7.0982e-01, -5.1635e-01,  7.4806e-02,
         5.1213e-01, -1.2865e-01,  2.0872e-01, -8.1535e-02,  5.9056e-01,
        -4.1575e-01, -5.5161e-02, -1.7422e-01,  8.9817e-03, -9.5227e-02,
        -3.4136e-01, -5.9477e-01, -8.0225e-02,  3.8121e-01,  1.3623e+00,
         3.4425e-01, -1.3246e-01,  7.8188e-01,  3.0258e-01, -2.2237e-01,
        -2.4719e-01,  1.1713e-01,  7.9888e-01, -2.5969e-02, -1.1252e+00,
        -2.7520e-01,  3.2236e-01,  3.3716e-01,  3.5944e-02, -1.7170e-01,
        -7.3785e-01,  1.2651e-01, -3.9350e-02, -3.7240e-01, -1.4075e-01,
        -8.4013e-01,  3.7359e-01, -4.7051e-01,  8.8480e-02, -1.6546e-02,
         4.9786e-01, -5.8096e-01, -1.8873e-01, -2.5121e-01, -3.9380e-02,
         4.0694e-03, -3.0703e-01,  6.0828e-02,  2.1111e-01,  8.6529e-02,
        -1.9613e-01,  7.3131e-01, -2.6322e-01,  6.4098e-01, -5.7237e-01,
        -3.4422e-01, -1.7451e-01, -2.6886e-02, -8.8361e-01,  1.8117e-01,
         7.4646e-01,  8.7196e-01, -1.1736e+00,  2.7550e-01,  1.1739e-02,
        -9.2036e-01,  1.7764e-01,  3.5238e-01, -6.2739e-02, -5.7678e-01,
        -4.5776e-01, -5.5306e-01, -2.7362e-01,  9.0321e-02,  1.1504e-01,
        -5.9541e-01, -1.3428e+00,  2.4559e-01, -9.9920e-16, -9.9920e-16,
         3.1114e+00,  1.3849e-01,  2.4813e+00, -2.8954e+00,  5.9632e-01,
        -5.6662e-01,  1.8169e-01, -3.2624e-03,  2.0718e-02,  2.1226e-01,
         9.2872e-02, -1.3143e-01,  2.7299e-01,  2.4228e-01, -9.6495e-01,
         7.9448e-01,  5.3291e-15,  3.3665e-01, -1.1475e-03,  9.2821e-02,
         1.1428e-02,  3.2856e-01, -2.3612e-01,  1.7756e-02, -5.6831e-01,
         1.4121e-01, -2.5690e-01, -3.7294e-01,  3.5968e-01,  3.6648e-01,
        -4.1146e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([15216]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-2.5344e-01, -3.1096e-01, -6.7341e-01,  1.2490e+00, -4.1006e-01,
        -2.5781e-01, -5.0459e-01, -5.6837e-01, -9.2668e-02, -1.3391e-01,
        -3.0494e-01,  5.2440e-02, -7.0982e-01,  5.5361e-01,  2.3954e-01,
         1.5969e+00, -1.1194e-01,  1.4900e+00, -8.1535e-02, -1.3064e+00,
         2.7600e-01, -1.2736e-01, -5.1178e-01, -4.3434e-01,  3.2039e-01,
        -7.4341e-01, -6.4548e-01, -8.0225e-02, -6.0723e-01,  1.0306e-02,
        -3.0019e-01, -2.3412e-01,  4.1398e-01,  3.0258e-01, -5.5404e-01,
         4.7722e-01,  6.7906e-01, -6.4132e-01,  1.2262e+00, -4.8690e-01,
        -2.7090e-01,  1.5761e-02, -4.2001e-01, -3.7687e-01, -3.9244e-01,
         6.7322e-01,  3.8929e-02,  1.0615e+00, -1.0189e-01,  2.6221e-02,
         2.3339e+00, -5.3937e-01, -4.7051e-01, -6.7241e-01, -7.3405e-01,
         2.5985e-01, -9.5832e-01,  8.8949e-01, -2.1402e-01, -3.7729e-01,
         2.0044e+00,  2.0470e-01,  2.2179e+00,  2.0581e+00, -2.3054e-02,
         1.5396e+00, -4.9340e-01, -3.0781e-01,  6.4098e-01, -6.6845e-01,
        -3.4422e-01, -1.7451e-01, -2.6886e-02,  1.5724e-01,  1.7281e-01,
        -8.0240e-01,  8.7196e-01,  1.6555e-01,  1.4933e+00,  1.1739e-02,
        -9.2036e-01,  7.3198e-01, -1.6257e-01,  6.6372e-01,  9.9439e-01,
        -3.1379e-01, -4.5383e-01, -3.7081e-02, -2.5262e-01, -4.8432e-01,
         4.7028e-01, -9.4676e-01,  2.4559e-01, -9.9920e-16, -9.9920e-16,
        -2.0504e-01,  1.4241e-01, -1.7596e+00,  1.7051e+00,  1.4704e-01,
        -4.3362e-01, -1.4750e+00, -3.2624e-03, -1.1227e+00,  2.1226e-01,
         7.0597e-03, -1.9757e-01,  2.7299e-01, -1.7608e+00, -1.5179e+00,
         1.0186e+00,  5.3291e-15,  2.7466e-01,  4.5938e+00,  9.2821e-02,
         1.1428e-02, -3.0758e-01, -3.1646e-01,  1.7756e-02, -4.3565e-01,
         1.0607e+00, -8.0701e-02, -3.8260e-01,  3.5104e-01,  2.5291e-01,
        -3.3628e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2735]), tensor(0.0007))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:main_restricted.py:Testing data year: 2009
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15661
            device: cpu
            
2024-07-29 19:35:54,037	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-29 19:35:54,094	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-29 19:35:54,149	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_51ce461daf09c2d4.zip' (1.46MiB) to Ray cluster...
2024-07-29 19:35:54,157	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_51ce461daf09c2d4.zip'.
2024-07-29 19:35:56,224	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-29 19:55:03,619	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_19-35-56' in 0.2754s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 15661, 'embedding_dim': 1, 'dropout_rate': 0.19, 'lr': 0.0005282284718122494, 'weight_decay': 3.915648958243003e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.091752569594111
INFO:model_data_nn.py:Best trial testing loss: 0.23531255445840113
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-29_19-35-50_320495_592478/artifacts/2024-07-29_19-35-56/train_fnn_2024-07-29_19-35-56/driver_artifacts/train_fnn_72b3f_00022_22_dropout_rate=0.1900,embedding_dim=1,hidden_dim=45,lr=0.0005,num_layers=1,weight_decay=0.0000_2024-07-29_19-35-56
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 15845, 'embedding_dim': 1, 'dropout_rate': 0.19, 'lr': 0.0005282284718122494, 'weight_decay': 3.915648958243003e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10715714118024554, 'avg_test_loss': 0.07454174246151739}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10334884360177557, 'avg_test_loss': 0.07727739735966242}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.1016665479589713, 'avg_test_loss': 0.08306974975022838}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10067324007807484, 'avg_test_loss': 0.07995955550940982}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10008249939027716, 'avg_test_loss': 0.08034306487170705}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.09956341019282415, 'avg_test_loss': 0.07742305875673325}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.0991266909309787, 'avg_test_loss': 0.08069929123742169}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.09885389430213214, 'avg_test_loss': 0.07957180848793138}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.09862735610214068, 'avg_test_loss': 0.0800294852127883}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.09826968918055207, 'avg_test_loss': 0.07978320279736308}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.09778063522092212, 'avg_test_loss': 0.07921888046595366}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.09776287840984722, 'avg_test_loss': 0.08448524634797865}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.09766179485756213, 'avg_test_loss': 0.07846064071803656}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.09749924629410076, 'avg_test_loss': 0.08179834723189662}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.09733820711619481, 'avg_test_loss': 0.08112809937525903}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.09710787067892637, 'avg_test_loss': 0.08029580534384724}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.09698509644967425, 'avg_test_loss': 0.07918927946642733}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.09680555114618226, 'avg_test_loss': 0.08095695217088934}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.09681572534464608, 'avg_test_loss': 0.0790365488908965}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.0968666371830035, 'avg_test_loss': 0.08014991649186812}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.09677051122020075, 'avg_test_loss': 0.08069326102985108}
INFO:model_data_nn.py:Early stopping at epoch 21
INFO:main_restricted.py:Making prediction for data in year: 2010
INFO:main_restricted.py:Prediction data shape: (15133,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2010: 0.2842436904920809
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  15133.000000  15133.000000
mean       0.066892      0.083587
std        0.270575      0.084402
min       -0.913334     -0.321253
25%       -0.069767      0.036630
50%        0.041405      0.068643
75%        0.175515      0.119527
max        7.399156      1.796404
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:transform_data_nn.py:Train_data: (516031, 161)

INFO:transform_data_nn.py:Test data years: [2010]
INFO:transform_data_nn.py:Test_data: (15133, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:transform_data_nn.py:Retrain_data: (531164, 161)

INFO:transform_data_nn.py:Prediction data years: [2011]
INFO:transform_data_nn.py:Prediction_data: (14552, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([516031, 138])
            y_train_tf: torch.Size([516031])

            x_test_tf: torch.Size([15133, 138])
            y_test_tf: torch.Size([15133])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([531164, 138])
            y_retrain_tf: torch.Size([531164])

            x_prediction_tf: torch.Size([14552, 138])
            y_prediction_tf: torch.Size([14552])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.4121e-01,  8.9528e-01,  7.1463e-02, -1.6241e+00, -1.2727e-01,
        -8.2640e-01, -1.4643e-01, -3.4830e-01,  4.1360e-01, -1.8449e-01,
        -7.0624e-01,  8.7671e-02, -7.0982e-01, -5.1635e-01,  7.4806e-02,
         5.1213e-01, -1.2865e-01,  2.0872e-01, -8.1535e-02,  5.9056e-01,
        -4.1575e-01, -5.5161e-02, -1.7422e-01,  8.9817e-03, -9.5227e-02,
        -3.4136e-01, -5.9477e-01, -8.0225e-02,  3.8121e-01,  1.3623e+00,
         3.4425e-01, -1.3246e-01,  7.8188e-01,  3.0258e-01, -2.2237e-01,
        -2.4719e-01,  1.1713e-01,  7.9888e-01, -2.5969e-02, -1.1252e+00,
        -2.7520e-01,  3.2236e-01,  3.3716e-01,  3.5944e-02, -1.7170e-01,
        -7.3785e-01,  1.2651e-01, -3.9350e-02, -3.7240e-01, -1.4075e-01,
        -8.4013e-01,  3.7359e-01, -4.7051e-01,  8.8480e-02, -1.6546e-02,
         4.9786e-01, -5.8096e-01, -1.8873e-01, -2.5121e-01, -3.9380e-02,
         4.0694e-03, -3.0703e-01,  6.0828e-02,  2.1111e-01,  8.6529e-02,
        -1.9613e-01,  7.3131e-01, -2.6322e-01,  6.4098e-01, -5.7237e-01,
        -3.4422e-01, -1.7451e-01, -2.6886e-02, -8.8361e-01,  1.8117e-01,
         7.4646e-01,  8.7196e-01, -1.1736e+00,  2.7550e-01,  1.1739e-02,
        -9.2036e-01,  1.7764e-01,  3.5238e-01, -6.2739e-02, -5.7678e-01,
        -4.5776e-01, -5.5306e-01, -2.7362e-01,  9.0321e-02,  1.1504e-01,
        -5.9541e-01, -1.3428e+00,  2.4559e-01, -9.9920e-16, -9.9920e-16,
         3.1114e+00,  1.3849e-01,  2.4813e+00, -2.8954e+00,  5.9632e-01,
        -5.6662e-01,  1.8169e-01, -3.2624e-03,  2.0718e-02,  2.1226e-01,
         9.2872e-02, -1.3143e-01,  2.7299e-01,  2.4228e-01, -9.6495e-01,
         7.9448e-01,  5.3291e-15,  3.3665e-01, -1.1475e-03,  9.2821e-02,
         1.1428e-02,  3.2856e-01, -2.3612e-01,  1.7756e-02, -5.6831e-01,
         1.4121e-01, -2.5690e-01, -3.7294e-01,  3.5968e-01,  3.6648e-01,
        -4.1146e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([15216]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-2.5344e-01, -3.1096e-01, -6.7341e-01,  1.2490e+00, -4.1006e-01,
        -2.5781e-01, -5.0459e-01, -5.6837e-01, -9.2668e-02, -1.3391e-01,
        -3.0494e-01,  5.2440e-02, -7.0982e-01,  5.5361e-01,  2.3954e-01,
         1.5969e+00, -1.1194e-01,  1.4900e+00, -8.1535e-02, -1.3064e+00,
         2.7600e-01, -1.2736e-01, -5.1178e-01, -4.3434e-01,  3.2039e-01,
        -7.4341e-01, -6.4548e-01, -8.0225e-02, -6.0723e-01,  1.0306e-02,
        -3.0019e-01, -2.3412e-01,  4.1398e-01,  3.0258e-01, -5.5404e-01,
         4.7722e-01,  6.7906e-01, -6.4132e-01,  1.2262e+00, -4.8690e-01,
        -2.7090e-01,  1.5761e-02, -4.2001e-01, -3.7687e-01, -3.9244e-01,
         6.7322e-01,  3.8929e-02,  1.0615e+00, -1.0189e-01,  2.6221e-02,
         2.3339e+00, -5.3937e-01, -4.7051e-01, -6.7241e-01, -7.3405e-01,
         2.5985e-01, -9.5832e-01,  8.8949e-01, -2.1402e-01, -3.7729e-01,
         2.0044e+00,  2.0470e-01,  2.2179e+00,  2.0581e+00, -2.3054e-02,
         1.5396e+00, -4.9340e-01, -3.0781e-01,  6.4098e-01, -6.6845e-01,
        -3.4422e-01, -1.7451e-01, -2.6886e-02,  1.5724e-01,  1.7281e-01,
        -8.0240e-01,  8.7196e-01,  1.6555e-01,  1.4933e+00,  1.1739e-02,
        -9.2036e-01,  7.3198e-01, -1.6257e-01,  6.6372e-01,  9.9439e-01,
        -3.1379e-01, -4.5383e-01, -3.7081e-02, -2.5262e-01, -4.8432e-01,
         4.7028e-01, -9.4676e-01,  2.4559e-01, -9.9920e-16, -9.9920e-16,
        -2.0504e-01,  1.4241e-01, -1.7596e+00,  1.7051e+00,  1.4704e-01,
        -4.3362e-01, -1.4750e+00, -3.2624e-03, -1.1227e+00,  2.1226e-01,
         7.0597e-03, -1.9757e-01,  2.7299e-01, -1.7608e+00, -1.5179e+00,
         1.0186e+00,  5.3291e-15,  2.7466e-01,  4.5938e+00,  9.2821e-02,
         1.1428e-02, -3.0758e-01, -3.1646e-01,  1.7756e-02, -4.3565e-01,
         1.0607e+00, -8.0701e-02, -3.8260e-01,  3.5104e-01,  2.5291e-01,
        -3.3628e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2735]), tensor(0.0007))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.4204e-01,  9.0497e-01,  7.1025e-02, -1.6388e+00, -1.2056e-01,
        -8.2879e-01, -1.4566e-01, -3.4674e-01,  4.0978e-01, -1.8283e-01,
        -7.1041e-01,  9.1306e-02, -7.0798e-01, -5.2311e-01,  7.6981e-02,
         5.1650e-01, -1.2718e-01,  2.1020e-01, -8.0993e-02,  6.0212e-01,
        -4.0567e-01, -5.9257e-02, -1.7616e-01,  8.1113e-03, -9.1650e-02,
        -3.4175e-01, -5.9556e-01, -8.3323e-02,  3.6245e-01,  1.3576e+00,
         3.4575e-01, -1.2974e-01,  7.8350e-01,  3.0756e-01, -2.2172e-01,
        -2.3947e-01,  1.3213e-01,  8.0166e-01, -1.8019e-02, -1.1316e+00,
        -2.7344e-01,  2.8652e-01,  3.4979e-01,  3.1012e-02, -1.6565e-01,
        -7.3752e-01,  1.1264e-01, -4.6470e-02, -3.5081e-01, -1.4099e-01,
        -8.4408e-01,  3.6004e-01, -4.7003e-01,  8.6631e-02, -1.6777e-02,
         4.9713e-01, -5.7405e-01, -1.8628e-01, -2.5300e-01, -3.9390e-02,
         3.9095e-03, -3.0957e-01,  6.7811e-02,  2.1479e-01,  8.9776e-02,
        -1.9308e-01,  7.4305e-01, -2.6158e-01,  6.3569e-01, -5.7392e-01,
        -3.4702e-01, -1.7552e-01, -2.6984e-02, -8.8324e-01,  1.8516e-01,
         7.5307e-01,  8.8312e-01, -1.1774e+00,  2.7376e-01,  1.3360e-02,
        -9.5882e-01,  1.8817e-01,  3.5765e-01, -4.4799e-02, -5.7842e-01,
        -4.6241e-01, -5.5628e-01, -2.7512e-01,  9.2996e-02,  1.1420e-01,
        -6.0227e-01, -1.3410e+00,  2.4940e-01,  0.0000e+00,  0.0000e+00,
         3.1545e+00,  1.2984e-01,  2.4640e+00, -2.8995e+00,  5.9741e-01,
        -5.7146e-01,  1.9291e-01,  1.4458e-03, -3.1282e-02,  2.0882e-01,
         9.1615e-02, -1.4229e-01,  2.7212e-01,  1.4418e-01, -9.0940e-01,
         7.9023e-01,  3.5527e-15,  3.3744e-01,  6.4198e-03,  8.5865e-02,
         1.7372e-02,  3.3998e-01, -2.3104e-01,  1.7550e-02, -5.6647e-01,
         1.4017e-01, -2.4964e-01, -3.6628e-01,  3.6211e-01,  3.6720e-01,
        -4.1350e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([15280]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-1.4866e-01, -3.8436e-01,  1.6939e+00,  1.2290e+00,  1.2932e+00,
        -8.5364e-01, -5.5220e-01, -5.9230e-01, -1.4163e-01, -9.1641e-02,
        -4.8680e-01,  2.7352e-01, -7.0798e-01,  5.9831e-01,  8.0353e-02,
        -9.4614e-01,  2.0258e+00,  1.4897e+00, -8.0993e-02, -5.6157e-02,
        -2.1391e-01, -1.3037e-01, -1.5752e-01, -9.0284e-01,  8.5135e-01,
        -8.5961e-01, -5.7532e-01, -8.3323e-02,  6.7166e-01,  3.8547e-01,
         9.5406e-04,  7.4984e-01,  5.5137e-01,  3.0756e-01, -6.4749e-01,
         6.8013e-01,  4.3329e-01, -6.4366e-01,  1.1155e+00, -3.9802e-01,
        -2.7352e-01, -1.7590e-01,  3.4984e-01, -3.8674e-01,  6.9995e-01,
        -8.6480e-01, -1.8046e-01,  3.0750e-01, -8.9476e-02, -3.0337e-01,
         2.3328e+00, -2.6145e-01, -4.7003e-01, -6.7361e-01, -7.3673e-01,
         1.4283e-01, -9.5341e-01,  9.1073e-02, -7.1060e-01, -3.6045e-01,
         6.3468e-01, -5.5225e-01, -6.2751e-02, -1.3289e+00, -2.5585e-02,
        -2.5170e-01, -4.9021e-01, -3.8605e-01,  2.6573e+00, -7.2974e-01,
        -3.4702e-01, -1.7552e-01, -2.6984e-02, -1.0522e+00,  1.0922e-01,
         6.5243e-02,  8.8312e-01,  1.1512e-01,  1.4958e+00,  1.3360e-02,
        -9.5882e-01, -2.3551e-01, -4.1797e-01, -8.7387e-01, -3.8474e-01,
        -3.2019e-01, -4.5914e-01, -1.6928e-01, -5.6706e-01,  5.3923e-01,
        -2.6620e-01, -3.5075e-01,  2.4940e-01,  0.0000e+00,  0.0000e+00,
        -6.0167e-02,  2.3365e-01, -1.6341e+00,  1.2753e+00,  7.7413e-02,
        -4.6648e-01, -1.0458e-01,  1.4458e-03, -1.2036e+00,  2.0882e-01,
        -6.2544e-01, -1.6480e-01,  2.7212e-01,  1.0230e+00, -1.2542e+00,
        -8.3681e-01,  3.5527e-15,  3.7054e-01,  1.3856e+00,  8.5865e-02,
         1.7372e-02, -6.1138e-01,  2.4378e-01,  1.7550e-02, -3.4986e-01,
         1.2958e-01, -5.7191e-01, -7.4570e-01,  4.7395e-01,  4.0797e-01,
        -3.0856e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2643]), tensor(0.1286))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:main_restricted.py:Testing data year: 2010
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15845
            device: cpu
            
2024-07-29 21:14:38,942	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-29 21:14:38,985	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-29 21:14:39,030	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f56274661af3545d.zip' (1.46MiB) to Ray cluster...
2024-07-29 21:14:39,038	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f56274661af3545d.zip'.
2024-07-29 21:14:41,086	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-29 22:17:05,766	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_21-14-41' in 0.2236s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 15845, 'embedding_dim': 1, 'dropout_rate': 0.49, 'lr': 1.036720427012069e-05, 'weight_decay': 5.503363365456109e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10707025520671719
INFO:model_data_nn.py:Best trial testing loss: 0.07304333298926867
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-29_21-14-35_314253_592478/artifacts/2024-07-29_21-14-41/train_fnn_2024-07-29_21-14-41/driver_artifacts/train_fnn_3e324_00020_20_dropout_rate=0.4900,embedding_dim=1,hidden_dim=85,lr=0.0000,num_layers=4,weight_decay=0.0000_2024-07-29_21-14-41
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 15911, 'embedding_dim': 1, 'dropout_rate': 0.49, 'lr': 1.036720427012069e-05, 'weight_decay': 5.503363365456109e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.113455806745831, 'avg_test_loss': 0.06675149360263165}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.11107518963254508, 'avg_test_loss': 0.06692273789820702}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.11078829836566731, 'avg_test_loss': 0.06699928244690231}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1107069084144512, 'avg_test_loss': 0.06715516888601869}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.11059825005534292, 'avg_test_loss': 0.06719827843552227}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.1104894915782162, 'avg_test_loss': 0.06721321555883869}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.11031550686397507, 'avg_test_loss': 0.06737422156392743}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.11012311850664687, 'avg_test_loss': 0.06755406209757846}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10993696289867116, 'avg_test_loss': 0.06766880269309408}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.10974273740314285, 'avg_test_loss': 0.06747436853076674}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10962850382368182, 'avg_test_loss': 0.06816375964288518}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10937667823699508, 'avg_test_loss': 0.06785343730364714}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10918797531532931, 'avg_test_loss': 0.06820781939466924}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10911135600413173, 'avg_test_loss': 0.06862376741002918}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10893255471442569, 'avg_test_loss': 0.06791921570210864}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.10870075117918307, 'avg_test_loss': 0.06821449271305219}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.10870970646104607, 'avg_test_loss': 0.06831403319282751}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.10855337581067025, 'avg_test_loss': 0.06837812271949492}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.10836903586088606, 'avg_test_loss': 0.06837261530260245}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.10834898343972986, 'avg_test_loss': 0.06837200432231552}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.10816643256947699, 'avg_test_loss': 0.06888902942617342}
INFO:model_data_nn.py:Early stopping at epoch 21
INFO:main_restricted.py:Making prediction for data in year: 2011
INFO:main_restricted.py:Prediction data shape: (14552,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2011: 0.26245488630059033
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  14552.000000  14552.000000
mean      -0.010813      0.034594
std        0.256328      0.029109
min       -0.956637     -0.105411
25%       -0.153673      0.021223
50%       -0.006813      0.029646
75%        0.109958      0.042406
max        3.447154      0.281728
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:transform_data_nn.py:Train_data: (531164, 161)

INFO:transform_data_nn.py:Test data years: [2011]
INFO:transform_data_nn.py:Test_data: (14552, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:transform_data_nn.py:Retrain_data: (545716, 161)

INFO:transform_data_nn.py:Prediction data years: [2012]
INFO:transform_data_nn.py:Prediction_data: (14104, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([531164, 138])
            y_train_tf: torch.Size([531164])

            x_test_tf: torch.Size([14552, 138])
            y_test_tf: torch.Size([14552])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([545716, 138])
            y_retrain_tf: torch.Size([545716])

            x_prediction_tf: torch.Size([14104, 138])
            y_prediction_tf: torch.Size([14104])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.4204e-01,  9.0497e-01,  7.1025e-02, -1.6388e+00, -1.2056e-01,
        -8.2879e-01, -1.4566e-01, -3.4674e-01,  4.0978e-01, -1.8283e-01,
        -7.1041e-01,  9.1306e-02, -7.0798e-01, -5.2311e-01,  7.6981e-02,
         5.1650e-01, -1.2718e-01,  2.1020e-01, -8.0993e-02,  6.0212e-01,
        -4.0567e-01, -5.9257e-02, -1.7616e-01,  8.1113e-03, -9.1650e-02,
        -3.4175e-01, -5.9556e-01, -8.3323e-02,  3.6245e-01,  1.3576e+00,
         3.4575e-01, -1.2974e-01,  7.8350e-01,  3.0756e-01, -2.2172e-01,
        -2.3947e-01,  1.3213e-01,  8.0166e-01, -1.8019e-02, -1.1316e+00,
        -2.7344e-01,  2.8652e-01,  3.4979e-01,  3.1012e-02, -1.6565e-01,
        -7.3752e-01,  1.1264e-01, -4.6470e-02, -3.5081e-01, -1.4099e-01,
        -8.4408e-01,  3.6004e-01, -4.7003e-01,  8.6631e-02, -1.6777e-02,
         4.9713e-01, -5.7405e-01, -1.8628e-01, -2.5300e-01, -3.9390e-02,
         3.9095e-03, -3.0957e-01,  6.7811e-02,  2.1479e-01,  8.9776e-02,
        -1.9308e-01,  7.4305e-01, -2.6158e-01,  6.3569e-01, -5.7392e-01,
        -3.4702e-01, -1.7552e-01, -2.6984e-02, -8.8324e-01,  1.8516e-01,
         7.5307e-01,  8.8312e-01, -1.1774e+00,  2.7376e-01,  1.3360e-02,
        -9.5882e-01,  1.8817e-01,  3.5765e-01, -4.4799e-02, -5.7842e-01,
        -4.6241e-01, -5.5628e-01, -2.7512e-01,  9.2996e-02,  1.1420e-01,
        -6.0227e-01, -1.3410e+00,  2.4940e-01,  0.0000e+00,  0.0000e+00,
         3.1545e+00,  1.2984e-01,  2.4640e+00, -2.8995e+00,  5.9741e-01,
        -5.7146e-01,  1.9291e-01,  1.4458e-03, -3.1282e-02,  2.0882e-01,
         9.1615e-02, -1.4229e-01,  2.7212e-01,  1.4418e-01, -9.0940e-01,
         7.9023e-01,  3.5527e-15,  3.3744e-01,  6.4198e-03,  8.5865e-02,
         1.7372e-02,  3.3998e-01, -2.3104e-01,  1.7550e-02, -5.6647e-01,
         1.4017e-01, -2.4964e-01, -3.6628e-01,  3.6211e-01,  3.6720e-01,
        -4.1350e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([15280]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-1.4866e-01, -3.8436e-01,  1.6939e+00,  1.2290e+00,  1.2932e+00,
        -8.5364e-01, -5.5220e-01, -5.9230e-01, -1.4163e-01, -9.1641e-02,
        -4.8680e-01,  2.7352e-01, -7.0798e-01,  5.9831e-01,  8.0353e-02,
        -9.4614e-01,  2.0258e+00,  1.4897e+00, -8.0993e-02, -5.6157e-02,
        -2.1391e-01, -1.3037e-01, -1.5752e-01, -9.0284e-01,  8.5135e-01,
        -8.5961e-01, -5.7532e-01, -8.3323e-02,  6.7166e-01,  3.8547e-01,
         9.5406e-04,  7.4984e-01,  5.5137e-01,  3.0756e-01, -6.4749e-01,
         6.8013e-01,  4.3329e-01, -6.4366e-01,  1.1155e+00, -3.9802e-01,
        -2.7352e-01, -1.7590e-01,  3.4984e-01, -3.8674e-01,  6.9995e-01,
        -8.6480e-01, -1.8046e-01,  3.0750e-01, -8.9476e-02, -3.0337e-01,
         2.3328e+00, -2.6145e-01, -4.7003e-01, -6.7361e-01, -7.3673e-01,
         1.4283e-01, -9.5341e-01,  9.1073e-02, -7.1060e-01, -3.6045e-01,
         6.3468e-01, -5.5225e-01, -6.2751e-02, -1.3289e+00, -2.5585e-02,
        -2.5170e-01, -4.9021e-01, -3.8605e-01,  2.6573e+00, -7.2974e-01,
        -3.4702e-01, -1.7552e-01, -2.6984e-02, -1.0522e+00,  1.0922e-01,
         6.5243e-02,  8.8312e-01,  1.1512e-01,  1.4958e+00,  1.3360e-02,
        -9.5882e-01, -2.3551e-01, -4.1797e-01, -8.7387e-01, -3.8474e-01,
        -3.2019e-01, -4.5914e-01, -1.6928e-01, -5.6706e-01,  5.3923e-01,
        -2.6620e-01, -3.5075e-01,  2.4940e-01,  0.0000e+00,  0.0000e+00,
        -6.0167e-02,  2.3365e-01, -1.6341e+00,  1.2753e+00,  7.7413e-02,
        -4.6648e-01, -1.0458e-01,  1.4458e-03, -1.2036e+00,  2.0882e-01,
        -6.2544e-01, -1.6480e-01,  2.7212e-01,  1.0230e+00, -1.2542e+00,
        -8.3681e-01,  3.5527e-15,  3.7054e-01,  1.3856e+00,  8.5865e-02,
         1.7372e-02, -6.1138e-01,  2.4378e-01,  1.7550e-02, -3.4986e-01,
         1.2958e-01, -5.7191e-01, -7.4570e-01,  4.7395e-01,  4.0797e-01,
        -3.0856e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2643]), tensor(0.1286))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.3689e-01,  9.1157e-01,  6.9369e-02, -1.6528e+00, -1.1841e-01,
        -8.2997e-01, -1.4522e-01, -3.4551e-01,  4.0898e-01, -1.8154e-01,
        -7.1409e-01,  8.8285e-02, -7.0755e-01, -5.3051e-01,  7.9484e-02,
         5.1566e-01, -1.2543e-01,  2.0740e-01, -8.1313e-02,  6.0604e-01,
        -4.0398e-01, -6.3847e-02, -1.7607e-01,  7.2938e-03, -9.3163e-02,
        -3.4207e-01, -5.9572e-01, -8.5288e-02,  3.4276e-01,  1.3574e+00,
         3.4760e-01, -1.2902e-01,  7.8441e-01,  3.1260e-01, -2.2243e-01,
        -2.3153e-01,  1.4059e-01,  8.0375e-01, -1.4506e-02, -1.1356e+00,
        -2.7169e-01,  2.8390e-01,  3.5667e-01,  2.7859e-02, -1.6326e-01,
        -7.3498e-01,  1.0962e-01, -4.3715e-02, -3.4253e-01, -1.4341e-01,
        -8.4501e-01,  3.4471e-01, -4.6989e-01,  8.6626e-02, -1.6034e-02,
         4.9646e-01, -5.6699e-01, -1.8578e-01, -2.5334e-01, -3.5828e-02,
         8.2573e-04, -3.0962e-01,  7.1605e-02,  2.1474e-01,  8.6633e-02,
        -1.9115e-01,  7.5164e-01, -2.5935e-01,  6.2505e-01, -5.7514e-01,
        -3.4902e-01, -1.7629e-01, -2.6399e-02, -8.8201e-01,  1.8375e-01,
         7.5769e-01,  8.9317e-01, -1.1798e+00,  2.7173e-01,  1.4574e-02,
        -9.7922e-01,  1.9013e-01,  3.6375e-01, -2.7009e-02, -5.7969e-01,
        -4.6671e-01, -5.5887e-01, -2.7655e-01,  9.6208e-02,  1.1249e-01,
        -6.0925e-01, -1.3408e+00,  2.5293e-01,  1.2212e-15,  1.2212e-15,
         3.1977e+00,  1.2540e-01,  2.4540e+00, -2.9155e+00,  6.0812e-01,
        -5.8052e-01,  1.9693e-01,  7.3229e-03,  2.6452e-02,  1.9573e-01,
         5.2888e-02, -1.4760e-01,  3.1676e-01,  2.2975e-01, -8.9574e-01,
         8.0794e-01, -3.5527e-15,  3.3442e-01,  1.9658e-02,  7.4325e-02,
         1.9734e-02,  3.5144e-01, -2.2905e-01,  1.7363e-02, -5.6395e-01,
         1.4048e-01, -2.4261e-01, -3.6250e-01,  3.6109e-01,  3.6553e-01,
        -4.1516e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([15439]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-9.1540e-01,  2.4769e-01, -3.3152e-01,  1.2101e+00,  5.1742e-02,
        -8.5674e-01, -1.2410e+00, -8.2972e-01,  4.9757e-02,  1.0736e-01,
        -3.8931e-01,  1.0250e-01, -7.0755e-01,  1.1292e-01, -2.7881e-01,
        -4.2093e-01, -2.1141e-01,  4.3789e-01, -2.4972e-03, -2.1453e-02,
        -2.5788e-01, -1.3231e-01, -2.2300e-01,  1.1090e-01, -2.4793e-01,
        -7.1905e-01, -6.5163e-01, -8.5288e-02, -2.5324e-01,  6.7568e-01,
         1.0699e-02,  2.7583e-01,  4.0599e-01,  3.1260e-01, -6.5606e-01,
        -3.2582e-01,  2.2114e+00, -6.4318e-01,  3.8407e-02, -8.1228e-01,
        -2.6887e-01, -2.1768e-02,  1.5608e+00, -4.0965e-01, -2.8912e-01,
        -8.5881e-01, -7.5526e-02,  3.0800e-01,  1.4610e-01, -2.5192e-01,
        -5.1011e-02, -2.1669e-01, -4.6989e-01, -3.7144e-01, -7.3728e-01,
         7.1490e-02, -9.4836e-01, -4.4846e-01,  8.6418e-01, -2.8403e-01,
        -1.4576e-01,  8.3445e-01,  2.5686e-01,  3.0595e-01, -2.4979e-02,
        -1.0063e-01, -8.5363e-02, -1.4782e+00, -7.1970e-01, -6.1788e-01,
        -3.4902e-01, -1.7629e-01, -2.6399e-02, -1.0134e+00,  2.0826e-01,
        -2.3417e-02,  2.6780e-01,  3.3369e-01,  1.4982e+00,  1.4574e-02,
         9.2404e-01,  1.0937e-01, -3.8311e-01, -5.1559e-01, -5.7603e-01,
        -3.3527e-01, -4.6945e-01, -4.1899e-01, -3.8347e-01, -2.3051e-01,
        -5.9140e-01,  1.7751e+00,  2.5293e-01,  1.2212e-15,  1.2212e-15,
        -6.4329e-02, -7.2743e-01, -1.5994e+00,  2.1592e-01,  6.0812e-01,
         8.8690e-02, -7.0430e-02,  7.3229e-03, -8.2229e-01,  1.9573e-01,
         3.9552e+00, -1.6782e-01, -1.9428e-01,  2.0045e+00, -6.9486e-01,
        -4.2603e-01, -3.5527e-15,  3.3997e-01, -7.3946e-02, -6.4652e-01,
        -3.4309e+00, -5.9862e-01, -2.5489e-01,  1.7363e-02, -5.3383e-01,
        -6.4987e-01, -5.3894e-01, -5.1364e-01,  3.4006e-01,  1.9917e-01,
        -3.1055e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00]), tensor([2539]), tensor(0.0332))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:main_restricted.py:Testing data year: 2011
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15911
            device: cpu
            
2024-07-29 23:47:46,094	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-29 23:47:46,155	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-29 23:47:46,194	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f56274661af3545d.zip' (1.46MiB) to Ray cluster...
2024-07-29 23:47:46,202	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f56274661af3545d.zip'.
2024-07-29 23:47:48,290	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-30 00:32:34,420	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_23-47-48' in 0.2180s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 5, 'num_embeddings': 15911, 'embedding_dim': 7, 'dropout_rate': 0.39, 'lr': 4.380580767905661e-05, 'weight_decay': 0.00018477934173519273, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10003517796189501
INFO:model_data_nn.py:Best trial testing loss: 0.06471263422026184
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-29_23-47-43_007638_592478/artifacts/2024-07-29_23-47-48/train_fnn_2024-07-29_23-47-48/driver_artifacts/train_fnn_a2326_00015_15_dropout_rate=0.3900,embedding_dim=7,hidden_dim=35,lr=0.0000,num_layers=5,weight_decay=0.0002_2024-07-29_23-47-48
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 5, 'num_embeddings': 16081, 'embedding_dim': 7, 'dropout_rate': 0.39, 'lr': 4.380580767905661e-05, 'weight_decay': 0.00018477934173519273, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.1100423063430957, 'avg_test_loss': 0.07460045787543733}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10944231380010515, 'avg_test_loss': 0.07490216294615382}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10878123403811941, 'avg_test_loss': 0.07506287434639838}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10816021035564091, 'avg_test_loss': 0.07504821712850715}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10774805131402201, 'avg_test_loss': 0.0750905927144227}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10736482583096461, 'avg_test_loss': 0.07520009436522404}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10706241015404282, 'avg_test_loss': 0.07550927356087783}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10657136828544454, 'avg_test_loss': 0.07596463862199725}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10607394314262472, 'avg_test_loss': 0.07598018843461485}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.10557318062338224, 'avg_test_loss': 0.07606329006981526}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10525494385244154, 'avg_test_loss': 0.07601748324711533}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10474451175630232, 'avg_test_loss': 0.07583070484862338}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10432090309087852, 'avg_test_loss': 0.07618737182415583}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10403538193665542, 'avg_test_loss': 0.07656229366190158}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10370569353529525, 'avg_test_loss': 0.07699962006671127}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.1035421144821531, 'avg_test_loss': 0.0764035426408929}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.10327223790912192, 'avg_test_loss': 0.07669579853805211}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.10292156100135061, 'avg_test_loss': 0.07709834782398259}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.10263948821303866, 'avg_test_loss': 0.0770626627751605}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.10244485721212303, 'avg_test_loss': 0.07688111172592883}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.10228133379452677, 'avg_test_loss': 0.07678996503976811}
INFO:model_data_nn.py:Early stopping at epoch 21
INFO:main_restricted.py:Making prediction for data in year: 2012
INFO:main_restricted.py:Prediction data shape: (14104,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2012: 0.2767672398241564
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  14104.000000  14104.000000
mean       0.048736      0.020461
std        0.272076      0.036110
min       -0.918750     -0.106282
25%       -0.066871     -0.010488
50%        0.024092      0.024694
75%        0.136884      0.043755
max       10.269234      0.262788
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:transform_data_nn.py:Train_data: (545716, 161)

INFO:transform_data_nn.py:Test data years: [2012]
INFO:transform_data_nn.py:Test_data: (14104, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:transform_data_nn.py:Retrain_data: (559820, 161)

INFO:transform_data_nn.py:Prediction data years: [2013]
INFO:transform_data_nn.py:Prediction_data: (13650, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([545716, 138])
            y_train_tf: torch.Size([545716])

            x_test_tf: torch.Size([14104, 138])
            y_test_tf: torch.Size([14104])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([559820, 138])
            y_retrain_tf: torch.Size([559820])

            x_prediction_tf: torch.Size([13650, 138])
            y_prediction_tf: torch.Size([13650])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.3689e-01,  9.1157e-01,  6.9369e-02, -1.6528e+00, -1.1841e-01,
        -8.2997e-01, -1.4522e-01, -3.4551e-01,  4.0898e-01, -1.8154e-01,
        -7.1409e-01,  8.8285e-02, -7.0755e-01, -5.3051e-01,  7.9484e-02,
         5.1566e-01, -1.2543e-01,  2.0740e-01, -8.1313e-02,  6.0604e-01,
        -4.0398e-01, -6.3847e-02, -1.7607e-01,  7.2938e-03, -9.3163e-02,
        -3.4207e-01, -5.9572e-01, -8.5288e-02,  3.4276e-01,  1.3574e+00,
         3.4760e-01, -1.2902e-01,  7.8441e-01,  3.1260e-01, -2.2243e-01,
        -2.3153e-01,  1.4059e-01,  8.0375e-01, -1.4506e-02, -1.1356e+00,
        -2.7169e-01,  2.8390e-01,  3.5667e-01,  2.7859e-02, -1.6326e-01,
        -7.3498e-01,  1.0962e-01, -4.3715e-02, -3.4253e-01, -1.4341e-01,
        -8.4501e-01,  3.4471e-01, -4.6989e-01,  8.6626e-02, -1.6034e-02,
         4.9646e-01, -5.6699e-01, -1.8578e-01, -2.5334e-01, -3.5828e-02,
         8.2573e-04, -3.0962e-01,  7.1605e-02,  2.1474e-01,  8.6633e-02,
        -1.9115e-01,  7.5164e-01, -2.5935e-01,  6.2505e-01, -5.7514e-01,
        -3.4902e-01, -1.7629e-01, -2.6399e-02, -8.8201e-01,  1.8375e-01,
         7.5769e-01,  8.9317e-01, -1.1798e+00,  2.7173e-01,  1.4574e-02,
        -9.7922e-01,  1.9013e-01,  3.6375e-01, -2.7009e-02, -5.7969e-01,
        -4.6671e-01, -5.5887e-01, -2.7655e-01,  9.6208e-02,  1.1249e-01,
        -6.0925e-01, -1.3408e+00,  2.5293e-01,  1.2212e-15,  1.2212e-15,
         3.1977e+00,  1.2540e-01,  2.4540e+00, -2.9155e+00,  6.0812e-01,
        -5.8052e-01,  1.9693e-01,  7.3229e-03,  2.6452e-02,  1.9573e-01,
         5.2888e-02, -1.4760e-01,  3.1676e-01,  2.2975e-01, -8.9574e-01,
         8.0794e-01, -3.5527e-15,  3.3442e-01,  1.9658e-02,  7.4325e-02,
         1.9734e-02,  3.5144e-01, -2.2905e-01,  1.7363e-02, -5.6395e-01,
         1.4048e-01, -2.4261e-01, -3.6250e-01,  3.6109e-01,  3.6553e-01,
        -4.1516e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([15439]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-9.1540e-01,  2.4769e-01, -3.3152e-01,  1.2101e+00,  5.1742e-02,
        -8.5674e-01, -1.2410e+00, -8.2972e-01,  4.9757e-02,  1.0736e-01,
        -3.8931e-01,  1.0250e-01, -7.0755e-01,  1.1292e-01, -2.7881e-01,
        -4.2093e-01, -2.1141e-01,  4.3789e-01, -2.4972e-03, -2.1453e-02,
        -2.5788e-01, -1.3231e-01, -2.2300e-01,  1.1090e-01, -2.4793e-01,
        -7.1905e-01, -6.5163e-01, -8.5288e-02, -2.5324e-01,  6.7568e-01,
         1.0699e-02,  2.7583e-01,  4.0599e-01,  3.1260e-01, -6.5606e-01,
        -3.2582e-01,  2.2114e+00, -6.4318e-01,  3.8407e-02, -8.1228e-01,
        -2.6887e-01, -2.1768e-02,  1.5608e+00, -4.0965e-01, -2.8912e-01,
        -8.5881e-01, -7.5526e-02,  3.0800e-01,  1.4610e-01, -2.5192e-01,
        -5.1011e-02, -2.1669e-01, -4.6989e-01, -3.7144e-01, -7.3728e-01,
         7.1490e-02, -9.4836e-01, -4.4846e-01,  8.6418e-01, -2.8403e-01,
        -1.4576e-01,  8.3445e-01,  2.5686e-01,  3.0595e-01, -2.4979e-02,
        -1.0063e-01, -8.5363e-02, -1.4782e+00, -7.1970e-01, -6.1788e-01,
        -3.4902e-01, -1.7629e-01, -2.6399e-02, -1.0134e+00,  2.0826e-01,
        -2.3417e-02,  2.6780e-01,  3.3369e-01,  1.4982e+00,  1.4574e-02,
         9.2404e-01,  1.0937e-01, -3.8311e-01, -5.1559e-01, -5.7603e-01,
        -3.3527e-01, -4.6945e-01, -4.1899e-01, -3.8347e-01, -2.3051e-01,
        -5.9140e-01,  1.7751e+00,  2.5293e-01,  1.2212e-15,  1.2212e-15,
        -6.4329e-02, -7.2743e-01, -1.5994e+00,  2.1592e-01,  6.0812e-01,
         8.8690e-02, -7.0430e-02,  7.3229e-03, -8.2229e-01,  1.9573e-01,
         3.9552e+00, -1.6782e-01, -1.9428e-01,  2.0045e+00, -6.9486e-01,
        -4.2603e-01, -3.5527e-15,  3.3997e-01, -7.3946e-02, -6.4652e-01,
        -3.4309e+00, -5.9862e-01, -2.5489e-01,  1.7363e-02, -5.3383e-01,
        -6.4987e-01, -5.3894e-01, -5.1364e-01,  3.4006e-01,  1.9917e-01,
        -3.1055e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00]), tensor([2539]), tensor(0.0332))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.3134e-01,  9.1741e-01,  6.8600e-02, -1.6661e+00, -1.1546e-01,
        -8.2999e-01, -1.4765e-01, -3.4688e-01,  4.0666e-01, -1.8007e-01,
        -7.1706e-01,  8.6669e-02, -7.0631e-01, -5.3659e-01,  8.0938e-02,
         5.1852e-01, -1.2317e-01,  2.0496e-01, -8.0231e-02,  6.1119e-01,
        -4.0744e-01, -6.4498e-02, -1.7740e-01,  8.2663e-03, -9.5221e-02,
        -3.4235e-01, -5.9517e-01, -8.6764e-02,  3.2506e-01,  1.3596e+00,
         3.4679e-01, -1.2692e-01,  7.8438e-01,  3.1710e-01, -2.2289e-01,
        -2.3086e-01,  1.4533e-01,  8.0607e-01, -1.3221e-02, -1.1325e+00,
        -2.7025e-01,  2.9709e-01,  3.6244e-01,  2.4822e-02, -1.6114e-01,
        -7.3257e-01,  1.1550e-01, -4.7342e-02, -3.5036e-01, -1.4263e-01,
        -8.4546e-01,  3.3027e-01, -4.6971e-01,  8.8318e-02, -1.3565e-02,
         4.9486e-01, -5.6010e-01, -1.8500e-01, -2.5326e-01, -3.2945e-02,
         5.2329e-04, -3.0915e-01,  7.4502e-02,  2.1366e-01,  8.6836e-02,
        -1.8950e-01,  7.5984e-01, -2.5695e-01,  6.2041e-01, -5.7606e-01,
        -3.5119e-01, -1.7717e-01, -2.5276e-02, -8.7995e-01,  1.8319e-01,
         7.6310e-01,  9.0150e-01, -1.1813e+00,  2.6892e-01,  1.4756e-02,
        -1.0024e+00,  1.9299e-01,  3.6787e-01, -1.1292e-02, -5.8009e-01,
        -4.7025e-01, -5.6101e-01, -2.7805e-01,  1.0030e-01,  1.1237e-01,
        -6.1468e-01, -1.3391e+00,  2.5619e-01,  1.3323e-15,  1.3323e-15,
         3.2409e+00,  1.5289e-01,  2.4501e+00, -2.9549e+00,  5.9736e-01,
        -5.8456e-01,  2.0129e-01,  1.0080e-02,  2.5722e-02,  1.8887e-01,
         4.4875e-02, -1.4970e-01,  2.9308e-01,  3.5833e-01, -8.7931e-01,
         8.3088e-01,  1.2434e-14,  3.3043e-01,  2.1224e-02,  7.2497e-02,
         1.7726e-02,  3.6186e-01, -2.2825e-01,  2.8958e-02, -5.6168e-01,
         1.4255e-01, -2.3650e-01, -3.5840e-01,  3.6035e-01,  3.6384e-01,
        -4.1619e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([15579]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-1.4549e-01, -3.7391e-01,  1.8760e-01,  1.1923e+00, -1.6308e-01,
        -5.1522e-01, -1.2280e+00, -8.2958e-01,  2.8453e-01,  3.7376e-01,
        -7.1323e-01, -3.7186e-02, -7.0631e-01,  5.7672e-01,  9.5974e-02,
        -5.9167e-01, -2.1170e-01,  7.9871e-01, -6.4928e-03, -3.2868e-01,
         4.6456e-02, -1.3384e-01, -8.4167e-02, -2.5031e-01, -2.6656e-01,
        -8.1576e-01, -6.6191e-01, -8.6764e-02,  3.8224e-02,  1.2989e+00,
        -1.4633e+00, -2.4447e-01,  2.4122e-01,  3.1710e-01, -7.5839e-01,
         2.6573e-01,  5.4074e-01, -6.3729e-01,  4.6888e-01, -1.1161e+00,
        -2.6478e-01, -3.2840e-01,  5.7793e-01, -2.9995e-01, -7.8543e-02,
        -7.4276e-01, -4.3808e-01, -1.5116e-01, -8.7587e-02, -2.4871e-01,
         7.4218e-01, -3.2487e-01, -4.6971e-01, -3.7833e-01, -1.3565e-02,
        -4.2524e-02, -9.4346e-01, -4.6739e-01, -5.9257e-01, -2.6549e-01,
        -2.0328e-01, -6.0882e-01,  5.8847e-02, -1.0648e+00, -2.3387e-02,
        -1.8379e-01, -4.8605e-01,  2.0428e-01,  6.2041e-01, -7.0234e-01,
        -3.5119e-01, -1.7717e-01, -2.5276e-02, -8.3436e-01, -2.0635e-02,
        -6.0002e-02,  9.0150e-01,  4.0698e-01,  1.4995e+00,  1.4756e-02,
         8.2353e-01, -6.2025e-01, -3.4493e-01, -8.4149e-01, -5.3665e-01,
        -3.7968e-01, -4.9422e-01, -3.5890e-01, -6.0860e-01, -7.1343e-01,
        -4.9902e-01,  6.7590e-01,  2.5619e-01,  1.3323e-15,  1.3323e-15,
        -1.0106e-01, -9.4955e-01, -1.5124e+00,  1.0751e-01, -1.5377e-01,
        -4.1755e-01, -1.8981e-01,  1.0080e-02, -8.2532e-01,  1.8887e-01,
         3.9336e+00, -2.2935e-01,  8.1304e-01,  2.0392e-01, -9.6015e-01,
        -6.8517e-01,  1.2434e-14,  2.2073e-01, -2.0105e+00, -3.9169e-01,
        -3.3986e+00, -5.0987e-01, -1.5158e-01,  2.8958e-02, -2.0123e-01,
         3.8092e-01, -6.5375e-01, -8.0499e-01,  1.8264e-01,  3.9108e-02,
        -3.3784e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2459]), tensor(0.1081))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:main_restricted.py:Testing data year: 2012
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 16081
            device: cpu
            
2024-07-30 02:03:17,614	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-30 02:03:17,675	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-30 02:03:17,729	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f56274661af3545d.zip' (1.46MiB) to Ray cluster...
2024-07-30 02:03:17,739	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f56274661af3545d.zip'.
2024-07-30 02:03:19,935	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-30 03:17:55,987	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_02-03-19' in 0.2654s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 16081, 'embedding_dim': 6, 'dropout_rate': 0.54, 'lr': 3.4419719400899214e-05, 'weight_decay': 0.00016266799643038432, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10880186879553413
INFO:model_data_nn.py:Best trial testing loss: 0.07421811725691432
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-30_02-03-14_815888_592478/artifacts/2024-07-30_02-03-19/train_fnn_2024-07-30_02-03-19/driver_artifacts/train_fnn_9108e_00077_77_dropout_rate=0.5400,embedding_dim=6,hidden_dim=5,lr=0.0000,num_layers=5,weight_decay=0.0002_2024-07-30_02-03-20
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 16225, 'embedding_dim': 6, 'dropout_rate': 0.54, 'lr': 3.4419719400899214e-05, 'weight_decay': 0.00016266799643038432, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10889553416439864, 'avg_test_loss': 0.05784358998551686}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10876492437772087, 'avg_test_loss': 0.05792831560318297}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10876293809313808, 'avg_test_loss': 0.05774446625575841}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1087505927317273, 'avg_test_loss': 0.057837432128525226}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10871979641462239, 'avg_test_loss': 0.057600890016444375}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10869305543503557, 'avg_test_loss': 0.05756471051059872}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10867572506067513, 'avg_test_loss': 0.05759988375286633}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10863510178934646, 'avg_test_loss': 0.05743387681388549}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10860102391780799, 'avg_test_loss': 0.05742130160035792}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.1085840203511084, 'avg_test_loss': 0.0573500904654997}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10853947547068593, 'avg_test_loss': 0.05737269132737523}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10850701880464217, 'avg_test_loss': 0.057180104285443775}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10845083420655618, 'avg_test_loss': 0.05732531827726515}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10846260801529228, 'avg_test_loss': 0.057009312559232535}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10843998594932507, 'avg_test_loss': 0.057278155801800366}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.1083545200520326, 'avg_test_loss': 0.057122557376137126}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.10838381192106356, 'avg_test_loss': 0.05712501329117428}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.10837153892598282, 'avg_test_loss': 0.057174677969278574}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.10829704280312782, 'avg_test_loss': 0.05701115394498561}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.10826295795438937, 'avg_test_loss': 0.05711156240812389}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.10828205941723451, 'avg_test_loss': 0.05713364083720284}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.10822718431192513, 'avg_test_loss': 0.0570429932743868}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.10827703403064738, 'avg_test_loss': 0.05705405209457206}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.10825958155922662, 'avg_test_loss': 0.05709727812628044}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.10823189587400132, 'avg_test_loss': 0.057089264835361565}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.10818606291217124, 'avg_test_loss': 0.05701895546011418}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.10819577791092327, 'avg_test_loss': 0.05700261468746673}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.10815233880309216, 'avg_test_loss': 0.057161755672716925}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.10817912696507559, 'avg_test_loss': 0.05717240455865025}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.10814275647101197, 'avg_test_loss': 0.05703751934761895}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.1081544082972531, 'avg_test_loss': 0.057044927557390705}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.10812653671016118, 'avg_test_loss': 0.05705516425474921}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.10811038408119658, 'avg_test_loss': 0.05685961713457358}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.10810919083072258, 'avg_test_loss': 0.056770315032591605}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.10815471922100353, 'avg_test_loss': 0.056932424521508894}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.10812984244086421, 'avg_test_loss': 0.056945868850485463}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.10812401074762376, 'avg_test_loss': 0.056733868715884254}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.1080741392574396, 'avg_test_loss': 0.05707620654829612}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.10805618518145102, 'avg_test_loss': 0.057064493312979137}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.1081027891039695, 'avg_test_loss': 0.05708279902393991}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.10814137741002551, 'avg_test_loss': 0.05693406025469999}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.1081074440854576, 'avg_test_loss': 0.05683988602135644}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.10813555064905749, 'avg_test_loss': 0.05686146796846362}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.10811145072013933, 'avg_test_loss': 0.05678063306835628}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.10810721952140645, 'avg_test_loss': 0.05684981200513299}
INFO:model_data_nn.py:Epoch 46/50, metrics: {'avg_train_loss': 0.10808515890272628, 'avg_test_loss': 0.05694150123048887}
INFO:model_data_nn.py:Epoch 47/50, metrics: {'avg_train_loss': 0.10807574537650945, 'avg_test_loss': 0.05676652243900522}
INFO:model_data_nn.py:Epoch 48/50, metrics: {'avg_train_loss': 0.1081075969707837, 'avg_test_loss': 0.056803155955902046}
INFO:model_data_nn.py:Epoch 49/50, metrics: {'avg_train_loss': 0.10806976003325114, 'avg_test_loss': 0.05678375982722946}
INFO:model_data_nn.py:Epoch 50/50, metrics: {'avg_train_loss': 0.10809177875167862, 'avg_test_loss': 0.05690272158516623}
INFO:main_restricted.py:Making prediction for data in year: 2013
INFO:main_restricted.py:Prediction data shape: (13650,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2013: 0.2387222142797318
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  13650.000000  13650.000000
mean       0.095489      0.045213
std        0.233383      0.009908
min       -0.927594     -0.115940
25%       -0.012730      0.047807
50%        0.068853      0.047807
75%        0.174490      0.047807
max        3.696775      0.047827
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:transform_data_nn.py:Train_data: (559820, 161)

INFO:transform_data_nn.py:Test data years: [2013]
INFO:transform_data_nn.py:Test_data: (13650, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:transform_data_nn.py:Retrain_data: (573470, 161)

INFO:transform_data_nn.py:Prediction data years: [2014]
INFO:transform_data_nn.py:Prediction_data: (13465, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([559820, 138])
            y_train_tf: torch.Size([559820])

            x_test_tf: torch.Size([13650, 138])
            y_test_tf: torch.Size([13650])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([573470, 138])
            y_retrain_tf: torch.Size([573470])

            x_prediction_tf: torch.Size([13465, 138])
            y_prediction_tf: torch.Size([13465])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.3134e-01,  9.1741e-01,  6.8600e-02, -1.6661e+00, -1.1546e-01,
        -8.2999e-01, -1.4765e-01, -3.4688e-01,  4.0666e-01, -1.8007e-01,
        -7.1706e-01,  8.6669e-02, -7.0631e-01, -5.3659e-01,  8.0938e-02,
         5.1852e-01, -1.2317e-01,  2.0496e-01, -8.0231e-02,  6.1119e-01,
        -4.0744e-01, -6.4498e-02, -1.7740e-01,  8.2663e-03, -9.5221e-02,
        -3.4235e-01, -5.9517e-01, -8.6764e-02,  3.2506e-01,  1.3596e+00,
         3.4679e-01, -1.2692e-01,  7.8438e-01,  3.1710e-01, -2.2289e-01,
        -2.3086e-01,  1.4533e-01,  8.0607e-01, -1.3221e-02, -1.1325e+00,
        -2.7025e-01,  2.9709e-01,  3.6244e-01,  2.4822e-02, -1.6114e-01,
        -7.3257e-01,  1.1550e-01, -4.7342e-02, -3.5036e-01, -1.4263e-01,
        -8.4546e-01,  3.3027e-01, -4.6971e-01,  8.8318e-02, -1.3565e-02,
         4.9486e-01, -5.6010e-01, -1.8500e-01, -2.5326e-01, -3.2945e-02,
         5.2329e-04, -3.0915e-01,  7.4502e-02,  2.1366e-01,  8.6836e-02,
        -1.8950e-01,  7.5984e-01, -2.5695e-01,  6.2041e-01, -5.7606e-01,
        -3.5119e-01, -1.7717e-01, -2.5276e-02, -8.7995e-01,  1.8319e-01,
         7.6310e-01,  9.0150e-01, -1.1813e+00,  2.6892e-01,  1.4756e-02,
        -1.0024e+00,  1.9299e-01,  3.6787e-01, -1.1292e-02, -5.8009e-01,
        -4.7025e-01, -5.6101e-01, -2.7805e-01,  1.0030e-01,  1.1237e-01,
        -6.1468e-01, -1.3391e+00,  2.5619e-01,  1.3323e-15,  1.3323e-15,
         3.2409e+00,  1.5289e-01,  2.4501e+00, -2.9549e+00,  5.9736e-01,
        -5.8456e-01,  2.0129e-01,  1.0080e-02,  2.5722e-02,  1.8887e-01,
         4.4875e-02, -1.4970e-01,  2.9308e-01,  3.5833e-01, -8.7931e-01,
         8.3088e-01,  1.2434e-14,  3.3043e-01,  2.1224e-02,  7.2497e-02,
         1.7726e-02,  3.6186e-01, -2.2825e-01,  2.8958e-02, -5.6168e-01,
         1.4255e-01, -2.3650e-01, -3.5840e-01,  3.6035e-01,  3.6384e-01,
        -4.1619e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([15579]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-1.4549e-01, -3.7391e-01,  1.8760e-01,  1.1923e+00, -1.6308e-01,
        -5.1522e-01, -1.2280e+00, -8.2958e-01,  2.8453e-01,  3.7376e-01,
        -7.1323e-01, -3.7186e-02, -7.0631e-01,  5.7672e-01,  9.5974e-02,
        -5.9167e-01, -2.1170e-01,  7.9871e-01, -6.4928e-03, -3.2868e-01,
         4.6456e-02, -1.3384e-01, -8.4167e-02, -2.5031e-01, -2.6656e-01,
        -8.1576e-01, -6.6191e-01, -8.6764e-02,  3.8224e-02,  1.2989e+00,
        -1.4633e+00, -2.4447e-01,  2.4122e-01,  3.1710e-01, -7.5839e-01,
         2.6573e-01,  5.4074e-01, -6.3729e-01,  4.6888e-01, -1.1161e+00,
        -2.6478e-01, -3.2840e-01,  5.7793e-01, -2.9995e-01, -7.8543e-02,
        -7.4276e-01, -4.3808e-01, -1.5116e-01, -8.7587e-02, -2.4871e-01,
         7.4218e-01, -3.2487e-01, -4.6971e-01, -3.7833e-01, -1.3565e-02,
        -4.2524e-02, -9.4346e-01, -4.6739e-01, -5.9257e-01, -2.6549e-01,
        -2.0328e-01, -6.0882e-01,  5.8847e-02, -1.0648e+00, -2.3387e-02,
        -1.8379e-01, -4.8605e-01,  2.0428e-01,  6.2041e-01, -7.0234e-01,
        -3.5119e-01, -1.7717e-01, -2.5276e-02, -8.3436e-01, -2.0635e-02,
        -6.0002e-02,  9.0150e-01,  4.0698e-01,  1.4995e+00,  1.4756e-02,
         8.2353e-01, -6.2025e-01, -3.4493e-01, -8.4149e-01, -5.3665e-01,
        -3.7968e-01, -4.9422e-01, -3.5890e-01, -6.0860e-01, -7.1343e-01,
        -4.9902e-01,  6.7590e-01,  2.5619e-01,  1.3323e-15,  1.3323e-15,
        -1.0106e-01, -9.4955e-01, -1.5124e+00,  1.0751e-01, -1.5377e-01,
        -4.1755e-01, -1.8981e-01,  1.0080e-02, -8.2532e-01,  1.8887e-01,
         3.9336e+00, -2.2935e-01,  8.1304e-01,  2.0392e-01, -9.6015e-01,
        -6.8517e-01,  1.2434e-14,  2.2073e-01, -2.0105e+00, -3.9169e-01,
        -3.3986e+00, -5.0987e-01, -1.5158e-01,  2.8958e-02, -2.0123e-01,
         3.8092e-01, -6.5375e-01, -8.0499e-01,  1.8264e-01,  3.9108e-02,
        -3.3784e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2459]), tensor(0.1081))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.2712e-01,  9.2409e-01,  6.6992e-02, -1.6785e+00, -1.1233e-01,
        -8.2670e-01, -1.5045e-01, -3.4872e-01,  4.0952e-01, -1.7885e-01,
        -7.1955e-01,  8.7390e-02, -7.0704e-01, -5.4205e-01,  8.3250e-02,
         5.2239e-01, -1.2151e-01,  2.0256e-01, -8.3591e-02,  6.1778e-01,
        -4.1136e-01, -6.7821e-02, -1.8047e-01,  9.7519e-03, -9.5602e-02,
        -3.4241e-01, -5.9448e-01, -8.7497e-02,  3.0576e-01,  1.3617e+00,
         3.4786e-01, -1.2465e-01,  7.8587e-01,  3.2159e-01, -2.2264e-01,
        -2.3219e-01,  1.5006e-01,  8.0883e-01, -1.1515e-02, -1.1254e+00,
        -2.6839e-01,  2.9494e-01,  3.6886e-01,  2.4009e-02, -1.5918e-01,
        -7.2673e-01,  1.1317e-01, -5.1507e-02, -3.5028e-01, -1.4660e-01,
        -8.4682e-01,  3.1403e-01, -4.6974e-01,  9.0548e-02, -1.0862e-02,
         4.9251e-01, -5.5361e-01, -1.8394e-01, -2.5323e-01, -3.0984e-02,
        -3.3121e-04, -3.0907e-01,  7.5793e-02,  2.1515e-01,  8.9659e-02,
        -1.8882e-01,  7.6813e-01, -2.5451e-01,  6.1676e-01, -5.7672e-01,
        -3.5287e-01, -1.7814e-01, -2.5421e-02, -8.7254e-01,  1.8428e-01,
         7.7113e-01,  9.0929e-01, -1.1825e+00,  2.6667e-01,  1.4808e-02,
        -1.0121e+00,  1.9789e-01,  3.7412e-01,  2.4083e-03, -5.8094e-01,
        -4.7349e-01, -5.6256e-01, -2.7868e-01,  1.0453e-01,  1.1347e-01,
        -6.1938e-01, -1.3370e+00,  2.5965e-01,  1.4433e-15,  1.4433e-15,
         3.2826e+00,  1.6600e-01,  2.4501e+00, -2.9904e+00,  6.1111e-01,
        -5.8062e-01,  2.0672e-01,  1.0280e-02, -5.3443e-02,  1.8299e-01,
         6.5259e-02, -1.5122e-01,  2.8433e-01,  4.2051e-01, -8.7025e-01,
         8.4897e-01,  3.5527e-15,  3.2663e-01,  2.2914e-02,  7.2964e-02,
         1.3990e-02,  3.7160e-01, -2.2736e-01,  5.0014e-02, -5.6005e-01,
         1.4389e-01, -2.3080e-01, -3.5506e-01,  3.6060e-01,  3.6296e-01,
        -4.1606e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([15711]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-7.5230e-01,  1.3016e-01, -3.0819e-02,  1.1761e+00,  4.5838e-02,
        -4.5548e-01, -1.2282e+00, -8.3242e-01,  4.6186e-01,  6.8586e-01,
        -4.5686e-01,  3.6876e-02, -7.0704e-01,  2.1870e-01, -1.1987e-01,
         3.9091e-01, -1.4981e-01,  2.1797e-01,  2.6314e-01, -1.2643e-01,
        -7.0538e-01, -1.3342e-01, -2.1326e-02, -5.6735e-02, -7.4411e-02,
        -7.3587e-01, -6.6603e-01, -8.7497e-02,  8.8518e-01,  1.1466e+00,
        -3.4410e-01,  1.0060e-01,  3.8847e-01,  3.2159e-01, -7.1518e-01,
         8.0116e-02,  5.6858e-01, -6.3466e-01, -2.3487e-01, -1.2279e+00,
        -2.6888e-01,  3.0810e-01,  1.1066e+00, -2.9368e-01, -1.6622e-01,
        -6.7966e-01, -2.7994e-01, -4.5495e-01, -3.5683e-01, -5.6834e-01,
         7.4103e-01, -2.9223e-01, -4.6974e-01, -3.8495e-01, -7.3774e-01,
        -8.5628e-03, -9.3887e-01, -1.9774e-01,  3.5194e-01, -1.5673e-01,
         4.6068e-02,  5.2244e-01,  6.6486e-01,  8.5647e-01, -2.2974e-02,
         1.1651e-01, -3.4466e-01, -5.7437e-01,  1.9596e+00, -6.1395e-01,
        -3.5287e-01, -1.7814e-01, -2.5421e-02, -6.8455e-01,  6.8765e-02,
         8.2196e-02,  3.1947e-01,  8.8142e-01,  1.5025e+00,  1.4808e-02,
         9.0757e-01,  2.7155e-01, -2.8203e-01, -1.2266e+00, -1.1994e-01,
        -4.0185e-01, -5.1041e-01, -3.5155e-01, -3.3836e-01, -1.8840e-01,
         5.0572e-01, -9.5103e-01,  2.5965e-01,  1.4433e-15,  1.4433e-15,
        -3.1069e-01,  2.4798e-01, -1.4549e+00,  1.0411e+00, -6.3947e-01,
        -4.9844e-01, -3.6311e-01,  1.0280e-02, -4.7432e-01,  1.8299e-01,
         3.3030e+00, -2.0420e-01,  1.0471e-01,  2.9919e-01, -5.0049e-01,
        -1.7612e-01,  3.5527e-15,  2.8477e-01, -1.3643e+00, -1.6462e-01,
        -3.3745e+00, -5.0529e-01, -2.4294e-01,  5.0014e-02, -5.6760e-01,
        -3.4870e-01, -6.2531e-01, -6.7829e-01,  2.5647e-01,  1.1355e-01,
        -3.3697e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2461]), tensor(0.2707))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:main_restricted.py:Testing data year: 2013
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 16225
            device: cpu
            
2024-07-30 05:14:25,447	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-30 05:14:25,510	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-30 05:14:25,561	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f56274661af3545d.zip' (1.46MiB) to Ray cluster...
2024-07-30 05:14:25,570	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f56274661af3545d.zip'.
2024-07-30 05:14:27,802	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-30 06:07:09,637	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_05-14-27' in 0.3078s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 125, 'num_layers': 1, 'num_embeddings': 16225, 'embedding_dim': 1, 'dropout_rate': 0.25, 'lr': 0.008862326508576258, 'weight_decay': 0.00020736445177905053, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10721591651623653
INFO:model_data_nn.py:Best trial testing loss: 0.056996742872712766
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-30_05-14-22_646965_592478/artifacts/2024-07-30_05-14-27/train_fnn_2024-07-30_05-14-27/driver_artifacts/train_fnn_446aa_00009_9_dropout_rate=0.2500,embedding_dim=1,hidden_dim=125,lr=0.0089,num_layers=1,weight_decay=0.0002_2024-07-30_05-14-28
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 125, 'num_layers': 1, 'num_embeddings': 16362, 'embedding_dim': 1, 'dropout_rate': 0.25, 'lr': 0.008862326508576258, 'weight_decay': 0.00020736445177905053, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10620094142629699, 'avg_test_loss': 0.0664974894348126}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10585663763319775, 'avg_test_loss': 0.05576899081857001}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10594820509057691, 'avg_test_loss': 0.057024523443696906}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10602012553988191, 'avg_test_loss': 0.058490218254803765}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10624198435543804, 'avg_test_loss': 0.057501303738256765}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10576841610808126, 'avg_test_loss': 0.057948221368671025}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10576021800121192, 'avg_test_loss': 0.05763510374078677}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10579627560780085, 'avg_test_loss': 0.05758770946766387}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10613609739063706, 'avg_test_loss': 0.05567339513344929}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.10608643396740912, 'avg_test_loss': 0.06089340700322135}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10630020953166032, 'avg_test_loss': 0.05746383648100905}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10616068513627397, 'avg_test_loss': 0.05532657014762197}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10609682960098975, 'avg_test_loss': 0.058207139677381343}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10586254328871811, 'avg_test_loss': 0.055812058930607485}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10561299320148204, 'avg_test_loss': 0.05613848966903879}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.10567594746950948, 'avg_test_loss': 0.05670908400656488}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.10561674726528249, 'avg_test_loss': 0.05635067199520166}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.10595753162093129, 'avg_test_loss': 0.05734616335728581}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.10605281093968577, 'avg_test_loss': 0.05636022157384462}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.10619023986406059, 'avg_test_loss': 0.055509545076726736}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.10647011261753506, 'avg_test_loss': 0.056140299762877245}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.10624862869403191, 'avg_test_loss': 0.05982269116752379}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.10603920349447955, 'avg_test_loss': 0.05783126598568324}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.1059904606663622, 'avg_test_loss': 0.05563536458935642}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.1061095757023265, 'avg_test_loss': 0.05491807840994043}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.10595456130062562, 'avg_test_loss': 0.05537056852732366}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.10571175085039743, 'avg_test_loss': 0.05694076374738137}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.10574809763015115, 'avg_test_loss': 0.05775232868648677}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.10574730174100426, 'avg_test_loss': 0.06682024901441488}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.10570098818383745, 'avg_test_loss': 0.0607660068243177}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.10588654713397513, 'avg_test_loss': 0.058568867572287533}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.1059373629516423, 'avg_test_loss': 0.05620360757572956}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.10586960210431633, 'avg_test_loss': 0.05808375642957139}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.10578967122751887, 'avg_test_loss': 0.056485985008496525}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.10591991644406724, 'avg_test_loss': 0.05644222293313928}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.10597083844414945, 'avg_test_loss': 0.05866567264377223}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.10632132727000031, 'avg_test_loss': 0.05660704134464688}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.10608876756346684, 'avg_test_loss': 0.056267288848934296}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.10611790961515258, 'avg_test_loss': 0.055978393230710834}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.10602251979934019, 'avg_test_loss': 0.05802284020012448}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.10588331412727711, 'avg_test_loss': 0.05689163633149947}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.10617989899411831, 'avg_test_loss': 0.058127101466624656}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.10566132848159343, 'avg_test_loss': 0.05695439691068296}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.10586298106812007, 'avg_test_loss': 0.05623578392322312}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.1059098908197484, 'avg_test_loss': 0.05547275829406994}
INFO:model_data_nn.py:Early stopping at epoch 45
INFO:main_restricted.py:Making prediction for data in year: 2014
INFO:main_restricted.py:Prediction data shape: (13465,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2014: 0.23523524876580537
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  13465.000000  13465.000000
mean       0.014125      0.027721
std        0.233495      0.027905
min       -0.876499     -0.107277
25%       -0.083091      0.013606
50%        0.002797      0.017757
75%        0.098080      0.039434
max        6.562500      0.412783
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:transform_data_nn.py:Train_data: (573470, 161)

INFO:transform_data_nn.py:Test data years: [2014]
INFO:transform_data_nn.py:Test_data: (13465, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:transform_data_nn.py:Retrain_data: (586935, 161)

INFO:transform_data_nn.py:Prediction data years: [2015]
INFO:transform_data_nn.py:Prediction_data: (13715, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([573470, 138])
            y_train_tf: torch.Size([573470])

            x_test_tf: torch.Size([13465, 138])
            y_test_tf: torch.Size([13465])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([586935, 138])
            y_retrain_tf: torch.Size([586935])

            x_prediction_tf: torch.Size([13715, 138])
            y_prediction_tf: torch.Size([13715])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.2712e-01,  9.2409e-01,  6.6992e-02, -1.6785e+00, -1.1233e-01,
        -8.2670e-01, -1.5045e-01, -3.4872e-01,  4.0952e-01, -1.7885e-01,
        -7.1955e-01,  8.7390e-02, -7.0704e-01, -5.4205e-01,  8.3250e-02,
         5.2239e-01, -1.2151e-01,  2.0256e-01, -8.3591e-02,  6.1778e-01,
        -4.1136e-01, -6.7821e-02, -1.8047e-01,  9.7519e-03, -9.5602e-02,
        -3.4241e-01, -5.9448e-01, -8.7497e-02,  3.0576e-01,  1.3617e+00,
         3.4786e-01, -1.2465e-01,  7.8587e-01,  3.2159e-01, -2.2264e-01,
        -2.3219e-01,  1.5006e-01,  8.0883e-01, -1.1515e-02, -1.1254e+00,
        -2.6839e-01,  2.9494e-01,  3.6886e-01,  2.4009e-02, -1.5918e-01,
        -7.2673e-01,  1.1317e-01, -5.1507e-02, -3.5028e-01, -1.4660e-01,
        -8.4682e-01,  3.1403e-01, -4.6974e-01,  9.0548e-02, -1.0862e-02,
         4.9251e-01, -5.5361e-01, -1.8394e-01, -2.5323e-01, -3.0984e-02,
        -3.3121e-04, -3.0907e-01,  7.5793e-02,  2.1515e-01,  8.9659e-02,
        -1.8882e-01,  7.6813e-01, -2.5451e-01,  6.1676e-01, -5.7672e-01,
        -3.5287e-01, -1.7814e-01, -2.5421e-02, -8.7254e-01,  1.8428e-01,
         7.7113e-01,  9.0929e-01, -1.1825e+00,  2.6667e-01,  1.4808e-02,
        -1.0121e+00,  1.9789e-01,  3.7412e-01,  2.4083e-03, -5.8094e-01,
        -4.7349e-01, -5.6256e-01, -2.7868e-01,  1.0453e-01,  1.1347e-01,
        -6.1938e-01, -1.3370e+00,  2.5965e-01,  1.4433e-15,  1.4433e-15,
         3.2826e+00,  1.6600e-01,  2.4501e+00, -2.9904e+00,  6.1111e-01,
        -5.8062e-01,  2.0672e-01,  1.0280e-02, -5.3443e-02,  1.8299e-01,
         6.5259e-02, -1.5122e-01,  2.8433e-01,  4.2051e-01, -8.7025e-01,
         8.4897e-01,  3.5527e-15,  3.2663e-01,  2.2914e-02,  7.2964e-02,
         1.3990e-02,  3.7160e-01, -2.2736e-01,  5.0014e-02, -5.6005e-01,
         1.4389e-01, -2.3080e-01, -3.5506e-01,  3.6060e-01,  3.6296e-01,
        -4.1606e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([15711]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-7.5230e-01,  1.3016e-01, -3.0819e-02,  1.1761e+00,  4.5838e-02,
        -4.5548e-01, -1.2282e+00, -8.3242e-01,  4.6186e-01,  6.8586e-01,
        -4.5686e-01,  3.6876e-02, -7.0704e-01,  2.1870e-01, -1.1987e-01,
         3.9091e-01, -1.4981e-01,  2.1797e-01,  2.6314e-01, -1.2643e-01,
        -7.0538e-01, -1.3342e-01, -2.1326e-02, -5.6735e-02, -7.4411e-02,
        -7.3587e-01, -6.6603e-01, -8.7497e-02,  8.8518e-01,  1.1466e+00,
        -3.4410e-01,  1.0060e-01,  3.8847e-01,  3.2159e-01, -7.1518e-01,
         8.0116e-02,  5.6858e-01, -6.3466e-01, -2.3487e-01, -1.2279e+00,
        -2.6888e-01,  3.0810e-01,  1.1066e+00, -2.9368e-01, -1.6622e-01,
        -6.7966e-01, -2.7994e-01, -4.5495e-01, -3.5683e-01, -5.6834e-01,
         7.4103e-01, -2.9223e-01, -4.6974e-01, -3.8495e-01, -7.3774e-01,
        -8.5628e-03, -9.3887e-01, -1.9774e-01,  3.5194e-01, -1.5673e-01,
         4.6068e-02,  5.2244e-01,  6.6486e-01,  8.5647e-01, -2.2974e-02,
         1.1651e-01, -3.4466e-01, -5.7437e-01,  1.9596e+00, -6.1395e-01,
        -3.5287e-01, -1.7814e-01, -2.5421e-02, -6.8455e-01,  6.8765e-02,
         8.2196e-02,  3.1947e-01,  8.8142e-01,  1.5025e+00,  1.4808e-02,
         9.0757e-01,  2.7155e-01, -2.8203e-01, -1.2266e+00, -1.1994e-01,
        -4.0185e-01, -5.1041e-01, -3.5155e-01, -3.3836e-01, -1.8840e-01,
         5.0572e-01, -9.5103e-01,  2.5965e-01,  1.4433e-15,  1.4433e-15,
        -3.1069e-01,  2.4798e-01, -1.4549e+00,  1.0411e+00, -6.3947e-01,
        -4.9844e-01, -3.6311e-01,  1.0280e-02, -4.7432e-01,  1.8299e-01,
         3.3030e+00, -2.0420e-01,  1.0471e-01,  2.9919e-01, -5.0049e-01,
        -1.7612e-01,  3.5527e-15,  2.8477e-01, -1.3643e+00, -1.6462e-01,
        -3.3745e+00, -5.0529e-01, -2.4294e-01,  5.0014e-02, -5.6760e-01,
        -3.4870e-01, -6.2531e-01, -6.7829e-01,  2.5647e-01,  1.1355e-01,
        -3.3697e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2461]), tensor(0.2707))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.2297e-01,  9.3129e-01,  6.5636e-02, -1.6897e+00, -1.1095e-01,
        -8.2298e-01, -1.5324e-01, -3.5066e-01,  4.1632e-01, -1.7877e-01,
        -7.2170e-01,  8.9094e-02, -7.1006e-01, -5.4722e-01,  8.5773e-02,
         5.2549e-01, -1.2008e-01,  2.0266e-01, -8.4213e-02,  6.2454e-01,
        -4.0895e-01, -6.6791e-02, -1.8372e-01,  1.0453e-02, -9.5881e-02,
        -3.4276e-01, -5.9379e-01, -9.0171e-02,  2.8383e-01,  1.3663e+00,
         3.4980e-01, -1.2416e-01,  7.8868e-01,  3.2531e-01, -2.2196e-01,
        -2.3097e-01,  1.5455e-01,  8.0949e-01, -9.3699e-03, -1.1168e+00,
        -2.6601e-01,  2.8564e-01,  3.7528e-01,  2.5188e-02, -1.5746e-01,
        -7.2033e-01,  1.0760e-01, -5.1448e-02, -3.5141e-01, -1.4899e-01,
        -8.4783e-01,  2.9581e-01, -4.6980e-01,  9.2151e-02, -8.2883e-03,
         4.9036e-01, -5.4727e-01, -1.8323e-01, -2.5408e-01, -2.8635e-02,
        -1.4982e-03, -3.0983e-01,  7.3052e-02,  2.1674e-01,  9.1409e-02,
        -1.9114e-01,  7.7571e-01, -2.5242e-01,  6.1363e-01, -5.7728e-01,
        -3.5407e-01, -1.7923e-01, -2.5364e-02, -8.6483e-01,  1.8619e-01,
         7.7950e-01,  9.1719e-01, -1.1852e+00,  2.6439e-01,  1.5025e-02,
        -1.0150e+00,  2.0181e-01,  3.8299e-01,  1.7625e-02, -5.8125e-01,
        -4.7682e-01, -5.6400e-01, -2.7840e-01,  1.0834e-01,  1.1444e-01,
        -6.2445e-01, -1.3359e+00,  2.6316e-01,  1.3323e-15,  1.3323e-15,
         3.3235e+00,  1.6146e-01,  2.4532e+00, -3.0225e+00,  6.3244e-01,
        -5.7335e-01,  2.1253e-01,  1.2189e-02, -5.2237e-02,  1.7609e-01,
         6.5543e-02, -1.5258e-01,  2.8951e-01,  4.8873e-01, -8.6323e-01,
         8.6470e-01,  1.4211e-14,  3.2292e-01,  1.4093e-02,  6.5325e-02,
         1.6333e-02,  3.8096e-01, -2.2697e-01,  6.3748e-02, -5.5838e-01,
         1.4427e-01, -2.2475e-01, -3.5316e-01,  3.6115e-01,  3.6161e-01,
        -4.1541e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([15884]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.5774e-01, -1.8605e-01, -5.3812e-01,  1.1617e+00, -2.3422e-01,
        -5.4884e-01, -9.8823e-01, -7.7397e-01,  8.0277e-02,  3.3126e-01,
        -7.4848e-01,  1.0178e-02, -7.1006e-01,  3.6292e-01,  5.4398e-02,
         3.3245e-01, -2.0969e-01,  7.2537e-01, -1.1900e-02, -4.5638e-03,
        -5.9686e-01, -1.2395e+00, -3.6291e-01, -1.8387e-01, -3.4472e-01,
        -8.0183e-01, -6.6412e-01, -9.0171e-02,  1.9067e-01,  8.7317e-01,
        -1.8547e-01, -2.3838e-01,  2.8462e-01,  3.2531e-01, -7.7393e-01,
        -3.7375e-01,  1.5995e-01, -6.3930e-01,  2.8817e-01, -9.8606e-01,
        -2.6549e-01,  1.5027e-02, -2.3144e-01, -3.6104e-01, -1.7781e-01,
        -8.0229e-01,  6.5681e-01, -3.1208e-01, -5.7922e-01,  1.6285e-01,
         1.5337e+00, -1.5721e-01, -4.6980e-01, -3.9189e-01, -8.2883e-03,
        -6.7610e-02, -9.3437e-01,  5.0216e-02, -4.7276e-01,  1.0803e-01,
        -7.0768e-01, -5.1945e-01,  2.9076e-01,  7.5764e-01, -2.3098e-02,
        -9.2962e-02, -4.8128e-01,  1.3564e-01,  6.1363e-01, -6.8169e-01,
        -3.5407e-01, -1.7923e-01, -2.5364e-02, -8.7973e-01,  2.8922e-03,
        -1.0470e-01,  9.1719e-01,  8.8083e-01,  1.5062e+00,  1.5025e-02,
         8.6924e-01,  2.7747e-01, -3.3537e-01, -1.0518e+00, -4.4547e-01,
        -3.8114e-01, -5.0047e-01, -3.3548e-01, -6.4803e-01, -3.9025e-01,
        -3.3281e-01, -2.5707e-01,  2.6316e-01,  1.3323e-15,  1.3323e-15,
        -2.1744e-01, -8.7120e-02, -1.4168e+00,  1.0835e-01, -1.9652e-01,
        -1.1579e-01, -3.6732e-03,  1.2189e-02, -2.0997e-01,  1.7609e-01,
         2.6332e+00, -2.0607e-01,  5.3732e-01,  2.4851e-01, -3.6536e-01,
        -4.3748e-01,  1.4211e-14,  1.2293e-01, -6.7237e-01, -5.1786e-01,
        -6.8808e-01, -4.5964e-01, -2.4675e-01,  6.3748e-02, -3.8448e-01,
         2.9366e-01, -4.9552e-01, -7.1746e-01,  2.3160e-01,  9.2251e-02,
        -3.8407e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2547]), tensor(-0.0839))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:main_restricted.py:Testing data year: 2014
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 16362
            device: cpu
            
2024-07-30 07:46:10,698	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-30 07:46:10,760	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-30 07:46:10,812	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f56274661af3545d.zip' (1.46MiB) to Ray cluster...
2024-07-30 07:46:10,818	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f56274661af3545d.zip'.
2024-07-30 07:46:12,897	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-30 09:05:23,639	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_07-46-12' in 0.2889s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 16362, 'embedding_dim': 1, 'dropout_rate': 0.19, 'lr': 0.0005282284718122494, 'weight_decay': 3.915648958243003e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.093604331912398
INFO:model_data_nn.py:Best trial testing loss: 0.05414555490158181
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-30_07-46-07_921469_592478/artifacts/2024-07-30_07-46-12/train_fnn_2024-07-30_07-46-12/driver_artifacts/train_fnn_7779e_00022_22_dropout_rate=0.1900,embedding_dim=1,hidden_dim=45,lr=0.0005,num_layers=1,weight_decay=0.0000_2024-07-30_07-46-13
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 16543, 'embedding_dim': 1, 'dropout_rate': 0.19, 'lr': 0.0005282284718122494, 'weight_decay': 3.915648958243003e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10206730152066948, 'avg_test_loss': 0.0925984927821298}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.09869999511201938, 'avg_test_loss': 0.09442100100392518}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.09726574235680059, 'avg_test_loss': 0.10291975947140261}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.09657206492886483, 'avg_test_loss': 0.09404592175729747}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.09598002551040219, 'avg_test_loss': 0.09534363287046205}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.09554357232024228, 'avg_test_loss': 0.0890041587960928}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.09520334182987589, 'avg_test_loss': 0.09058023931588545}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.0949147859456235, 'avg_test_loss': 0.09086154688929403}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.09457180074608053, 'avg_test_loss': 0.09002279654838317}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.09436719361530169, 'avg_test_loss': 0.09397145038427308}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.09414702996250035, 'avg_test_loss': 0.08881650241741608}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.09405114735652374, 'avg_test_loss': 0.09106258487892012}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.09379261433265722, 'avg_test_loss': 0.09053339127364547}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.09363307090132876, 'avg_test_loss': 0.0907923475557635}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.09363053372046518, 'avg_test_loss': 0.09304462760513606}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.09354761515560203, 'avg_test_loss': 0.08732405372050613}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.0933200234937255, 'avg_test_loss': 0.0876090100771466}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.0931658843595173, 'avg_test_loss': 0.09987131134541923}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.09324616437987095, 'avg_test_loss': 0.09266721349382816}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.09294423360434424, 'avg_test_loss': 0.09170354384669038}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.09291953154501374, 'avg_test_loss': 0.09255082779239084}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.0928860902753755, 'avg_test_loss': 0.0884579433821315}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.09313469296189242, 'avg_test_loss': 0.09082464236159657}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.0930539146065712, 'avg_test_loss': 0.09210782370335141}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.09308010638389846, 'avg_test_loss': 0.09009704683409181}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.09294370141229719, 'avg_test_loss': 0.09125882171007783}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.09303057956810931, 'avg_test_loss': 0.08940463124579469}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.09286518618444158, 'avg_test_loss': 0.08988524271651756}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.09284987525147109, 'avg_test_loss': 0.08891582161534664}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.0928711027845399, 'avg_test_loss': 0.09782065352814835}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.09304993543550454, 'avg_test_loss': 0.08859461816244348}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.09267467789965374, 'avg_test_loss': 0.08841332649422247}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.09266036565059078, 'avg_test_loss': 0.09178711856433819}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.09264292750515718, 'avg_test_loss': 0.090717024174194}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.09281274252870773, 'avg_test_loss': 0.09028395237617715}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.09280674971107926, 'avg_test_loss': 0.09313134138667306}
INFO:model_data_nn.py:Early stopping at epoch 36
INFO:main_restricted.py:Making prediction for data in year: 2015
INFO:main_restricted.py:Prediction data shape: (13715,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2015: 0.3048794801852985
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  13715.000000  13715.000000
mean      -0.012963      0.074070
std        0.281375      0.085500
min       -0.894256     -0.229415
25%       -0.117383      0.031237
50%       -0.004975      0.055023
75%        0.079168      0.097066
max       16.161400      1.384289
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:transform_data_nn.py:Train_data: (586935, 161)

INFO:transform_data_nn.py:Test data years: [2015]
INFO:transform_data_nn.py:Test_data: (13715, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:transform_data_nn.py:Retrain_data: (600650, 161)

INFO:transform_data_nn.py:Prediction data years: [2016]
INFO:transform_data_nn.py:Prediction_data: (13785, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([586935, 138])
            y_train_tf: torch.Size([586935])

            x_test_tf: torch.Size([13715, 138])
            y_test_tf: torch.Size([13715])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([600650, 138])
            y_retrain_tf: torch.Size([600650])

            x_prediction_tf: torch.Size([13785, 138])
            y_prediction_tf: torch.Size([13785])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.2297e-01,  9.3129e-01,  6.5636e-02, -1.6897e+00, -1.1095e-01,
        -8.2298e-01, -1.5324e-01, -3.5066e-01,  4.1632e-01, -1.7877e-01,
        -7.2170e-01,  8.9094e-02, -7.1006e-01, -5.4722e-01,  8.5773e-02,
         5.2549e-01, -1.2008e-01,  2.0266e-01, -8.4213e-02,  6.2454e-01,
        -4.0895e-01, -6.6791e-02, -1.8372e-01,  1.0453e-02, -9.5881e-02,
        -3.4276e-01, -5.9379e-01, -9.0171e-02,  2.8383e-01,  1.3663e+00,
         3.4980e-01, -1.2416e-01,  7.8868e-01,  3.2531e-01, -2.2196e-01,
        -2.3097e-01,  1.5455e-01,  8.0949e-01, -9.3699e-03, -1.1168e+00,
        -2.6601e-01,  2.8564e-01,  3.7528e-01,  2.5188e-02, -1.5746e-01,
        -7.2033e-01,  1.0760e-01, -5.1448e-02, -3.5141e-01, -1.4899e-01,
        -8.4783e-01,  2.9581e-01, -4.6980e-01,  9.2151e-02, -8.2883e-03,
         4.9036e-01, -5.4727e-01, -1.8323e-01, -2.5408e-01, -2.8635e-02,
        -1.4982e-03, -3.0983e-01,  7.3052e-02,  2.1674e-01,  9.1409e-02,
        -1.9114e-01,  7.7571e-01, -2.5242e-01,  6.1363e-01, -5.7728e-01,
        -3.5407e-01, -1.7923e-01, -2.5364e-02, -8.6483e-01,  1.8619e-01,
         7.7950e-01,  9.1719e-01, -1.1852e+00,  2.6439e-01,  1.5025e-02,
        -1.0150e+00,  2.0181e-01,  3.8299e-01,  1.7625e-02, -5.8125e-01,
        -4.7682e-01, -5.6400e-01, -2.7840e-01,  1.0834e-01,  1.1444e-01,
        -6.2445e-01, -1.3359e+00,  2.6316e-01,  1.3323e-15,  1.3323e-15,
         3.3235e+00,  1.6146e-01,  2.4532e+00, -3.0225e+00,  6.3244e-01,
        -5.7335e-01,  2.1253e-01,  1.2189e-02, -5.2237e-02,  1.7609e-01,
         6.5543e-02, -1.5258e-01,  2.8951e-01,  4.8873e-01, -8.6323e-01,
         8.6470e-01,  1.4211e-14,  3.2292e-01,  1.4093e-02,  6.5325e-02,
         1.6333e-02,  3.8096e-01, -2.2697e-01,  6.3748e-02, -5.5838e-01,
         1.4427e-01, -2.2475e-01, -3.5316e-01,  3.6115e-01,  3.6161e-01,
        -4.1541e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([15884]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-3.5774e-01, -1.8605e-01, -5.3812e-01,  1.1617e+00, -2.3422e-01,
        -5.4884e-01, -9.8823e-01, -7.7397e-01,  8.0277e-02,  3.3126e-01,
        -7.4848e-01,  1.0178e-02, -7.1006e-01,  3.6292e-01,  5.4398e-02,
         3.3245e-01, -2.0969e-01,  7.2537e-01, -1.1900e-02, -4.5638e-03,
        -5.9686e-01, -1.2395e+00, -3.6291e-01, -1.8387e-01, -3.4472e-01,
        -8.0183e-01, -6.6412e-01, -9.0171e-02,  1.9067e-01,  8.7317e-01,
        -1.8547e-01, -2.3838e-01,  2.8462e-01,  3.2531e-01, -7.7393e-01,
        -3.7375e-01,  1.5995e-01, -6.3930e-01,  2.8817e-01, -9.8606e-01,
        -2.6549e-01,  1.5027e-02, -2.3144e-01, -3.6104e-01, -1.7781e-01,
        -8.0229e-01,  6.5681e-01, -3.1208e-01, -5.7922e-01,  1.6285e-01,
         1.5337e+00, -1.5721e-01, -4.6980e-01, -3.9189e-01, -8.2883e-03,
        -6.7610e-02, -9.3437e-01,  5.0216e-02, -4.7276e-01,  1.0803e-01,
        -7.0768e-01, -5.1945e-01,  2.9076e-01,  7.5764e-01, -2.3098e-02,
        -9.2962e-02, -4.8128e-01,  1.3564e-01,  6.1363e-01, -6.8169e-01,
        -3.5407e-01, -1.7923e-01, -2.5364e-02, -8.7973e-01,  2.8922e-03,
        -1.0470e-01,  9.1719e-01,  8.8083e-01,  1.5062e+00,  1.5025e-02,
         8.6924e-01,  2.7747e-01, -3.3537e-01, -1.0518e+00, -4.4547e-01,
        -3.8114e-01, -5.0047e-01, -3.3548e-01, -6.4803e-01, -3.9025e-01,
        -3.3281e-01, -2.5707e-01,  2.6316e-01,  1.3323e-15,  1.3323e-15,
        -2.1744e-01, -8.7120e-02, -1.4168e+00,  1.0835e-01, -1.9652e-01,
        -1.1579e-01, -3.6732e-03,  1.2189e-02, -2.0997e-01,  1.7609e-01,
         2.6332e+00, -2.0607e-01,  5.3732e-01,  2.4851e-01, -3.6536e-01,
        -4.3748e-01,  1.4211e-14,  1.2293e-01, -6.7237e-01, -5.1786e-01,
        -6.8808e-01, -4.5964e-01, -2.4675e-01,  6.3748e-02, -3.8448e-01,
         2.9366e-01, -4.9552e-01, -7.1746e-01,  2.3160e-01,  9.2251e-02,
        -3.8407e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2547]), tensor(-0.0839))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.1961e-01,  9.3757e-01,  6.4268e-02, -1.6984e+00, -1.1011e-01,
        -8.2162e-01, -1.5708e-01, -3.5330e-01,  4.2020e-01, -1.7875e-01,
        -7.2314e-01,  9.2995e-02, -7.1218e-01, -5.4972e-01,  8.8526e-02,
         5.2769e-01, -1.1863e-01,  2.0216e-01, -8.3589e-02,  6.3049e-01,
        -4.0953e-01, -6.9182e-02, -1.8601e-01,  1.1531e-02, -9.7244e-02,
        -3.4346e-01, -5.9328e-01, -9.1453e-02,  2.6184e-01,  1.3700e+00,
         3.5016e-01, -1.2255e-01,  7.9076e-01,  3.2898e-01, -2.2041e-01,
        -2.2986e-01,  1.5796e-01,  8.1345e-01, -8.7550e-03, -1.1073e+00,
        -2.6396e-01,  2.9707e-01,  3.8114e-01,  2.5518e-02, -1.5728e-01,
        -7.1601e-01,  1.1233e-01, -4.8778e-02, -3.5785e-01, -1.4643e-01,
        -8.4844e-01,  2.7867e-01, -4.6977e-01,  9.4329e-02, -5.4672e-03,
         4.8797e-01, -5.4097e-01, -1.8265e-01, -2.5418e-01, -2.7392e-02,
        -1.5689e-03, -3.0952e-01,  7.3888e-02,  2.1626e-01,  9.2406e-02,
        -1.9076e-01,  7.8221e-01, -2.5050e-01,  6.1171e-01, -5.7770e-01,
        -3.5567e-01, -1.8053e-01, -2.5192e-02, -8.6089e-01,  1.8947e-01,
         7.8667e-01,  9.2490e-01, -1.1883e+00,  2.6091e-01,  1.4650e-02,
        -1.0191e+00,  2.0380e-01,  3.9056e-01,  3.2376e-02, -5.8238e-01,
        -4.8121e-01, -5.6566e-01, -2.7834e-01,  1.1208e-01,  1.1501e-01,
        -6.3038e-01, -1.3341e+00,  2.6679e-01,  6.6613e-16,  6.6613e-16,
         3.3653e+00,  1.7775e-01,  2.4586e+00, -3.0597e+00,  6.4007e-01,
        -5.7805e-01,  2.1770e-01,  1.2067e-02, -4.9524e-02,  1.7055e-01,
         5.0943e-02, -1.5363e-01,  2.9591e-01,  5.5555e-01, -8.6319e-01,
         8.8036e-01,  1.2434e-14,  3.2014e-01,  2.2101e-02,  5.9652e-02,
         1.6591e-02,  3.9024e-01, -2.2754e-01,  7.5351e-02, -5.5685e-01,
         1.4538e-01, -2.1852e-01, -3.5035e-01,  3.6248e-01,  3.6039e-01,
        -4.1401e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([16165]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.6229e-01, -1.7521e-01, -6.7623e-01,  1.1491e+00, -4.0509e-01,
        -1.6985e-01, -1.0147e+00, -7.8352e-01,  6.3024e-01,  7.4602e-01,
        -6.7768e-01, -7.2364e-02, -7.1218e-01,  4.6291e-01,  8.2450e-02,
        -1.9446e-01, -2.0499e-01, -5.2014e-01, -1.2723e-02, -4.0135e-01,
        -4.1952e-01, -1.3350e-01, -1.5706e-01, -2.1393e-01, -2.2169e-01,
        -8.1077e-01, -6.7251e-01, -9.1453e-02, -3.1085e-01,  1.5761e+00,
        -3.3640e-01, -2.1134e-01,  1.8925e-01,  3.2898e-01, -8.0515e-01,
        -3.1908e-01, -1.3330e-01, -6.4137e-01, -9.1804e-01, -9.9317e-01,
        -2.5921e-01, -6.0989e-01, -1.6154e-01, -2.4723e-01, -4.0859e-01,
         1.0192e+00, -5.3104e-01, -9.6284e-01,  6.7116e-03, -5.1277e-01,
         7.3950e-01, -3.5428e-01, -4.6977e-01, -3.9857e-01, -7.3815e-01,
        -1.3129e-01, -9.2996e-01, -2.0246e-01, -2.0748e-01, -3.1216e-01,
        -3.9450e-02, -2.0333e-01,  3.7004e-01,  4.8472e-01, -2.2548e-02,
         3.4874e-02, -4.7907e-01,  2.5206e-01,  6.1171e-01, -6.8773e-01,
        -3.5567e-01, -1.8053e-01, -2.5192e-02,  3.8409e-01, -6.9357e-02,
        -1.4204e-01,  9.2490e-01,  8.7999e-01,  1.5093e+00,  1.4650e-02,
         8.5072e-01, -5.7528e-01, -1.9657e-01, -5.4947e-01, -2.9009e-01,
        -3.7120e-01, -5.0007e-01, -4.2207e-01, -4.5988e-01, -2.7839e-01,
        -2.6369e-01, -4.1986e-01,  2.6679e-01,  6.6613e-16,  6.6613e-16,
        -2.6331e-01, -1.4962e+00, -1.3056e+00,  1.2026e-01,  1.0249e+00,
         1.4083e-01, -9.4690e-01,  1.2067e-02, -1.6059e-02,  1.7055e-01,
         2.1787e+00,  1.9562e-02, -3.6232e+00,  5.0111e-01, -6.7713e-01,
        -1.9019e-01,  1.2434e-14,  8.9498e-02, -1.5108e+00, -3.0415e-01,
        -6.8249e-01, -5.2500e-01, -3.5868e-01,  7.5351e-02, -2.7896e-01,
        -9.3988e-02, -5.5951e-01, -8.2045e-01,  1.4583e-01, -1.0355e-02,
        -4.0202e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00]), tensor([2536]), tensor(0.0483))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:main_restricted.py:Testing data year: 2015
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 16543
            device: cpu
            
2024-07-30 10:40:56,013	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-30 10:40:56,091	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-30 10:40:56,143	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_baaff3fe94ea78c1.zip' (1.47MiB) to Ray cluster...
2024-07-30 10:40:56,152	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_baaff3fe94ea78c1.zip'.
2024-07-30 10:40:58,223	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-30 12:11:35,935	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_10-40-58' in 0.3393s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 3, 'num_embeddings': 16543, 'embedding_dim': 6, 'dropout_rate': 0.53, 'lr': 0.007579479953348002, 'weight_decay': 0.0003142880890840113, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10650003959598464
INFO:model_data_nn.py:Best trial testing loss: 0.08002643208127729
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-30_10-40-53_190717_592478/artifacts/2024-07-30_10-40-58/train_fnn_2024-07-30_10-40-58/driver_artifacts/train_fnn_e137b_00001_1_dropout_rate=0.5300,embedding_dim=6,hidden_dim=35,lr=0.0076,num_layers=3,weight_decay=0.0003_2024-07-30_10-40-58
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 3, 'num_embeddings': 16832, 'embedding_dim': 6, 'dropout_rate': 0.53, 'lr': 0.007579479953348002, 'weight_decay': 0.0003142880890840113, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10603040326456155, 'avg_test_loss': 0.09455482274966522}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10594378984853284, 'avg_test_loss': 0.09468414882387689}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10595200790283874, 'avg_test_loss': 0.09496369946282357}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10592784549213338, 'avg_test_loss': 0.09457238790303192}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10593926497855653, 'avg_test_loss': 0.09467089488774676}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10592929090476919, 'avg_test_loss': 0.09515166833255163}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10593249226762026, 'avg_test_loss': 0.09486181256620006}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10595289771154832, 'avg_test_loss': 0.0950503565189946}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10593948061967474, 'avg_test_loss': 0.09462007981104155}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.10592395063265404, 'avg_test_loss': 0.09461330283536679}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10593279266931399, 'avg_test_loss': 0.09461275963716347}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10591926942194911, 'avg_test_loss': 0.09478605357084975}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10591632371066763, 'avg_test_loss': 0.09497051626116175}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10592662773462738, 'avg_test_loss': 0.09465315656443299}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10595607862718003, 'avg_test_loss': 0.09476213422776372}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.10593022221503863, 'avg_test_loss': 0.09477984078262967}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.10592342603239184, 'avg_test_loss': 0.09455915504238671}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.10592816464571192, 'avg_test_loss': 0.095223005283279}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.10594150096825068, 'avg_test_loss': 0.09455330321496283}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.10592633554782395, 'avg_test_loss': 0.09455198938613413}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.1059175349976401, 'avg_test_loss': 0.09456768379701923}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.10592772343578527, 'avg_test_loss': 0.09493839717038942}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.10592493467453666, 'avg_test_loss': 0.09485283598338289}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.10592034544873155, 'avg_test_loss': 0.09498869272000673}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.10593484398503537, 'avg_test_loss': 0.0945625478979545}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.10592114139937726, 'avg_test_loss': 0.09494738475661035}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.10594094180654323, 'avg_test_loss': 0.09460820700473117}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.10592911108399428, 'avg_test_loss': 0.09459822252823936}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.10593402996286154, 'avg_test_loss': 0.0945617531477991}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.10593159090793063, 'avg_test_loss': 0.09463609976659494}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.10592471075362835, 'avg_test_loss': 0.09502717809044514}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.10593206156571146, 'avg_test_loss': 0.09457078638607291}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.10593011885917149, 'avg_test_loss': 0.09459713085002645}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.10592312921229581, 'avg_test_loss': 0.094555948744528}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.1059120269532955, 'avg_test_loss': 0.09455289950818513}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.10592876251193521, 'avg_test_loss': 0.09458040635756872}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.10592824732373703, 'avg_test_loss': 0.09457188434208985}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.1059364704338791, 'avg_test_loss': 0.09458833581043614}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.10593128367170858, 'avg_test_loss': 0.09476911118340299}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.10593619041291716, 'avg_test_loss': 0.09466291671291131}
INFO:model_data_nn.py:Early stopping at epoch 40
INFO:main_restricted.py:Making prediction for data in year: 2016
INFO:main_restricted.py:Prediction data shape: (13785,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2016: 0.3079239289597594
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  13785.000000  13785.000000
mean       0.043107      0.032464
std        0.307751      0.000000
min       -0.983828      0.032464
25%       -0.074501      0.032464
50%        0.023648      0.032464
75%        0.142416      0.032464
max       16.130048      0.032464
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:transform_data_nn.py:Train_data: (600650, 161)

INFO:transform_data_nn.py:Test data years: [2016]
INFO:transform_data_nn.py:Test_data: (13785, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]
INFO:transform_data_nn.py:Retrain_data: (614435, 161)

INFO:transform_data_nn.py:Prediction data years: [2017]
INFO:transform_data_nn.py:Prediction_data: (13498, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([600650, 138])
            y_train_tf: torch.Size([600650])

            x_test_tf: torch.Size([13785, 138])
            y_test_tf: torch.Size([13785])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([614435, 138])
            y_retrain_tf: torch.Size([614435])

            x_prediction_tf: torch.Size([13498, 138])
            y_prediction_tf: torch.Size([13498])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.1961e-01,  9.3757e-01,  6.4268e-02, -1.6984e+00, -1.1011e-01,
        -8.2162e-01, -1.5708e-01, -3.5330e-01,  4.2020e-01, -1.7875e-01,
        -7.2314e-01,  9.2995e-02, -7.1218e-01, -5.4972e-01,  8.8526e-02,
         5.2769e-01, -1.1863e-01,  2.0216e-01, -8.3589e-02,  6.3049e-01,
        -4.0953e-01, -6.9182e-02, -1.8601e-01,  1.1531e-02, -9.7244e-02,
        -3.4346e-01, -5.9328e-01, -9.1453e-02,  2.6184e-01,  1.3700e+00,
         3.5016e-01, -1.2255e-01,  7.9076e-01,  3.2898e-01, -2.2041e-01,
        -2.2986e-01,  1.5796e-01,  8.1345e-01, -8.7550e-03, -1.1073e+00,
        -2.6396e-01,  2.9707e-01,  3.8114e-01,  2.5518e-02, -1.5728e-01,
        -7.1601e-01,  1.1233e-01, -4.8778e-02, -3.5785e-01, -1.4643e-01,
        -8.4844e-01,  2.7867e-01, -4.6977e-01,  9.4329e-02, -5.4672e-03,
         4.8797e-01, -5.4097e-01, -1.8265e-01, -2.5418e-01, -2.7392e-02,
        -1.5689e-03, -3.0952e-01,  7.3888e-02,  2.1626e-01,  9.2406e-02,
        -1.9076e-01,  7.8221e-01, -2.5050e-01,  6.1171e-01, -5.7770e-01,
        -3.5567e-01, -1.8053e-01, -2.5192e-02, -8.6089e-01,  1.8947e-01,
         7.8667e-01,  9.2490e-01, -1.1883e+00,  2.6091e-01,  1.4650e-02,
        -1.0191e+00,  2.0380e-01,  3.9056e-01,  3.2376e-02, -5.8238e-01,
        -4.8121e-01, -5.6566e-01, -2.7834e-01,  1.1208e-01,  1.1501e-01,
        -6.3038e-01, -1.3341e+00,  2.6679e-01,  6.6613e-16,  6.6613e-16,
         3.3653e+00,  1.7775e-01,  2.4586e+00, -3.0597e+00,  6.4007e-01,
        -5.7805e-01,  2.1770e-01,  1.2067e-02, -4.9524e-02,  1.7055e-01,
         5.0943e-02, -1.5363e-01,  2.9591e-01,  5.5555e-01, -8.6319e-01,
         8.8036e-01,  1.2434e-14,  3.2014e-01,  2.2101e-02,  5.9652e-02,
         1.6591e-02,  3.9024e-01, -2.2754e-01,  7.5351e-02, -5.5685e-01,
         1.4538e-01, -2.1852e-01, -3.5035e-01,  3.6248e-01,  3.6039e-01,
        -4.1401e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([16165]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-3.6229e-01, -1.7521e-01, -6.7623e-01,  1.1491e+00, -4.0509e-01,
        -1.6985e-01, -1.0147e+00, -7.8352e-01,  6.3024e-01,  7.4602e-01,
        -6.7768e-01, -7.2364e-02, -7.1218e-01,  4.6291e-01,  8.2450e-02,
        -1.9446e-01, -2.0499e-01, -5.2014e-01, -1.2723e-02, -4.0135e-01,
        -4.1952e-01, -1.3350e-01, -1.5706e-01, -2.1393e-01, -2.2169e-01,
        -8.1077e-01, -6.7251e-01, -9.1453e-02, -3.1085e-01,  1.5761e+00,
        -3.3640e-01, -2.1134e-01,  1.8925e-01,  3.2898e-01, -8.0515e-01,
        -3.1908e-01, -1.3330e-01, -6.4137e-01, -9.1804e-01, -9.9317e-01,
        -2.5921e-01, -6.0989e-01, -1.6154e-01, -2.4723e-01, -4.0859e-01,
         1.0192e+00, -5.3104e-01, -9.6284e-01,  6.7116e-03, -5.1277e-01,
         7.3950e-01, -3.5428e-01, -4.6977e-01, -3.9857e-01, -7.3815e-01,
        -1.3129e-01, -9.2996e-01, -2.0246e-01, -2.0748e-01, -3.1216e-01,
        -3.9450e-02, -2.0333e-01,  3.7004e-01,  4.8472e-01, -2.2548e-02,
         3.4874e-02, -4.7907e-01,  2.5206e-01,  6.1171e-01, -6.8773e-01,
        -3.5567e-01, -1.8053e-01, -2.5192e-02,  3.8409e-01, -6.9357e-02,
        -1.4204e-01,  9.2490e-01,  8.7999e-01,  1.5093e+00,  1.4650e-02,
         8.5072e-01, -5.7528e-01, -1.9657e-01, -5.4947e-01, -2.9009e-01,
        -3.7120e-01, -5.0007e-01, -4.2207e-01, -4.5988e-01, -2.7839e-01,
        -2.6369e-01, -4.1986e-01,  2.6679e-01,  6.6613e-16,  6.6613e-16,
        -2.6331e-01, -1.4962e+00, -1.3056e+00,  1.2026e-01,  1.0249e+00,
         1.4083e-01, -9.4690e-01,  1.2067e-02, -1.6059e-02,  1.7055e-01,
         2.1787e+00,  1.9562e-02, -3.6232e+00,  5.0111e-01, -6.7713e-01,
        -1.9019e-01,  1.2434e-14,  8.9498e-02, -1.5108e+00, -3.0415e-01,
        -6.8249e-01, -5.2500e-01, -3.5868e-01,  7.5351e-02, -2.7896e-01,
        -9.3988e-02, -5.5951e-01, -8.2045e-01,  1.4583e-01, -1.0355e-02,
        -4.0202e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00]), tensor([2536]), tensor(0.0483))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.1879e-01,  9.4321e-01,  6.3329e-02, -1.7061e+00, -1.0695e-01,
        -8.2167e-01, -1.5971e-01, -3.5496e-01,  4.2319e-01, -1.7800e-01,
        -7.2408e-01,  9.9669e-02, -7.1336e-01, -5.4968e-01,  8.8846e-02,
         5.3097e-01, -1.1696e-01,  2.0172e-01, -8.4957e-02,  6.3770e-01,
        -4.1266e-01, -6.6137e-02, -1.8490e-01,  1.3801e-02, -9.6282e-02,
        -3.4405e-01, -5.9323e-01, -9.3383e-02,  2.4298e-01,  1.3712e+00,
         3.4988e-01, -1.1939e-01,  7.9182e-01,  3.3234e-01, -2.1691e-01,
        -2.2938e-01,  1.6177e-01,  8.1734e-01, -8.6401e-03, -1.0997e+00,
        -2.6202e-01,  3.1273e-01,  3.8902e-01,  2.4981e-02, -1.5612e-01,
        -7.1301e-01,  1.1993e-01, -4.9385e-02, -3.5905e-01, -1.4325e-01,
        -8.4984e-01,  2.6369e-01, -4.6952e-01,  9.7075e-02, -2.3628e-03,
         4.8463e-01, -5.3502e-01, -1.8187e-01, -2.5290e-01, -2.7965e-02,
        -1.2174e-03, -3.0804e-01,  7.3540e-02,  2.1603e-01,  9.4387e-02,
        -1.9113e-01,  7.8985e-01, -2.4873e-01,  6.1106e-01, -5.7785e-01,
        -3.5767e-01, -1.8230e-01, -2.5416e-02, -8.5886e-01,  1.9480e-01,
         7.9362e-01,  9.3213e-01, -1.1916e+00,  2.5685e-01,  1.4150e-02,
        -1.0411e+00,  2.0708e-01,  3.9690e-01,  4.6322e-02, -5.8310e-01,
        -4.8748e-01, -5.6759e-01, -2.7873e-01,  1.1580e-01,  1.1573e-01,
        -6.3564e-01, -1.3330e+00,  2.6992e-01,  6.6613e-16,  6.6613e-16,
         3.4069e+00,  2.1191e-01,  2.4701e+00, -3.0827e+00,  6.3707e-01,
        -5.8285e-01,  2.2507e-01,  1.1436e-02, -4.7594e-02,  1.6806e-01,
         5.0409e-02, -1.5415e-01,  2.5646e-01,  5.9089e-01, -8.5109e-01,
         8.9897e-01,  1.4211e-14,  3.1911e-01,  2.8687e-02,  5.3502e-02,
         1.4085e-02,  3.9967e-01, -2.2706e-01,  8.5841e-02, -5.5557e-01,
         1.4678e-01, -2.1286e-01, -3.4551e-01,  3.6512e-01,  3.5881e-01,
        -4.1247e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([16394]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.9730e-01, -1.3769e-01, -5.5384e-01,  1.1374e+00, -4.6372e-01,
        -9.8860e-01, -1.3233e+00, -8.5474e-01, -7.5678e-02,  9.8967e-02,
        -6.5086e-01, -7.0955e-02, -5.8203e-01,  1.1884e-01, -1.9635e-01,
        -2.3451e-01, -2.0460e-01, -1.3992e-01, -1.4783e-02, -2.1873e-01,
         1.7607e+00, -1.3329e-01, -5.5283e-02, -2.8985e-01, -3.1342e-01,
        -7.0902e-01, -6.5367e-01, -9.3383e-02,  6.8746e-01,  8.3982e-01,
         1.1350e-01, -3.2413e-01,  9.5883e-02,  3.3234e-01, -8.5419e-01,
        -6.3044e-01, -3.7395e-01, -6.3469e-01, -5.8384e-01, -9.1900e-02,
        -2.6316e-01,  3.6008e-01, -4.3839e-01, -4.1846e-01, -3.7246e-01,
        -8.9713e-01,  1.0749e+00,  1.9905e-02, -3.0355e-01,  2.1860e+00,
        -5.5439e-02, -1.2342e-01, -4.6952e-01, -4.0506e-01, -7.3820e-01,
        -1.9849e-01, -9.2583e-01, -4.2263e-01,  4.9758e-01,  1.8083e-01,
        -2.3771e-01,  3.5632e-01, -3.0389e-01, -9.9688e-01, -2.2148e-02,
        -3.9293e-01, -4.7732e-01,  9.4118e-01, -7.3251e-01, -6.1703e-01,
        -3.5767e-01, -1.8230e-01, -2.5416e-02, -1.0967e+00, -1.3121e-01,
        -8.7997e-02,  9.3213e-01,  8.7834e-01,  1.5095e+00,  1.4150e-02,
         7.1653e-01, -7.6735e-01, -4.8173e-01, -5.0476e-01, -2.1589e-01,
        -3.7450e-01, -4.9944e-01, -3.2512e-01, -3.4799e-01,  3.2325e-01,
        -2.4932e-01, -4.1668e-01,  2.6992e-01,  6.6613e-16,  6.6613e-16,
        -3.5980e-01, -1.5692e+00, -1.1790e+00, -4.8303e-02, -6.1655e-01,
        -5.6617e-01, -5.0238e-02,  1.0928e+00,  3.6336e-01,  7.6946e-01,
         1.5337e+00, -3.1634e-01, -3.8747e-02,  1.5525e+00, -8.1605e-01,
        -6.8367e-01,  1.4211e-14, -3.9121e-02, -2.4006e+00, -1.0332e+00,
         7.2466e+00, -6.1138e-01, -2.1204e-01,  8.5841e-02, -1.1785e-01,
        -6.9485e-02, -6.4187e-01, -6.3630e-01,  1.0311e-01, -6.0308e-02,
        -3.8034e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2443]), tensor(0.0179))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:main_restricted.py:Testing data year: 2016
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 16832
            device: cpu
            
2024-07-30 13:59:52,618	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-30 13:59:53,192	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-30 13:59:53,581	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_3c06a21c83cd0341.zip' (1.46MiB) to Ray cluster...
2024-07-30 13:59:53,591	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_3c06a21c83cd0341.zip'.
2024-07-30 14:00:11,587	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-30 14:43:54,629	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_14-00-11' in 0.3529s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 3, 'num_embeddings': 16832, 'embedding_dim': 3, 'dropout_rate': 0.22, 'lr': 0.003325610295975193, 'weight_decay': 7.465555774745724e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.1020002363183172
INFO:model_data_nn.py:Best trial testing loss: 0.09391205528475068
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-30_13-59-44_791978_592478/artifacts/2024-07-30_14-00-11/train_fnn_2024-07-30_14-00-11/driver_artifacts/train_fnn_b5fa3_00016_16_dropout_rate=0.2200,embedding_dim=3,hidden_dim=65,lr=0.0033,num_layers=3,weight_decay=0.0001_2024-07-30_14-00-11
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 3, 'num_embeddings': 17074, 'embedding_dim': 3, 'dropout_rate': 0.22, 'lr': 0.003325610295975193, 'weight_decay': 7.465555774745724e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10307509155129083, 'avg_test_loss': 0.07022381545225449}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10186050706834067, 'avg_test_loss': 0.07103270641417724}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10169941392707793, 'avg_test_loss': 0.07183739364641538}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10173522459595309, 'avg_test_loss': 0.07119962680749418}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10163498717787055, 'avg_test_loss': 0.07173454992349537}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10170924227238477, 'avg_test_loss': 0.07065834688525911}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10175479220304018, 'avg_test_loss': 0.0706789734115674}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10174567897998107, 'avg_test_loss': 0.0703891084542701}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10167315638216678, 'avg_test_loss': 0.07098665606159876}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.10168192806343238, 'avg_test_loss': 0.07095801559722678}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.1017881074702988, 'avg_test_loss': 0.07068871135130454}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10176148383955781, 'avg_test_loss': 0.07036655405050771}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10175625810050405, 'avg_test_loss': 0.0715355200525285}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10164615473321949, 'avg_test_loss': 0.0708312501212785}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10176600198707698, 'avg_test_loss': 0.07079390833657499}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.10188153834838885, 'avg_test_loss': 0.07132326058549056}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.10173766840152287, 'avg_test_loss': 0.07052602307756224}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.10183999956081001, 'avg_test_loss': 0.07056424953484845}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.10177566796657629, 'avg_test_loss': 0.07054929870900244}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.10180281091908304, 'avg_test_loss': 0.07094208566445451}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.10182314129643298, 'avg_test_loss': 0.07076813951046405}
INFO:model_data_nn.py:Early stopping at epoch 21
INFO:main_restricted.py:Making prediction for data in year: 2017
INFO:main_restricted.py:Prediction data shape: (13498,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2017: 0.2659799422814881
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  13498.000000  13498.000000
mean       0.040207      0.033529
std        0.265685      0.025285
min       -0.907776     -0.197276
25%       -0.067703      0.028115
50%        0.019797      0.039716
75%        0.118715      0.042587
max        5.661212      0.376866
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]
INFO:transform_data_nn.py:Train_data: (614435, 161)

INFO:transform_data_nn.py:Test data years: [2017]
INFO:transform_data_nn.py:Test_data: (13498, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]
INFO:transform_data_nn.py:Retrain_data: (627933, 161)

INFO:transform_data_nn.py:Prediction data years: [2018]
INFO:transform_data_nn.py:Prediction_data: (13226, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([614435, 138])
            y_train_tf: torch.Size([614435])

            x_test_tf: torch.Size([13498, 138])
            y_test_tf: torch.Size([13498])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([627933, 138])
            y_retrain_tf: torch.Size([627933])

            x_prediction_tf: torch.Size([13226, 138])
            y_prediction_tf: torch.Size([13226])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.1879e-01,  9.4321e-01,  6.3329e-02, -1.7061e+00, -1.0695e-01,
        -8.2167e-01, -1.5971e-01, -3.5496e-01,  4.2319e-01, -1.7800e-01,
        -7.2408e-01,  9.9669e-02, -7.1336e-01, -5.4968e-01,  8.8846e-02,
         5.3097e-01, -1.1696e-01,  2.0172e-01, -8.4957e-02,  6.3770e-01,
        -4.1266e-01, -6.6137e-02, -1.8490e-01,  1.3801e-02, -9.6282e-02,
        -3.4405e-01, -5.9323e-01, -9.3383e-02,  2.4298e-01,  1.3712e+00,
         3.4988e-01, -1.1939e-01,  7.9182e-01,  3.3234e-01, -2.1691e-01,
        -2.2938e-01,  1.6177e-01,  8.1734e-01, -8.6401e-03, -1.0997e+00,
        -2.6202e-01,  3.1273e-01,  3.8902e-01,  2.4981e-02, -1.5612e-01,
        -7.1301e-01,  1.1993e-01, -4.9385e-02, -3.5905e-01, -1.4325e-01,
        -8.4984e-01,  2.6369e-01, -4.6952e-01,  9.7075e-02, -2.3628e-03,
         4.8463e-01, -5.3502e-01, -1.8187e-01, -2.5290e-01, -2.7965e-02,
        -1.2174e-03, -3.0804e-01,  7.3540e-02,  2.1603e-01,  9.4387e-02,
        -1.9113e-01,  7.8985e-01, -2.4873e-01,  6.1106e-01, -5.7785e-01,
        -3.5767e-01, -1.8230e-01, -2.5416e-02, -8.5886e-01,  1.9480e-01,
         7.9362e-01,  9.3213e-01, -1.1916e+00,  2.5685e-01,  1.4150e-02,
        -1.0411e+00,  2.0708e-01,  3.9690e-01,  4.6322e-02, -5.8310e-01,
        -4.8748e-01, -5.6759e-01, -2.7873e-01,  1.1580e-01,  1.1573e-01,
        -6.3564e-01, -1.3330e+00,  2.6992e-01,  6.6613e-16,  6.6613e-16,
         3.4069e+00,  2.1191e-01,  2.4701e+00, -3.0827e+00,  6.3707e-01,
        -5.8285e-01,  2.2507e-01,  1.1436e-02, -4.7594e-02,  1.6806e-01,
         5.0409e-02, -1.5415e-01,  2.5646e-01,  5.9089e-01, -8.5109e-01,
         8.9897e-01,  1.4211e-14,  3.1911e-01,  2.8687e-02,  5.3502e-02,
         1.4085e-02,  3.9967e-01, -2.2706e-01,  8.5841e-02, -5.5557e-01,
         1.4678e-01, -2.1286e-01, -3.4551e-01,  3.6512e-01,  3.5881e-01,
        -4.1247e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([16394]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-3.9730e-01, -1.3769e-01, -5.5384e-01,  1.1374e+00, -4.6372e-01,
        -9.8860e-01, -1.3233e+00, -8.5474e-01, -7.5678e-02,  9.8967e-02,
        -6.5086e-01, -7.0955e-02, -5.8203e-01,  1.1884e-01, -1.9635e-01,
        -2.3451e-01, -2.0460e-01, -1.3992e-01, -1.4783e-02, -2.1873e-01,
         1.7607e+00, -1.3329e-01, -5.5283e-02, -2.8985e-01, -3.1342e-01,
        -7.0902e-01, -6.5367e-01, -9.3383e-02,  6.8746e-01,  8.3982e-01,
         1.1350e-01, -3.2413e-01,  9.5883e-02,  3.3234e-01, -8.5419e-01,
        -6.3044e-01, -3.7395e-01, -6.3469e-01, -5.8384e-01, -9.1900e-02,
        -2.6316e-01,  3.6008e-01, -4.3839e-01, -4.1846e-01, -3.7246e-01,
        -8.9713e-01,  1.0749e+00,  1.9905e-02, -3.0355e-01,  2.1860e+00,
        -5.5439e-02, -1.2342e-01, -4.6952e-01, -4.0506e-01, -7.3820e-01,
        -1.9849e-01, -9.2583e-01, -4.2263e-01,  4.9758e-01,  1.8083e-01,
        -2.3771e-01,  3.5632e-01, -3.0389e-01, -9.9688e-01, -2.2148e-02,
        -3.9293e-01, -4.7732e-01,  9.4118e-01, -7.3251e-01, -6.1703e-01,
        -3.5767e-01, -1.8230e-01, -2.5416e-02, -1.0967e+00, -1.3121e-01,
        -8.7997e-02,  9.3213e-01,  8.7834e-01,  1.5095e+00,  1.4150e-02,
         7.1653e-01, -7.6735e-01, -4.8173e-01, -5.0476e-01, -2.1589e-01,
        -3.7450e-01, -4.9944e-01, -3.2512e-01, -3.4799e-01,  3.2325e-01,
        -2.4932e-01, -4.1668e-01,  2.6992e-01,  6.6613e-16,  6.6613e-16,
        -3.5980e-01, -1.5692e+00, -1.1790e+00, -4.8303e-02, -6.1655e-01,
        -5.6617e-01, -5.0238e-02,  1.0928e+00,  3.6336e-01,  7.6946e-01,
         1.5337e+00, -3.1634e-01, -3.8747e-02,  1.5525e+00, -8.1605e-01,
        -6.8367e-01,  1.4211e-14, -3.9121e-02, -2.4006e+00, -1.0332e+00,
         7.2466e+00, -6.1138e-01, -2.1204e-01,  8.5841e-02, -1.1785e-01,
        -6.9485e-02, -6.4187e-01, -6.3630e-01,  1.0311e-01, -6.0308e-02,
        -3.8034e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2443]), tensor(0.0179))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.1810e-01,  9.4908e-01,  6.1155e-02, -1.7131e+00, -1.0370e-01,
        -8.2052e-01, -1.6272e-01, -3.5692e-01,  4.2943e-01, -1.7776e-01,
        -7.2490e-01,  1.0603e-01, -7.1575e-01, -5.4906e-01,  9.0054e-02,
         5.3366e-01, -1.1645e-01,  2.0152e-01, -8.5586e-02,  6.4484e-01,
        -4.1328e-01, -6.6484e-02, -1.8170e-01,  1.4751e-02, -9.6002e-02,
        -3.4412e-01, -5.9308e-01, -9.3968e-02,  2.2085e-01,  1.3746e+00,
         3.5063e-01, -1.1693e-01,  7.9397e-01,  3.3628e-01, -2.1326e-01,
        -2.2749e-01,  1.6721e-01,  8.2072e-01, -7.1833e-03, -1.0932e+00,
        -2.5971e-01,  3.1290e-01,  3.9642e-01,  2.6536e-02, -1.5480e-01,
        -7.0923e-01,  1.1884e-01, -5.3090e-02, -3.5368e-01, -1.4426e-01,
        -8.5121e-01,  2.4804e-01, -4.6935e-01,  9.7795e-02, -9.6488e-04,
         4.8193e-01, -5.2944e-01, -1.8102e-01, -2.5159e-01, -2.7927e-02,
        -6.4104e-04, -3.0684e-01,  7.2972e-02,  2.1730e-01,  9.4620e-02,
        -1.9167e-01,  7.9745e-01, -2.4686e-01,  6.0897e-01, -5.7769e-01,
        -3.5909e-01, -1.8425e-01, -2.6042e-02, -8.5428e-01,  1.9996e-01,
         8.0063e-01,  9.3980e-01, -1.1949e+00,  2.5298e-01,  1.4749e-02,
        -1.0707e+00,  2.0967e-01,  4.0411e-01,  6.0256e-02, -5.8362e-01,
        -4.9400e-01, -5.6939e-01, -2.7868e-01,  1.1905e-01,  1.1643e-01,
        -6.4056e-01, -1.3320e+00,  2.7321e-01, -1.1102e-15, -1.1102e-15,
         3.4464e+00,  2.3476e-01,  2.4893e+00, -3.1048e+00,  6.5659e-01,
        -5.7430e-01,  2.3227e-01,  1.1404e-02, -4.6341e-02,  1.6449e-01,
         5.1625e-02, -1.5660e-01,  2.4325e-01,  6.4231e-01, -8.3870e-01,
         9.1867e-01,  8.8818e-15,  3.1843e-01,  2.7414e-02,  4.8645e-02,
         1.3878e-02,  4.0922e-01, -2.2573e-01,  9.3958e-02, -5.5418e-01,
         1.4856e-01, -2.0737e-01, -3.4111e-01,  3.6765e-01,  3.5746e-01,
        -4.1151e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([16536]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.8109e-01, -1.4332e-01, -1.3723e-01,  1.1277e+00, -1.4309e-01,
        -5.4020e-01, -6.6337e-01, -6.4956e-01, -6.5929e-01, -1.0354e+00,
         7.4836e-02,  1.4410e+00,  1.9425e+00, -9.3326e-03, -6.1171e-02,
         3.2998e-01, -2.0532e-01, -2.0936e+00, -1.9266e-02,  1.6777e-01,
         2.8783e-01, -1.3370e-01, -1.6483e-01,  1.9440e-01,  3.5284e-02,
         1.2958e-01, -3.4712e-01, -4.0851e-01,  8.7936e-01, -1.6440e-01,
         6.7155e-01, -1.4609e-01,  2.2673e-01,  3.3628e-01,  4.0723e-01,
        -2.0781e-01,  3.3674e-01, -2.8501e-01,  2.1531e-01, -1.1132e+00,
        -2.6143e-01, -3.1732e-02,  8.9484e-02, -6.2665e-01, -3.9855e-02,
        -8.5502e-01,  3.6934e-02,  7.2662e-04, -4.4817e-02,  2.7321e-01,
         7.3827e-01,  1.2827e+00, -4.6935e-01,  1.5521e-01, -7.3895e-01,
         1.5634e-01, -3.4867e-01,  5.1531e-02, -2.7262e-01, -5.2225e-01,
        -6.2007e-02, -3.1105e-01, -2.0494e-01, -4.6337e-01, -1.0179e-01,
        -3.1500e-01, -3.4194e-01, -2.9697e-01,  6.0897e-01,  3.3105e-02,
        -3.5596e-01, -1.8347e-01, -2.6042e-02, -9.8206e-01,  1.2096e+00,
         1.2050e-02, -1.2701e-01,  3.6578e-01,  5.4786e-01,  3.5510e-01,
         7.7550e-01, -1.6629e-01, -6.0970e-01, -9.5197e-01, -4.2028e-01,
        -4.9942e-01, -5.7236e-01, -3.5900e-01, -2.7140e-01,  1.8030e-01,
        -3.4222e-01, -1.8088e-01,  2.7321e-01, -1.1102e-15, -1.1102e-15,
        -6.4060e-01, -1.2806e+00, -8.9790e-01, -7.7609e-01, -7.3985e-01,
        -6.4398e-01,  5.9012e-02, -4.6564e-01, -4.3832e-01, -2.7772e+00,
         1.4399e+00, -1.7049e-01,  4.6931e-01,  6.4231e-01, -6.3944e-01,
        -7.4605e-01,  8.8818e-15,  2.7867e-01,  2.7414e-02, -8.1351e-01,
        -2.2931e-02, -7.9242e-02, -3.9314e-01,  9.3958e-02, -5.6292e-01,
        -4.3957e-02,  9.3401e-02,  2.5380e+00,  5.9345e-01,  2.8250e-01,
        -4.1181e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00]), tensor([845]), tensor(-0.0976))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]
INFO:main_restricted.py:Testing data year: 2017
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 17074
            device: cpu
            
2024-07-30 16:22:06,091	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-30 16:22:06,149	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-30 16:22:06,192	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_3c06a21c83cd0341.zip' (1.46MiB) to Ray cluster...
2024-07-30 16:22:06,202	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_3c06a21c83cd0341.zip'.
2024-07-30 16:22:08,265	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-30 17:23:28,503	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_16-22-08' in 0.4565s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 115, 'num_layers': 5, 'num_embeddings': 17074, 'embedding_dim': 2, 'dropout_rate': 0.51, 'lr': 0.0002971772348184001, 'weight_decay': 1.0224984178178795e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.09319971715313538
INFO:model_data_nn.py:Best trial testing loss: 0.07041733643101855
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-30_16-22-03_258096_592478/artifacts/2024-07-30_16-22-08/train_fnn_2024-07-30_16-22-08/driver_artifacts/train_fnn_8a501_00058_58_dropout_rate=0.5100,embedding_dim=2,hidden_dim=115,lr=0.0003,num_layers=5,weight_decay=0.0000_2024-07-30_16-22-08
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 115, 'num_layers': 5, 'num_embeddings': 17220, 'embedding_dim': 2, 'dropout_rate': 0.51, 'lr': 0.0002971772348184001, 'weight_decay': 1.0224984178178795e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10543664536144516, 'avg_test_loss': 0.0916149825271633}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10374125535863309, 'avg_test_loss': 0.09174458505720764}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10212081799879952, 'avg_test_loss': 0.09142810528297067}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10080117871790241, 'avg_test_loss': 0.09150857737980747}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.09957516023357786, 'avg_test_loss': 0.09146091126913322}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.09867081751521241, 'avg_test_loss': 0.09085799471119752}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.09788393138059873, 'avg_test_loss': 0.09095018425875384}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.0972010709439128, 'avg_test_loss': 0.09058026111896199}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.09663300248738725, 'avg_test_loss': 0.09155049889038007}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.09624175674208636, 'avg_test_loss': 0.09158794875684136}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.09575090926942105, 'avg_test_loss': 0.09153885864945138}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.09551521917479858, 'avg_test_loss': 0.09206349027437577}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.09512617242116347, 'avg_test_loss': 0.09250758640504114}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.095059714707902, 'avg_test_loss': 0.09283913932920654}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.09476635299433919, 'avg_test_loss': 0.09352550551223295}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.09460698032202815, 'avg_test_loss': 0.09133550847300152}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.09419547849507637, 'avg_test_loss': 0.0918662004208795}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.0943102556213489, 'avg_test_loss': 0.09207479204478615}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.09402952601747944, 'avg_test_loss': 0.09235869366045735}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.09380364186029747, 'avg_test_loss': 0.09276999063015992}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.0940230260655814, 'avg_test_loss': 0.09297006520114227}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.09363393579902919, 'avg_test_loss': 0.09309470891538593}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.09358791317614183, 'avg_test_loss': 0.09211620164738185}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.09367287759128519, 'avg_test_loss': 0.09126738084993069}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.09345888589805856, 'avg_test_loss': 0.09327195045776701}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.09345061118422043, 'avg_test_loss': 0.09285112716041613}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.09341614684840886, 'avg_test_loss': 0.09269815683364868}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.09348937977344973, 'avg_test_loss': 0.0928784629896931}
INFO:model_data_nn.py:Early stopping at epoch 28
INFO:main_restricted.py:Making prediction for data in year: 2018
INFO:main_restricted.py:Prediction data shape: (13226,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2018: 0.3046552535080435
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  13226.000000  13226.000000
mean      -0.026920      0.036155
std        0.297287      0.021778
min       -0.999805     -0.178592
25%       -0.157460      0.030171
50%       -0.023134      0.042867
75%        0.081345      0.049379
max       12.032942      0.364514
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]
INFO:transform_data_nn.py:Train_data: (627933, 161)

INFO:transform_data_nn.py:Test data years: [2018]
INFO:transform_data_nn.py:Test_data: (13226, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]
INFO:transform_data_nn.py:Retrain_data: (641159, 161)

INFO:transform_data_nn.py:Prediction data years: [2019]
INFO:transform_data_nn.py:Prediction_data: (13264, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([627933, 138])
            y_train_tf: torch.Size([627933])

            x_test_tf: torch.Size([13226, 138])
            y_test_tf: torch.Size([13226])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([641159, 138])
            y_retrain_tf: torch.Size([641159])

            x_prediction_tf: torch.Size([13264, 138])
            y_prediction_tf: torch.Size([13264])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.1810e-01,  9.4908e-01,  6.1155e-02, -1.7131e+00, -1.0370e-01,
        -8.2052e-01, -1.6272e-01, -3.5692e-01,  4.2943e-01, -1.7776e-01,
        -7.2490e-01,  1.0603e-01, -7.1575e-01, -5.4906e-01,  9.0054e-02,
         5.3366e-01, -1.1645e-01,  2.0152e-01, -8.5586e-02,  6.4484e-01,
        -4.1328e-01, -6.6484e-02, -1.8170e-01,  1.4751e-02, -9.6002e-02,
        -3.4412e-01, -5.9308e-01, -9.3968e-02,  2.2085e-01,  1.3746e+00,
         3.5063e-01, -1.1693e-01,  7.9397e-01,  3.3628e-01, -2.1326e-01,
        -2.2749e-01,  1.6721e-01,  8.2072e-01, -7.1833e-03, -1.0932e+00,
        -2.5971e-01,  3.1290e-01,  3.9642e-01,  2.6536e-02, -1.5480e-01,
        -7.0923e-01,  1.1884e-01, -5.3090e-02, -3.5368e-01, -1.4426e-01,
        -8.5121e-01,  2.4804e-01, -4.6935e-01,  9.7795e-02, -9.6488e-04,
         4.8193e-01, -5.2944e-01, -1.8102e-01, -2.5159e-01, -2.7927e-02,
        -6.4104e-04, -3.0684e-01,  7.2972e-02,  2.1730e-01,  9.4620e-02,
        -1.9167e-01,  7.9745e-01, -2.4686e-01,  6.0897e-01, -5.7769e-01,
        -3.5909e-01, -1.8425e-01, -2.6042e-02, -8.5428e-01,  1.9996e-01,
         8.0063e-01,  9.3980e-01, -1.1949e+00,  2.5298e-01,  1.4749e-02,
        -1.0707e+00,  2.0967e-01,  4.0411e-01,  6.0256e-02, -5.8362e-01,
        -4.9400e-01, -5.6939e-01, -2.7868e-01,  1.1905e-01,  1.1643e-01,
        -6.4056e-01, -1.3320e+00,  2.7321e-01, -1.1102e-15, -1.1102e-15,
         3.4464e+00,  2.3476e-01,  2.4893e+00, -3.1048e+00,  6.5659e-01,
        -5.7430e-01,  2.3227e-01,  1.1404e-02, -4.6341e-02,  1.6449e-01,
         5.1625e-02, -1.5660e-01,  2.4325e-01,  6.4231e-01, -8.3870e-01,
         9.1867e-01,  8.8818e-15,  3.1843e-01,  2.7414e-02,  4.8645e-02,
         1.3878e-02,  4.0922e-01, -2.2573e-01,  9.3958e-02, -5.5418e-01,
         1.4856e-01, -2.0737e-01, -3.4111e-01,  3.6765e-01,  3.5746e-01,
        -4.1151e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([16536]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-3.8109e-01, -1.4332e-01, -1.3723e-01,  1.1277e+00, -1.4309e-01,
        -5.4020e-01, -6.6337e-01, -6.4956e-01, -6.5929e-01, -1.0354e+00,
         7.4836e-02,  1.4410e+00,  1.9425e+00, -9.3326e-03, -6.1171e-02,
         3.2998e-01, -2.0532e-01, -2.0936e+00, -1.9266e-02,  1.6777e-01,
         2.8783e-01, -1.3370e-01, -1.6483e-01,  1.9440e-01,  3.5284e-02,
         1.2958e-01, -3.4712e-01, -4.0851e-01,  8.7936e-01, -1.6440e-01,
         6.7155e-01, -1.4609e-01,  2.2673e-01,  3.3628e-01,  4.0723e-01,
        -2.0781e-01,  3.3674e-01, -2.8501e-01,  2.1531e-01, -1.1132e+00,
        -2.6143e-01, -3.1732e-02,  8.9484e-02, -6.2665e-01, -3.9855e-02,
        -8.5502e-01,  3.6934e-02,  7.2662e-04, -4.4817e-02,  2.7321e-01,
         7.3827e-01,  1.2827e+00, -4.6935e-01,  1.5521e-01, -7.3895e-01,
         1.5634e-01, -3.4867e-01,  5.1531e-02, -2.7262e-01, -5.2225e-01,
        -6.2007e-02, -3.1105e-01, -2.0494e-01, -4.6337e-01, -1.0179e-01,
        -3.1500e-01, -3.4194e-01, -2.9697e-01,  6.0897e-01,  3.3105e-02,
        -3.5596e-01, -1.8347e-01, -2.6042e-02, -9.8206e-01,  1.2096e+00,
         1.2050e-02, -1.2701e-01,  3.6578e-01,  5.4786e-01,  3.5510e-01,
         7.7550e-01, -1.6629e-01, -6.0970e-01, -9.5197e-01, -4.2028e-01,
        -4.9942e-01, -5.7236e-01, -3.5900e-01, -2.7140e-01,  1.8030e-01,
        -3.4222e-01, -1.8088e-01,  2.7321e-01, -1.1102e-15, -1.1102e-15,
        -6.4060e-01, -1.2806e+00, -8.9790e-01, -7.7609e-01, -7.3985e-01,
        -6.4398e-01,  5.9012e-02, -4.6564e-01, -4.3832e-01, -2.7772e+00,
         1.4399e+00, -1.7049e-01,  4.6931e-01,  6.4231e-01, -6.3944e-01,
        -7.4605e-01,  8.8818e-15,  2.7867e-01,  2.7414e-02, -8.1351e-01,
        -2.2931e-02, -7.9242e-02, -3.9314e-01,  9.3958e-02, -5.6292e-01,
        -4.3957e-02,  9.3401e-02,  2.5380e+00,  5.9345e-01,  2.8250e-01,
        -4.1181e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00]), tensor([845]), tensor(-0.0976))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.1676e-01,  9.5332e-01,  5.9128e-02, -1.7205e+00, -1.0311e-01,
        -8.1990e-01, -1.6585e-01, -3.5892e-01,  4.3543e-01, -1.7735e-01,
        -7.2534e-01,  1.1109e-01, -7.1881e-01, -5.4888e-01,  9.1678e-02,
         5.3631e-01, -1.1613e-01,  1.9987e-01, -9.0169e-02,  6.5005e-01,
        -4.1457e-01, -6.7557e-02, -1.8307e-01,  1.6918e-02, -9.6752e-02,
        -3.4414e-01, -5.9236e-01, -9.5371e-02,  2.0022e-01,  1.3770e+00,
         3.5025e-01, -1.1689e-01,  7.9600e-01,  3.3865e-01, -2.0974e-01,
        -2.2510e-01,  1.7127e-01,  8.2319e-01, -5.7916e-03, -1.0873e+00,
        -2.5739e-01,  3.1429e-01,  4.0195e-01,  2.8640e-02, -1.5393e-01,
        -7.0467e-01,  1.1825e-01, -5.2297e-02, -3.5214e-01, -1.4572e-01,
        -8.5127e-01,  2.3200e-01, -4.6923e-01,  9.8502e-02,  7.3323e-04,
         4.8067e-01, -5.2395e-01, -1.8006e-01, -2.5147e-01, -2.7450e-02,
        -5.3786e-04, -3.0672e-01,  7.1259e-02,  2.1892e-01,  9.2232e-02,
        -1.9307e-01,  8.0423e-01, -2.4536e-01,  6.0833e-01, -5.7755e-01,
        -3.6034e-01, -1.8612e-01, -2.6389e-02, -8.5003e-01,  2.0454e-01,
         8.0607e-01,  9.4667e-01, -1.1984e+00,  2.5053e-01,  1.4819e-02,
        -1.0899e+00,  2.0934e-01,  4.1097e-01,  7.4576e-02, -5.8401e-01,
        -5.0024e-01, -5.7093e-01, -2.7806e-01,  1.2175e-01,  1.1774e-01,
        -6.4538e-01, -1.3307e+00,  2.7593e-01, -3.3307e-16, -3.3307e-16,
         3.4823e+00,  2.5980e-01,  2.5161e+00, -3.0980e+00,  6.7202e-01,
        -5.7052e-01,  2.3673e-01,  1.2265e-02, -4.4577e-02,  1.6373e-01,
         5.2495e-02, -1.5990e-01,  2.4184e-01,  6.4956e-01, -8.3091e-01,
         9.3903e-01, -1.7764e-14,  3.1753e-01,  2.6405e-02,  4.4465e-02,
         1.5956e-02,  4.1853e-01, -2.2497e-01,  1.0083e-01, -5.5285e-01,
         1.4900e-01, -2.0189e-01, -3.3770e-01,  3.6963e-01,  3.5570e-01,
        -4.1145e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([16710]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-6.9802e-01,  1.2601e-01,  2.7326e-02,  1.1184e+00, -1.9269e-01,
        -3.3091e-01, -7.0688e-01, -6.6964e-01, -6.0459e-01, -1.1729e+00,
        -8.1862e-02,  1.7271e+00,  1.9372e+00, -3.7816e-03, -5.0207e-01,
        -1.2429e-01, -1.9881e-01,  3.4870e-01, -2.6330e-02,  4.4819e-02,
        -1.5275e-01,  1.1228e+00, -2.1519e-01, -4.1044e-01, -6.3662e-02,
         1.4182e-01, -3.3343e-01, -4.3356e-01,  8.7727e-01, -1.2085e-01,
        -4.2216e-01, -8.6744e-02,  2.7469e-01,  3.3865e-01,  3.5207e-01,
        -2.8949e-01, -1.8315e-01, -2.9601e-01, -6.8622e-02, -1.1320e+00,
        -2.5906e-01, -3.6241e-01, -2.5639e-02, -6.2599e-01, -4.1522e-01,
        -6.9710e-01, -1.4443e-01, -5.7617e-01,  4.4260e-02, -5.9789e-02,
         7.3835e-01,  1.2416e+00, -4.6923e-01,  4.2309e-01, -7.3961e-01,
         1.0225e-01, -3.2907e-01, -4.6601e-01, -1.1526e-01, -1.5277e-01,
        -7.3557e-02, -1.8889e-01, -1.2936e-01, -2.6542e-02, -7.0753e-02,
        -2.8476e-01, -1.3652e-01, -3.4672e-01,  6.0833e-01,  9.8469e-03,
        -3.5734e-01, -1.8545e-01, -2.6389e-02, -5.2235e-01,  1.2265e+00,
        -1.3297e-01,  1.5290e-01,  2.4834e-01,  5.1771e-01,  3.5803e-01,
         7.7267e-01, -2.5899e-01, -5.9090e-01, -1.1098e+00, -3.3333e-01,
        -5.0762e-01, -5.7420e-01, -3.5747e-01, -4.6943e-01, -2.0689e-01,
        -2.9120e-01, -2.6347e-01,  2.7593e-01, -3.3307e-16, -3.3307e-16,
        -4.6978e-01, -1.2132e+00, -5.5294e-01, -1.3196e+00,  1.8767e-01,
         1.3975e+00,  1.2668e-01, -8.0014e-01, -5.2822e-01, -2.0363e+00,
         1.3824e+00, -1.9084e-01, -2.3429e+00,  6.4956e-01, -8.3660e-01,
        -9.6349e-01, -1.7764e-14,  2.4167e-01,  2.6405e-02, -7.5347e-01,
        -6.7922e-01, -2.7920e-02, -3.4535e-01,  1.0083e-01, -5.6184e-01,
        -6.8839e-02,  8.0848e-02,  2.5432e+00,  6.9831e-01,  3.4051e-01,
        -3.9283e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00]), tensor([848]), tensor(0.1020))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]
INFO:main_restricted.py:Testing data year: 2018
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 17220
            device: cpu
            
2024-07-30 19:19:03,967	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-30 19:19:04,025	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-30 19:19:04,068	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_14c409843300b763.zip' (1.47MiB) to Ray cluster...
2024-07-30 19:19:04,074	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_14c409843300b763.zip'.
2024-07-30 19:19:06,300	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-30 20:17:02,814	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_19-19-06' in 0.2774s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 195, 'num_layers': 3, 'num_embeddings': 17220, 'embedding_dim': 10, 'dropout_rate': 0.47, 'lr': 2.153464142964256e-06, 'weight_decay': 1.8841368421034387e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.10260621612813145
INFO:model_data_nn.py:Best trial testing loss: 0.09030656658050015
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-30_19-19-01_343881_592478/artifacts/2024-07-30_19-19-06/train_fnn_2024-07-30_19-19-06/driver_artifacts/train_fnn_4327b_00065_65_dropout_rate=0.4700,embedding_dim=10,hidden_dim=195,lr=0.0000,num_layers=3,weight_decay=0.0000_2024-07-30_19-19-06
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 195, 'num_layers': 3, 'num_embeddings': 17402, 'embedding_dim': 10, 'dropout_rate': 0.47, 'lr': 2.153464142964256e-06, 'weight_decay': 1.8841368421034387e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.1143444078271797, 'avg_test_loss': 0.10664396459917323}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.1092820506376328, 'avg_test_loss': 0.10621962305874778}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10697257695940857, 'avg_test_loss': 0.10590195611943133}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10585832663224763, 'avg_test_loss': 0.10574908092026956}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.1051416641618498, 'avg_test_loss': 0.10572598264731753}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10480349230451555, 'avg_test_loss': 0.10562081672609426}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10455238344982626, 'avg_test_loss': 0.10554154570518921}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10442090877304834, 'avg_test_loss': 0.10574988964855528}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.1042995385849433, 'avg_test_loss': 0.10570840515608254}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.1041759513333413, 'avg_test_loss': 0.10574229534428853}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10413898522695082, 'avg_test_loss': 0.10574424474124008}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10404581702404493, 'avg_test_loss': 0.10587309915661955}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10401976066884148, 'avg_test_loss': 0.10573375592670906}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10390478899052791, 'avg_test_loss': 0.10590212983347905}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10384193950113861, 'avg_test_loss': 0.10604287948137006}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.1037802924921732, 'avg_test_loss': 0.10594179098888372}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.10371855850020796, 'avg_test_loss': 0.10602900964351228}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.10367089524856969, 'avg_test_loss': 0.1061061431044856}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.10359029547305974, 'avg_test_loss': 0.10615132025066906}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.10359662976026696, 'avg_test_loss': 0.10614836966851726}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.10346015895045453, 'avg_test_loss': 0.10624339538984574}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.10341755324615068, 'avg_test_loss': 0.1062620474347988}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.10339444769049214, 'avg_test_loss': 0.10628773003386763}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.10335284072078763, 'avg_test_loss': 0.10654474680240338}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.1032531602896808, 'avg_test_loss': 0.10654436622280627}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.10323416378964866, 'avg_test_loss': 0.1063624738733499}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.10307628802868135, 'avg_test_loss': 0.10666054810504787}
INFO:model_data_nn.py:Early stopping at epoch 27
INFO:main_restricted.py:Making prediction for data in year: 2019
INFO:main_restricted.py:Prediction data shape: (13264,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2019: 0.326791081333557
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  13264.000000  13264.000000
mean       0.056319      0.020006
std        0.323019      0.024975
min       -0.956827     -0.139529
25%       -0.068035      0.008615
50%        0.034312      0.020872
75%        0.149987      0.030965
max        7.044691      0.174859
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]
INFO:transform_data_nn.py:Train_data: (641159, 161)

INFO:transform_data_nn.py:Test data years: [2019]
INFO:transform_data_nn.py:Test_data: (13264, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019]
INFO:transform_data_nn.py:Retrain_data: (654423, 161)

INFO:transform_data_nn.py:Prediction data years: [2020]
INFO:transform_data_nn.py:Prediction_data: (13301, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([641159, 138])
            y_train_tf: torch.Size([641159])

            x_test_tf: torch.Size([13264, 138])
            y_test_tf: torch.Size([13264])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([654423, 138])
            y_retrain_tf: torch.Size([654423])

            x_prediction_tf: torch.Size([13301, 138])
            y_prediction_tf: torch.Size([13301])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.1676e-01,  9.5332e-01,  5.9128e-02, -1.7205e+00, -1.0311e-01,
        -8.1990e-01, -1.6585e-01, -3.5892e-01,  4.3543e-01, -1.7735e-01,
        -7.2534e-01,  1.1109e-01, -7.1881e-01, -5.4888e-01,  9.1678e-02,
         5.3631e-01, -1.1613e-01,  1.9987e-01, -9.0169e-02,  6.5005e-01,
        -4.1457e-01, -6.7557e-02, -1.8307e-01,  1.6918e-02, -9.6752e-02,
        -3.4414e-01, -5.9236e-01, -9.5371e-02,  2.0022e-01,  1.3770e+00,
         3.5025e-01, -1.1689e-01,  7.9600e-01,  3.3865e-01, -2.0974e-01,
        -2.2510e-01,  1.7127e-01,  8.2319e-01, -5.7916e-03, -1.0873e+00,
        -2.5739e-01,  3.1429e-01,  4.0195e-01,  2.8640e-02, -1.5393e-01,
        -7.0467e-01,  1.1825e-01, -5.2297e-02, -3.5214e-01, -1.4572e-01,
        -8.5127e-01,  2.3200e-01, -4.6923e-01,  9.8502e-02,  7.3323e-04,
         4.8067e-01, -5.2395e-01, -1.8006e-01, -2.5147e-01, -2.7450e-02,
        -5.3786e-04, -3.0672e-01,  7.1259e-02,  2.1892e-01,  9.2232e-02,
        -1.9307e-01,  8.0423e-01, -2.4536e-01,  6.0833e-01, -5.7755e-01,
        -3.6034e-01, -1.8612e-01, -2.6389e-02, -8.5003e-01,  2.0454e-01,
         8.0607e-01,  9.4667e-01, -1.1984e+00,  2.5053e-01,  1.4819e-02,
        -1.0899e+00,  2.0934e-01,  4.1097e-01,  7.4576e-02, -5.8401e-01,
        -5.0024e-01, -5.7093e-01, -2.7806e-01,  1.2175e-01,  1.1774e-01,
        -6.4538e-01, -1.3307e+00,  2.7593e-01, -3.3307e-16, -3.3307e-16,
         3.4823e+00,  2.5980e-01,  2.5161e+00, -3.0980e+00,  6.7202e-01,
        -5.7052e-01,  2.3673e-01,  1.2265e-02, -4.4577e-02,  1.6373e-01,
         5.2495e-02, -1.5990e-01,  2.4184e-01,  6.4956e-01, -8.3091e-01,
         9.3903e-01, -1.7764e-14,  3.1753e-01,  2.6405e-02,  4.4465e-02,
         1.5956e-02,  4.1853e-01, -2.2497e-01,  1.0083e-01, -5.5285e-01,
         1.4900e-01, -2.0189e-01, -3.3770e-01,  3.6963e-01,  3.5570e-01,
        -4.1145e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([16710]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-6.9802e-01,  1.2601e-01,  2.7326e-02,  1.1184e+00, -1.9269e-01,
        -3.3091e-01, -7.0688e-01, -6.6964e-01, -6.0459e-01, -1.1729e+00,
        -8.1862e-02,  1.7271e+00,  1.9372e+00, -3.7816e-03, -5.0207e-01,
        -1.2429e-01, -1.9881e-01,  3.4870e-01, -2.6330e-02,  4.4819e-02,
        -1.5275e-01,  1.1228e+00, -2.1519e-01, -4.1044e-01, -6.3662e-02,
         1.4182e-01, -3.3343e-01, -4.3356e-01,  8.7727e-01, -1.2085e-01,
        -4.2216e-01, -8.6744e-02,  2.7469e-01,  3.3865e-01,  3.5207e-01,
        -2.8949e-01, -1.8315e-01, -2.9601e-01, -6.8622e-02, -1.1320e+00,
        -2.5906e-01, -3.6241e-01, -2.5639e-02, -6.2599e-01, -4.1522e-01,
        -6.9710e-01, -1.4443e-01, -5.7617e-01,  4.4260e-02, -5.9789e-02,
         7.3835e-01,  1.2416e+00, -4.6923e-01,  4.2309e-01, -7.3961e-01,
         1.0225e-01, -3.2907e-01, -4.6601e-01, -1.1526e-01, -1.5277e-01,
        -7.3557e-02, -1.8889e-01, -1.2936e-01, -2.6542e-02, -7.0753e-02,
        -2.8476e-01, -1.3652e-01, -3.4672e-01,  6.0833e-01,  9.8469e-03,
        -3.5734e-01, -1.8545e-01, -2.6389e-02, -5.2235e-01,  1.2265e+00,
        -1.3297e-01,  1.5290e-01,  2.4834e-01,  5.1771e-01,  3.5803e-01,
         7.7267e-01, -2.5899e-01, -5.9090e-01, -1.1098e+00, -3.3333e-01,
        -5.0762e-01, -5.7420e-01, -3.5747e-01, -4.6943e-01, -2.0689e-01,
        -2.9120e-01, -2.6347e-01,  2.7593e-01, -3.3307e-16, -3.3307e-16,
        -4.6978e-01, -1.2132e+00, -5.5294e-01, -1.3196e+00,  1.8767e-01,
         1.3975e+00,  1.2668e-01, -8.0014e-01, -5.2822e-01, -2.0363e+00,
         1.3824e+00, -1.9084e-01, -2.3429e+00,  6.4956e-01, -8.3660e-01,
        -9.6349e-01, -1.7764e-14,  2.4167e-01,  2.6405e-02, -7.5347e-01,
        -6.7922e-01, -2.7920e-02, -3.4535e-01,  1.0083e-01, -5.6184e-01,
        -6.8839e-02,  8.0848e-02,  2.5432e+00,  6.9831e-01,  3.4051e-01,
        -3.9283e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00]), tensor([848]), tensor(0.1020))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.1539e-01,  9.5694e-01,  5.7715e-02, -1.7252e+00, -1.0321e-01,
        -8.2251e-01, -1.7064e-01, -3.6223e-01,  4.3640e-01, -1.7624e-01,
        -7.2524e-01,  1.1644e-01, -7.1965e-01, -5.4697e-01,  9.1889e-02,
         5.3861e-01, -1.1525e-01,  1.9845e-01, -9.0948e-02,  6.5505e-01,
        -4.1452e-01, -6.6294e-02, -1.8884e-01,  1.8600e-02, -1.0072e-01,
        -3.4396e-01, -5.9176e-01, -9.7988e-02,  1.7522e-01,  1.3746e+00,
         3.5051e-01, -1.1628e-01,  7.9578e-01,  3.4199e-01, -2.0559e-01,
        -2.2410e-01,  1.7407e-01,  8.2458e-01, -5.5354e-03, -1.0817e+00,
        -2.5533e-01,  3.2940e-01,  4.0504e-01,  2.7797e-02, -1.5442e-01,
        -7.0337e-01,  1.2544e-01, -4.8968e-02, -3.5451e-01, -1.4122e-01,
        -8.5220e-01,  2.1814e-01, -4.6886e-01,  9.9233e-02,  3.4732e-03,
         4.8045e-01, -5.1829e-01, -1.7860e-01, -2.5068e-01, -2.1552e-02,
        -8.5449e-05, -3.0578e-01,  7.0157e-02,  2.1847e-01,  9.0758e-02,
        -1.9422e-01,  8.0985e-01, -2.4268e-01,  6.0847e-01, -5.7682e-01,
        -3.6158e-01, -1.8805e-01, -2.4393e-02, -8.4999e-01,  2.0961e-01,
         8.1073e-01,  9.5344e-01, -1.2019e+00,  2.4719e-01,  1.7171e-02,
        -1.1009e+00,  2.0898e-01,  4.1405e-01,  8.8214e-02, -5.8440e-01,
        -5.0664e-01, -5.7223e-01, -2.7775e-01,  1.2416e-01,  1.2166e-01,
        -6.5004e-01, -1.3287e+00,  2.7893e-01,  3.3307e-16,  3.3307e-16,
         3.5179e+00,  2.8104e-01,  2.5448e+00, -3.0181e+00,  6.7884e-01,
        -5.7321e-01,  2.4087e-01,  1.0039e-02, -4.3870e-02,  1.5819e-01,
         5.1909e-02, -1.6235e-01,  1.8136e-01,  6.5670e-01, -8.2995e-01,
         9.5472e-01,  1.9540e-14,  3.1697e-01,  3.0542e-02,  3.9156e-02,
         1.4859e-02,  4.2770e-01, -2.2604e-01,  1.0765e-01, -5.5116e-01,
         1.4899e-01, -1.9613e-01, -3.3310e-01,  3.7148e-01,  3.5471e-01,
        -4.1138e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([16937]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.9281e-01, -1.2114e-01, -3.5078e-01,  1.1119e+00, -1.5017e-01,
        -8.1166e-01, -1.0248e+00, -7.8966e-01, -6.5343e-01, -1.1725e+00,
         3.8486e-01,  1.6364e+00,  1.4506e+00, -1.5449e-02, -5.6715e-01,
        -9.5622e-02, -2.0469e-01,  6.0259e-02, -9.1657e-01, -9.4196e-02,
         2.5999e-02,  2.3551e+00, -1.7626e-01, -3.8282e-01, -8.2401e-02,
         4.8556e-01, -3.3515e-01, -4.9046e-01,  8.8060e-01, -1.7100e-01,
        -4.8276e-01, -1.0565e-01,  2.2796e-01,  3.4199e-01,  2.9168e-01,
        -4.6589e-01, -2.2274e-01, -2.7129e-01, -2.1664e-01, -1.1050e+00,
        -2.5711e-01,  1.4532e-01, -5.3296e-01, -6.2877e-01, -2.2822e-01,
        -8.5014e-01,  3.0910e-01, -5.4812e-02, -2.1235e-01,  2.9141e-01,
         7.3818e-01,  1.3377e+00, -4.6886e-01,  1.2928e-01, -7.3980e-01,
         8.5223e-02, -3.5644e-01, -1.7107e-01,  3.7214e-01, -2.1984e-01,
        -3.6069e-02,  4.6368e-01,  2.0695e-02, -5.3520e-02, -1.4068e-02,
        -2.1228e-01, -3.2305e-01, -2.9569e-01, -6.3907e-02,  3.6925e-01,
        -3.5919e-01, -1.8740e-01, -2.4393e-02, -9.5910e-01,  1.2364e+00,
        -7.9380e-02, -5.9434e-01,  2.6803e-01,  4.6666e-01,  3.6294e-01,
         7.6960e-01, -2.7566e-01, -6.1538e-01, -1.1296e+00, -2.4332e-01,
        -5.1496e-01, -5.7592e-01, -4.0588e-01,  6.6453e-02, -1.2901e-02,
        -8.7442e-02, -6.5693e-01,  2.7893e-01,  3.3307e-16,  3.3307e-16,
        -6.9543e-01, -5.9449e-01, -8.0934e-01, -1.3770e+00, -3.6929e-01,
        -5.6299e-01, -2.6812e-02,  1.0039e-02, -4.9060e-01,  1.5819e-01,
         1.6596e+00, -1.8125e-01,  3.3084e-01,  6.5670e-01, -1.1996e-01,
         2.4606e-01,  1.9540e-14,  2.4620e-01,  3.0542e-02, -6.7374e-01,
         1.8372e-01,  2.9524e-03, -2.8426e-01,  1.0765e-01, -5.6080e-01,
         1.1831e-01,  2.4262e-02,  2.5551e+00,  6.0297e-01,  2.7418e-01,
        -3.9191e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  1.0000e+00]), tensor([856]), tensor(-0.3402))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]
INFO:main_restricted.py:Testing data year: 2019
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 17402
            device: cpu
            
2024-07-30 22:11:01,072	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-30 22:11:01,121	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-30 22:11:01,168	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_14c409843300b763.zip' (1.47MiB) to Ray cluster...
2024-07-30 22:11:01,177	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_14c409843300b763.zip'.
2024-07-30 22:11:03,601	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-30 23:12:39,746	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_22-11-03' in 0.2821s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 2, 'num_embeddings': 17402, 'embedding_dim': 5, 'dropout_rate': 0.02, 'lr': 0.0005456725485601479, 'weight_decay': 2.091498132903563e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.0823725515014919
INFO:model_data_nn.py:Best trial testing loss: 0.10101808969361278
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-07-30_22-10-57_363907_592478/artifacts/2024-07-30_22-11-03/train_fnn_2024-07-30_22-11-03/driver_artifacts/train_fnn_48bed_00005_5_dropout_rate=0.0200,embedding_dim=5,hidden_dim=85,lr=0.0005,num_layers=2,weight_decay=0.0000_2024-07-30_22-11-03
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 2, 'num_embeddings': 17639, 'embedding_dim': 5, 'dropout_rate': 0.02, 'lr': 0.0005456725485601479, 'weight_decay': 2.091498132903563e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.09903163304684506, 'avg_test_loss': 0.3245533491449001}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.0945648967341718, 'avg_test_loss': 0.3570346046740619}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.09218647721271352, 'avg_test_loss': 0.3187224565503689}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.09044897728050834, 'avg_test_loss': 0.3071126341909313}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.08919054139141348, 'avg_test_loss': 0.4241582359939527}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.08840021389966926, 'avg_test_loss': 0.2760798353433179}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.08791857633439136, 'avg_test_loss': 0.29992639214301914}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.0874692194575494, 'avg_test_loss': 0.2850254148674699}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.0870608487224302, 'avg_test_loss': 0.2847936506329391}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.08685879290723277, 'avg_test_loss': 0.2831960047344462}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.08662573782813651, 'avg_test_loss': 0.288121586629691}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.08622486855825615, 'avg_test_loss': 0.2971536718452206}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.08613082177773082, 'avg_test_loss': 0.2832856891909614}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.085966755838878, 'avg_test_loss': 0.2894744103541598}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.08568104040351285, 'avg_test_loss': 0.31097037320096904}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.08558459310248166, 'avg_test_loss': 0.3214834264228837}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.08543117746273579, 'avg_test_loss': 0.28659286880149293}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.08554399815558804, 'avg_test_loss': 0.2871295088776745}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.08531315499566003, 'avg_test_loss': 0.33828957995865494}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.0851817195929933, 'avg_test_loss': 0.28464465238189757}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.08516528932892314, 'avg_test_loss': 0.29631002149723756}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.08504988791780833, 'avg_test_loss': 0.4110782243615876}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.08480901781806591, 'avg_test_loss': 0.30707606052657443}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.08480350132293835, 'avg_test_loss': 0.2904860683573553}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.08479075598195741, 'avg_test_loss': 0.28861473083424455}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.08457769724970779, 'avg_test_loss': 0.33392222062684596}
INFO:model_data_nn.py:Early stopping at epoch 26
INFO:main_restricted.py:Making prediction for data in year: 2020
INFO:main_restricted.py:Prediction data shape: (13301,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2020: 0.5779641570380667
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  13301.000000  13301.000000
mean       0.115792      0.221670
std        0.562998      0.400618
min       -0.955222     -0.442351
25%       -0.158517      0.005893
50%        0.046018      0.088115
75%        0.288242      0.217691
max       18.046271      3.516881

 Configuration for experiment     train_fnn_2024-07-28_16-25-48   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_16-25-48
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-28_16-25-43_414387_592478/artifacts/2024-07-28_16-25-48/train_fnn_2024-07-28_16-25-48/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-28_16-58-59   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_16-58-59
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-28_16-58-54_281711_592478/artifacts/2024-07-28_16-58-59/train_fnn_2024-07-28_16-58-59/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-28_17-57-38   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_17-57-38
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-28_17-57-33_011767_592478/artifacts/2024-07-28_17-57-38/train_fnn_2024-07-28_17-57-38/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-28_19-04-33   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_19-04-33
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-28_19-04-29_096764_592478/artifacts/2024-07-28_19-04-33/train_fnn_2024-07-28_19-04-33/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-28_20-29-45   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_20-29-45
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-28_20-29-40_619346_592478/artifacts/2024-07-28_20-29-45/train_fnn_2024-07-28_20-29-45/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-28_21-52-59   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_21-52-59
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-28_21-52-54_616695_592478/artifacts/2024-07-28_21-52-59/train_fnn_2024-07-28_21-52-59/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-28_22-55-54   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_22-55-54
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-28_22-55-48_629691_592478/artifacts/2024-07-28_22-55-54/train_fnn_2024-07-28_22-55-54/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-29_00-46-10   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_00-46-10
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-29_00-46-05_552453_592478/artifacts/2024-07-29_00-46-10/train_fnn_2024-07-29_00-46-10/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-29_02-23-40   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_02-23-40
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-29_02-23-34_671161_592478/artifacts/2024-07-29_02-23-40/train_fnn_2024-07-29_02-23-40/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-29_04-13-46   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_04-13-46
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-29_04-13-42_255409_592478/artifacts/2024-07-29_04-13-46/train_fnn_2024-07-29_04-13-46/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-29_06-44-45   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_06-44-45
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-29_06-44-40_471988_592478/artifacts/2024-07-29_06-44-45/train_fnn_2024-07-29_06-44-45/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-29_08-16-23   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_08-16-23
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-29_08-16-18_989366_592478/artifacts/2024-07-29_08-16-23/train_fnn_2024-07-29_08-16-23/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-29_10-13-42   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_10-13-42
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-29_10-13-37_102683_592478/artifacts/2024-07-29_10-13-42/train_fnn_2024-07-29_10-13-42/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-29_12-42-55   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_12-42-55
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-29_12-42-49_360834_592478/artifacts/2024-07-29_12-42-55/train_fnn_2024-07-29_12-42-55/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-29_14-37-16   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_14-37-16
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-29_14-37-10_607286_592478/artifacts/2024-07-29_14-37-16/train_fnn_2024-07-29_14-37-16/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-29_16-51-07   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_16-51-07
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-29_16-51-01_615620_592478/artifacts/2024-07-29_16-51-07/train_fnn_2024-07-29_16-51-07/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-29_19-35-56   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_19-35-56
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-29_19-35-50_320495_592478/artifacts/2024-07-29_19-35-56/train_fnn_2024-07-29_19-35-56/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-29_21-14-41   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_21-14-41
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-29_21-14-35_314253_592478/artifacts/2024-07-29_21-14-41/train_fnn_2024-07-29_21-14-41/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-29_23-47-48   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_23-47-48
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-29_23-47-43_007638_592478/artifacts/2024-07-29_23-47-48/train_fnn_2024-07-29_23-47-48/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-30_02-03-19   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_02-03-19
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-30_02-03-14_815888_592478/artifacts/2024-07-30_02-03-19/train_fnn_2024-07-30_02-03-19/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-30_05-14-27   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_05-14-27
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-30_05-14-22_646965_592478/artifacts/2024-07-30_05-14-27/train_fnn_2024-07-30_05-14-27/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-30_07-46-12   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_07-46-12
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-30_07-46-07_921469_592478/artifacts/2024-07-30_07-46-12/train_fnn_2024-07-30_07-46-12/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-30_10-40-58   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_10-40-58
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-30_10-40-53_190717_592478/artifacts/2024-07-30_10-40-58/train_fnn_2024-07-30_10-40-58/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-30_14-00-11   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_14-00-11
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-30_13-59-44_791978_592478/artifacts/2024-07-30_14-00-11/train_fnn_2024-07-30_14-00-11/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-30_16-22-08   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_16-22-08
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-30_16-22-03_258096_592478/artifacts/2024-07-30_16-22-08/train_fnn_2024-07-30_16-22-08/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-30_19-19-06   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_19-19-06
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-30_19-19-01_343881_592478/artifacts/2024-07-30_19-19-06/train_fnn_2024-07-30_19-19-06/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-30_22-11-03   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_22-11-03
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-30_22-10-57_363907_592478/artifacts/2024-07-30_22-11-03/train_fnn_2024-07-30_22-11-03/driver_artifacts`

INFO:postprocess_predictions.py:Post processing prediction files
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1985.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1986.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1987.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1988.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1989.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1990.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1991.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1992.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1993.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1994.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1995.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1996.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1997.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1998.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1999.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2000.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2001.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2002.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2003.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2004.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2005.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2006.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2007.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2008.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2009.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2010.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2011.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2012.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2013.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2014.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2015.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2016.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2017.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2018.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2019.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2020.csv
INFO:postprocess_predictions.py:Sort the result by date and rank both ascendingly
INFO:postprocess_predictions.py:Saved the result file: result.csv
to the directory: kevin/output/prediction/quarterly_new_restricted
