Current working directory
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml
source kevin/venv/bin/activate
which python3
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/bin/python3
2024-08-09 23:07:52,694	PANIC scripts.py:900 -- `--address` is a required flag unless starting a head node with `--head`.
Error: `{}` is a required flag unless starting a head node with `{}`.
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
INFO:preprocess_data_nn.py:

Loading and preprocessing data...

DEBUG:preprocess_data_nn.py:          date   permno
626    1980-01  10006.0
5399   1980-01  10057.0
11398  1980-01  10137.0
12828  1980-01  10145.0
13984  1980-01  10153.0
DEBUG:preprocess_data_nn.py:--------------------------------------------------
INFO:main_restricted.py:preprocessed df: (667724, 161)
INFO:preprocess_data_nn.py:

Applying secondary data preprocessing..

INFO:main_restricted.py:secondary preprocessed df: (667724, 161)
INFO:main_restricted.py:df sample:     permno       pdate        ym  gvkey  sic2    absacc       acc  ...      roea   roavola       ret        mve_m      retq  pyear     date
0  10006.0  1980-01-01  198001.0   1010    37  0.083420  0.083420  ...  0.141715  0.004512  0.211679   303420.750 -0.055806   1980  1980-01
1  10057.0  1980-01-01  198001.0   1098    36  0.088951  0.088951  ...  0.174252  0.035698  0.282297   111423.125 -0.069431   1980  1980-01
2  10137.0  1980-01-01  198001.0   1279    49  0.041008  0.041008  ...  0.097554  0.006254 -0.032258   617349.500 -0.108065   1980  1980-01
3  10145.0  1980-01-01  198001.0   1300    99  0.050486  0.050486  ...  0.122729  0.004320  0.150127  1415193.000 -0.085950   1980  1980-01
4  10153.0  1980-01-01  198001.0   1308    13       NaN       NaN  ...  0.109950  0.009149 -0.122744   429488.500 -0.285199   1980  1980-01

[5 rows x 161 columns]
INFO:main_restricted.py:Train year start: 1980
INFO:main_restricted.py:Prediction data years: [1989, 1994, 1996, 2000, 2009, 2013]
INFO:main_restricted.py:

Loop through all the prediction years and build optimized model for each year

INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:transform_data_nn.py:Train_data: (95838, 161)

INFO:transform_data_nn.py:Test data years: [1988]
INFO:transform_data_nn.py:Test_data: (16210, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:transform_data_nn.py:Retrain_data: (112048, 161)

INFO:transform_data_nn.py:Prediction data years: [1989]
INFO:transform_data_nn.py:Prediction_data: (16366, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([95838, 138])
            y_train_tf: torch.Size([95838])

            x_test_tf: torch.Size([16210, 138])
            y_test_tf: torch.Size([16210])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([112048, 138])
            y_retrain_tf: torch.Size([112048])

            x_prediction_tf: torch.Size([16366, 138])
            y_prediction_tf: torch.Size([16366])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:main_restricted.py:Testing data year: 1988
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 120
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 5713
            device: cpu
            
2024-08-09 23:19:45,017	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-09 23:19:45,082	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-09 23:19:45,129	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_62a4ebda47f93b6a.zip' (5.12MiB) to Ray cluster...
2024-08-09 23:19:45,142	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_62a4ebda47f93b6a.zip'.
2024-08-09 23:19:46,635	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-09 23:48:44,837	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-09_23-19-46' in 0.2718s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 1, 'num_embeddings': 5713, 'embedding_dim': 9, 'dropout_rate': 0.37, 'lr': 1.0043309030895263e-05, 'weight_decay': 0.0003129118617308242, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}
INFO:model_data_nn.py:Best trial training loss: 0.052570549351558034
INFO:model_data_nn.py:Best trial testing loss: 0.06061161072287319
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-09_23-19-41_388787_1251391/artifacts/2024-08-09_23-19-46/train_fnn_2024-08-09_23-19-46/driver_artifacts/train_fnn_8a5e9_00000_0_batch_size=16,dropout_rate=0.3700,embedding_dim=9,hidden_dim=5,lr=0.0000,num_layers=1,weight_decay=0.0003_2024-08-09_23-19-46
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 1, 'num_embeddings': 6323, 'embedding_dim': 9, 'dropout_rate': 0.37, 'lr': 1.0043309030895263e-05, 'weight_decay': 0.0003129118617308242, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/cuda/__init__.py:619: UserWarning: Can't initialize NVML
  warnings.warn("Can't initialize NVML")
INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.05937074553543298, 'avg_test_loss': 0.06311345189165248}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.05877349462367325, 'avg_test_loss': 0.06290962456867558}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.05852246847580605, 'avg_test_loss': 0.06277323248117929}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.05817668073021081, 'avg_test_loss': 0.06268858305430759}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.05785751907957108, 'avg_test_loss': 0.06258096874924604}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.05757640825014539, 'avg_test_loss': 0.06258487282093261}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.057358894513447306, 'avg_test_loss': 0.0624954251022618}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.05701500929742583, 'avg_test_loss': 0.06250328774894437}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.056772730236107814, 'avg_test_loss': 0.06254655440025694}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.056556705433522106, 'avg_test_loss': 0.06245551225597281}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.05633831596947269, 'avg_test_loss': 0.06247940649121876}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.056197983278199665, 'avg_test_loss': 0.06267292635926826}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.05600606438694659, 'avg_test_loss': 0.06295652829045985}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.055779596657117056, 'avg_test_loss': 0.06271977754030286}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.05558957440771166, 'avg_test_loss': 0.06253031549068534}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.05542381832810465, 'avg_test_loss': 0.062414513783891734}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.05528035348464257, 'avg_test_loss': 0.06288046613044286}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.05519077074979318, 'avg_test_loss': 0.06307293338048384}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.05503145325669598, 'avg_test_loss': 0.0626534466760985}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.05479254543208895, 'avg_test_loss': 0.06328720075259475}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.05473585438849565, 'avg_test_loss': 0.06302649192288991}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.05465093230599636, 'avg_test_loss': 0.06267407353815393}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.054543715854062744, 'avg_test_loss': 0.0634439226653234}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.05443002036772004, 'avg_test_loss': 0.06340864263174514}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.05441880527289041, 'avg_test_loss': 0.06295057590085856}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.054248747144077424, 'avg_test_loss': 0.06382885002617597}
INFO:model_data_nn.py:Early stopping at epoch 26
INFO:main_restricted.py:Making prediction for data in year: 1989
INFO:main_restricted.py:Prediction data shape: (16366,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:332: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1989: 0.252641535821333
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  16366.000000  16366.000000
mean       0.032052     -0.020360
std        0.251212      0.042180
min       -0.945313     -0.422758
25%       -0.090909     -0.046155
50%        0.016642     -0.016956
75%        0.132440      0.009623
max        3.923078      0.144950
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Train_data: (177144, 161)

INFO:transform_data_nn.py:Test data years: [1993]
INFO:transform_data_nn.py:Test_data: (17602, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:transform_data_nn.py:Retrain_data: (194746, 161)

INFO:transform_data_nn.py:Prediction data years: [1994]
INFO:transform_data_nn.py:Prediction_data: (19550, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([177144, 138])
            y_train_tf: torch.Size([177144])

            x_test_tf: torch.Size([17602, 138])
            y_test_tf: torch.Size([17602])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([194746, 138])
            y_retrain_tf: torch.Size([194746])

            x_prediction_tf: torch.Size([19550, 138])
            y_prediction_tf: torch.Size([19550])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:main_restricted.py:Testing data year: 1993
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 120
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 7594
            device: cpu
            
2024-08-10 00:14:37,354	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-10 00:14:37,404	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-10 00:14:37,460	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_62a4ebda47f93b6a.zip' (5.12MiB) to Ray cluster...
2024-08-10 00:14:37,476	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_62a4ebda47f93b6a.zip'.
2024-08-10 00:14:38,983	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-10 00:46:51,158	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-10_00-14-38' in 0.3063s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 7594, 'embedding_dim': 6, 'dropout_rate': 0.12, 'lr': 4.613102542120652e-06, 'weight_decay': 0.00025873088495514637, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.07907642387072433
INFO:model_data_nn.py:Best trial testing loss: 0.09214474069471801
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-10_00-14-34_816970_1251391/artifacts/2024-08-10_00-14-38/train_fnn_2024-08-10_00-14-38/driver_artifacts/train_fnn_34c9f_00110_110_batch_size=32,dropout_rate=0.1200,embedding_dim=6,hidden_dim=5,lr=0.0000,num_layers=4,weight_decay=0.000_2024-08-10_00-14-39
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 8208, 'embedding_dim': 6, 'dropout_rate': 0.12, 'lr': 4.613102542120652e-06, 'weight_decay': 0.00025873088495514637, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.08179313198784971, 'avg_test_loss': 0.06159182068237916}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.08111069796785969, 'avg_test_loss': 0.062172927347251175}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.08101034003417808, 'avg_test_loss': 0.0624149780424766}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.08093976311786628, 'avg_test_loss': 0.06249120531667713}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.08095989080701535, 'avg_test_loss': 0.06256586236653638}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.08095947416084485, 'avg_test_loss': 0.0626374739107909}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.08093984357648412, 'avg_test_loss': 0.0626567212937921}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.08092688291701707, 'avg_test_loss': 0.06272591281843824}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.08090831060559414, 'avg_test_loss': 0.06273966144279572}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.08090278754973494, 'avg_test_loss': 0.06276926687124464}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.08092492839922989, 'avg_test_loss': 0.06266517217732881}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main_restricted.py:Making prediction for data in year: 1994
INFO:main_restricted.py:Prediction data shape: (19550,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:332: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1994: 0.25030783166968607
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  19550.000000  19550.000000
mean      -0.009021      0.033571
std        0.246687      0.003755
min       -0.941176      0.026761
25%       -0.125000      0.030637
50%       -0.014632      0.032986
75%        0.082227      0.036001
max        6.294121      0.154468
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:transform_data_nn.py:Train_data: (214296, 161)

INFO:transform_data_nn.py:Test data years: [1995]
INFO:transform_data_nn.py:Test_data: (22259, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:transform_data_nn.py:Retrain_data: (236555, 161)

INFO:transform_data_nn.py:Prediction data years: [1996]
INFO:transform_data_nn.py:Prediction_data: (22619, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([214296, 138])
            y_train_tf: torch.Size([214296])

            x_test_tf: torch.Size([22259, 138])
            y_test_tf: torch.Size([22259])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([236555, 138])
            y_retrain_tf: torch.Size([236555])

            x_prediction_tf: torch.Size([22619, 138])
            y_prediction_tf: torch.Size([22619])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:main_restricted.py:Testing data year: 1995
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 120
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 9180
            device: cpu
            
2024-08-10 01:15:11,368	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-10 01:15:11,416	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-10 01:15:11,460	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_62a4ebda47f93b6a.zip' (5.12MiB) to Ray cluster...
2024-08-10 01:15:11,472	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_62a4ebda47f93b6a.zip'.
2024-08-10 01:15:13,050	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-10 01:38:03,454	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-10_01-15-13' in 0.2359s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 9180, 'embedding_dim': 10, 'dropout_rate': 0.21, 'lr': 2.7347759385224912e-06, 'weight_decay': 0.0007988926756757106, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}
INFO:model_data_nn.py:Best trial training loss: 0.07834363667786193
INFO:model_data_nn.py:Best trial testing loss: 0.08417247734621339
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-10_01-15-08_849750_1251391/artifacts/2024-08-10_01-15-13/train_fnn_2024-08-10_01-15-13/driver_artifacts/train_fnn_aadc8_00069_69_batch_size=256,dropout_rate=0.2100,embedding_dim=10,hidden_dim=25,lr=0.0000,num_layers=1,weight_decay=0.0_2024-08-10_01-15-13
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 10061, 'embedding_dim': 10, 'dropout_rate': 0.21, 'lr': 2.7347759385224912e-06, 'weight_decay': 0.0007988926756757106, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.08166233799722675, 'avg_test_loss': 0.0855195593884152}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.08097096458399966, 'avg_test_loss': 0.0852161788203743}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.08066999990073763, 'avg_test_loss': 0.08497282864756128}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.08038391690556106, 'avg_test_loss': 0.08484376000052088}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.08019223006934056, 'avg_test_loss': 0.08470364115881117}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.08004303861538441, 'avg_test_loss': 0.08460192828114783}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.07988970365488168, 'avg_test_loss': 0.08446570975559481}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.0797877400766784, 'avg_test_loss': 0.0844030220145255}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.07966556119857542, 'avg_test_loss': 0.08430282440915536}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.07958132057607949, 'avg_test_loss': 0.08425202275092682}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.07948252582898388, 'avg_test_loss': 0.0841848948405365}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.07938889637428187, 'avg_test_loss': 0.08412494299033385}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.07935175460509279, 'avg_test_loss': 0.08406965618722895}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.0792580848656498, 'avg_test_loss': 0.08404623082933131}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.07921512667654139, 'avg_test_loss': 0.08400063942908571}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.07912569406373805, 'avg_test_loss': 0.08396601635083724}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.07908791915243452, 'avg_test_loss': 0.08393205794390668}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.07904059678170976, 'avg_test_loss': 0.08390321097012317}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.07901180933483622, 'avg_test_loss': 0.0838771624009261}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.07893943198799312, 'avg_test_loss': 0.08383662186646729}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.07885744633935231, 'avg_test_loss': 0.0838103395248397}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.07880290323118498, 'avg_test_loss': 0.08379828831536716}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.07877093750693194, 'avg_test_loss': 0.08374270754918624}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.07875645844854447, 'avg_test_loss': 0.08372539076744841}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.07870747711009536, 'avg_test_loss': 0.08370907539815715}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.07863135797523962, 'avg_test_loss': 0.08366301425554779}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.0785668296900727, 'avg_test_loss': 0.08365751478528038}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.07851644035315875, 'avg_test_loss': 0.08362193445392539}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.07846670234938721, 'avg_test_loss': 0.08359849494829606}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.07844125881823369, 'avg_test_loss': 0.08357336995809266}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.07835917361483817, 'avg_test_loss': 0.08357226086801357}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.07832713473539848, 'avg_test_loss': 0.08355079938688975}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.07824367616583645, 'avg_test_loss': 0.083554466809617}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.07816812508130744, 'avg_test_loss': 0.08350248488315036}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.07815178232549717, 'avg_test_loss': 0.08349387153062258}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.07807823394735654, 'avg_test_loss': 0.0834849714353848}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.0780434300921438, 'avg_test_loss': 0.08344438900187444}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.07798156884067502, 'avg_test_loss': 0.08343578969243537}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.07792650407897833, 'avg_test_loss': 0.08340409259950177}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.07782026683887491, 'avg_test_loss': 0.08342672599835342}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.07780362977303597, 'avg_test_loss': 0.08336656119967445}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.07779587510150748, 'avg_test_loss': 0.08339765743258294}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.07770685752797307, 'avg_test_loss': 0.08337748289275705}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.07763966037065306, 'avg_test_loss': 0.08336177087399398}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.07761908566490525, 'avg_test_loss': 0.08338537161353599}
INFO:model_data_nn.py:Epoch 46/50, metrics: {'avg_train_loss': 0.0775297058633331, 'avg_test_loss': 0.08336344545476893}
INFO:model_data_nn.py:Epoch 47/50, metrics: {'avg_train_loss': 0.07749645669593827, 'avg_test_loss': 0.08336490771492545}
INFO:model_data_nn.py:Epoch 48/50, metrics: {'avg_train_loss': 0.07751165246550655, 'avg_test_loss': 0.08338273193143057}
INFO:model_data_nn.py:Epoch 49/50, metrics: {'avg_train_loss': 0.07737768424908707, 'avg_test_loss': 0.08339114392992486}
INFO:model_data_nn.py:Epoch 50/50, metrics: {'avg_train_loss': 0.07735766326097442, 'avg_test_loss': 0.08341341158061215}
INFO:main_restricted.py:Making prediction for data in year: 1996
INFO:main_restricted.py:Prediction data shape: (22619,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:332: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1996: 0.28887507338561763
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  22619.000000  22619.000000
mean       0.044741      0.015530
std        0.289333      0.036194
min       -0.961538     -0.165687
25%       -0.085714     -0.003799
50%        0.018182      0.013017
75%        0.140416      0.030370
max       10.111111      0.704549
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Train_data: (307585, 161)

INFO:transform_data_nn.py:Test data years: [1999]
INFO:transform_data_nn.py:Test_data: (23257, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:transform_data_nn.py:Retrain_data: (330842, 161)

INFO:transform_data_nn.py:Prediction data years: [2000]
INFO:transform_data_nn.py:Prediction_data: (22167, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([307585, 138])
            y_train_tf: torch.Size([307585])

            x_test_tf: torch.Size([23257, 138])
            y_test_tf: torch.Size([23257])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([330842, 138])
            y_retrain_tf: torch.Size([330842])

            x_prediction_tf: torch.Size([22167, 138])
            y_prediction_tf: torch.Size([22167])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:main_restricted.py:Testing data year: 1999
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 120
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 12245
            device: cpu
            
2024-08-10 02:18:22,786	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-10 02:18:22,837	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-10 02:18:22,879	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_62a4ebda47f93b6a.zip' (5.12MiB) to Ray cluster...
2024-08-10 02:18:22,894	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_62a4ebda47f93b6a.zip'.
2024-08-10 02:18:24,708	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
[36m(train_fnn pid=3611019)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3611019)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3617512)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3617512)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3610563)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3610563)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3610554)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3610554)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3614126)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3614126)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3610065)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3610065)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3638242)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3638242)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3611050)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3611050)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3643122)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3643122)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3663974)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3663974)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3655820)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3655820)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3676901)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3676901)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3665136)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3665136)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3666380)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3666380)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3683567)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3683567)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3666543)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3666543)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3686193)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3686193)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3704358)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3704358)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3683937)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3683937)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3703911)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3703911)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3708618)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3708618)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3732021)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3732021)[0m   return F.mse_loss(input, target, reduction=self.reduction)
2024-08-10 02:49:31,225	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-10_02-18-24' in 0.2371s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 115, 'num_layers': 5, 'num_embeddings': 12245, 'embedding_dim': 6, 'dropout_rate': 0.52, 'lr': 0.0017942686936704433, 'weight_decay': 0.0004868577235877005, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}
INFO:model_data_nn.py:Best trial training loss: 0.08603421261298551
INFO:model_data_nn.py:Best trial testing loss: 0.25710109677908755
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-10_02-18-20_274306_1251391/artifacts/2024-08-10_02-18-24/train_fnn_2024-08-10_02-18-24/driver_artifacts/train_fnn_7edd9_00022_22_batch_size=16,dropout_rate=0.5200,embedding_dim=6,hidden_dim=115,lr=0.0018,num_layers=5,weight_decay=0.00_2024-08-10_02-18-25
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 115, 'num_layers': 5, 'num_embeddings': 12852, 'embedding_dim': 6, 'dropout_rate': 0.52, 'lr': 0.0017942686936704433, 'weight_decay': 0.0004868577235877005, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.09842637647884697, 'avg_test_loss': 0.2092849998808806}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.0981073661297194, 'avg_test_loss': 0.20590746071872343}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.0981102783277113, 'avg_test_loss': 0.2062134226195482}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.0980961047498812, 'avg_test_loss': 0.20630629431700917}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.09810191318958475, 'avg_test_loss': 0.20685570867070968}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.0981068539494843, 'avg_test_loss': 0.2069275110004494}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.09810297469697532, 'avg_test_loss': 0.20633575385557368}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.09809994297625026, 'avg_test_loss': 0.20709649729307253}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.09810298198148801, 'avg_test_loss': 0.20799475279199914}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.09810410579405254, 'avg_test_loss': 0.20639874923350707}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.0980896782447095, 'avg_test_loss': 0.2075937696380479}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.09811175423666854, 'avg_test_loss': 0.20662207888307596}
INFO:model_data_nn.py:Early stopping at epoch 12
INFO:main_restricted.py:Making prediction for data in year: 2000
INFO:main_restricted.py:Prediction data shape: (22167,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:332: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2000: 0.4546170578076898
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  22167.000000  22167.000000
mean      -0.000670      0.032491
std        0.453416      0.000000
min       -0.980000      0.032491
25%       -0.222436      0.032491
50%       -0.022528      0.032491
75%        0.141851      0.032491
max       10.941179      0.032491
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:transform_data_nn.py:Train_data: (483505, 161)

INFO:transform_data_nn.py:Test data years: [2008]
INFO:transform_data_nn.py:Test_data: (16465, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:transform_data_nn.py:Retrain_data: (499970, 161)

INFO:transform_data_nn.py:Prediction data years: [2009]
INFO:transform_data_nn.py:Prediction_data: (16061, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([483505, 138])
            y_train_tf: torch.Size([483505])

            x_test_tf: torch.Size([16465, 138])
            y_test_tf: torch.Size([16465])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([499970, 138])
            y_retrain_tf: torch.Size([499970])

            x_prediction_tf: torch.Size([16061, 138])
            y_prediction_tf: torch.Size([16061])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:main_restricted.py:Testing data year: 2008
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 120
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15361
            device: cpu
            
2024-08-10 04:01:48,390	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-10 04:01:48,433	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-10 04:01:48,481	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_62a4ebda47f93b6a.zip' (5.12MiB) to Ray cluster...
2024-08-10 04:01:48,492	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_62a4ebda47f93b6a.zip'.
2024-08-10 04:01:50,181	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
[36m(train_fnn pid=663980)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=663980)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=664730)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=664730)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=664985)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=664985)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=665057)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=665057)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=663884)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=663884)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=664955)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=664955)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=663816)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=663816)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=663848)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=663848)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=670124)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=670124)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=699253)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=699253)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=705645)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=705645)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=665053)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=665053)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=665054)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=665054)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=712496)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=712496)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=687344)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=687344)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=664986)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=664986)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=714153)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=714153)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=713490)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=713490)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=713912)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=713912)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=732167)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=732167)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=721040)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=721040)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=732482)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=732482)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=732793)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=732793)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=731869)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=731869)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=750887)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=750887)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=769718)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=769718)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=717512)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=717512)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=750886)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=750886)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=766691)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=766691)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=751605)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=751605)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=759932)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=759932)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=752504)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=752504)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=796251)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=796251)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=814439)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=814439)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=831655)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=831655)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=837749)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=837749)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=840425)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=840425)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=841396)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=841396)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=859514)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=859514)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=859340)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=859340)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=843336)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=843336)[0m   return F.mse_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=858973)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=858973)[0m   return F.mse_loss(input, target, reduction=self.reduction)
2024-08-10 05:59:01,644	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-10_04-01-50' in 0.3623s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 95, 'num_layers': 5, 'num_embeddings': 15361, 'embedding_dim': 9, 'dropout_rate': 0.33, 'lr': 1.1292231193397087e-06, 'weight_decay': 0.000982406230070545, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}
INFO:model_data_nn.py:Best trial training loss: 0.10767207438149884
INFO:model_data_nn.py:Best trial testing loss: 0.12316452780595193
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-10_04-01-45_797087_1251391/artifacts/2024-08-10_04-01-50/train_fnn_2024-08-10_04-01-50/driver_artifacts/train_fnn_f19db_00074_74_batch_size=256,dropout_rate=0.3300,embedding_dim=9,hidden_dim=95,lr=0.0000,num_layers=5,weight_decay=0.00_2024-08-10_04-01-50
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 95, 'num_layers': 5, 'num_embeddings': 15661, 'embedding_dim': 9, 'dropout_rate': 0.33, 'lr': 1.1292231193397087e-06, 'weight_decay': 0.000982406230070545, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.11136395689452909, 'avg_test_loss': 0.2778805239155652}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.11012594798399557, 'avg_test_loss': 0.27634906792451464}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10984263361965273, 'avg_test_loss': 0.27603389349366936}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10943163172196438, 'avg_test_loss': 0.27595371291750953}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10913538273578416, 'avg_test_loss': 0.2756624096442783}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10883029645496738, 'avg_test_loss': 0.2758334046673207}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10858991144905014, 'avg_test_loss': 0.2756238377815674}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.108443848512155, 'avg_test_loss': 0.2756532041858586}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10832151648132116, 'avg_test_loss': 0.27563848275513875}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.1081129349100547, 'avg_test_loss': 0.2755657050699469}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10794025317742406, 'avg_test_loss': 0.2754248808182421}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10784265769219252, 'avg_test_loss': 0.27549929958250785}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10776198890367289, 'avg_test_loss': 0.2753588809735245}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10764464668269592, 'avg_test_loss': 0.2754602282352391}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10754569630385116, 'avg_test_loss': 0.27533384909232456}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.10744741084259166, 'avg_test_loss': 0.2752759691386942}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.10740464894483472, 'avg_test_loss': 0.27526289679937893}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.10733648689813756, 'avg_test_loss': 0.27530336793926025}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.10729324840928614, 'avg_test_loss': 0.27502905524202753}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.10724100805113271, 'avg_test_loss': 0.27512655924591756}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.10717401858009074, 'avg_test_loss': 0.2751309429369276}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.10715040295011437, 'avg_test_loss': 0.27522012821975206}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.1071233425997064, 'avg_test_loss': 0.27519850832011017}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.10706051043246687, 'avg_test_loss': 0.275189554703141}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.10705299562351617, 'avg_test_loss': 0.2750498501968289}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.1070797821355214, 'avg_test_loss': 0.27511616080762846}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.10700142991867849, 'avg_test_loss': 0.27517240926150294}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.10697534488284216, 'avg_test_loss': 0.275012707781224}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.10695853823852185, 'avg_test_loss': 0.27509807514411116}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.10694136489249473, 'avg_test_loss': 0.27497664700070074}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.10689147083204158, 'avg_test_loss': 0.2750498398488003}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.10686253789283957, 'avg_test_loss': 0.2751389793933384}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.1068770819182922, 'avg_test_loss': 0.2750349485625823}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.10686790235092625, 'avg_test_loss': 0.27499291696955286}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.1068508276840814, 'avg_test_loss': 0.2749667147558833}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.10683308553219574, 'avg_test_loss': 0.2750010004355794}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.10680380344001746, 'avg_test_loss': 0.27497792051779846}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.10681780875568443, 'avg_test_loss': 0.275005755827777}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.10677898372106227, 'avg_test_loss': 0.27490810500014395}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.10677834540315609, 'avg_test_loss': 0.2748298191184562}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.10677468896301294, 'avg_test_loss': 0.27486575737832086}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.10673938259955436, 'avg_test_loss': 0.27485425767326166}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.10678137442849565, 'avg_test_loss': 0.2748179060540029}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.1067571743075291, 'avg_test_loss': 0.27483816335480366}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.10672722325965006, 'avg_test_loss': 0.27478267645670307}
INFO:model_data_nn.py:Epoch 46/50, metrics: {'avg_train_loss': 0.10672850612716923, 'avg_test_loss': 0.27481987986654516}
INFO:model_data_nn.py:Epoch 47/50, metrics: {'avg_train_loss': 0.1067083400282656, 'avg_test_loss': 0.274812337572849}
INFO:model_data_nn.py:Epoch 48/50, metrics: {'avg_train_loss': 0.10673637833699957, 'avg_test_loss': 0.274706212862853}
INFO:model_data_nn.py:Epoch 49/50, metrics: {'avg_train_loss': 0.10670771637308676, 'avg_test_loss': 0.274666569594826}
INFO:model_data_nn.py:Epoch 50/50, metrics: {'avg_train_loss': 0.10669641513177143, 'avg_test_loss': 0.2746468824999673}
INFO:main_restricted.py:Making prediction for data in year: 2009
INFO:main_restricted.py:Prediction data shape: (16061,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:332: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2009: 0.5247645167184132
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  16061.000000  16061.000000
mean       0.139171      0.027582
std        0.512778      0.005093
min       -0.941129     -0.007036
25%       -0.088888      0.024543
50%        0.057852      0.027969
75%        0.252000      0.031096
max       18.331762      0.054979
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:transform_data_nn.py:Train_data: (545716, 161)

INFO:transform_data_nn.py:Test data years: [2012]
INFO:transform_data_nn.py:Test_data: (14104, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:transform_data_nn.py:Retrain_data: (559820, 161)

INFO:transform_data_nn.py:Prediction data years: [2013]
INFO:transform_data_nn.py:Prediction_data: (13650, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([545716, 138])
            y_train_tf: torch.Size([545716])

            x_test_tf: torch.Size([14104, 138])
            y_test_tf: torch.Size([14104])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([559820, 138])
            y_retrain_tf: torch.Size([559820])

            x_prediction_tf: torch.Size([13650, 138])
            y_prediction_tf: torch.Size([13650])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:main_restricted.py:Testing data year: 2012
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 120
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 16081
            device: cpu
            
2024-08-10 07:13:46,742	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-10 07:13:46,788	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-10 07:13:46,836	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_e49c7dd895132cdb.zip' (5.12MiB) to Ray cluster...
2024-08-10 07:13:46,848	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_e49c7dd895132cdb.zip'.
2024-08-10 07:13:48,694	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-10 14:20:50,995	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-10_07-13-48' in 0.2868s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 16081, 'embedding_dim': 8, 'dropout_rate': 0.45, 'lr': 1.1518378383348848e-06, 'weight_decay': 0.0005225968457642127, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 8}
INFO:model_data_nn.py:Best trial training loss: 0.10965543378971827
INFO:model_data_nn.py:Best trial testing loss: 0.07416708638861995
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-10_07-13-44_201859_1251391/artifacts/2024-08-10_07-13-48/train_fnn_2024-08-10_07-13-48/driver_artifacts/train_fnn_c32f5_00110_110_batch_size=8,dropout_rate=0.4500,embedding_dim=8,hidden_dim=5,lr=0.0000,num_layers=5,weight_decay=0.0005_2024-08-10_07-13-49
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 16225, 'embedding_dim': 8, 'dropout_rate': 0.45, 'lr': 1.1518378383348848e-06, 'weight_decay': 0.0005225968457642127, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 8}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.1095479859712186, 'avg_test_loss': 0.06066087570478436}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10902165596703163, 'avg_test_loss': 0.05955021658400265}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10887949238536615, 'avg_test_loss': 0.05904417182175649}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10882734947461797, 'avg_test_loss': 0.058693734498290254}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10879995990510553, 'avg_test_loss': 0.058509517783437125}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10878249805482677, 'avg_test_loss': 0.05835580079117653}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10877908284843742, 'avg_test_loss': 0.058218633678022116}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10876744332601236, 'avg_test_loss': 0.05814795463266016}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10876581942740297, 'avg_test_loss': 0.05806483340693237}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.10876372374832123, 'avg_test_loss': 0.058003215813574475}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10876316992907555, 'avg_test_loss': 0.057962853994272874}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10876049513032585, 'avg_test_loss': 0.05793611314892441}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10876187340758793, 'avg_test_loss': 0.05790657288533721}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10876133135201178, 'avg_test_loss': 0.057904554539775846}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10876092955664383, 'avg_test_loss': 0.05789280085858257}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.10876069989236234, 'avg_test_loss': 0.057881093709964214}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.10876032482071236, 'avg_test_loss': 0.057878832504855426}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.10876052836648432, 'avg_test_loss': 0.057874569096768906}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.1087609152931991, 'avg_test_loss': 0.05786254285798175}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.1087599865826651, 'avg_test_loss': 0.05786317787273647}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.1087586787395458, 'avg_test_loss': 0.05785974840188642}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.10875827809186618, 'avg_test_loss': 0.05786385230829707}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.10875748640260682, 'avg_test_loss': 0.057854794696430054}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.10875678792788188, 'avg_test_loss': 0.05784823651872652}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.10875464819307715, 'avg_test_loss': 0.05784429287584035}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.10875502763345342, 'avg_test_loss': 0.05784187686488285}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.10875411007766562, 'avg_test_loss': 0.05783286857021526}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.10875255973634526, 'avg_test_loss': 0.05782110708687666}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.1087400186169758, 'avg_test_loss': 0.05781381164459751}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.10874163609035511, 'avg_test_loss': 0.05780582732907548}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.10874613837352871, 'avg_test_loss': 0.057783938138571134}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.10873017617643885, 'avg_test_loss': 0.05777465761625538}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.10873214050962555, 'avg_test_loss': 0.05777431783621272}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.10873341809151882, 'avg_test_loss': 0.057750593344588215}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.1087308876566644, 'avg_test_loss': 0.05773467621699196}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.10871742474612603, 'avg_test_loss': 0.057707209808751395}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.10871973921986967, 'avg_test_loss': 0.05769916390359083}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.1087074728752872, 'avg_test_loss': 0.05767158916690368}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.10870174460819536, 'avg_test_loss': 0.05766911352436289}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.1086945381623051, 'avg_test_loss': 0.05763914620238626}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.10869520921711925, 'avg_test_loss': 0.05762275180279637}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.10868714192686485, 'avg_test_loss': 0.05760470777211245}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.10867457225925417, 'avg_test_loss': 0.05759448904917026}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.10867548914649691, 'avg_test_loss': 0.057560884792850896}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.10867662822956076, 'avg_test_loss': 0.05753721207781031}
INFO:model_data_nn.py:Epoch 46/50, metrics: {'avg_train_loss': 0.1086581831312316, 'avg_test_loss': 0.057536181675567004}
INFO:model_data_nn.py:Epoch 47/50, metrics: {'avg_train_loss': 0.10865819607372251, 'avg_test_loss': 0.05751653844030988}
INFO:model_data_nn.py:Epoch 48/50, metrics: {'avg_train_loss': 0.10863415146903177, 'avg_test_loss': 0.0575095817237202}
INFO:model_data_nn.py:Epoch 49/50, metrics: {'avg_train_loss': 0.1086273750433075, 'avg_test_loss': 0.05747079054706888}
INFO:model_data_nn.py:Epoch 50/50, metrics: {'avg_train_loss': 0.1086111027490486, 'avg_test_loss': 0.057472277088753666}
INFO:main_restricted.py:Making prediction for data in year: 2013
INFO:main_restricted.py:Prediction data shape: (13650,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:332: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2013: 0.23975058438118144
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  13650.000000  13650.000000
mean       0.095489      0.040207
std        0.233383      0.003355
min       -0.927594     -0.025555
25%       -0.012730      0.040877
50%        0.068853      0.040877
75%        0.174490      0.040877
max        3.696775      0.040879
╭──────────────────────────────────────────────────────────────────╮
│ Configuration for experiment     train_fnn_2024-08-09_23-19-46   │
├──────────────────────────────────────────────────────────────────┤
│ Search algorithm                 BasicVariantGenerator           │
│ Scheduler                        AsyncHyperBandScheduler         │
│ Number of trials                 120                             │
╰──────────────────────────────────────────────────────────────────╯

View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-09_23-19-46
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-09_23-19-41_388787_1251391/artifacts/2024-08-09_23-19-46/train_fnn_2024-08-09_23-19-46/driver_artifacts`

╭──────────────────────────────────────────────────────────────────╮
│ Configuration for experiment     train_fnn_2024-08-10_00-14-38   │
├──────────────────────────────────────────────────────────────────┤
│ Search algorithm                 BasicVariantGenerator           │
│ Scheduler                        AsyncHyperBandScheduler         │
│ Number of trials                 120                             │
╰──────────────────────────────────────────────────────────────────╯

View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-10_00-14-38
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-10_00-14-34_816970_1251391/artifacts/2024-08-10_00-14-38/train_fnn_2024-08-10_00-14-38/driver_artifacts`

╭──────────────────────────────────────────────────────────────────╮
│ Configuration for experiment     train_fnn_2024-08-10_01-15-13   │
├──────────────────────────────────────────────────────────────────┤
│ Search algorithm                 BasicVariantGenerator           │
│ Scheduler                        AsyncHyperBandScheduler         │
│ Number of trials                 120                             │
╰──────────────────────────────────────────────────────────────────╯

View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-10_01-15-13
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-10_01-15-08_849750_1251391/artifacts/2024-08-10_01-15-13/train_fnn_2024-08-10_01-15-13/driver_artifacts`

╭──────────────────────────────────────────────────────────────────╮
│ Configuration for experiment     train_fnn_2024-08-10_02-18-24   │
├──────────────────────────────────────────────────────────────────┤
│ Search algorithm                 BasicVariantGenerator           │
│ Scheduler                        AsyncHyperBandScheduler         │
│ Number of trials                 120                             │
╰──────────────────────────────────────────────────────────────────╯

View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-10_02-18-24
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-10_02-18-20_274306_1251391/artifacts/2024-08-10_02-18-24/train_fnn_2024-08-10_02-18-24/driver_artifacts`

╭──────────────────────────────────────────────────────────────────╮
│ Configuration for experiment     train_fnn_2024-08-10_04-01-50   │
├──────────────────────────────────────────────────────────────────┤
│ Search algorithm                 BasicVariantGenerator           │
│ Scheduler                        AsyncHyperBandScheduler         │
│ Number of trials                 120                             │
╰──────────────────────────────────────────────────────────────────╯

View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-10_04-01-50
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-10_04-01-45_797087_1251391/artifacts/2024-08-10_04-01-50/train_fnn_2024-08-10_04-01-50/driver_artifacts`

╭──────────────────────────────────────────────────────────────────╮
│ Configuration for experiment     train_fnn_2024-08-10_07-13-48   │
├──────────────────────────────────────────────────────────────────┤
│ Search algorithm                 BasicVariantGenerator           │
│ Scheduler                        AsyncHyperBandScheduler         │
│ Number of trials                 120                             │
╰──────────────────────────────────────────────────────────────────╯

View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-10_07-13-48
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-10_07-13-44_201859_1251391/artifacts/2024-08-10_07-13-48/train_fnn_2024-08-10_07-13-48/driver_artifacts`

INFO:postprocess_predictions.py:Post processing prediction files
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1985.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1986.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1987.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1988.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1989.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1990.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1991.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1992.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1993.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1994.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1995.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1996.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1997.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1998.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_1999.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2000.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2001.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2002.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2003.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2004.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2005.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2006.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2007.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2008.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2009.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2010.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2011.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2012.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2013.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2014.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2015.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2016.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2017.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2018.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2019.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/quarterly_new_restricted/quarterly_prediction_2020.csv
INFO:postprocess_predictions.py:Sort the result by date and rank both ascendingly
INFO:postprocess_predictions.py:Saved the result file: result.csv
to the directory: kevin/output/prediction/quarterly_new_restricted
