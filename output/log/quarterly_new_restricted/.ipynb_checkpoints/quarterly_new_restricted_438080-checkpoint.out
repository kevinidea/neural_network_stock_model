Current working directory
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml
source kevin/venv/bin/activate
which python3
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/bin/python3
2024-08-06 14:01:35,152	PANIC scripts.py:900 -- `--address` is a required flag unless starting a head node with `--head`.
Error: `{}` is a required flag unless starting a head node with `{}`.
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
INFO:preprocess_data_nn.py:

Loading and preprocessing data...

DEBUG:preprocess_data_nn.py:          date   permno
626    1980-01  10006.0
5399   1980-01  10057.0
11398  1980-01  10137.0
12828  1980-01  10145.0
13984  1980-01  10153.0
DEBUG:preprocess_data_nn.py:--------------------------------------------------
INFO:main_restricted.py:preprocessed df: (667724, 161)
INFO:preprocess_data_nn.py:

Applying secondary data preprocessing..

INFO:main_restricted.py:secondary preprocessed df: (667724, 161)
INFO:main_restricted.py:df sample:     permno       pdate        ym  gvkey  sic2    absacc       acc    aeavol  ...      roaa      roea   roavola       ret        mve_m      retq  pyear     date
0  10006.0  1980-01-01  198001.0   1010    37  0.083420  0.083420  1.001090  ...  0.048684  0.141715  0.004512  0.211679   303420.750 -0.055806   1980  1980-01
1  10057.0  1980-01-01  198001.0   1098    36  0.088951  0.088951 -0.613146  ...  0.092434  0.174252  0.035698  0.282297   111423.125 -0.069431   1980  1980-01
2  10137.0  1980-01-01  198001.0   1279    49  0.041008  0.041008 -0.491307  ...  0.034895  0.097554  0.006254 -0.032258   617349.500 -0.108065   1980  1980-01
3  10145.0  1980-01-01  198001.0   1300    99  0.050486  0.050486 -0.256932  ...  0.049028  0.122729  0.004320  0.150127  1415193.000 -0.085950   1980  1980-01
4  10153.0  1980-01-01  198001.0   1308    13       NaN       NaN  1.631801  ...  0.049860  0.109950  0.009149 -0.122744   429488.500 -0.285199   1980  1980-01

[5 rows x 161 columns]
INFO:main_restricted.py:Train year start: 1980
INFO:main_restricted.py:Prediction data years: [1989, 1994, 1996, 2000, 2009, 2013]
INFO:main_restricted.py:

Loop through all the prediction years and build optimized model for each year

INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:transform_data_nn.py:Train_data: (95838, 161)

INFO:transform_data_nn.py:Test data years: [1988]
INFO:transform_data_nn.py:Test_data: (16210, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:transform_data_nn.py:Retrain_data: (112048, 161)

INFO:transform_data_nn.py:Prediction data years: [1989]
INFO:transform_data_nn.py:Prediction_data: (16366, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([95838, 138])
            y_train_tf: torch.Size([95838])

            x_test_tf: torch.Size([16210, 138])
            y_test_tf: torch.Size([16210])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([112048, 138])
            y_retrain_tf: torch.Size([112048])

            x_prediction_tf: torch.Size([16366, 138])
            y_prediction_tf: torch.Size([16366])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.6749e-01,  1.8039e-01,  1.7439e-01, -1.2934e+00, -1.5217e-01,
        -6.2532e-01, -1.4105e-01, -3.2622e-01,  3.3397e-01, -1.7092e-01,
        -7.1138e-01, -7.9930e-02, -4.8715e-01, -2.8729e-02,  5.0620e-02,
         5.3680e-01, -1.5086e-01,  1.3707e-01,  0.0000e+00,  4.4747e-01,
        -3.6798e-01, -2.7737e-02,  1.7979e-02,  3.1756e-03, -6.1519e-02,
        -2.4363e-01, -5.7138e-01,  0.0000e+00,  3.8881e-01,  9.3932e-01,
         4.8111e-01, -1.3014e-01,  4.3260e-01,  0.0000e+00, -3.8304e-01,
        -1.9981e-01,  7.3661e-02,  3.5875e-01,  5.9394e-02, -1.1663e+00,
        -2.6389e-01,  6.3167e-02,  1.5538e-01, -6.6349e-02, -1.6337e-01,
        -6.5926e-01, -3.2849e-02, -9.8768e-03, -5.4961e-01, -2.9247e-01,
        -6.2524e-01,  6.5618e-01, -1.6367e-01, -1.3712e-03,  3.0379e-02,
         4.4666e-01, -7.6340e-01, -1.8507e-02, -2.7156e-01,  4.5804e-02,
         1.0842e-01, -3.4037e-01,  1.5983e-01,  2.9087e-01,  1.9905e-01,
        -1.1055e-01,  1.8707e-02, -6.5066e-02,  7.2838e-01, -4.1396e-01,
         0.0000e+00,  0.0000e+00,  2.9079e-03, -8.1796e-01,  1.3836e-02,
         5.9724e-01,  4.4363e-02, -3.4442e-01, -1.8141e-01, -1.1348e-02,
         0.0000e+00,  3.2837e-01,  4.7142e-02, -2.1021e-01, -5.5949e-01,
        -8.4724e-02, -6.9207e-02, -3.6622e-01, -1.4938e-01,  1.0129e-01,
        -5.1817e-01, -1.3017e+00,  9.1096e-02,  1.0397e+00,  1.5247e+00,
         1.4285e+00,  5.4615e-01,  1.1460e+00, -2.2843e+00, -6.0600e-01,
        -1.2501e+00,  1.5397e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.2503e-02,  7.6798e-02,  0.0000e+00, -1.7350e+00,
         2.3586e-02, -1.8329e+00,  1.2462e-01,  8.6240e-02,  0.0000e+00,
         0.0000e+00,  2.4629e-02, -1.7408e-01, -7.1432e-02,  3.1925e-02,
         2.0089e-01, -4.1318e-01, -3.9079e-01,  1.7856e-01,  2.3805e-01,
        -3.9978e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5416]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-6.8700e-03, -1.3906e-03, -6.2760e-01, -8.1075e-01, -6.9975e-01,
        -1.2774e-01, -1.8530e+00, -1.0250e+00, -1.8833e-02,  3.1154e-04,
        -3.5055e-01, -2.2122e-01,  5.2339e-02, -5.7797e-03,  3.0203e-02,
        -1.4377e+00, -2.2830e-01, -1.2641e-01,  0.0000e+00, -2.4754e-01,
         3.5335e-01, -2.7737e-02,  1.3908e-03,  3.7832e-02,  8.8959e-03,
        -6.3207e-01, -7.4060e-01,  0.0000e+00, -7.5916e-01,  2.7774e-02,
        -9.9067e-01, -3.3856e-01,  4.6256e-02,  0.0000e+00, -2.4031e+00,
         9.2312e-03, -6.2428e-01, -5.2958e-01, -2.9028e-01, -7.8854e-01,
         7.0285e-01, -9.9150e-01, -5.3299e-01, -1.9134e-01,  1.1251e-02,
        -1.0866e-01, -5.3210e-01, -2.8988e-01, -2.8152e-01, -6.9593e-02,
         1.1890e-01, -1.4763e+00, -4.8603e-01, -1.3712e-03, -7.4046e-01,
        -1.6129e+00, -1.0878e+00, -3.7510e-01, -5.6659e-02,  5.8481e-03,
        -2.8530e+00, -5.3244e-02, -9.0868e-02, -5.0486e+00, -4.3985e-03,
        -3.9025e-01, -8.4175e-03,  1.7970e+00, -5.7971e-01, -3.6225e-01,
         0.0000e+00,  0.0000e+00,  2.9079e-03,  1.4063e-01, -1.8985e-01,
        -2.2815e-01, -1.4983e-01,  3.2499e+00, -2.0335e-01, -1.1348e-02,
         0.0000e+00, -9.9196e-01, -3.1309e-02,  2.4329e+00,  3.8119e+00,
        -7.3119e-02, -6.3627e-02, -2.3311e-01,  6.0460e-01, -2.8651e-01,
         7.7305e-01,  5.7043e-01,  9.1096e-02, -7.2100e-01, -5.6034e-01,
        -1.0275e+00,  6.9980e-01, -1.0601e+00,  7.4176e-01, -9.7179e-01,
         5.6117e+00, -3.1374e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.0423e-02,  7.6798e-02,  0.0000e+00, -1.1967e+00,
        -1.4312e+00,  1.0112e-01, -1.5572e-02,  5.0367e+00,  0.0000e+00,
         0.0000e+00, -1.4247e+00, -2.4009e-01, -7.1432e-02,  1.6151e+00,
         5.1085e-03,  7.5954e-01, -3.9705e-01, -7.9781e-02, -1.5664e-02,
         1.0374e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3833]), tensor(0.0613))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-2.0368e-01,  1.4613e-01,  1.6670e-01, -1.2996e+00, -1.5581e-01,
        -6.3490e-01, -1.5167e-01, -3.3234e-01,  3.4130e-01, -1.6509e-01,
        -7.1113e-01, -3.0598e-02, -4.9210e-01,  1.7698e-02,  2.7621e-02,
         5.2354e-01, -1.4034e-01,  1.7132e-01,  0.0000e+00,  4.3357e-01,
        -3.6155e-01,  7.5280e-02,  1.7328e-02,  8.9085e-03, -6.4428e-02,
        -2.5203e-01, -5.6494e-01,  0.0000e+00,  4.0549e-01,  9.9060e-01,
         4.7090e-01, -1.2756e-01,  4.3668e-01,  0.0000e+00, -3.7373e-01,
        -1.9599e-01,  6.2056e-02,  3.9172e-01,  3.1288e-02, -1.1685e+00,
        -2.7627e-01,  2.4020e-01,  1.8337e-01, -6.8351e-02, -1.7270e-01,
        -6.6981e-01,  7.0629e-02, -5.5404e-02, -5.4842e-01, -2.0600e-01,
        -6.1664e-01,  6.6804e-01, -1.6028e-01,  2.4212e-03,  2.3795e-02,
         4.4623e-01, -7.5902e-01, -7.9499e-06, -2.6507e-01,  1.4397e-02,
         1.1498e-01, -3.3111e-01,  1.5373e-01,  2.8344e-01,  1.5654e-01,
        -1.1914e-01, -4.6283e-03, -7.3628e-02,  7.4786e-01, -4.1645e-01,
         0.0000e+00,  0.0000e+00, -1.9676e-01, -8.1574e-01,  3.7799e-02,
         5.7971e-01,  4.3629e-02, -3.4559e-01, -1.8308e-01, -4.2580e-03,
         0.0000e+00,  2.7307e-01,  5.3735e-02, -2.4523e-01, -5.5063e-01,
        -9.1112e-02, -7.4417e-02, -3.6511e-01, -1.3978e-01,  1.0272e-01,
        -5.1587e-01, -1.2930e+00,  3.7267e-02,  1.1955e+00,  1.6803e+00,
         1.5826e+00,  5.7628e-01,  1.3009e+00, -2.4806e+00, -4.5262e-01,
        -1.0432e+00,  1.1783e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.2399e-02,  2.5983e-01,  0.0000e+00, -1.4926e+00,
         2.5113e-01, -2.0098e+00,  1.3238e-01,  2.3763e-02,  0.0000e+00,
         0.0000e+00,  2.7788e-02, -1.7916e-01,  1.6315e-02,  6.6375e-03,
         1.8096e-01, -4.1411e-01, -3.8277e-01,  1.9860e-01,  2.4497e-01,
        -3.9885e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5993]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-1.0328e-02, -4.5945e-03, -6.1175e-01, -4.2919e-01, -2.9979e-01,
        -5.8820e-02, -1.9398e+00, -1.0548e+00, -4.8105e-02,  9.2327e-02,
        -1.9427e-02,  1.6832e-02, -3.9303e-02, -1.2090e-02,  3.2950e-02,
         3.7676e-01, -2.2029e-01, -4.9129e-01,  0.0000e+00,  5.6969e-03,
        -8.4695e-02,  7.5280e-02,  3.7865e-02,  9.6094e-01, -7.9298e-03,
        -4.5620e-03, -7.2574e-01,  0.0000e+00, -1.4182e+00,  3.7398e-02,
         4.2706e-01, -1.7737e-01,  2.7372e-01,  0.0000e+00,  1.7543e-03,
        -6.5350e-01,  7.9022e-03, -5.5227e-01, -8.4291e-01, -7.9602e-01,
         8.6959e-01,  7.0136e-02,  1.2240e-02,  2.1631e-02, -3.8938e-03,
         3.6990e-01,  6.9289e-02, -2.2570e-01, -4.2325e-01,  3.5530e-02,
         8.9260e-01, -1.3853e+00, -5.1862e-01, -2.5414e+00, -7.4346e-01,
         1.2464e-02, -1.0845e+00,  6.9339e-01,  7.3179e-03, -4.0037e-01,
        -5.0445e-03,  7.0648e-03,  7.1479e-03,  9.0722e-03, -1.6392e-02,
        -3.6987e-04, -9.4731e-03,  1.7388e+00,  1.3989e+00, -9.5058e-03,
         0.0000e+00,  0.0000e+00, -1.9676e-01,  6.6468e-01,  1.7143e-02,
        -8.8511e-02,  3.6591e-04, -1.2622e-03,  7.1653e-04, -4.2580e-03,
         0.0000e+00, -3.3035e-01, -6.4811e-02, -4.3878e-01, -5.6962e-01,
        -7.8317e-02, -6.8695e-02,  2.3996e-02, -1.0220e-04, -9.2791e-02,
        -6.5617e-01,  6.2750e-01,  3.7267e-02, -6.8854e-01,  8.3982e-02,
        -1.0567e+00, -1.3036e+00, -1.2722e-01, -6.6624e-01, -1.0806e+00,
        -9.2166e-01, -6.2909e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0426e-02,  2.5983e-01,  0.0000e+00, -1.3044e+00,
        -1.2224e+00,  4.1615e-01,  6.2709e-02,  2.3763e-02,  0.0000e+00,
         0.0000e+00,  1.2651e-02, -2.0436e-01,  1.6315e-02, -2.0294e-02,
        -8.1752e-04,  1.9352e-03, -2.3160e-02,  2.4850e-01,  1.9696e-01,
         1.4419e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3728]), tensor(0.0776))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:main_restricted.py:Testing data year: 1988
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 5713
            device: cpu
            
2024-08-06 14:14:14,254	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-06 14:14:14,315	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-06 14:14:14,362	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_1c61b63ddcb23de0.zip' (5.14MiB) to Ray cluster...
2024-08-06 14:14:14,380	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_1c61b63ddcb23de0.zip'.
2024-08-06 14:14:15,772	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-06 14:20:33,725	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-06_14-14-15' in 0.2055s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 4, 'num_embeddings': 5713, 'embedding_dim': 8, 'dropout_rate': 0.21, 'lr': 4.207988669606639e-06, 'weight_decay': 2.9375384576328334e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.055338007121541126
INFO:model_data_nn.py:Best trial testing loss: 0.06210556618986637
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-06_14-14-11_734391_2669035/artifacts/2024-08-06_14-14-15/train_fnn_2024-08-06_14-14-15/driver_artifacts/train_fnn_d6033_00000_0_dropout_rate=0.2100,embedding_dim=8,hidden_dim=65,lr=0.0000,num_layers=4,weight_decay=0.0000_2024-08-06_14-14-15
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 4, 'num_embeddings': 6323, 'embedding_dim': 8, 'dropout_rate': 0.21, 'lr': 4.207988669606639e-06, 'weight_decay': 2.9375384576328334e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.061771203368902204, 'avg_test_loss': 0.06443503615446389}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.06098820402792522, 'avg_test_loss': 0.06390455417567864}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.06035659925852503, 'avg_test_loss': 0.06356652709655464}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.060016715407371524, 'avg_test_loss': 0.06343036846374162}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.05995964956070696, 'avg_test_loss': 0.06335699699411634}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.059645406695348874, 'avg_test_loss': 0.06325503198604565}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.059593019181064195, 'avg_test_loss': 0.0631974708812777}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.05935586426087788, 'avg_test_loss': 0.06314265326363966}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.05922018826433591, 'avg_test_loss': 0.06311715573247056}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.05928910406359605, 'avg_test_loss': 0.06309676497767214}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.059090473307030544, 'avg_test_loss': 0.06307920477411244}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.059048226927007945, 'avg_test_loss': 0.06304075187654234}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.058894941461937765, 'avg_test_loss': 0.06302189057169016}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.05886058628559113, 'avg_test_loss': 0.06302189100824762}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.058815938502550125, 'avg_test_loss': 0.06302280885574874}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.058740412701453484, 'avg_test_loss': 0.06301271094707772}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.058718143599373954, 'avg_test_loss': 0.0629835982399527}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.05867262265724795, 'avg_test_loss': 0.0629667397151934}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.058600042590073176, 'avg_test_loss': 0.06295586920168716}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.05845357925125531, 'avg_test_loss': 0.06293966292287223}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.058359134825212614, 'avg_test_loss': 0.06292211188701913}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.058351792392986164, 'avg_test_loss': 0.06293032245594077}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.05829913975724152, 'avg_test_loss': 0.0628801827551797}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.0580984117771898, 'avg_test_loss': 0.06290956150041893}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.05815666760078498, 'avg_test_loss': 0.06290735170478001}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.0579667991570064, 'avg_test_loss': 0.06290621729567647}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.05794419908736433, 'avg_test_loss': 0.06288789502286818}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.05792797091390405, 'avg_test_loss': 0.0628720871754922}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.057704080577407564, 'avg_test_loss': 0.06288569142634515}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.05768856797473771, 'avg_test_loss': 0.06285538767406251}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.05759944141123976, 'avg_test_loss': 0.06288545738789253}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.05758958746492863, 'avg_test_loss': 0.06287873702240176}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.05751355308932918, 'avg_test_loss': 0.06285202501749154}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.057386714481881686, 'avg_test_loss': 0.06284187445999123}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.0573459002162729, 'avg_test_loss': 0.06287552384310402}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.05717707193323544, 'avg_test_loss': 0.0628576394810807}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.05720726643715586, 'avg_test_loss': 0.06285268611100037}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.05709609503192561, 'avg_test_loss': 0.06282439593633171}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.057093890104975016, 'avg_test_loss': 0.06280321857775562}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.05697940658032894, 'avg_test_loss': 0.06283388851443306}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.05686528554771628, 'avg_test_loss': 0.06282403832301497}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.056880243695208006, 'avg_test_loss': 0.06278044894861523}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.056747556971652166, 'avg_test_loss': 0.06279108820308466}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.05677111156497683, 'avg_test_loss': 0.06281530161504634}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.05664635897321361, 'avg_test_loss': 0.0627816945197992}
INFO:model_data_nn.py:Epoch 46/50, metrics: {'avg_train_loss': 0.05652028896553176, 'avg_test_loss': 0.0627650076203281}
INFO:model_data_nn.py:Epoch 47/50, metrics: {'avg_train_loss': 0.05654380139069898, 'avg_test_loss': 0.06279251944215503}
INFO:model_data_nn.py:Epoch 48/50, metrics: {'avg_train_loss': 0.05639125941480909, 'avg_test_loss': 0.06278412777464837}
INFO:model_data_nn.py:Epoch 49/50, metrics: {'avg_train_loss': 0.056358825577156886, 'avg_test_loss': 0.06274661836505402}
INFO:model_data_nn.py:Epoch 50/50, metrics: {'avg_train_loss': 0.05626155005608286, 'avg_test_loss': 0.06274138022854459}
INFO:main_restricted.py:Making prediction for data in year: 1989
INFO:main_restricted.py:Prediction data shape: (16366,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1989: 0.2504062922764407
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  16366.000000  16366.000000
mean       0.032052      0.021871
std        0.251212      0.030773
min       -0.945313     -0.152033
25%       -0.090909      0.003412
50%        0.016642      0.022276
75%        0.132440      0.041516
max        3.923078      0.144260
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Train_data: (177144, 161)

INFO:transform_data_nn.py:Test data years: [1993]
INFO:transform_data_nn.py:Test_data: (17602, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:transform_data_nn.py:Retrain_data: (194746, 161)

INFO:transform_data_nn.py:Prediction data years: [1994]
INFO:transform_data_nn.py:Prediction_data: (19550, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([177144, 138])
            y_train_tf: torch.Size([177144])

            x_test_tf: torch.Size([17602, 138])
            y_test_tf: torch.Size([17602])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([194746, 138])
            y_retrain_tf: torch.Size([194746])

            x_prediction_tf: torch.Size([19550, 138])
            y_prediction_tf: torch.Size([19550])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.7511e-01,  5.3032e-01,  1.2118e-01, -1.3279e+00, -1.1473e-01,
        -6.6547e-01, -1.7965e-01, -3.5902e-01,  3.0039e-01, -1.6157e-01,
        -7.0364e-01,  1.3287e-02, -4.8032e-01, -2.1689e-01,  9.2752e-02,
         5.1136e-01, -1.2770e-01,  2.0288e-01, -8.6807e-02,  4.6755e-01,
        -3.3014e-01, -3.0899e-03,  1.2939e-02,  1.7989e-02, -5.1916e-02,
        -2.6816e-01, -5.6058e-01, -1.8181e-02,  4.0599e-01,  1.0573e+00,
         4.2291e-01, -9.3946e-02,  4.4649e-01, -2.1402e-02, -3.7431e-01,
        -1.8455e-01,  9.1704e-02,  4.7506e-01,  2.3524e-02, -1.1254e+00,
        -3.0536e-01,  2.8104e-01,  2.7996e-01, -9.3432e-02, -1.5500e-01,
        -6.7113e-01,  8.9885e-02, -3.4669e-02, -4.0734e-01, -1.7358e-01,
        -6.8742e-01,  6.7090e-01, -1.3187e-01, -3.4868e-02,  2.6621e-02,
         4.3297e-01, -7.3884e-01,  5.0399e-02, -2.5586e-01, -3.3450e-02,
         1.2930e-01, -3.1684e-01,  1.3231e-01,  2.5136e-01,  1.2800e-01,
        -1.4296e-01,  2.7904e-01, -8.9100e-02,  7.2144e-01, -4.1733e-01,
        -1.5802e-01, -6.1594e-02, -4.7980e-02, -8.0352e-01,  9.5446e-02,
         6.0000e-01,  2.5124e-02, -3.5209e-01, -1.8562e-01,  6.4939e-04,
        -1.6890e-02,  2.5546e-01,  1.9693e-02, -3.2662e-01, -5.4653e-01,
        -1.1026e-01, -9.2396e-02, -3.3079e-01, -7.5383e-02,  1.6134e-01,
        -5.0113e-01, -1.2592e+00,  2.9665e-03,  1.6367e+00,  1.9011e+00,
         2.0545e+00,  4.0982e-01,  1.6419e+00, -2.5976e+00,  5.4995e-02,
        -9.5135e-01,  1.2901e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0600e-02,  5.5131e-01,  0.0000e+00, -1.1747e+00,
         6.5082e-01, -2.0948e+00,  1.5020e-01,  1.9927e-02,  0.0000e+00,
         0.0000e+00,  1.6984e-02, -1.7085e-01,  2.0595e-02, -7.1156e-02,
         5.0707e-02, -4.4174e-01, -3.5503e-01,  2.4983e-01,  2.6954e-01,
        -4.1798e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([7210]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([ 6.2201e-03,  4.0160e-02, -4.9216e-01,  5.4931e-01,  2.8609e-01,
        -6.0069e-01, -2.2084e+00, -1.0302e+00, -4.7065e-01, -2.4710e-01,
        -1.4308e-02,  4.9625e-03, -3.6213e-02, -3.3412e-02,  2.1304e-02,
        -1.0237e+00, -1.7729e-01,  6.1705e-01,  1.6484e-01,  1.1458e-02,
         7.6160e-01, -7.4634e-02, -2.4968e-02, -3.4868e-01,  1.4408e-01,
        -8.4063e-03, -6.4430e-01, -7.3839e-01, -1.2763e+00,  3.1663e-02,
        -2.8039e-02, -2.1211e-01,  1.8460e-01, -2.1402e-02,  1.1698e-03,
         1.3698e+00,  1.4487e-02, -6.2328e-01,  4.0902e-01, -1.0097e+00,
        -3.1756e-02, -2.4244e-01,  1.2191e-02,  2.9435e-02,  4.8104e-03,
        -5.0599e-01, -2.1340e-01, -1.4904e-01,  3.2076e-01,  5.2773e-01,
         1.6373e+00, -8.3324e-01, -5.9558e-01, -7.2872e-01, -7.3904e-01,
         5.1056e-03, -1.0694e+00, -4.4086e-02, -7.2391e-03,  2.6464e-01,
        -4.8327e-03, -7.3293e-03,  6.8518e-03,  1.0950e-02,  9.3378e-04,
         3.1050e-03,  2.2322e-02,  1.1238e+00,  5.7967e-02, -1.1165e-02,
        -1.5802e-01, -6.1594e-02, -4.7980e-02, -4.3363e-01,  8.7659e-03,
         2.5548e-02,  6.8801e-04, -4.4530e-03,  6.7547e-04,  6.4939e-04,
         1.2073e-01, -4.7145e-01, -3.6522e-01, -1.7265e-01, -5.0460e-01,
        -4.0603e-03, -3.1113e-03,  2.9184e-02,  4.2500e-03,  1.2579e-01,
        -6.3919e-01,  9.8457e-01,  2.9665e-03, -1.3392e+00, -1.5266e+00,
        -9.6352e-01,  1.8288e+00, -1.6627e+00,  1.2169e+00, -1.1459e+00,
        -9.4967e-01,  2.1429e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.3449e-02,  3.4491e-01,  0.0000e+00,  5.3013e-01,
        -2.8294e-02,  4.7908e-01,  1.0045e-01,  1.9927e-02,  0.0000e+00,
         0.0000e+00,  1.3357e-02,  2.3455e-02,  2.0595e-02, -9.1336e-03,
         8.4218e-03,  1.6526e-03, -2.1462e-02,  1.1496e-01,  1.7460e-01,
        -3.3093e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4050]), tensor(0.0291))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.1669,  0.5888,  0.1036, -1.3219, -0.1143, -0.6813, -0.1850, -0.3644,
         0.3208, -0.1635, -0.7034,  0.0227, -0.4865, -0.2572,  0.1009,  0.5067,
        -0.1305,  0.2120, -0.0732,  0.4743, -0.3380,  0.0057,  0.0149,  0.0136,
        -0.0537, -0.2743, -0.5612, -0.0210,  0.3845,  1.0975,  0.4100, -0.0973,
         0.4536, -0.0351, -0.3724, -0.1814,  0.0980,  0.4924,  0.0227, -1.1218,
        -0.3089,  0.2602,  0.2824, -0.0835, -0.1526, -0.6815,  0.0777, -0.0463,
        -0.4050, -0.1860, -0.7059,  0.6565, -0.1252, -0.0294,  0.0189,  0.4337,
        -0.7312,  0.0518, -0.2591, -0.0319,  0.1302, -0.3191,  0.1327,  0.2513,
         0.1271, -0.1443,  0.3185, -0.0992,  0.7069, -0.4184, -0.1927, -0.0776,
        -0.0450, -0.8111,  0.1075,  0.6137,  0.0222, -0.3556, -0.1870,  0.0038,
        -0.0102,  0.2538,  0.0352, -0.3280, -0.5492, -0.1148, -0.0973, -0.3225,
        -0.0634,  0.1735, -0.5036, -1.2598,  0.0066,  1.6984,  1.9427,  2.1325,
         0.2193,  1.6729, -2.6897,  0.1787, -0.8928,  0.1270,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0538,  0.5436,  0.0000, -1.2410,  0.6873, -2.1641,
         0.1521,  0.0133,  0.0000,  0.0000,  0.0265, -0.1685,  0.0193, -0.0752,
         0.0659, -0.4429, -0.3589,  0.2582,  0.2740, -0.4163,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([7792]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-1.0950e+00, -1.5362e-01, -7.1802e-01,  7.1595e-01, -7.3885e-02,
        -4.5583e-01, -2.1670e+00, -9.9111e-01, -5.6359e-01, -3.7633e-01,
        -5.5989e-01,  7.3728e-03,  1.0031e-01,  2.8742e-01, -2.1712e-01,
        -3.9971e-02, -2.1449e-01,  2.2596e-01, -7.3246e-02,  1.8080e-01,
        -1.1654e-01, -7.5538e-02, -3.7054e-01,  1.9298e-01,  9.2301e-02,
        -5.2914e-01, -5.9192e-01, -5.7700e-01, -1.0409e+00,  3.7015e-01,
        -4.2835e-01, -3.7255e-02,  2.4777e-01, -3.5072e-02, -7.3016e-01,
         2.6784e-03,  4.2254e-01, -6.3613e-01, -1.4406e-01, -9.4372e-01,
        -1.0650e-01, -1.9294e-01,  6.3178e-01, -2.7989e-01, -1.4918e-01,
        -1.4076e-01,  1.9851e-01,  6.3793e-01,  3.5250e-01, -6.9402e-02,
         7.0255e-02, -7.0042e-01, -5.8644e-01, -6.7527e-01, -7.3775e-01,
         4.5410e-01, -1.0644e+00,  3.5916e-01, -4.3311e-01,  1.6513e-01,
         3.9582e-01, -5.8113e-01, -3.9604e-01, -8.5332e-01, -2.4208e-03,
        -4.9585e-01, -2.8668e-02,  2.7000e+00,  1.3721e+00, -4.1798e-01,
        -1.9274e-01, -7.7553e-02, -4.5049e-02, -8.9308e-02,  4.3926e-02,
         4.8803e-02, -1.8841e-01, -1.3370e-01, -7.9591e-02,  3.7770e-03,
         1.1047e-01,  1.2347e-01, -3.8610e-01,  1.4558e+00,  4.0162e-01,
        -1.0213e-01, -8.9866e-02, -2.9537e-01, -5.4278e-01,  1.9339e-02,
        -6.3314e-02,  1.4176e-01,  6.5806e-03, -1.4075e+00, -1.1267e+00,
        -1.2399e+00,  1.8304e+00, -1.4574e+00,  7.6483e-01, -1.1369e+00,
        -1.0717e+00,  4.8402e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6488e-02, -5.7104e-02,  0.0000e+00,  4.8339e-01,
        -2.0257e-01,  2.5994e-01,  1.3269e-01,  2.1396e+00,  0.0000e+00,
         0.0000e+00, -5.9865e-01, -1.8242e-01, -3.9370e+00,  7.0672e-01,
        -4.0138e-01, -4.5708e-01, -4.2166e-01,  2.4906e-01,  3.2776e-01,
        -3.5330e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5307]), tensor(-0.0517))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:main_restricted.py:Testing data year: 1993
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 7594
            device: cpu
            
2024-08-06 14:47:52,891	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-06 14:47:52,938	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-06 14:47:52,989	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_1c61b63ddcb23de0.zip' (5.14MiB) to Ray cluster...
2024-08-06 14:47:53,005	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_1c61b63ddcb23de0.zip'.
2024-08-06 14:47:54,454	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-06 14:57:49,158	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-06_14-47-54' in 0.2366s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 7594, 'embedding_dim': 6, 'dropout_rate': 0.54, 'lr': 3.4419719400899214e-05, 'weight_decay': 0.00016266799643038432, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.0789145094679907
INFO:model_data_nn.py:Best trial testing loss: 0.09221043656377689
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-06_14-47-50_545380_2669035/artifacts/2024-08-06_14-47-54/train_fnn_2024-08-06_14-47-54/driver_artifacts/train_fnn_89454_00077_77_dropout_rate=0.5400,embedding_dim=6,hidden_dim=5,lr=0.0000,num_layers=5,weight_decay=0.0002_2024-08-06_14-47-54
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 8208, 'embedding_dim': 6, 'dropout_rate': 0.54, 'lr': 3.4419719400899214e-05, 'weight_decay': 0.00016266799643038432, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.08252869568211636, 'avg_test_loss': 0.06245298874777516}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.0810030154702618, 'avg_test_loss': 0.06289665952470957}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.08093935822888004, 'avg_test_loss': 0.06295427542447654}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.08095101626892375, 'avg_test_loss': 0.06311208457728616}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.08093777316806741, 'avg_test_loss': 0.06307245818958952}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.08094348802422906, 'avg_test_loss': 0.06311591161914121}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.08093525991725499, 'avg_test_loss': 0.06304272063368675}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.08092995290445466, 'avg_test_loss': 0.0630650950315731}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.08094673578423509, 'avg_test_loss': 0.06308375011666928}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.0809344723085915, 'avg_test_loss': 0.06304255001295626}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.08093064271016469, 'avg_test_loss': 0.0630738219623667}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main_restricted.py:Making prediction for data in year: 1994
INFO:main_restricted.py:Prediction data shape: (19550,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1994: 0.25107659218931166
INFO:main_restricted.py:Prediction Stats:                retq          pred
count  19550.000000  19550.000000
mean      -0.009021      0.037745
std        0.246687      0.000193
min       -0.941176      0.037638
25%       -0.125000      0.037672
50%       -0.014632      0.037712
75%        0.082227      0.037745
max        6.294121      0.049999
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:transform_data_nn.py:Train_data: (214296, 161)

INFO:transform_data_nn.py:Test data years: [1995]
INFO:transform_data_nn.py:Test_data: (22259, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:transform_data_nn.py:Retrain_data: (236555, 161)

INFO:transform_data_nn.py:Prediction data years: [1996]
INFO:transform_data_nn.py:Prediction_data: (22619, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([214296, 138])
            y_train_tf: torch.Size([214296])

            x_test_tf: torch.Size([22259, 138])
            y_test_tf: torch.Size([22259])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([236555, 138])
            y_retrain_tf: torch.Size([236555])

            x_prediction_tf: torch.Size([22619, 138])
            y_prediction_tf: torch.Size([22619])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.6138e-01,  6.3450e-01,  9.6981e-02, -1.3080e+00, -1.1959e-01,
        -6.9455e-01, -1.8408e-01, -3.6603e-01,  3.4602e-01, -1.6517e-01,
        -7.0044e-01,  3.5450e-02, -4.9125e-01, -2.8845e-01,  1.0510e-01,
         5.0456e-01, -1.3299e-01,  2.2204e-01, -6.2827e-02,  4.7706e-01,
        -3.3099e-01,  1.1276e-02,  6.6511e-03,  8.8014e-03, -5.7867e-02,
        -2.7626e-01, -5.6481e-01, -1.7767e-02,  3.6237e-01,  1.1400e+00,
         4.0725e-01, -1.0241e-01,  4.6180e-01, -2.9825e-02, -3.6021e-01,
        -1.8733e-01,  9.5078e-02,  5.2221e-01,  1.4196e-02, -1.1223e+00,
        -3.1014e-01,  2.8018e-01,  2.7811e-01, -7.3863e-02, -1.5659e-01,
        -6.8839e-01,  8.3863e-02, -3.2747e-02, -4.1685e-01, -1.7848e-01,
        -7.2196e-01,  6.4307e-01, -1.2036e-01, -2.1798e-02,  1.4097e-02,
         4.3111e-01, -7.2384e-01,  6.8795e-02, -2.5934e-01, -3.0069e-02,
         1.2961e-01, -3.1864e-01,  1.3157e-01,  2.5408e-01,  1.2160e-01,
        -1.4858e-01,  3.4747e-01, -1.0941e-01,  6.8888e-01, -4.1828e-01,
        -2.1984e-01, -3.1756e-02, -4.4639e-02, -8.1988e-01,  1.2150e-01,
         6.2742e-01,  2.0417e-02, -3.5962e-01, -1.8665e-01,  6.7417e-03,
        -1.1077e-03,  2.4425e-01,  5.6884e-02, -3.2948e-01, -5.5073e-01,
        -1.1984e-01, -1.0287e-01, -3.1502e-01, -4.3851e-02,  1.7717e-01,
        -5.0642e-01, -1.2600e+00,  1.0965e-02,  1.7803e+00,  2.0508e+00,
         2.2045e+00,  8.3752e-02,  1.7561e+00, -2.8150e+00,  2.9148e-01,
        -8.5039e-01,  1.2211e-01,  0.0000e+00, -1.0546e+00,  0.0000e+00,
         1.5404e+00,  5.2180e-02,  6.0691e-01,  0.0000e+00, -1.3295e+00,
         7.3676e-01, -2.2904e+00,  1.5304e-01,  1.7361e-02,  0.0000e+00,
        -3.9607e-01,  4.4101e-02, -1.6949e-01,  3.3249e-02, -8.2228e-02,
         8.3000e-02, -4.3063e-01, -3.5525e-01,  2.6693e-01,  2.7907e-01,
        -4.1393e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([8731]), tensor(-0.0558))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-4.8294e-01, -5.4073e-01, -7.6601e-01,  8.6777e-01, -3.0059e-01,
        -2.2299e-01, -1.5585e+00, -9.6941e-01, -4.3036e-01, -3.6043e-01,
        -6.6956e-01,  6.8434e-03, -5.5438e-03,  5.4760e-01, -7.4776e-02,
        -4.6272e-01, -1.7317e-01,  4.1447e-01, -6.2827e-02, -7.4029e-02,
         2.4118e-03, -6.9747e-02, -1.4708e-01, -2.2730e-01, -5.5682e-02,
        -5.5428e-01, -5.8687e-01, -1.7767e-02, -1.3436e+00,  6.6675e-01,
        -3.2284e-02, -1.1997e-01,  2.4504e-01, -2.9825e-02, -7.5459e-01,
        -7.5051e-04,  2.6271e-02, -6.3358e-01,  3.1237e-01, -8.3944e-01,
         2.2254e-01, -1.1148e+00,  9.9344e-02, -2.4154e-01, -3.0358e-01,
        -3.9225e-01, -3.8217e-01, -2.8421e-01,  4.2144e-02, -2.4167e-01,
         1.5758e+00, -7.7319e-01, -4.8150e-01, -6.3692e-01, -7.3569e-01,
         3.6909e-01, -1.0605e+00,  1.0941e-01, -3.3120e-01, -2.1883e-01,
         1.1599e-01, -4.1932e-01, -1.9770e-01,  2.1818e-01, -2.3513e-03,
        -4.2883e-01, -2.6993e-01,  6.9062e-01,  1.3538e+00, -4.6101e-01,
        -2.1984e-01, -3.1756e-02, -4.4639e-02, -8.4792e-02,  3.8531e-02,
        -3.0587e-01, -1.0111e-01, -1.8760e-01, -5.2785e-02,  6.7417e-03,
        -1.1077e-03, -5.0326e-01, -3.4607e-01, -4.9446e-01, -6.5240e-01,
        -1.0350e-01, -9.3501e-02, -3.2932e-01, -6.4154e-01,  1.1695e-01,
        -7.0328e-01,  5.0377e-01,  1.0965e-02, -9.9174e-01, -5.9269e-02,
        -1.1645e+00,  3.5015e-01, -4.5817e-01, -6.3622e-03, -1.2639e+00,
        -6.3468e-01, -2.5567e-01,  0.0000e+00, -1.0546e+00,  0.0000e+00,
         1.5404e+00,  2.0201e-02, -1.3220e-01,  0.0000e+00, -1.8752e-01,
        -4.9769e-01,  8.6243e-01,  1.3005e-01,  7.6998e-01,  0.0000e+00,
        -3.9607e-01, -4.5139e-01, -1.9572e-01, -3.8074e+00,  7.7426e-01,
         2.9990e-01, -5.2928e-01, -4.7617e-01,  2.0270e-01,  2.6195e-01,
        -3.6208e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5851]), tensor(-0.0506))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.5465e-01,  6.6885e-01,  8.5476e-02, -1.2872e+00, -1.2682e-01,
        -7.0710e-01, -1.7775e-01, -3.6445e-01,  3.6850e-01, -1.7035e-01,
        -6.9521e-01,  4.6163e-02, -4.8957e-01, -3.1484e-01,  1.0988e-01,
         5.0111e-01, -1.3360e-01,  2.3042e-01, -5.9369e-02,  4.7335e-01,
        -3.5575e-01,  6.9554e-03, -1.5421e-02,  1.9538e-03, -5.8418e-02,
        -2.7375e-01, -5.7194e-01, -1.5993e-02,  3.4099e-01,  1.1822e+00,
         4.0172e-01, -1.0509e-01,  4.6804e-01, -2.7462e-02, -3.4340e-01,
        -1.9804e-01,  8.5568e-02,  5.5779e-01,  3.2951e-03, -1.1233e+00,
        -3.1047e-01,  3.0597e-01,  2.6816e-01, -7.1363e-02, -1.6457e-01,
        -6.9600e-01,  9.3016e-02, -4.4227e-02, -4.1794e-01, -1.8607e-01,
        -7.3816e-01,  6.3137e-01, -1.1456e-01, -1.6210e-02,  2.6085e-03,
         4.2819e-01, -7.1177e-01,  7.6150e-02, -2.5529e-01, -2.0217e-02,
         1.2886e-01, -3.1347e-01,  1.3228e-01,  2.5872e-01,  1.1666e-01,
        -1.5427e-01,  3.6959e-01, -1.1485e-01,  6.7589e-01, -4.1543e-01,
        -2.3957e-01, -4.1940e-02, -8.1201e-03, -8.2637e-01,  1.3267e-01,
         6.3311e-01,  1.7659e-02, -3.6415e-01, -1.8467e-01,  6.6376e-03,
        -2.0541e-03,  2.3300e-01,  7.8207e-02, -3.3225e-01, -5.5213e-01,
        -1.2473e-01, -1.0838e-01, -3.0840e-01, -2.1037e-02,  1.7360e-01,
        -5.0841e-01, -1.2612e+00,  1.2012e-02,  1.8212e+00,  2.1685e+00,
         2.2888e+00,  7.5983e-02,  1.8721e+00, -2.8702e+00,  4.0568e-01,
        -7.9586e-01,  1.1003e-01,  7.1534e-01,  1.9921e-01, -2.0874e-01,
         2.9136e-01,  4.8129e-02,  4.9181e-01,  0.0000e+00, -1.3169e+00,
         8.2750e-01, -2.4208e+00,  1.5395e-01,  3.5656e-02,  0.0000e+00,
        -1.1729e-01,  7.0280e-02, -1.7483e-01,  1.7692e-02, -9.2213e-02,
         9.6501e-02, -4.1147e-01, -3.4738e-01,  2.7235e-01,  2.8255e-01,
        -4.1445e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([9571]), tensor(-0.0558))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.4706e-01, -5.8692e-01, -5.1251e-01,  1.0123e+00, -8.8275e-02,
        -1.8575e-01, -6.2726e-01, -6.5006e-01, -4.6369e-01, -4.1597e-01,
        -7.1277e-01,  2.3876e-02, -1.2728e-01,  5.5995e-01,  1.4051e-01,
         6.9417e-02, -2.1466e-01,  3.2960e-01, -1.8060e-01,  1.3972e-01,
         2.0362e-01, -6.4095e-02, -2.0622e-02, -2.2984e-01,  8.8198e-02,
        -5.9688e-01, -6.0876e-01, -1.5993e-02, -1.2960e+00,  5.8608e-01,
        -4.4832e-01, -6.6236e-02,  2.4729e-01, -2.7462e-02, -7.3220e-01,
        -5.9738e-02,  2.4769e-01, -6.3787e-01, -6.7517e-02, -8.8688e-01,
        -1.0564e-03,  1.8863e-01,  2.6198e-01, -2.5534e-01, -1.5373e-01,
         2.0762e-01, -9.4873e-03,  5.7696e-01, -1.2216e-01,  2.9324e-02,
         1.5413e+00, -6.9475e-01, -5.9335e-01, -6.0518e-01, -7.3726e-01,
         3.9733e-01, -1.0525e+00,  3.6123e-01, -5.0060e-01, -3.7416e-01,
         1.0904e-01, -5.2580e-01, -2.1244e-01,  6.7539e-02, -3.0935e-03,
        -4.0521e-01, -2.7154e-01, -5.1469e-02,  1.3419e+00, -5.0704e-01,
        -2.3957e-01, -4.1940e-02, -8.1201e-03,  8.1635e-02,  5.7545e-02,
        -8.2888e-02,  8.5503e-02, -2.2786e-01, -5.5072e-02,  6.6376e-03,
         1.2189e-01, -6.5599e-02, -3.4642e-01,  1.1322e+00, -4.0199e-01,
        -1.0438e-01, -9.7048e-02, -3.5142e-01, -5.6331e-01,  2.5259e-01,
        -5.2920e-01, -6.4311e-01,  1.2012e-02, -1.8836e+00, -6.2020e-01,
        -1.2011e+00,  3.0616e-01, -5.9280e-01, -9.7377e-01, -1.0392e+00,
        -4.6702e-01,  9.3573e-02,  7.1534e-01, -3.6527e+00, -2.0874e-01,
         5.5889e+00,  2.1032e-02,  7.4366e-01,  0.0000e+00, -3.4124e-01,
        -8.1074e-01,  4.4621e-01,  1.3354e-01,  1.2521e+00,  0.0000e+00,
        -1.1729e-01, -3.9310e-01, -1.5445e-01, -3.7710e+00,  7.2779e-01,
         5.2095e-02, -4.8817e-01, -5.1235e-01,  2.2483e-01,  2.8419e-01,
        -3.8822e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5994]), tensor(0.0223))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:main_restricted.py:Testing data year: 1995
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 24
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 9180
            device: cpu
            
2024-08-06 15:27:06,925	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-06 15:27:06,969	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-06 15:27:07,019	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_1c61b63ddcb23de0.zip' (5.14MiB) to Ray cluster...
2024-08-06 15:27:07,036	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_1c61b63ddcb23de0.zip'.
2024-08-06 15:27:08,812	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
