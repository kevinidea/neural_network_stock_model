Current working directory
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml
source kevin/venv/bin/activate
which python3
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/bin/python3
2024-07-27 13:10:11,757	PANIC scripts.py:900 -- `--address` is a required flag unless starting a head node with `--head`.
Error: `{}` is a required flag unless starting a head node with `{}`.
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
INFO:preprocess_data_nn.py:

Loading and preprocessing data...

DEBUG:preprocess_data_nn.py:          date   permno
626    1980-01  10006.0
5399   1980-01  10057.0
11398  1980-01  10137.0
12828  1980-01  10145.0
13984  1980-01  10153.0
DEBUG:preprocess_data_nn.py:--------------------------------------------------
INFO:main_restricted_month.py:preprocessed df: (2005900, 161)
INFO:preprocess_data_nn.py:

Applying secondary data preprocessing..

INFO:main_restricted_month.py:secondary preprocessed df: (1942951, 161)
INFO:main_restricted_month.py:df sample:     permno       pdate        ym  gvkey  sic2    absacc       acc  ...      roea   roavola       ret        mve_m      retq  pyear     date
0  10006.0  1980-01-01  198001.0   1010    37  0.083420  0.083420  ...  0.141715  0.004512  0.211679   303420.750 -0.055806   1980  1980-01
1  10057.0  1980-01-01  198001.0   1098    36  0.088951  0.088951  ...  0.174252  0.035698  0.282297   111423.125 -0.069431   1980  1980-01
2  10137.0  1980-01-01  198001.0   1279    49  0.041008  0.041008  ...  0.097554  0.006254 -0.032258   617349.500 -0.108065   1980  1980-01
3  10145.0  1980-01-01  198001.0   1300    99  0.050486  0.050486  ...  0.122729  0.004320  0.150127  1415193.000 -0.085950   1980  1980-01
4  10153.0  1980-01-01  198001.0   1308    13       NaN       NaN  ...  0.109950  0.009149 -0.122744   429488.500 -0.285199   1980  1980-01

[5 rows x 161 columns]
INFO:main_restricted_month.py:Train year start: 1980
INFO:main_restricted_month.py:Prediction data years: [1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020]
INFO:main_restricted_month.py:

Loop through all the prediction years and build optimized model for each year

INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983]
INFO:transform_data_nn.py:Train_data: (110027, 161)

INFO:transform_data_nn.py:Test data years: [1984]
INFO:transform_data_nn.py:Test_data: (39843, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984]
INFO:transform_data_nn.py:Retrain_data: (149870, 161)

INFO:transform_data_nn.py:Prediction data years: [1985]
INFO:transform_data_nn.py:Prediction_data: (43492, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([110027, 138])
            y_train_tf: torch.Size([110027])

            x_test_tf: torch.Size([39843, 138])
            y_test_tf: torch.Size([39843])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([149870, 138])
            y_retrain_tf: torch.Size([149870])

            x_prediction_tf: torch.Size([43492, 138])
            y_prediction_tf: torch.Size([43492])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([ 0.0628,  0.3756,  0.2271, -1.1796, -0.0801, -0.6621, -0.0779, -0.2665,
         0.0872, -0.1557, -0.7166, -0.3870, -0.4114, -0.2179,  0.1431,  0.6196,
        -0.1564,  0.0919,  0.0000,  0.5263, -0.3749, -0.5826, -0.0361,  0.0749,
        -0.1400, -0.1766, -0.5626,  0.0000,  0.3901,  0.6091,  0.4538, -0.1213,
         0.3428,  0.0000, -0.4463, -0.1995,  0.0663,  0.3348,  0.2344, -1.1620,
        -0.2472, -0.2213,  0.2027, -0.1609, -0.0746, -0.7185, -0.2011, -0.1790,
        -0.6005, -0.3965, -0.6070,  0.5939, -0.1769, -0.8679,  0.0552,  0.4190,
        -0.7801, -0.1754, -0.3186,  0.2440,  0.1076, -0.3897,  0.1369,  0.2796,
         0.2697, -0.1072,  0.1506, -0.0271,  0.6502, -0.4151,  0.0000,  0.0000,
         0.0000, -0.8997, -0.1836,  0.4912,  0.0369, -0.3268, -0.1899, -0.1155,
         0.0000,  0.5725, -0.1552,  0.0479, -0.5498, -0.0582, -0.0435, -0.3944,
        -0.1330,  0.1532, -0.4489, -1.2827,  0.0000,  0.4750,  1.2088,  0.7934,
        -0.4210,  0.3631, -1.4202, -1.1935, -1.2001,  0.3642,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0779, -0.1948,  0.0000, -1.2914, -0.7160, -1.0946,
         0.0732, -0.0522,  0.0000,  0.0000, -0.0294, -0.1338, -0.0955,  0.1611,
         0.1694, -0.4865, -0.4257,  0.0122,  0.1789, -0.5304,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([1668]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-1.2639, -0.7337, -0.4556,  2.3911, -0.7026, -0.9487, -0.1519, -0.3279,
        -0.2011,  0.2632, -0.7962, -0.7360, -1.6013,  0.1165,  0.1497, -1.5574,
        -0.1792, -1.2191,  0.0000, -0.6685,  0.8178, -0.5826, -0.0605, -0.6848,
        -0.1282, -0.0483, -0.6542,  0.0000,  1.0781,  0.5716, -1.0207, -0.6631,
        -0.2766,  0.0000, -0.6917, -0.3890, -0.0312, -0.0085, -1.7385, -0.6602,
        -0.2498,  0.6077, -0.4563, -0.1910, -0.3831, -0.9500,  0.6050, -0.3420,
        -0.8017,  1.2504,  0.0558,  0.7774, -0.2984, -0.8679,  0.0552, -0.0108,
        -0.6782, -0.1431, -0.2432,  0.1139,  0.2336, -0.6611, -0.5984, -0.2200,
        -1.2642, -0.9073,  0.7445, -0.0289, -0.7145, -0.5120,  0.0000,  0.0000,
         0.0000, -1.2280, -0.5082, -1.1719,  0.2558, -0.3667, -0.2021,  1.3066,
         0.0000, -2.3050, -0.5736,  0.6968,  0.9230, -0.0507, -0.0412, -0.4332,
        -0.3151, -0.9136,  0.9210, -0.4534,  0.0000, -1.2138, -1.1335, -1.6347,
         1.1901, -0.7598,  0.8937, -1.5188, -1.1536, -0.7512,  0.0000,  0.0000,
         0.0000,  0.0000, -0.1743, -0.1948,  0.0000,  1.7336,  0.4082,  1.9218,
        -0.0034, -0.0522,  0.0000,  0.0000, -0.2869, -0.1594, -0.0955,  0.7245,
         0.1741, -0.9857, -0.6281, -0.6547, -0.3378, -0.0523,  0.0000,  0.0000,
         0.0000,  0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([1746]), tensor(-0.0875))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-0.0054,  0.3203,  0.2194, -1.2084, -0.1250, -0.6240, -0.0916, -0.2813,
         0.1755, -0.1609, -0.7181, -0.2985, -0.4316, -0.1709,  0.1224,  0.6069,
        -0.1464,  0.0913,  0.0000,  0.5148, -0.3331,  0.1067, -0.0306, -0.0081,
        -0.1190, -0.2124, -0.5798,  0.0000,  0.4178,  0.7142,  0.4837, -0.1548,
         0.3823,  0.0000, -0.4281, -0.1804,  0.0945,  0.3886,  0.1901, -1.1776,
        -0.2458,  0.0141,  0.1895, -0.1257, -0.0936, -0.6817, -0.0587, -0.1134,
        -0.6202, -0.2558, -0.6133,  0.6308, -0.1811, -0.2689,  0.0209,  0.4466,
        -0.7806, -0.1405, -0.3113,  0.2011,  0.0943, -0.3883,  0.1554,  0.3174,
         0.2508, -0.0946,  0.1179, -0.0439,  0.6406, -0.4199,  0.0000,  0.0000,
         0.0000, -0.8552, -0.1174,  0.5194,  0.0462, -0.3339, -0.1861, -0.0368,
         0.0000,  0.5389, -0.0828, -0.0897, -0.5511, -0.0648, -0.0503, -0.3859,
        -0.1629,  0.1517, -0.4628, -1.2766,  0.0000,  0.7191,  1.4805,  1.0988,
        -0.1931,  0.5645, -1.7373, -1.0139, -1.1352,  0.3032,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0558, -0.2886,  0.0000, -1.3168, -0.9630, -1.2887,
         0.0878, -0.0825,  0.0000,  0.0000, -0.0100, -0.1309, -0.0592,  0.1436,
         0.2215, -0.4598, -0.4234,  0.0705,  0.2044, -0.4644,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([1971]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-4.1209e-02, -3.4561e-02,  6.9167e+00, -4.8258e-01, -4.2263e-02,
         1.8296e+00,  1.8592e+00,  2.1082e+00, -5.0464e-01, -4.7138e-01,
         1.1591e+00,  1.8816e-02,  2.0313e-01,  3.1117e-02,  8.6985e-03,
        -8.5387e-03, -2.2131e-01, -2.1334e+00,  0.0000e+00, -1.2459e-02,
        -2.5757e-01,  1.0670e-01,  8.9147e-03, -2.0070e-02, -1.0279e-02,
        -2.9700e-01,  2.4394e-02,  0.0000e+00, -1.3788e+00, -9.4805e-01,
         1.4267e+00, -4.3503e-02,  1.4899e-01,  0.0000e+00,  3.3403e+00,
         1.7326e-02,  1.5988e-02, -2.1585e-01, -1.7642e-01,  1.3349e+00,
        -8.7883e-02, -1.3674e+00, -1.6666e-02, -4.1929e-01, -2.3189e-02,
         3.1896e-01, -1.3621e+00,  1.6841e-01, -3.7548e-01, -1.5424e+00,
         2.8157e+00, -1.1174e+00, -9.7091e-02, -2.6889e-01,  7.8921e-01,
         3.4179e-01, -3.2325e-02,  2.3563e-02, -2.1498e-02,  4.2200e-02,
        -1.4704e-02, -2.0302e-02,  4.3394e-02,  4.9887e-02, -1.1005e-02,
         2.2852e-02, -2.4194e-02,  6.0221e-03,  6.4058e-01,  4.5177e-02,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  3.3045e-01,  3.1348e-01,
        -1.0899e-02, -2.0691e-01,  1.2023e+00,  6.9023e+00, -3.6842e-02,
         0.0000e+00,  2.5110e-02, -3.3694e-01, -9.2152e-01, -5.3683e-01,
        -6.5317e-02, -5.0028e-02, -5.2869e-02,  5.5624e-01, -2.6465e-02,
        -4.0950e-01,  1.9470e+00,  0.0000e+00, -6.6848e-01, -2.8689e-01,
        -1.0407e+00, -3.0734e+00, -1.0772e+00,  1.0322e+00, -1.1352e+00,
        -5.1966e-01, -3.7978e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00, -6.1909e-03,  2.3739e-01,  0.0000e+00,  6.3793e-01,
        -1.0868e+00,  9.2511e-01, -3.1371e-03, -8.2525e-02,  0.0000e+00,
         0.0000e+00,  3.2516e-02, -1.1784e-02, -5.9187e-02, -1.3858e-02,
         3.9036e-02,  5.0149e-01,  9.5115e-02,  5.3401e-01,  2.4000e-01,
        -4.4588e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([950]), tensor(0.3115))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983]
INFO:main_restricted_month.py:Testing data year: 1984
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 3605
            device: cpu
            
2024-07-27 13:26:59,601	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 13:26:59,680	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 13:26:59,716	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_341f1673add3bf67.zip' (1.40MiB) to Ray cluster...
2024-07-27 13:26:59,721	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_341f1673add3bf67.zip'.
2024-07-27 13:27:02,817	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 13:32:00,798	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_13-27-00' in 0.2260s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 3605, 'embedding_dim': 2, 'dropout_rate': 0.46, 'lr': 0.00015665171630946476, 'weight_decay': 0.0001190379922025017, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.013603319340049788
INFO:model_data_nn.py:Best trial testing loss: 0.015433806542943965
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-27_13-26-57_025009_365373/artifacts/2024-07-27_13-27-01/train_fnn_2024-07-27_13-27-00/driver_artifacts/train_fnn_954dc_00032_32_dropout_rate=0.4600,embedding_dim=2,hidden_dim=25,lr=0.0002,num_layers=1,weight_decay=0.0001_2024-07-27_13-27-03
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 4258, 'embedding_dim': 2, 'dropout_rate': 0.46, 'lr': 0.00015665171630946476, 'weight_decay': 0.0001190379922025017, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.01517345361494285, 'avg_test_loss': 0.01958169786958024}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.014763400611371425, 'avg_test_loss': 0.019817618091645485}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.014545177929715773, 'avg_test_loss': 0.02006270231966696}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.01437277473623838, 'avg_test_loss': 0.02009852279374814}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.014255107048800316, 'avg_test_loss': 0.02015662739354679}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.01412295080967133, 'avg_test_loss': 0.02029041692148894}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.013995132798744155, 'avg_test_loss': 0.02034653869923204}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.013946460779274342, 'avg_test_loss': 0.020624611020663423}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.01383908679784394, 'avg_test_loss': 0.020582131690153962}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.013758125179308052, 'avg_test_loss': 0.020789967354743137}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.013707215640253295, 'avg_test_loss': 0.020823454890427563}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main_restricted_month.py:Making prediction for data in year: 1985
INFO:main_restricted_month.py:Prediction data shape: (43492,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 1985: 0.14393760524843255
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  43492.000000  43492.000000
mean       0.020246      0.015710
std        0.138818      0.048370
min       -0.850000     -0.217787
25%       -0.049128     -0.014270
50%        0.009615      0.019669
75%        0.077179      0.048750
max        3.666667      0.176273
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984]
INFO:transform_data_nn.py:Train_data: (149870, 161)

INFO:transform_data_nn.py:Test data years: [1985]
INFO:transform_data_nn.py:Test_data: (43492, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Retrain_data: (193362, 161)

INFO:transform_data_nn.py:Prediction data years: [1986]
INFO:transform_data_nn.py:Prediction_data: (43785, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([149870, 138])
            y_train_tf: torch.Size([149870])

            x_test_tf: torch.Size([43492, 138])
            y_test_tf: torch.Size([43492])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([193362, 138])
            y_retrain_tf: torch.Size([193362])

            x_prediction_tf: torch.Size([43785, 138])
            y_prediction_tf: torch.Size([43785])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-0.0054,  0.3203,  0.2194, -1.2084, -0.1250, -0.6240, -0.0916, -0.2813,
         0.1755, -0.1609, -0.7181, -0.2985, -0.4316, -0.1709,  0.1224,  0.6069,
        -0.1464,  0.0913,  0.0000,  0.5148, -0.3331,  0.1067, -0.0306, -0.0081,
        -0.1190, -0.2124, -0.5798,  0.0000,  0.4178,  0.7142,  0.4837, -0.1548,
         0.3823,  0.0000, -0.4281, -0.1804,  0.0945,  0.3886,  0.1901, -1.1776,
        -0.2458,  0.0141,  0.1895, -0.1257, -0.0936, -0.6817, -0.0587, -0.1134,
        -0.6202, -0.2558, -0.6133,  0.6308, -0.1811, -0.2689,  0.0209,  0.4466,
        -0.7806, -0.1405, -0.3113,  0.2011,  0.0943, -0.3883,  0.1554,  0.3174,
         0.2508, -0.0946,  0.1179, -0.0439,  0.6406, -0.4199,  0.0000,  0.0000,
         0.0000, -0.8552, -0.1174,  0.5194,  0.0462, -0.3339, -0.1861, -0.0368,
         0.0000,  0.5389, -0.0828, -0.0897, -0.5511, -0.0648, -0.0503, -0.3859,
        -0.1629,  0.1517, -0.4628, -1.2766,  0.0000,  0.7191,  1.4805,  1.0988,
        -0.1931,  0.5645, -1.7373, -1.0139, -1.1352,  0.3032,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0558, -0.2886,  0.0000, -1.3168, -0.9630, -1.2887,
         0.0878, -0.0825,  0.0000,  0.0000, -0.0100, -0.1309, -0.0592,  0.1436,
         0.2215, -0.4598, -0.4234,  0.0705,  0.2044, -0.4644,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([1971]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-4.1209e-02, -3.4561e-02,  6.9167e+00, -4.8258e-01, -4.2263e-02,
         1.8296e+00,  1.8592e+00,  2.1082e+00, -5.0464e-01, -4.7138e-01,
         1.1591e+00,  1.8816e-02,  2.0313e-01,  3.1117e-02,  8.6985e-03,
        -8.5387e-03, -2.2131e-01, -2.1334e+00,  0.0000e+00, -1.2459e-02,
        -2.5757e-01,  1.0670e-01,  8.9147e-03, -2.0070e-02, -1.0279e-02,
        -2.9700e-01,  2.4394e-02,  0.0000e+00, -1.3788e+00, -9.4805e-01,
         1.4267e+00, -4.3503e-02,  1.4899e-01,  0.0000e+00,  3.3403e+00,
         1.7326e-02,  1.5988e-02, -2.1585e-01, -1.7642e-01,  1.3349e+00,
        -8.7883e-02, -1.3674e+00, -1.6666e-02, -4.1929e-01, -2.3189e-02,
         3.1896e-01, -1.3621e+00,  1.6841e-01, -3.7548e-01, -1.5424e+00,
         2.8157e+00, -1.1174e+00, -9.7091e-02, -2.6889e-01,  7.8921e-01,
         3.4179e-01, -3.2325e-02,  2.3563e-02, -2.1498e-02,  4.2200e-02,
        -1.4704e-02, -2.0302e-02,  4.3394e-02,  4.9887e-02, -1.1005e-02,
         2.2852e-02, -2.4194e-02,  6.0221e-03,  6.4058e-01,  4.5177e-02,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  3.3045e-01,  3.1348e-01,
        -1.0899e-02, -2.0691e-01,  1.2023e+00,  6.9023e+00, -3.6842e-02,
         0.0000e+00,  2.5110e-02, -3.3694e-01, -9.2152e-01, -5.3683e-01,
        -6.5317e-02, -5.0028e-02, -5.2869e-02,  5.5624e-01, -2.6465e-02,
        -4.0950e-01,  1.9470e+00,  0.0000e+00, -6.6848e-01, -2.8689e-01,
        -1.0407e+00, -3.0734e+00, -1.0772e+00,  1.0322e+00, -1.1352e+00,
        -5.1966e-01, -3.7978e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00, -6.1909e-03,  2.3739e-01,  0.0000e+00,  6.3793e-01,
        -1.0868e+00,  9.2511e-01, -3.1371e-03, -8.2525e-02,  0.0000e+00,
         0.0000e+00,  3.2516e-02, -1.1784e-02, -5.9187e-02, -1.3858e-02,
         3.9036e-02,  5.0149e-01,  9.5115e-02,  5.3401e-01,  2.4000e-01,
        -4.4588e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([950]), tensor(0.3115))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.0606e-01,  2.1628e-01,  1.8668e-01, -1.2410e+00, -1.4494e-01,
        -6.0633e-01, -1.0954e-01, -2.9638e-01,  2.3780e-01, -1.6025e-01,
        -7.1284e-01, -1.8976e-01, -4.4614e-01, -9.4623e-02,  9.0774e-02,
         5.5178e-01, -1.4248e-01,  8.6219e-02,  0.0000e+00,  4.3647e-01,
        -3.7530e-01, -2.5503e-01,  1.0047e-02,  1.1415e-03, -1.0654e-01,
        -2.2533e-01, -5.9233e-01,  0.0000e+00,  4.2527e-01,  8.0503e-01,
         4.9132e-01, -1.4382e-01,  3.9378e-01,  0.0000e+00, -4.2043e-01,
        -1.8670e-01,  7.8142e-02,  4.4022e-01,  1.0672e-01, -1.1782e+00,
        -2.5288e-01,  9.5831e-02,  1.3909e-01, -1.0046e-01, -1.3948e-01,
        -6.6383e-01, -1.2032e-02, -1.1862e-01, -6.2645e-01, -2.4628e-01,
        -6.1617e-01,  6.5491e-01, -1.8197e-01, -2.1855e-01,  2.0195e-02,
         4.4404e-01, -7.7944e-01, -1.0039e-01, -2.7536e-01,  1.6007e-01,
         9.5258e-02, -3.4429e-01,  1.6728e-01,  3.0232e-01,  2.1065e-01,
        -9.3216e-02,  6.5847e-02, -5.5111e-02,  6.5773e-01, -4.1490e-01,
         0.0000e+00,  0.0000e+00, -1.9328e-01, -8.2029e-01, -6.4020e-02,
         5.3669e-01,  4.6422e-02, -3.4006e-01, -1.8259e-01, -1.4627e-02,
         0.0000e+00,  4.0856e-01, -3.2098e-02, -1.7225e-01, -5.5690e-01,
        -7.2067e-02, -5.7593e-02, -3.7818e-01, -1.6905e-01,  1.5664e-01,
        -4.8309e-01, -1.2800e+00, -3.2037e+00,  9.6812e-01,  1.7009e+00,
         1.3394e+00,  3.1469e-01,  8.2406e-01, -2.0144e+00, -8.0466e-01,
        -1.0104e+00,  1.9333e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.9434e-02, -1.3831e-01,  0.0000e+00, -1.4905e+00,
        -4.0360e-01, -1.5524e+00,  1.0246e-01, -2.3560e-02,  0.0000e+00,
         0.0000e+00,  8.3697e-03, -1.5481e-01, -7.6564e-02,  1.0933e-01,
         2.4903e-01, -4.4572e-01, -4.1504e-01,  1.0480e-01,  2.1010e-01,
        -3.8213e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2192]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-4.7975e-01, -1.6167e+00, -5.5251e-01, -1.7881e-03,  4.3567e+00,
        -3.5114e-01,  1.3639e+00,  1.3271e+00, -9.6472e-01, -9.5801e-01,
        -4.1834e-03, -1.9898e-01,  2.2943e-01,  5.7273e-01,  2.5503e+00,
        -1.0944e-03, -2.1737e-01, -3.3214e-01,  0.0000e+00, -5.0717e-02,
        -2.9242e-01, -2.5503e-01,  1.4144e-02,  3.5297e-01,  1.5825e+00,
        -9.2067e-01, -3.0061e-01,  0.0000e+00,  8.4623e-02, -8.8211e-01,
         9.6014e-04,  2.5318e-01, -4.3382e-02,  0.0000e+00,  1.1384e+00,
        -1.3600e-02,  2.4599e+00, -2.5919e-01,  7.5326e-02,  7.4560e-01,
        -2.5262e-01, -4.8858e-01,  1.6070e+00, -3.6384e-01,  5.7743e+00,
        -7.7914e-02,  2.5166e+00,  4.2342e-01, -1.0561e+00,  1.3393e+00,
         8.0689e-01, -4.6382e-01, -1.0910e-01, -2.1855e-01,  7.7845e-01,
         2.3948e-01,  2.1400e+00, -7.6941e-02, -2.0483e+00, -1.8413e+00,
         4.9467e-02, -1.7352e+00, -1.0563e+00, -1.6353e+00,  5.2063e-02,
        -8.4755e-01, -8.5137e-01, -2.4456e-01, -8.7060e-03, -6.8216e-01,
         0.0000e+00,  0.0000e+00,  7.7087e+00, -6.7828e-01, -2.7095e-01,
         1.2457e-02, -2.2114e-01,  6.3579e-01,  6.9452e+00, -1.4627e-02,
         0.0000e+00,  3.0474e-01, -6.1411e-01,  1.0833e+00,  1.5821e+00,
        -6.0828e-02, -5.2250e-02, -2.7738e-01, -1.1855e+00,  4.7502e-01,
         1.8004e+00, -7.8204e-01, -3.2037e+00, -1.9508e+00, -1.9736e+00,
        -1.5938e+00, -1.1760e+00, -1.1428e+00,  2.3535e-01, -5.5798e-01,
        -3.2455e-01, -1.6361e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0372e-02, -6.3615e-02,  0.0000e+00, -8.4418e-02,
        -1.2895e+00,  8.1146e-01, -1.2125e-03, -2.3560e-02,  0.0000e+00,
         0.0000e+00, -1.7574e+00,  1.4393e+00, -7.6564e-02,  1.3622e+00,
        -3.0531e-03, -4.9288e-01, -1.1785e+00, -7.6976e-02,  1.1980e-01,
         4.8359e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([949]), tensor(0.))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984]
INFO:main_restricted_month.py:Testing data year: 1985
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 4258
            device: cpu
            
2024-07-27 13:53:42,127	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 13:53:42,171	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 13:53:42,207	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_341f1673add3bf67.zip' (1.40MiB) to Ray cluster...
2024-07-27 13:53:42,212	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_341f1673add3bf67.zip'.
2024-07-27 13:53:43,577	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 14:06:49,197	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_13-53-43' in 0.2280s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 4258, 'embedding_dim': 6, 'dropout_rate': 0.54, 'lr': 3.4419719400899214e-05, 'weight_decay': 0.00016266799643038432, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.01525396201182968
INFO:model_data_nn.py:Best trial testing loss: 0.019379281218725203
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-27_13-53-39_877688_365373/artifacts/2024-07-27_13-53-43/train_fnn_2024-07-27_13-53-43/driver_artifacts/train_fnn_4f777_00077_77_dropout_rate=0.5400,embedding_dim=6,hidden_dim=5,lr=0.0000,num_layers=5,weight_decay=0.0002_2024-07-27_13-53-43
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 4766, 'embedding_dim': 6, 'dropout_rate': 0.54, 'lr': 3.4419719400899214e-05, 'weight_decay': 0.00016266799643038432, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.016449004699230135, 'avg_test_loss': 0.0210263731807851}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.016351985725408393, 'avg_test_loss': 0.02102104762269959}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.016351901009416272, 'avg_test_loss': 0.021018403156041882}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.016350465227432505, 'avg_test_loss': 0.021024014348721635}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.016350204002082563, 'avg_test_loss': 0.021023004250532953}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.016350773306289833, 'avg_test_loss': 0.021040853004848217}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.016357018813567298, 'avg_test_loss': 0.02103881378025904}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.016345971893712702, 'avg_test_loss': 0.021032723950317307}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.01633985615831576, 'avg_test_loss': 0.02103238483129518}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.016335168203294604, 'avg_test_loss': 0.021051269393060765}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.016335779836605977, 'avg_test_loss': 0.021039870124391832}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.016334391723576168, 'avg_test_loss': 0.02102673352512456}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.01634670786767912, 'avg_test_loss': 0.021050189553086993}
INFO:model_data_nn.py:Early stopping at epoch 13
INFO:main_restricted_month.py:Making prediction for data in year: 1986
INFO:main_restricted_month.py:Prediction data shape: (43785,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 1986: 0.14512429937833476
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  43785.000000  43785.000000
mean       0.007006      0.015300
std        0.144800      0.003088
min       -0.808824     -0.000960
25%       -0.068966      0.016314
50%        0.000000      0.016607
75%        0.070270      0.016607
max        3.600000      0.016655
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Train_data: (193362, 161)

INFO:transform_data_nn.py:Test data years: [1986]
INFO:transform_data_nn.py:Test_data: (43785, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:transform_data_nn.py:Retrain_data: (237147, 161)

INFO:transform_data_nn.py:Prediction data years: [1987]
INFO:transform_data_nn.py:Prediction_data: (44352, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([193362, 138])
            y_train_tf: torch.Size([193362])

            x_test_tf: torch.Size([43785, 138])
            y_test_tf: torch.Size([43785])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([237147, 138])
            y_retrain_tf: torch.Size([237147])

            x_prediction_tf: torch.Size([44352, 138])
            y_prediction_tf: torch.Size([44352])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.0606e-01,  2.1628e-01,  1.8668e-01, -1.2410e+00, -1.4494e-01,
        -6.0633e-01, -1.0954e-01, -2.9638e-01,  2.3780e-01, -1.6025e-01,
        -7.1284e-01, -1.8976e-01, -4.4614e-01, -9.4623e-02,  9.0774e-02,
         5.5178e-01, -1.4248e-01,  8.6219e-02,  0.0000e+00,  4.3647e-01,
        -3.7530e-01, -2.5503e-01,  1.0047e-02,  1.1415e-03, -1.0654e-01,
        -2.2533e-01, -5.9233e-01,  0.0000e+00,  4.2527e-01,  8.0503e-01,
         4.9132e-01, -1.4382e-01,  3.9378e-01,  0.0000e+00, -4.2043e-01,
        -1.8670e-01,  7.8142e-02,  4.4022e-01,  1.0672e-01, -1.1782e+00,
        -2.5288e-01,  9.5831e-02,  1.3909e-01, -1.0046e-01, -1.3948e-01,
        -6.6383e-01, -1.2032e-02, -1.1862e-01, -6.2645e-01, -2.4628e-01,
        -6.1617e-01,  6.5491e-01, -1.8197e-01, -2.1855e-01,  2.0195e-02,
         4.4404e-01, -7.7944e-01, -1.0039e-01, -2.7536e-01,  1.6007e-01,
         9.5258e-02, -3.4429e-01,  1.6728e-01,  3.0232e-01,  2.1065e-01,
        -9.3216e-02,  6.5847e-02, -5.5111e-02,  6.5773e-01, -4.1490e-01,
         0.0000e+00,  0.0000e+00, -1.9328e-01, -8.2029e-01, -6.4020e-02,
         5.3669e-01,  4.6422e-02, -3.4006e-01, -1.8259e-01, -1.4627e-02,
         0.0000e+00,  4.0856e-01, -3.2098e-02, -1.7225e-01, -5.5690e-01,
        -7.2067e-02, -5.7593e-02, -3.7818e-01, -1.6905e-01,  1.5664e-01,
        -4.8309e-01, -1.2800e+00, -3.2037e+00,  9.6812e-01,  1.7009e+00,
         1.3394e+00,  3.1469e-01,  8.2406e-01, -2.0144e+00, -8.0466e-01,
        -1.0104e+00,  1.9333e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.9434e-02, -1.3831e-01,  0.0000e+00, -1.4905e+00,
        -4.0360e-01, -1.5524e+00,  1.0246e-01, -2.3560e-02,  0.0000e+00,
         0.0000e+00,  8.3697e-03, -1.5481e-01, -7.6564e-02,  1.0933e-01,
         2.4903e-01, -4.4572e-01, -4.1504e-01,  1.0480e-01,  2.1010e-01,
        -3.8213e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2192]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-4.7975e-01, -1.6167e+00, -5.5251e-01, -1.7881e-03,  4.3567e+00,
        -3.5114e-01,  1.3639e+00,  1.3271e+00, -9.6472e-01, -9.5801e-01,
        -4.1834e-03, -1.9898e-01,  2.2943e-01,  5.7273e-01,  2.5503e+00,
        -1.0944e-03, -2.1737e-01, -3.3214e-01,  0.0000e+00, -5.0717e-02,
        -2.9242e-01, -2.5503e-01,  1.4144e-02,  3.5297e-01,  1.5825e+00,
        -9.2067e-01, -3.0061e-01,  0.0000e+00,  8.4623e-02, -8.8211e-01,
         9.6014e-04,  2.5318e-01, -4.3382e-02,  0.0000e+00,  1.1384e+00,
        -1.3600e-02,  2.4599e+00, -2.5919e-01,  7.5326e-02,  7.4560e-01,
        -2.5262e-01, -4.8858e-01,  1.6070e+00, -3.6384e-01,  5.7743e+00,
        -7.7914e-02,  2.5166e+00,  4.2342e-01, -1.0561e+00,  1.3393e+00,
         8.0689e-01, -4.6382e-01, -1.0910e-01, -2.1855e-01,  7.7845e-01,
         2.3948e-01,  2.1400e+00, -7.6941e-02, -2.0483e+00, -1.8413e+00,
         4.9467e-02, -1.7352e+00, -1.0563e+00, -1.6353e+00,  5.2063e-02,
        -8.4755e-01, -8.5137e-01, -2.4456e-01, -8.7060e-03, -6.8216e-01,
         0.0000e+00,  0.0000e+00,  7.7087e+00, -6.7828e-01, -2.7095e-01,
         1.2457e-02, -2.2114e-01,  6.3579e-01,  6.9452e+00, -1.4627e-02,
         0.0000e+00,  3.0474e-01, -6.1411e-01,  1.0833e+00,  1.5821e+00,
        -6.0828e-02, -5.2250e-02, -2.7738e-01, -1.1855e+00,  4.7502e-01,
         1.8004e+00, -7.8204e-01, -3.2037e+00, -1.9508e+00, -1.9736e+00,
        -1.5938e+00, -1.1760e+00, -1.1428e+00,  2.3535e-01, -5.5798e-01,
        -3.2455e-01, -1.6361e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0372e-02, -6.3615e-02,  0.0000e+00, -8.4418e-02,
        -1.2895e+00,  8.1146e-01, -1.2125e-03, -2.3560e-02,  0.0000e+00,
         0.0000e+00, -1.7574e+00,  1.4393e+00, -7.6564e-02,  1.3622e+00,
        -3.0531e-03, -4.9288e-01, -1.1785e+00, -7.6976e-02,  1.1980e-01,
         4.8359e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([949]), tensor(0.))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-0.1378,  0.2011,  0.1735, -1.2736, -0.1414, -0.6129, -0.1248, -0.3115,
         0.2968, -0.1604, -0.7119, -0.1284, -0.4702, -0.0566,  0.0624,  0.5452,
        -0.1485,  0.1085,  0.0000,  0.4475, -0.3672, -0.2125,  0.0325,  0.0146,
        -0.0833, -0.2362, -0.5806,  0.0000,  0.3954,  0.8854,  0.4877, -0.1312,
         0.4150,  0.0000, -0.4067, -0.2013,  0.0756,  0.4689,  0.0805, -1.1706,
        -0.2576,  0.0846,  0.1459, -0.0784, -0.1491, -0.6672, -0.0211, -0.1119,
        -0.5597, -0.2513, -0.6202,  0.6533, -0.1762, -0.0731,  0.0316,  0.4455,
        -0.7773, -0.0479, -0.2733,  0.0933,  0.1035, -0.3434,  0.1623,  0.2965,
         0.2079, -0.1035,  0.0400, -0.0618,  0.7032, -0.4171,  0.0000,  0.0000,
         0.0282, -0.8190, -0.0195,  0.5824,  0.0410, -0.3436, -0.1796, -0.0104,
         0.0000,  0.3771,  0.0150, -0.2020, -0.5611, -0.0783, -0.0633, -0.3700,
        -0.1631,  0.1329, -0.5081, -1.2896,  0.2434,  1.0516,  1.6154,  1.4313,
         0.4921,  1.0178, -2.2250, -0.7145, -1.0838,  0.1765,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0681,  0.1245,  0.0000, -1.6484, -0.1374, -1.7709,
         0.1165,  0.0567,  0.0000,  0.0000,  0.0141, -0.1652, -0.0921,  0.0665,
         0.2107, -0.4339, -0.4025,  0.1455,  0.2247, -0.3825,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([1941]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([ 1.8020e+00,  1.9152e+00,  3.4486e-01, -1.8913e-01,  1.3689e+00,
         2.6924e+00, -8.9300e-01, -7.8639e-01, -4.9107e-01, -6.5433e-01,
        -5.3155e-01, -1.2724e-01,  2.2762e-01, -3.8230e-01,  1.8586e+00,
         2.3049e+00, -2.2689e-01,  3.8296e+00,  0.0000e+00,  3.2700e+00,
         5.0575e-03, -2.1251e-01,  2.0621e-02, -2.5567e-03,  6.3772e-02,
         1.0327e+00,  2.0287e+00,  0.0000e+00, -1.3956e+00, -8.2966e-01,
        -4.6975e-01, -1.4919e-01,  4.2877e-02,  0.0000e+00,  1.2218e+00,
        -2.0587e-01,  2.0151e-01,  5.4386e-01,  4.6245e+00, -5.7104e-01,
         3.3704e-01, -5.3257e-01,  2.2907e+00, -3.5756e-01,  2.8893e+00,
        -1.0363e+00, -2.0763e-01, -1.0985e+00, -6.9351e-01,  1.0851e-01,
        -6.2015e-01, -1.1060e+00, -1.3256e-01, -7.3100e-02, -7.3521e-01,
         4.8096e-02,  1.0329e+00, -3.2643e-01,  6.0915e-01,  3.3914e+00,
         1.9910e-01,  6.6620e-01,  8.5977e-01,  5.6841e-01, -1.9664e+00,
         3.9913e-01,  1.1799e+00, -6.0768e-01, -1.2768e+00, -3.7900e-01,
         0.0000e+00,  0.0000e+00,  2.8222e-02, -6.5080e-01, -1.0827e-01,
         1.6211e+00, -7.8200e-02, -3.9600e-01,  2.2145e-01, -9.8606e-01,
         0.0000e+00,  2.3511e+00, -2.7285e-01,  1.9970e+00, -6.8303e-02,
        -4.8069e-02, -4.9363e-02, -3.5668e-01, -2.2977e-01, -1.3200e-01,
        -6.0629e-01,  3.0339e+00,  2.4336e-01, -1.5991e+00, -1.6971e+00,
        -1.5188e+00, -6.1921e-01, -1.3641e+00,  1.8554e-01, -2.9779e-01,
        -3.4293e-01,  1.8998e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6694e-02,  1.2451e-01,  0.0000e+00,  7.3645e-01,
        -1.3529e+00,  3.0857e-01, -2.1738e-02,  5.6721e-02,  0.0000e+00,
         0.0000e+00,  2.7793e+00,  5.4316e-01, -9.2059e-02,  3.3375e-01,
         1.7586e+00,  4.1795e-01, -6.4637e-02,  4.0987e-03,  4.2907e-02,
         3.3521e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3196]), tensor(0.0417))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:main_restricted_month.py:Testing data year: 1986
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 4766
            device: cpu
            
2024-07-27 14:35:15,596	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 14:35:15,637	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 14:35:15,673	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_341f1673add3bf67.zip' (1.40MiB) to Ray cluster...
2024-07-27 14:35:15,677	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_341f1673add3bf67.zip'.
2024-07-27 14:35:17,040	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 14:52:20,869	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_14-35-17' in 0.2139s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 95, 'num_layers': 4, 'num_embeddings': 4766, 'embedding_dim': 6, 'dropout_rate': 0.29, 'lr': 0.00755681014127443, 'weight_decay': 0.00021154290797261238, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.016403712735041077
INFO:model_data_nn.py:Best trial testing loss: 0.02100290540524208
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-27_14-35-13_360453_365373/artifacts/2024-07-27_14-35-17/train_fnn_2024-07-27_14-35-17/driver_artifacts/train_fnn_1daf9_00007_7_dropout_rate=0.2900,embedding_dim=6,hidden_dim=95,lr=0.0076,num_layers=4,weight_decay=0.0002_2024-07-27_14-35-17
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 95, 'num_layers': 4, 'num_embeddings': 5109, 'embedding_dim': 6, 'dropout_rate': 0.29, 'lr': 0.00755681014127443, 'weight_decay': 0.00021154290797261238, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.01737888266759157, 'avg_test_loss': 0.03013129545574602}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.017272016747854148, 'avg_test_loss': 0.030226351584416705}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.01727404114596759, 'avg_test_loss': 0.030078652625282604}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.017272280263013362, 'avg_test_loss': 0.030987506079209314}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.017281681491832034, 'avg_test_loss': 0.029939798906332617}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.01727020027554713, 'avg_test_loss': 0.029998219448368873}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.017273201728546243, 'avg_test_loss': 0.030120230117251002}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.017276690145391575, 'avg_test_loss': 0.030484423298028553}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.017272540159810976, 'avg_test_loss': 0.02991228857417665}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.017283708753900607, 'avg_test_loss': 0.030243224344077866}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.0172786527854595, 'avg_test_loss': 0.0304231382422633}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.017280980806040822, 'avg_test_loss': 0.03072333394604887}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.017277186435028603, 'avg_test_loss': 0.03017751011435711}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.017267906420758115, 'avg_test_loss': 0.030059587854144806}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.017266974835322354, 'avg_test_loss': 0.029919049337043993}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.017269685201138796, 'avg_test_loss': 0.03039312366165038}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.017277219641352592, 'avg_test_loss': 0.030114907809650097}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.01728082353063732, 'avg_test_loss': 0.030142219403884972}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.017274655124521376, 'avg_test_loss': 0.03027143891064872}
INFO:model_data_nn.py:Early stopping at epoch 19
INFO:main_restricted_month.py:Making prediction for data in year: 1987
INFO:main_restricted_month.py:Prediction data shape: (44352,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 1987: 0.1739868930233296
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  44352.000000  44352.000000
mean      -0.003042      0.016846
std        0.172848      0.000000
min       -0.875000      0.016846
25%       -0.079210      0.016846
50%        0.000000      0.016846
75%        0.077401      0.016846
max        2.750000      0.016846
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:transform_data_nn.py:Train_data: (237147, 161)

INFO:transform_data_nn.py:Test data years: [1987]
INFO:transform_data_nn.py:Test_data: (44352, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:transform_data_nn.py:Retrain_data: (281499, 161)

INFO:transform_data_nn.py:Prediction data years: [1988]
INFO:transform_data_nn.py:Prediction_data: (46885, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([237147, 138])
            y_train_tf: torch.Size([237147])

            x_test_tf: torch.Size([44352, 138])
            y_test_tf: torch.Size([44352])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([281499, 138])
            y_retrain_tf: torch.Size([281499])

            x_prediction_tf: torch.Size([46885, 138])
            y_prediction_tf: torch.Size([46885])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-0.1378,  0.2011,  0.1735, -1.2736, -0.1414, -0.6129, -0.1248, -0.3115,
         0.2968, -0.1604, -0.7119, -0.1284, -0.4702, -0.0566,  0.0624,  0.5452,
        -0.1485,  0.1085,  0.0000,  0.4475, -0.3672, -0.2125,  0.0325,  0.0146,
        -0.0833, -0.2362, -0.5806,  0.0000,  0.3954,  0.8854,  0.4877, -0.1312,
         0.4150,  0.0000, -0.4067, -0.2013,  0.0756,  0.4689,  0.0805, -1.1706,
        -0.2576,  0.0846,  0.1459, -0.0784, -0.1491, -0.6672, -0.0211, -0.1119,
        -0.5597, -0.2513, -0.6202,  0.6533, -0.1762, -0.0731,  0.0316,  0.4455,
        -0.7773, -0.0479, -0.2733,  0.0933,  0.1035, -0.3434,  0.1623,  0.2965,
         0.2079, -0.1035,  0.0400, -0.0618,  0.7032, -0.4171,  0.0000,  0.0000,
         0.0282, -0.8190, -0.0195,  0.5824,  0.0410, -0.3436, -0.1796, -0.0104,
         0.0000,  0.3771,  0.0150, -0.2020, -0.5611, -0.0783, -0.0633, -0.3700,
        -0.1631,  0.1329, -0.5081, -1.2896,  0.2434,  1.0516,  1.6154,  1.4313,
         0.4921,  1.0178, -2.2250, -0.7145, -1.0838,  0.1765,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0681,  0.1245,  0.0000, -1.6484, -0.1374, -1.7709,
         0.1165,  0.0567,  0.0000,  0.0000,  0.0141, -0.1652, -0.0921,  0.0665,
         0.2107, -0.4339, -0.4025,  0.1455,  0.2247, -0.3825,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([1941]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([ 1.8020e+00,  1.9152e+00,  3.4486e-01, -1.8913e-01,  1.3689e+00,
         2.6924e+00, -8.9300e-01, -7.8639e-01, -4.9107e-01, -6.5433e-01,
        -5.3155e-01, -1.2724e-01,  2.2762e-01, -3.8230e-01,  1.8586e+00,
         2.3049e+00, -2.2689e-01,  3.8296e+00,  0.0000e+00,  3.2700e+00,
         5.0575e-03, -2.1251e-01,  2.0621e-02, -2.5567e-03,  6.3772e-02,
         1.0327e+00,  2.0287e+00,  0.0000e+00, -1.3956e+00, -8.2966e-01,
        -4.6975e-01, -1.4919e-01,  4.2877e-02,  0.0000e+00,  1.2218e+00,
        -2.0587e-01,  2.0151e-01,  5.4386e-01,  4.6245e+00, -5.7104e-01,
         3.3704e-01, -5.3257e-01,  2.2907e+00, -3.5756e-01,  2.8893e+00,
        -1.0363e+00, -2.0763e-01, -1.0985e+00, -6.9351e-01,  1.0851e-01,
        -6.2015e-01, -1.1060e+00, -1.3256e-01, -7.3100e-02, -7.3521e-01,
         4.8096e-02,  1.0329e+00, -3.2643e-01,  6.0915e-01,  3.3914e+00,
         1.9910e-01,  6.6620e-01,  8.5977e-01,  5.6841e-01, -1.9664e+00,
         3.9913e-01,  1.1799e+00, -6.0768e-01, -1.2768e+00, -3.7900e-01,
         0.0000e+00,  0.0000e+00,  2.8222e-02, -6.5080e-01, -1.0827e-01,
         1.6211e+00, -7.8200e-02, -3.9600e-01,  2.2145e-01, -9.8606e-01,
         0.0000e+00,  2.3511e+00, -2.7285e-01,  1.9970e+00, -6.8303e-02,
        -4.8069e-02, -4.9363e-02, -3.5668e-01, -2.2977e-01, -1.3200e-01,
        -6.0629e-01,  3.0339e+00,  2.4336e-01, -1.5991e+00, -1.6971e+00,
        -1.5188e+00, -6.1921e-01, -1.3641e+00,  1.8554e-01, -2.9779e-01,
        -3.4293e-01,  1.8998e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6694e-02,  1.2451e-01,  0.0000e+00,  7.3645e-01,
        -1.3529e+00,  3.0857e-01, -2.1738e-02,  5.6721e-02,  0.0000e+00,
         0.0000e+00,  2.7793e+00,  5.4316e-01, -9.2059e-02,  3.3375e-01,
         1.7586e+00,  4.1795e-01, -6.4637e-02,  4.0987e-03,  4.2907e-02,
         3.3521e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3196]), tensor(0.0417))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.6485e-01,  1.8230e-01,  1.7097e-01, -1.2895e+00, -1.4861e-01,
        -6.3361e-01, -1.3953e-01, -3.2412e-01,  3.5052e-01, -1.6415e-01,
        -7.1298e-01, -8.7418e-02, -4.8984e-01, -2.8638e-02,  5.3805e-02,
         5.3585e-01, -1.5057e-01,  1.4105e-01,  0.0000e+00,  4.4826e-01,
        -3.6039e-01, -2.0729e-02,  2.5868e-02,  2.6469e-03, -6.5325e-02,
        -2.4458e-01, -5.7430e-01,  0.0000e+00,  3.6729e-01,  9.5292e-01,
         4.8242e-01, -1.2829e-01,  4.3593e-01,  0.0000e+00, -3.9010e-01,
        -1.9800e-01,  7.8118e-02,  4.8214e-01,  6.1557e-02, -1.1636e+00,
        -2.6444e-01,  1.3808e-01,  1.6335e-01, -6.4053e-02, -1.6169e-01,
        -6.7458e-01,  5.4317e-03, -7.7477e-02, -5.5695e-01, -2.3816e-01,
        -6.2338e-01,  6.4888e-01, -1.6650e-01, -1.9579e-03,  2.7732e-02,
         4.4700e-01, -7.7374e-01, -1.7885e-02, -2.7024e-01,  5.4831e-02,
         1.0554e-01, -3.3980e-01,  1.6083e-01,  2.9301e-01,  1.9625e-01,
        -1.0893e-01,  1.9625e-02, -6.5275e-02,  7.2753e-01, -4.1686e-01,
         0.0000e+00,  0.0000e+00, -1.7687e-02, -8.1674e-01,  1.3622e-02,
         6.0146e-01,  4.2794e-02, -3.4357e-01, -1.8006e-01, -1.1661e-02,
         0.0000e+00,  3.4367e-01,  5.3540e-02, -2.1577e-01, -5.6823e-01,
        -8.4531e-02, -6.9139e-02, -3.6387e-01, -1.5407e-01,  1.0011e-01,
        -5.2393e-01, -1.2947e+00,  1.1243e-01,  1.0997e+00,  1.5975e+00,
         1.5071e+00,  5.2009e-01,  1.1836e+00, -2.4439e+00, -5.6879e-01,
        -2.7414e-01,  1.5649e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.1913e-02, -4.5387e-02,  0.0000e+00, -1.7755e+00,
         4.2778e-02, -1.9666e+00,  1.2646e-01,  9.4528e-02,  0.0000e+00,
         0.0000e+00,  2.1740e-02, -1.7337e-01, -8.7121e-02,  3.3313e-02,
         1.9914e-01, -4.1977e-01, -3.9246e-01,  1.7793e-01,  2.3912e-01,
        -3.9531e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2148]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-1.1594e-02, -5.2073e-03, -6.3248e-01, -8.0822e-01, -7.0266e-01,
        -1.4151e-01, -1.8634e+00, -1.0292e+00, -8.8950e-03,  9.8507e-03,
        -3.5172e-01, -2.3780e-01,  5.1335e-02, -3.8287e-03,  3.3370e-02,
        -1.4351e+00, -2.2808e-01, -1.2205e-01,  0.0000e+00, -2.4636e-01,
         3.8865e-01, -2.0729e-02,  8.3911e-03,  3.7377e-02,  7.5325e-03,
        -6.3693e-01, -7.4307e-01,  0.0000e+00, -7.7996e-01,  3.6407e-02,
        -9.5491e-01, -3.4028e-01,  4.7802e-02,  0.0000e+00, -2.4158e+00,
         7.5641e-03, -6.2660e-01, -6.6273e-01, -2.9067e-01, -7.8528e-01,
         6.4925e-01, -9.4471e-01, -5.3122e-01, -1.8937e-01,  1.4665e-02,
        -1.4826e-01, -5.0533e-01, -3.3594e-01, -2.8811e-01, -7.2144e-03,
         1.2393e-01, -1.4796e+00, -4.8504e-01, -1.9579e-03, -7.4145e-01,
        -1.6221e+00, -1.0965e+00, -3.7581e-01, -5.2418e-02,  1.4472e-02,
        -2.8946e+00, -4.9031e-02, -8.8467e-02, -5.0532e+00, -9.7408e-03,
        -3.8957e-01, -1.0467e-02,  1.8309e+00, -5.8154e-01, -3.6450e-01,
         0.0000e+00,  0.0000e+00, -1.7687e-02,  8.9230e-02, -1.9116e-01,
        -2.3047e-01, -1.4984e-01,  3.2335e+00, -2.0202e-01, -1.1661e-02,
         0.0000e+00, -1.0029e+00, -2.6086e-02,  2.4173e+00,  3.8172e+00,
        -7.2883e-02, -6.3519e-02, -2.3079e-01,  6.0293e-01, -2.8818e-01,
         7.5226e-01,  5.6420e-01,  1.1243e-01, -7.3275e-01, -5.6379e-01,
        -1.0268e+00,  6.7123e-01, -1.0431e+00,  7.4876e-01, -9.3762e-01,
         5.1446e-01, -7.1605e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.0050e-02, -4.5387e-02,  0.0000e+00, -1.2264e+00,
        -1.4060e+00,  7.4562e-02, -1.6812e-02,  5.0167e+00,  0.0000e+00,
         0.0000e+00, -1.4247e+00, -2.3928e-01, -8.7121e-02,  1.6202e+00,
         2.5870e-03,  7.5664e-01, -3.9878e-01, -8.1722e-02, -1.6801e-02,
         1.0158e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2598]), tensor(0.0638))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:main_restricted_month.py:Testing data year: 1987
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 5109
            device: cpu
            
2024-07-27 15:28:36,643	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 15:28:36,687	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 15:28:36,728	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_341f1673add3bf67.zip' (1.40MiB) to Ray cluster...
2024-07-27 15:28:36,733	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_341f1673add3bf67.zip'.
2024-07-27 15:28:38,201	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 15:47:41,226	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_15-28-38' in 0.2428s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 4, 'num_embeddings': 5109, 'embedding_dim': 9, 'dropout_rate': 0.19, 'lr': 2.318177611290354e-06, 'weight_decay': 9.076970265355115e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.016956338622490186
INFO:model_data_nn.py:Best trial testing loss: 0.029437972818639715
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-27_15-28-34_282229_365373/artifacts/2024-07-27_15-28-38/train_fnn_2024-07-27_15-28-38/driver_artifacts/train_fnn_91ba1_00064_64_dropout_rate=0.1900,embedding_dim=9,hidden_dim=35,lr=0.0000,num_layers=4,weight_decay=0.0000_2024-07-27_15-28-38
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 4, 'num_embeddings': 5697, 'embedding_dim': 9, 'dropout_rate': 0.19, 'lr': 2.318177611290354e-06, 'weight_decay': 9.076970265355115e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.019811411120190584, 'avg_test_loss': 0.02206497793600451}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.019591973715015712, 'avg_test_loss': 0.021985262818825093}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.019478070572849383, 'avg_test_loss': 0.021939952373072648}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.019390339734806347, 'avg_test_loss': 0.021888751395257623}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.019336373114183115, 'avg_test_loss': 0.02187226651462575}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.019303431294398616, 'avg_test_loss': 0.021862551350766566}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.019277037041751696, 'avg_test_loss': 0.021842737077375794}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.019252633578756922, 'avg_test_loss': 0.021823862048519056}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.01924035550664859, 'avg_test_loss': 0.021822391853872355}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.01922668794180184, 'avg_test_loss': 0.021808467902266006}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.019218151390706647, 'avg_test_loss': 0.021798146505539}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.019201994635936217, 'avg_test_loss': 0.02179147817174133}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.019195202389356427, 'avg_test_loss': 0.021796023766325955}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.019192352751661604, 'avg_test_loss': 0.021790746353899534}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.019184769845137232, 'avg_test_loss': 0.021792055638748416}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.019181844135917846, 'avg_test_loss': 0.02179457375520553}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.019179083915775805, 'avg_test_loss': 0.02180471271340002}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.01916490863679664, 'avg_test_loss': 0.021789885288368692}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.019156782319004983, 'avg_test_loss': 0.02179059473001036}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.019149664377022615, 'avg_test_loss': 0.021783902505819276}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.019137329925706974, 'avg_test_loss': 0.021808462258108154}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.019134185110096243, 'avg_test_loss': 0.021822558588565594}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.01912690522468891, 'avg_test_loss': 0.0218131676593244}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.019120837652187344, 'avg_test_loss': 0.021795342197339335}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.019111181215971038, 'avg_test_loss': 0.021807788472589597}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.019107179076117184, 'avg_test_loss': 0.02180405926546349}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.01908636783385384, 'avg_test_loss': 0.021837967931703343}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.019090127277057375, 'avg_test_loss': 0.021827779606741943}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.019077805401772178, 'avg_test_loss': 0.021826433588967926}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.01907178025388259, 'avg_test_loss': 0.021826410935149816}
INFO:model_data_nn.py:Early stopping at epoch 30
INFO:main_restricted_month.py:Making prediction for data in year: 1988
INFO:main_restricted_month.py:Prediction data shape: (46885,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 1988: 0.14774617279626948
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  46885.000000  46885.000000
mean       0.017541      0.004181
std        0.147384      0.010463
min       -0.847619     -0.115111
25%       -0.052632     -0.000589
50%        0.000000      0.005653
75%        0.070922      0.010830
max        5.562500      0.081055
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:transform_data_nn.py:Train_data: (281499, 161)

INFO:transform_data_nn.py:Test data years: [1988]
INFO:transform_data_nn.py:Test_data: (46885, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:transform_data_nn.py:Retrain_data: (328384, 161)

INFO:transform_data_nn.py:Prediction data years: [1989]
INFO:transform_data_nn.py:Prediction_data: (47501, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([281499, 138])
            y_train_tf: torch.Size([281499])

            x_test_tf: torch.Size([46885, 138])
            y_test_tf: torch.Size([46885])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([328384, 138])
            y_retrain_tf: torch.Size([328384])

            x_prediction_tf: torch.Size([47501, 138])
            y_prediction_tf: torch.Size([47501])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.6485e-01,  1.8230e-01,  1.7097e-01, -1.2895e+00, -1.4861e-01,
        -6.3361e-01, -1.3953e-01, -3.2412e-01,  3.5052e-01, -1.6415e-01,
        -7.1298e-01, -8.7418e-02, -4.8984e-01, -2.8638e-02,  5.3805e-02,
         5.3585e-01, -1.5057e-01,  1.4105e-01,  0.0000e+00,  4.4826e-01,
        -3.6039e-01, -2.0729e-02,  2.5868e-02,  2.6469e-03, -6.5325e-02,
        -2.4458e-01, -5.7430e-01,  0.0000e+00,  3.6729e-01,  9.5292e-01,
         4.8242e-01, -1.2829e-01,  4.3593e-01,  0.0000e+00, -3.9010e-01,
        -1.9800e-01,  7.8118e-02,  4.8214e-01,  6.1557e-02, -1.1636e+00,
        -2.6444e-01,  1.3808e-01,  1.6335e-01, -6.4053e-02, -1.6169e-01,
        -6.7458e-01,  5.4317e-03, -7.7477e-02, -5.5695e-01, -2.3816e-01,
        -6.2338e-01,  6.4888e-01, -1.6650e-01, -1.9579e-03,  2.7732e-02,
         4.4700e-01, -7.7374e-01, -1.7885e-02, -2.7024e-01,  5.4831e-02,
         1.0554e-01, -3.3980e-01,  1.6083e-01,  2.9301e-01,  1.9625e-01,
        -1.0893e-01,  1.9625e-02, -6.5275e-02,  7.2753e-01, -4.1686e-01,
         0.0000e+00,  0.0000e+00, -1.7687e-02, -8.1674e-01,  1.3622e-02,
         6.0146e-01,  4.2794e-02, -3.4357e-01, -1.8006e-01, -1.1661e-02,
         0.0000e+00,  3.4367e-01,  5.3540e-02, -2.1577e-01, -5.6823e-01,
        -8.4531e-02, -6.9139e-02, -3.6387e-01, -1.5407e-01,  1.0011e-01,
        -5.2393e-01, -1.2947e+00,  1.1243e-01,  1.0997e+00,  1.5975e+00,
         1.5071e+00,  5.2009e-01,  1.1836e+00, -2.4439e+00, -5.6879e-01,
        -2.7414e-01,  1.5649e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.1913e-02, -4.5387e-02,  0.0000e+00, -1.7755e+00,
         4.2778e-02, -1.9666e+00,  1.2646e-01,  9.4528e-02,  0.0000e+00,
         0.0000e+00,  2.1740e-02, -1.7337e-01, -8.7121e-02,  3.3313e-02,
         1.9914e-01, -4.1977e-01, -3.9246e-01,  1.7793e-01,  2.3912e-01,
        -3.9531e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2148]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-1.1594e-02, -5.2073e-03, -6.3248e-01, -8.0822e-01, -7.0266e-01,
        -1.4151e-01, -1.8634e+00, -1.0292e+00, -8.8950e-03,  9.8507e-03,
        -3.5172e-01, -2.3780e-01,  5.1335e-02, -3.8287e-03,  3.3370e-02,
        -1.4351e+00, -2.2808e-01, -1.2205e-01,  0.0000e+00, -2.4636e-01,
         3.8865e-01, -2.0729e-02,  8.3911e-03,  3.7377e-02,  7.5325e-03,
        -6.3693e-01, -7.4307e-01,  0.0000e+00, -7.7996e-01,  3.6407e-02,
        -9.5491e-01, -3.4028e-01,  4.7802e-02,  0.0000e+00, -2.4158e+00,
         7.5641e-03, -6.2660e-01, -6.6273e-01, -2.9067e-01, -7.8528e-01,
         6.4925e-01, -9.4471e-01, -5.3122e-01, -1.8937e-01,  1.4665e-02,
        -1.4826e-01, -5.0533e-01, -3.3594e-01, -2.8811e-01, -7.2144e-03,
         1.2393e-01, -1.4796e+00, -4.8504e-01, -1.9579e-03, -7.4145e-01,
        -1.6221e+00, -1.0965e+00, -3.7581e-01, -5.2418e-02,  1.4472e-02,
        -2.8946e+00, -4.9031e-02, -8.8467e-02, -5.0532e+00, -9.7408e-03,
        -3.8957e-01, -1.0467e-02,  1.8309e+00, -5.8154e-01, -3.6450e-01,
         0.0000e+00,  0.0000e+00, -1.7687e-02,  8.9230e-02, -1.9116e-01,
        -2.3047e-01, -1.4984e-01,  3.2335e+00, -2.0202e-01, -1.1661e-02,
         0.0000e+00, -1.0029e+00, -2.6086e-02,  2.4173e+00,  3.8172e+00,
        -7.2883e-02, -6.3519e-02, -2.3079e-01,  6.0293e-01, -2.8818e-01,
         7.5226e-01,  5.6420e-01,  1.1243e-01, -7.3275e-01, -5.6379e-01,
        -1.0268e+00,  6.7123e-01, -1.0431e+00,  7.4876e-01, -9.3762e-01,
         5.1446e-01, -7.1605e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.0050e-02, -4.5387e-02,  0.0000e+00, -1.2264e+00,
        -1.4060e+00,  7.4562e-02, -1.6812e-02,  5.0167e+00,  0.0000e+00,
         0.0000e+00, -1.4247e+00, -2.3928e-01, -8.7121e-02,  1.6202e+00,
         2.5870e-03,  7.5664e-01, -3.9878e-01, -8.1722e-02, -1.6801e-02,
         1.0158e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2598]), tensor(0.0638))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.9844e-01,  1.5880e-01,  1.6742e-01, -1.2964e+00, -1.4980e-01,
        -6.3783e-01, -1.5070e-01, -3.3081e-01,  3.6132e-01, -1.5750e-01,
        -7.1271e-01, -3.7380e-02, -4.9664e-01,  9.8005e-03,  3.3467e-02,
         5.2172e-01, -1.3992e-01,  1.7420e-01,  0.0000e+00,  4.3468e-01,
        -3.6828e-01,  7.5725e-02,  2.5460e-02,  9.3107e-03, -6.7596e-02,
        -2.5247e-01, -5.6868e-01,  0.0000e+00,  3.8144e-01,  1.0111e+00,
         4.7515e-01, -1.2195e-01,  4.4010e-01,  0.0000e+00, -3.8085e-01,
        -1.9431e-01,  6.8593e-02,  5.1761e-01,  3.3254e-02, -1.1662e+00,
        -2.7735e-01,  2.7510e-01,  1.9260e-01, -6.6024e-02, -1.7060e-01,
        -6.7784e-01,  8.4519e-02, -8.4395e-02, -5.4257e-01, -1.9077e-01,
        -6.1714e-01,  6.5989e-01, -1.6348e-01,  1.0159e-03,  2.1732e-02,
         4.4457e-01, -7.6868e-01, -1.5251e-04, -2.6248e-01,  2.1522e-02,
         1.1277e-01, -3.2948e-01,  1.5361e-01,  2.8391e-01,  1.4703e-01,
        -1.1827e-01,  2.8385e-03, -7.3083e-02,  7.4370e-01, -4.1918e-01,
         0.0000e+00,  0.0000e+00, -2.3610e-01, -8.1725e-01,  3.7470e-02,
         5.8416e-01,  4.2455e-02, -3.4501e-01, -1.8188e-01, -2.3916e-03,
         0.0000e+00,  2.8639e-01,  6.1073e-02, -2.5530e-01, -5.5517e-01,
        -9.0869e-02, -7.4242e-02, -3.6215e-01, -1.4420e-01,  1.0281e-01,
        -5.1478e-01, -1.2853e+00,  4.8167e-02,  1.2549e+00,  1.7486e+00,
         1.6574e+00,  5.6220e-01,  1.3352e+00, -2.6341e+00, -4.1360e-01,
        -2.9873e-01,  1.2191e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.2007e-02,  2.3354e-01,  0.0000e+00, -1.4879e+00,
         2.6651e-01, -2.1535e+00,  1.3354e-01,  2.7724e-02,  0.0000e+00,
         0.0000e+00,  2.5039e-02, -1.7800e-01,  7.3311e-03,  7.8641e-03,
         1.7098e-01, -4.2237e-01, -3.8414e-01,  1.9750e-01,  2.4554e-01,
        -3.9752e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2368]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-1.1408e-02,  2.9146e-03, -6.1383e-01, -4.2858e-01, -2.9630e-01,
        -6.0289e-02, -1.9494e+00, -1.0588e+00, -3.6764e-02,  1.0514e-01,
        -2.3164e-02,  1.5815e-02, -4.1062e-02, -1.5777e-02,  4.1894e-02,
         3.7534e-01, -2.2006e-01, -4.8981e-01,  0.0000e+00,  2.6484e-03,
        -8.1112e-02,  7.5725e-02,  4.7021e-02,  9.6214e-01, -9.3196e-03,
        -5.7378e-03, -7.2997e-01,  0.0000e+00, -1.4391e+00,  4.6592e-02,
         4.3140e-01, -1.7324e-01,  2.7589e-01,  0.0000e+00,  4.8498e-04,
        -6.5325e-01,  7.3700e-03, -6.8489e-01, -8.4842e-01, -7.9342e-01,
         8.1526e-01,  9.7328e-02,  1.1858e-02,  2.3842e-02, -5.9593e-03,
         3.5118e-01,  8.3150e-02, -2.4606e-01, -4.1683e-01,  5.9663e-02,
         8.9991e-01, -1.3893e+00, -5.1699e-01, -2.5068e+00, -7.4364e-01,
         1.1063e-02, -1.0926e+00,  6.9774e-01,  6.0065e-03, -3.9788e-01,
        -6.2875e-03,  6.3306e-03,  1.2690e-02,  1.5952e-02, -2.4946e-02,
         4.0374e-03, -5.0861e-03,  1.7707e+00,  1.3950e+00, -1.1070e-02,
         0.0000e+00,  0.0000e+00, -2.3610e-01,  6.2752e-01,  1.6399e-02,
        -8.9769e-02,  3.0359e-04, -2.2936e-04,  6.4728e-04, -2.3916e-03,
         0.0000e+00, -3.2955e-01, -5.9469e-02, -4.4773e-01, -5.7442e-01,
        -7.8031e-02, -6.8496e-02,  2.5780e-02, -2.3675e-03, -9.3063e-02,
        -6.5661e-01,  6.1256e-01,  4.8167e-02, -6.9923e-01,  9.4130e-02,
        -1.0595e+00, -1.2968e+00, -1.1704e-01, -7.1630e-01, -1.0437e+00,
        -2.7773e-01, -9.0227e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0181e-02,  2.3354e-01,  0.0000e+00, -1.2998e+00,
        -1.2019e+00,  4.1334e-01,  6.2665e-02,  2.7724e-02,  0.0000e+00,
         0.0000e+00,  1.3064e-02, -2.0316e-01,  7.3311e-03, -1.8639e-02,
        -1.0349e-02,  1.1680e-03, -2.4945e-02,  2.4751e-01,  1.9720e-01,
         1.3884e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2529]), tensor(0.0196))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:main_restricted_month.py:Testing data year: 1988
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 5697
            device: cpu
            
2024-07-27 16:33:21,051	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 16:33:21,116	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 16:33:21,159	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_341f1673add3bf67.zip' (1.40MiB) to Ray cluster...
2024-07-27 16:33:21,164	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_341f1673add3bf67.zip'.
2024-07-27 16:33:22,699	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 16:52:46,494	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_16-33-22' in 0.2748s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 5697, 'embedding_dim': 1, 'dropout_rate': 0.49, 'lr': 1.036720427012069e-05, 'weight_decay': 5.503363365456109e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.018386484882755155
INFO:model_data_nn.py:Best trial testing loss: 0.02164919090191713
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-27_16-33-18_693928_365373/artifacts/2024-07-27_16-33-22/train_fnn_2024-07-27_16-33-22/driver_artifacts/train_fnn_9d116_00020_20_dropout_rate=0.4900,embedding_dim=1,hidden_dim=85,lr=0.0000,num_layers=4,weight_decay=0.0000_2024-07-27_16-33-22
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 6283, 'embedding_dim': 1, 'dropout_rate': 0.49, 'lr': 1.036720427012069e-05, 'weight_decay': 5.503363365456109e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.02138650378176394, 'avg_test_loss': 0.023543203828046613}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.019670394796782262, 'avg_test_loss': 0.02353233443247217}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.019602166674268846, 'avg_test_loss': 0.02353557986100762}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.019595489725510475, 'avg_test_loss': 0.023535696337749105}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.01958456742592683, 'avg_test_loss': 0.023539322952352573}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.019576157137019736, 'avg_test_loss': 0.023537939300943632}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.019562868216359792, 'avg_test_loss': 0.02354557932295597}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.01955338647558957, 'avg_test_loss': 0.023536469982899374}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.019542382253289275, 'avg_test_loss': 0.023534808515960886}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.01952607217882808, 'avg_test_loss': 0.023540008153194816}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.019496493832531485, 'avg_test_loss': 0.023539691380680128}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.019484581847340622, 'avg_test_loss': 0.02353575132839873}
INFO:model_data_nn.py:Early stopping at epoch 12
INFO:main_restricted_month.py:Making prediction for data in year: 1989
INFO:main_restricted_month.py:Prediction data shape: (47501,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 1989: 0.15341110745689676
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  47501.000000  47501.000000
mean       0.011252      0.016111
std        0.153399      0.006409
min       -0.900000     -0.051487
25%       -0.055556      0.013043
50%        0.000000      0.017856
75%        0.066140      0.020592
max        6.384615      0.029730
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:transform_data_nn.py:Train_data: (328384, 161)

INFO:transform_data_nn.py:Test data years: [1989]
INFO:transform_data_nn.py:Test_data: (47501, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:transform_data_nn.py:Retrain_data: (375885, 161)

INFO:transform_data_nn.py:Prediction data years: [1990]
INFO:transform_data_nn.py:Prediction_data: (46774, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([328384, 138])
            y_train_tf: torch.Size([328384])

            x_test_tf: torch.Size([47501, 138])
            y_test_tf: torch.Size([47501])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([375885, 138])
            y_retrain_tf: torch.Size([375885])

            x_prediction_tf: torch.Size([46774, 138])
            y_prediction_tf: torch.Size([46774])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.9844e-01,  1.5880e-01,  1.6742e-01, -1.2964e+00, -1.4980e-01,
        -6.3783e-01, -1.5070e-01, -3.3081e-01,  3.6132e-01, -1.5750e-01,
        -7.1271e-01, -3.7380e-02, -4.9664e-01,  9.8005e-03,  3.3467e-02,
         5.2172e-01, -1.3992e-01,  1.7420e-01,  0.0000e+00,  4.3468e-01,
        -3.6828e-01,  7.5725e-02,  2.5460e-02,  9.3107e-03, -6.7596e-02,
        -2.5247e-01, -5.6868e-01,  0.0000e+00,  3.8144e-01,  1.0111e+00,
         4.7515e-01, -1.2195e-01,  4.4010e-01,  0.0000e+00, -3.8085e-01,
        -1.9431e-01,  6.8593e-02,  5.1761e-01,  3.3254e-02, -1.1662e+00,
        -2.7735e-01,  2.7510e-01,  1.9260e-01, -6.6024e-02, -1.7060e-01,
        -6.7784e-01,  8.4519e-02, -8.4395e-02, -5.4257e-01, -1.9077e-01,
        -6.1714e-01,  6.5989e-01, -1.6348e-01,  1.0159e-03,  2.1732e-02,
         4.4457e-01, -7.6868e-01, -1.5251e-04, -2.6248e-01,  2.1522e-02,
         1.1277e-01, -3.2948e-01,  1.5361e-01,  2.8391e-01,  1.4703e-01,
        -1.1827e-01,  2.8385e-03, -7.3083e-02,  7.4370e-01, -4.1918e-01,
         0.0000e+00,  0.0000e+00, -2.3610e-01, -8.1725e-01,  3.7470e-02,
         5.8416e-01,  4.2455e-02, -3.4501e-01, -1.8188e-01, -2.3916e-03,
         0.0000e+00,  2.8639e-01,  6.1073e-02, -2.5530e-01, -5.5517e-01,
        -9.0869e-02, -7.4242e-02, -3.6215e-01, -1.4420e-01,  1.0281e-01,
        -5.1478e-01, -1.2853e+00,  4.8167e-02,  1.2549e+00,  1.7486e+00,
         1.6574e+00,  5.6220e-01,  1.3352e+00, -2.6341e+00, -4.1360e-01,
        -2.9873e-01,  1.2191e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.2007e-02,  2.3354e-01,  0.0000e+00, -1.4879e+00,
         2.6651e-01, -2.1535e+00,  1.3354e-01,  2.7724e-02,  0.0000e+00,
         0.0000e+00,  2.5039e-02, -1.7800e-01,  7.3311e-03,  7.8641e-03,
         1.7098e-01, -4.2237e-01, -3.8414e-01,  1.9750e-01,  2.4554e-01,
        -3.9752e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2368]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-1.1408e-02,  2.9146e-03, -6.1383e-01, -4.2858e-01, -2.9630e-01,
        -6.0289e-02, -1.9494e+00, -1.0588e+00, -3.6764e-02,  1.0514e-01,
        -2.3164e-02,  1.5815e-02, -4.1062e-02, -1.5777e-02,  4.1894e-02,
         3.7534e-01, -2.2006e-01, -4.8981e-01,  0.0000e+00,  2.6484e-03,
        -8.1112e-02,  7.5725e-02,  4.7021e-02,  9.6214e-01, -9.3196e-03,
        -5.7378e-03, -7.2997e-01,  0.0000e+00, -1.4391e+00,  4.6592e-02,
         4.3140e-01, -1.7324e-01,  2.7589e-01,  0.0000e+00,  4.8498e-04,
        -6.5325e-01,  7.3700e-03, -6.8489e-01, -8.4842e-01, -7.9342e-01,
         8.1526e-01,  9.7328e-02,  1.1858e-02,  2.3842e-02, -5.9593e-03,
         3.5118e-01,  8.3150e-02, -2.4606e-01, -4.1683e-01,  5.9663e-02,
         8.9991e-01, -1.3893e+00, -5.1699e-01, -2.5068e+00, -7.4364e-01,
         1.1063e-02, -1.0926e+00,  6.9774e-01,  6.0065e-03, -3.9788e-01,
        -6.2875e-03,  6.3306e-03,  1.2690e-02,  1.5952e-02, -2.4946e-02,
         4.0374e-03, -5.0861e-03,  1.7707e+00,  1.3950e+00, -1.1070e-02,
         0.0000e+00,  0.0000e+00, -2.3610e-01,  6.2752e-01,  1.6399e-02,
        -8.9769e-02,  3.0359e-04, -2.2936e-04,  6.4728e-04, -2.3916e-03,
         0.0000e+00, -3.2955e-01, -5.9469e-02, -4.4773e-01, -5.7442e-01,
        -7.8031e-02, -6.8496e-02,  2.5780e-02, -2.3675e-03, -9.3063e-02,
        -6.5661e-01,  6.1256e-01,  4.8167e-02, -6.9923e-01,  9.4130e-02,
        -1.0595e+00, -1.2968e+00, -1.1704e-01, -7.1630e-01, -1.0437e+00,
        -2.7773e-01, -9.0227e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0181e-02,  2.3354e-01,  0.0000e+00, -1.2998e+00,
        -1.2019e+00,  4.1334e-01,  6.2665e-02,  2.7724e-02,  0.0000e+00,
         0.0000e+00,  1.3064e-02, -2.0316e-01,  7.3311e-03, -1.8639e-02,
        -1.0349e-02,  1.1680e-03, -2.4945e-02,  2.4751e-01,  1.9720e-01,
         1.3884e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2529]), tensor(0.0196))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.8972e-01,  2.6420e-01,  1.5363e-01, -1.3069e+00, -1.4162e-01,
        -6.3605e-01, -1.6024e-01, -3.3749e-01,  3.7729e-01, -1.5824e-01,
        -7.1147e-01, -2.1879e-02, -5.0366e-01, -4.2017e-02,  5.9299e-02,
         5.1382e-01, -1.3424e-01,  1.9280e-01, -1.6829e-02,  4.2506e-01,
        -3.7289e-01,  9.2791e-02,  3.2835e-02,  1.1438e-02, -6.5504e-02,
        -2.5784e-01, -5.7382e-01, -6.8662e-02,  3.8562e-01,  1.0585e+00,
         4.7048e-01, -1.0666e-01,  4.4478e-01,  9.8409e-02, -3.7696e-01,
        -1.9346e-01,  7.3482e-02,  5.4720e-01,  1.7244e-02, -1.1608e+00,
        -2.8468e-01,  2.8830e-01,  2.1189e-01, -6.6772e-02, -1.7456e-01,
        -6.7313e-01,  8.4234e-02, -8.6078e-02, -4.8579e-01, -1.9296e-01,
        -6.3076e-01,  6.6311e-01, -1.5736e-01, -9.1068e-02,  2.1848e-02,
         4.3744e-01, -7.6442e-01,  1.3773e-02, -2.5472e-01, -4.8971e-03,
         1.1931e-01, -3.1866e-01,  1.4727e-01,  2.7139e-01,  1.2354e-01,
        -1.2522e-01,  8.2618e-02, -8.0370e-02,  7.3884e-01, -4.1938e-01,
         0.0000e+00,  0.0000e+00, -1.4421e-01, -8.1085e-01,  5.6494e-02,
         5.8140e-01,  3.9013e-02, -3.4606e-01, -1.8280e-01,  7.9242e-04,
        -2.2414e-02,  2.5705e-01,  6.6266e-02, -2.8663e-01, -5.5589e-01,
        -9.6492e-02, -7.8649e-02, -3.5369e-01, -1.2660e-01,  1.1666e-01,
        -5.1295e-01, -1.2772e+00,  1.3821e-02,  1.3845e+00,  1.8870e+00,
         1.7755e+00,  7.0894e-01,  1.4378e+00, -2.4874e+00, -2.2063e-01,
        -2.9489e-01,  1.0297e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.4179e-02,  2.6416e-01,  0.0000e+00, -1.2481e+00,
         4.0861e-01, -2.3284e+00,  1.3995e-01,  3.2667e-02,  0.0000e+00,
         0.0000e+00,  1.9527e-02, -1.8033e-01,  6.7643e-03, -1.7292e-02,
         6.7000e-02, -4.3188e-01, -3.7835e-01,  2.1099e-01,  2.4922e-01,
        -3.9976e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2464]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([ 1.8820e-02,  8.3680e-02, -7.9874e-01, -1.1744e-01,  8.1926e-01,
        -7.0996e-01, -1.9966e+00, -1.0775e+00, -3.6405e-01, -1.3855e-01,
        -1.6774e-02,  9.3288e-03, -4.2412e-02, -6.4712e-02,  3.6116e-02,
         5.4810e-01, -1.9479e-01,  7.7155e-01,  4.5852e-01,  8.7119e-03,
         7.4209e-01, -1.8899e-01,  5.2501e-02, -4.2265e-01,  5.2064e-01,
        -6.4386e-03, -7.2439e-01, -6.8662e-02, -8.0948e-01,  4.1203e-02,
         1.8714e-01,  1.3541e-02,  3.3481e-01,  9.8409e-02, -1.4494e-03,
        -1.1368e+00,  1.3192e-02, -7.0466e-01,  6.3335e-01, -7.0855e-01,
        -1.4501e-01,  1.5804e-01,  1.2192e-02,  2.3968e-02, -3.7000e-03,
        -4.4552e-01,  9.5932e-01,  2.0401e-01, -4.1580e-01,  1.2171e+00,
         1.6730e+00, -1.1007e+00, -6.2636e-01, -1.2679e+00, -7.4223e-01,
         8.0022e-03, -1.0893e+00,  1.1615e+00, -7.9993e-04,  6.2808e-02,
        -3.9909e-03, -2.7642e-04,  9.0410e-03,  1.8528e-02, -1.0378e-02,
         3.0594e-05,  5.1983e-02, -2.5582e+00,  8.5946e-02, -1.0104e-02,
         0.0000e+00,  0.0000e+00, -1.4421e-01, -5.5099e-01,  1.1204e-02,
         3.0825e-01,  9.9530e-04, -1.9123e-03,  2.5390e-03,  7.9242e-04,
         1.9376e-01,  6.0692e-01, -1.5442e-01,  2.0061e-02, -4.6656e-01,
        -8.4911e-02, -7.3589e-02,  3.1820e-02,  5.3414e-03,  2.8129e-01,
        -5.4592e-01, -1.2772e+00,  1.3821e-02, -1.1170e+00, -8.8277e-01,
        -1.2188e+00, -5.4814e-01, -2.8496e-01, -9.4263e-01, -1.1195e+00,
        -2.3083e-01,  1.6644e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.6646e-02,  3.1921e-01,  0.0000e+00, -9.3808e-01,
        -9.4247e-01,  2.4640e-01,  1.1855e-01,  3.2667e-02,  0.0000e+00,
         0.0000e+00,  1.1356e-02,  2.3742e-01,  6.7643e-03, -1.8907e-02,
        -5.7504e-02,  4.7245e-04, -2.3224e-02,  3.4302e-01,  3.7060e-01,
        -2.7359e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2493]), tensor(-0.0185))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:main_restricted_month.py:Testing data year: 1989
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 6283
            device: cpu
            
2024-07-27 17:37:54,399	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 17:37:54,446	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 17:37:54,484	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_341f1673add3bf67.zip' (1.40MiB) to Ray cluster...
2024-07-27 17:37:54,489	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_341f1673add3bf67.zip'.
2024-07-27 17:37:56,117	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 17:56:15,559	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_17-37-56' in 0.2201s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 6283, 'embedding_dim': 1, 'dropout_rate': 0.49, 'lr': 1.036720427012069e-05, 'weight_decay': 5.503363365456109e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.01955033174943367
INFO:model_data_nn.py:Best trial testing loss: 0.023515204988008874
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-27_17-37-52_077231_365373/artifacts/2024-07-27_17-37-56/train_fnn_2024-07-27_17-37-56/driver_artifacts/train_fnn_a1ce2_00020_20_dropout_rate=0.4900,embedding_dim=1,hidden_dim=85,lr=0.0000,num_layers=4,weight_decay=0.0000_2024-07-27_17-37-56
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 6562, 'embedding_dim': 1, 'dropout_rate': 0.49, 'lr': 1.036720427012069e-05, 'weight_decay': 5.503363365456109e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.021704186375973038, 'avg_test_loss': 0.03199431853159936}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.020140099377001314, 'avg_test_loss': 0.03215443504408572}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.02009182435680456, 'avg_test_loss': 0.032274502713651114}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.020084134780585888, 'avg_test_loss': 0.032375154309051184}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.020070394049936085, 'avg_test_loss': 0.03239028376276145}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.02006383689212688, 'avg_test_loss': 0.032502700963915006}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.020048229569463952, 'avg_test_loss': 0.03248017484566806}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.020034155924368496, 'avg_test_loss': 0.032520573174073863}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.020016437961479252, 'avg_test_loss': 0.03255466552497118}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.019999863148058402, 'avg_test_loss': 0.03260496913655451}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.019977963113412767, 'avg_test_loss': 0.03260629550934796}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main_restricted_month.py:Making prediction for data in year: 1990
INFO:main_restricted_month.py:Prediction data shape: (46774,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 1990: 0.18057099860839018
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  46774.000000  46774.000000
mean      -0.017088      0.019760
std        0.177055      0.005972
min       -0.916667     -0.054881
25%       -0.103448      0.018166
50%       -0.017544      0.021893
75%        0.054461      0.023398
max        3.400000      0.025238
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:transform_data_nn.py:Train_data: (375885, 161)

INFO:transform_data_nn.py:Test data years: [1990]
INFO:transform_data_nn.py:Test_data: (46774, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:transform_data_nn.py:Retrain_data: (422659, 161)

INFO:transform_data_nn.py:Prediction data years: [1991]
INFO:transform_data_nn.py:Prediction_data: (47150, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([375885, 138])
            y_train_tf: torch.Size([375885])

            x_test_tf: torch.Size([46774, 138])
            y_test_tf: torch.Size([46774])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([422659, 138])
            y_retrain_tf: torch.Size([422659])

            x_prediction_tf: torch.Size([47150, 138])
            y_prediction_tf: torch.Size([47150])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.8972e-01,  2.6420e-01,  1.5363e-01, -1.3069e+00, -1.4162e-01,
        -6.3605e-01, -1.6024e-01, -3.3749e-01,  3.7729e-01, -1.5824e-01,
        -7.1147e-01, -2.1879e-02, -5.0366e-01, -4.2017e-02,  5.9299e-02,
         5.1382e-01, -1.3424e-01,  1.9280e-01, -1.6829e-02,  4.2506e-01,
        -3.7289e-01,  9.2791e-02,  3.2835e-02,  1.1438e-02, -6.5504e-02,
        -2.5784e-01, -5.7382e-01, -6.8662e-02,  3.8562e-01,  1.0585e+00,
         4.7048e-01, -1.0666e-01,  4.4478e-01,  9.8409e-02, -3.7696e-01,
        -1.9346e-01,  7.3482e-02,  5.4720e-01,  1.7244e-02, -1.1608e+00,
        -2.8468e-01,  2.8830e-01,  2.1189e-01, -6.6772e-02, -1.7456e-01,
        -6.7313e-01,  8.4234e-02, -8.6078e-02, -4.8579e-01, -1.9296e-01,
        -6.3076e-01,  6.6311e-01, -1.5736e-01, -9.1068e-02,  2.1848e-02,
         4.3744e-01, -7.6442e-01,  1.3773e-02, -2.5472e-01, -4.8971e-03,
         1.1931e-01, -3.1866e-01,  1.4727e-01,  2.7139e-01,  1.2354e-01,
        -1.2522e-01,  8.2618e-02, -8.0370e-02,  7.3884e-01, -4.1938e-01,
         0.0000e+00,  0.0000e+00, -1.4421e-01, -8.1085e-01,  5.6494e-02,
         5.8140e-01,  3.9013e-02, -3.4606e-01, -1.8280e-01,  7.9242e-04,
        -2.2414e-02,  2.5705e-01,  6.6266e-02, -2.8663e-01, -5.5589e-01,
        -9.6492e-02, -7.8649e-02, -3.5369e-01, -1.2660e-01,  1.1666e-01,
        -5.1295e-01, -1.2772e+00,  1.3821e-02,  1.3845e+00,  1.8870e+00,
         1.7755e+00,  7.0894e-01,  1.4378e+00, -2.4874e+00, -2.2063e-01,
        -2.9489e-01,  1.0297e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.4179e-02,  2.6416e-01,  0.0000e+00, -1.2481e+00,
         4.0861e-01, -2.3284e+00,  1.3995e-01,  3.2667e-02,  0.0000e+00,
         0.0000e+00,  1.9527e-02, -1.8033e-01,  6.7643e-03, -1.7292e-02,
         6.7000e-02, -4.3188e-01, -3.7835e-01,  2.1099e-01,  2.4922e-01,
        -3.9976e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2464]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([ 1.8820e-02,  8.3680e-02, -7.9874e-01, -1.1744e-01,  8.1926e-01,
        -7.0996e-01, -1.9966e+00, -1.0775e+00, -3.6405e-01, -1.3855e-01,
        -1.6774e-02,  9.3288e-03, -4.2412e-02, -6.4712e-02,  3.6116e-02,
         5.4810e-01, -1.9479e-01,  7.7155e-01,  4.5852e-01,  8.7119e-03,
         7.4209e-01, -1.8899e-01,  5.2501e-02, -4.2265e-01,  5.2064e-01,
        -6.4386e-03, -7.2439e-01, -6.8662e-02, -8.0948e-01,  4.1203e-02,
         1.8714e-01,  1.3541e-02,  3.3481e-01,  9.8409e-02, -1.4494e-03,
        -1.1368e+00,  1.3192e-02, -7.0466e-01,  6.3335e-01, -7.0855e-01,
        -1.4501e-01,  1.5804e-01,  1.2192e-02,  2.3968e-02, -3.7000e-03,
        -4.4552e-01,  9.5932e-01,  2.0401e-01, -4.1580e-01,  1.2171e+00,
         1.6730e+00, -1.1007e+00, -6.2636e-01, -1.2679e+00, -7.4223e-01,
         8.0022e-03, -1.0893e+00,  1.1615e+00, -7.9993e-04,  6.2808e-02,
        -3.9909e-03, -2.7642e-04,  9.0410e-03,  1.8528e-02, -1.0378e-02,
         3.0594e-05,  5.1983e-02, -2.5582e+00,  8.5946e-02, -1.0104e-02,
         0.0000e+00,  0.0000e+00, -1.4421e-01, -5.5099e-01,  1.1204e-02,
         3.0825e-01,  9.9530e-04, -1.9123e-03,  2.5390e-03,  7.9242e-04,
         1.9376e-01,  6.0692e-01, -1.5442e-01,  2.0061e-02, -4.6656e-01,
        -8.4911e-02, -7.3589e-02,  3.1820e-02,  5.3414e-03,  2.8129e-01,
        -5.4592e-01, -1.2772e+00,  1.3821e-02, -1.1170e+00, -8.8277e-01,
        -1.2188e+00, -5.4814e-01, -2.8496e-01, -9.4263e-01, -1.1195e+00,
        -2.3083e-01,  1.6644e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.6646e-02,  3.1921e-01,  0.0000e+00, -9.3808e-01,
        -9.4247e-01,  2.4640e-01,  1.1855e-01,  3.2667e-02,  0.0000e+00,
         0.0000e+00,  1.1356e-02,  2.3742e-01,  6.7643e-03, -1.8907e-02,
        -5.7504e-02,  4.7245e-04, -2.3224e-02,  3.4302e-01,  3.7060e-01,
        -2.7359e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2493]), tensor(-0.0185))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.7425e-01,  3.7754e-01,  1.4934e-01, -1.3170e+00, -1.3253e-01,
        -6.4465e-01, -1.6967e-01, -3.4584e-01,  3.4598e-01, -1.5492e-01,
        -7.0767e-01, -1.1320e-02, -4.9315e-01, -1.1341e-01,  7.7373e-02,
         5.1234e-01, -1.2838e-01,  1.9862e-01, -4.8695e-02,  4.3362e-01,
        -3.5150e-01,  3.8941e-02,  3.6587e-02,  1.5554e-02, -5.9349e-02,
        -2.6173e-01, -5.6831e-01, -2.7338e-04,  3.9550e-01,  1.0619e+00,
         4.6676e-01, -9.5131e-02,  4.4205e-01,  8.6933e-03, -3.7636e-01,
        -1.9066e-01,  7.8067e-02,  5.6022e-01,  1.4630e-02, -1.1506e+00,
        -2.9475e-01,  3.6848e-01,  2.3401e-01, -8.0414e-02, -1.7311e-01,
        -6.7188e-01,  1.2521e-01, -5.8672e-02, -4.5347e-01, -1.4579e-01,
        -6.4478e-01,  6.6964e-01, -1.5089e-01, -6.6906e-02,  2.4691e-02,
         4.3137e-01, -7.5919e-01,  3.8151e-02, -2.5174e-01, -1.8652e-02,
         1.2382e-01, -3.1448e-01,  1.4006e-01,  2.6348e-01,  1.1506e-01,
        -1.3377e-01,  1.6539e-01, -8.0429e-02,  7.3199e-01, -4.2069e-01,
         0.0000e+00,  0.0000e+00, -9.4989e-02, -8.0793e-01,  6.9545e-02,
         5.7868e-01,  3.3156e-02, -3.4722e-01, -1.8260e-01,  3.4026e-03,
        -6.5914e-03,  2.4846e-01,  4.3762e-02, -3.1158e-01, -5.5520e-01,
        -1.0190e-01, -8.3315e-02, -3.4428e-01, -1.0836e-01,  1.3599e-01,
        -5.0767e-01, -1.2661e+00,  3.9227e-03,  1.4985e+00,  2.0153e+00,
         1.9005e+00,  7.5873e-01,  1.5519e+00, -2.5355e+00, -1.0712e-01,
        -3.0477e-01,  1.0635e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0060e-02,  2.7572e-01,  0.0000e+00, -1.1510e+00,
         5.3159e-01, -2.2985e+00,  1.4497e-01,  3.1339e-02,  0.0000e+00,
         0.0000e+00,  1.4065e-02, -1.8017e-01,  9.3949e-03, -3.9383e-02,
         3.7427e-02, -4.3923e-01, -3.6782e-01,  2.2340e-01,  2.5535e-01,
        -4.0639e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2558]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([ 1.2993e-02,  7.0280e-02,  5.4580e-01,  1.4098e-01, -3.7937e-01,
        -3.2199e-01, -2.0970e+00, -1.0822e+00, -2.2737e-01, -3.1425e-01,
        -1.5613e-02,  5.8420e-03, -2.8197e-02, -5.8125e-02,  3.6224e-02,
        -1.3633e+00, -1.4110e-01,  5.8407e-02,  1.1676e-01,  1.4697e-02,
         6.4857e-02, -1.1747e-01,  5.8770e-01, -2.9751e-01, -3.5050e-01,
        -6.5498e-03, -6.6369e-01, -2.7338e-04, -1.0685e+00,  2.7080e-02,
        -2.0452e-01, -4.7176e-02,  2.9836e-01,  8.6933e-03, -5.4638e-04,
        -5.2011e-01,  7.9955e-03, -7.1260e-01, -1.1614e-01, -9.4484e-01,
         6.9123e-02, -7.7512e-01,  1.3185e-02,  1.1272e-02,  7.3407e-04,
         6.7760e-02, -2.7334e-01, -4.8967e-02,  7.1605e-01, -1.4864e-01,
         9.0603e-01, -1.0786e+00, -5.5943e-01, -9.6500e-01, -7.4081e-01,
         7.2555e-03, -1.0852e+00, -3.4742e-01, -2.2293e-03,  1.3772e-01,
        -5.0189e-03, -3.0738e-03,  9.1674e-03,  1.3885e-02, -7.3406e-03,
         7.6830e-04,  4.4575e-02, -4.2739e-01,  7.5308e-02, -9.8693e-03,
         0.0000e+00,  0.0000e+00, -9.4989e-02,  1.4364e-02,  9.7428e-03,
        -3.9122e-01,  1.5581e-03, -2.7052e-03,  7.7936e-04,  3.4026e-03,
         1.6028e-01, -5.3828e-01, -1.7883e-01,  6.0396e-01, -4.9598e-01,
        -9.2094e-02, -7.8620e-02,  2.6062e-02,  4.3028e-03,  1.0161e-01,
        -6.5284e-01,  9.4613e-01,  3.9227e-03, -2.9295e-01, -8.0607e-01,
        -7.0806e-01,  4.3613e-02, -6.3081e-01, -1.5640e-01,  4.2306e-02,
        -2.5627e-01,  9.5470e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.8296e-02,  2.1888e-01,  0.0000e+00, -1.0606e+00,
        -1.5565e+00, -1.9042e+00,  1.1952e-01,  3.1339e-02,  0.0000e+00,
         0.0000e+00,  1.1698e-02, -2.3071e-01,  9.3949e-03, -1.7782e-02,
         8.5195e-03,  7.6178e-05, -1.4510e-02,  2.6743e-01,  2.6624e-01,
        -2.8328e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2499]), tensor(0.0132))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:main_restricted_month.py:Testing data year: 1990
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 6562
            device: cpu
            
2024-07-27 18:46:39,264	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 18:46:39,316	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 18:46:39,355	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_341f1673add3bf67.zip' (1.40MiB) to Ray cluster...
2024-07-27 18:46:39,360	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_341f1673add3bf67.zip'.
2024-07-27 18:46:40,957	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 19:10:54,023	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_18-46-40' in 0.2650s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 155, 'num_layers': 3, 'num_embeddings': 6562, 'embedding_dim': 3, 'dropout_rate': 0.47, 'lr': 3.2773202969370707e-06, 'weight_decay': 2.4217957731734788e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.0195726969306778
INFO:model_data_nn.py:Best trial testing loss: 0.031961095391322955
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-27_18-46-36_898777_365373/artifacts/2024-07-27_18-46-40/train_fnn_2024-07-27_18-46-40/driver_artifacts/train_fnn_3c66b_00095_95_dropout_rate=0.4700,embedding_dim=3,hidden_dim=155,lr=0.0000,num_layers=3,weight_decay=0.0000_2024-07-27_18-46-41
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 155, 'num_layers': 3, 'num_embeddings': 6817, 'embedding_dim': 3, 'dropout_rate': 0.47, 'lr': 3.2773202969370707e-06, 'weight_decay': 2.4217957731734788e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.028267210754188712, 'avg_test_loss': 0.04881578355110181}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.023280501300165884, 'avg_test_loss': 0.04821622678997397}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.0219661679930342, 'avg_test_loss': 0.04810241408572814}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.021537853163588767, 'avg_test_loss': 0.047987933154375856}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.02141792483460003, 'avg_test_loss': 0.04777201464503316}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.021371659311979874, 'avg_test_loss': 0.04786073537593963}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.021347228144235588, 'avg_test_loss': 0.04791984990873504}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.02132623121057786, 'avg_test_loss': 0.04788772672038207}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.021314725447671712, 'avg_test_loss': 0.047886005887102075}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.02129180484152516, 'avg_test_loss': 0.04779396137965684}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.02127932798368384, 'avg_test_loss': 0.04792779508859344}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.021252147345306643, 'avg_test_loss': 0.04790180681457837}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.02123988920561532, 'avg_test_loss': 0.04792487370343108}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.021226365209374605, 'avg_test_loss': 0.047961873769396195}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.021217596380464467, 'avg_test_loss': 0.047961065653089836}
INFO:model_data_nn.py:Early stopping at epoch 15
INFO:main_restricted_month.py:Making prediction for data in year: 1991
INFO:main_restricted_month.py:Prediction data shape: (47150,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 1991: 0.21900314622621803
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  47150.000000  47150.000000
mean       0.038270      0.001821
std        0.216332      0.011387
min       -0.937500     -0.079935
25%       -0.058140     -0.005098
50%        0.011494      0.002331
75%        0.100000      0.009609
max        9.000000      0.033431
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:transform_data_nn.py:Train_data: (422659, 161)

INFO:transform_data_nn.py:Test data years: [1991]
INFO:transform_data_nn.py:Test_data: (47150, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:transform_data_nn.py:Retrain_data: (469809, 161)

INFO:transform_data_nn.py:Prediction data years: [1992]
INFO:transform_data_nn.py:Prediction_data: (47572, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([422659, 138])
            y_train_tf: torch.Size([422659])

            x_test_tf: torch.Size([47150, 138])
            y_test_tf: torch.Size([47150])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([469809, 138])
            y_retrain_tf: torch.Size([469809])

            x_prediction_tf: torch.Size([47572, 138])
            y_prediction_tf: torch.Size([47572])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.7425e-01,  3.7754e-01,  1.4934e-01, -1.3170e+00, -1.3253e-01,
        -6.4465e-01, -1.6967e-01, -3.4584e-01,  3.4598e-01, -1.5492e-01,
        -7.0767e-01, -1.1320e-02, -4.9315e-01, -1.1341e-01,  7.7373e-02,
         5.1234e-01, -1.2838e-01,  1.9862e-01, -4.8695e-02,  4.3362e-01,
        -3.5150e-01,  3.8941e-02,  3.6587e-02,  1.5554e-02, -5.9349e-02,
        -2.6173e-01, -5.6831e-01, -2.7338e-04,  3.9550e-01,  1.0619e+00,
         4.6676e-01, -9.5131e-02,  4.4205e-01,  8.6933e-03, -3.7636e-01,
        -1.9066e-01,  7.8067e-02,  5.6022e-01,  1.4630e-02, -1.1506e+00,
        -2.9475e-01,  3.6848e-01,  2.3401e-01, -8.0414e-02, -1.7311e-01,
        -6.7188e-01,  1.2521e-01, -5.8672e-02, -4.5347e-01, -1.4579e-01,
        -6.4478e-01,  6.6964e-01, -1.5089e-01, -6.6906e-02,  2.4691e-02,
         4.3137e-01, -7.5919e-01,  3.8151e-02, -2.5174e-01, -1.8652e-02,
         1.2382e-01, -3.1448e-01,  1.4006e-01,  2.6348e-01,  1.1506e-01,
        -1.3377e-01,  1.6539e-01, -8.0429e-02,  7.3199e-01, -4.2069e-01,
         0.0000e+00,  0.0000e+00, -9.4989e-02, -8.0793e-01,  6.9545e-02,
         5.7868e-01,  3.3156e-02, -3.4722e-01, -1.8260e-01,  3.4026e-03,
        -6.5914e-03,  2.4846e-01,  4.3762e-02, -3.1158e-01, -5.5520e-01,
        -1.0190e-01, -8.3315e-02, -3.4428e-01, -1.0836e-01,  1.3599e-01,
        -5.0767e-01, -1.2661e+00,  3.9227e-03,  1.4985e+00,  2.0153e+00,
         1.9005e+00,  7.5873e-01,  1.5519e+00, -2.5355e+00, -1.0712e-01,
        -3.0477e-01,  1.0635e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0060e-02,  2.7572e-01,  0.0000e+00, -1.1510e+00,
         5.3159e-01, -2.2985e+00,  1.4497e-01,  3.1339e-02,  0.0000e+00,
         0.0000e+00,  1.4065e-02, -1.8017e-01,  9.3949e-03, -3.9383e-02,
         3.7427e-02, -4.3923e-01, -3.6782e-01,  2.2340e-01,  2.5535e-01,
        -4.0639e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2558]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([ 1.2993e-02,  7.0280e-02,  5.4580e-01,  1.4098e-01, -3.7937e-01,
        -3.2199e-01, -2.0970e+00, -1.0822e+00, -2.2737e-01, -3.1425e-01,
        -1.5613e-02,  5.8420e-03, -2.8197e-02, -5.8125e-02,  3.6224e-02,
        -1.3633e+00, -1.4110e-01,  5.8407e-02,  1.1676e-01,  1.4697e-02,
         6.4857e-02, -1.1747e-01,  5.8770e-01, -2.9751e-01, -3.5050e-01,
        -6.5498e-03, -6.6369e-01, -2.7338e-04, -1.0685e+00,  2.7080e-02,
        -2.0452e-01, -4.7176e-02,  2.9836e-01,  8.6933e-03, -5.4638e-04,
        -5.2011e-01,  7.9955e-03, -7.1260e-01, -1.1614e-01, -9.4484e-01,
         6.9123e-02, -7.7512e-01,  1.3185e-02,  1.1272e-02,  7.3407e-04,
         6.7760e-02, -2.7334e-01, -4.8967e-02,  7.1605e-01, -1.4864e-01,
         9.0603e-01, -1.0786e+00, -5.5943e-01, -9.6500e-01, -7.4081e-01,
         7.2555e-03, -1.0852e+00, -3.4742e-01, -2.2293e-03,  1.3772e-01,
        -5.0189e-03, -3.0738e-03,  9.1674e-03,  1.3885e-02, -7.3406e-03,
         7.6830e-04,  4.4575e-02, -4.2739e-01,  7.5308e-02, -9.8693e-03,
         0.0000e+00,  0.0000e+00, -9.4989e-02,  1.4364e-02,  9.7428e-03,
        -3.9122e-01,  1.5581e-03, -2.7052e-03,  7.7936e-04,  3.4026e-03,
         1.6028e-01, -5.3828e-01, -1.7883e-01,  6.0396e-01, -4.9598e-01,
        -9.2094e-02, -7.8620e-02,  2.6062e-02,  4.3028e-03,  1.0161e-01,
        -6.5284e-01,  9.4613e-01,  3.9227e-03, -2.9295e-01, -8.0607e-01,
        -7.0806e-01,  4.3613e-02, -6.3081e-01, -1.5640e-01,  4.2306e-02,
        -2.5627e-01,  9.5470e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.8296e-02,  2.1888e-01,  0.0000e+00, -1.0606e+00,
        -1.5565e+00, -1.9042e+00,  1.1952e-01,  3.1339e-02,  0.0000e+00,
         0.0000e+00,  1.1698e-02, -2.3071e-01,  9.3949e-03, -1.7782e-02,
         8.5195e-03,  7.6178e-05, -1.4510e-02,  2.6743e-01,  2.6624e-01,
        -2.8328e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2499]), tensor(0.0132))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.7234e-01,  4.6972e-01,  1.3369e-01, -1.3233e+00, -1.1615e-01,
        -6.5763e-01, -1.7787e-01, -3.5546e-01,  3.2117e-01, -1.5645e-01,
        -7.0541e-01, -1.5574e-03, -4.8483e-01, -1.7368e-01,  8.8285e-02,
         5.0900e-01, -1.2565e-01,  1.9820e-01, -8.7710e-02,  4.5217e-01,
        -3.6214e-01,  1.5567e-03,  1.2075e-02,  2.0896e-02, -5.7166e-02,
        -2.6419e-01, -5.6232e-01, -1.1018e-02,  3.9683e-01,  1.0666e+00,
         4.3934e-01, -8.5856e-02,  4.4396e-01, -5.2619e-03, -3.7864e-01,
        -1.8745e-01,  8.5812e-02,  5.7862e-01,  2.0035e-02, -1.1342e+00,
        -3.0314e-01,  3.5782e-01,  2.6210e-01, -9.0749e-02, -1.6322e-01,
        -6.7575e-01,  1.2232e-01, -7.2473e-02, -4.3025e-01, -1.6126e-01,
        -6.6996e-01,  6.6997e-01, -1.4319e-01, -4.9841e-02,  3.0161e-02,
         4.2920e-01, -7.5336e-01,  5.1860e-02, -2.4874e-01, -2.6112e-02,
         1.2572e-01, -3.1123e-01,  1.3579e-01,  2.5557e-01,  1.1514e-01,
        -1.4038e-01,  2.3383e-01, -9.0486e-02,  7.2582e-01, -4.2017e-01,
        -1.2030e-01, -4.4965e-02, -7.9972e-02, -8.0907e-01,  8.3420e-02,
         5.8997e-01,  2.7258e-02, -3.4975e-01, -1.8380e-01, -2.8744e-04,
        -1.9863e-02,  2.5660e-01,  2.5976e-02, -3.2665e-01, -5.5216e-01,
        -1.0612e-01, -8.7828e-02, -3.3475e-01, -9.2894e-02,  1.5286e-01,
        -5.0040e-01, -1.2594e+00,  3.0052e-03,  1.6066e+00,  2.0217e+00,
         2.0209e+00,  6.7476e-01,  1.6506e+00, -2.6817e+00, -3.3824e-02,
        -3.0674e-01,  1.2242e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.5031e-02,  2.6305e-01,  0.0000e+00, -1.1035e+00,
         6.1772e-01, -2.2042e+00,  1.4834e-01,  3.5943e-02,  0.0000e+00,
         0.0000e+00,  1.1816e-02, -1.7538e-01,  9.9392e-03, -5.9433e-02,
         4.2013e-02, -4.4646e-01, -3.5918e-01,  2.3720e-01,  2.6317e-01,
        -4.1316e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2661]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([ 6.2642e-03,  6.7182e-02, -6.4165e-01,  3.5846e-01, -2.5759e-01,
        -4.6121e-01, -2.1794e+00, -1.0532e+00, -5.0706e-01, -3.2195e-01,
        -1.5071e-02,  4.0833e-03, -4.0119e-02, -5.0377e-02,  3.2950e-02,
         2.5575e-01, -1.9624e-01,  5.8189e-02,  1.8857e-01,  2.0410e-02,
         5.6067e-01, -8.3279e-02,  2.3434e-02, -2.9241e-01, -1.5860e-01,
        -6.7403e-03, -6.9119e-01, -9.8580e-01, -6.3083e-01,  3.5019e-02,
        -2.1587e-02, -8.3943e-02,  2.2857e-01, -5.2619e-03, -1.2769e-03,
        -5.1239e-01,  1.3431e-02, -7.3048e-01, -1.5444e-01, -1.0767e+00,
         9.0696e-03,  2.6169e-01,  1.9195e-02,  2.4653e-02,  7.3430e-03,
        -2.5199e-01,  9.6112e-01, -1.2186e-01,  3.9670e-01,  1.1515e+00,
         1.6549e+00, -8.2762e-01, -6.1543e-01, -8.2104e-01, -7.3789e-01,
         5.2873e-03, -1.0808e+00,  1.1631e+00, -2.7504e-03, -7.3552e-01,
        -4.3126e-03, -3.2616e-03,  7.3414e-03,  9.9719e-03, -7.7297e-03,
        -1.0633e-03,  4.0335e-02, -5.7112e+00,  7.2582e-01, -9.7144e-03,
        -1.2030e-01, -4.4965e-02, -7.9972e-02, -1.1711e-01,  9.2094e-03,
        -2.6444e-02,  1.6299e-03, -4.6931e-03,  3.7746e-04, -2.8744e-04,
         1.3632e-01, -2.4099e-01, -3.6805e-01,  7.0494e-01, -3.3731e-01,
        -3.1895e-03, -1.5419e-03,  3.1128e-02,  4.8253e-03,  1.0913e-01,
        -4.2202e-01, -3.7713e-01,  3.0052e-03, -1.3418e+00, -2.4070e+00,
        -9.2789e-01,  1.9075e+00, -1.6080e+00,  8.2921e-01, -9.7018e-01,
        -5.8507e-02,  1.3223e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  4.1613e-02,  5.8432e-01,  0.0000e+00, -2.3980e-01,
        -1.7502e-01, -1.5754e+00,  1.2281e-01,  3.5943e-02,  0.0000e+00,
         0.0000e+00,  1.3431e-02, -1.9908e-01,  9.9392e-03, -1.5549e-02,
         8.2946e-04, -7.8995e-04, -2.5634e-02,  2.8180e-01,  2.6638e-01,
        -3.9954e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2586]), tensor(-0.0517))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:main_restricted_month.py:Testing data year: 1991
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 6817
            device: cpu
            
2024-07-27 20:08:18,162	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 20:08:18,205	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 20:08:18,246	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_341f1673add3bf67.zip' (1.40MiB) to Ray cluster...
2024-07-27 20:08:18,251	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_341f1673add3bf67.zip'.
2024-07-27 20:08:19,842	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 21:09:36,162	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_20-08-19' in 0.2221s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 175, 'num_layers': 5, 'num_embeddings': 6817, 'embedding_dim': 10, 'dropout_rate': 0.51, 'lr': 1.457050032975656e-06, 'weight_decay': 3.212219315322692e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.02130386296858522
INFO:model_data_nn.py:Best trial testing loss: 0.04714182565832862
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-27_20-08-15_953340_365373/artifacts/2024-07-27_20-08-19/train_fnn_2024-07-27_20-08-19/driver_artifacts/train_fnn_a45d4_00097_97_dropout_rate=0.5100,embedding_dim=10,hidden_dim=175,lr=0.0000,num_layers=5,weight_decay=0.0000_2024-07-27_20-08-20
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 175, 'num_layers': 5, 'num_embeddings': 7144, 'embedding_dim': 10, 'dropout_rate': 0.51, 'lr': 1.457050032975656e-06, 'weight_decay': 3.212219315322692e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03277707153908678, 'avg_test_loss': 0.03882544303703452}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.028680476821688033, 'avg_test_loss': 0.038794660331150616}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.026604822307912373, 'avg_test_loss': 0.03879837438486697}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.025420111834677107, 'avg_test_loss': 0.03882147254101852}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.02479762426530441, 'avg_test_loss': 0.03881486934880095}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.02447529603392109, 'avg_test_loss': 0.03883777748573051}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.024310770755076264, 'avg_test_loss': 0.03883992681925696}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.02418954658218387, 'avg_test_loss': 0.03885459224130177}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.024141174879436608, 'avg_test_loss': 0.03885139464726171}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.02409925670003344, 'avg_test_loss': 0.038861055569898495}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.024082588626318183, 'avg_test_loss': 0.038862003782709}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.02406601046849265, 'avg_test_loss': 0.038864525806118724}
INFO:model_data_nn.py:Early stopping at epoch 12
INFO:main_restricted_month.py:Making prediction for data in year: 1992
INFO:main_restricted_month.py:Prediction data shape: (47572,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 1992: 0.19712260415571323
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  47572.000000  47572.000000
mean       0.021557      0.011419
std        0.196838      0.001342
min       -0.958333     -0.001898
25%       -0.064271      0.011082
50%        0.000000      0.011757
75%        0.078377      0.012199
max        5.769231      0.013944
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:transform_data_nn.py:Train_data: (469809, 161)

INFO:transform_data_nn.py:Test data years: [1992]
INFO:transform_data_nn.py:Test_data: (47572, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Retrain_data: (517381, 161)

INFO:transform_data_nn.py:Prediction data years: [1993]
INFO:transform_data_nn.py:Prediction_data: (50974, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([469809, 138])
            y_train_tf: torch.Size([469809])

            x_test_tf: torch.Size([47572, 138])
            y_test_tf: torch.Size([47572])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([517381, 138])
            y_retrain_tf: torch.Size([517381])

            x_prediction_tf: torch.Size([50974, 138])
            y_prediction_tf: torch.Size([50974])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.7234e-01,  4.6972e-01,  1.3369e-01, -1.3233e+00, -1.1615e-01,
        -6.5763e-01, -1.7787e-01, -3.5546e-01,  3.2117e-01, -1.5645e-01,
        -7.0541e-01, -1.5574e-03, -4.8483e-01, -1.7368e-01,  8.8285e-02,
         5.0900e-01, -1.2565e-01,  1.9820e-01, -8.7710e-02,  4.5217e-01,
        -3.6214e-01,  1.5567e-03,  1.2075e-02,  2.0896e-02, -5.7166e-02,
        -2.6419e-01, -5.6232e-01, -1.1018e-02,  3.9683e-01,  1.0666e+00,
         4.3934e-01, -8.5856e-02,  4.4396e-01, -5.2619e-03, -3.7864e-01,
        -1.8745e-01,  8.5812e-02,  5.7862e-01,  2.0035e-02, -1.1342e+00,
        -3.0314e-01,  3.5782e-01,  2.6210e-01, -9.0749e-02, -1.6322e-01,
        -6.7575e-01,  1.2232e-01, -7.2473e-02, -4.3025e-01, -1.6126e-01,
        -6.6996e-01,  6.6997e-01, -1.4319e-01, -4.9841e-02,  3.0161e-02,
         4.2920e-01, -7.5336e-01,  5.1860e-02, -2.4874e-01, -2.6112e-02,
         1.2572e-01, -3.1123e-01,  1.3579e-01,  2.5557e-01,  1.1514e-01,
        -1.4038e-01,  2.3383e-01, -9.0486e-02,  7.2582e-01, -4.2017e-01,
        -1.2030e-01, -4.4965e-02, -7.9972e-02, -8.0907e-01,  8.3420e-02,
         5.8997e-01,  2.7258e-02, -3.4975e-01, -1.8380e-01, -2.8744e-04,
        -1.9863e-02,  2.5660e-01,  2.5976e-02, -3.2665e-01, -5.5216e-01,
        -1.0612e-01, -8.7828e-02, -3.3475e-01, -9.2894e-02,  1.5286e-01,
        -5.0040e-01, -1.2594e+00,  3.0052e-03,  1.6066e+00,  2.0217e+00,
         2.0209e+00,  6.7476e-01,  1.6506e+00, -2.6817e+00, -3.3824e-02,
        -3.0674e-01,  1.2242e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.5031e-02,  2.6305e-01,  0.0000e+00, -1.1035e+00,
         6.1772e-01, -2.2042e+00,  1.4834e-01,  3.5943e-02,  0.0000e+00,
         0.0000e+00,  1.1816e-02, -1.7538e-01,  9.9392e-03, -5.9433e-02,
         4.2013e-02, -4.4646e-01, -3.5918e-01,  2.3720e-01,  2.6317e-01,
        -4.1316e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2661]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([ 6.2642e-03,  6.7182e-02, -6.4165e-01,  3.5846e-01, -2.5759e-01,
        -4.6121e-01, -2.1794e+00, -1.0532e+00, -5.0706e-01, -3.2195e-01,
        -1.5071e-02,  4.0833e-03, -4.0119e-02, -5.0377e-02,  3.2950e-02,
         2.5575e-01, -1.9624e-01,  5.8189e-02,  1.8857e-01,  2.0410e-02,
         5.6067e-01, -8.3279e-02,  2.3434e-02, -2.9241e-01, -1.5860e-01,
        -6.7403e-03, -6.9119e-01, -9.8580e-01, -6.3083e-01,  3.5019e-02,
        -2.1587e-02, -8.3943e-02,  2.2857e-01, -5.2619e-03, -1.2769e-03,
        -5.1239e-01,  1.3431e-02, -7.3048e-01, -1.5444e-01, -1.0767e+00,
         9.0696e-03,  2.6169e-01,  1.9195e-02,  2.4653e-02,  7.3430e-03,
        -2.5199e-01,  9.6112e-01, -1.2186e-01,  3.9670e-01,  1.1515e+00,
         1.6549e+00, -8.2762e-01, -6.1543e-01, -8.2104e-01, -7.3789e-01,
         5.2873e-03, -1.0808e+00,  1.1631e+00, -2.7504e-03, -7.3552e-01,
        -4.3126e-03, -3.2616e-03,  7.3414e-03,  9.9719e-03, -7.7297e-03,
        -1.0633e-03,  4.0335e-02, -5.7112e+00,  7.2582e-01, -9.7144e-03,
        -1.2030e-01, -4.4965e-02, -7.9972e-02, -1.1711e-01,  9.2094e-03,
        -2.6444e-02,  1.6299e-03, -4.6931e-03,  3.7746e-04, -2.8744e-04,
         1.3632e-01, -2.4099e-01, -3.6805e-01,  7.0494e-01, -3.3731e-01,
        -3.1895e-03, -1.5419e-03,  3.1128e-02,  4.8253e-03,  1.0913e-01,
        -4.2202e-01, -3.7713e-01,  3.0052e-03, -1.3418e+00, -2.4070e+00,
        -9.2789e-01,  1.9075e+00, -1.6080e+00,  8.2921e-01, -9.7018e-01,
        -5.8507e-02,  1.3223e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  4.1613e-02,  5.8432e-01,  0.0000e+00, -2.3980e-01,
        -1.7502e-01, -1.5754e+00,  1.2281e-01,  3.5943e-02,  0.0000e+00,
         0.0000e+00,  1.3431e-02, -1.9908e-01,  9.9392e-03, -1.5549e-02,
         8.2946e-04, -7.8995e-04, -2.5634e-02,  2.8180e-01,  2.6638e-01,
        -3.9954e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2586]), tensor(-0.0517))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.7017e-01,  5.4430e-01,  1.2009e-01, -1.3250e+00, -1.0880e-01,
        -6.7292e-01, -1.8004e-01, -3.5933e-01,  3.2668e-01, -1.5317e-01,
        -7.0589e-01,  7.4726e-03, -4.8743e-01, -2.2608e-01,  1.0144e-01,
         5.1039e-01, -1.2794e-01,  2.0643e-01, -1.0678e-01,  4.7095e-01,
        -3.3926e-01,  1.6034e-03,  1.7851e-02,  1.7928e-02, -5.3087e-02,
        -2.6831e-01, -5.6195e-01, -1.7845e-02,  3.8549e-01,  1.0970e+00,
         4.2313e-01, -8.9777e-02,  4.4965e-01, -1.3829e-02, -3.8024e-01,
        -1.8186e-01,  1.0190e-01,  5.8749e-01,  2.8611e-02, -1.1229e+00,
        -3.0893e-01,  3.1183e-01,  2.8781e-01, -8.9431e-02, -1.5191e-01,
        -6.8379e-01,  1.0111e-01, -7.6698e-02, -4.0679e-01, -1.6009e-01,
        -6.9287e-01,  6.6100e-01, -1.3563e-01, -3.9684e-02,  2.3737e-02,
         4.2900e-01, -7.4683e-01,  5.1487e-02, -2.5445e-01, -2.8726e-02,
         1.2699e-01, -3.1623e-01,  1.3253e-01,  2.5171e-01,  1.1643e-01,
        -1.4354e-01,  2.8767e-01, -1.0047e-01,  7.1446e-01, -4.1912e-01,
        -1.6563e-01, -6.4405e-02, -3.0634e-02, -8.1485e-01,  9.5358e-02,
         6.0610e-01,  2.5212e-02, -3.5232e-01, -1.8446e-01,  6.2203e-03,
        -2.2769e-02,  2.6777e-01,  2.8779e-02, -3.3119e-01, -5.5081e-01,
        -1.0952e-01, -9.1631e-02, -3.2660e-01, -8.1110e-02,  1.6108e-01,
        -4.9870e-01, -1.2566e+00,  4.5272e-03,  1.6870e+00,  1.9463e+00,
         2.1191e+00,  3.9819e-01,  1.6656e+00, -2.7099e+00,  7.7995e-02,
        -2.9821e-01,  1.3334e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0548e-02,  3.9668e-01,  0.0000e+00, -1.1758e+00,
         6.5412e-01, -2.1153e+00,  1.5104e-01,  2.5704e-02,  0.0000e+00,
         0.0000e+00,  1.5606e-02, -1.6936e-01,  1.0378e-02, -6.9491e-02,
         4.7393e-02, -4.4982e-01, -3.5714e-01,  2.4907e-01,  2.6962e-01,
        -4.1738e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2808]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([ 8.2728e-03,  5.4755e-02, -4.9370e-01,  5.4448e-01,  2.9865e-01,
        -6.0803e-01, -2.2079e+00, -1.0301e+00, -4.6674e-01, -2.4042e-01,
        -1.7592e-02,  4.2173e-03, -3.7468e-02, -4.0824e-02,  2.9185e-02,
        -1.0207e+00, -1.7753e-01,  6.2290e-01,  1.4153e-01,  1.1150e-02,
         7.8102e-01, -7.0740e-02, -2.0869e-02, -3.4765e-01,  1.4737e-01,
        -9.8068e-03, -6.4582e-01, -7.3177e-01, -1.2937e+00,  3.8182e-02,
        -2.6866e-02, -2.1075e-01,  1.8523e-01, -1.3829e-02,  1.1890e-03,
         1.3803e+00,  1.7985e-02, -7.3909e-01,  4.1833e-01, -1.0074e+00,
        -4.5112e-02, -2.2884e-01,  1.1162e-02,  3.1080e-02,  4.3183e-03,
        -5.2148e-01, -2.0603e-01, -1.8556e-01,  3.2134e-01,  5.6058e-01,
         1.6397e+00, -8.3847e-01, -5.9076e-01, -7.3768e-01, -7.3865e-01,
         2.3038e-03, -1.0761e+00, -4.3372e-02, -9.3552e-03,  2.7181e-01,
        -5.0712e-03, -9.1803e-03,  1.0368e-02,  1.4657e-02, -9.1383e-03,
         5.3932e-03,  3.0839e-02,  1.1480e+00,  5.0633e-02, -1.2962e-02,
        -1.6563e-01, -6.4405e-02, -3.0634e-02, -4.5080e-01,  8.8855e-03,
         2.7061e-02,  1.3338e-03, -4.3063e-03,  1.4568e-03,  6.2203e-03,
         1.1851e-01, -4.7181e-01, -3.6238e-01, -1.7764e-01, -5.0873e-01,
        -3.4696e-03, -2.0132e-03,  3.1328e-02,  3.6180e-03,  1.2567e-01,
        -6.3390e-01,  9.6623e-01,  4.5272e-03, -1.3421e+00, -1.5261e+00,
        -9.5565e-01,  1.8065e+00, -1.6348e+00,  1.2081e+00, -1.1387e+00,
        -2.9790e-01,  3.0578e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.3509e-02,  2.2757e-01,  0.0000e+00,  5.2594e-01,
        -3.2482e-02,  5.0274e-01,  1.0084e-01,  2.5704e-02,  0.0000e+00,
         0.0000e+00,  1.5330e-02,  2.4573e-02,  1.0378e-02, -8.7727e-03,
         6.8298e-03,  1.7210e-03, -2.3708e-02,  1.1407e-01,  1.7418e-01,
        -3.3056e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2765]), tensor(0.))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:main_restricted_month.py:Testing data year: 1992
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 7144
            device: cpu
            
2024-07-27 22:13:58,248	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 22:13:58,288	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 22:13:58,323	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_341f1673add3bf67.zip' (1.40MiB) to Ray cluster...
2024-07-27 22:13:58,327	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_341f1673add3bf67.zip'.
2024-07-27 22:13:59,899	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-27 22:34:24,679	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_22-13-59' in 0.2324s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 2, 'num_embeddings': 7144, 'embedding_dim': 10, 'dropout_rate': 0.54, 'lr': 0.00034703605955441544, 'weight_decay': 1.3674518065224943e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.021555949827830465
INFO:model_data_nn.py:Best trial testing loss: 0.037789175016505104
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-27_22-13-56_030335_365373/artifacts/2024-07-27_22-13-59/train_fnn_2024-07-27_22-13-59/driver_artifacts/train_fnn_3296b_00054_54_dropout_rate=0.5400,embedding_dim=10,hidden_dim=45,lr=0.0003,num_layers=2,weight_decay=0.0000_2024-07-27_22-14-00
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 2, 'num_embeddings': 7524, 'embedding_dim': 10, 'dropout_rate': 0.54, 'lr': 0.00034703605955441544, 'weight_decay': 1.3674518065224943e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.025409473059497353, 'avg_test_loss': 0.037330085974901804}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.02495225847231647, 'avg_test_loss': 0.03745412151884273}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.024707537405446272, 'avg_test_loss': 0.03717842821786683}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.024578756289113136, 'avg_test_loss': 0.03705955146948621}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.024419473190593198, 'avg_test_loss': 0.03714577264095209}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.024355237667167174, 'avg_test_loss': 0.037200158951544625}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.02426422666781337, 'avg_test_loss': 0.03717344634379804}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.024181013918627484, 'avg_test_loss': 0.037253888995226574}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.024126943217874973, 'avg_test_loss': 0.037294516806143665}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.024054805649272825, 'avg_test_loss': 0.03722039969764192}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.02400548535588629, 'avg_test_loss': 0.03721627851987872}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.023959672176748534, 'avg_test_loss': 0.037026752605029335}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.02394945223227687, 'avg_test_loss': 0.03716915853992291}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.02388582651681355, 'avg_test_loss': 0.037239839828840764}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.023831823034109474, 'avg_test_loss': 0.03722542988888947}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.02382242934816922, 'avg_test_loss': 0.037046685286095296}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.023821554396384444, 'avg_test_loss': 0.03716378159577978}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.02373374212831581, 'avg_test_loss': 0.037140660226307666}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.023732011249472072, 'avg_test_loss': 0.03743985840183691}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.023699824480960766, 'avg_test_loss': 0.03716878138232504}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.023692243085885, 'avg_test_loss': 0.03707033521735309}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.023695507297786522, 'avg_test_loss': 0.03708429051705705}
INFO:model_data_nn.py:Early stopping at epoch 22
INFO:main_restricted_month.py:Making prediction for data in year: 1993
INFO:main_restricted_month.py:Prediction data shape: (50974,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 1993: 0.19259328557737743
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  50974.000000  50974.000000
mean       0.018012      0.006187
std        0.193299      0.013780
min       -0.950000     -0.108502
25%       -0.061224      0.005645
50%        0.000000      0.009075
75%        0.075000      0.009075
max       19.000000      0.307416
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Train_data: (517381, 161)

INFO:transform_data_nn.py:Test data years: [1993]
INFO:transform_data_nn.py:Test_data: (50974, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:transform_data_nn.py:Retrain_data: (568355, 161)

INFO:transform_data_nn.py:Prediction data years: [1994]
INFO:transform_data_nn.py:Prediction_data: (56928, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([517381, 138])
            y_train_tf: torch.Size([517381])

            x_test_tf: torch.Size([50974, 138])
            y_test_tf: torch.Size([50974])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([568355, 138])
            y_retrain_tf: torch.Size([568355])

            x_prediction_tf: torch.Size([56928, 138])
            y_prediction_tf: torch.Size([56928])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.7017e-01,  5.4430e-01,  1.2009e-01, -1.3250e+00, -1.0880e-01,
        -6.7292e-01, -1.8004e-01, -3.5933e-01,  3.2668e-01, -1.5317e-01,
        -7.0589e-01,  7.4726e-03, -4.8743e-01, -2.2608e-01,  1.0144e-01,
         5.1039e-01, -1.2794e-01,  2.0643e-01, -1.0678e-01,  4.7095e-01,
        -3.3926e-01,  1.6034e-03,  1.7851e-02,  1.7928e-02, -5.3087e-02,
        -2.6831e-01, -5.6195e-01, -1.7845e-02,  3.8549e-01,  1.0970e+00,
         4.2313e-01, -8.9777e-02,  4.4965e-01, -1.3829e-02, -3.8024e-01,
        -1.8186e-01,  1.0190e-01,  5.8749e-01,  2.8611e-02, -1.1229e+00,
        -3.0893e-01,  3.1183e-01,  2.8781e-01, -8.9431e-02, -1.5191e-01,
        -6.8379e-01,  1.0111e-01, -7.6698e-02, -4.0679e-01, -1.6009e-01,
        -6.9287e-01,  6.6100e-01, -1.3563e-01, -3.9684e-02,  2.3737e-02,
         4.2900e-01, -7.4683e-01,  5.1487e-02, -2.5445e-01, -2.8726e-02,
         1.2699e-01, -3.1623e-01,  1.3253e-01,  2.5171e-01,  1.1643e-01,
        -1.4354e-01,  2.8767e-01, -1.0047e-01,  7.1446e-01, -4.1912e-01,
        -1.6563e-01, -6.4405e-02, -3.0634e-02, -8.1485e-01,  9.5358e-02,
         6.0610e-01,  2.5212e-02, -3.5232e-01, -1.8446e-01,  6.2203e-03,
        -2.2769e-02,  2.6777e-01,  2.8779e-02, -3.3119e-01, -5.5081e-01,
        -1.0952e-01, -9.1631e-02, -3.2660e-01, -8.1110e-02,  1.6108e-01,
        -4.9870e-01, -1.2566e+00,  4.5272e-03,  1.6870e+00,  1.9463e+00,
         2.1191e+00,  3.9819e-01,  1.6656e+00, -2.7099e+00,  7.7995e-02,
        -2.9821e-01,  1.3334e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0548e-02,  3.9668e-01,  0.0000e+00, -1.1758e+00,
         6.5412e-01, -2.1153e+00,  1.5104e-01,  2.5704e-02,  0.0000e+00,
         0.0000e+00,  1.5606e-02, -1.6936e-01,  1.0378e-02, -6.9491e-02,
         4.7393e-02, -4.4982e-01, -3.5714e-01,  2.4907e-01,  2.6962e-01,
        -4.1738e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2808]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([ 8.2728e-03,  5.4755e-02, -4.9370e-01,  5.4448e-01,  2.9865e-01,
        -6.0803e-01, -2.2079e+00, -1.0301e+00, -4.6674e-01, -2.4042e-01,
        -1.7592e-02,  4.2173e-03, -3.7468e-02, -4.0824e-02,  2.9185e-02,
        -1.0207e+00, -1.7753e-01,  6.2290e-01,  1.4153e-01,  1.1150e-02,
         7.8102e-01, -7.0740e-02, -2.0869e-02, -3.4765e-01,  1.4737e-01,
        -9.8068e-03, -6.4582e-01, -7.3177e-01, -1.2937e+00,  3.8182e-02,
        -2.6866e-02, -2.1075e-01,  1.8523e-01, -1.3829e-02,  1.1890e-03,
         1.3803e+00,  1.7985e-02, -7.3909e-01,  4.1833e-01, -1.0074e+00,
        -4.5112e-02, -2.2884e-01,  1.1162e-02,  3.1080e-02,  4.3183e-03,
        -5.2148e-01, -2.0603e-01, -1.8556e-01,  3.2134e-01,  5.6058e-01,
         1.6397e+00, -8.3847e-01, -5.9076e-01, -7.3768e-01, -7.3865e-01,
         2.3038e-03, -1.0761e+00, -4.3372e-02, -9.3552e-03,  2.7181e-01,
        -5.0712e-03, -9.1803e-03,  1.0368e-02,  1.4657e-02, -9.1383e-03,
         5.3932e-03,  3.0839e-02,  1.1480e+00,  5.0633e-02, -1.2962e-02,
        -1.6563e-01, -6.4405e-02, -3.0634e-02, -4.5080e-01,  8.8855e-03,
         2.7061e-02,  1.3338e-03, -4.3063e-03,  1.4568e-03,  6.2203e-03,
         1.1851e-01, -4.7181e-01, -3.6238e-01, -1.7764e-01, -5.0873e-01,
        -3.4696e-03, -2.0132e-03,  3.1328e-02,  3.6180e-03,  1.2567e-01,
        -6.3390e-01,  9.6623e-01,  4.5272e-03, -1.3421e+00, -1.5261e+00,
        -9.5565e-01,  1.8065e+00, -1.6348e+00,  1.2081e+00, -1.1387e+00,
        -2.9790e-01,  3.0578e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.3509e-02,  2.2757e-01,  0.0000e+00,  5.2594e-01,
        -3.2482e-02,  5.0274e-01,  1.0084e-01,  2.5704e-02,  0.0000e+00,
         0.0000e+00,  1.5330e-02,  2.4573e-02,  1.0378e-02, -8.7727e-03,
         6.8298e-03,  1.7210e-03, -2.3708e-02,  1.1407e-01,  1.7418e-01,
        -3.3056e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2765]), tensor(0.))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-0.1627,  0.6010,  0.1038, -1.3195, -0.1077, -0.6889, -0.1846, -0.3644,
         0.3499, -0.1543, -0.7057,  0.0199, -0.4946, -0.2654,  0.1087,  0.5055,
        -0.1315,  0.2150, -0.0945,  0.4776, -0.3486,  0.0089,  0.0158,  0.0140,
        -0.0544, -0.2740, -0.5624, -0.0210,  0.3631,  1.1413,  0.4124, -0.0923,
         0.4571, -0.0308, -0.3776, -0.1795,  0.1072,  0.6029,  0.0264, -1.1189,
        -0.3120,  0.2898,  0.2903, -0.0789, -0.1500, -0.6933,  0.0886, -0.0803,
        -0.4103, -0.1748, -0.7108,  0.6464, -0.1296, -0.0334,  0.0165,  0.4286,
        -0.7389,  0.0540, -0.2568, -0.0286,  0.1291, -0.3176,  0.1324,  0.2510,
         0.1132, -0.1444,  0.3252, -0.1086,  0.7002, -0.4200, -0.1987, -0.0793,
        -0.0307, -0.8240,  0.1070,  0.6206,  0.0225, -0.3558, -0.1857,  0.0109,
        -0.0137,  0.2642,  0.0456, -0.3309, -0.5521, -0.1139, -0.0965, -0.3181,
        -0.0679,  0.1737, -0.5012, -1.2574,  0.0050,  1.7440,  1.9886,  2.1932,
         0.2080,  1.6965, -2.8025,  0.1979, -0.2860,  0.1305,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0546,  0.4049,  0.0000, -1.2438,  0.6958, -2.1782,
         0.1527,  0.0333,  0.0000,  0.0000,  0.0255, -0.1674, -0.0181, -0.0734,
         0.0633, -0.4506, -0.3607,  0.2574,  0.2741, -0.4159,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([3042]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-1.0948e+00, -1.4187e-01, -7.2058e-01,  7.0985e-01, -6.6578e-02,
        -4.6301e-01, -2.1650e+00, -9.9081e-01, -5.6268e-01, -3.7237e-01,
        -5.6175e-01,  3.7101e-05,  9.5947e-02,  2.8784e-01, -2.1512e-01,
        -3.9485e-02, -2.1531e-01,  2.2903e-01, -9.4515e-02,  1.8356e-01,
        -1.2135e-01, -7.2470e-02, -3.7642e-01,  1.9283e-01,  9.4689e-02,
        -5.3174e-01, -5.9323e-01, -5.7247e-01, -1.0604e+00,  3.9414e-01,
        -4.2560e-01, -3.0528e-02,  2.4880e-01, -3.0761e-02, -7.3488e-01,
         5.0971e-03,  4.3622e-01, -7.4795e-01, -1.4185e-01, -9.4123e-01,
        -1.1536e-01, -1.7670e-01,  6.4292e-01, -2.7651e-01, -1.4653e-01,
        -1.5836e-01,  2.1074e-01,  5.7376e-01,  3.4323e-01, -5.5554e-02,
         6.7760e-02, -7.0632e-01, -5.8268e-01, -6.8310e-01, -7.3676e-01,
         4.4897e-01, -1.0707e+00,  3.6216e-01, -4.3375e-01,  1.7003e-01,
         3.9617e-01, -5.8368e-01, -3.9668e-01, -8.6361e-01, -1.3517e-02,
        -4.9807e-01, -2.2457e-02,  2.7572e+00,  1.3656e+00, -4.1959e-01,
        -1.9874e-01, -7.9300e-02, -3.0728e-02, -1.0945e-01,  4.2815e-02,
         5.0835e-02, -1.8702e-01, -1.3443e-01, -7.7930e-02,  1.0893e-02,
         1.0953e-01,  1.3195e-01, -3.8316e-01,  1.4495e+00,  3.9895e-01,
        -1.0099e-01, -8.8832e-02, -2.9090e-01, -5.4957e-01,  2.0784e-02,
        -6.7326e-02,  1.3281e-01,  5.0155e-03, -1.4115e+00, -1.1303e+00,
        -1.2368e+00,  1.8042e+00, -1.4370e+00,  7.5057e-01, -1.1416e+00,
        -3.2038e-01,  4.8890e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.7368e-02, -9.0724e-02,  0.0000e+00,  4.8731e-01,
        -2.0389e-01,  2.8708e-01,  1.3301e-01,  2.1381e+00,  0.0000e+00,
         0.0000e+00, -5.9914e-01, -1.8123e-01, -3.8569e+00,  7.0866e-01,
        -4.0496e-01, -4.6480e-01, -4.2385e-01,  2.4829e-01,  3.2808e-01,
        -3.5306e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2150]), tensor(-0.0476))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:main_restricted_month.py:Testing data year: 1993
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 7524
            device: cpu
            
2024-07-27 23:48:08,145	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-27 23:48:08,187	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-27 23:48:08,224	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_341f1673add3bf67.zip' (1.40MiB) to Ray cluster...
2024-07-27 23:48:08,228	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_341f1673add3bf67.zip'.
2024-07-27 23:48:10,072	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-28 00:16:05,386	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_23-48-10' in 0.2418s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 125, 'num_layers': 3, 'num_embeddings': 7524, 'embedding_dim': 8, 'dropout_rate': 0.36, 'lr': 4.696605981338128e-05, 'weight_decay': 0.000799358605203772, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.023031007481857574
INFO:model_data_nn.py:Best trial testing loss: 0.03718280697760255
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-27_23-48-05_828383_365373/artifacts/2024-07-27_23-48-10/train_fnn_2024-07-27_23-48-10/driver_artifacts/train_fnn_5a5a9_00060_60_dropout_rate=0.3600,embedding_dim=8,hidden_dim=125,lr=0.0000,num_layers=3,weight_decay=0.0008_2024-07-27_23-48-10
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 125, 'num_layers': 3, 'num_embeddings': 8135, 'embedding_dim': 8, 'dropout_rate': 0.36, 'lr': 4.696605981338128e-05, 'weight_decay': 0.000799358605203772, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.026806693163065644, 'avg_test_loss': 0.02458164751963962}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.025770402526605216, 'avg_test_loss': 0.02454450280154438}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.025373349507196576, 'avg_test_loss': 0.02466358873271122}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.02511316382355234, 'avg_test_loss': 0.024698879538899224}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.024905538091106957, 'avg_test_loss': 0.0244732526996895}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.024740630951069834, 'avg_test_loss': 0.024493981319678466}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.024613244691260673, 'avg_test_loss': 0.02443538444414944}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.02452271438180996, 'avg_test_loss': 0.024603457027376534}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.02445566067852767, 'avg_test_loss': 0.024411104184973022}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.024382420460762857, 'avg_test_loss': 0.024608172816904576}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.024357292415074398, 'avg_test_loss': 0.02438578502630836}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.024318987247091035, 'avg_test_loss': 0.024485694679033974}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.024308150225555863, 'avg_test_loss': 0.024447357716572502}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.02428120307307852, 'avg_test_loss': 0.02453343442515627}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.024209696223954923, 'avg_test_loss': 0.024279231050972606}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.02419416328623443, 'avg_test_loss': 0.024269520217981816}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.024241602910598035, 'avg_test_loss': 0.02481995384637894}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.024217244737981147, 'avg_test_loss': 0.024879918474013385}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.0242113401993141, 'avg_test_loss': 0.024951517999726818}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.02419668416403609, 'avg_test_loss': 0.02493088659882713}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.024241250870874566, 'avg_test_loss': 0.024669145786705732}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.024198596125814462, 'avg_test_loss': 0.024859981178410685}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.024190600838385503, 'avg_test_loss': 0.02480090548640138}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.02417576547432932, 'avg_test_loss': 0.024626776142297}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.024167301104593947, 'avg_test_loss': 0.0248588384934858}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.02416074323323089, 'avg_test_loss': 0.02480142012322217}
INFO:model_data_nn.py:Early stopping at epoch 26
INFO:main_restricted_month.py:Making prediction for data in year: 1994
INFO:main_restricted_month.py:Prediction data shape: (56928,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 1994: 0.15744568054255878
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  56928.000000  56928.000000
mean      -0.002534     -0.007292
std        0.157461      0.037488
min       -0.937500     -0.629763
25%       -0.071429     -0.020204
50%       -0.005882      0.003660
75%        0.054054      0.015380
max       12.500000      0.750066
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:transform_data_nn.py:Train_data: (568355, 161)

INFO:transform_data_nn.py:Test data years: [1994]
INFO:transform_data_nn.py:Test_data: (56928, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:transform_data_nn.py:Retrain_data: (625283, 161)

INFO:transform_data_nn.py:Prediction data years: [1995]
INFO:transform_data_nn.py:Prediction_data: (64688, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([568355, 138])
            y_train_tf: torch.Size([568355])

            x_test_tf: torch.Size([56928, 138])
            y_test_tf: torch.Size([56928])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([625283, 138])
            y_retrain_tf: torch.Size([625283])

            x_prediction_tf: torch.Size([64688, 138])
            y_prediction_tf: torch.Size([64688])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-0.1627,  0.6010,  0.1038, -1.3195, -0.1077, -0.6889, -0.1846, -0.3644,
         0.3499, -0.1543, -0.7057,  0.0199, -0.4946, -0.2654,  0.1087,  0.5055,
        -0.1315,  0.2150, -0.0945,  0.4776, -0.3486,  0.0089,  0.0158,  0.0140,
        -0.0544, -0.2740, -0.5624, -0.0210,  0.3631,  1.1413,  0.4124, -0.0923,
         0.4571, -0.0308, -0.3776, -0.1795,  0.1072,  0.6029,  0.0264, -1.1189,
        -0.3120,  0.2898,  0.2903, -0.0789, -0.1500, -0.6933,  0.0886, -0.0803,
        -0.4103, -0.1748, -0.7108,  0.6464, -0.1296, -0.0334,  0.0165,  0.4286,
        -0.7389,  0.0540, -0.2568, -0.0286,  0.1291, -0.3176,  0.1324,  0.2510,
         0.1132, -0.1444,  0.3252, -0.1086,  0.7002, -0.4200, -0.1987, -0.0793,
        -0.0307, -0.8240,  0.1070,  0.6206,  0.0225, -0.3558, -0.1857,  0.0109,
        -0.0137,  0.2642,  0.0456, -0.3309, -0.5521, -0.1139, -0.0965, -0.3181,
        -0.0679,  0.1737, -0.5012, -1.2574,  0.0050,  1.7440,  1.9886,  2.1932,
         0.2080,  1.6965, -2.8025,  0.1979, -0.2860,  0.1305,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0546,  0.4049,  0.0000, -1.2438,  0.6958, -2.1782,
         0.1527,  0.0333,  0.0000,  0.0000,  0.0255, -0.1674, -0.0181, -0.0734,
         0.0633, -0.4506, -0.3607,  0.2574,  0.2741, -0.4159,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([3042]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-1.0948e+00, -1.4187e-01, -7.2058e-01,  7.0985e-01, -6.6578e-02,
        -4.6301e-01, -2.1650e+00, -9.9081e-01, -5.6268e-01, -3.7237e-01,
        -5.6175e-01,  3.7101e-05,  9.5947e-02,  2.8784e-01, -2.1512e-01,
        -3.9485e-02, -2.1531e-01,  2.2903e-01, -9.4515e-02,  1.8356e-01,
        -1.2135e-01, -7.2470e-02, -3.7642e-01,  1.9283e-01,  9.4689e-02,
        -5.3174e-01, -5.9323e-01, -5.7247e-01, -1.0604e+00,  3.9414e-01,
        -4.2560e-01, -3.0528e-02,  2.4880e-01, -3.0761e-02, -7.3488e-01,
         5.0971e-03,  4.3622e-01, -7.4795e-01, -1.4185e-01, -9.4123e-01,
        -1.1536e-01, -1.7670e-01,  6.4292e-01, -2.7651e-01, -1.4653e-01,
        -1.5836e-01,  2.1074e-01,  5.7376e-01,  3.4323e-01, -5.5554e-02,
         6.7760e-02, -7.0632e-01, -5.8268e-01, -6.8310e-01, -7.3676e-01,
         4.4897e-01, -1.0707e+00,  3.6216e-01, -4.3375e-01,  1.7003e-01,
         3.9617e-01, -5.8368e-01, -3.9668e-01, -8.6361e-01, -1.3517e-02,
        -4.9807e-01, -2.2457e-02,  2.7572e+00,  1.3656e+00, -4.1959e-01,
        -1.9874e-01, -7.9300e-02, -3.0728e-02, -1.0945e-01,  4.2815e-02,
         5.0835e-02, -1.8702e-01, -1.3443e-01, -7.7930e-02,  1.0893e-02,
         1.0953e-01,  1.3195e-01, -3.8316e-01,  1.4495e+00,  3.9895e-01,
        -1.0099e-01, -8.8832e-02, -2.9090e-01, -5.4957e-01,  2.0784e-02,
        -6.7326e-02,  1.3281e-01,  5.0155e-03, -1.4115e+00, -1.1303e+00,
        -1.2368e+00,  1.8042e+00, -1.4370e+00,  7.5057e-01, -1.1416e+00,
        -3.2038e-01,  4.8890e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.7368e-02, -9.0724e-02,  0.0000e+00,  4.8731e-01,
        -2.0389e-01,  2.8708e-01,  1.3301e-01,  2.1381e+00,  0.0000e+00,
         0.0000e+00, -5.9914e-01, -1.8123e-01, -3.8569e+00,  7.0866e-01,
        -4.0496e-01, -4.6480e-01, -4.2385e-01,  2.4829e-01,  3.2808e-01,
        -3.5306e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2150]), tensor(-0.0476))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-0.1577,  0.6453,  0.0969, -1.3052, -0.1139, -0.7019, -0.1833, -0.3657,
         0.3767, -0.1564, -0.7027,  0.0357, -0.4985, -0.2952,  0.1126,  0.5035,
        -0.1339,  0.2252, -0.0874,  0.4801, -0.3405,  0.0155,  0.0080,  0.0090,
        -0.0575, -0.2752, -0.5657, -0.0178,  0.3429,  1.1855,  0.4104, -0.0981,
         0.4655, -0.0238, -0.3644, -0.1862,  0.1035,  0.6340,  0.0177, -1.1194,
        -0.3136,  0.3177,  0.2852, -0.0695, -0.1550, -0.7002,  0.0979, -0.0723,
        -0.4205, -0.1636, -0.7271,  0.6331, -0.1250, -0.0247,  0.0110,  0.4260,
        -0.7312,  0.0713, -0.2568, -0.0265,  0.1289, -0.3170,  0.1312,  0.2541,
         0.1071, -0.1490,  0.3530, -0.1167,  0.6825, -0.4193, -0.2245, -0.0319,
        -0.0325, -0.8322,  0.1209,  0.6343,  0.0206, -0.3592, -0.1850,  0.0147,
        -0.0055,  0.2536,  0.0685, -0.3348, -0.5537, -0.1190, -0.1021, -0.3105,
        -0.0476,  0.1767, -0.5039, -1.2578,  0.0097,  1.8202,  2.0971,  2.2607,
         0.0844,  1.7846, -2.9385,  0.3121, -0.2769,  0.1251,  0.0000, -1.3687,
         0.0000,  2.5697,  0.0523,  0.4312,  0.0000, -1.3243,  0.7496, -2.3021,
         0.1531,  0.0370,  0.0000, -0.4823,  0.0434, -0.1689,  0.0072, -0.0806,
         0.0807, -0.4368, -0.3565,  0.2660,  0.2791, -0.4143,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([3404]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-4.8066e-01, -5.3158e-01, -7.6841e-01,  8.6130e-01, -2.9824e-01,
        -2.2998e-01, -1.5583e+00, -9.7009e-01, -4.2586e-01, -3.5658e-01,
        -6.7166e-01,  3.1419e-04, -1.0122e-02,  5.5465e-01, -7.0534e-02,
        -4.6088e-01, -1.7403e-01,  4.1837e-01, -8.7361e-02, -7.1934e-02,
         1.0543e-03, -6.5737e-02, -1.4886e-01, -2.2623e-01, -5.5274e-02,
        -5.5608e-01, -5.8789e-01, -1.7779e-02, -1.3612e+00,  6.9908e-01,
        -2.9599e-02, -1.1618e-01,  2.4594e-01, -2.3766e-02, -7.5812e-01,
         6.2633e-04,  3.3862e-02, -7.4003e-01,  3.1846e-01, -8.3698e-01,
         2.0403e-01, -1.1175e+00,  1.0480e-01, -2.3817e-01, -3.0323e-01,
        -4.0674e-01, -3.7382e-01, -3.1333e-01,  3.7712e-02, -2.2814e-01,
         1.5775e+00, -7.7847e-01, -4.7933e-01, -6.4357e-01, -7.3522e-01,
         3.6407e-01, -1.0666e+00,  1.1197e-01, -3.2990e-01, -2.1675e-01,
         1.1525e-01, -4.1919e-01, -1.9774e-01,  2.1786e-01, -1.4641e-02,
        -4.3009e-01, -2.6660e-01,  6.9628e-01,  1.3476e+00, -4.6254e-01,
        -2.2454e-01, -3.1857e-02, -3.2545e-02, -1.0438e-01,  3.7271e-02,
        -3.0687e-01, -1.0035e-01, -1.8808e-01, -5.0568e-02,  1.4729e-02,
        -5.4953e-03, -5.0477e-01, -3.4215e-01, -4.9930e-01, -6.5569e-01,
        -1.0229e-01, -9.2467e-02, -3.2483e-01, -6.4822e-01,  1.1650e-01,
        -7.0002e-01,  4.9078e-01,  9.7207e-03, -9.8185e-01, -5.1013e-02,
        -1.1580e+00,  3.5138e-01, -4.4943e-01, -2.9017e-02, -1.2657e+00,
        -2.3464e-01, -2.5423e-01,  0.0000e+00, -1.3687e+00,  0.0000e+00,
         2.5697e+00,  2.0467e-02, -1.9099e-01,  0.0000e+00, -1.7541e-01,
        -4.9659e-01,  8.8398e-01,  1.2988e-01,  7.7985e-01,  0.0000e+00,
        -4.8228e-01, -4.5178e-01, -1.9502e-01, -3.7534e+00,  7.7595e-01,
         2.9813e-01, -5.3571e-01, -4.7830e-01,  2.0182e-01,  2.6188e-01,
        -3.6246e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2353]), tensor(-0.0312))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:main_restricted_month.py:Testing data year: 1994
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 8135
            device: cpu
            
2024-07-28 01:45:21,742	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-28 01:45:21,781	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-28 01:45:21,817	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_341f1673add3bf67.zip' (1.40MiB) to Ray cluster...
2024-07-28 01:45:21,820	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_341f1673add3bf67.zip'.
2024-07-28 01:45:23,746	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-28 02:21:00,333	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_01-45-23' in 0.1761s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 15, 'num_layers': 2, 'num_embeddings': 8135, 'embedding_dim': 2, 'dropout_rate': 0.18, 'lr': 3.706603917411956e-05, 'weight_decay': 2.053169319946688e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.025391293360641238
INFO:model_data_nn.py:Best trial testing loss: 0.02443519518815316
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-28_01-45-19_459551_365373/artifacts/2024-07-28_01-45-23/train_fnn_2024-07-28_01-45-23/driver_artifacts/train_fnn_bac02_00091_91_dropout_rate=0.1800,embedding_dim=2,hidden_dim=15,lr=0.0000,num_layers=2,weight_decay=0.0000_2024-07-28_01-45-24
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 15, 'num_layers': 2, 'num_embeddings': 9176, 'embedding_dim': 2, 'dropout_rate': 0.18, 'lr': 3.706603917411956e-05, 'weight_decay': 2.053169319946688e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.026286818164431208, 'avg_test_loss': 0.02747243717561534}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.026017974181802815, 'avg_test_loss': 0.027402285078833383}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.02584058249762152, 'avg_test_loss': 0.027573509791241377}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.025694439398863886, 'avg_test_loss': 0.027704997378761642}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.025570034285498876, 'avg_test_loss': 0.02757849596333934}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.02549912289312835, 'avg_test_loss': 0.02762288204371251}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.025450552503649183, 'avg_test_loss': 0.027519362409802708}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.02539208422163041, 'avg_test_loss': 0.027577365312861642}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.025342889507515134, 'avg_test_loss': 0.027537008261300705}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.025271061343067412, 'avg_test_loss': 0.02750160435397034}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.02524584409752301, 'avg_test_loss': 0.027946177690172925}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.025208735274267823, 'avg_test_loss': 0.027753436142481075}
INFO:model_data_nn.py:Early stopping at epoch 12
INFO:main_restricted_month.py:Making prediction for data in year: 1995
INFO:main_restricted_month.py:Prediction data shape: (64688,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 1995: 0.1666021430881259
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  64688.000000  64688.000000
mean       0.023566     -0.006526
std        0.164422      0.026806
min       -0.885714     -0.227578
25%       -0.048029     -0.021437
50%        0.012255     -0.003399
75%        0.078947      0.009419
max        6.000000      0.214664
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:transform_data_nn.py:Train_data: (625283, 161)

INFO:transform_data_nn.py:Test data years: [1995]
INFO:transform_data_nn.py:Test_data: (64688, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:transform_data_nn.py:Retrain_data: (689971, 161)

INFO:transform_data_nn.py:Prediction data years: [1996]
INFO:transform_data_nn.py:Prediction_data: (66364, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([625283, 138])
            y_train_tf: torch.Size([625283])

            x_test_tf: torch.Size([64688, 138])
            y_test_tf: torch.Size([64688])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([689971, 138])
            y_retrain_tf: torch.Size([689971])

            x_prediction_tf: torch.Size([66364, 138])
            y_prediction_tf: torch.Size([66364])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-0.1577,  0.6453,  0.0969, -1.3052, -0.1139, -0.7019, -0.1833, -0.3657,
         0.3767, -0.1564, -0.7027,  0.0357, -0.4985, -0.2952,  0.1126,  0.5035,
        -0.1339,  0.2252, -0.0874,  0.4801, -0.3405,  0.0155,  0.0080,  0.0090,
        -0.0575, -0.2752, -0.5657, -0.0178,  0.3429,  1.1855,  0.4104, -0.0981,
         0.4655, -0.0238, -0.3644, -0.1862,  0.1035,  0.6340,  0.0177, -1.1194,
        -0.3136,  0.3177,  0.2852, -0.0695, -0.1550, -0.7002,  0.0979, -0.0723,
        -0.4205, -0.1636, -0.7271,  0.6331, -0.1250, -0.0247,  0.0110,  0.4260,
        -0.7312,  0.0713, -0.2568, -0.0265,  0.1289, -0.3170,  0.1312,  0.2541,
         0.1071, -0.1490,  0.3530, -0.1167,  0.6825, -0.4193, -0.2245, -0.0319,
        -0.0325, -0.8322,  0.1209,  0.6343,  0.0206, -0.3592, -0.1850,  0.0147,
        -0.0055,  0.2536,  0.0685, -0.3348, -0.5537, -0.1190, -0.1021, -0.3105,
        -0.0476,  0.1767, -0.5039, -1.2578,  0.0097,  1.8202,  2.0971,  2.2607,
         0.0844,  1.7846, -2.9385,  0.3121, -0.2769,  0.1251,  0.0000, -1.3687,
         0.0000,  2.5697,  0.0523,  0.4312,  0.0000, -1.3243,  0.7496, -2.3021,
         0.1531,  0.0370,  0.0000, -0.4823,  0.0434, -0.1689,  0.0072, -0.0806,
         0.0807, -0.4368, -0.3565,  0.2660,  0.2791, -0.4143,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([3404]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-4.8066e-01, -5.3158e-01, -7.6841e-01,  8.6130e-01, -2.9824e-01,
        -2.2998e-01, -1.5583e+00, -9.7009e-01, -4.2586e-01, -3.5658e-01,
        -6.7166e-01,  3.1419e-04, -1.0122e-02,  5.5465e-01, -7.0534e-02,
        -4.6088e-01, -1.7403e-01,  4.1837e-01, -8.7361e-02, -7.1934e-02,
         1.0543e-03, -6.5737e-02, -1.4886e-01, -2.2623e-01, -5.5274e-02,
        -5.5608e-01, -5.8789e-01, -1.7779e-02, -1.3612e+00,  6.9908e-01,
        -2.9599e-02, -1.1618e-01,  2.4594e-01, -2.3766e-02, -7.5812e-01,
         6.2633e-04,  3.3862e-02, -7.4003e-01,  3.1846e-01, -8.3698e-01,
         2.0403e-01, -1.1175e+00,  1.0480e-01, -2.3817e-01, -3.0323e-01,
        -4.0674e-01, -3.7382e-01, -3.1333e-01,  3.7712e-02, -2.2814e-01,
         1.5775e+00, -7.7847e-01, -4.7933e-01, -6.4357e-01, -7.3522e-01,
         3.6407e-01, -1.0666e+00,  1.1197e-01, -3.2990e-01, -2.1675e-01,
         1.1525e-01, -4.1919e-01, -1.9774e-01,  2.1786e-01, -1.4641e-02,
        -4.3009e-01, -2.6660e-01,  6.9628e-01,  1.3476e+00, -4.6254e-01,
        -2.2454e-01, -3.1857e-02, -3.2545e-02, -1.0438e-01,  3.7271e-02,
        -3.0687e-01, -1.0035e-01, -1.8808e-01, -5.0568e-02,  1.4729e-02,
        -5.4953e-03, -5.0477e-01, -3.4215e-01, -4.9930e-01, -6.5569e-01,
        -1.0229e-01, -9.2467e-02, -3.2483e-01, -6.4822e-01,  1.1650e-01,
        -7.0002e-01,  4.9078e-01,  9.7207e-03, -9.8185e-01, -5.1013e-02,
        -1.1580e+00,  3.5138e-01, -4.4943e-01, -2.9017e-02, -1.2657e+00,
        -2.3464e-01, -2.5423e-01,  0.0000e+00, -1.3687e+00,  0.0000e+00,
         2.5697e+00,  2.0467e-02, -1.9099e-01,  0.0000e+00, -1.7541e-01,
        -4.9659e-01,  8.8398e-01,  1.2988e-01,  7.7985e-01,  0.0000e+00,
        -4.8228e-01, -4.5178e-01, -1.9502e-01, -3.7534e+00,  7.7595e-01,
         2.9813e-01, -5.3571e-01, -4.7830e-01,  2.0182e-01,  2.6188e-01,
        -3.6246e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2353]), tensor(-0.0312))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.5115e-01,  6.7878e-01,  8.6460e-02, -1.2846e+00, -1.2093e-01,
        -7.1391e-01, -1.7670e-01, -3.6376e-01,  4.0088e-01, -1.6083e-01,
        -6.9722e-01,  4.7871e-02, -4.9641e-01, -3.2117e-01,  1.1761e-01,
         4.9977e-01, -1.3510e-01,  2.3261e-01, -8.1522e-02,  4.7643e-01,
        -3.6452e-01,  8.5700e-03, -1.6375e-02,  2.7922e-03, -5.7475e-02,
        -2.7246e-01, -5.7264e-01, -1.7562e-02,  3.2162e-01,  1.2292e+00,
         4.0564e-01, -1.0071e-01,  4.7209e-01, -2.1404e-02, -3.4663e-01,
        -1.9729e-01,  9.3637e-02,  6.7096e-01,  6.0137e-03, -1.1201e+00,
        -3.1364e-01,  3.3389e-01,  2.7511e-01, -6.6658e-02, -1.6334e-01,
        -7.0643e-01,  1.0276e-01, -7.9072e-02, -4.1991e-01, -1.7377e-01,
        -7.4343e-01,  6.2106e-01, -1.1911e-01, -1.8509e-02, -5.8326e-04,
         4.2330e-01, -7.1753e-01,  7.7758e-02, -2.5199e-01, -1.6758e-02,
         1.2850e-01, -3.1115e-01,  1.3145e-01,  2.5882e-01,  1.0167e-01,
        -1.5566e-01,  3.7438e-01, -1.2248e-01,  6.7024e-01, -4.1602e-01,
        -2.4363e-01, -4.1873e-02,  1.0253e-02, -8.3795e-01,  1.3184e-01,
         6.4058e-01,  1.7745e-02, -3.6379e-01, -1.8291e-01,  1.5171e-02,
        -5.9800e-03,  2.4079e-01,  9.0698e-02, -3.3896e-01, -5.5515e-01,
        -1.2394e-01, -1.0768e-01, -3.0361e-01, -2.4351e-02,  1.7289e-01,
        -5.0532e-01, -1.2586e+00,  1.1638e-02,  1.8495e+00,  2.2177e+00,
         2.3412e+00,  7.3758e-02,  1.9010e+00, -2.9626e+00,  4.2520e-01,
        -2.6368e-01,  1.1265e-01,  8.7652e-01,  2.0998e-01, -2.8435e-01,
         3.2755e-01,  4.8188e-02,  3.4251e-01,  0.0000e+00, -1.3148e+00,
         8.3954e-01, -2.4254e+00,  1.5367e-01,  5.6624e-02,  0.0000e+00,
        -1.7589e-01,  7.0891e-02, -1.7468e-01, -7.7470e-03, -9.1207e-02,
         9.3465e-02, -4.1693e-01, -3.4837e-01,  2.7132e-01,  2.8253e-01,
        -4.1336e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3708]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-3.4436e-01, -5.7929e-01, -5.1359e-01,  1.0057e+00, -8.1645e-02,
        -1.9217e-01, -6.2659e-01, -6.4998e-01, -4.6026e-01, -4.1355e-01,
        -7.1484e-01,  2.1049e-02, -1.3242e-01,  5.6856e-01,  1.4881e-01,
         6.9657e-02, -2.1576e-01,  3.3217e-01, -1.9636e-01,  1.4227e-01,
         2.0832e-01, -6.1980e-02, -2.1628e-02, -2.2795e-01,  9.1561e-02,
        -5.9874e-01, -6.0964e-01, -1.7562e-02, -1.3131e+00,  6.1630e-01,
        -4.4554e-01, -6.0665e-02,  2.4826e-01, -2.1404e-02, -7.3475e-01,
        -5.8997e-02,  2.5754e-01, -7.4060e-01, -6.5291e-02, -8.8391e-01,
        -1.2951e-02,  2.1373e-01,  2.6887e-01, -2.5199e-01, -1.5242e-01,
         1.9085e-01, -6.0896e-04,  5.1835e-01, -1.2395e-01,  4.5563e-02,
         1.5505e+00, -7.0046e-01, -5.8815e-01, -6.1109e-01, -7.3629e-01,
         3.9249e-01, -1.0568e+00,  3.6373e-01, -5.0217e-01, -3.7325e-01,
         1.0860e-01, -5.2731e-01, -2.1279e-01,  6.5980e-02, -1.5879e-02,
        -4.0546e-01, -2.6970e-01, -5.8012e-02,  1.3366e+00, -5.0869e-01,
        -2.4363e-01, -4.1873e-02,  1.0253e-02,  6.2562e-02,  5.6102e-02,
        -8.0481e-02,  8.5257e-02, -2.2827e-01, -5.2710e-02,  1.5171e-02,
         1.2069e-01, -6.1242e-02, -3.4225e-01,  1.1214e+00, -4.0444e-01,
        -1.0315e-01, -9.6106e-02, -3.4683e-01, -5.6943e-01,  2.5184e-01,
        -5.2606e-01, -6.4604e-01,  1.1638e-02, -1.8631e+00, -6.1791e-01,
        -1.1931e+00,  3.0440e-01, -5.8663e-01, -1.0121e+00, -1.0404e+00,
        -1.9768e-01,  9.6121e-02,  8.7652e-01, -3.5540e+00, -2.8435e-01,
         5.7011e+00,  2.1198e-02,  5.5717e-01,  0.0000e+00, -3.3296e-01,
        -8.1562e-01,  4.5206e-01,  1.3306e-01,  1.2583e+00,  0.0000e+00,
        -1.7589e-01, -3.9161e-01, -1.5439e-01, -3.7189e+00,  7.2864e-01,
         4.8963e-02, -4.9380e-01, -5.1432e-01,  2.2382e-01,  2.8417e-01,
        -3.8725e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2418]), tensor(-0.0267))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:main_restricted_month.py:Testing data year: 1995
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 9176
            device: cpu
            
2024-07-28 03:46:26,062	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-28 03:46:26,101	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-28 03:46:26,137	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_341f1673add3bf67.zip' (1.40MiB) to Ray cluster...
2024-07-28 03:46:26,141	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_341f1673add3bf67.zip'.
2024-07-28 03:46:28,171	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-28 04:47:52,245	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_03-46-28' in 0.1880s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 3, 'num_embeddings': 9176, 'embedding_dim': 9, 'dropout_rate': 0.49, 'lr': 2.1456816483566953e-06, 'weight_decay': 3.8468952779413876e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.026316626446655497
INFO:model_data_nn.py:Best trial testing loss: 0.027152955056049307
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-28_03-46-23_875776_365373/artifacts/2024-07-28_03-46-28/train_fnn_2024-07-28_03-46-28/driver_artifacts/train_fnn_a4af6_00074_74_dropout_rate=0.4900,embedding_dim=9,hidden_dim=5,lr=0.0000,num_layers=3,weight_decay=0.0000_2024-07-28_03-46-28
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 3, 'num_embeddings': 9990, 'embedding_dim': 9, 'dropout_rate': 0.49, 'lr': 2.1456816483566953e-06, 'weight_decay': 3.8468952779413876e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.02654750548810556, 'avg_test_loss': 0.028890657070494305}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.026454482491039773, 'avg_test_loss': 0.028861554688437263}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.02643303763628968, 'avg_test_loss': 0.028850012726492628}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.026428087398512816, 'avg_test_loss': 0.028843309355562008}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.026426065880236837, 'avg_test_loss': 0.028840085628721774}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.026426463788562716, 'avg_test_loss': 0.02883935129187333}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.0264236602364057, 'avg_test_loss': 0.028837362214296038}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.02642271864850704, 'avg_test_loss': 0.02883570769975966}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.026423735026031382, 'avg_test_loss': 0.028835002540609833}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.02642330686920177, 'avg_test_loss': 0.028834941787303947}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.026424167540104754, 'avg_test_loss': 0.028834682504898845}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.026422654425474996, 'avg_test_loss': 0.028833125821892226}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.02642241003523585, 'avg_test_loss': 0.028832330610495324}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.026420763949839856, 'avg_test_loss': 0.028832365169118922}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.026420939449549506, 'avg_test_loss': 0.02882992067210836}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.026419923011036968, 'avg_test_loss': 0.02882916660370483}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.026420066879296673, 'avg_test_loss': 0.02883054724227181}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.026419681061016734, 'avg_test_loss': 0.028828406247077734}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.02641928730260931, 'avg_test_loss': 0.028829779830449615}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.026416687654377456, 'avg_test_loss': 0.028826385823580488}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.026417715832988086, 'avg_test_loss': 0.028825099164846362}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.026414978880329492, 'avg_test_loss': 0.028826221921135427}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.02642463616938347, 'avg_test_loss': 0.028822288805800296}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.026415416746851314, 'avg_test_loss': 0.02882328971622291}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.026416931650482547, 'avg_test_loss': 0.02882564114406705}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.026412579671573663, 'avg_test_loss': 0.0288185279458499}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.02641405394922708, 'avg_test_loss': 0.028821198715628084}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.026414656755926934, 'avg_test_loss': 0.0288212034025516}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.02641008735435959, 'avg_test_loss': 0.028817055210526837}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.026410668133673782, 'avg_test_loss': 0.028815115639435177}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.02641241869940772, 'avg_test_loss': 0.028817781680303994}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.02640737539459448, 'avg_test_loss': 0.02881532266539348}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.026413165755046784, 'avg_test_loss': 0.028816692813334623}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.026409741864955975, 'avg_test_loss': 0.028817822310935236}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.026405884846979293, 'avg_test_loss': 0.02881487926985555}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.026410773330147904, 'avg_test_loss': 0.02881294770234533}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.02640604914498877, 'avg_test_loss': 0.02881114041273776}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.02640406670792267, 'avg_test_loss': 0.028812721957880986}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.02640728081930966, 'avg_test_loss': 0.02881492679290251}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.026406419044269814, 'avg_test_loss': 0.028813957037330536}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.026403833119116267, 'avg_test_loss': 0.02881017362334287}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.026405461379977794, 'avg_test_loss': 0.028812170251862668}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.02639866942943577, 'avg_test_loss': 0.02881004642169804}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.02640106111919365, 'avg_test_loss': 0.028806869079571723}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.026398711971725757, 'avg_test_loss': 0.02880778640356874}
INFO:model_data_nn.py:Epoch 46/50, metrics: {'avg_train_loss': 0.02639784408227375, 'avg_test_loss': 0.028807862831518528}
INFO:model_data_nn.py:Epoch 47/50, metrics: {'avg_train_loss': 0.02640014121981175, 'avg_test_loss': 0.028809025125234974}
INFO:model_data_nn.py:Epoch 48/50, metrics: {'avg_train_loss': 0.02639794220282139, 'avg_test_loss': 0.028801880971319332}
INFO:model_data_nn.py:Epoch 49/50, metrics: {'avg_train_loss': 0.026395162129089652, 'avg_test_loss': 0.02880197656390292}
INFO:model_data_nn.py:Epoch 50/50, metrics: {'avg_train_loss': 0.026397119307237978, 'avg_test_loss': 0.02880210462659454}
INFO:main_restricted_month.py:Making prediction for data in year: 1996
INFO:main_restricted_month.py:Prediction data shape: (66364,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 1996: 0.16971148181687787
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  66364.000000  66364.000000
mean       0.016258      0.012916
std        0.169806      0.002380
min       -0.909091     -0.008123
25%       -0.058824      0.011997
50%        0.003930      0.013313
75%        0.074962      0.013894
max        7.000000      0.035611
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:transform_data_nn.py:Train_data: (689971, 161)

INFO:transform_data_nn.py:Test data years: [1996]
INFO:transform_data_nn.py:Test_data: (66364, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:transform_data_nn.py:Retrain_data: (756335, 161)

INFO:transform_data_nn.py:Prediction data years: [1997]
INFO:transform_data_nn.py:Prediction_data: (69689, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([689971, 138])
            y_train_tf: torch.Size([689971])

            x_test_tf: torch.Size([66364, 138])
            y_test_tf: torch.Size([66364])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([756335, 138])
            y_retrain_tf: torch.Size([756335])

            x_prediction_tf: torch.Size([69689, 138])
            y_prediction_tf: torch.Size([69689])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.5115e-01,  6.7878e-01,  8.6460e-02, -1.2846e+00, -1.2093e-01,
        -7.1391e-01, -1.7670e-01, -3.6376e-01,  4.0088e-01, -1.6083e-01,
        -6.9722e-01,  4.7871e-02, -4.9641e-01, -3.2117e-01,  1.1761e-01,
         4.9977e-01, -1.3510e-01,  2.3261e-01, -8.1522e-02,  4.7643e-01,
        -3.6452e-01,  8.5700e-03, -1.6375e-02,  2.7922e-03, -5.7475e-02,
        -2.7246e-01, -5.7264e-01, -1.7562e-02,  3.2162e-01,  1.2292e+00,
         4.0564e-01, -1.0071e-01,  4.7209e-01, -2.1404e-02, -3.4663e-01,
        -1.9729e-01,  9.3637e-02,  6.7096e-01,  6.0137e-03, -1.1201e+00,
        -3.1364e-01,  3.3389e-01,  2.7511e-01, -6.6658e-02, -1.6334e-01,
        -7.0643e-01,  1.0276e-01, -7.9072e-02, -4.1991e-01, -1.7377e-01,
        -7.4343e-01,  6.2106e-01, -1.1911e-01, -1.8509e-02, -5.8326e-04,
         4.2330e-01, -7.1753e-01,  7.7758e-02, -2.5199e-01, -1.6758e-02,
         1.2850e-01, -3.1115e-01,  1.3145e-01,  2.5882e-01,  1.0167e-01,
        -1.5566e-01,  3.7438e-01, -1.2248e-01,  6.7024e-01, -4.1602e-01,
        -2.4363e-01, -4.1873e-02,  1.0253e-02, -8.3795e-01,  1.3184e-01,
         6.4058e-01,  1.7745e-02, -3.6379e-01, -1.8291e-01,  1.5171e-02,
        -5.9800e-03,  2.4079e-01,  9.0698e-02, -3.3896e-01, -5.5515e-01,
        -1.2394e-01, -1.0768e-01, -3.0361e-01, -2.4351e-02,  1.7289e-01,
        -5.0532e-01, -1.2586e+00,  1.1638e-02,  1.8495e+00,  2.2177e+00,
         2.3412e+00,  7.3758e-02,  1.9010e+00, -2.9626e+00,  4.2520e-01,
        -2.6368e-01,  1.1265e-01,  8.7652e-01,  2.0998e-01, -2.8435e-01,
         3.2755e-01,  4.8188e-02,  3.4251e-01,  0.0000e+00, -1.3148e+00,
         8.3954e-01, -2.4254e+00,  1.5367e-01,  5.6624e-02,  0.0000e+00,
        -1.7589e-01,  7.0891e-02, -1.7468e-01, -7.7470e-03, -9.1207e-02,
         9.3465e-02, -4.1693e-01, -3.4837e-01,  2.7132e-01,  2.8253e-01,
        -4.1336e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3708]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-3.4436e-01, -5.7929e-01, -5.1359e-01,  1.0057e+00, -8.1645e-02,
        -1.9217e-01, -6.2659e-01, -6.4998e-01, -4.6026e-01, -4.1355e-01,
        -7.1484e-01,  2.1049e-02, -1.3242e-01,  5.6856e-01,  1.4881e-01,
         6.9657e-02, -2.1576e-01,  3.3217e-01, -1.9636e-01,  1.4227e-01,
         2.0832e-01, -6.1980e-02, -2.1628e-02, -2.2795e-01,  9.1561e-02,
        -5.9874e-01, -6.0964e-01, -1.7562e-02, -1.3131e+00,  6.1630e-01,
        -4.4554e-01, -6.0665e-02,  2.4826e-01, -2.1404e-02, -7.3475e-01,
        -5.8997e-02,  2.5754e-01, -7.4060e-01, -6.5291e-02, -8.8391e-01,
        -1.2951e-02,  2.1373e-01,  2.6887e-01, -2.5199e-01, -1.5242e-01,
         1.9085e-01, -6.0896e-04,  5.1835e-01, -1.2395e-01,  4.5563e-02,
         1.5505e+00, -7.0046e-01, -5.8815e-01, -6.1109e-01, -7.3629e-01,
         3.9249e-01, -1.0568e+00,  3.6373e-01, -5.0217e-01, -3.7325e-01,
         1.0860e-01, -5.2731e-01, -2.1279e-01,  6.5980e-02, -1.5879e-02,
        -4.0546e-01, -2.6970e-01, -5.8012e-02,  1.3366e+00, -5.0869e-01,
        -2.4363e-01, -4.1873e-02,  1.0253e-02,  6.2562e-02,  5.6102e-02,
        -8.0481e-02,  8.5257e-02, -2.2827e-01, -5.2710e-02,  1.5171e-02,
         1.2069e-01, -6.1242e-02, -3.4225e-01,  1.1214e+00, -4.0444e-01,
        -1.0315e-01, -9.6106e-02, -3.4683e-01, -5.6943e-01,  2.5184e-01,
        -5.2606e-01, -6.4604e-01,  1.1638e-02, -1.8631e+00, -6.1791e-01,
        -1.1931e+00,  3.0440e-01, -5.8663e-01, -1.0121e+00, -1.0404e+00,
        -1.9768e-01,  9.6121e-02,  8.7652e-01, -3.5540e+00, -2.8435e-01,
         5.7011e+00,  2.1198e-02,  5.5717e-01,  0.0000e+00, -3.3296e-01,
        -8.1562e-01,  4.5206e-01,  1.3306e-01,  1.2583e+00,  0.0000e+00,
        -1.7589e-01, -3.9161e-01, -1.5439e-01, -3.7189e+00,  7.2864e-01,
         4.8963e-02, -4.9380e-01, -5.1432e-01,  2.2382e-01,  2.8417e-01,
        -3.8725e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2418]), tensor(-0.0267))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.4631e-01,  7.0476e-01,  8.0238e-02, -1.2704e+00, -1.3231e-01,
        -7.2684e-01, -1.7092e-01, -3.6127e-01,  4.2792e-01, -1.6026e-01,
        -6.9211e-01,  5.6735e-02, -4.9922e-01, -3.4349e-01,  1.2150e-01,
         4.9917e-01, -1.4035e-01,  2.3843e-01, -7.0488e-02,  4.7859e-01,
        -3.5053e-01,  1.6771e-02, -3.9675e-02,  9.1100e-04, -5.5481e-02,
        -2.7161e-01, -5.7818e-01, -2.3942e-02,  2.9207e-01,  1.2764e+00,
         3.9673e-01, -1.0894e-01,  4.7959e-01, -3.2311e-02, -3.3145e-01,
        -2.0663e-01,  8.7599e-02,  7.0316e-01, -4.4676e-03, -1.1186e+00,
        -3.1060e-01,  2.9868e-01,  2.6866e-01, -5.9542e-02, -1.6888e-01,
        -7.1389e-01,  8.5738e-02, -8.1407e-02, -4.1178e-01, -1.7512e-01,
        -7.5511e-01,  6.0300e-01, -1.1067e-01, -1.5875e-02, -1.0794e-02,
         4.2188e-01, -7.0269e-01,  7.8057e-02, -2.5571e-01, -1.4129e-02,
         1.2983e-01, -3.1328e-01,  1.3267e-01,  2.5925e-01,  9.2818e-02,
        -1.6081e-01,  3.9165e-01, -1.2856e-01,  6.6928e-01, -4.1450e-01,
        -2.5878e-01, -5.0830e-02,  1.8030e-02, -8.4610e-01,  1.4071e-01,
         6.5265e-01,  1.5256e-02, -3.6777e-01, -1.8135e-01,  1.2927e-02,
        -4.3960e-03,  2.2777e-01,  1.1225e-01, -3.3574e-01, -5.5726e-01,
        -1.2834e-01, -1.1268e-01, -2.9582e-01, -6.4119e-03,  1.7198e-01,
        -5.1009e-01, -1.2605e+00,  1.5577e-02,  1.8174e+00,  2.3333e+00,
         2.4016e+00,  1.6237e-02,  2.0134e+00, -3.0296e+00,  5.1546e-01,
        -2.6230e-01,  1.0536e-01, -5.2831e-01,  8.2116e-02,  3.6758e-01,
         2.0728e-01,  4.8601e-02,  2.9171e-01,  0.0000e+00, -1.3834e+00,
         8.8043e-01, -2.5414e+00,  1.5481e-01,  4.0843e-02,  0.0000e+00,
        -8.5139e-02,  9.6993e-02, -1.7834e-01,  8.3234e-03, -9.9765e-02,
         9.8050e-02, -3.9986e-01, -3.4468e-01,  2.7656e-01,  2.8572e-01,
        -4.1571e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3935]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-8.5422e-01,  1.6240e-01,  2.0889e-01,  1.1386e+00, -7.8209e-02,
        -4.7811e-01, -6.1331e-01, -6.3954e-01, -3.0587e-01, -2.9231e-01,
        -7.4798e-01,  8.7101e-03, -2.1885e+00,  8.3494e-02, -4.2192e-01,
        -4.5103e-01, -1.8882e-01, -1.3108e-01,  5.3114e-02, -3.6595e-03,
         3.4090e-01, -5.8376e-02, -1.3241e-01, -2.3101e-01,  5.6787e-02,
        -5.9577e-01, -6.2372e-01, -5.4654e-01, -9.1072e-01,  9.1853e-01,
        -4.3404e-01, -1.2069e-01,  2.4516e-01, -2.4143e+00, -7.7776e-01,
        -1.1204e-01,  5.5958e-02, -7.3600e-01, -2.5842e-01, -8.6813e-01,
         7.6487e-02, -1.1220e-01,  2.8900e-01, -1.7797e-01, -1.2388e-01,
        -1.7953e-01, -3.3173e-01, -5.0788e-01, -2.6052e-01,  1.4590e-01,
         1.5105e-02, -7.7359e-01, -5.7993e-01, -5.8762e-01, -7.3549e-01,
         2.8197e-01, -1.0456e+00,  1.0569e-01, -2.0260e-01, -3.4978e-01,
         5.6972e-02, -1.5908e-01, -1.1655e-01, -7.0048e-02, -1.5375e-02,
        -3.6011e-01,  1.7346e-01, -6.1534e-01,  1.2145e-03, -5.0418e-01,
        -2.5878e-01, -5.0830e-02,  1.8030e-02,  3.9091e-01,  4.9053e-02,
         4.1437e-02,  1.1649e+00, -2.6284e-01, -9.5820e-02,  1.2927e-02,
         1.1827e-01, -3.0074e-01, -2.7075e-01, -8.9647e-03, -5.0889e-01,
        -1.0903e-01, -1.0206e-01, -3.5952e-01, -6.1812e-01,  2.2710e-02,
        -5.4684e-01, -9.6776e-01,  1.5577e-02, -1.9293e+00, -7.3268e-01,
        -1.2622e+00,  6.5780e-01, -6.3239e-01, -3.4182e-01, -9.0899e-01,
        -1.8571e-02,  1.0156e-01, -5.2831e-01, -2.8377e+00,  3.6758e-01,
         4.4166e+00,  1.5510e-02, -3.5244e-01,  0.0000e+00,  7.7182e-01,
         5.6876e-01,  9.8288e-01,  1.2841e-01,  6.9218e-01,  0.0000e+00,
        -8.5139e-02, -2.7258e-01, -1.7472e-01, -3.7231e+00,  7.8711e-01,
        -7.5983e-01, -5.6157e-01, -5.6083e-01,  1.7114e-01,  2.3170e-01,
        -4.0181e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2587]), tensor(0.0615))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:main_restricted_month.py:Testing data year: 1996
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 9990
            device: cpu
            
2024-07-28 06:47:57,715	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-28 06:47:57,757	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-28 06:47:57,793	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_341f1673add3bf67.zip' (1.40MiB) to Ray cluster...
2024-07-28 06:47:57,798	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_341f1673add3bf67.zip'.
2024-07-28 06:47:59,878	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-28 07:41:11,887	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_06-47-59' in 0.2316s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 95, 'num_layers': 4, 'num_embeddings': 9990, 'embedding_dim': 3, 'dropout_rate': 0.44, 'lr': 0.00011400863701127328, 'weight_decay': 5.9874749104614036e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.024477490823546263
INFO:model_data_nn.py:Best trial testing loss: 0.028387063429192456
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-28_06-47-55_413595_365373/artifacts/2024-07-28_06-47-59/train_fnn_2024-07-28_06-47-59/driver_artifacts/train_fnn_00a5f_00003_3_dropout_rate=0.4400,embedding_dim=3,hidden_dim=95,lr=0.0001,num_layers=4,weight_decay=0.0001_2024-07-28_06-48-00
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 95, 'num_layers': 4, 'num_embeddings': 10575, 'embedding_dim': 3, 'dropout_rate': 0.44, 'lr': 0.00011400863701127328, 'weight_decay': 5.9874749104614036e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.026767797791324197, 'avg_test_loss': 0.030920252036320386}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.026258126822181888, 'avg_test_loss': 0.031026215352164196}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.025917296919268445, 'avg_test_loss': 0.030999491563583385}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.025700277645516946, 'avg_test_loss': 0.031037535271038627}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.02555728443285312, 'avg_test_loss': 0.030802821107653436}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.025423262762257263, 'avg_test_loss': 0.030868568914558456}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.02533104790745495, 'avg_test_loss': 0.030804296409842943}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.02527761457869044, 'avg_test_loss': 0.030996420834199814}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.025209471025502753, 'avg_test_loss': 0.03077368514485746}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.025188688995955895, 'avg_test_loss': 0.03065805025082304}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.025150298102486, 'avg_test_loss': 0.03078933751520156}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.02513335025074951, 'avg_test_loss': 0.030590191858506754}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.025127858524674914, 'avg_test_loss': 0.030643006016160775}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.025090863792771683, 'avg_test_loss': 0.030603120612755375}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.025097097494431567, 'avg_test_loss': 0.030635396751538396}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.025061433476500403, 'avg_test_loss': 0.030515371900499962}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.02503982818636455, 'avg_test_loss': 0.03058382576071513}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.025065666331021776, 'avg_test_loss': 0.030615694767002724}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.025040385526894797, 'avg_test_loss': 0.03065424747474293}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.02505044809365757, 'avg_test_loss': 0.030513837038991756}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.025013976055437773, 'avg_test_loss': 0.030622916200341053}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.025017566410586663, 'avg_test_loss': 0.03060248738994584}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.025015130732027237, 'avg_test_loss': 0.030608275199704098}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.024999057973260155, 'avg_test_loss': 0.030461829555493713}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.024994491388971474, 'avg_test_loss': 0.03059640060255049}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.02499748786919564, 'avg_test_loss': 0.03069409260635766}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.024990629279679627, 'avg_test_loss': 0.030585999975170808}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.024981118089215725, 'avg_test_loss': 0.03052779307154489}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.02498664373492062, 'avg_test_loss': 0.030607019324040363}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.024996983258285033, 'avg_test_loss': 0.03070442507828563}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.024987334699553897, 'avg_test_loss': 0.03059020264098152}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.02499557991612518, 'avg_test_loss': 0.030581536654920017}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.024985155698397734, 'avg_test_loss': 0.030614997544201883}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.024985057533113263, 'avg_test_loss': 0.03056506269172696}
INFO:model_data_nn.py:Early stopping at epoch 34
INFO:main_restricted_month.py:Making prediction for data in year: 1997
INFO:main_restricted_month.py:Prediction data shape: (69689,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 1997: 0.1748304772624739
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  69689.000000  69689.000000
mean       0.018636      0.012590
std        0.175911      0.016090
min       -0.937500     -0.301833
25%       -0.063158      0.008775
50%        0.008772      0.014885
75%        0.086420      0.018752
max        6.076923      0.360072
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:transform_data_nn.py:Train_data: (756335, 161)

INFO:transform_data_nn.py:Test data years: [1997]
INFO:transform_data_nn.py:Test_data: (69689, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:transform_data_nn.py:Retrain_data: (826024, 161)

INFO:transform_data_nn.py:Prediction data years: [1998]
INFO:transform_data_nn.py:Prediction_data: (70794, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([756335, 138])
            y_train_tf: torch.Size([756335])

            x_test_tf: torch.Size([69689, 138])
            y_test_tf: torch.Size([69689])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([826024, 138])
            y_retrain_tf: torch.Size([826024])

            x_prediction_tf: torch.Size([70794, 138])
            y_prediction_tf: torch.Size([70794])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.4631e-01,  7.0476e-01,  8.0238e-02, -1.2704e+00, -1.3231e-01,
        -7.2684e-01, -1.7092e-01, -3.6127e-01,  4.2792e-01, -1.6026e-01,
        -6.9211e-01,  5.6735e-02, -4.9922e-01, -3.4349e-01,  1.2150e-01,
         4.9917e-01, -1.4035e-01,  2.3843e-01, -7.0488e-02,  4.7859e-01,
        -3.5053e-01,  1.6771e-02, -3.9675e-02,  9.1100e-04, -5.5481e-02,
        -2.7161e-01, -5.7818e-01, -2.3942e-02,  2.9207e-01,  1.2764e+00,
         3.9673e-01, -1.0894e-01,  4.7959e-01, -3.2311e-02, -3.3145e-01,
        -2.0663e-01,  8.7599e-02,  7.0316e-01, -4.4676e-03, -1.1186e+00,
        -3.1060e-01,  2.9868e-01,  2.6866e-01, -5.9542e-02, -1.6888e-01,
        -7.1389e-01,  8.5738e-02, -8.1407e-02, -4.1178e-01, -1.7512e-01,
        -7.5511e-01,  6.0300e-01, -1.1067e-01, -1.5875e-02, -1.0794e-02,
         4.2188e-01, -7.0269e-01,  7.8057e-02, -2.5571e-01, -1.4129e-02,
         1.2983e-01, -3.1328e-01,  1.3267e-01,  2.5925e-01,  9.2818e-02,
        -1.6081e-01,  3.9165e-01, -1.2856e-01,  6.6928e-01, -4.1450e-01,
        -2.5878e-01, -5.0830e-02,  1.8030e-02, -8.4610e-01,  1.4071e-01,
         6.5265e-01,  1.5256e-02, -3.6777e-01, -1.8135e-01,  1.2927e-02,
        -4.3960e-03,  2.2777e-01,  1.1225e-01, -3.3574e-01, -5.5726e-01,
        -1.2834e-01, -1.1268e-01, -2.9582e-01, -6.4119e-03,  1.7198e-01,
        -5.1009e-01, -1.2605e+00,  1.5577e-02,  1.8174e+00,  2.3333e+00,
         2.4016e+00,  1.6237e-02,  2.0134e+00, -3.0296e+00,  5.1546e-01,
        -2.6230e-01,  1.0536e-01, -5.2831e-01,  8.2116e-02,  3.6758e-01,
         2.0728e-01,  4.8601e-02,  2.9171e-01,  0.0000e+00, -1.3834e+00,
         8.8043e-01, -2.5414e+00,  1.5481e-01,  4.0843e-02,  0.0000e+00,
        -8.5139e-02,  9.6993e-02, -1.7834e-01,  8.3234e-03, -9.9765e-02,
         9.8050e-02, -3.9986e-01, -3.4468e-01,  2.7656e-01,  2.8572e-01,
        -4.1571e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3935]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-8.5422e-01,  1.6240e-01,  2.0889e-01,  1.1386e+00, -7.8209e-02,
        -4.7811e-01, -6.1331e-01, -6.3954e-01, -3.0587e-01, -2.9231e-01,
        -7.4798e-01,  8.7101e-03, -2.1885e+00,  8.3494e-02, -4.2192e-01,
        -4.5103e-01, -1.8882e-01, -1.3108e-01,  5.3114e-02, -3.6595e-03,
         3.4090e-01, -5.8376e-02, -1.3241e-01, -2.3101e-01,  5.6787e-02,
        -5.9577e-01, -6.2372e-01, -5.4654e-01, -9.1072e-01,  9.1853e-01,
        -4.3404e-01, -1.2069e-01,  2.4516e-01, -2.4143e+00, -7.7776e-01,
        -1.1204e-01,  5.5958e-02, -7.3600e-01, -2.5842e-01, -8.6813e-01,
         7.6487e-02, -1.1220e-01,  2.8900e-01, -1.7797e-01, -1.2388e-01,
        -1.7953e-01, -3.3173e-01, -5.0788e-01, -2.6052e-01,  1.4590e-01,
         1.5105e-02, -7.7359e-01, -5.7993e-01, -5.8762e-01, -7.3549e-01,
         2.8197e-01, -1.0456e+00,  1.0569e-01, -2.0260e-01, -3.4978e-01,
         5.6972e-02, -1.5908e-01, -1.1655e-01, -7.0048e-02, -1.5375e-02,
        -3.6011e-01,  1.7346e-01, -6.1534e-01,  1.2145e-03, -5.0418e-01,
        -2.5878e-01, -5.0830e-02,  1.8030e-02,  3.9091e-01,  4.9053e-02,
         4.1437e-02,  1.1649e+00, -2.6284e-01, -9.5820e-02,  1.2927e-02,
         1.1827e-01, -3.0074e-01, -2.7075e-01, -8.9647e-03, -5.0889e-01,
        -1.0903e-01, -1.0206e-01, -3.5952e-01, -6.1812e-01,  2.2710e-02,
        -5.4684e-01, -9.6776e-01,  1.5577e-02, -1.9293e+00, -7.3268e-01,
        -1.2622e+00,  6.5780e-01, -6.3239e-01, -3.4182e-01, -9.0899e-01,
        -1.8571e-02,  1.0156e-01, -5.2831e-01, -2.8377e+00,  3.6758e-01,
         4.4166e+00,  1.5510e-02, -3.5244e-01,  0.0000e+00,  7.7182e-01,
         5.6876e-01,  9.8288e-01,  1.2841e-01,  6.9218e-01,  0.0000e+00,
        -8.5139e-02, -2.7258e-01, -1.7472e-01, -3.7231e+00,  7.8711e-01,
        -7.5983e-01, -5.6157e-01, -5.6083e-01,  1.7114e-01,  2.3170e-01,
        -4.0181e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2587]), tensor(0.0615))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.4683e-01,  7.3049e-01,  7.4898e-02, -1.2582e+00, -1.4219e-01,
        -7.3956e-01, -1.6756e-01, -3.6013e-01,  4.5746e-01, -1.5994e-01,
        -6.8931e-01,  6.6008e-02, -5.0557e-01, -3.5929e-01,  1.2351e-01,
         4.9518e-01, -1.4301e-01,  2.4676e-01, -6.7788e-02,  4.8690e-01,
        -3.6376e-01,  1.6124e-02, -3.8150e-02, -2.7243e-03, -5.7213e-02,
        -2.7309e-01, -5.8374e-01, -1.9330e-02,  2.6012e-01,  1.3201e+00,
         3.9170e-01, -1.1481e-01,  4.8776e-01, -4.5291e-02, -3.1853e-01,
        -2.1267e-01,  7.8759e-02,  7.3391e-01, -1.7976e-02, -1.1195e+00,
        -3.0680e-01,  3.0366e-01,  2.5901e-01, -4.8297e-02, -1.7506e-01,
        -7.2198e-01,  8.4849e-02, -8.5478e-02, -4.1490e-01, -1.8374e-01,
        -7.6658e-01,  5.8183e-01, -9.8943e-02, -1.3336e-02, -1.7753e-02,
         4.2230e-01, -6.8937e-01,  8.4191e-02, -2.5562e-01, -1.6637e-02,
         1.2924e-01, -3.1309e-01,  1.2849e-01,  2.5773e-01,  9.4726e-02,
        -1.6932e-01,  4.0680e-01, -1.3059e-01,  6.6447e-01, -4.1543e-01,
        -2.7321e-01, -6.0853e-02,  1.1193e-02, -8.5560e-01,  1.5152e-01,
         6.6525e-01,  1.5886e-02, -3.7198e-01, -1.7954e-01,  1.2926e-02,
        -4.3101e-03,  2.1018e-01,  1.3499e-01, -3.2391e-01, -5.5957e-01,
        -1.3286e-01, -1.1836e-01, -2.8842e-01,  5.5548e-03,  1.7253e-01,
        -5.1673e-01, -1.2633e+00,  1.8662e-02,  1.7233e+00,  2.4117e+00,
         2.4502e+00, -1.1452e-02,  2.1252e+00, -3.0934e+00,  6.0488e-01,
        -2.8784e-01,  1.0569e-01, -2.8706e-01,  7.1308e-02,  1.8342e-01,
         1.8289e-01,  4.9651e-02,  2.1546e-01,  0.0000e+00, -1.4712e+00,
         9.1192e-01, -2.5322e+00,  1.5715e-01,  1.9054e-02,  0.0000e+00,
        -4.2191e-02,  1.2099e-01, -1.8224e-01, -6.7759e-03, -1.0689e-01,
         1.0200e-01, -3.8446e-01, -3.4147e-01,  2.8360e-01,  2.9023e-01,
        -4.1681e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4258]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-4.9663e-01,  4.6190e-01, -7.9757e-01,  1.2642e+00, -2.5219e-02,
        -8.1604e-01, -1.2726e+00, -8.7505e-01, -3.5281e-01, -8.8977e-02,
        -7.5350e-01,  6.6598e-03, -4.6465e+00, -1.7014e-01, -4.3760e-01,
         1.6392e-01, -1.7324e-01, -1.0821e-02, -6.7788e-02,  1.0957e+00,
         1.4933e-01, -5.8762e-02, -4.6725e-02, -1.6078e-01, -6.0928e-02,
        -4.3095e-01, -6.4169e-01, -1.9330e-02, -1.2362e+00,  8.8859e-01,
        -1.3184e-01, -1.9349e-01,  2.3311e-01, -4.5291e-02, -7.8238e-01,
        -3.9833e-01, -2.3464e-01, -7.0097e-01, -2.4690e-01, -8.9766e-01,
        -2.3508e-01,  1.5829e-01,  3.6629e-01, -1.5355e-01, -5.2459e-02,
        -6.6629e-01, -4.8151e-02,  2.0784e-01, -2.6399e-01,  3.4967e-02,
         8.2149e-03, -7.3321e-01, -6.7126e-01, -5.7049e-01, -7.3640e-01,
         2.8091e-01, -1.0359e+00, -1.4148e-01,  1.2761e+00, -4.4375e-01,
        -1.9959e-02,  3.3199e-01, -1.1786e+00,  5.3515e-01, -1.0222e-02,
        -7.9445e-01,  4.2686e-01,  1.3247e+00, -2.0112e+00, -4.5252e-01,
        -2.7321e-01, -6.0853e-02,  1.1193e-02, -7.7603e-01,  5.2913e-02,
         1.7433e-02,  5.2563e+00, -3.4693e-01, -2.1444e-03,  1.2926e-02,
        -4.3101e-03,  9.7567e-02, -2.1786e-01,  1.1664e+00,  3.0650e-01,
        -1.1572e-01, -1.0890e-01, -3.6080e-01, -6.1957e-01,  8.4451e-04,
        -2.3736e-01, -7.0050e-01,  1.8662e-02, -2.2412e+00, -1.4105e+00,
        -1.2400e+00,  2.3543e-01, -5.0520e-01, -1.0279e+00, -1.1069e+00,
         7.4595e-02,  5.1235e-01, -2.8706e-01,  3.3388e+00,  1.8342e-01,
         1.5976e+00,  2.3821e-02,  7.1755e-01,  0.0000e+00,  4.2332e-01,
        -6.9145e-01,  1.2894e+00,  1.2793e-01,  1.3641e+00,  0.0000e+00,
        -4.2191e-02, -5.0398e-02, -1.3832e-01, -3.6980e+00,  7.0131e-01,
        -3.1486e-01, -4.7536e-01, -4.3661e-01,  1.6006e-01,  2.3175e-01,
        -4.0177e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2607]), tensor(0.))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:main_restricted_month.py:Testing data year: 1997
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 10575
            device: cpu
            
2024-07-28 09:45:07,075	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-28 09:45:07,116	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-28 09:45:07,153	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_341f1673add3bf67.zip' (1.40MiB) to Ray cluster...
2024-07-28 09:45:07,157	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_341f1673add3bf67.zip'.
2024-07-28 09:45:09,867	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-28 10:44:34,868	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_09-45-09' in 0.2157s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 95, 'num_layers': 4, 'num_embeddings': 10575, 'embedding_dim': 3, 'dropout_rate': 0.44, 'lr': 0.00011400863701127328, 'weight_decay': 5.9874749104614036e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.024940063283066482
INFO:model_data_nn.py:Best trial testing loss: 0.03061808237705048
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-28_09-45-04_771888_365373/artifacts/2024-07-28_09-45-09/train_fnn_2024-07-28_09-45-09/driver_artifacts/train_fnn_c09d9_00003_3_dropout_rate=0.4400,embedding_dim=3,hidden_dim=95,lr=0.0001,num_layers=4,weight_decay=0.0001_2024-07-28_09-45-10
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 95, 'num_layers': 4, 'num_embeddings': 11490, 'embedding_dim': 3, 'dropout_rate': 0.44, 'lr': 0.00011400863701127328, 'weight_decay': 5.9874749104614036e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.02712339446877398, 'avg_test_loss': 0.05210739763810315}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.026614061772900974, 'avg_test_loss': 0.05171946319183562}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.026339248285536566, 'avg_test_loss': 0.051252425006778395}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.026132687481772957, 'avg_test_loss': 0.05133991675113194}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.026007840783284254, 'avg_test_loss': 0.0511772985756902}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.02591967919608055, 'avg_test_loss': 0.05121280155047882}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.025834316676145587, 'avg_test_loss': 0.05105601616292963}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.0257957665538836, 'avg_test_loss': 0.051260991097708056}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.025748744614223457, 'avg_test_loss': 0.051227223543263464}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.025708444714095946, 'avg_test_loss': 0.05110529131384763}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.025667397682422613, 'avg_test_loss': 0.051088053344007726}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.025658258664796013, 'avg_test_loss': 0.05114763730786936}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.025636511462440933, 'avg_test_loss': 0.05132550563934144}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.025618279785614286, 'avg_test_loss': 0.050903456723073524}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.02559490925085111, 'avg_test_loss': 0.05119559565279717}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.025594504309024862, 'avg_test_loss': 0.050881274098777754}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.025583808311340103, 'avg_test_loss': 0.05080798199120993}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.025572178522971282, 'avg_test_loss': 0.05095678303885427}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.025573866518836766, 'avg_test_loss': 0.05084577666270835}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.02556910900657553, 'avg_test_loss': 0.05087722508638909}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.025559777197238783, 'avg_test_loss': 0.05057350295833914}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.025555951654325997, 'avg_test_loss': 0.05101212864453957}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.02555007500891625, 'avg_test_loss': 0.05077369924207313}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.025538440303594288, 'avg_test_loss': 0.050460462731013934}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.02552951908672314, 'avg_test_loss': 0.05077739735239109}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.025518151313084377, 'avg_test_loss': 0.050725131469771145}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.02551434921205218, 'avg_test_loss': 0.050592200225261195}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.02552259387185059, 'avg_test_loss': 0.05054303156691515}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.025512221519908677, 'avg_test_loss': 0.05038383331944007}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.02550975527256315, 'avg_test_loss': 0.050425518569540716}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.025501650749933963, 'avg_test_loss': 0.05034332887320876}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.025494598310495328, 'avg_test_loss': 0.05047544189489025}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.025494099133609376, 'avg_test_loss': 0.050391827628787106}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.025500151251246536, 'avg_test_loss': 0.05039721435228701}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.025482837668202047, 'avg_test_loss': 0.050334289114309816}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.025528601742754144, 'avg_test_loss': 0.050529773698744465}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.02550841295676632, 'avg_test_loss': 0.05070689855044154}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.025489536947262994, 'avg_test_loss': 0.05039958570105408}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.025501264474966787, 'avg_test_loss': 0.05047256736650175}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.025486419736068203, 'avg_test_loss': 0.05067716667751673}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.025494422448298682, 'avg_test_loss': 0.050852625525212414}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.025508071364537765, 'avg_test_loss': 0.05050134328307539}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.025521719452493603, 'avg_test_loss': 0.050449185283701486}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.02549901341530507, 'avg_test_loss': 0.050748951165653367}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.0255055007522768, 'avg_test_loss': 0.05066407605536222}
INFO:model_data_nn.py:Early stopping at epoch 45
INFO:main_restricted_month.py:Making prediction for data in year: 1998
INFO:main_restricted_month.py:Prediction data shape: (70794,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 1998: 0.22515143207556493
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  70794.000000  70794.000000
mean       0.002258      0.008416
std        0.229048      0.033643
min       -0.973684     -0.268729
25%       -0.097561     -0.008865
50%       -0.006724      0.010351
75%        0.080000      0.026009
max       12.666667      0.554948
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:transform_data_nn.py:Train_data: (826024, 161)

INFO:transform_data_nn.py:Test data years: [1998]
INFO:transform_data_nn.py:Test_data: (70794, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Retrain_data: (896818, 161)

INFO:transform_data_nn.py:Prediction data years: [1999]
INFO:transform_data_nn.py:Prediction_data: (67277, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([826024, 138])
            y_train_tf: torch.Size([826024])

            x_test_tf: torch.Size([70794, 138])
            y_test_tf: torch.Size([70794])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([896818, 138])
            y_retrain_tf: torch.Size([896818])

            x_prediction_tf: torch.Size([67277, 138])
            y_prediction_tf: torch.Size([67277])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.4683e-01,  7.3049e-01,  7.4898e-02, -1.2582e+00, -1.4219e-01,
        -7.3956e-01, -1.6756e-01, -3.6013e-01,  4.5746e-01, -1.5994e-01,
        -6.8931e-01,  6.6008e-02, -5.0557e-01, -3.5929e-01,  1.2351e-01,
         4.9518e-01, -1.4301e-01,  2.4676e-01, -6.7788e-02,  4.8690e-01,
        -3.6376e-01,  1.6124e-02, -3.8150e-02, -2.7243e-03, -5.7213e-02,
        -2.7309e-01, -5.8374e-01, -1.9330e-02,  2.6012e-01,  1.3201e+00,
         3.9170e-01, -1.1481e-01,  4.8776e-01, -4.5291e-02, -3.1853e-01,
        -2.1267e-01,  7.8759e-02,  7.3391e-01, -1.7976e-02, -1.1195e+00,
        -3.0680e-01,  3.0366e-01,  2.5901e-01, -4.8297e-02, -1.7506e-01,
        -7.2198e-01,  8.4849e-02, -8.5478e-02, -4.1490e-01, -1.8374e-01,
        -7.6658e-01,  5.8183e-01, -9.8943e-02, -1.3336e-02, -1.7753e-02,
         4.2230e-01, -6.8937e-01,  8.4191e-02, -2.5562e-01, -1.6637e-02,
         1.2924e-01, -3.1309e-01,  1.2849e-01,  2.5773e-01,  9.4726e-02,
        -1.6932e-01,  4.0680e-01, -1.3059e-01,  6.6447e-01, -4.1543e-01,
        -2.7321e-01, -6.0853e-02,  1.1193e-02, -8.5560e-01,  1.5152e-01,
         6.6525e-01,  1.5886e-02, -3.7198e-01, -1.7954e-01,  1.2926e-02,
        -4.3101e-03,  2.1018e-01,  1.3499e-01, -3.2391e-01, -5.5957e-01,
        -1.3286e-01, -1.1836e-01, -2.8842e-01,  5.5548e-03,  1.7253e-01,
        -5.1673e-01, -1.2633e+00,  1.8662e-02,  1.7233e+00,  2.4117e+00,
         2.4502e+00, -1.1452e-02,  2.1252e+00, -3.0934e+00,  6.0488e-01,
        -2.8784e-01,  1.0569e-01, -2.8706e-01,  7.1308e-02,  1.8342e-01,
         1.8289e-01,  4.9651e-02,  2.1546e-01,  0.0000e+00, -1.4712e+00,
         9.1192e-01, -2.5322e+00,  1.5715e-01,  1.9054e-02,  0.0000e+00,
        -4.2191e-02,  1.2099e-01, -1.8224e-01, -6.7759e-03, -1.0689e-01,
         1.0200e-01, -3.8446e-01, -3.4147e-01,  2.8360e-01,  2.9023e-01,
        -4.1681e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4258]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-4.9663e-01,  4.6190e-01, -7.9757e-01,  1.2642e+00, -2.5219e-02,
        -8.1604e-01, -1.2726e+00, -8.7505e-01, -3.5281e-01, -8.8977e-02,
        -7.5350e-01,  6.6598e-03, -4.6465e+00, -1.7014e-01, -4.3760e-01,
         1.6392e-01, -1.7324e-01, -1.0821e-02, -6.7788e-02,  1.0957e+00,
         1.4933e-01, -5.8762e-02, -4.6725e-02, -1.6078e-01, -6.0928e-02,
        -4.3095e-01, -6.4169e-01, -1.9330e-02, -1.2362e+00,  8.8859e-01,
        -1.3184e-01, -1.9349e-01,  2.3311e-01, -4.5291e-02, -7.8238e-01,
        -3.9833e-01, -2.3464e-01, -7.0097e-01, -2.4690e-01, -8.9766e-01,
        -2.3508e-01,  1.5829e-01,  3.6629e-01, -1.5355e-01, -5.2459e-02,
        -6.6629e-01, -4.8151e-02,  2.0784e-01, -2.6399e-01,  3.4967e-02,
         8.2149e-03, -7.3321e-01, -6.7126e-01, -5.7049e-01, -7.3640e-01,
         2.8091e-01, -1.0359e+00, -1.4148e-01,  1.2761e+00, -4.4375e-01,
        -1.9959e-02,  3.3199e-01, -1.1786e+00,  5.3515e-01, -1.0222e-02,
        -7.9445e-01,  4.2686e-01,  1.3247e+00, -2.0112e+00, -4.5252e-01,
        -2.7321e-01, -6.0853e-02,  1.1193e-02, -7.7603e-01,  5.2913e-02,
         1.7433e-02,  5.2563e+00, -3.4693e-01, -2.1444e-03,  1.2926e-02,
        -4.3101e-03,  9.7567e-02, -2.1786e-01,  1.1664e+00,  3.0650e-01,
        -1.1572e-01, -1.0890e-01, -3.6080e-01, -6.1957e-01,  8.4451e-04,
        -2.3736e-01, -7.0050e-01,  1.8662e-02, -2.2412e+00, -1.4105e+00,
        -1.2400e+00,  2.3543e-01, -5.0520e-01, -1.0279e+00, -1.1069e+00,
         7.4595e-02,  5.1235e-01, -2.8706e-01,  3.3388e+00,  1.8342e-01,
         1.5976e+00,  2.3821e-02,  7.1755e-01,  0.0000e+00,  4.2332e-01,
        -6.9145e-01,  1.2894e+00,  1.2793e-01,  1.3641e+00,  0.0000e+00,
        -4.2191e-02, -5.0398e-02, -1.3832e-01, -3.6980e+00,  7.0131e-01,
        -3.1486e-01, -4.7536e-01, -4.3661e-01,  1.6006e-01,  2.3175e-01,
        -4.0177e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2607]), tensor(0.))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-0.1488,  0.7533,  0.0750, -1.2476, -0.1519, -0.7569, -0.1656, -0.3602,
         0.4780, -0.1583, -0.6885,  0.0783, -0.5135, -0.3668,  0.1212,  0.4896,
        -0.1480,  0.2461, -0.0563,  0.4904, -0.3380,  0.0060, -0.0411, -0.0043,
        -0.0578, -0.2754, -0.5904, -0.0276,  0.2305,  1.3513,  0.3869, -0.1161,
         0.4940, -0.0339, -0.3068, -0.2204,  0.0647,  0.7642, -0.0350, -1.1255,
        -0.3035,  0.3123,  0.2498, -0.0369, -0.1863, -0.7300,  0.0889, -0.0739,
        -0.4202, -0.1616, -0.7783,  0.5612, -0.0844, -0.0127, -0.0243,  0.4213,
        -0.6786,  0.0858, -0.2526, -0.0237,  0.1279, -0.3096,  0.1299,  0.2553,
         0.0939, -0.1723,  0.4206, -0.1331,  0.6621, -0.4178, -0.2869, -0.0715,
        -0.0063, -0.8678,  0.1638,  0.6726,  0.0182, -0.3751, -0.1779,  0.0122,
        -0.0064,  0.1907,  0.1541, -0.3084, -0.5612, -0.1376, -0.1242, -0.2829,
         0.0144,  0.1725, -0.5253, -1.2665,  0.0196,  1.6403,  2.3776,  2.5092,
        -0.0479,  2.2301, -3.0209,  0.6813, -0.3183,  0.1031, -0.1093,  0.0089,
         0.3125,  0.1606,  0.0519,  0.1725,  0.0000, -1.4881,  0.9867, -2.5294,
         0.1607,  0.0172,  0.0000, -0.0508,  0.1429, -0.1886, -0.0317, -0.1156,
         0.1113, -0.3708, -0.3355,  0.2916,  0.2944, -0.4155,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([4495]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-0.2410, -0.5335, -0.3746,  1.3860, -0.3429, -0.8196, -1.6391, -0.9134,
        -0.3522, -0.3109, -0.7424,  0.0232, -1.1585,  0.7056,  0.2790,  0.4521,
        -0.1871, -0.3078,  0.1022, -0.8319,  0.3385, -0.0601, -0.0390, -0.0513,
        -0.1370, -0.4237, -0.6392, -0.0276, -0.8768,  0.8968,  0.3119, -0.1579,
         0.2593, -2.2702, -0.7467, -0.4078, -0.4598, -0.6830, -0.7193, -1.0713,
        -0.2487, -0.5816, -0.5942, -0.1637, -0.3288, -0.8004, -0.0977,  0.1501,
        -0.3370,  0.1589,  0.7805, -0.7106, -0.7014, -0.5570, -0.7355,  0.3257,
        -1.0281, -0.0882, -0.1050, -0.1825, -0.0057,  0.3419,  0.7976, -0.8114,
        -0.0135,  0.6677, -0.3726,  0.4967,  0.6621, -0.3881, -0.2869, -0.0715,
        -0.0063, -0.8087,  0.0763,  0.7144,  1.6919, -0.2827, -0.1454,  0.0122,
         0.1191,  0.0638, -0.1463,  0.4895, -0.0530, -0.1227, -0.1160, -0.3504,
        -0.5495,  0.1847, -0.3889,  0.1537,  0.0196, -2.2990, -2.0316, -1.1479,
         0.4338, -0.7692, -0.8244, -0.0223,  0.2681, -0.5595, -0.1093,  1.7894,
         0.3125,  2.7875,  0.0287,  0.3256,  0.0000, -1.3763, -0.4234,  0.9716,
         0.1285,  2.6816,  0.0000, -0.0508,  0.0459, -0.2381, -3.6215,  0.6355,
         0.9841, -0.2907, -0.3943,  0.2007,  0.2682, -0.4057,  1.0000,  0.0000,
         0.0000,  0.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([2514]), tensor(0.))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:main_restricted_month.py:Testing data year: 1998
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 11490
            device: cpu
            
2024-07-28 13:13:26,670	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-28 13:13:26,714	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-28 13:13:26,751	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_51a4cb8f5bd0fa75.zip' (1.43MiB) to Ray cluster...
2024-07-28 13:13:26,755	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_51a4cb8f5bd0fa75.zip'.
2024-07-28 13:13:29,777	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-28 13:49:04,017	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_13-13-29' in 0.2156s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 145, 'num_layers': 1, 'num_embeddings': 11490, 'embedding_dim': 5, 'dropout_rate': 0.26, 'lr': 3.3385926007093975e-05, 'weight_decay': 0.0008123500161567054, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.025483802540252738
INFO:model_data_nn.py:Best trial testing loss: 0.05041757392315926
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-28_13-13-24_340457_365373/artifacts/2024-07-28_13-13-29/train_fnn_2024-07-28_13-13-29/driver_artifacts/train_fnn_db247_00083_83_dropout_rate=0.2600,embedding_dim=5,hidden_dim=145,lr=0.0000,num_layers=1,weight_decay=0.0008_2024-07-28_13-13-30
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 145, 'num_layers': 1, 'num_embeddings': 12154, 'embedding_dim': 5, 'dropout_rate': 0.26, 'lr': 3.3385926007093975e-05, 'weight_decay': 0.0008123500161567054, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.029032691239245692, 'avg_test_loss': 0.05926269813601862}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.028174766441379805, 'avg_test_loss': 0.0597007499039244}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.027921442194740582, 'avg_test_loss': 0.061988290875597714}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.027804466533644566, 'avg_test_loss': 0.061650842043549925}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.027726281043372037, 'avg_test_loss': 0.06069533105234938}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.027673524442099393, 'avg_test_loss': 0.06094826154761413}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.027640853373358136, 'avg_test_loss': 0.06175924100056149}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.027599957347509564, 'avg_test_loss': 0.061734739011118166}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.0275731891520802, 'avg_test_loss': 0.06346805371784962}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.027559510495621078, 'avg_test_loss': 0.06438215326972858}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.027539932231227977, 'avg_test_loss': 0.06499261652852475}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main_restricted_month.py:Making prediction for data in year: 1999
INFO:main_restricted_month.py:Prediction data shape: (67277,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 1999: 0.25496903192414166
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  67277.000000  67277.000000
mean       0.025442     -0.043774
std        0.242779      0.057406
min       -0.959091     -5.437060
25%       -0.087282     -0.076283
50%       -0.005181     -0.047721
75%        0.089806     -0.013107
max        7.000000      0.253277
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Train_data: (896818, 161)

INFO:transform_data_nn.py:Test data years: [1999]
INFO:transform_data_nn.py:Test_data: (67277, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:transform_data_nn.py:Retrain_data: (964095, 161)

INFO:transform_data_nn.py:Prediction data years: [2000]
INFO:transform_data_nn.py:Prediction_data: (64295, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([896818, 138])
            y_train_tf: torch.Size([896818])

            x_test_tf: torch.Size([67277, 138])
            y_test_tf: torch.Size([67277])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([964095, 138])
            y_retrain_tf: torch.Size([964095])

            x_prediction_tf: torch.Size([64295, 138])
            y_prediction_tf: torch.Size([64295])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-0.1488,  0.7533,  0.0750, -1.2476, -0.1519, -0.7569, -0.1656, -0.3602,
         0.4780, -0.1583, -0.6885,  0.0783, -0.5135, -0.3668,  0.1212,  0.4896,
        -0.1480,  0.2461, -0.0563,  0.4904, -0.3380,  0.0060, -0.0411, -0.0043,
        -0.0578, -0.2754, -0.5904, -0.0276,  0.2305,  1.3513,  0.3869, -0.1161,
         0.4940, -0.0339, -0.3068, -0.2204,  0.0647,  0.7642, -0.0350, -1.1255,
        -0.3035,  0.3123,  0.2498, -0.0369, -0.1863, -0.7300,  0.0889, -0.0739,
        -0.4202, -0.1616, -0.7783,  0.5612, -0.0844, -0.0127, -0.0243,  0.4213,
        -0.6786,  0.0858, -0.2526, -0.0237,  0.1279, -0.3096,  0.1299,  0.2553,
         0.0939, -0.1723,  0.4206, -0.1331,  0.6621, -0.4178, -0.2869, -0.0715,
        -0.0063, -0.8678,  0.1638,  0.6726,  0.0182, -0.3751, -0.1779,  0.0122,
        -0.0064,  0.1907,  0.1541, -0.3084, -0.5612, -0.1376, -0.1242, -0.2829,
         0.0144,  0.1725, -0.5253, -1.2665,  0.0196,  1.6403,  2.3776,  2.5092,
        -0.0479,  2.2301, -3.0209,  0.6813, -0.3183,  0.1031, -0.1093,  0.0089,
         0.3125,  0.1606,  0.0519,  0.1725,  0.0000, -1.4881,  0.9867, -2.5294,
         0.1607,  0.0172,  0.0000, -0.0508,  0.1429, -0.1886, -0.0317, -0.1156,
         0.1113, -0.3708, -0.3355,  0.2916,  0.2944, -0.4155,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([4495]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-0.2410, -0.5335, -0.3746,  1.3860, -0.3429, -0.8196, -1.6391, -0.9134,
        -0.3522, -0.3109, -0.7424,  0.0232, -1.1585,  0.7056,  0.2790,  0.4521,
        -0.1871, -0.3078,  0.1022, -0.8319,  0.3385, -0.0601, -0.0390, -0.0513,
        -0.1370, -0.4237, -0.6392, -0.0276, -0.8768,  0.8968,  0.3119, -0.1579,
         0.2593, -2.2702, -0.7467, -0.4078, -0.4598, -0.6830, -0.7193, -1.0713,
        -0.2487, -0.5816, -0.5942, -0.1637, -0.3288, -0.8004, -0.0977,  0.1501,
        -0.3370,  0.1589,  0.7805, -0.7106, -0.7014, -0.5570, -0.7355,  0.3257,
        -1.0281, -0.0882, -0.1050, -0.1825, -0.0057,  0.3419,  0.7976, -0.8114,
        -0.0135,  0.6677, -0.3726,  0.4967,  0.6621, -0.3881, -0.2869, -0.0715,
        -0.0063, -0.8087,  0.0763,  0.7144,  1.6919, -0.2827, -0.1454,  0.0122,
         0.1191,  0.0638, -0.1463,  0.4895, -0.0530, -0.1227, -0.1160, -0.3504,
        -0.5495,  0.1847, -0.3889,  0.1537,  0.0196, -2.2990, -2.0316, -1.1479,
         0.4338, -0.7692, -0.8244, -0.0223,  0.2681, -0.5595, -0.1093,  1.7894,
         0.3125,  2.7875,  0.0287,  0.3256,  0.0000, -1.3763, -0.4234,  0.9716,
         0.1285,  2.6816,  0.0000, -0.0508,  0.0459, -0.2381, -3.6215,  0.6355,
         0.9841, -0.2907, -0.3943,  0.2007,  0.2682, -0.4057,  1.0000,  0.0000,
         0.0000,  0.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([2514]), tensor(0.))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.4963e-01,  7.7331e-01,  7.5467e-02, -1.2401e+00, -1.5562e-01,
        -7.7538e-01, -1.6396e-01, -3.5874e-01,  4.7901e-01, -1.5475e-01,
        -6.8697e-01,  8.7942e-02, -5.1425e-01, -3.7712e-01,  1.2134e-01,
         4.8733e-01, -1.4502e-01,  2.4296e-01, -5.7820e-02,  4.9726e-01,
        -3.4779e-01,  5.9739e-03, -3.9149e-02, -1.6977e-03, -5.1713e-02,
        -2.7604e-01, -5.9599e-01, -3.1014e-02,  2.0480e-01,  1.3757e+00,
         3.7385e-01, -1.1353e-01,  4.9929e-01, -2.1032e-02, -2.9519e-01,
        -2.2633e-01,  5.1461e-02,  7.9116e-01, -4.7016e-02, -1.1333e+00,
        -3.0087e-01,  3.3386e-01,  2.4733e-01, -3.3277e-02, -1.9322e-01,
        -7.3974e-01,  1.0270e-01, -7.3550e-02, -4.1774e-01, -1.5868e-01,
        -7.8968e-01,  5.4365e-01, -6.6836e-02, -1.3350e-02, -2.6730e-02,
         4.1966e-01, -6.6864e-01,  8.1968e-02, -2.4812e-01, -3.2814e-02,
         1.2860e-01, -3.0517e-01,  1.3017e-01,  2.5374e-01,  9.6638e-02,
        -1.7596e-01,  4.3228e-01, -1.3719e-01,  6.6238e-01, -4.1963e-01,
        -2.9754e-01, -2.5008e-02, -1.7887e-02, -8.8182e-01,  1.7426e-01,
         6.7406e-01,  1.9789e-02, -3.7784e-01, -1.7609e-01,  1.3414e-02,
        -9.6442e-03,  1.8168e-01,  1.6324e-01, -2.9306e-01, -5.5933e-01,
        -1.4113e-01, -1.2892e-01, -2.7914e-01,  2.6413e-02,  1.8375e-01,
        -5.2859e-01, -1.2705e+00,  2.0404e-02,  1.5788e+00,  2.3115e+00,
         2.5636e+00, -8.0809e-02,  2.3229e+00, -3.0747e+00,  7.2771e-01,
        -3.4287e-01,  1.0487e-01, -1.1082e-01, -3.6085e-03,  3.3826e-01,
         1.9396e-01,  5.3803e-02,  2.0500e-01,  0.0000e+00, -1.3818e+00,
         1.0458e+00, -2.5509e+00,  1.6421e-01,  2.0667e-02,  0.0000e+00,
        -2.5277e-02,  1.6155e-01, -1.9412e-01, -3.2054e-02, -1.2410e-01,
         1.1805e-01, -3.5857e-01, -3.2868e-01,  2.9897e-01,  2.9757e-01,
        -4.1361e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4700]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-0.0150, -0.6763, -0.5130,  1.5026, -0.2554, -0.8136, -1.6103, -0.9120,
        -0.2097, -0.2357, -0.6851,  0.0328, -0.3096,  1.0031,  0.5485,  0.6054,
        -0.2260,  0.1459,  0.0427, -0.9663,  0.1900, -0.0626, -0.0425, -0.0517,
         0.0441, -0.4774, -0.6575, -0.0310, -0.9150,  1.2192, -0.0404, -0.1499,
         0.2957, -2.2210, -0.7824, -0.2834, -0.1834, -0.6235, -0.1686, -1.1178,
        -0.0530, -0.3106, -0.3606, -0.0957, -0.2657, -0.3779, -0.3610, -0.1023,
        -0.0484, -0.1090,  0.7758, -0.7794, -0.5548, -0.5490, -0.7351,  0.2577,
        -1.0209,  0.1240, -0.4132, -0.4364, -0.1778, -0.1046,  1.0675,  0.1030,
        -0.0132,  1.3116, -0.4845,  2.0911,  0.6624, -0.3817, -0.2975, -0.0250,
        -0.0179, -0.4363,  0.0702,  0.7979,  0.0561, -0.1098, -0.1514,  0.0134,
         0.1229,  0.0936,  0.0500,  0.2358, -0.5666, -0.1321, -0.1234, -0.2959,
        -0.5168, -0.3630, -0.5877, -0.1240,  0.0204, -2.2266, -1.5614, -1.1605,
         0.3023, -0.4107, -0.3642, -0.8625, -0.1967, -0.9605, -0.1108,  0.8525,
         0.3383,  2.0245,  0.0322, -0.8599,  0.0000, -0.6321,  0.0461,  1.2698,
         0.1188,  5.0115,  0.0000, -0.0253, -0.1566, -0.2267, -3.5661,  0.6462,
         0.1414, -0.1086, -0.4046,  0.2089,  0.2710, -0.4243,  1.0000,  0.0000,
         0.0000,  0.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([2396]), tensor(-0.0441))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:main_restricted_month.py:Testing data year: 1999
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 12154
            device: cpu
            
2024-07-28 15:39:55,934	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-28 15:39:55,979	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-28 15:39:56,014	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_51a4cb8f5bd0fa75.zip' (1.43MiB) to Ray cluster...
2024-07-28 15:39:56,020	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_51a4cb8f5bd0fa75.zip'.
2024-07-28 15:39:59,136	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-28 17:14:13,226	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_15-39-59' in 0.2103s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 12154, 'embedding_dim': 6, 'dropout_rate': 0.54, 'lr': 3.4419719400899214e-05, 'weight_decay': 0.00016266799643038432, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.028869238828372615
INFO:model_data_nn.py:Best trial testing loss: 0.058450983268006955
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-28_15-39-53_599134_365373/artifacts/2024-07-28_15-39-59/train_fnn_2024-07-28_15-39-59/driver_artifacts/train_fnn_52024_00077_77_dropout_rate=0.5400,embedding_dim=6,hidden_dim=5,lr=0.0000,num_layers=5,weight_decay=0.0002_2024-07-28_15-39-59
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 5, 'num_embeddings': 12714, 'embedding_dim': 6, 'dropout_rate': 0.54, 'lr': 3.4419719400899214e-05, 'weight_decay': 0.00016266799643038432, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.031143513550614395, 'avg_test_loss': 0.06870675085677733}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.031124289220508604, 'avg_test_loss': 0.068691766436272}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.031123911478353663, 'avg_test_loss': 0.06869275468072636}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03112012574324791, 'avg_test_loss': 0.06864039490638829}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.031084410990469664, 'avg_test_loss': 0.06844489332103165}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.031061317621347204, 'avg_test_loss': 0.06853681637706299}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.031051531483518652, 'avg_test_loss': 0.06849006866823085}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.031049338783621216, 'avg_test_loss': 0.06847328836218783}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03104212855695402, 'avg_test_loss': 0.06859496964225129}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.0310328584506579, 'avg_test_loss': 0.06859300697769098}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.031025237931697557, 'avg_test_loss': 0.06869334116837575}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.031033374650476314, 'avg_test_loss': 0.06875270622323698}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.03102692214823296, 'avg_test_loss': 0.06872825438518133}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.031027083262834307, 'avg_test_loss': 0.06871922644902373}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.03102476946621059, 'avg_test_loss': 0.06871287600874011}
INFO:model_data_nn.py:Early stopping at epoch 15
INFO:main_restricted_month.py:Making prediction for data in year: 2000
INFO:main_restricted_month.py:Prediction data shape: (64295,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2000: 0.2621393377175766
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  64295.000000  64295.000000
mean      -0.001434      0.014018
std        0.261681      0.009428
min       -0.961538     -0.853329
25%       -0.124228      0.014702
50%       -0.013216      0.016653
75%        0.086957      0.016653
max       10.344000      0.016653
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:transform_data_nn.py:Train_data: (964095, 161)

INFO:transform_data_nn.py:Test data years: [2000]
INFO:transform_data_nn.py:Test_data: (64295, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:transform_data_nn.py:Retrain_data: (1028390, 161)

INFO:transform_data_nn.py:Prediction data years: [2001]
INFO:transform_data_nn.py:Prediction_data: (62104, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([964095, 138])
            y_train_tf: torch.Size([964095])

            x_test_tf: torch.Size([64295, 138])
            y_test_tf: torch.Size([64295])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1028390, 138])
            y_retrain_tf: torch.Size([1028390])

            x_prediction_tf: torch.Size([62104, 138])
            y_prediction_tf: torch.Size([62104])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.4963e-01,  7.7331e-01,  7.5467e-02, -1.2401e+00, -1.5562e-01,
        -7.7538e-01, -1.6396e-01, -3.5874e-01,  4.7901e-01, -1.5475e-01,
        -6.8697e-01,  8.7942e-02, -5.1425e-01, -3.7712e-01,  1.2134e-01,
         4.8733e-01, -1.4502e-01,  2.4296e-01, -5.7820e-02,  4.9726e-01,
        -3.4779e-01,  5.9739e-03, -3.9149e-02, -1.6977e-03, -5.1713e-02,
        -2.7604e-01, -5.9599e-01, -3.1014e-02,  2.0480e-01,  1.3757e+00,
         3.7385e-01, -1.1353e-01,  4.9929e-01, -2.1032e-02, -2.9519e-01,
        -2.2633e-01,  5.1461e-02,  7.9116e-01, -4.7016e-02, -1.1333e+00,
        -3.0087e-01,  3.3386e-01,  2.4733e-01, -3.3277e-02, -1.9322e-01,
        -7.3974e-01,  1.0270e-01, -7.3550e-02, -4.1774e-01, -1.5868e-01,
        -7.8968e-01,  5.4365e-01, -6.6836e-02, -1.3350e-02, -2.6730e-02,
         4.1966e-01, -6.6864e-01,  8.1968e-02, -2.4812e-01, -3.2814e-02,
         1.2860e-01, -3.0517e-01,  1.3017e-01,  2.5374e-01,  9.6638e-02,
        -1.7596e-01,  4.3228e-01, -1.3719e-01,  6.6238e-01, -4.1963e-01,
        -2.9754e-01, -2.5008e-02, -1.7887e-02, -8.8182e-01,  1.7426e-01,
         6.7406e-01,  1.9789e-02, -3.7784e-01, -1.7609e-01,  1.3414e-02,
        -9.6442e-03,  1.8168e-01,  1.6324e-01, -2.9306e-01, -5.5933e-01,
        -1.4113e-01, -1.2892e-01, -2.7914e-01,  2.6413e-02,  1.8375e-01,
        -5.2859e-01, -1.2705e+00,  2.0404e-02,  1.5788e+00,  2.3115e+00,
         2.5636e+00, -8.0809e-02,  2.3229e+00, -3.0747e+00,  7.2771e-01,
        -3.4287e-01,  1.0487e-01, -1.1082e-01, -3.6085e-03,  3.3826e-01,
         1.9396e-01,  5.3803e-02,  2.0500e-01,  0.0000e+00, -1.3818e+00,
         1.0458e+00, -2.5509e+00,  1.6421e-01,  2.0667e-02,  0.0000e+00,
        -2.5277e-02,  1.6155e-01, -1.9412e-01, -3.2054e-02, -1.2410e-01,
         1.1805e-01, -3.5857e-01, -3.2868e-01,  2.9897e-01,  2.9757e-01,
        -4.1361e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4700]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-0.0150, -0.6763, -0.5130,  1.5026, -0.2554, -0.8136, -1.6103, -0.9120,
        -0.2097, -0.2357, -0.6851,  0.0328, -0.3096,  1.0031,  0.5485,  0.6054,
        -0.2260,  0.1459,  0.0427, -0.9663,  0.1900, -0.0626, -0.0425, -0.0517,
         0.0441, -0.4774, -0.6575, -0.0310, -0.9150,  1.2192, -0.0404, -0.1499,
         0.2957, -2.2210, -0.7824, -0.2834, -0.1834, -0.6235, -0.1686, -1.1178,
        -0.0530, -0.3106, -0.3606, -0.0957, -0.2657, -0.3779, -0.3610, -0.1023,
        -0.0484, -0.1090,  0.7758, -0.7794, -0.5548, -0.5490, -0.7351,  0.2577,
        -1.0209,  0.1240, -0.4132, -0.4364, -0.1778, -0.1046,  1.0675,  0.1030,
        -0.0132,  1.3116, -0.4845,  2.0911,  0.6624, -0.3817, -0.2975, -0.0250,
        -0.0179, -0.4363,  0.0702,  0.7979,  0.0561, -0.1098, -0.1514,  0.0134,
         0.1229,  0.0936,  0.0500,  0.2358, -0.5666, -0.1321, -0.1234, -0.2959,
        -0.5168, -0.3630, -0.5877, -0.1240,  0.0204, -2.2266, -1.5614, -1.1605,
         0.3023, -0.4107, -0.3642, -0.8625, -0.1967, -0.9605, -0.1108,  0.8525,
         0.3383,  2.0245,  0.0322, -0.8599,  0.0000, -0.6321,  0.0461,  1.2698,
         0.1188,  5.0115,  0.0000, -0.0253, -0.1566, -0.2267, -3.5661,  0.6462,
         0.1414, -0.1086, -0.4046,  0.2089,  0.2710, -0.4243,  1.0000,  0.0000,
         0.0000,  0.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([2396]), tensor(-0.0441))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.5003e-01,  7.9058e-01,  8.1780e-02, -1.2347e+00, -1.6170e-01,
        -7.9695e-01, -1.6017e-01, -3.5635e-01,  4.6382e-01, -1.4839e-01,
        -6.8473e-01,  9.6144e-02, -5.1021e-01, -3.8909e-01,  1.2193e-01,
         4.8299e-01, -1.4612e-01,  2.4280e-01, -5.7477e-02,  5.0610e-01,
        -3.3304e-01,  4.0716e-03, -3.7353e-02, -3.4706e-03, -4.6997e-02,
        -2.7613e-01, -5.9417e-01, -3.1584e-02,  1.7564e-01,  1.3893e+00,
         3.6471e-01, -1.1564e-01,  5.0128e-01, -3.0722e-02, -2.8498e-01,
        -2.2596e-01,  4.5413e-02,  8.1149e-01, -5.1130e-02, -1.1384e+00,
        -2.9813e-01,  2.7513e-01,  2.5159e-01, -3.8434e-02, -1.9698e-01,
        -7.5245e-01,  9.0346e-02, -6.6200e-02, -4.0176e-01, -1.5585e-01,
        -7.9920e-01,  5.2479e-01, -4.8720e-02, -1.1011e-02, -2.8857e-02,
         4.1787e-01, -6.5838e-01,  8.2408e-02, -2.4810e-01, -4.1027e-02,
         1.2828e-01, -3.0477e-01,  1.2568e-01,  2.5317e-01,  9.2543e-02,
        -1.8401e-01,  4.4294e-01, -1.3756e-01,  6.5963e-01, -4.2033e-01,
        -3.0442e-01, -1.6989e-02, -2.0014e-02, -8.9778e-01,  1.8310e-01,
         6.7055e-01,  1.6905e-02, -3.8115e-01, -1.7439e-01,  1.1837e-02,
        -4.1039e-03,  1.7110e-01,  1.6247e-01, -2.7181e-01, -5.5922e-01,
        -1.4469e-01, -1.3347e-01, -2.7508e-01,  3.9311e-02,  1.9095e-01,
        -5.3083e-01, -1.2732e+00,  2.0767e-02,  1.5554e+00,  2.3470e+00,
         2.6177e+00, -8.0706e-02,  2.4073e+00, -2.9402e+00,  7.8232e-01,
        -3.7331e-01,  1.0774e-01, -6.3810e-02,  4.9231e-02,  2.1016e-01,
         1.8497e-01,  5.4038e-02,  2.6684e-01,  0.0000e+00, -1.4004e+00,
         8.6704e-01, -2.5540e+00,  1.6761e-01,  7.8416e-03, -3.5470e-01,
        -1.8634e-03,  1.7986e-01, -1.9652e-01, -7.2173e-02, -1.3031e-01,
         1.1697e-01, -3.4537e-01, -3.2558e-01,  3.0497e-01,  2.9960e-01,
        -4.1311e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4911]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-7.8155e-01,  2.9863e-01, -2.6455e-01,  1.6144e+00, -1.3151e-01,
        -6.4774e-01, -1.6327e+00, -9.0350e-01, -2.7611e-01, -5.2427e-01,
        -7.4705e-01,  4.3307e-02, -1.8074e-02,  3.2187e-02, -4.9218e-01,
         6.2184e-01, -2.2092e-01,  9.8563e-02,  2.4917e-01,  3.1690e-01,
         5.4051e-01, -5.7433e-02, -4.0387e-02,  3.9809e-01,  1.8641e-02,
        -5.1085e-01, -6.4987e-01, -3.1584e-02, -8.8556e-01,  1.0707e+00,
         4.5311e-02, -1.2936e-01,  2.8789e-01, -2.1698e+00, -7.4284e-01,
        -1.7989e-01, -6.7393e-02, -5.4426e-01, -2.4384e-01, -1.1524e+00,
        -2.3032e-01,  1.1930e-01,  1.3787e-01, -1.0921e-01, -1.7468e-01,
        -7.1678e-01,  6.7817e-02,  1.5170e-01, -3.2939e-01,  4.5092e-01,
        -7.9920e-01, -7.1528e-01, -7.8128e-01, -5.4239e-01, -7.3400e-01,
         3.0674e-01, -1.0132e+00,  1.3695e-01, -3.5488e-01, -1.2432e-01,
         1.0936e-03, -3.8591e-01, -2.1444e-01,  4.4070e-01, -1.7470e-02,
        -3.9417e-01,  2.4717e-01,  3.5690e-01,  6.5963e-01, -4.2365e-01,
        -3.0442e-01, -1.6989e-02, -2.0014e-02, -6.5114e-01,  9.2238e-02,
         7.7743e-01,  3.3144e-03, -1.5722e-01, -8.7829e-02,  1.1837e-02,
         1.2291e-01,  3.2644e-01,  1.7267e-01, -2.8522e-02, -5.9734e-01,
        -1.3666e-01, -1.2899e-01, -3.5258e-01, -6.1016e-01, -1.3135e-01,
        -6.1622e-01, -4.1902e-03,  2.0767e-02, -1.7123e+00, -1.0682e+00,
        -1.0638e+00, -7.6175e-01, -1.7670e-01, -1.6409e+00, -4.3100e-01,
         6.8829e-01,  5.7639e-01, -6.3810e-02, -1.0282e-01,  2.1016e-01,
         8.5482e-01,  5.4667e-02,  1.3218e+00,  0.0000e+00,  3.6432e+00,
         2.9382e+00,  5.5339e-01,  1.2082e-01,  8.0602e+00, -3.5470e-01,
        -1.8634e-03, -1.2010e-01, -1.4793e-01, -3.4710e+00,  6.5598e-01,
        -9.0712e-01,  1.8469e-01, -3.8436e-01,  2.1459e-01,  2.8072e-01,
        -4.2464e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2339]), tensor(0.0128))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:main_restricted_month.py:Testing data year: 2000
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 12714
            device: cpu
            
2024-07-28 19:20:08,514	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-28 19:20:08,559	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-28 19:20:08,603	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip' (1.43MiB) to Ray cluster...
2024-07-28 19:20:08,607	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip'.
2024-07-28 19:20:11,781	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-28 20:36:29,564	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_19-20-11' in 0.2284s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 155, 'num_layers': 3, 'num_embeddings': 12714, 'embedding_dim': 3, 'dropout_rate': 0.47, 'lr': 3.2773202969370707e-06, 'weight_decay': 2.4217957731734788e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.030511602776764832
INFO:model_data_nn.py:Best trial testing loss: 0.06766819355462618
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-28_19-20-06_145231_365373/artifacts/2024-07-28_19-20-11/train_fnn_2024-07-28_19-20-11/driver_artifacts/train_fnn_155bf_00095_95_dropout_rate=0.4700,embedding_dim=3,hidden_dim=155,lr=0.0000,num_layers=3,weight_decay=0.0000_2024-07-28_19-20-12
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 155, 'num_layers': 3, 'num_embeddings': 13269, 'embedding_dim': 3, 'dropout_rate': 0.47, 'lr': 3.2773202969370707e-06, 'weight_decay': 2.4217957731734788e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03872140126155742, 'avg_test_loss': 0.07350516535752251}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.033944817881214465, 'avg_test_loss': 0.07345618131253044}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.03349592828018118, 'avg_test_loss': 0.07353188354381955}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03343475254134203, 'avg_test_loss': 0.073455956260972}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03341563703045198, 'avg_test_loss': 0.07342139395322156}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.033399347623333644, 'avg_test_loss': 0.07340969788064043}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03337748865675483, 'avg_test_loss': 0.07339035151631837}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.033350772058028014, 'avg_test_loss': 0.07330579555811155}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03331889809666882, 'avg_test_loss': 0.07346464748408964}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03329994356426854, 'avg_test_loss': 0.07338628113264051}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03326956907957695, 'avg_test_loss': 0.07345582028643739}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.033237715853171035, 'avg_test_loss': 0.07355028103095174}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.03323657675009, 'avg_test_loss': 0.07362956742359945}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.03320361380649924, 'avg_test_loss': 0.07351510784896638}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.03318138837773065, 'avg_test_loss': 0.07367946475602295}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.03316046356046926, 'avg_test_loss': 0.07371606427339797}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.03313318197811052, 'avg_test_loss': 0.07365489905905342}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.03311809420190245, 'avg_test_loss': 0.07367429942857516}
INFO:model_data_nn.py:Early stopping at epoch 18
INFO:main_restricted_month.py:Making prediction for data in year: 2001
INFO:main_restricted_month.py:Prediction data shape: (62104,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2001: 0.2715076912195489
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  62104.000000  62104.000000
mean       0.028327     -0.000685
std        0.270550      0.024959
min       -0.981295     -0.257800
25%       -0.090273     -0.008426
50%        0.005234      0.002259
75%        0.102421      0.010234
max        8.666667      0.159055
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:transform_data_nn.py:Train_data: (1028390, 161)

INFO:transform_data_nn.py:Test data years: [2001]
INFO:transform_data_nn.py:Test_data: (62104, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:transform_data_nn.py:Retrain_data: (1090494, 161)

INFO:transform_data_nn.py:Prediction data years: [2002]
INFO:transform_data_nn.py:Prediction_data: (59934, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1028390, 138])
            y_train_tf: torch.Size([1028390])

            x_test_tf: torch.Size([62104, 138])
            y_test_tf: torch.Size([62104])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1090494, 138])
            y_retrain_tf: torch.Size([1090494])

            x_prediction_tf: torch.Size([59934, 138])
            y_prediction_tf: torch.Size([59934])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.5003e-01,  7.9058e-01,  8.1780e-02, -1.2347e+00, -1.6170e-01,
        -7.9695e-01, -1.6017e-01, -3.5635e-01,  4.6382e-01, -1.4839e-01,
        -6.8473e-01,  9.6144e-02, -5.1021e-01, -3.8909e-01,  1.2193e-01,
         4.8299e-01, -1.4612e-01,  2.4280e-01, -5.7477e-02,  5.0610e-01,
        -3.3304e-01,  4.0716e-03, -3.7353e-02, -3.4706e-03, -4.6997e-02,
        -2.7613e-01, -5.9417e-01, -3.1584e-02,  1.7564e-01,  1.3893e+00,
         3.6471e-01, -1.1564e-01,  5.0128e-01, -3.0722e-02, -2.8498e-01,
        -2.2596e-01,  4.5413e-02,  8.1149e-01, -5.1130e-02, -1.1384e+00,
        -2.9813e-01,  2.7513e-01,  2.5159e-01, -3.8434e-02, -1.9698e-01,
        -7.5245e-01,  9.0346e-02, -6.6200e-02, -4.0176e-01, -1.5585e-01,
        -7.9920e-01,  5.2479e-01, -4.8720e-02, -1.1011e-02, -2.8857e-02,
         4.1787e-01, -6.5838e-01,  8.2408e-02, -2.4810e-01, -4.1027e-02,
         1.2828e-01, -3.0477e-01,  1.2568e-01,  2.5317e-01,  9.2543e-02,
        -1.8401e-01,  4.4294e-01, -1.3756e-01,  6.5963e-01, -4.2033e-01,
        -3.0442e-01, -1.6989e-02, -2.0014e-02, -8.9778e-01,  1.8310e-01,
         6.7055e-01,  1.6905e-02, -3.8115e-01, -1.7439e-01,  1.1837e-02,
        -4.1039e-03,  1.7110e-01,  1.6247e-01, -2.7181e-01, -5.5922e-01,
        -1.4469e-01, -1.3347e-01, -2.7508e-01,  3.9311e-02,  1.9095e-01,
        -5.3083e-01, -1.2732e+00,  2.0767e-02,  1.5554e+00,  2.3470e+00,
         2.6177e+00, -8.0706e-02,  2.4073e+00, -2.9402e+00,  7.8232e-01,
        -3.7331e-01,  1.0774e-01, -6.3810e-02,  4.9231e-02,  2.1016e-01,
         1.8497e-01,  5.4038e-02,  2.6684e-01,  0.0000e+00, -1.4004e+00,
         8.6704e-01, -2.5540e+00,  1.6761e-01,  7.8416e-03, -3.5470e-01,
        -1.8634e-03,  1.7986e-01, -1.9652e-01, -7.2173e-02, -1.3031e-01,
         1.1697e-01, -3.4537e-01, -3.2558e-01,  3.0497e-01,  2.9960e-01,
        -4.1311e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([4911]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-7.8155e-01,  2.9863e-01, -2.6455e-01,  1.6144e+00, -1.3151e-01,
        -6.4774e-01, -1.6327e+00, -9.0350e-01, -2.7611e-01, -5.2427e-01,
        -7.4705e-01,  4.3307e-02, -1.8074e-02,  3.2187e-02, -4.9218e-01,
         6.2184e-01, -2.2092e-01,  9.8563e-02,  2.4917e-01,  3.1690e-01,
         5.4051e-01, -5.7433e-02, -4.0387e-02,  3.9809e-01,  1.8641e-02,
        -5.1085e-01, -6.4987e-01, -3.1584e-02, -8.8556e-01,  1.0707e+00,
         4.5311e-02, -1.2936e-01,  2.8789e-01, -2.1698e+00, -7.4284e-01,
        -1.7989e-01, -6.7393e-02, -5.4426e-01, -2.4384e-01, -1.1524e+00,
        -2.3032e-01,  1.1930e-01,  1.3787e-01, -1.0921e-01, -1.7468e-01,
        -7.1678e-01,  6.7817e-02,  1.5170e-01, -3.2939e-01,  4.5092e-01,
        -7.9920e-01, -7.1528e-01, -7.8128e-01, -5.4239e-01, -7.3400e-01,
         3.0674e-01, -1.0132e+00,  1.3695e-01, -3.5488e-01, -1.2432e-01,
         1.0936e-03, -3.8591e-01, -2.1444e-01,  4.4070e-01, -1.7470e-02,
        -3.9417e-01,  2.4717e-01,  3.5690e-01,  6.5963e-01, -4.2365e-01,
        -3.0442e-01, -1.6989e-02, -2.0014e-02, -6.5114e-01,  9.2238e-02,
         7.7743e-01,  3.3144e-03, -1.5722e-01, -8.7829e-02,  1.1837e-02,
         1.2291e-01,  3.2644e-01,  1.7267e-01, -2.8522e-02, -5.9734e-01,
        -1.3666e-01, -1.2899e-01, -3.5258e-01, -6.1016e-01, -1.3135e-01,
        -6.1622e-01, -4.1902e-03,  2.0767e-02, -1.7123e+00, -1.0682e+00,
        -1.0638e+00, -7.6175e-01, -1.7670e-01, -1.6409e+00, -4.3100e-01,
         6.8829e-01,  5.7639e-01, -6.3810e-02, -1.0282e-01,  2.1016e-01,
         8.5482e-01,  5.4667e-02,  1.3218e+00,  0.0000e+00,  3.6432e+00,
         2.9382e+00,  5.5339e-01,  1.2082e-01,  8.0602e+00, -3.5470e-01,
        -1.8634e-03, -1.2010e-01, -1.4793e-01, -3.4710e+00,  6.5598e-01,
        -9.0712e-01,  1.8469e-01, -3.8436e-01,  2.1459e-01,  2.8072e-01,
        -4.2464e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2339]), tensor(0.0128))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-0.1586,  0.8064,  0.0876, -1.2287, -0.1595, -0.8100, -0.1547, -0.3535,
         0.4353, -0.1385, -0.6847,  0.1083, -0.5059, -0.3799,  0.1162,  0.4810,
        -0.1436,  0.2410, -0.0440,  0.5166, -0.3344, -0.0096, -0.0348,  0.0031,
        -0.0449, -0.2766, -0.5865, -0.0457,  0.1597,  1.3691,  0.3576, -0.1138,
         0.4955, -0.0151, -0.2735, -0.2270,  0.0408,  0.8313, -0.0544, -1.1414,
        -0.2990,  0.3093,  0.2607, -0.0450, -0.1960, -0.7588,  0.1068, -0.0657,
        -0.3888, -0.1417, -0.8087,  0.5109, -0.0388, -0.0117, -0.0264,  0.4191,
        -0.6486,  0.0795, -0.2451, -0.0521,  0.1310, -0.3016,  0.1264,  0.2429,
         0.0861, -0.1877,  0.4527, -0.1369,  0.6642, -0.4217, -0.3116, -0.0191,
        -0.0254, -0.9051,  0.1966,  0.6720,  0.0159, -0.3841, -0.1737,  0.0086,
         0.0038,  0.1575,  0.1564, -0.2541, -0.5610, -0.1486, -0.1379, -0.2741,
         0.0496,  0.1912, -0.5340, -1.2737,  0.0210,  1.5867,  2.3335,  2.6672,
        -0.0535,  2.4516, -2.9617,  0.8248, -0.4047,  0.1143, -0.0776,  0.0298,
         0.2141,  0.1960,  0.0672,  0.2640,  0.0000, -1.2144,  0.6173, -2.6076,
         0.1731, -0.0393,  0.2582, -0.0191,  0.1997, -0.1961, -0.0766, -0.1415,
         0.1249, -0.3337, -0.3158,  0.3138,  0.3040, -0.4072,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([5150]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-4.4271e-01, -2.8657e-01, -5.4112e-01,  1.7223e+00,  1.2791e-01,
        -7.2758e-01, -1.6145e+00, -8.8335e-01, -3.5326e-01, -4.7428e-01,
        -7.4585e-01,  5.6984e-02, -1.8806e-02,  6.3419e-01,  3.0459e-01,
         2.5086e+00, -8.7727e-02,  1.9522e-01,  1.9799e-01,  1.5400e+00,
        -4.5036e-01, -5.6030e-02, -3.0106e-02,  3.9506e-02, -4.3974e-02,
        -5.0832e-01, -6.4088e-01, -4.5684e-02, -6.5200e-01,  8.5437e-01,
        -2.6626e-01, -1.1076e-01,  3.2285e-01, -2.1166e+00, -7.6734e-01,
        -3.5201e-01, -4.6172e-01, -5.5369e-01, -1.6259e-01, -1.0099e+00,
        -2.3403e-01, -6.5267e-01,  5.0908e-01, -8.6439e-02,  2.3468e-02,
        -8.0030e-01,  1.6257e-01, -2.0365e-02, -2.2480e-01, -1.8963e-01,
        -1.8954e-02, -6.3108e-01, -7.0994e-01, -5.3802e-01, -2.6445e-02,
         3.3073e-01, -1.0056e+00, -3.8869e-03, -1.3339e-01, -2.8006e-01,
        -3.0459e-01, -3.5814e-01, -1.1735e+00,  1.0976e+00, -1.6674e-02,
        -6.9679e-01, -1.5458e-01,  1.0886e+00,  1.3371e+00, -4.5529e-01,
        -3.1160e-01, -1.9145e-02, -2.5361e-02, -7.9685e-01,  9.8504e-02,
         7.3055e-02, -1.9542e-04, -2.7171e-01,  1.2449e-01,  8.5546e-03,
         1.3094e-01,  8.5354e-01,  4.1512e-01, -9.4846e-02, -5.5554e-01,
        -1.3874e-01, -1.3308e-01, -3.5146e-01, -7.9408e-01,  4.8027e-01,
        -5.4107e-01, -1.2737e+00,  2.0963e-02, -1.3357e+00, -2.3685e+00,
        -1.0774e+00,  1.0671e-01, -1.7903e+00,  1.5713e+00,  7.2729e-01,
        -1.0746e-01,  2.6270e-01, -7.7583e-02,  3.6254e+00,  2.1410e-01,
         1.5701e+00,  5.2948e-02,  3.5263e-01,  0.0000e+00,  7.1195e-01,
         1.9486e+00, -2.4186e-01,  1.1852e-01,  1.3833e+01,  2.5821e-01,
        -1.9104e-02,  6.3610e-02, -2.0462e-01, -3.3141e+00,  6.0176e-01,
         5.7319e-01,  6.3205e-01, -3.2629e-01,  2.4644e-01,  3.5078e-01,
        -3.9848e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2105]), tensor(-0.0131))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:main_restricted_month.py:Testing data year: 2001
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 13269
            device: cpu
            
2024-07-28 22:51:14,382	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-28 22:51:14,438	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-28 22:51:14,474	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip' (1.43MiB) to Ray cluster...
2024-07-28 22:51:14,479	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip'.
2024-07-28 22:51:17,761	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-29 01:17:08,796	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_22-51-17' in 0.1826s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 125, 'num_layers': 1, 'num_embeddings': 13269, 'embedding_dim': 1, 'dropout_rate': 0.25, 'lr': 0.008862326508576258, 'weight_decay': 0.00020736445177905053, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.0335796931753017
INFO:model_data_nn.py:Best trial testing loss: 0.07288491042392246
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-28_22-51-11_932955_365373/artifacts/2024-07-28_22-51-17/train_fnn_2024-07-28_22-51-17/driver_artifacts/train_fnn_92df0_00009_9_dropout_rate=0.2500,embedding_dim=1,hidden_dim=125,lr=0.0089,num_layers=1,weight_decay=0.0002_2024-07-28_22-51-17
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 125, 'num_layers': 1, 'num_embeddings': 13927, 'embedding_dim': 1, 'dropout_rate': 0.25, 'lr': 0.008862326508576258, 'weight_decay': 0.00020736445177905053, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03590988916980562, 'avg_test_loss': 0.04749081388171544}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.03584902424608402, 'avg_test_loss': 0.048023634195614014}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.03588810647119116, 'avg_test_loss': 0.048646509878957606}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03587401368697843, 'avg_test_loss': 0.04645027011869477}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03582820628801234, 'avg_test_loss': 0.04665413567708883}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03581553118850438, 'avg_test_loss': 0.04666638503739712}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.035828553018931335, 'avg_test_loss': 0.0466692582853218}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.035821978887349046, 'avg_test_loss': 0.047555791875079134}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.035879670308572836, 'avg_test_loss': 0.04688373567107091}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03588960638469941, 'avg_test_loss': 0.04679820971988865}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.035880755819992456, 'avg_test_loss': 0.04793305484391153}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.035891132752463924, 'avg_test_loss': 0.0465653325125909}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.035892557291044756, 'avg_test_loss': 0.046536512064609355}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.035835530963788706, 'avg_test_loss': 0.04650206231435596}
INFO:model_data_nn.py:Early stopping at epoch 14
INFO:main_restricted_month.py:Making prediction for data in year: 2002
INFO:main_restricted_month.py:Prediction data shape: (59934,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2002: 0.21567957978741073
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  59934.000000  59934.000000
mean      -0.008055      0.008159
std        0.215604      0.013749
min       -0.943662     -0.057318
25%       -0.103582      0.001661
50%       -0.010669      0.002134
75%        0.066667      0.012361
max        5.640000      0.153657
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:transform_data_nn.py:Train_data: (1090494, 161)

INFO:transform_data_nn.py:Test data years: [2002]
INFO:transform_data_nn.py:Test_data: (59934, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:transform_data_nn.py:Retrain_data: (1150428, 161)

INFO:transform_data_nn.py:Prediction data years: [2003]
INFO:transform_data_nn.py:Prediction_data: (55419, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1090494, 138])
            y_train_tf: torch.Size([1090494])

            x_test_tf: torch.Size([59934, 138])
            y_test_tf: torch.Size([59934])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1150428, 138])
            y_retrain_tf: torch.Size([1150428])

            x_prediction_tf: torch.Size([55419, 138])
            y_prediction_tf: torch.Size([55419])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-0.1586,  0.8064,  0.0876, -1.2287, -0.1595, -0.8100, -0.1547, -0.3535,
         0.4353, -0.1385, -0.6847,  0.1083, -0.5059, -0.3799,  0.1162,  0.4810,
        -0.1436,  0.2410, -0.0440,  0.5166, -0.3344, -0.0096, -0.0348,  0.0031,
        -0.0449, -0.2766, -0.5865, -0.0457,  0.1597,  1.3691,  0.3576, -0.1138,
         0.4955, -0.0151, -0.2735, -0.2270,  0.0408,  0.8313, -0.0544, -1.1414,
        -0.2990,  0.3093,  0.2607, -0.0450, -0.1960, -0.7588,  0.1068, -0.0657,
        -0.3888, -0.1417, -0.8087,  0.5109, -0.0388, -0.0117, -0.0264,  0.4191,
        -0.6486,  0.0795, -0.2451, -0.0521,  0.1310, -0.3016,  0.1264,  0.2429,
         0.0861, -0.1877,  0.4527, -0.1369,  0.6642, -0.4217, -0.3116, -0.0191,
        -0.0254, -0.9051,  0.1966,  0.6720,  0.0159, -0.3841, -0.1737,  0.0086,
         0.0038,  0.1575,  0.1564, -0.2541, -0.5610, -0.1486, -0.1379, -0.2741,
         0.0496,  0.1912, -0.5340, -1.2737,  0.0210,  1.5867,  2.3335,  2.6672,
        -0.0535,  2.4516, -2.9617,  0.8248, -0.4047,  0.1143, -0.0776,  0.0298,
         0.2141,  0.1960,  0.0672,  0.2640,  0.0000, -1.2144,  0.6173, -2.6076,
         0.1731, -0.0393,  0.2582, -0.0191,  0.1997, -0.1961, -0.0766, -0.1415,
         0.1249, -0.3337, -0.3158,  0.3138,  0.3040, -0.4072,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([5150]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-4.4271e-01, -2.8657e-01, -5.4112e-01,  1.7223e+00,  1.2791e-01,
        -7.2758e-01, -1.6145e+00, -8.8335e-01, -3.5326e-01, -4.7428e-01,
        -7.4585e-01,  5.6984e-02, -1.8806e-02,  6.3419e-01,  3.0459e-01,
         2.5086e+00, -8.7727e-02,  1.9522e-01,  1.9799e-01,  1.5400e+00,
        -4.5036e-01, -5.6030e-02, -3.0106e-02,  3.9506e-02, -4.3974e-02,
        -5.0832e-01, -6.4088e-01, -4.5684e-02, -6.5200e-01,  8.5437e-01,
        -2.6626e-01, -1.1076e-01,  3.2285e-01, -2.1166e+00, -7.6734e-01,
        -3.5201e-01, -4.6172e-01, -5.5369e-01, -1.6259e-01, -1.0099e+00,
        -2.3403e-01, -6.5267e-01,  5.0908e-01, -8.6439e-02,  2.3468e-02,
        -8.0030e-01,  1.6257e-01, -2.0365e-02, -2.2480e-01, -1.8963e-01,
        -1.8954e-02, -6.3108e-01, -7.0994e-01, -5.3802e-01, -2.6445e-02,
         3.3073e-01, -1.0056e+00, -3.8869e-03, -1.3339e-01, -2.8006e-01,
        -3.0459e-01, -3.5814e-01, -1.1735e+00,  1.0976e+00, -1.6674e-02,
        -6.9679e-01, -1.5458e-01,  1.0886e+00,  1.3371e+00, -4.5529e-01,
        -3.1160e-01, -1.9145e-02, -2.5361e-02, -7.9685e-01,  9.8504e-02,
         7.3055e-02, -1.9542e-04, -2.7171e-01,  1.2449e-01,  8.5546e-03,
         1.3094e-01,  8.5354e-01,  4.1512e-01, -9.4846e-02, -5.5554e-01,
        -1.3874e-01, -1.3308e-01, -3.5146e-01, -7.9408e-01,  4.8027e-01,
        -5.4107e-01, -1.2737e+00,  2.0963e-02, -1.3357e+00, -2.3685e+00,
        -1.0774e+00,  1.0671e-01, -1.7903e+00,  1.5713e+00,  7.2729e-01,
        -1.0746e-01,  2.6270e-01, -7.7583e-02,  3.6254e+00,  2.1410e-01,
         1.5701e+00,  5.2948e-02,  3.5263e-01,  0.0000e+00,  7.1195e-01,
         1.9486e+00, -2.4186e-01,  1.1852e-01,  1.3833e+01,  2.5821e-01,
        -1.9104e-02,  6.3610e-02, -2.0462e-01, -3.3141e+00,  6.0176e-01,
         5.7319e-01,  6.3205e-01, -3.2629e-01,  2.4644e-01,  3.5078e-01,
        -3.9848e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2105]), tensor(-0.0131))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.7116e-01,  8.2591e-01,  8.9769e-02, -1.2241e+00, -1.4464e-01,
        -8.2049e-01, -1.4991e-01, -3.5151e-01,  4.2190e-01, -1.3743e-01,
        -6.8725e-01,  1.2156e-01, -5.0705e-01, -3.6798e-01,  1.0485e-01,
         4.8707e-01, -1.4148e-01,  2.3734e-01, -4.6621e-02,  5.3575e-01,
        -3.2435e-01, -9.3329e-03, -1.9246e-02,  8.4216e-03, -3.7868e-02,
        -2.7713e-01, -5.8501e-01, -4.9842e-02,  1.4605e-01,  1.3202e+00,
         3.5273e-01, -1.0498e-01,  4.9351e-01, -2.0463e-03, -2.6066e-01,
        -2.2402e-01,  5.4795e-02,  8.4688e-01, -4.7742e-02, -1.1462e+00,
        -2.9924e-01,  3.2817e-01,  2.8007e-01, -4.9046e-02, -1.8754e-01,
        -7.6304e-01,  1.1420e-01, -6.1253e-02, -3.7545e-01, -1.3122e-01,
        -8.2010e-01,  4.9866e-01, -3.2872e-02, -1.1337e-02, -2.8201e-02,
         4.2178e-01, -6.3963e-01,  7.2807e-02, -2.4308e-01, -5.8345e-02,
         1.3098e-01, -3.0099e-01,  1.2807e-01,  2.3673e-01,  8.9501e-02,
        -1.9047e-01,  4.6496e-01, -1.3852e-01,  6.6373e-01, -4.2363e-01,
        -3.1924e-01, -2.1984e-02, -2.8254e-02, -9.1110e-01,  2.1188e-01,
         6.8313e-01,  1.9191e-02, -3.8730e-01, -1.7354e-01,  1.2541e-02,
         3.0178e-03,  1.6863e-01,  1.5687e-01, -2.3267e-01, -5.6024e-01,
        -1.5245e-01, -1.4272e-01, -2.7571e-01,  5.5402e-02,  1.8981e-01,
        -5.3707e-01, -1.2746e+00,  1.8266e-02,  1.6373e+00,  2.2893e+00,
         2.7389e+00, -8.0259e-02,  2.4169e+00, -2.9631e+00,  7.9023e-01,
        -4.3805e-01,  1.3119e-01, -8.0883e-02,  1.8536e-02,  2.1539e-01,
         1.7498e-01,  6.1703e-02,  3.1424e-01,  0.0000e+00, -1.1888e+00,
         5.9158e-01, -2.6573e+00,  1.7831e-01,  1.7976e-03,  2.0100e-01,
        -4.3975e-02,  2.2156e-01, -1.9400e-01, -3.7220e-02, -1.5561e-01,
         1.3058e-01, -3.2229e-01, -3.0179e-01,  3.2513e-01,  3.0975e-01,
        -4.0562e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5213]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-2.3912e-02, -5.8418e-01,  2.6615e-01,  1.8227e+00, -7.9206e-01,
        -5.7132e-01, -1.5597e+00, -8.6613e-01,  1.3448e-02, -4.0320e-01,
        -7.3818e-01,  4.7034e-02, -3.8436e+00,  1.1724e+00,  4.2549e-01,
        -1.9630e+00, -1.8135e-01, -3.7993e-01, -4.6621e-02, -1.6919e+00,
        -1.4811e-01, -5.3354e-02, -2.6453e-02, -5.3272e-01,  6.4118e-02,
        -5.3700e-01, -6.4345e-01, -4.9842e-02, -9.5630e-01,  1.6872e+00,
        -5.0354e-01, -2.1994e-01,  2.2919e-01, -2.0463e-03, -7.7073e-01,
        -2.8178e-01, -1.0711e-01, -6.7097e-01, -4.4602e-01, -1.0738e+00,
        -2.4302e-01, -9.7469e-01, -4.7558e-01, -1.4572e-02, -6.5785e-01,
        -7.3570e-01, -6.3836e-01, -7.4691e-01,  1.8460e-01, -4.9137e-01,
         7.6610e-01, -8.5028e-01, -5.3733e-01, -5.3597e-01, -7.3272e-01,
         1.9813e-01, -9.9838e-01,  2.1446e-01, -3.4673e-01, -3.3022e-01,
         1.3082e-02, -3.8348e-01,  4.2007e-01,  2.2035e-01, -1.4582e-02,
         3.2187e-01, -1.3924e+00,  9.4919e-01, -8.5109e-03, -4.8587e-01,
        -3.1924e-01, -2.1984e-02, -2.8254e-02, -6.3183e-01,  1.0355e-01,
        -1.2528e+00,  2.1320e+00, -2.0209e-01,  1.8162e-01,  1.2541e-02,
         3.0178e-03, -8.5876e-01,  6.3903e-01,  7.2192e-02, -4.7227e-01,
        -1.4130e-01, -1.3768e-01, -3.4183e-01, -3.7515e-01,  1.5278e+00,
        -4.8235e-01,  1.1426e+00,  1.8266e-02, -6.5426e-01, -1.2414e+00,
        -3.8822e-01,  7.6086e-01, -1.8048e+00,  1.1585e+00,  5.9327e-01,
         4.2696e-02, -1.7440e+00, -8.0883e-02,  1.7935e+00,  2.1539e-01,
         2.4999e+00,  1.3570e-02,  3.1424e-01,  0.0000e+00, -1.4868e+00,
        -7.2428e-01, -4.2164e-01,  1.2112e-01,  9.5453e+00,  2.0100e-01,
        -4.3975e-02, -9.9337e-02, -2.6256e-01, -3.2969e+00,  7.2596e-01,
         2.9793e-01,  5.6518e-01, -3.6796e-01,  1.5587e-01,  1.5892e-01,
        -3.7067e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([1945]), tensor(0.1481))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:main_restricted_month.py:Testing data year: 2002
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 13927
            device: cpu
            
2024-07-29 03:33:16,673	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-29 03:33:16,719	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-29 03:33:16,757	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip' (1.43MiB) to Ray cluster...
2024-07-29 03:33:16,762	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_82bc2c0e3613e455.zip'.
2024-07-29 03:33:20,302	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-29 06:16:31,291	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_03-33-20' in 0.2204s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 175, 'num_layers': 5, 'num_embeddings': 13927, 'embedding_dim': 10, 'dropout_rate': 0.51, 'lr': 1.457050032975656e-06, 'weight_decay': 3.212219315322692e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03556740367571382
INFO:model_data_nn.py:Best trial testing loss: 0.046538399586110134
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-29_03-33-14_291502_365373/artifacts/2024-07-29_03-33-20/train_fnn_2024-07-29_03-33-20/driver_artifacts/train_fnn_f97dd_00097_97_dropout_rate=0.5100,embedding_dim=10,hidden_dim=175,lr=0.0000,num_layers=5,weight_decay=0.0000_2024-07-29_03-33-20
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 175, 'num_layers': 5, 'num_embeddings': 14098, 'embedding_dim': 10, 'dropout_rate': 0.51, 'lr': 1.457050032975656e-06, 'weight_decay': 3.212219315322692e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.044026671938689754, 'avg_test_loss': 0.03895814763892907}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.03845093238335741, 'avg_test_loss': 0.038285095380956854}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.03695846678108652, 'avg_test_loss': 0.03808635817496558}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03653338591088004, 'avg_test_loss': 0.037976666852373706}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.036402402501239335, 'avg_test_loss': 0.03784649917456874}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03635450619772639, 'avg_test_loss': 0.03787964794921364}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.036340606721366984, 'avg_test_loss': 0.037822973663869205}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.036333766446851316, 'avg_test_loss': 0.03782686171945675}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03633062981122348, 'avg_test_loss': 0.03779437490841094}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03633262962579535, 'avg_test_loss': 0.03774706616123394}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.036327860296390325, 'avg_test_loss': 0.03772566801767289}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.036326313897193103, 'avg_test_loss': 0.03772880187861441}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.03632587838177513, 'avg_test_loss': 0.037721850264841136}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.03632393655672145, 'avg_test_loss': 0.03768371179023452}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.036325485860343655, 'avg_test_loss': 0.03769194194616849}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.03632504034626394, 'avg_test_loss': 0.037689071884765946}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.036322069107717535, 'avg_test_loss': 0.037639969207860495}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.03632249167715073, 'avg_test_loss': 0.03763082553041071}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.03631904180301851, 'avg_test_loss': 0.03760386072959553}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.036314137391014495, 'avg_test_loss': 0.037617496341170086}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.036315500251742634, 'avg_test_loss': 0.03759602185738796}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.03630905063875918, 'avg_test_loss': 0.037577200810560485}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.03630351657293444, 'avg_test_loss': 0.037535845346137985}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.03630376475470237, 'avg_test_loss': 0.03756548776253671}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.03630139281624878, 'avg_test_loss': 0.037521380775470466}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.036298090314122046, 'avg_test_loss': 0.03749740753520719}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.03629813214019915, 'avg_test_loss': 0.03748704481135417}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.03628987181464622, 'avg_test_loss': 0.03751482607637625}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.036287195237552805, 'avg_test_loss': 0.03748325555312165}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.036282795857933224, 'avg_test_loss': 0.037487363345989864}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.03627325082285861, 'avg_test_loss': 0.037482574199246756}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.03627114943990776, 'avg_test_loss': 0.037479295999168764}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.03627304619078288, 'avg_test_loss': 0.0374800222076252}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.03626126775358591, 'avg_test_loss': 0.03745302359528375}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.03625232937170564, 'avg_test_loss': 0.03746746391715056}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.03624950953726924, 'avg_test_loss': 0.03741094235929835}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.036242128443304475, 'avg_test_loss': 0.03746332496718673}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.03623386049829879, 'avg_test_loss': 0.03738107817816413}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.036222584619233236, 'avg_test_loss': 0.03736957684471154}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.036214627587041866, 'avg_test_loss': 0.03733779471227792}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.03621335380320434, 'avg_test_loss': 0.03734216361342097}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.036201166928290715, 'avg_test_loss': 0.037330206629592175}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.03618898198197537, 'avg_test_loss': 0.03728749598032315}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.03618693380665513, 'avg_test_loss': 0.03729063457181337}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.03616969467225287, 'avg_test_loss': 0.037261830743640985}
INFO:model_data_nn.py:Epoch 46/50, metrics: {'avg_train_loss': 0.036160050426818295, 'avg_test_loss': 0.03724362176663391}
INFO:model_data_nn.py:Epoch 47/50, metrics: {'avg_train_loss': 0.03615544358605451, 'avg_test_loss': 0.037208411099731185}
INFO:model_data_nn.py:Epoch 48/50, metrics: {'avg_train_loss': 0.03614286214060287, 'avg_test_loss': 0.037211779923625635}
INFO:model_data_nn.py:Epoch 49/50, metrics: {'avg_train_loss': 0.036136452283425914, 'avg_test_loss': 0.03718184193141337}
INFO:model_data_nn.py:Epoch 50/50, metrics: {'avg_train_loss': 0.03611996021862819, 'avg_test_loss': 0.03707714047063546}
INFO:main_restricted_month.py:Making prediction for data in year: 2003
INFO:main_restricted_month.py:Prediction data shape: (55419,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2003: 0.19256025534177815
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  55419.000000  55419.000000
mean       0.050470      0.017360
std        0.190533      0.007893
min       -0.941860     -0.045361
25%       -0.034663      0.013099
50%        0.024451      0.016206
75%        0.101886      0.020509
max        5.178572      0.069851
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:transform_data_nn.py:Train_data: (1150428, 161)

INFO:transform_data_nn.py:Test data years: [2003]
INFO:transform_data_nn.py:Test_data: (55419, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:transform_data_nn.py:Retrain_data: (1205847, 161)

INFO:transform_data_nn.py:Prediction data years: [2004]
INFO:transform_data_nn.py:Prediction_data: (52500, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1150428, 138])
            y_train_tf: torch.Size([1150428])

            x_test_tf: torch.Size([55419, 138])
            y_test_tf: torch.Size([55419])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1205847, 138])
            y_retrain_tf: torch.Size([1205847])

            x_prediction_tf: torch.Size([52500, 138])
            y_prediction_tf: torch.Size([52500])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.7116e-01,  8.2591e-01,  8.9769e-02, -1.2241e+00, -1.4464e-01,
        -8.2049e-01, -1.4991e-01, -3.5151e-01,  4.2190e-01, -1.3743e-01,
        -6.8725e-01,  1.2156e-01, -5.0705e-01, -3.6798e-01,  1.0485e-01,
         4.8707e-01, -1.4148e-01,  2.3734e-01, -4.6621e-02,  5.3575e-01,
        -3.2435e-01, -9.3329e-03, -1.9246e-02,  8.4216e-03, -3.7868e-02,
        -2.7713e-01, -5.8501e-01, -4.9842e-02,  1.4605e-01,  1.3202e+00,
         3.5273e-01, -1.0498e-01,  4.9351e-01, -2.0463e-03, -2.6066e-01,
        -2.2402e-01,  5.4795e-02,  8.4688e-01, -4.7742e-02, -1.1462e+00,
        -2.9924e-01,  3.2817e-01,  2.8007e-01, -4.9046e-02, -1.8754e-01,
        -7.6304e-01,  1.1420e-01, -6.1253e-02, -3.7545e-01, -1.3122e-01,
        -8.2010e-01,  4.9866e-01, -3.2872e-02, -1.1337e-02, -2.8201e-02,
         4.2178e-01, -6.3963e-01,  7.2807e-02, -2.4308e-01, -5.8345e-02,
         1.3098e-01, -3.0099e-01,  1.2807e-01,  2.3673e-01,  8.9501e-02,
        -1.9047e-01,  4.6496e-01, -1.3852e-01,  6.6373e-01, -4.2363e-01,
        -3.1924e-01, -2.1984e-02, -2.8254e-02, -9.1110e-01,  2.1188e-01,
         6.8313e-01,  1.9191e-02, -3.8730e-01, -1.7354e-01,  1.2541e-02,
         3.0178e-03,  1.6863e-01,  1.5687e-01, -2.3267e-01, -5.6024e-01,
        -1.5245e-01, -1.4272e-01, -2.7571e-01,  5.5402e-02,  1.8981e-01,
        -5.3707e-01, -1.2746e+00,  1.8266e-02,  1.6373e+00,  2.2893e+00,
         2.7389e+00, -8.0259e-02,  2.4169e+00, -2.9631e+00,  7.9023e-01,
        -4.3805e-01,  1.3119e-01, -8.0883e-02,  1.8536e-02,  2.1539e-01,
         1.7498e-01,  6.1703e-02,  3.1424e-01,  0.0000e+00, -1.1888e+00,
         5.9158e-01, -2.6573e+00,  1.7831e-01,  1.7976e-03,  2.0100e-01,
        -4.3975e-02,  2.2156e-01, -1.9400e-01, -3.7220e-02, -1.5561e-01,
         1.3058e-01, -3.2229e-01, -3.0179e-01,  3.2513e-01,  3.0975e-01,
        -4.0562e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5213]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-2.3912e-02, -5.8418e-01,  2.6615e-01,  1.8227e+00, -7.9206e-01,
        -5.7132e-01, -1.5597e+00, -8.6613e-01,  1.3448e-02, -4.0320e-01,
        -7.3818e-01,  4.7034e-02, -3.8436e+00,  1.1724e+00,  4.2549e-01,
        -1.9630e+00, -1.8135e-01, -3.7993e-01, -4.6621e-02, -1.6919e+00,
        -1.4811e-01, -5.3354e-02, -2.6453e-02, -5.3272e-01,  6.4118e-02,
        -5.3700e-01, -6.4345e-01, -4.9842e-02, -9.5630e-01,  1.6872e+00,
        -5.0354e-01, -2.1994e-01,  2.2919e-01, -2.0463e-03, -7.7073e-01,
        -2.8178e-01, -1.0711e-01, -6.7097e-01, -4.4602e-01, -1.0738e+00,
        -2.4302e-01, -9.7469e-01, -4.7558e-01, -1.4572e-02, -6.5785e-01,
        -7.3570e-01, -6.3836e-01, -7.4691e-01,  1.8460e-01, -4.9137e-01,
         7.6610e-01, -8.5028e-01, -5.3733e-01, -5.3597e-01, -7.3272e-01,
         1.9813e-01, -9.9838e-01,  2.1446e-01, -3.4673e-01, -3.3022e-01,
         1.3082e-02, -3.8348e-01,  4.2007e-01,  2.2035e-01, -1.4582e-02,
         3.2187e-01, -1.3924e+00,  9.4919e-01, -8.5109e-03, -4.8587e-01,
        -3.1924e-01, -2.1984e-02, -2.8254e-02, -6.3183e-01,  1.0355e-01,
        -1.2528e+00,  2.1320e+00, -2.0209e-01,  1.8162e-01,  1.2541e-02,
         3.0178e-03, -8.5876e-01,  6.3903e-01,  7.2192e-02, -4.7227e-01,
        -1.4130e-01, -1.3768e-01, -3.4183e-01, -3.7515e-01,  1.5278e+00,
        -4.8235e-01,  1.1426e+00,  1.8266e-02, -6.5426e-01, -1.2414e+00,
        -3.8822e-01,  7.6086e-01, -1.8048e+00,  1.1585e+00,  5.9327e-01,
         4.2696e-02, -1.7440e+00, -8.0883e-02,  1.7935e+00,  2.1539e-01,
         2.4999e+00,  1.3570e-02,  3.1424e-01,  0.0000e+00, -1.4868e+00,
        -7.2428e-01, -4.2164e-01,  1.2112e-01,  9.5453e+00,  2.0100e-01,
        -4.3975e-02, -9.9337e-02, -2.6256e-01, -3.2969e+00,  7.2596e-01,
         2.9793e-01,  5.6518e-01, -3.6796e-01,  1.5587e-01,  1.5892e-01,
        -3.7067e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([1945]), tensor(0.1481))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-0.1753,  0.8439,  0.0867, -1.2221, -0.1328, -0.8232, -0.1465, -0.3496,
         0.4204, -0.1375, -0.6908,  0.1272, -0.5098, -0.3726,  0.1052,  0.4888,
        -0.1389,  0.2331, -0.0478,  0.5492, -0.3443, -0.0067, -0.0063,  0.0070,
        -0.0316, -0.2768, -0.5875, -0.0547,  0.1296,  1.3271,  0.3483, -0.0982,
         0.4962,  0.0109, -0.2525, -0.2154,  0.0773,  0.8623, -0.0372, -1.1511,
        -0.2970,  0.3194,  0.2974, -0.0499, -0.1808, -0.7614,  0.1143, -0.0696,
        -0.3653, -0.1449, -0.8306,  0.4838, -0.0284, -0.0118, -0.0295,  0.4222,
        -0.6315,  0.0657, -0.2425, -0.0523,  0.1291, -0.3008,  0.1307,  0.2347,
         0.0898, -0.1910,  0.4765, -0.1394,  0.6524, -0.4250, -0.3258, -0.0241,
        -0.0301, -0.9095,  0.2190,  0.6918,  0.0230, -0.3900, -0.1737,  0.0151,
        -0.0062,  0.1789,  0.1615, -0.2088, -0.5597, -0.1549, -0.1460, -0.2768,
         0.0611,  0.1879, -0.5417, -1.2757,  0.0165,  1.6888,  2.3405,  2.8106,
        -0.0858,  2.3790, -2.9726,  0.7926, -0.4489,  0.1438,  0.4357,  0.0452,
         0.5575,  0.1573,  0.0500,  0.2120,  0.0000, -1.0689,  0.6337, -2.6821,
         0.1799,  0.0048,  0.1828, -0.0406,  0.2423, -0.1914, -0.0647, -0.1598,
         0.1314, -0.3116, -0.2920,  0.3313,  0.3122, -0.4080,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([5265]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-3.2936e-01, -3.2354e-01, -5.4633e-01,  1.9132e+00, -6.0531e-04,
        -4.1457e-01, -1.4304e+00, -8.5136e-01,  2.3520e-01,  3.1459e-01,
        -3.9811e-01,  5.1732e-02, -8.8107e-02,  8.9970e-01,  3.6307e-01,
        -2.8172e-01, -2.1926e-01,  2.1350e-01, -4.7779e-02, -1.1668e-01,
         2.8434e-01, -5.4769e-02, -6.0819e-04,  3.0307e-01, -7.7617e-03,
        -5.4888e-01, -6.3310e-01, -5.4709e-02, -9.9213e-01,  1.6441e+00,
         5.8696e-02, -2.3628e-01,  1.8150e-01,  1.0890e-02, -8.5428e-01,
        -2.5411e-01, -1.5820e-01, -6.7610e-01, -2.9616e-01, -6.4421e-01,
        -2.4797e-01,  6.5678e-01,  8.8970e-02,  2.4571e-01, -3.0490e-02,
        -6.7759e-01, -5.2205e-01, -9.1243e-02, -5.2986e-01, -1.6908e-01,
         7.6003e-01, -9.6388e-01, -6.9590e-01, -5.3523e-01, -2.9458e-02,
         1.0544e-01, -9.9226e-01,  1.4390e-02, -2.3924e-01,  2.8336e-02,
         1.1181e-01, -7.2856e-02, -5.4846e-02, -5.3577e-02, -1.7329e-02,
        -3.4757e-01, -2.5320e+00,  5.9189e-01,  1.3237e+00, -4.7865e-01,
        -3.2580e-01, -2.4051e-02, -3.0081e-02, -7.0693e-01,  7.1596e-02,
         5.2629e-01, -1.4765e-01, -2.5753e-01,  5.6461e-02,  1.5098e-02,
        -6.1875e-03, -5.1219e-01,  6.8059e-01, -1.6487e-01, -8.7337e-02,
        -1.3890e-01, -1.3914e-01,  2.8332e-01, -3.4090e-01, -3.1705e+00,
        -2.2172e-01, -2.4002e-01,  1.6535e-02, -9.6717e-01, -4.0192e-01,
        -6.8940e-01, -2.8601e-01, -1.7415e+00,  1.4858e+00, -6.1973e-02,
        -3.5294e-01, -1.3030e-01, -3.1220e+00,  1.0108e-01,  2.1820e+00,
         1.7184e+00,  5.6388e-02,  2.1205e-01,  1.4270e+00, -1.7971e+00,
        -1.0456e+00,  1.1128e-01,  1.1716e-01,  7.1392e+00,  1.8278e-01,
        -4.0582e-02, -2.6079e-01, -1.3555e-01, -3.2903e+00,  7.9523e-01,
        -4.1853e-01,  3.0141e-02, -4.7988e-01,  1.1897e-01,  1.0567e-01,
        -3.5705e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2777]), tensor(0.0101))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:main_restricted_month.py:Testing data year: 2003
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 14098
            device: cpu
            
2024-07-29 10:03:58,534	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-29 10:03:58,573	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-29 10:03:58,609	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_eb0c34e50646badb.zip' (1.43MiB) to Ray cluster...
2024-07-29 10:03:58,614	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_eb0c34e50646badb.zip'.
2024-07-29 10:04:02,264	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-29 10:58:40,055	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_10-04-02' in 0.3869s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 14098, 'embedding_dim': 2, 'dropout_rate': 0.46, 'lr': 0.00015665171630946476, 'weight_decay': 0.0001190379922025017, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03483503650805822
INFO:model_data_nn.py:Best trial testing loss: 0.03571622596981593
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-29_10-03-56_248420_365373/artifacts/2024-07-29_10-04-02/train_fnn_2024-07-29_10-04-02/driver_artifacts/train_fnn_8dfd7_00032_32_dropout_rate=0.4600,embedding_dim=2,hidden_dim=25,lr=0.0002,num_layers=1,weight_decay=0.0001_2024-07-29_10-04-02
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 14254, 'embedding_dim': 2, 'dropout_rate': 0.46, 'lr': 0.00015665171630946476, 'weight_decay': 0.0001190379922025017, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.035900885656020495, 'avg_test_loss': 0.023108542587689775}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.03544231839363343, 'avg_test_loss': 0.023521770522946742}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.03522643003135381, 'avg_test_loss': 0.023812577392719914}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.035109926379670205, 'avg_test_loss': 0.023931532379593723}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03501384733526022, 'avg_test_loss': 0.023673526495785864}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.034943071988523644, 'avg_test_loss': 0.02388533934764791}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03491386040717877, 'avg_test_loss': 0.02386579509590833}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.034853720206721055, 'avg_test_loss': 0.02353784677104051}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.034807050482070126, 'avg_test_loss': 0.02360583559567978}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03480252055645032, 'avg_test_loss': 0.02382936164505335}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03479260503131651, 'avg_test_loss': 0.024109261454140878}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main_restricted_month.py:Making prediction for data in year: 2004
INFO:main_restricted_month.py:Prediction data shape: (52500,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2004: 0.15517852232792992
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  52500.000000  52500.000000
mean       0.017988      0.021769
std        0.151285      0.043513
min       -0.918750     -0.235222
25%       -0.046307      0.002047
50%        0.009646      0.020118
75%        0.068970      0.039174
max        6.908072      3.183415
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:transform_data_nn.py:Train_data: (1205847, 161)

INFO:transform_data_nn.py:Test data years: [2004]
INFO:transform_data_nn.py:Test_data: (52500, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]
INFO:transform_data_nn.py:Retrain_data: (1258347, 161)

INFO:transform_data_nn.py:Prediction data years: [2005]
INFO:transform_data_nn.py:Prediction_data: (50879, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1205847, 138])
            y_train_tf: torch.Size([1205847])

            x_test_tf: torch.Size([52500, 138])
            y_test_tf: torch.Size([52500])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1258347, 138])
            y_retrain_tf: torch.Size([1258347])

            x_prediction_tf: torch.Size([50879, 138])
            y_prediction_tf: torch.Size([50879])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-0.1753,  0.8439,  0.0867, -1.2221, -0.1328, -0.8232, -0.1465, -0.3496,
         0.4204, -0.1375, -0.6908,  0.1272, -0.5098, -0.3726,  0.1052,  0.4888,
        -0.1389,  0.2331, -0.0478,  0.5492, -0.3443, -0.0067, -0.0063,  0.0070,
        -0.0316, -0.2768, -0.5875, -0.0547,  0.1296,  1.3271,  0.3483, -0.0982,
         0.4962,  0.0109, -0.2525, -0.2154,  0.0773,  0.8623, -0.0372, -1.1511,
        -0.2970,  0.3194,  0.2974, -0.0499, -0.1808, -0.7614,  0.1143, -0.0696,
        -0.3653, -0.1449, -0.8306,  0.4838, -0.0284, -0.0118, -0.0295,  0.4222,
        -0.6315,  0.0657, -0.2425, -0.0523,  0.1291, -0.3008,  0.1307,  0.2347,
         0.0898, -0.1910,  0.4765, -0.1394,  0.6524, -0.4250, -0.3258, -0.0241,
        -0.0301, -0.9095,  0.2190,  0.6918,  0.0230, -0.3900, -0.1737,  0.0151,
        -0.0062,  0.1789,  0.1615, -0.2088, -0.5597, -0.1549, -0.1460, -0.2768,
         0.0611,  0.1879, -0.5417, -1.2757,  0.0165,  1.6888,  2.3405,  2.8106,
        -0.0858,  2.3790, -2.9726,  0.7926, -0.4489,  0.1438,  0.4357,  0.0452,
         0.5575,  0.1573,  0.0500,  0.2120,  0.0000, -1.0689,  0.6337, -2.6821,
         0.1799,  0.0048,  0.1828, -0.0406,  0.2423, -0.1914, -0.0647, -0.1598,
         0.1314, -0.3116, -0.2920,  0.3313,  0.3122, -0.4080,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([5265]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-3.2936e-01, -3.2354e-01, -5.4633e-01,  1.9132e+00, -6.0531e-04,
        -4.1457e-01, -1.4304e+00, -8.5136e-01,  2.3520e-01,  3.1459e-01,
        -3.9811e-01,  5.1732e-02, -8.8107e-02,  8.9970e-01,  3.6307e-01,
        -2.8172e-01, -2.1926e-01,  2.1350e-01, -4.7779e-02, -1.1668e-01,
         2.8434e-01, -5.4769e-02, -6.0819e-04,  3.0307e-01, -7.7617e-03,
        -5.4888e-01, -6.3310e-01, -5.4709e-02, -9.9213e-01,  1.6441e+00,
         5.8696e-02, -2.3628e-01,  1.8150e-01,  1.0890e-02, -8.5428e-01,
        -2.5411e-01, -1.5820e-01, -6.7610e-01, -2.9616e-01, -6.4421e-01,
        -2.4797e-01,  6.5678e-01,  8.8970e-02,  2.4571e-01, -3.0490e-02,
        -6.7759e-01, -5.2205e-01, -9.1243e-02, -5.2986e-01, -1.6908e-01,
         7.6003e-01, -9.6388e-01, -6.9590e-01, -5.3523e-01, -2.9458e-02,
         1.0544e-01, -9.9226e-01,  1.4390e-02, -2.3924e-01,  2.8336e-02,
         1.1181e-01, -7.2856e-02, -5.4846e-02, -5.3577e-02, -1.7329e-02,
        -3.4757e-01, -2.5320e+00,  5.9189e-01,  1.3237e+00, -4.7865e-01,
        -3.2580e-01, -2.4051e-02, -3.0081e-02, -7.0693e-01,  7.1596e-02,
         5.2629e-01, -1.4765e-01, -2.5753e-01,  5.6461e-02,  1.5098e-02,
        -6.1875e-03, -5.1219e-01,  6.8059e-01, -1.6487e-01, -8.7337e-02,
        -1.3890e-01, -1.3914e-01,  2.8332e-01, -3.4090e-01, -3.1705e+00,
        -2.2172e-01, -2.4002e-01,  1.6535e-02, -9.6717e-01, -4.0192e-01,
        -6.8940e-01, -2.8601e-01, -1.7415e+00,  1.4858e+00, -6.1973e-02,
        -3.5294e-01, -1.3030e-01, -3.1220e+00,  1.0108e-01,  2.1820e+00,
         1.7184e+00,  5.6388e-02,  2.1205e-01,  1.4270e+00, -1.7971e+00,
        -1.0456e+00,  1.1128e-01,  1.1716e-01,  7.1392e+00,  1.8278e-01,
        -4.0582e-02, -2.6079e-01, -1.3555e-01, -3.2903e+00,  7.9523e-01,
        -4.1853e-01,  3.0141e-02, -4.7988e-01,  1.1897e-01,  1.0567e-01,
        -3.5705e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2777]), tensor(0.0101))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.7118e-01,  8.5868e-01,  8.8566e-02, -1.5388e+00, -1.3117e-01,
        -8.2291e-01, -1.4596e-01, -3.4926e-01,  4.3716e-01, -1.7202e-01,
        -6.9485e-01,  8.8289e-02, -7.0847e-01, -4.7390e-01,  8.9443e-02,
         4.9313e-01, -1.3942e-01,  2.1304e-01, -8.4367e-02,  5.5897e-01,
        -3.9582e-01, -4.3030e-02, -1.4308e-01,  4.1671e-03, -7.9695e-02,
        -3.3579e-01, -5.8883e-01, -5.5108e-02,  4.7181e-01,  1.4085e+00,
         3.5091e-01, -1.3127e-01,  7.5088e-01,  2.7912e-01, -2.4717e-01,
        -2.4284e-01,  9.4743e-02,  8.7583e-01, -2.9307e-02, -1.1505e+00,
        -2.9232e-01,  2.5186e-01,  3.1120e-01,  4.6181e-02, -1.7703e-01,
        -7.5647e-01,  8.8821e-02, -7.1044e-02, -3.6089e-01, -1.5067e-01,
        -8.3754e-01,  4.6113e-01, -4.7766e-01,  8.9538e-02, -3.2225e-02,
         4.9715e-01, -6.2360e-01, -1.7517e-01, -2.4635e-01, -4.8498e-02,
         9.5382e-03, -3.0470e-01,  5.9635e-02,  2.2723e-01,  7.4789e-02,
        -1.9747e-01,  6.8953e-01, -2.6385e-01,  6.4149e-01, -5.6310e-01,
        -3.2999e-01, -1.6304e-01, -3.0124e-02, -9.0452e-01,  1.7914e-01,
         7.0433e-01,  8.2017e-01, -1.1292e+00,  2.8310e-01,  1.7434e-02,
        -8.0780e-01,  1.8336e-01,  3.2381e-01, -1.8027e-01, -5.5950e-01,
        -4.2899e-01, -5.2643e-01, -2.7535e-01,  6.5333e-02,  1.2012e-01,
        -5.4874e-01, -1.3395e+00,  2.2352e-01, -1.2212e-15, -1.2212e-15,
         2.8768e+00, -8.6174e-02,  2.3731e+00, -2.9939e+00,  8.2695e-01,
        -4.4387e-01,  1.5121e-01,  1.4902e-01,  5.1638e-02,  3.2754e-01,
         1.5920e-01, -1.1663e-01,  2.1836e-01, -4.0870e-01, -1.0226e+00,
         6.7248e-01,  0.0000e+00,  3.4785e-01,  6.1027e-03,  1.5095e-01,
        -1.4524e-02,  2.6119e-01, -2.3570e-01,  1.9133e-02, -5.5246e-01,
         1.2929e-01, -3.0036e-01, -3.9254e-01,  3.4894e-01,  3.7255e-01,
        -4.0992e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5314]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-2.9575e-01,  7.5992e-01, -6.9763e-01,  1.3736e+00, -4.7082e-01,
        -1.9137e-01, -1.3387e+00, -8.3885e-01, -1.0608e-01,  4.1549e-02,
        -6.1054e-01, -2.2612e-01, -7.0847e-01, -1.3475e+00, -1.6805e+00,
        -9.6217e-01, -2.2287e-01, -5.3969e-01, -8.4367e-02,  8.7016e-01,
        -1.9377e-01, -1.1485e-01, -1.3815e-01, -7.0141e-01, -1.3445e-01,
        -7.3153e-01, -6.3885e-01, -5.5108e-02, -9.6655e-01, -4.9648e-01,
        -4.0629e-02, -4.8002e-01, -1.9631e-01,  2.7912e-01, -9.1284e-01,
        -6.2998e-01, -4.2541e-01, -6.9317e-01, -6.3625e-01, -5.6744e-01,
        -2.3498e-01,  1.3396e-01, -4.8989e-02,  3.3717e-01, -3.5330e-01,
         2.2912e-01, -2.4069e-01,  9.7884e-01, -8.3168e-01, -4.6010e-01,
        -1.6338e+00, -9.0996e-01, -4.7766e-01, -6.7559e-01, -7.3432e-01,
        -3.4541e-01, -9.8688e-01, -4.9924e-01,  1.5879e-01, -3.0380e-01,
        -6.5167e-02, -3.7344e-01, -1.6896e+00,  2.4800e-01, -3.7743e-02,
        -8.0434e-01,  1.8065e+00,  9.9232e-01, -2.0433e+00, -6.8280e-01,
        -3.2999e-01, -1.6304e-01, -3.0124e-02, -1.8661e-01, -1.8362e-01,
        -2.9208e-01,  8.2017e-01, -4.3453e-01,  1.4889e+00,  1.7434e-02,
        -8.0780e-01, -5.8614e-01,  6.5976e-01,  1.0894e+00,  1.7405e-01,
        -3.0383e-01, -4.2754e-01, -1.3450e-01, -4.1190e-01,  5.6320e-01,
        -2.5824e-01, -1.0285e+00,  2.2352e-01, -1.2212e-15, -1.2212e-15,
        -4.6121e-01,  5.6279e-02, -1.1615e+00,  2.9942e-01, -8.0517e-01,
        -3.8434e-01,  2.6993e-01,  1.4902e-01, -2.3841e-01,  3.2754e-01,
         9.2274e-01, -2.1288e-01,  2.1836e-01,  1.9116e+00, -5.1760e-01,
        -7.3498e-01,  0.0000e+00, -6.4815e-02,  5.1628e+00,  1.5095e-01,
        -1.4524e-02, -1.1131e-01, -2.1950e-01,  1.9133e-02,  1.0239e+00,
        -1.1874e+00,  6.4891e-03, -7.3250e-01, -7.6827e-03, -3.3562e-01,
        -3.1238e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2742]), tensor(-0.0406))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:main_restricted_month.py:Testing data year: 2004
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 14254
            device: cpu
            
2024-07-29 13:25:36,384	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-29 13:25:36,421	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-29 13:25:36,454	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_25fcbb57aea56057.zip' (1.46MiB) to Ray cluster...
2024-07-29 13:25:36,458	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_25fcbb57aea56057.zip'.
2024-07-29 13:25:40,101	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-29 15:54:29,084	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_13-25-40' in 0.2137s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 3, 'num_embeddings': 14254, 'embedding_dim': 2, 'dropout_rate': 0.25, 'lr': 3.791105473537746e-05, 'weight_decay': 0.0003409097499797901, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03539672383539641
INFO:model_data_nn.py:Best trial testing loss: 0.022851000128463635
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-29_13-25-34_059510_365373/artifacts/2024-07-29_13-25-40/train_fnn_2024-07-29_13-25-40/driver_artifacts/train_fnn_b8dcd_00039_39_dropout_rate=0.2500,embedding_dim=2,hidden_dim=5,lr=0.0000,num_layers=3,weight_decay=0.0003_2024-07-29_13-25-40
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 3, 'num_embeddings': 14395, 'embedding_dim': 2, 'dropout_rate': 0.25, 'lr': 3.791105473537746e-05, 'weight_decay': 0.0003409097499797901, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.035789774267342846, 'avg_test_loss': 0.017548445015325674}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.03556033517718114, 'avg_test_loss': 0.017590485697424732}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.035418412530435324, 'avg_test_loss': 0.017553374451825265}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03534909311714479, 'avg_test_loss': 0.017570081387453203}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03530306539162156, 'avg_test_loss': 0.017537728697354406}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03526412255619816, 'avg_test_loss': 0.017515427693314618}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03523204805199279, 'avg_test_loss': 0.017491354300997825}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03518557893501182, 'avg_test_loss': 0.017529738131828558}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03515154860809357, 'avg_test_loss': 0.017495436451848853}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03512277039019072, 'avg_test_loss': 0.0175232370501185}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03510391329667702, 'avg_test_loss': 0.017500454030415547}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.03507822111403196, 'avg_test_loss': 0.01758540502380369}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.035088331820683896, 'avg_test_loss': 0.01748710727266405}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.035079772374827185, 'avg_test_loss': 0.017507657193162905}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.03508417377950001, 'avg_test_loss': 0.017567461921171573}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.0350805653011478, 'avg_test_loss': 0.017507090431831355}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.035051615521188226, 'avg_test_loss': 0.017549371505566177}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.035058972353501056, 'avg_test_loss': 0.017523992854117786}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.035070411012843423, 'avg_test_loss': 0.017523357845877982}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.035035499747631864, 'avg_test_loss': 0.017608285050124586}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.035050481320184027, 'avg_test_loss': 0.017510802755073746}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.03503792091235731, 'avg_test_loss': 0.017565335890090784}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.035017749889184505, 'avg_test_loss': 0.0174985296078284}
INFO:model_data_nn.py:Early stopping at epoch 23
INFO:main_restricted_month.py:Making prediction for data in year: 2005
INFO:main_restricted_month.py:Prediction data shape: (50879,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2005: 0.13228271047186674
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  50879.000000  50879.000000
mean       0.004015      0.012967
std        0.132264      0.012042
min       -0.820889     -0.062898
25%       -0.055669      0.006494
50%        0.000000      0.018548
75%        0.055960      0.018548
max        3.303279      0.213956
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]
INFO:transform_data_nn.py:Train_data: (1258347, 161)

INFO:transform_data_nn.py:Test data years: [2005]
INFO:transform_data_nn.py:Test_data: (50879, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]
INFO:transform_data_nn.py:Retrain_data: (1309226, 161)

INFO:transform_data_nn.py:Prediction data years: [2006]
INFO:transform_data_nn.py:Prediction_data: (49969, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1258347, 138])
            y_train_tf: torch.Size([1258347])

            x_test_tf: torch.Size([50879, 138])
            y_test_tf: torch.Size([50879])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1309226, 138])
            y_retrain_tf: torch.Size([1309226])

            x_prediction_tf: torch.Size([49969, 138])
            y_prediction_tf: torch.Size([49969])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.7118e-01,  8.5868e-01,  8.8566e-02, -1.5388e+00, -1.3117e-01,
        -8.2291e-01, -1.4596e-01, -3.4926e-01,  4.3716e-01, -1.7202e-01,
        -6.9485e-01,  8.8289e-02, -7.0847e-01, -4.7390e-01,  8.9443e-02,
         4.9313e-01, -1.3942e-01,  2.1304e-01, -8.4367e-02,  5.5897e-01,
        -3.9582e-01, -4.3030e-02, -1.4308e-01,  4.1671e-03, -7.9695e-02,
        -3.3579e-01, -5.8883e-01, -5.5108e-02,  4.7181e-01,  1.4085e+00,
         3.5091e-01, -1.3127e-01,  7.5088e-01,  2.7912e-01, -2.4717e-01,
        -2.4284e-01,  9.4743e-02,  8.7583e-01, -2.9307e-02, -1.1505e+00,
        -2.9232e-01,  2.5186e-01,  3.1120e-01,  4.6181e-02, -1.7703e-01,
        -7.5647e-01,  8.8821e-02, -7.1044e-02, -3.6089e-01, -1.5067e-01,
        -8.3754e-01,  4.6113e-01, -4.7766e-01,  8.9538e-02, -3.2225e-02,
         4.9715e-01, -6.2360e-01, -1.7517e-01, -2.4635e-01, -4.8498e-02,
         9.5382e-03, -3.0470e-01,  5.9635e-02,  2.2723e-01,  7.4789e-02,
        -1.9747e-01,  6.8953e-01, -2.6385e-01,  6.4149e-01, -5.6310e-01,
        -3.2999e-01, -1.6304e-01, -3.0124e-02, -9.0452e-01,  1.7914e-01,
         7.0433e-01,  8.2017e-01, -1.1292e+00,  2.8310e-01,  1.7434e-02,
        -8.0780e-01,  1.8336e-01,  3.2381e-01, -1.8027e-01, -5.5950e-01,
        -4.2899e-01, -5.2643e-01, -2.7535e-01,  6.5333e-02,  1.2012e-01,
        -5.4874e-01, -1.3395e+00,  2.2352e-01, -1.2212e-15, -1.2212e-15,
         2.8768e+00, -8.6174e-02,  2.3731e+00, -2.9939e+00,  8.2695e-01,
        -4.4387e-01,  1.5121e-01,  1.4902e-01,  5.1638e-02,  3.2754e-01,
         1.5920e-01, -1.1663e-01,  2.1836e-01, -4.0870e-01, -1.0226e+00,
         6.7248e-01,  0.0000e+00,  3.4785e-01,  6.1027e-03,  1.5095e-01,
        -1.4524e-02,  2.6119e-01, -2.3570e-01,  1.9133e-02, -5.5246e-01,
         1.2929e-01, -3.0036e-01, -3.9254e-01,  3.4894e-01,  3.7255e-01,
        -4.0992e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5314]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-2.9575e-01,  7.5992e-01, -6.9763e-01,  1.3736e+00, -4.7082e-01,
        -1.9137e-01, -1.3387e+00, -8.3885e-01, -1.0608e-01,  4.1549e-02,
        -6.1054e-01, -2.2612e-01, -7.0847e-01, -1.3475e+00, -1.6805e+00,
        -9.6217e-01, -2.2287e-01, -5.3969e-01, -8.4367e-02,  8.7016e-01,
        -1.9377e-01, -1.1485e-01, -1.3815e-01, -7.0141e-01, -1.3445e-01,
        -7.3153e-01, -6.3885e-01, -5.5108e-02, -9.6655e-01, -4.9648e-01,
        -4.0629e-02, -4.8002e-01, -1.9631e-01,  2.7912e-01, -9.1284e-01,
        -6.2998e-01, -4.2541e-01, -6.9317e-01, -6.3625e-01, -5.6744e-01,
        -2.3498e-01,  1.3396e-01, -4.8989e-02,  3.3717e-01, -3.5330e-01,
         2.2912e-01, -2.4069e-01,  9.7884e-01, -8.3168e-01, -4.6010e-01,
        -1.6338e+00, -9.0996e-01, -4.7766e-01, -6.7559e-01, -7.3432e-01,
        -3.4541e-01, -9.8688e-01, -4.9924e-01,  1.5879e-01, -3.0380e-01,
        -6.5167e-02, -3.7344e-01, -1.6896e+00,  2.4800e-01, -3.7743e-02,
        -8.0434e-01,  1.8065e+00,  9.9232e-01, -2.0433e+00, -6.8280e-01,
        -3.2999e-01, -1.6304e-01, -3.0124e-02, -1.8661e-01, -1.8362e-01,
        -2.9208e-01,  8.2017e-01, -4.3453e-01,  1.4889e+00,  1.7434e-02,
        -8.0780e-01, -5.8614e-01,  6.5976e-01,  1.0894e+00,  1.7405e-01,
        -3.0383e-01, -4.2754e-01, -1.3450e-01, -4.1190e-01,  5.6320e-01,
        -2.5824e-01, -1.0285e+00,  2.2352e-01, -1.2212e-15, -1.2212e-15,
        -4.6121e-01,  5.6279e-02, -1.1615e+00,  2.9942e-01, -8.0517e-01,
        -3.8434e-01,  2.6993e-01,  1.4902e-01, -2.3841e-01,  3.2754e-01,
         9.2274e-01, -2.1288e-01,  2.1836e-01,  1.9116e+00, -5.1760e-01,
        -7.3498e-01,  0.0000e+00, -6.4815e-02,  5.1628e+00,  1.5095e-01,
        -1.4524e-02, -1.1131e-01, -2.1950e-01,  1.9133e-02,  1.0239e+00,
        -1.1874e+00,  6.4891e-03, -7.3250e-01, -7.6827e-03, -3.3562e-01,
        -3.1238e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2742]), tensor(-0.0406))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.6113e-01,  8.6921e-01,  8.3247e-02, -1.5617e+00, -1.3101e-01,
        -8.2008e-01, -1.4661e-01, -3.4940e-01,  4.5369e-01, -1.7471e-01,
        -6.9861e-01,  8.4852e-02, -7.1234e-01, -4.8728e-01,  9.1464e-02,
         4.9662e-01, -1.3875e-01,  2.0923e-01, -8.5714e-02,  5.6430e-01,
        -4.0451e-01, -3.8567e-02, -1.5036e-01,  3.3623e-03, -8.5171e-02,
        -3.3687e-01, -5.9039e-01, -5.8975e-02,  4.5588e-01,  1.4270e+00,
         3.5175e-01, -1.3346e-01,  7.6288e-01,  2.8333e-01, -2.4230e-01,
        -2.4027e-01,  1.0319e-01,  8.8735e-01, -2.8204e-02, -1.1453e+00,
        -2.8798e-01,  2.5886e-01,  3.2041e-01,  5.1345e-02, -1.7562e-01,
        -7.4962e-01,  9.0359e-02, -7.0725e-02, -3.7065e-01, -1.5356e-01,
        -8.3832e-01,  4.3775e-01, -4.7691e-01,  9.1556e-02, -3.2977e-02,
         4.9736e-01, -6.1568e-01, -1.7859e-01, -2.4769e-01, -4.3717e-02,
         6.3086e-03, -3.0552e-01,  5.6776e-02,  2.2537e-01,  7.0339e-02,
        -1.9895e-01,  7.0253e-01, -2.6433e-01,  6.3479e-01, -5.6612e-01,
        -3.3409e-01, -1.6582e-01, -2.8274e-02, -8.9694e-01,  1.7749e-01,
         7.1680e-01,  8.3223e-01, -1.1396e+00,  2.8482e-01,  1.7998e-02,
        -8.0547e-01,  1.8180e-01,  3.4050e-01, -1.5373e-01, -5.6040e-01,
        -4.3361e-01, -5.3213e-01, -2.7393e-01,  6.9559e-02,  1.1820e-01,
        -5.5683e-01, -1.3400e+00,  2.2660e-01, -5.5511e-16, -5.5511e-16,
         2.9406e+00, -7.8242e-02,  2.4181e+00, -3.0156e+00,  8.5711e-01,
        -4.3804e-01,  1.5598e-01,  7.2495e-02,  5.4332e-02,  2.5820e-01,
         1.4597e-01, -1.2190e-01,  2.3968e-01,  2.6085e-01, -1.0186e+00,
         7.0931e-01,  0.0000e+00,  3.4336e-01, -1.1806e-02,  1.0104e-01,
        -2.2675e-03,  2.7799e-01, -2.3447e-01,  1.8827e-02, -5.5674e-01,
         1.3076e-01, -2.9067e-01, -3.9073e-01,  3.5030e-01,  3.7122e-01,
        -4.1112e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5414]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-8.9474e-01,  2.8536e-01, -6.7077e-01,  1.3413e+00, -5.3007e-01,
        -4.4020e-01, -1.0152e+00, -7.7246e-01, -2.3279e-01, -3.2072e-02,
        -7.3445e-01, -7.6232e-02, -7.1234e-01,  6.5880e-02, -3.1824e-01,
         2.5390e-01, -1.7928e-01,  5.9303e-02, -8.5714e-02, -3.7015e-01,
        -5.0705e-01, -1.1866e-01, -5.9825e-01,  3.8481e-01, -8.0931e-03,
        -6.2534e-01, -6.4134e-01, -5.8975e-02, -5.4517e-01, -5.3306e-01,
         6.7362e-01,  2.2245e-01,  3.7521e-01,  2.8333e-01, -6.5769e-01,
        -5.2043e-01, -5.6569e-01, -6.9856e-01, -3.8976e-01, -3.0058e-02,
        -2.5437e-01, -1.2535e-01, -2.9202e-01, -1.2949e-01, -5.6211e-01,
        -6.0555e-01,  4.2688e-01,  6.7028e-02, -4.0485e-01, -6.6758e-03,
        -8.3832e-01, -7.0583e-01, -4.7691e-01, -6.7535e-01, -7.3426e-01,
         2.9248e-01, -9.8165e-01, -3.6780e-01,  3.4693e-01, -2.6007e-01,
         2.7855e+00,  6.4741e-02,  2.2594e-01,  5.1978e-01, -3.9597e-02,
        -9.2325e-02,  5.4421e-02,  1.5312e+00,  6.3479e-01, -6.5327e-01,
        -3.3409e-01, -1.6582e-01, -2.8274e-02, -6.6116e-01,  3.3327e-02,
        -4.1219e-01,  8.3223e-01, -2.4484e-01,  1.4876e+00,  1.7998e-02,
        -8.0547e-01, -3.1663e-01,  1.6372e-01,  1.7417e-01, -2.5871e-01,
        -3.1913e-01, -4.4032e-01, -3.3311e-01, -4.3807e-01, -7.4301e-01,
        -1.7090e-01, -3.4201e-01,  2.2660e-01, -5.5511e-16, -5.5511e-16,
        -2.7356e-01, -5.1306e-01, -5.2007e-01, -1.0885e+00, -9.9109e-02,
        -4.4663e-01, -7.1573e-01, -2.5089e+00, -1.1079e+00,  1.6587e+00,
        -2.7107e-01, -1.2035e-01,  2.3968e-01,  6.0275e-01, -2.0169e-01,
        -8.4722e-01,  0.0000e+00,  1.4566e-01,  5.7305e+00,  1.0104e-01,
        -2.2675e-03, -8.9813e-03, -4.4609e-01,  1.8827e-02,  1.0442e-01,
         8.6150e-01,  7.0160e-02, -4.6561e-01,  2.5520e-01,  2.8668e-01,
        -3.3356e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2703]), tensor(-0.0165))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]
INFO:main_restricted_month.py:Testing data year: 2005
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 14395
            device: cpu
            
2024-07-29 18:41:41,577	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-29 18:41:41,619	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-29 18:41:41,659	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_51ce461daf09c2d4.zip' (1.46MiB) to Ray cluster...
2024-07-29 18:41:41,664	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_51ce461daf09c2d4.zip'.
2024-07-29 18:41:46,697	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-29 20:31:42,292	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_18-41-46' in 0.2266s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 14395, 'embedding_dim': 1, 'dropout_rate': 0.49, 'lr': 1.036720427012069e-05, 'weight_decay': 5.503363365456109e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03477689135878313
INFO:model_data_nn.py:Best trial testing loss: 0.01742931927331729
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-29_18-41-39_094787_365373/artifacts/2024-07-29_18-41-46/train_fnn_2024-07-29_18-41-46/driver_artifacts/train_fnn_e1d5b_00020_20_dropout_rate=0.4900,embedding_dim=1,hidden_dim=85,lr=0.0000,num_layers=4,weight_decay=0.0000_2024-07-29_18-41-46
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 14659, 'embedding_dim': 1, 'dropout_rate': 0.49, 'lr': 1.036720427012069e-05, 'weight_decay': 5.503363365456109e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03596373869681347, 'avg_test_loss': 0.016225848670705447}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.035126524516436636, 'avg_test_loss': 0.016220077109390753}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.03510993404002798, 'avg_test_loss': 0.016226056965292168}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03509253081879949, 'avg_test_loss': 0.016224844583635732}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03504721204464656, 'avg_test_loss': 0.016224729048658196}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.035003845564352355, 'avg_test_loss': 0.01623493104233441}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.034961842362688234, 'avg_test_loss': 0.016217944245647146}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03491478529621036, 'avg_test_loss': 0.016217924500654585}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.034865052633280866, 'avg_test_loss': 0.01622768784974548}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.034812520753040296, 'avg_test_loss': 0.01621068249427965}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.034779557674892304, 'avg_test_loss': 0.016202452072334714}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.034747791513628536, 'avg_test_loss': 0.016208341106994224}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.034722590682719524, 'avg_test_loss': 0.016202518505088404}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.034680964731231036, 'avg_test_loss': 0.016185505176141916}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.03466097109027769, 'avg_test_loss': 0.016193446104334864}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.03464169655069956, 'avg_test_loss': 0.01618593106423141}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.03462108313464972, 'avg_test_loss': 0.016182561472675997}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.034593754996606024, 'avg_test_loss': 0.016190708780341644}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.03458176151110308, 'avg_test_loss': 0.016174450676492327}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.034564916308387074, 'avg_test_loss': 0.016174253770633196}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.03455422742423126, 'avg_test_loss': 0.0161948299337126}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.03453399098415477, 'avg_test_loss': 0.016186789277089563}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.03451699675118399, 'avg_test_loss': 0.016162612761350566}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.03450873171954895, 'avg_test_loss': 0.01616801514746991}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.034494395376906364, 'avg_test_loss': 0.016170428728353274}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.03448818219656633, 'avg_test_loss': 0.016173669531769696}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.03446688679414641, 'avg_test_loss': 0.016162960944523158}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.03444688088734196, 'avg_test_loss': 0.01615343699988965}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.034434685845414426, 'avg_test_loss': 0.016172324175494468}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.034415712653586304, 'avg_test_loss': 0.016167310971013066}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.03441492811688696, 'avg_test_loss': 0.016164966763525475}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.034390944172394904, 'avg_test_loss': 0.016143293996435732}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.03435353290919901, 'avg_test_loss': 0.016154073311132826}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.034365555360441086, 'avg_test_loss': 0.016141856181353005}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.03432817784008139, 'avg_test_loss': 0.01614588521756041}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.034339883006607834, 'avg_test_loss': 0.016144176798117815}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.03430546242800182, 'avg_test_loss': 0.016139199975734903}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.03430026771242848, 'avg_test_loss': 0.0161374884648022}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.03429320749279554, 'avg_test_loss': 0.01613847805734452}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.0342770204760521, 'avg_test_loss': 0.016130146602700523}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.03426518707100069, 'avg_test_loss': 0.016132865339295793}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.034233618677453684, 'avg_test_loss': 0.016133005987189798}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.03421634225886445, 'avg_test_loss': 0.01611942994776784}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.034209248636132054, 'avg_test_loss': 0.016128670019974096}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.03418609297851136, 'avg_test_loss': 0.016120804174148528}
INFO:model_data_nn.py:Epoch 46/50, metrics: {'avg_train_loss': 0.034175144653071164, 'avg_test_loss': 0.01611246542603245}
INFO:model_data_nn.py:Epoch 47/50, metrics: {'avg_train_loss': 0.03414658061102358, 'avg_test_loss': 0.016114475851265592}
INFO:model_data_nn.py:Epoch 48/50, metrics: {'avg_train_loss': 0.03414940186219212, 'avg_test_loss': 0.016121544273004947}
INFO:model_data_nn.py:Epoch 49/50, metrics: {'avg_train_loss': 0.03413548444774201, 'avg_test_loss': 0.016109604186947228}
INFO:model_data_nn.py:Epoch 50/50, metrics: {'avg_train_loss': 0.034119107948806716, 'avg_test_loss': 0.016115312611507716}
INFO:main_restricted_month.py:Making prediction for data in year: 2006
INFO:main_restricted_month.py:Prediction data shape: (49969,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2006: 0.12695722438470042
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  49969.000000  49969.000000
mean       0.013986      0.011106
std        0.127375      0.015207
min       -0.879154     -0.111726
25%       -0.043374      0.005067
50%        0.006972      0.012514
75%        0.062176      0.016419
max        4.022988      0.179859
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]
INFO:transform_data_nn.py:Train_data: (1309226, 161)

INFO:transform_data_nn.py:Test data years: [2006]
INFO:transform_data_nn.py:Test_data: (49969, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]
INFO:transform_data_nn.py:Retrain_data: (1359195, 161)

INFO:transform_data_nn.py:Prediction data years: [2007]
INFO:transform_data_nn.py:Prediction_data: (48760, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1309226, 138])
            y_train_tf: torch.Size([1309226])

            x_test_tf: torch.Size([49969, 138])
            y_test_tf: torch.Size([49969])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1359195, 138])
            y_retrain_tf: torch.Size([1359195])

            x_prediction_tf: torch.Size([48760, 138])
            y_prediction_tf: torch.Size([48760])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.6113e-01,  8.6921e-01,  8.3247e-02, -1.5617e+00, -1.3101e-01,
        -8.2008e-01, -1.4661e-01, -3.4940e-01,  4.5369e-01, -1.7471e-01,
        -6.9861e-01,  8.4852e-02, -7.1234e-01, -4.8728e-01,  9.1464e-02,
         4.9662e-01, -1.3875e-01,  2.0923e-01, -8.5714e-02,  5.6430e-01,
        -4.0451e-01, -3.8567e-02, -1.5036e-01,  3.3623e-03, -8.5171e-02,
        -3.3687e-01, -5.9039e-01, -5.8975e-02,  4.5588e-01,  1.4270e+00,
         3.5175e-01, -1.3346e-01,  7.6288e-01,  2.8333e-01, -2.4230e-01,
        -2.4027e-01,  1.0319e-01,  8.8735e-01, -2.8204e-02, -1.1453e+00,
        -2.8798e-01,  2.5886e-01,  3.2041e-01,  5.1345e-02, -1.7562e-01,
        -7.4962e-01,  9.0359e-02, -7.0725e-02, -3.7065e-01, -1.5356e-01,
        -8.3832e-01,  4.3775e-01, -4.7691e-01,  9.1556e-02, -3.2977e-02,
         4.9736e-01, -6.1568e-01, -1.7859e-01, -2.4769e-01, -4.3717e-02,
         6.3086e-03, -3.0552e-01,  5.6776e-02,  2.2537e-01,  7.0339e-02,
        -1.9895e-01,  7.0253e-01, -2.6433e-01,  6.3479e-01, -5.6612e-01,
        -3.3409e-01, -1.6582e-01, -2.8274e-02, -8.9694e-01,  1.7749e-01,
         7.1680e-01,  8.3223e-01, -1.1396e+00,  2.8482e-01,  1.7998e-02,
        -8.0547e-01,  1.8180e-01,  3.4050e-01, -1.5373e-01, -5.6040e-01,
        -4.3361e-01, -5.3213e-01, -2.7393e-01,  6.9559e-02,  1.1820e-01,
        -5.5683e-01, -1.3400e+00,  2.2660e-01, -5.5511e-16, -5.5511e-16,
         2.9406e+00, -7.8242e-02,  2.4181e+00, -3.0156e+00,  8.5711e-01,
        -4.3804e-01,  1.5598e-01,  7.2495e-02,  5.4332e-02,  2.5820e-01,
         1.4597e-01, -1.2190e-01,  2.3968e-01,  2.6085e-01, -1.0186e+00,
         7.0931e-01,  0.0000e+00,  3.4336e-01, -1.1806e-02,  1.0104e-01,
        -2.2675e-03,  2.7799e-01, -2.3447e-01,  1.8827e-02, -5.5674e-01,
         1.3076e-01, -2.9067e-01, -3.9073e-01,  3.5030e-01,  3.7122e-01,
        -4.1112e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5414]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-8.9474e-01,  2.8536e-01, -6.7077e-01,  1.3413e+00, -5.3007e-01,
        -4.4020e-01, -1.0152e+00, -7.7246e-01, -2.3279e-01, -3.2072e-02,
        -7.3445e-01, -7.6232e-02, -7.1234e-01,  6.5880e-02, -3.1824e-01,
         2.5390e-01, -1.7928e-01,  5.9303e-02, -8.5714e-02, -3.7015e-01,
        -5.0705e-01, -1.1866e-01, -5.9825e-01,  3.8481e-01, -8.0931e-03,
        -6.2534e-01, -6.4134e-01, -5.8975e-02, -5.4517e-01, -5.3306e-01,
         6.7362e-01,  2.2245e-01,  3.7521e-01,  2.8333e-01, -6.5769e-01,
        -5.2043e-01, -5.6569e-01, -6.9856e-01, -3.8976e-01, -3.0058e-02,
        -2.5437e-01, -1.2535e-01, -2.9202e-01, -1.2949e-01, -5.6211e-01,
        -6.0555e-01,  4.2688e-01,  6.7028e-02, -4.0485e-01, -6.6758e-03,
        -8.3832e-01, -7.0583e-01, -4.7691e-01, -6.7535e-01, -7.3426e-01,
         2.9248e-01, -9.8165e-01, -3.6780e-01,  3.4693e-01, -2.6007e-01,
         2.7855e+00,  6.4741e-02,  2.2594e-01,  5.1978e-01, -3.9597e-02,
        -9.2325e-02,  5.4421e-02,  1.5312e+00,  6.3479e-01, -6.5327e-01,
        -3.3409e-01, -1.6582e-01, -2.8274e-02, -6.6116e-01,  3.3327e-02,
        -4.1219e-01,  8.3223e-01, -2.4484e-01,  1.4876e+00,  1.7998e-02,
        -8.0547e-01, -3.1663e-01,  1.6372e-01,  1.7417e-01, -2.5871e-01,
        -3.1913e-01, -4.4032e-01, -3.3311e-01, -4.3807e-01, -7.4301e-01,
        -1.7090e-01, -3.4201e-01,  2.2660e-01, -5.5511e-16, -5.5511e-16,
        -2.7356e-01, -5.1306e-01, -5.2007e-01, -1.0885e+00, -9.9109e-02,
        -4.4663e-01, -7.1573e-01, -2.5089e+00, -1.1079e+00,  1.6587e+00,
        -2.7107e-01, -1.2035e-01,  2.3968e-01,  6.0275e-01, -2.0169e-01,
        -8.4722e-01,  0.0000e+00,  1.4566e-01,  5.7305e+00,  1.0104e-01,
        -2.2675e-03, -8.9813e-03, -4.4609e-01,  1.8827e-02,  1.0442e-01,
         8.6150e-01,  7.0160e-02, -4.6561e-01,  2.5520e-01,  2.8668e-01,
        -3.3356e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2703]), tensor(-0.0165))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.5006e-01,  8.7844e-01,  7.7563e-02, -1.5798e+00, -1.3057e-01,
        -8.1671e-01, -1.4730e-01, -3.4981e-01,  4.7025e-01, -1.7832e-01,
        -7.0167e-01,  7.8657e-02, -7.1523e-01, -5.0492e-01,  9.2792e-02,
         5.0093e-01, -1.3733e-01,  2.0394e-01, -8.6924e-02,  5.7075e-01,
        -4.1242e-01, -5.1528e-02, -1.6169e-01,  1.8403e-03, -9.1186e-02,
        -3.3761e-01, -5.9211e-01, -6.2649e-02,  4.2918e-01,  1.4452e+00,
         3.5308e-01, -1.3524e-01,  7.8139e-01,  2.8892e-01, -2.3757e-01,
        -2.4368e-01,  1.1018e-01,  8.9685e-01, -2.8071e-02, -1.1352e+00,
        -2.8382e-01,  2.6395e-01,  3.2870e-01,  5.5903e-02, -1.7503e-01,
        -7.4311e-01,  9.0758e-02, -7.1734e-02, -3.8137e-01, -1.5337e-01,
        -8.3882e-01,  4.1388e-01, -4.7629e-01,  9.0353e-02, -3.2252e-02,
         4.9678e-01, -6.0751e-01, -1.8664e-01, -2.4774e-01, -4.0273e-02,
         2.5331e-03, -3.0547e-01,  4.9496e-02,  2.2075e-01,  6.5426e-02,
        -2.0126e-01,  7.0950e-01, -2.6672e-01,  6.3261e-01, -5.6815e-01,
        -3.3737e-01, -1.6844e-01, -2.7734e-02, -8.8949e-01,  1.7333e-01,
         7.3339e-01,  8.4408e-01, -1.1504e+00,  2.8436e-01,  1.8712e-02,
        -8.2864e-01,  1.7879e-01,  3.5586e-01, -1.2801e-01, -5.6277e-01,
        -4.3738e-01, -5.3675e-01, -2.7196e-01,  7.3494e-02,  1.1248e-01,
        -5.6554e-01, -1.3398e+00,  2.3109e-01, -6.6613e-16, -6.6613e-16,
         3.0024e+00, -4.4696e-02,  2.4697e+00, -2.9154e+00,  8.8114e-01,
        -4.3208e-01,  1.6238e-01,  4.5517e-02,  5.8457e-02,  2.4010e-01,
         1.4454e-01, -1.2760e-01,  2.2516e-01,  2.4247e-01, -1.0289e+00,
         7.4384e-01,  3.1974e-14,  3.4003e-01, -2.1572e-02,  7.8042e-02,
        -2.7126e-04,  2.9317e-01, -2.3464e-01,  1.8628e-02, -5.6655e-01,
         1.3309e-01, -2.8190e-01, -3.9055e-01,  3.5245e-01,  3.6877e-01,
        -4.1127e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5520]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([ 7.5640e-02, -6.0899e-01, -4.7656e-01,  1.3151e+00, -4.1676e-01,
        -7.9482e-01, -8.0104e-01, -7.0238e-01, -2.3762e-01,  3.9605e-02,
        -7.1819e-01, -1.4491e-02, -7.1523e-01,  9.7212e-01,  6.8541e-01,
         9.0537e-01, -1.9123e-01, -1.0366e-01, -8.6924e-02,  2.3492e-01,
         6.0267e-01, -1.2533e-01, -8.5248e-02,  3.3044e-01, -4.5337e-03,
        -5.9750e-01, -6.5037e-01, -6.2649e-02, -6.7135e-01, -5.3104e-01,
        -1.6959e-01, -7.5476e-02,  4.5879e-01,  2.8892e-01, -5.8691e-01,
        -4.0357e-01, -4.0561e-01, -6.9853e-01, -5.7551e-01, -2.0077e-01,
         3.1642e+00,  2.6176e-01, -1.4028e-01, -2.2937e-01, -4.3881e-01,
        -7.6969e-01,  1.5868e-01, -3.1763e-01,  3.3060e-01,  7.0377e-01,
         7.5255e-01, -6.5558e-01, -4.7629e-01, -6.7539e-01, -7.3477e-01,
         3.8627e-01, -9.7620e-01, -3.9551e-01, -3.5316e-02, -3.5351e-01,
         3.4349e-02, -3.4853e-01, -8.7784e-02,  6.3240e-01, -4.1993e-02,
        -2.6131e-01, -5.0610e-01, -5.5013e-01,  1.3051e+00, -6.8646e-01,
        -3.3737e-01, -1.6844e-01, -2.7734e-02, -7.6835e-01,  1.0422e-01,
        -2.3397e-01,  8.4408e-01, -3.0169e-01,  1.4924e+00,  1.8712e-02,
        -8.2864e-01, -1.4271e-01,  1.4200e-01,  2.6880e+00, -5.2597e-01,
        -3.4234e-01, -4.6121e-01, -3.1954e-01, -3.2065e-01,  4.2418e-01,
        -6.1329e-01, -1.3398e+00,  2.3109e-01, -6.6613e-16, -6.6613e-16,
        -4.0586e-01, -1.5375e+00, -1.6775e-01, -1.4940e+00, -2.2342e-01,
        -4.5881e-01, -6.3743e-01,  1.8065e+00, -1.8309e+00,  2.9134e+00,
        -7.2508e-01, -1.3487e-01,  2.2516e-01,  1.6039e+00,  6.9377e-02,
        -9.5704e-01,  3.1974e-14,  1.6840e-01,  8.3413e+00,  7.8042e-02,
        -2.7126e-04, -1.1795e-01, -3.5446e-01,  1.8628e-02,  1.2330e-01,
         1.0068e+00,  2.4945e-01, -3.4020e-01,  3.3708e-01,  3.8218e-01,
        -2.9567e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2658]), tensor(0.0233))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]
INFO:main_restricted_month.py:Testing data year: 2006
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 14659
            device: cpu
            
2024-07-30 00:25:13,764	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-30 00:25:13,797	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-30 00:25:13,829	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f56274661af3545d.zip' (1.46MiB) to Ray cluster...
2024-07-30 00:25:13,833	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f56274661af3545d.zip'.
2024-07-30 00:25:18,676	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-30 01:57:00,174	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_00-25-18' in 0.2014s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 14659, 'embedding_dim': 1, 'dropout_rate': 0.49, 'lr': 1.036720427012069e-05, 'weight_decay': 5.503363365456109e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03411384272159345
INFO:model_data_nn.py:Best trial testing loss: 0.01609049927593518
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-30_00-25-11_438974_365373/artifacts/2024-07-30_00-25-18/train_fnn_2024-07-30_00-25-18/driver_artifacts/train_fnn_df882_00020_20_dropout_rate=0.4900,embedding_dim=1,hidden_dim=85,lr=0.0000,num_layers=4,weight_decay=0.0000_2024-07-30_00-25-18
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 14929, 'embedding_dim': 1, 'dropout_rate': 0.49, 'lr': 1.036720427012069e-05, 'weight_decay': 5.503363365456109e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03515467354887908, 'avg_test_loss': 0.017790669188810282}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.03442287800927162, 'avg_test_loss': 0.017825858812630078}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.034414521091202716, 'avg_test_loss': 0.017789079943058273}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03438117906933769, 'avg_test_loss': 0.017777960535427288}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03435535442239923, 'avg_test_loss': 0.017740431454966427}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03430824973238088, 'avg_test_loss': 0.017720185612264797}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.034257458685605674, 'avg_test_loss': 0.01770428763464181}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.034201725825499164, 'avg_test_loss': 0.017682499652532886}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03415853567052205, 'avg_test_loss': 0.01764951650789032}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03410969802022506, 'avg_test_loss': 0.01767208242606802}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03407961747069966, 'avg_test_loss': 0.017666523681838662}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.034060611727038205, 'avg_test_loss': 0.01767307538673614}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.03402666943337218, 'avg_test_loss': 0.017671321378776368}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.033998635090425874, 'avg_test_loss': 0.017632846029969104}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.033964216673551303, 'avg_test_loss': 0.0176551838086434}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.03395820893899356, 'avg_test_loss': 0.017666754825529582}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.03394085300808024, 'avg_test_loss': 0.017668444845395218}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.03392005605367997, 'avg_test_loss': 0.017672546495734826}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.03390491973717572, 'avg_test_loss': 0.01764717234177588}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.03388816127718903, 'avg_test_loss': 0.01769916856572218}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.033880480963260365, 'avg_test_loss': 0.017636710591186475}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.03386065442781965, 'avg_test_loss': 0.0176930891351745}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.03383788787906305, 'avg_test_loss': 0.0176739792117673}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.03381619445489947, 'avg_test_loss': 0.017666772711017412}
INFO:model_data_nn.py:Early stopping at epoch 24
INFO:main_restricted_month.py:Making prediction for data in year: 2007
INFO:main_restricted_month.py:Prediction data shape: (48760,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2007: 0.13291925479669298
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  48760.000000  48760.000000
mean      -0.004704      0.008599
std        0.132528      0.012190
min       -0.952684     -0.071197
25%       -0.062474      0.002948
50%       -0.005420      0.011313
75%        0.048320      0.014125
max        5.801008      0.142351
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]
INFO:transform_data_nn.py:Train_data: (1359195, 161)

INFO:transform_data_nn.py:Test data years: [2007]
INFO:transform_data_nn.py:Test_data: (48760, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:transform_data_nn.py:Retrain_data: (1407955, 161)

INFO:transform_data_nn.py:Prediction data years: [2008]
INFO:transform_data_nn.py:Prediction_data: (47807, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1359195, 138])
            y_train_tf: torch.Size([1359195])

            x_test_tf: torch.Size([48760, 138])
            y_test_tf: torch.Size([48760])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1407955, 138])
            y_retrain_tf: torch.Size([1407955])

            x_prediction_tf: torch.Size([47807, 138])
            y_prediction_tf: torch.Size([47807])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.5006e-01,  8.7844e-01,  7.7563e-02, -1.5798e+00, -1.3057e-01,
        -8.1671e-01, -1.4730e-01, -3.4981e-01,  4.7025e-01, -1.7832e-01,
        -7.0167e-01,  7.8657e-02, -7.1523e-01, -5.0492e-01,  9.2792e-02,
         5.0093e-01, -1.3733e-01,  2.0394e-01, -8.6924e-02,  5.7075e-01,
        -4.1242e-01, -5.1528e-02, -1.6169e-01,  1.8403e-03, -9.1186e-02,
        -3.3761e-01, -5.9211e-01, -6.2649e-02,  4.2918e-01,  1.4452e+00,
         3.5308e-01, -1.3524e-01,  7.8139e-01,  2.8892e-01, -2.3757e-01,
        -2.4368e-01,  1.1018e-01,  8.9685e-01, -2.8071e-02, -1.1352e+00,
        -2.8382e-01,  2.6395e-01,  3.2870e-01,  5.5903e-02, -1.7503e-01,
        -7.4311e-01,  9.0758e-02, -7.1734e-02, -3.8137e-01, -1.5337e-01,
        -8.3882e-01,  4.1388e-01, -4.7629e-01,  9.0353e-02, -3.2252e-02,
         4.9678e-01, -6.0751e-01, -1.8664e-01, -2.4774e-01, -4.0273e-02,
         2.5331e-03, -3.0547e-01,  4.9496e-02,  2.2075e-01,  6.5426e-02,
        -2.0126e-01,  7.0950e-01, -2.6672e-01,  6.3261e-01, -5.6815e-01,
        -3.3737e-01, -1.6844e-01, -2.7734e-02, -8.8949e-01,  1.7333e-01,
         7.3339e-01,  8.4408e-01, -1.1504e+00,  2.8436e-01,  1.8712e-02,
        -8.2864e-01,  1.7879e-01,  3.5586e-01, -1.2801e-01, -5.6277e-01,
        -4.3738e-01, -5.3675e-01, -2.7196e-01,  7.3494e-02,  1.1248e-01,
        -5.6554e-01, -1.3398e+00,  2.3109e-01, -6.6613e-16, -6.6613e-16,
         3.0024e+00, -4.4696e-02,  2.4697e+00, -2.9154e+00,  8.8114e-01,
        -4.3208e-01,  1.6238e-01,  4.5517e-02,  5.8457e-02,  2.4010e-01,
         1.4454e-01, -1.2760e-01,  2.2516e-01,  2.4247e-01, -1.0289e+00,
         7.4384e-01,  3.1974e-14,  3.4003e-01, -2.1572e-02,  7.8042e-02,
        -2.7126e-04,  2.9317e-01, -2.3464e-01,  1.8628e-02, -5.6655e-01,
         1.3309e-01, -2.8190e-01, -3.9055e-01,  3.5245e-01,  3.6877e-01,
        -4.1127e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5520]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([ 7.5640e-02, -6.0899e-01, -4.7656e-01,  1.3151e+00, -4.1676e-01,
        -7.9482e-01, -8.0104e-01, -7.0238e-01, -2.3762e-01,  3.9605e-02,
        -7.1819e-01, -1.4491e-02, -7.1523e-01,  9.7212e-01,  6.8541e-01,
         9.0537e-01, -1.9123e-01, -1.0366e-01, -8.6924e-02,  2.3492e-01,
         6.0267e-01, -1.2533e-01, -8.5248e-02,  3.3044e-01, -4.5337e-03,
        -5.9750e-01, -6.5037e-01, -6.2649e-02, -6.7135e-01, -5.3104e-01,
        -1.6959e-01, -7.5476e-02,  4.5879e-01,  2.8892e-01, -5.8691e-01,
        -4.0357e-01, -4.0561e-01, -6.9853e-01, -5.7551e-01, -2.0077e-01,
         3.1642e+00,  2.6176e-01, -1.4028e-01, -2.2937e-01, -4.3881e-01,
        -7.6969e-01,  1.5868e-01, -3.1763e-01,  3.3060e-01,  7.0377e-01,
         7.5255e-01, -6.5558e-01, -4.7629e-01, -6.7539e-01, -7.3477e-01,
         3.8627e-01, -9.7620e-01, -3.9551e-01, -3.5316e-02, -3.5351e-01,
         3.4349e-02, -3.4853e-01, -8.7784e-02,  6.3240e-01, -4.1993e-02,
        -2.6131e-01, -5.0610e-01, -5.5013e-01,  1.3051e+00, -6.8646e-01,
        -3.3737e-01, -1.6844e-01, -2.7734e-02, -7.6835e-01,  1.0422e-01,
        -2.3397e-01,  8.4408e-01, -3.0169e-01,  1.4924e+00,  1.8712e-02,
        -8.2864e-01, -1.4271e-01,  1.4200e-01,  2.6880e+00, -5.2597e-01,
        -3.4234e-01, -4.6121e-01, -3.1954e-01, -3.2065e-01,  4.2418e-01,
        -6.1329e-01, -1.3398e+00,  2.3109e-01, -6.6613e-16, -6.6613e-16,
        -4.0586e-01, -1.5375e+00, -1.6775e-01, -1.4940e+00, -2.2342e-01,
        -4.5881e-01, -6.3743e-01,  1.8065e+00, -1.8309e+00,  2.9134e+00,
        -7.2508e-01, -1.3487e-01,  2.2516e-01,  1.6039e+00,  6.9377e-02,
        -9.5704e-01,  3.1974e-14,  1.6840e-01,  8.3413e+00,  7.8042e-02,
        -2.7126e-04, -1.1795e-01, -3.5446e-01,  1.8628e-02,  1.2330e-01,
         1.0068e+00,  2.4945e-01, -3.4020e-01,  3.3708e-01,  3.8218e-01,
        -2.9567e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2658]), tensor(0.0233))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.4123e-01,  8.8631e-01,  7.1884e-02, -1.5963e+00, -1.2988e-01,
        -8.1493e-01, -1.4784e-01, -3.5044e-01,  4.8494e-01, -1.8105e-01,
        -7.0387e-01,  7.4739e-02, -7.1867e-01, -5.1933e-01,  9.3083e-02,
         5.0552e-01, -1.3518e-01,  2.0184e-01, -8.9291e-02,  5.7743e-01,
        -4.2096e-01, -5.2113e-02, -1.7388e-01,  2.8521e-03, -9.5203e-02,
        -3.3818e-01, -5.9339e-01, -6.4914e-02,  4.0576e-01,  1.4620e+00,
         3.5585e-01, -1.3656e-01,  7.9712e-01,  2.9356e-01, -2.3266e-01,
        -2.4634e-01,  1.1436e-01,  9.0324e-01, -2.7283e-02, -1.1237e+00,
        -2.7994e-01,  2.7349e-01,  3.3532e-01,  5.8899e-02, -1.7454e-01,
        -7.3735e-01,  9.3254e-02, -6.9056e-02, -3.8341e-01, -1.5377e-01,
        -8.3869e-01,  3.9100e-01, -4.7565e-01,  9.0275e-02, -2.8986e-02,
         4.9662e-01, -5.9960e-01, -1.9345e-01, -2.4803e-01, -3.7506e-02,
        -6.9434e-04, -3.0570e-01,  4.6419e-02,  2.1592e-01,  6.3170e-02,
        -2.0195e-01,  7.1503e-01, -2.6833e-01,  6.3183e-01, -5.6992e-01,
        -3.4024e-01, -1.7085e-01, -2.7676e-02, -8.8375e-01,  1.7102e-01,
         7.5025e-01,  8.5434e-01, -1.1605e+00,  2.8447e-01,  1.9116e-02,
        -8.6020e-01,  1.7818e-01,  3.7074e-01, -1.0326e-01, -5.6656e-01,
        -4.4216e-01, -5.4146e-01, -2.6953e-01,  7.7758e-02,  1.0843e-01,
        -5.7521e-01, -1.3403e+00,  2.3529e-01, -1.9984e-15, -1.9984e-15,
         3.0597e+00,  6.7297e-03,  2.5184e+00, -2.8415e+00,  9.0332e-01,
        -4.3563e-01,  1.6853e-01,  2.9109e-02,  5.3051e-02,  2.2130e-01,
         1.3301e-01, -1.3171e-01,  2.2382e-01,  3.4323e-01, -1.0508e+00,
         7.7589e-01,  3.5527e-14,  3.3807e-01, -7.2559e-03,  5.3484e-02,
         5.2950e-03,  3.0693e-01, -2.3542e-01,  1.8351e-02, -5.7371e-01,
         1.3508e-01, -2.7369e-01, -3.8936e-01,  3.5446e-01,  3.6620e-01,
        -4.1113e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5606]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-2.7943e-01,  7.7531e-01, -6.4472e-01,  1.2897e+00, -7.5690e-01,
        -3.0547e-01, -3.8866e-01, -5.0463e-01, -2.7411e-01, -4.1117e-02,
        -6.0953e-01, -9.8183e-03, -1.8060e-02, -2.5756e-01, -5.6119e-01,
        -8.4235e-01, -1.7012e-01, -5.0679e-01, -8.9291e-02, -8.6728e-01,
        -8.8892e-01, -1.2913e-01,  1.7832e-01, -1.9660e-01, -4.0706e-01,
        -2.6660e-01, -6.6176e-01, -6.4914e-02, -6.3924e-01,  7.1453e-01,
         1.9307e-01, -3.1002e-02,  3.6506e-01,  2.9356e-01, -5.7415e-01,
        -4.5880e-01, -1.5480e+00, -6.9877e-01, -9.8372e-01, -2.3487e-01,
        -1.8823e-01, -1.3357e-01, -1.8127e+00, -4.1985e-01, -7.7199e-01,
        -4.6519e-01,  3.5896e-01, -9.5155e-02,  3.6774e-01, -2.4064e-01,
        -4.2954e-02, -5.7194e-01, -4.7565e-01, -6.7704e-01, -2.8986e-02,
         1.6750e-01, -9.7081e-01, -3.5513e-01,  1.0076e+00,  4.0178e-01,
         4.4269e-01,  1.0287e+00, -1.4234e-01,  1.9766e-01, -4.2911e-02,
        -3.0277e-01,  6.5446e-01, -1.1146e+00, -4.1720e-02, -5.1963e-01,
        -3.4024e-01, -1.7085e-01, -2.7676e-02, -3.0577e-01,  2.1065e-01,
        -2.6052e-01,  8.5434e-01, -6.6488e-01,  1.4957e+00,  1.9116e-02,
        -8.6020e-01, -8.6404e-01, -2.6620e-01,  7.9185e-01, -5.0705e-01,
        -3.1222e-01, -4.4778e-01, -2.6698e-01, -3.3567e-01,  2.4986e-01,
        -5.9944e-01, -9.9551e-01,  2.3529e-01, -1.9984e-15, -1.9984e-15,
        -5.3086e-01, -2.9218e+00, -8.4928e-01, -4.1238e-01,  4.7547e-01,
         1.8191e-02, -5.8160e-01, -9.7670e-01,  3.0776e+00,  1.9026e+00,
         2.4192e-01, -1.5185e-01,  2.2382e-01,  1.1379e+00, -1.8054e-01,
        -4.4070e-01,  3.5527e-14,  2.4860e-01,  4.5580e+00,  5.3484e-02,
         5.2950e-03, -1.4492e-01, -4.9493e-01,  1.8351e-02, -2.5470e-01,
        -1.3551e+00, -4.7874e-02, -1.2726e-01,  3.6582e-01,  2.8470e-01,
        -2.9134e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2625]), tensor(-0.0061))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]
INFO:main_restricted_month.py:Testing data year: 2007
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 14929
            device: cpu
            
2024-07-30 05:15:00,045	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-30 05:15:00,080	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-30 05:15:00,115	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f56274661af3545d.zip' (1.46MiB) to Ray cluster...
2024-07-30 05:15:00,118	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f56274661af3545d.zip'.
2024-07-30 05:15:04,805	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-30 08:57:58,795	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_05-15-04' in 0.2457s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 195, 'num_layers': 3, 'num_embeddings': 14929, 'embedding_dim': 10, 'dropout_rate': 0.47, 'lr': 2.153464142964256e-06, 'weight_decay': 1.8841368421034387e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03381234478857167
INFO:model_data_nn.py:Best trial testing loss: 0.017706047914668017
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-30_05-14-57_676383_365373/artifacts/2024-07-30_05-15-04/train_fnn_2024-07-30_05-15-04/driver_artifacts/train_fnn_5a78e_00065_65_dropout_rate=0.4700,embedding_dim=10,hidden_dim=195,lr=0.0000,num_layers=3,weight_decay=0.0000_2024-07-30_05-15-05
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 195, 'num_layers': 3, 'num_embeddings': 15183, 'embedding_dim': 10, 'dropout_rate': 0.47, 'lr': 2.153464142964256e-06, 'weight_decay': 1.8841368421034387e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03845349878119305, 'avg_test_loss': 0.0427888620444081}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.034359026387778366, 'avg_test_loss': 0.042858451641622275}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.03389579927102155, 'avg_test_loss': 0.042895731759298755}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03382074849563651, 'avg_test_loss': 0.04281630355632868}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03379617538190955, 'avg_test_loss': 0.042878666145844235}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03376998893747275, 'avg_test_loss': 0.04282707236694743}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03374856703967618, 'avg_test_loss': 0.04280509714815152}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03372410199494863, 'avg_test_loss': 0.04303519323984363}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03370051086372273, 'avg_test_loss': 0.04280115555662667}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03368329008071768, 'avg_test_loss': 0.04271786618688539}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03365291818955236, 'avg_test_loss': 0.042822229925922085}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.03362950945698487, 'avg_test_loss': 0.04295404703534611}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.03362105502131056, 'avg_test_loss': 0.04290453513705208}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.033595840666294945, 'avg_test_loss': 0.04280732072630481}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.03357462891582823, 'avg_test_loss': 0.04308713785368934}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.033570129177490755, 'avg_test_loss': 0.042937625133478576}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.03353973043102517, 'avg_test_loss': 0.04320241398972221}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.033531331849919466, 'avg_test_loss': 0.042842978748731025}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.03350881479788487, 'avg_test_loss': 0.042778883873044925}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.03350644655745815, 'avg_test_loss': 0.04286914193439216}
INFO:model_data_nn.py:Early stopping at epoch 20
INFO:main_restricted_month.py:Making prediction for data in year: 2008
INFO:main_restricted_month.py:Prediction data shape: (47807,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2008: 0.20704696374436468
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  47807.000000  47807.000000
mean      -0.043596      0.013556
std        0.200372      0.015738
min       -0.944667     -0.048180
25%       -0.142140      0.004528
50%       -0.035885      0.012588
75%        0.051560      0.020295
max        4.900000      0.166498
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:transform_data_nn.py:Train_data: (1407955, 161)

INFO:transform_data_nn.py:Test data years: [2008]
INFO:transform_data_nn.py:Test_data: (47807, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:transform_data_nn.py:Retrain_data: (1455762, 161)

INFO:transform_data_nn.py:Prediction data years: [2009]
INFO:transform_data_nn.py:Prediction_data: (46521, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1407955, 138])
            y_train_tf: torch.Size([1407955])

            x_test_tf: torch.Size([47807, 138])
            y_test_tf: torch.Size([47807])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1455762, 138])
            y_retrain_tf: torch.Size([1455762])

            x_prediction_tf: torch.Size([46521, 138])
            y_prediction_tf: torch.Size([46521])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.4123e-01,  8.8631e-01,  7.1884e-02, -1.5963e+00, -1.2988e-01,
        -8.1493e-01, -1.4784e-01, -3.5044e-01,  4.8494e-01, -1.8105e-01,
        -7.0387e-01,  7.4739e-02, -7.1867e-01, -5.1933e-01,  9.3083e-02,
         5.0552e-01, -1.3518e-01,  2.0184e-01, -8.9291e-02,  5.7743e-01,
        -4.2096e-01, -5.2113e-02, -1.7388e-01,  2.8521e-03, -9.5203e-02,
        -3.3818e-01, -5.9339e-01, -6.4914e-02,  4.0576e-01,  1.4620e+00,
         3.5585e-01, -1.3656e-01,  7.9712e-01,  2.9356e-01, -2.3266e-01,
        -2.4634e-01,  1.1436e-01,  9.0324e-01, -2.7283e-02, -1.1237e+00,
        -2.7994e-01,  2.7349e-01,  3.3532e-01,  5.8899e-02, -1.7454e-01,
        -7.3735e-01,  9.3254e-02, -6.9056e-02, -3.8341e-01, -1.5377e-01,
        -8.3869e-01,  3.9100e-01, -4.7565e-01,  9.0275e-02, -2.8986e-02,
         4.9662e-01, -5.9960e-01, -1.9345e-01, -2.4803e-01, -3.7506e-02,
        -6.9434e-04, -3.0570e-01,  4.6419e-02,  2.1592e-01,  6.3170e-02,
        -2.0195e-01,  7.1503e-01, -2.6833e-01,  6.3183e-01, -5.6992e-01,
        -3.4024e-01, -1.7085e-01, -2.7676e-02, -8.8375e-01,  1.7102e-01,
         7.5025e-01,  8.5434e-01, -1.1605e+00,  2.8447e-01,  1.9116e-02,
        -8.6020e-01,  1.7818e-01,  3.7074e-01, -1.0326e-01, -5.6656e-01,
        -4.4216e-01, -5.4146e-01, -2.6953e-01,  7.7758e-02,  1.0843e-01,
        -5.7521e-01, -1.3403e+00,  2.3529e-01, -1.9984e-15, -1.9984e-15,
         3.0597e+00,  6.7297e-03,  2.5184e+00, -2.8415e+00,  9.0332e-01,
        -4.3563e-01,  1.6853e-01,  2.9109e-02,  5.3051e-02,  2.2130e-01,
         1.3301e-01, -1.3171e-01,  2.2382e-01,  3.4323e-01, -1.0508e+00,
         7.7589e-01,  3.5527e-14,  3.3807e-01, -7.2559e-03,  5.3484e-02,
         5.2950e-03,  3.0693e-01, -2.3542e-01,  1.8351e-02, -5.7371e-01,
         1.3508e-01, -2.7369e-01, -3.8936e-01,  3.5446e-01,  3.6620e-01,
        -4.1113e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5606]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-2.7943e-01,  7.7531e-01, -6.4472e-01,  1.2897e+00, -7.5690e-01,
        -3.0547e-01, -3.8866e-01, -5.0463e-01, -2.7411e-01, -4.1117e-02,
        -6.0953e-01, -9.8183e-03, -1.8060e-02, -2.5756e-01, -5.6119e-01,
        -8.4235e-01, -1.7012e-01, -5.0679e-01, -8.9291e-02, -8.6728e-01,
        -8.8892e-01, -1.2913e-01,  1.7832e-01, -1.9660e-01, -4.0706e-01,
        -2.6660e-01, -6.6176e-01, -6.4914e-02, -6.3924e-01,  7.1453e-01,
         1.9307e-01, -3.1002e-02,  3.6506e-01,  2.9356e-01, -5.7415e-01,
        -4.5880e-01, -1.5480e+00, -6.9877e-01, -9.8372e-01, -2.3487e-01,
        -1.8823e-01, -1.3357e-01, -1.8127e+00, -4.1985e-01, -7.7199e-01,
        -4.6519e-01,  3.5896e-01, -9.5155e-02,  3.6774e-01, -2.4064e-01,
        -4.2954e-02, -5.7194e-01, -4.7565e-01, -6.7704e-01, -2.8986e-02,
         1.6750e-01, -9.7081e-01, -3.5513e-01,  1.0076e+00,  4.0178e-01,
         4.4269e-01,  1.0287e+00, -1.4234e-01,  1.9766e-01, -4.2911e-02,
        -3.0277e-01,  6.5446e-01, -1.1146e+00, -4.1720e-02, -5.1963e-01,
        -3.4024e-01, -1.7085e-01, -2.7676e-02, -3.0577e-01,  2.1065e-01,
        -2.6052e-01,  8.5434e-01, -6.6488e-01,  1.4957e+00,  1.9116e-02,
        -8.6020e-01, -8.6404e-01, -2.6620e-01,  7.9185e-01, -5.0705e-01,
        -3.1222e-01, -4.4778e-01, -2.6698e-01, -3.3567e-01,  2.4986e-01,
        -5.9944e-01, -9.9551e-01,  2.3529e-01, -1.9984e-15, -1.9984e-15,
        -5.3086e-01, -2.9218e+00, -8.4928e-01, -4.1238e-01,  4.7547e-01,
         1.8191e-02, -5.8160e-01, -9.7670e-01,  3.0776e+00,  1.9026e+00,
         2.4192e-01, -1.5185e-01,  2.2382e-01,  1.1379e+00, -1.8054e-01,
        -4.4070e-01,  3.5527e-14,  2.4860e-01,  4.5580e+00,  5.3484e-02,
         5.2950e-03, -1.4492e-01, -4.9493e-01,  1.8351e-02, -2.5470e-01,
        -1.3551e+00, -4.7874e-02, -1.2726e-01,  3.6582e-01,  2.8470e-01,
        -2.9134e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2625]), tensor(-0.0061))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.3556e-01,  8.9501e-01,  7.2648e-02, -1.6100e+00, -1.2826e-01,
        -8.2624e-01, -1.4790e-01, -3.5040e-01,  4.7651e-01, -1.7795e-01,
        -7.0519e-01,  7.7076e-02, -7.1684e-01, -5.2199e-01,  9.2188e-02,
         5.0981e-01, -1.3160e-01,  2.0659e-01, -8.5341e-02,  5.8516e-01,
        -4.1586e-01, -5.2675e-02, -1.7384e-01,  5.2328e-03, -9.5722e-02,
        -3.3812e-01, -5.9416e-01, -7.1346e-02,  3.8254e-01,  1.4512e+00,
         3.5313e-01, -1.3439e-01,  7.9474e-01,  2.9877e-01, -2.2688e-01,
        -2.4613e-01,  1.1696e-01,  9.0783e-01, -2.5742e-02, -1.1184e+00,
        -2.7863e-01,  3.0884e-01,  3.4117e-01,  5.2429e-02, -1.7405e-01,
        -7.4253e-01,  1.1172e-01, -5.6634e-02, -3.8354e-01, -1.3762e-01,
        -8.4047e-01,  3.7580e-01, -4.7466e-01,  8.9405e-02, -2.3847e-02,
         4.9529e-01, -5.9135e-01, -1.9021e-01, -2.4711e-01, -3.5894e-02,
         1.6576e-03, -3.0455e-01,  4.9130e-02,  2.1504e-01,  6.3754e-02,
        -2.0142e-01,  7.2637e-01, -2.6723e-01,  6.3338e-01, -5.7095e-01,
        -3.4318e-01, -1.7305e-01, -2.8461e-02, -8.9090e-01,  1.7429e-01,
         7.5424e-01,  8.6411e-01, -1.1693e+00,  2.8316e-01,  1.8770e-02,
        -8.6453e-01,  1.7930e-01,  3.7423e-01, -8.1412e-02, -5.7120e-01,
        -4.4850e-01, -5.4641e-01, -2.6781e-01,  8.2742e-02,  1.1322e-01,
        -5.8305e-01, -1.3411e+00,  2.3982e-01,  3.1086e-15,  3.1086e-15,
         3.1152e+00,  1.0144e-01,  2.5269e+00, -2.8806e+00,  7.9351e-01,
        -3.9410e-01,  1.7615e-01,  1.5259e-02,  4.8479e-02,  2.0858e-01,
         1.2312e-01, -1.3249e-01,  2.3001e-01,  2.6162e-01, -1.0323e+00,
         7.9886e-01, -2.1316e-14,  3.3662e-01, -6.0556e-03,  3.6523e-02,
         3.7105e-03,  3.1943e-01, -2.3633e-01,  1.8116e-02, -5.7116e-01,
         1.3585e-01, -2.6562e-01, -3.8207e-01,  3.5502e-01,  3.6441e-01,
        -4.1081e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5707]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-8.5803e-01,  1.6539e-01, -4.3643e-01,  1.2683e+00,  8.8404e-01,
         2.0447e+00,  4.7068e-01,  1.7437e-01,  2.8753e-01, -1.2035e+00,
        -5.1593e-01, -2.7148e-01, -7.1684e-01,  1.8260e-01, -7.2088e-02,
         5.0390e-03, -2.1394e-01,  1.7922e+00, -8.9696e-03,  1.8514e-01,
         3.5480e+00, -1.3240e+00, -1.6457e-01, -1.4603e-01,  5.0152e-01,
        -7.2687e-01, -5.3528e-01, -7.1346e-02,  4.8230e-01,  3.2680e-01,
        -2.7610e+00,  7.7016e-01,  1.6497e-01, -1.1407e+00, -9.2433e-01,
        -1.1777e-01, -2.1817e-01, -3.2063e-02,  1.5511e+00,  3.4593e-01,
        -2.6977e-01, -1.5618e+00, -9.6209e-02,  1.7594e+00,  3.8833e-01,
         1.5907e+00, -9.0257e-02,  1.2190e+00, -7.7373e-01,  2.4789e+00,
         1.5494e+00,  3.0037e-01, -4.7466e-01, -3.6544e-01, -7.3406e-01,
        -1.1065e-01, -9.0610e-01, -3.1777e-01, -1.7248e-01,  4.4821e-01,
        -2.4596e-02, -2.2277e-01, -2.2090e+00, -4.9511e-01, -6.7366e-01,
        -1.3343e+00, -4.9429e-01,  6.0919e-02,  6.3338e-01, -5.0926e-01,
        -3.4318e-01, -1.7305e-01, -2.8461e-02,  2.5520e+00, -1.9842e-01,
        -5.9180e-02, -1.4246e+00, -1.6058e+00, -1.7063e+00,  1.8770e-02,
         7.8991e-01,  2.7818e-01, -5.8609e-01, -2.9817e-01, -1.5207e-01,
         7.8044e-01,  1.5895e+00, -3.8269e-01,  4.2973e-01, -1.8183e-01,
        -3.0082e-03, -6.7356e-01,  2.3982e-01,  3.1086e-15,  3.1086e-15,
        -5.5960e-02, -1.6395e+00, -1.8837e+00,  6.3985e-01,  5.9574e+00,
         3.2213e+00,  4.8334e-03, -2.3350e+00,  1.0134e-01, -3.4640e+00,
        -3.2624e-01, -2.5987e-01, -2.1428e-01,  1.9968e+00, -1.4542e+00,
        -2.8394e-01, -2.1316e-14,  4.0623e-01, -6.0556e-03, -9.9253e-01,
        -7.1666e-01, -1.1255e+00,  9.5026e-02,  1.8116e-02,  3.2015e-01,
         1.4504e-02, -1.2044e+00, -1.1081e+00,  9.9966e-02, -9.7968e-03,
        -4.1341e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([986]), tensor(-0.3991))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:main_restricted_month.py:Testing data year: 2008
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15183
            device: cpu
            
2024-07-30 12:16:34,582	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-30 12:16:34,636	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-30 12:16:34,671	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_afd8295c58d032a7.zip' (1.46MiB) to Ray cluster...
2024-07-30 12:16:34,676	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_afd8295c58d032a7.zip'.
2024-07-30 12:16:38,773	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-30 16:54:18,028	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_12-16-38' in 0.2236s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 75, 'num_layers': 3, 'num_embeddings': 15183, 'embedding_dim': 1, 'dropout_rate': 0.36, 'lr': 5.3572800696018355e-06, 'weight_decay': 0.00018453732926615942, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.031857989954613995
INFO:model_data_nn.py:Best trial testing loss: 0.041425895823572215
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-30_12-16-32_004701_365373/artifacts/2024-07-30_12-16-38/train_fnn_2024-07-30_12-16-38/driver_artifacts/train_fnn_3eda1_00006_6_dropout_rate=0.3600,embedding_dim=1,hidden_dim=75,lr=0.0000,num_layers=3,weight_decay=0.0002_2024-07-30_12-16-38
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 75, 'num_layers': 3, 'num_embeddings': 15465, 'embedding_dim': 1, 'dropout_rate': 0.36, 'lr': 5.3572800696018355e-06, 'weight_decay': 0.00018453732926615942, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.034814878301195076, 'avg_test_loss': 0.07404128639309307}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.03413152284116921, 'avg_test_loss': 0.07402725254238021}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.034070702871346135, 'avg_test_loss': 0.0736236145727572}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.033977519772012035, 'avg_test_loss': 0.07302086623103718}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03388319678136055, 'avg_test_loss': 0.0724702415535639}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03380755893405013, 'avg_test_loss': 0.07185298804913684}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03375489816592686, 'avg_test_loss': 0.07163405594988592}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03366335812232147, 'avg_test_loss': 0.0716802021661489}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03362965284494084, 'avg_test_loss': 0.07081349204170122}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03358377939010786, 'avg_test_loss': 0.07085229097026435}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.033530448220317956, 'avg_test_loss': 0.07059766695049413}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.033500464037821455, 'avg_test_loss': 0.07049036726414482}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.03344763874761646, 'avg_test_loss': 0.07027689868615021}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.03341807504352614, 'avg_test_loss': 0.07025020345891768}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.03338246305699603, 'avg_test_loss': 0.07022003122212102}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.033351418747335194, 'avg_test_loss': 0.07027158513537095}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.03330005678864653, 'avg_test_loss': 0.06995200728831052}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.03325924948349578, 'avg_test_loss': 0.07011905694290729}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.0332083529628546, 'avg_test_loss': 0.07012122683355167}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.033170623633796505, 'avg_test_loss': 0.06987684779573729}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.03312770011013695, 'avg_test_loss': 0.06988336298322662}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.033080383313138235, 'avg_test_loss': 0.06998417232674962}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.03303378204050158, 'avg_test_loss': 0.06983601778522748}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.03296934494084376, 'avg_test_loss': 0.06964674875770466}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.03297305675069116, 'avg_test_loss': 0.0696182260571619}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.032931451177607825, 'avg_test_loss': 0.0694439667693379}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.03289978749667336, 'avg_test_loss': 0.0695502309678212}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.03285166002785763, 'avg_test_loss': 0.06941416819722096}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.032820373231473604, 'avg_test_loss': 0.0693341689184308}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.03279257797298192, 'avg_test_loss': 0.06932293532859467}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.032744969083241496, 'avg_test_loss': 0.06941148842604218}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.03269824575137896, 'avg_test_loss': 0.0693449638399617}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.0326706999395957, 'avg_test_loss': 0.06925094575189474}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.032651595071848394, 'avg_test_loss': 0.06928602878152915}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.03259665977364406, 'avg_test_loss': 0.06937143255084077}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.03257492260084008, 'avg_test_loss': 0.06955951981520615}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.032542479936434394, 'avg_test_loss': 0.0693214193186332}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.03251580264678157, 'avg_test_loss': 0.06932706554116684}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.0324763500106446, 'avg_test_loss': 0.06931246850675452}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.032447729536645036, 'avg_test_loss': 0.0695023106031909}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.03241672296157752, 'avg_test_loss': 0.06925880273309584}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.03233085527981535, 'avg_test_loss': 0.06952559389686404}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.03233728911043515, 'avg_test_loss': 0.06929642839441806}
INFO:model_data_nn.py:Early stopping at epoch 43
INFO:main_restricted_month.py:Making prediction for data in year: 2009
INFO:main_restricted_month.py:Prediction data shape: (46521,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2009: 0.26325501442497706
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  46521.000000  46521.000000
mean       0.047317      0.054750
std        0.269893      0.051801
min       -0.972173     -0.129343
25%       -0.069401      0.018464
50%        0.020202      0.040893
75%        0.120234      0.074437
max       15.774193      0.573417
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:transform_data_nn.py:Train_data: (1455762, 161)

INFO:transform_data_nn.py:Test data years: [2009]
INFO:transform_data_nn.py:Test_data: (46521, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:transform_data_nn.py:Retrain_data: (1502283, 161)

INFO:transform_data_nn.py:Prediction data years: [2010]
INFO:transform_data_nn.py:Prediction_data: (44043, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1455762, 138])
            y_train_tf: torch.Size([1455762])

            x_test_tf: torch.Size([46521, 138])
            y_test_tf: torch.Size([46521])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1502283, 138])
            y_retrain_tf: torch.Size([1502283])

            x_prediction_tf: torch.Size([44043, 138])
            y_prediction_tf: torch.Size([44043])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.3556e-01,  8.9501e-01,  7.2648e-02, -1.6100e+00, -1.2826e-01,
        -8.2624e-01, -1.4790e-01, -3.5040e-01,  4.7651e-01, -1.7795e-01,
        -7.0519e-01,  7.7076e-02, -7.1684e-01, -5.2199e-01,  9.2188e-02,
         5.0981e-01, -1.3160e-01,  2.0659e-01, -8.5341e-02,  5.8516e-01,
        -4.1586e-01, -5.2675e-02, -1.7384e-01,  5.2328e-03, -9.5722e-02,
        -3.3812e-01, -5.9416e-01, -7.1346e-02,  3.8254e-01,  1.4512e+00,
         3.5313e-01, -1.3439e-01,  7.9474e-01,  2.9877e-01, -2.2688e-01,
        -2.4613e-01,  1.1696e-01,  9.0783e-01, -2.5742e-02, -1.1184e+00,
        -2.7863e-01,  3.0884e-01,  3.4117e-01,  5.2429e-02, -1.7405e-01,
        -7.4253e-01,  1.1172e-01, -5.6634e-02, -3.8354e-01, -1.3762e-01,
        -8.4047e-01,  3.7580e-01, -4.7466e-01,  8.9405e-02, -2.3847e-02,
         4.9529e-01, -5.9135e-01, -1.9021e-01, -2.4711e-01, -3.5894e-02,
         1.6576e-03, -3.0455e-01,  4.9130e-02,  2.1504e-01,  6.3754e-02,
        -2.0142e-01,  7.2637e-01, -2.6723e-01,  6.3338e-01, -5.7095e-01,
        -3.4318e-01, -1.7305e-01, -2.8461e-02, -8.9090e-01,  1.7429e-01,
         7.5424e-01,  8.6411e-01, -1.1693e+00,  2.8316e-01,  1.8770e-02,
        -8.6453e-01,  1.7930e-01,  3.7423e-01, -8.1412e-02, -5.7120e-01,
        -4.4850e-01, -5.4641e-01, -2.6781e-01,  8.2742e-02,  1.1322e-01,
        -5.8305e-01, -1.3411e+00,  2.3982e-01,  3.1086e-15,  3.1086e-15,
         3.1152e+00,  1.0144e-01,  2.5269e+00, -2.8806e+00,  7.9351e-01,
        -3.9410e-01,  1.7615e-01,  1.5259e-02,  4.8479e-02,  2.0858e-01,
         1.2312e-01, -1.3249e-01,  2.3001e-01,  2.6162e-01, -1.0323e+00,
         7.9886e-01, -2.1316e-14,  3.3662e-01, -6.0556e-03,  3.6523e-02,
         3.7105e-03,  3.1943e-01, -2.3633e-01,  1.8116e-02, -5.7116e-01,
         1.3585e-01, -2.6562e-01, -3.8207e-01,  3.5502e-01,  3.6441e-01,
        -4.1081e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5707]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-8.5803e-01,  1.6539e-01, -4.3643e-01,  1.2683e+00,  8.8404e-01,
         2.0447e+00,  4.7068e-01,  1.7437e-01,  2.8753e-01, -1.2035e+00,
        -5.1593e-01, -2.7148e-01, -7.1684e-01,  1.8260e-01, -7.2088e-02,
         5.0390e-03, -2.1394e-01,  1.7922e+00, -8.9696e-03,  1.8514e-01,
         3.5480e+00, -1.3240e+00, -1.6457e-01, -1.4603e-01,  5.0152e-01,
        -7.2687e-01, -5.3528e-01, -7.1346e-02,  4.8230e-01,  3.2680e-01,
        -2.7610e+00,  7.7016e-01,  1.6497e-01, -1.1407e+00, -9.2433e-01,
        -1.1777e-01, -2.1817e-01, -3.2063e-02,  1.5511e+00,  3.4593e-01,
        -2.6977e-01, -1.5618e+00, -9.6209e-02,  1.7594e+00,  3.8833e-01,
         1.5907e+00, -9.0257e-02,  1.2190e+00, -7.7373e-01,  2.4789e+00,
         1.5494e+00,  3.0037e-01, -4.7466e-01, -3.6544e-01, -7.3406e-01,
        -1.1065e-01, -9.0610e-01, -3.1777e-01, -1.7248e-01,  4.4821e-01,
        -2.4596e-02, -2.2277e-01, -2.2090e+00, -4.9511e-01, -6.7366e-01,
        -1.3343e+00, -4.9429e-01,  6.0919e-02,  6.3338e-01, -5.0926e-01,
        -3.4318e-01, -1.7305e-01, -2.8461e-02,  2.5520e+00, -1.9842e-01,
        -5.9180e-02, -1.4246e+00, -1.6058e+00, -1.7063e+00,  1.8770e-02,
         7.8991e-01,  2.7818e-01, -5.8609e-01, -2.9817e-01, -1.5207e-01,
         7.8044e-01,  1.5895e+00, -3.8269e-01,  4.2973e-01, -1.8183e-01,
        -3.0082e-03, -6.7356e-01,  2.3982e-01,  3.1086e-15,  3.1086e-15,
        -5.5960e-02, -1.6395e+00, -1.8837e+00,  6.3985e-01,  5.9574e+00,
         3.2213e+00,  4.8334e-03, -2.3350e+00,  1.0134e-01, -3.4640e+00,
        -3.2624e-01, -2.5987e-01, -2.1428e-01,  1.9968e+00, -1.4542e+00,
        -2.8394e-01, -2.1316e-14,  4.0623e-01, -6.0556e-03, -9.9253e-01,
        -7.1666e-01, -1.1255e+00,  9.5026e-02,  1.8116e-02,  3.2015e-01,
         1.4504e-02, -1.2044e+00, -1.1081e+00,  9.9966e-02, -9.7968e-03,
        -4.1341e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([986]), tensor(-0.3991))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.3918e-01,  9.0404e-01,  7.3500e-02, -1.6232e+00, -1.1790e-01,
        -8.3842e-01, -1.4621e-01, -3.4811e-01,  4.4908e-01, -1.7393e-01,
        -7.0784e-01,  8.6048e-02, -7.1140e-01, -5.2363e-01,  9.1166e-02,
         5.1143e-01, -1.2924e-01,  2.1199e-01, -8.8560e-02,  5.9630e-01,
        -4.2101e-01, -5.6085e-02, -1.7379e-01,  1.0927e-02, -9.1971e-02,
        -3.3794e-01, -5.9463e-01, -8.2695e-02,  3.6367e-01,  1.4167e+00,
         3.4630e-01, -1.2601e-01,  7.8905e-01,  3.0500e-01, -2.2435e-01,
        -2.4326e-01,  1.2809e-01,  9.1061e-01, -2.1375e-02, -1.1246e+00,
        -2.7869e-01,  3.3716e-01,  3.5137e-01,  4.0492e-02, -1.6855e-01,
        -7.4820e-01,  1.3041e-01, -6.1203e-02, -3.7114e-01, -1.3355e-01,
        -8.4475e-01,  3.6704e-01, -4.7373e-01,  8.7016e-02, -1.9033e-02,
         4.9349e-01, -5.8406e-01, -1.8695e-01, -2.4741e-01, -3.9234e-02,
         5.8171e-03, -3.0467e-01,  5.7297e-02,  2.1041e-01,  6.7821e-02,
        -1.9852e-01,  7.4045e-01, -2.6642e-01,  6.3921e-01, -5.7172e-01,
        -3.4661e-01, -1.7463e-01, -2.8932e-02, -8.9856e-01,  1.8209e-01,
         7.5716e-01,  8.7362e-01, -1.1755e+00,  2.7790e-01,  1.7225e-02,
        -9.2702e-01,  1.8722e-01,  3.6767e-01, -6.3533e-02, -5.7313e-01,
        -4.5457e-01, -5.5074e-01, -2.6891e-01,  8.7131e-02,  1.1535e-01,
        -5.8962e-01, -1.3419e+00,  2.4388e-01, -3.3307e-15, -3.3307e-15,
         3.1607e+00,  1.3828e-01,  2.4971e+00, -2.8941e+00,  6.0091e-01,
        -4.1590e-01,  1.8731e-01, -2.2732e-02,  6.7517e-03,  2.0576e-01,
         1.1964e-01, -1.3272e-01,  2.2645e-01,  6.6501e-01, -9.6645e-01,
         8.0410e-01,  2.3093e-14,  3.3824e-01,  6.1975e-03,  9.5904e-02,
         1.6866e-03,  3.3125e-01, -2.3450e-01,  1.7897e-02, -5.6951e-01,
         1.3896e-01, -2.5995e-01, -3.7094e-01,  3.5949e-01,  3.6571e-01,
        -4.1248e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5756]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-2.5185e-01, -3.0627e-01, -6.7369e-01,  1.2482e+00, -4.0793e-01,
        -2.6530e-01, -5.0523e-01, -5.6910e-01, -7.6360e-02, -1.2156e-01,
        -3.0566e-01,  5.0731e-02, -7.1140e-01,  5.6680e-01,  2.6004e-01,
         1.5959e+00, -1.1254e-01,  1.5008e+00, -8.8560e-02, -1.3051e+00,
         2.8418e-01, -1.2732e-01, -5.1089e-01, -4.3179e-01,  3.2870e-01,
        -7.4241e-01, -6.4546e-01, -8.2695e-02, -6.2903e-01,  1.2934e-02,
        -2.9901e-01, -2.3096e-01,  4.1847e-01,  3.0500e-01, -5.5577e-01,
         4.8227e-01,  6.9566e-01, -7.1712e-01,  1.2408e+00, -4.8652e-01,
        -2.7450e-01,  2.5683e-02, -4.1523e-01, -3.7367e-01, -3.9193e-01,
         6.6065e-01,  4.2467e-02,  1.0023e+00, -9.9839e-02,  3.5749e-02,
         2.3466e+00, -5.4451e-01, -4.7373e-01, -6.7850e-01, -7.3414e-01,
         2.5588e-01, -9.5994e-01,  8.9939e-01, -2.0937e-01, -3.7883e-01,
         2.0168e+00,  2.1862e-01,  2.2134e+00,  2.0714e+00, -3.7948e-02,
         1.5148e+00, -4.9179e-01, -3.1165e-01,  6.3921e-01, -6.6845e-01,
        -3.4661e-01, -1.7463e-01, -2.8932e-02,  1.4230e-01,  1.7371e-01,
        -8.0579e-01,  8.7362e-01,  1.6291e-01,  1.4995e+00,  1.7225e-02,
        -9.2702e-01,  7.4812e-01, -1.5470e-01,  6.5891e-01,  1.0031e+00,
        -3.0984e-01, -4.5084e-01, -2.8951e-02, -2.5745e-01, -4.8541e-01,
         4.7059e-01, -9.4753e-01,  2.4388e-01, -3.3307e-15, -3.3307e-15,
        -1.9327e-01,  1.4220e-01, -1.7583e+00,  1.6815e+00,  1.5033e-01,
        -3.3209e-01, -1.4781e+00, -2.2732e-02, -1.1065e+00,  2.0576e-01,
         3.0751e-02, -1.9868e-01,  2.2645e-01, -1.1908e+00, -1.5293e+00,
         1.0305e+00,  2.3093e-14,  2.7595e-01,  4.5552e+00,  9.5904e-02,
         1.6866e-03, -3.0564e-01, -3.1522e-01,  1.7897e-02, -4.3676e-01,
         1.0624e+00, -8.3723e-02, -3.8061e-01,  3.5085e-01,  2.5214e-01,
        -3.3652e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2337]), tensor(-0.0189))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:main_restricted_month.py:Testing data year: 2009
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15465
            device: cpu
            
2024-07-30 20:49:20,780	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-30 20:49:20,827	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-30 20:49:20,863	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_14c409843300b763.zip' (1.47MiB) to Ray cluster...
2024-07-30 20:49:20,868	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_14c409843300b763.zip'.
2024-07-30 20:49:25,116	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-30 23:10:44,390	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_20-49-25' in 0.2367s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 185, 'num_layers': 3, 'num_embeddings': 15465, 'embedding_dim': 4, 'dropout_rate': 0.24, 'lr': 4.149851045848955e-05, 'weight_decay': 0.00046058553685827974, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.030767459620594264
INFO:model_data_nn.py:Best trial testing loss: 0.0689243757258204
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-30_20-49-18_385529_365373/artifacts/2024-07-30_20-49-25/train_fnn_2024-07-30_20-49-25/driver_artifacts/train_fnn_e1057_00030_30_dropout_rate=0.2400,embedding_dim=4,hidden_dim=185,lr=0.0000,num_layers=3,weight_decay=0.0005_2024-07-30_20-49-25
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 185, 'num_layers': 3, 'num_embeddings': 15618, 'embedding_dim': 4, 'dropout_rate': 0.24, 'lr': 4.149851045848955e-05, 'weight_decay': 0.00046058553685827974, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03514971843057883, 'avg_test_loss': 0.025432572569644027}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.0343048776584196, 'avg_test_loss': 0.02578634463780504}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.03386074406961105, 'avg_test_loss': 0.02549010577898186}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03344712008142797, 'avg_test_loss': 0.026345913306876197}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03310174817740939, 'avg_test_loss': 0.025686706815736777}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03281755840489218, 'avg_test_loss': 0.025535231915739174}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03259833710621006, 'avg_test_loss': 0.025808785005617233}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03244527704309368, 'avg_test_loss': 0.025748800728618775}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03234459818021854, 'avg_test_loss': 0.026626324875169423}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03222515476234587, 'avg_test_loss': 0.025521419500710418}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03218173606493721, 'avg_test_loss': 0.02565457795223516}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main_restricted_month.py:Making prediction for data in year: 2010
INFO:main_restricted_month.py:Prediction data shape: (44043,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2010: 0.16024351555754415
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  44043.000000  44043.000000
mean       0.023938      0.029099
std        0.158845      0.025113
min       -0.895194     -0.166150
25%       -0.056751      0.016382
50%        0.015038      0.024978
75%        0.089069      0.037842
max        6.107143      0.454746
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:transform_data_nn.py:Train_data: (1502283, 161)

INFO:transform_data_nn.py:Test data years: [2010]
INFO:transform_data_nn.py:Test_data: (44043, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:transform_data_nn.py:Retrain_data: (1546326, 161)

INFO:transform_data_nn.py:Prediction data years: [2011]
INFO:transform_data_nn.py:Prediction_data: (42205, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1502283, 138])
            y_train_tf: torch.Size([1502283])

            x_test_tf: torch.Size([44043, 138])
            y_test_tf: torch.Size([44043])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1546326, 138])
            y_retrain_tf: torch.Size([1546326])

            x_prediction_tf: torch.Size([42205, 138])
            y_prediction_tf: torch.Size([42205])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.3918e-01,  9.0404e-01,  7.3500e-02, -1.6232e+00, -1.1790e-01,
        -8.3842e-01, -1.4621e-01, -3.4811e-01,  4.4908e-01, -1.7393e-01,
        -7.0784e-01,  8.6048e-02, -7.1140e-01, -5.2363e-01,  9.1166e-02,
         5.1143e-01, -1.2924e-01,  2.1199e-01, -8.8560e-02,  5.9630e-01,
        -4.2101e-01, -5.6085e-02, -1.7379e-01,  1.0927e-02, -9.1971e-02,
        -3.3794e-01, -5.9463e-01, -8.2695e-02,  3.6367e-01,  1.4167e+00,
         3.4630e-01, -1.2601e-01,  7.8905e-01,  3.0500e-01, -2.2435e-01,
        -2.4326e-01,  1.2809e-01,  9.1061e-01, -2.1375e-02, -1.1246e+00,
        -2.7869e-01,  3.3716e-01,  3.5137e-01,  4.0492e-02, -1.6855e-01,
        -7.4820e-01,  1.3041e-01, -6.1203e-02, -3.7114e-01, -1.3355e-01,
        -8.4475e-01,  3.6704e-01, -4.7373e-01,  8.7016e-02, -1.9033e-02,
         4.9349e-01, -5.8406e-01, -1.8695e-01, -2.4741e-01, -3.9234e-02,
         5.8171e-03, -3.0467e-01,  5.7297e-02,  2.1041e-01,  6.7821e-02,
        -1.9852e-01,  7.4045e-01, -2.6642e-01,  6.3921e-01, -5.7172e-01,
        -3.4661e-01, -1.7463e-01, -2.8932e-02, -8.9856e-01,  1.8209e-01,
         7.5716e-01,  8.7362e-01, -1.1755e+00,  2.7790e-01,  1.7225e-02,
        -9.2702e-01,  1.8722e-01,  3.6767e-01, -6.3533e-02, -5.7313e-01,
        -4.5457e-01, -5.5074e-01, -2.6891e-01,  8.7131e-02,  1.1535e-01,
        -5.8962e-01, -1.3419e+00,  2.4388e-01, -3.3307e-15, -3.3307e-15,
         3.1607e+00,  1.3828e-01,  2.4971e+00, -2.8941e+00,  6.0091e-01,
        -4.1590e-01,  1.8731e-01, -2.2732e-02,  6.7517e-03,  2.0576e-01,
         1.1964e-01, -1.3272e-01,  2.2645e-01,  6.6501e-01, -9.6645e-01,
         8.0410e-01,  2.3093e-14,  3.3824e-01,  6.1975e-03,  9.5904e-02,
         1.6866e-03,  3.3125e-01, -2.3450e-01,  1.7897e-02, -5.6951e-01,
         1.3896e-01, -2.5995e-01, -3.7094e-01,  3.5949e-01,  3.6571e-01,
        -4.1248e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5756]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-2.5185e-01, -3.0627e-01, -6.7369e-01,  1.2482e+00, -4.0793e-01,
        -2.6530e-01, -5.0523e-01, -5.6910e-01, -7.6360e-02, -1.2156e-01,
        -3.0566e-01,  5.0731e-02, -7.1140e-01,  5.6680e-01,  2.6004e-01,
         1.5959e+00, -1.1254e-01,  1.5008e+00, -8.8560e-02, -1.3051e+00,
         2.8418e-01, -1.2732e-01, -5.1089e-01, -4.3179e-01,  3.2870e-01,
        -7.4241e-01, -6.4546e-01, -8.2695e-02, -6.2903e-01,  1.2934e-02,
        -2.9901e-01, -2.3096e-01,  4.1847e-01,  3.0500e-01, -5.5577e-01,
         4.8227e-01,  6.9566e-01, -7.1712e-01,  1.2408e+00, -4.8652e-01,
        -2.7450e-01,  2.5683e-02, -4.1523e-01, -3.7367e-01, -3.9193e-01,
         6.6065e-01,  4.2467e-02,  1.0023e+00, -9.9839e-02,  3.5749e-02,
         2.3466e+00, -5.4451e-01, -4.7373e-01, -6.7850e-01, -7.3414e-01,
         2.5588e-01, -9.5994e-01,  8.9939e-01, -2.0937e-01, -3.7883e-01,
         2.0168e+00,  2.1862e-01,  2.2134e+00,  2.0714e+00, -3.7948e-02,
         1.5148e+00, -4.9179e-01, -3.1165e-01,  6.3921e-01, -6.6845e-01,
        -3.4661e-01, -1.7463e-01, -2.8932e-02,  1.4230e-01,  1.7371e-01,
        -8.0579e-01,  8.7362e-01,  1.6291e-01,  1.4995e+00,  1.7225e-02,
        -9.2702e-01,  7.4812e-01, -1.5470e-01,  6.5891e-01,  1.0031e+00,
        -3.0984e-01, -4.5084e-01, -2.8951e-02, -2.5745e-01, -4.8541e-01,
         4.7059e-01, -9.4753e-01,  2.4388e-01, -3.3307e-15, -3.3307e-15,
        -1.9327e-01,  1.4220e-01, -1.7583e+00,  1.6815e+00,  1.5033e-01,
        -3.3209e-01, -1.4781e+00, -2.2732e-02, -1.1065e+00,  2.0576e-01,
         3.0751e-02, -1.9868e-01,  2.2645e-01, -1.1908e+00, -1.5293e+00,
         1.0305e+00,  2.3093e-14,  2.7595e-01,  4.5552e+00,  9.5904e-02,
         1.6866e-03, -3.0564e-01, -3.1522e-01,  1.7897e-02, -4.3676e-01,
         1.0624e+00, -8.3723e-02, -3.8061e-01,  3.5085e-01,  2.5214e-01,
        -3.3652e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2337]), tensor(-0.0189))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.3927e-01,  9.1362e-01,  7.3040e-02, -1.6380e+00, -1.1193e-01,
        -8.4131e-01, -1.4537e-01, -3.4648e-01,  4.4611e-01, -1.7234e-01,
        -7.1204e-01,  8.8603e-02, -7.0973e-01, -5.3057e-01,  9.3019e-02,
         5.1464e-01, -1.2764e-01,  2.1285e-01, -8.8361e-02,  6.0712e-01,
        -4.1162e-01, -6.0162e-02, -1.7526e-01,  9.5381e-03, -8.8918e-02,
        -3.3825e-01, -5.9550e-01, -8.5255e-02,  3.4450e-01,  1.4138e+00,
         3.4766e-01, -1.2383e-01,  7.9050e-01,  3.0998e-01, -2.2421e-01,
        -2.3519e-01,  1.4277e-01,  9.1161e-01, -1.3247e-02, -1.1311e+00,
        -2.7677e-01,  3.0116e-01,  3.6358e-01,  3.5865e-02, -1.6293e-01,
        -7.4726e-01,  1.1604e-01, -6.3421e-02, -3.4996e-01, -1.3595e-01,
        -8.4847e-01,  3.5329e-01, -4.7331e-01,  8.5049e-02, -1.9453e-02,
         4.9264e-01, -5.7712e-01, -1.8437e-01, -2.4903e-01, -3.8648e-02,
         4.9528e-03, -3.0698e-01,  6.3616e-02,  2.1423e-01,  7.0318e-02,
        -1.9574e-01,  7.5221e-01, -2.6464e-01,  6.3217e-01, -5.7330e-01,
        -3.4933e-01, -1.7559e-01, -2.9092e-02, -8.9872e-01,  1.8520e-01,
         7.6351e-01,  8.8474e-01, -1.1792e+00,  2.7609e-01,  1.8951e-02,
        -9.6567e-01,  1.9667e-01,  3.7361e-01, -4.4194e-02, -5.7447e-01,
        -4.5898e-01, -5.5389e-01, -2.7038e-01,  8.9678e-02,  1.1469e-01,
        -5.9617e-01, -1.3397e+00,  2.4770e-01,  1.6653e-15,  1.6653e-15,
         3.2045e+00,  1.2849e-01,  2.4799e+00, -2.9059e+00,  6.0545e-01,
        -4.2080e-01,  1.9761e-01, -1.4282e-02, -5.6949e-02,  2.0421e-01,
         1.1749e-01, -1.4323e-01,  2.4634e-01,  5.3020e-01, -9.0624e-01,
         8.0823e-01, -8.8818e-15,  3.3851e-01,  1.3375e-02,  9.3341e-02,
         8.8609e-03,  3.4298e-01, -2.2962e-01,  1.7690e-02, -5.6735e-01,
         1.3758e-01, -2.5264e-01, -3.6472e-01,  3.6131e-01,  3.6599e-01,
        -4.1448e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5791]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-1.4593e-01, -3.8136e-01,  1.7007e+00,  1.2281e+00,  1.3378e+00,
        -8.6637e-01, -5.5292e-01, -5.9307e-01, -1.2677e-01, -7.7821e-02,
        -4.8795e-01,  2.7126e-01, -7.0973e-01,  6.1386e-01,  9.6481e-02,
        -9.4817e-01,  2.0251e+00,  1.5007e+00, -8.8361e-02, -5.2999e-02,
        -2.1600e-01, -1.3043e-01, -1.5659e-01, -9.0095e-01,  8.6518e-01,
        -8.5948e-01, -5.7521e-01, -8.5255e-02,  6.5512e-01,  4.1118e-01,
         2.2221e-03,  7.8361e-01,  5.5636e-01,  3.0998e-01, -6.4979e-01,
         6.8597e-01,  4.4710e-01, -7.1851e-01,  1.1294e+00, -3.9751e-01,
        -2.7684e-01, -1.6970e-01,  3.6364e-01, -3.8339e-01,  7.1276e-01,
        -8.7437e-01, -1.7867e-01,  2.7941e-01, -8.7806e-02, -3.0062e-01,
         2.3450e+00, -2.6722e-01, -4.7331e-01, -6.7984e-01, -7.3664e-01,
         1.3883e-01, -9.5501e-01,  9.5136e-02, -7.1711e-01, -3.6146e-01,
         6.3871e-01, -5.5510e-01, -6.6889e-02, -1.3412e+00, -4.1492e-02,
        -2.5361e-01, -4.8886e-01, -3.9092e-01,  2.6562e+00, -7.3027e-01,
        -3.4933e-01, -1.7559e-01, -2.9092e-02, -1.0677e+00,  1.0917e-01,
         6.8587e-02,  8.8474e-01,  1.1271e-01,  1.5018e+00,  1.8951e-02,
        -9.6567e-01, -2.3218e-01, -4.1358e-01, -8.6765e-01, -3.7993e-01,
        -3.1589e-01, -4.5597e-01, -1.6292e-01, -5.7360e-01,  5.4074e-01,
        -2.6168e-01, -3.5320e-01,  2.4770e-01,  1.6653e-15,  1.6653e-15,
        -4.6751e-02,  2.3229e-01, -1.6333e+00,  1.2606e+00,  8.3593e-02,
        -3.5448e-01, -1.0159e-01, -1.4282e-02, -1.1116e+00,  2.0421e-01,
        -6.1516e-01, -1.6577e-01,  2.4634e-01,  1.3764e+00, -1.2562e+00,
        -8.3904e-01, -8.8818e-15,  3.7177e-01,  1.3788e+00,  9.3341e-02,
         8.8609e-03, -6.0953e-01,  2.4734e-01,  1.7690e-02, -3.5042e-01,
         1.2694e-01, -5.7492e-01, -7.4430e-01,  4.7313e-01,  4.0679e-01,
        -3.0843e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2251]), tensor(0.0290))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:main_restricted_month.py:Testing data year: 2010
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15618
            device: cpu
            
2024-07-31 03:07:16,957	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-31 03:07:17,188	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-31 03:07:17,234	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_14c409843300b763.zip' (1.47MiB) to Ray cluster...
2024-07-31 03:07:17,239	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_14c409843300b763.zip'.
2024-07-31 03:07:24,301	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-31 06:29:12,353	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 30.17 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-07-31 07:07:30,412	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-31_03-07-24' in 0.3029s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 3, 'num_embeddings': 15618, 'embedding_dim': 9, 'dropout_rate': 0.49, 'lr': 2.1456816483566953e-06, 'weight_decay': 3.8468952779413876e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03529376021575329
INFO:model_data_nn.py:Best trial testing loss: 0.02528611792073043
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-31_03-07-13_795595_365373/artifacts/2024-07-31_03-07-24/train_fnn_2024-07-31_03-07-24/driver_artifacts/train_fnn_aede7_00074_74_dropout_rate=0.4900,embedding_dim=9,hidden_dim=5,lr=0.0000,num_layers=3,weight_decay=0.0000_2024-07-31_03-07-24
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 3, 'num_embeddings': 15706, 'embedding_dim': 9, 'dropout_rate': 0.49, 'lr': 2.1456816483566953e-06, 'weight_decay': 3.8468952779413876e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.035214572928656394, 'avg_test_loss': 0.02167868180426233}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.03511505235619374, 'avg_test_loss': 0.021689458927986297}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.03511058008675633, 'avg_test_loss': 0.021716812413157614}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03510841135688477, 'avg_test_loss': 0.021722541500419152}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03510627481357073, 'avg_test_loss': 0.02171923629057622}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03510588435280392, 'avg_test_loss': 0.0217380235246806}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.035100506487951655, 'avg_test_loss': 0.021738024744395675}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03510102453368618, 'avg_test_loss': 0.02173506808890538}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.035099301721618396, 'avg_test_loss': 0.02173372480213981}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03509485860205336, 'avg_test_loss': 0.021718632034731632}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03509178308536247, 'avg_test_loss': 0.021727276195517994}
INFO:model_data_nn.py:Early stopping at epoch 11
INFO:main_restricted_month.py:Making prediction for data in year: 2011
INFO:main_restricted_month.py:Prediction data shape: (42205,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2011: 0.1474035382034918
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  42205.000000  42205.000000
mean      -0.005365      0.012872
std        0.146266      0.001649
min       -0.935356      0.010870
25%       -0.073850      0.011488
50%       -0.008264      0.012492
75%        0.050858      0.013874
max        3.993939      0.023063
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:transform_data_nn.py:Train_data: (1546326, 161)

INFO:transform_data_nn.py:Test data years: [2011]
INFO:transform_data_nn.py:Test_data: (42205, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:transform_data_nn.py:Retrain_data: (1588531, 161)

INFO:transform_data_nn.py:Prediction data years: [2012]
INFO:transform_data_nn.py:Prediction_data: (40994, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1546326, 138])
            y_train_tf: torch.Size([1546326])

            x_test_tf: torch.Size([42205, 138])
            y_test_tf: torch.Size([42205])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1588531, 138])
            y_retrain_tf: torch.Size([1588531])

            x_prediction_tf: torch.Size([40994, 138])
            y_prediction_tf: torch.Size([40994])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.3927e-01,  9.1362e-01,  7.3040e-02, -1.6380e+00, -1.1193e-01,
        -8.4131e-01, -1.4537e-01, -3.4648e-01,  4.4611e-01, -1.7234e-01,
        -7.1204e-01,  8.8603e-02, -7.0973e-01, -5.3057e-01,  9.3019e-02,
         5.1464e-01, -1.2764e-01,  2.1285e-01, -8.8361e-02,  6.0712e-01,
        -4.1162e-01, -6.0162e-02, -1.7526e-01,  9.5381e-03, -8.8918e-02,
        -3.3825e-01, -5.9550e-01, -8.5255e-02,  3.4450e-01,  1.4138e+00,
         3.4766e-01, -1.2383e-01,  7.9050e-01,  3.0998e-01, -2.2421e-01,
        -2.3519e-01,  1.4277e-01,  9.1161e-01, -1.3247e-02, -1.1311e+00,
        -2.7677e-01,  3.0116e-01,  3.6358e-01,  3.5865e-02, -1.6293e-01,
        -7.4726e-01,  1.1604e-01, -6.3421e-02, -3.4996e-01, -1.3595e-01,
        -8.4847e-01,  3.5329e-01, -4.7331e-01,  8.5049e-02, -1.9453e-02,
         4.9264e-01, -5.7712e-01, -1.8437e-01, -2.4903e-01, -3.8648e-02,
         4.9528e-03, -3.0698e-01,  6.3616e-02,  2.1423e-01,  7.0318e-02,
        -1.9574e-01,  7.5221e-01, -2.6464e-01,  6.3217e-01, -5.7330e-01,
        -3.4933e-01, -1.7559e-01, -2.9092e-02, -8.9872e-01,  1.8520e-01,
         7.6351e-01,  8.8474e-01, -1.1792e+00,  2.7609e-01,  1.8951e-02,
        -9.6567e-01,  1.9667e-01,  3.7361e-01, -4.4194e-02, -5.7447e-01,
        -4.5898e-01, -5.5389e-01, -2.7038e-01,  8.9678e-02,  1.1469e-01,
        -5.9617e-01, -1.3397e+00,  2.4770e-01,  1.6653e-15,  1.6653e-15,
         3.2045e+00,  1.2849e-01,  2.4799e+00, -2.9059e+00,  6.0545e-01,
        -4.2080e-01,  1.9761e-01, -1.4282e-02, -5.6949e-02,  2.0421e-01,
         1.1749e-01, -1.4323e-01,  2.4634e-01,  5.3020e-01, -9.0624e-01,
         8.0823e-01, -8.8818e-15,  3.3851e-01,  1.3375e-02,  9.3341e-02,
         8.8609e-03,  3.4298e-01, -2.2962e-01,  1.7690e-02, -5.6735e-01,
         1.3758e-01, -2.5264e-01, -3.6472e-01,  3.6131e-01,  3.6599e-01,
        -4.1448e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5791]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-1.4593e-01, -3.8136e-01,  1.7007e+00,  1.2281e+00,  1.3378e+00,
        -8.6637e-01, -5.5292e-01, -5.9307e-01, -1.2677e-01, -7.7821e-02,
        -4.8795e-01,  2.7126e-01, -7.0973e-01,  6.1386e-01,  9.6481e-02,
        -9.4817e-01,  2.0251e+00,  1.5007e+00, -8.8361e-02, -5.2999e-02,
        -2.1600e-01, -1.3043e-01, -1.5659e-01, -9.0095e-01,  8.6518e-01,
        -8.5948e-01, -5.7521e-01, -8.5255e-02,  6.5512e-01,  4.1118e-01,
         2.2221e-03,  7.8361e-01,  5.5636e-01,  3.0998e-01, -6.4979e-01,
         6.8597e-01,  4.4710e-01, -7.1851e-01,  1.1294e+00, -3.9751e-01,
        -2.7684e-01, -1.6970e-01,  3.6364e-01, -3.8339e-01,  7.1276e-01,
        -8.7437e-01, -1.7867e-01,  2.7941e-01, -8.7806e-02, -3.0062e-01,
         2.3450e+00, -2.6722e-01, -4.7331e-01, -6.7984e-01, -7.3664e-01,
         1.3883e-01, -9.5501e-01,  9.5136e-02, -7.1711e-01, -3.6146e-01,
         6.3871e-01, -5.5510e-01, -6.6889e-02, -1.3412e+00, -4.1492e-02,
        -2.5361e-01, -4.8886e-01, -3.9092e-01,  2.6562e+00, -7.3027e-01,
        -3.4933e-01, -1.7559e-01, -2.9092e-02, -1.0677e+00,  1.0917e-01,
         6.8587e-02,  8.8474e-01,  1.1271e-01,  1.5018e+00,  1.8951e-02,
        -9.6567e-01, -2.3218e-01, -4.1358e-01, -8.6765e-01, -3.7993e-01,
        -3.1589e-01, -4.5597e-01, -1.6292e-01, -5.7360e-01,  5.4074e-01,
        -2.6168e-01, -3.5320e-01,  2.4770e-01,  1.6653e-15,  1.6653e-15,
        -4.6751e-02,  2.3229e-01, -1.6333e+00,  1.2606e+00,  8.3593e-02,
        -3.5448e-01, -1.0159e-01, -1.4282e-02, -1.1116e+00,  2.0421e-01,
        -6.1516e-01, -1.6577e-01,  2.4634e-01,  1.3764e+00, -1.2562e+00,
        -8.3904e-01, -8.8818e-15,  3.7177e-01,  1.3788e+00,  9.3341e-02,
         8.8609e-03, -6.0953e-01,  2.4734e-01,  1.7690e-02, -3.5042e-01,
         1.2694e-01, -5.7492e-01, -7.4430e-01,  4.7313e-01,  4.0679e-01,
        -3.0843e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2251]), tensor(0.0290))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.3421e-01,  9.2012e-01,  7.1742e-02, -1.6520e+00, -1.0992e-01,
        -8.4323e-01, -1.4508e-01, -3.4537e-01,  4.4567e-01, -1.7088e-01,
        -7.1560e-01,  8.5419e-02, -7.0943e-01, -5.3811e-01,  9.5369e-02,
         5.1465e-01, -1.2572e-01,  2.1018e-01, -8.8127e-02,  6.1102e-01,
        -4.0930e-01, -6.4709e-02, -1.7532e-01,  8.7376e-03, -9.0806e-02,
        -3.3850e-01, -5.9558e-01, -8.7117e-02,  3.2482e-01,  1.4134e+00,
         3.4916e-01, -1.2327e-01,  7.9186e-01,  3.1495e-01, -2.2519e-01,
        -2.2767e-01,  1.5045e-01,  9.1205e-01, -1.0170e-02, -1.1348e+00,
        -2.7491e-01,  2.9941e-01,  3.7015e-01,  3.2821e-02, -1.6069e-01,
        -7.4617e-01,  1.1367e-01, -6.2026e-02, -3.4387e-01, -1.3735e-01,
        -8.4920e-01,  3.3791e-01, -4.7321e-01,  8.5036e-02, -1.8521e-02,
         4.9203e-01, -5.7006e-01, -1.8394e-01, -2.4943e-01, -3.5014e-02,
         2.1188e-03, -3.0702e-01,  6.6905e-02,  2.1398e-01,  6.7521e-02,
        -1.9403e-01,  7.6069e-01, -2.6284e-01,  6.2228e-01, -5.7448e-01,
        -3.5127e-01, -1.7636e-01, -2.8452e-02, -8.9912e-01,  1.8356e-01,
         7.6858e-01,  8.9458e-01, -1.1816e+00,  2.7376e-01,  2.0176e-02,
        -9.8291e-01,  1.9850e-01,  3.7997e-01, -2.6430e-02, -5.7605e-01,
        -4.6305e-01, -5.5644e-01, -2.7175e-01,  9.2949e-02,  1.1296e-01,
        -6.0263e-01, -1.3391e+00,  2.5116e-01, -1.3323e-15, -1.3323e-15,
         3.2488e+00,  1.2636e-01,  2.4694e+00, -2.9267e+00,  6.1437e-01,
        -4.2846e-01,  2.0126e-01, -7.3742e-03,  1.1344e-02,  1.9078e-01,
         5.9915e-02, -1.4803e-01,  2.8404e-01,  5.8679e-01, -8.9707e-01,
         8.2537e-01,  2.1316e-14,  3.3517e-01,  2.6516e-02,  8.0245e-02,
         1.1423e-02,  3.5462e-01, -2.2791e-01,  1.7505e-02, -5.6513e-01,
         1.3821e-01, -2.4568e-01, -3.6121e-01,  3.6028e-01,  3.6456e-01,
        -4.1616e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5845]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-9.1680e-01,  2.5333e-01, -3.3042e-01,  1.2092e+00,  6.4526e-02,
        -8.7021e-01, -1.2434e+00, -8.3151e-01,  7.2332e-02,  1.2866e-01,
        -3.9015e-01,  9.9670e-02, -7.0943e-01,  1.1884e-01, -2.7242e-01,
        -4.2252e-01, -2.1169e-01,  4.4219e-01, -1.5472e-02, -1.8236e-02,
        -2.6021e-01, -1.3249e-01, -2.2232e-01,  1.1231e-01, -2.4745e-01,
        -7.1799e-01, -6.5159e-01, -8.7117e-02, -2.7374e-01,  7.1037e-01,
         1.1697e-02,  2.9420e-01,  4.0988e-01,  3.1495e-01, -6.5863e-01,
        -3.2210e-01,  2.2429e+00, -7.1675e-01,  4.3161e-02, -8.1128e-01,
        -2.7217e-01, -1.1558e-02,  1.5891e+00, -4.0628e-01, -2.8799e-01,
        -8.6979e-01, -7.2526e-02,  2.7887e-01,  1.4523e-01, -2.4733e-01,
        -5.1036e-02, -2.2253e-01, -4.7321e-01, -3.7991e-01, -7.3723e-01,
         6.7478e-02, -9.4996e-01, -4.4855e-01,  8.9354e-01, -2.8457e-01,
        -1.4531e-01,  8.6250e-01,  2.5218e-01,  3.0592e-01, -4.0632e-02,
        -1.0468e-01, -8.1529e-02, -1.4994e+00, -7.2441e-01, -6.1754e-01,
        -3.5127e-01, -1.7636e-01, -2.8452e-02, -1.0305e+00,  2.0811e-01,
        -2.0925e-02,  2.6687e-01,  3.3106e-01,  1.5040e+00,  2.0176e-02,
         9.2158e-01,  1.1675e-01, -3.7812e-01, -5.1189e-01, -5.7238e-01,
        -3.3073e-01, -4.6618e-01, -4.1641e-01, -3.8912e-01, -2.3085e-01,
        -5.8487e-01,  1.7653e+00,  2.5116e-01, -1.3323e-15, -1.3323e-15,
        -5.0232e-02, -7.2598e-01, -1.5988e+00,  2.0591e-01,  6.1437e-01,
        -8.5679e-03, -6.7703e-02, -7.3742e-03, -8.3765e-01,  1.9078e-01,
         3.9580e+00, -1.6830e-01, -1.8694e-01,  2.3162e+00, -6.9272e-01,
        -4.2502e-01,  2.1316e-14,  3.4075e-01, -6.5667e-02, -6.3208e-01,
        -3.4313e+00, -5.9664e-01, -2.5386e-01,  1.7505e-02, -5.3497e-01,
        -6.5585e-01, -5.4200e-01, -5.1239e-01,  3.3924e-01,  1.9796e-01,
        -3.1040e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00]), tensor([2197]), tensor(-0.0197))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:main_restricted_month.py:Testing data year: 2011
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15706
            device: cpu
            
2024-07-31 10:57:23,074	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-31 10:57:23,119	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-31 10:57:23,156	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_14c409843300b763.zip' (1.47MiB) to Ray cluster...
2024-07-31 10:57:23,160	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_14c409843300b763.zip'.
2024-07-31 10:57:29,189	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-31 13:40:40,953	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-31_10-57-29' in 0.2374s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 1, 'num_embeddings': 15706, 'embedding_dim': 1, 'dropout_rate': 0.27, 'lr': 5.110120656497166e-05, 'weight_decay': 0.00028447512555118215, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.033028375743744544
INFO:model_data_nn.py:Best trial testing loss: 0.021532699047362037
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-31_10-57-20_667385_365373/artifacts/2024-07-31_10-57-29/train_fnn_2024-07-31_10-57-29/driver_artifacts/train_fnn_5a4ad_00018_18_dropout_rate=0.2700,embedding_dim=1,hidden_dim=65,lr=0.0001,num_layers=1,weight_decay=0.0003_2024-07-31_10-57-29
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 1, 'num_embeddings': 15854, 'embedding_dim': 1, 'dropout_rate': 0.27, 'lr': 5.110120656497166e-05, 'weight_decay': 0.00028447512555118215, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03428001830885338, 'avg_test_loss': 0.02135862207458632}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.033806979779684165, 'avg_test_loss': 0.02130148158729797}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.03357357504121321, 'avg_test_loss': 0.02141005680213469}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03339544692745039, 'avg_test_loss': 0.02137950232925181}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.033290922324453104, 'avg_test_loss': 0.021608764577043853}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03318393939621931, 'avg_test_loss': 0.02142914250389892}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.033120932535205594, 'avg_test_loss': 0.02149743812635262}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03306637123913914, 'avg_test_loss': 0.021454788733189477}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.033024674375188016, 'avg_test_loss': 0.02176742443223535}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03300085474017062, 'avg_test_loss': 0.02121718769512385}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03295363167604069, 'avg_test_loss': 0.02116407494768268}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.032927324191743046, 'avg_test_loss': 0.021315003889823526}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.03292075773124516, 'avg_test_loss': 0.02127904009238153}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.032910654175541655, 'avg_test_loss': 0.021548714660915912}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.03290089714141964, 'avg_test_loss': 0.021364628827321385}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.03288786513427709, 'avg_test_loss': 0.02116102577650603}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.032858679420863485, 'avg_test_loss': 0.0213928297964795}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.03284453794196267, 'avg_test_loss': 0.02172413501087954}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.03282517629301965, 'avg_test_loss': 0.021254964043530118}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.032819408509093255, 'avg_test_loss': 0.021355841534398207}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.03280276716945496, 'avg_test_loss': 0.02146660598712667}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.032785377735718935, 'avg_test_loss': 0.021384359904392018}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.03278587434246039, 'avg_test_loss': 0.021329460964522175}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.03277886210357356, 'avg_test_loss': 0.021324312473122792}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.03277164686324965, 'avg_test_loss': 0.021440364373194028}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.03274391914348754, 'avg_test_loss': 0.021338065197711663}
INFO:model_data_nn.py:Early stopping at epoch 26
INFO:main_restricted_month.py:Making prediction for data in year: 2012
INFO:main_restricted_month.py:Prediction data shape: (40994,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2012: 0.14607978546535394
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  40994.000000  40994.000000
mean       0.016349      0.016421
std        0.144873      0.031251
min       -0.830303     -0.142252
25%       -0.043610     -0.002397
50%        0.010396      0.012298
75%        0.065653      0.032545
max        5.210484      0.304448
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:transform_data_nn.py:Train_data: (1588531, 161)

INFO:transform_data_nn.py:Test data years: [2012]
INFO:transform_data_nn.py:Test_data: (40994, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:transform_data_nn.py:Retrain_data: (1629525, 161)

INFO:transform_data_nn.py:Prediction data years: [2013]
INFO:transform_data_nn.py:Prediction_data: (39683, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1588531, 138])
            y_train_tf: torch.Size([1588531])

            x_test_tf: torch.Size([40994, 138])
            y_test_tf: torch.Size([40994])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1629525, 138])
            y_retrain_tf: torch.Size([1629525])

            x_prediction_tf: torch.Size([39683, 138])
            y_prediction_tf: torch.Size([39683])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.3421e-01,  9.2012e-01,  7.1742e-02, -1.6520e+00, -1.0992e-01,
        -8.4323e-01, -1.4508e-01, -3.4537e-01,  4.4567e-01, -1.7088e-01,
        -7.1560e-01,  8.5419e-02, -7.0943e-01, -5.3811e-01,  9.5369e-02,
         5.1465e-01, -1.2572e-01,  2.1018e-01, -8.8127e-02,  6.1102e-01,
        -4.0930e-01, -6.4709e-02, -1.7532e-01,  8.7376e-03, -9.0806e-02,
        -3.3850e-01, -5.9558e-01, -8.7117e-02,  3.2482e-01,  1.4134e+00,
         3.4916e-01, -1.2327e-01,  7.9186e-01,  3.1495e-01, -2.2519e-01,
        -2.2767e-01,  1.5045e-01,  9.1205e-01, -1.0170e-02, -1.1348e+00,
        -2.7491e-01,  2.9941e-01,  3.7015e-01,  3.2821e-02, -1.6069e-01,
        -7.4617e-01,  1.1367e-01, -6.2026e-02, -3.4387e-01, -1.3735e-01,
        -8.4920e-01,  3.3791e-01, -4.7321e-01,  8.5036e-02, -1.8521e-02,
         4.9203e-01, -5.7006e-01, -1.8394e-01, -2.4943e-01, -3.5014e-02,
         2.1188e-03, -3.0702e-01,  6.6905e-02,  2.1398e-01,  6.7521e-02,
        -1.9403e-01,  7.6069e-01, -2.6284e-01,  6.2228e-01, -5.7448e-01,
        -3.5127e-01, -1.7636e-01, -2.8452e-02, -8.9912e-01,  1.8356e-01,
         7.6858e-01,  8.9458e-01, -1.1816e+00,  2.7376e-01,  2.0176e-02,
        -9.8291e-01,  1.9850e-01,  3.7997e-01, -2.6430e-02, -5.7605e-01,
        -4.6305e-01, -5.5644e-01, -2.7175e-01,  9.2949e-02,  1.1296e-01,
        -6.0263e-01, -1.3391e+00,  2.5116e-01, -1.3323e-15, -1.3323e-15,
         3.2488e+00,  1.2636e-01,  2.4694e+00, -2.9267e+00,  6.1437e-01,
        -4.2846e-01,  2.0126e-01, -7.3742e-03,  1.1344e-02,  1.9078e-01,
         5.9915e-02, -1.4803e-01,  2.8404e-01,  5.8679e-01, -8.9707e-01,
         8.2537e-01,  2.1316e-14,  3.3517e-01,  2.6516e-02,  8.0245e-02,
         1.1423e-02,  3.5462e-01, -2.2791e-01,  1.7505e-02, -5.6513e-01,
         1.3821e-01, -2.4568e-01, -3.6121e-01,  3.6028e-01,  3.6456e-01,
        -4.1616e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5845]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-9.1680e-01,  2.5333e-01, -3.3042e-01,  1.2092e+00,  6.4526e-02,
        -8.7021e-01, -1.2434e+00, -8.3151e-01,  7.2332e-02,  1.2866e-01,
        -3.9015e-01,  9.9670e-02, -7.0943e-01,  1.1884e-01, -2.7242e-01,
        -4.2252e-01, -2.1169e-01,  4.4219e-01, -1.5472e-02, -1.8236e-02,
        -2.6021e-01, -1.3249e-01, -2.2232e-01,  1.1231e-01, -2.4745e-01,
        -7.1799e-01, -6.5159e-01, -8.7117e-02, -2.7374e-01,  7.1037e-01,
         1.1697e-02,  2.9420e-01,  4.0988e-01,  3.1495e-01, -6.5863e-01,
        -3.2210e-01,  2.2429e+00, -7.1675e-01,  4.3161e-02, -8.1128e-01,
        -2.7217e-01, -1.1558e-02,  1.5891e+00, -4.0628e-01, -2.8799e-01,
        -8.6979e-01, -7.2526e-02,  2.7887e-01,  1.4523e-01, -2.4733e-01,
        -5.1036e-02, -2.2253e-01, -4.7321e-01, -3.7991e-01, -7.3723e-01,
         6.7478e-02, -9.4996e-01, -4.4855e-01,  8.9354e-01, -2.8457e-01,
        -1.4531e-01,  8.6250e-01,  2.5218e-01,  3.0592e-01, -4.0632e-02,
        -1.0468e-01, -8.1529e-02, -1.4994e+00, -7.2441e-01, -6.1754e-01,
        -3.5127e-01, -1.7636e-01, -2.8452e-02, -1.0305e+00,  2.0811e-01,
        -2.0925e-02,  2.6687e-01,  3.3106e-01,  1.5040e+00,  2.0176e-02,
         9.2158e-01,  1.1675e-01, -3.7812e-01, -5.1189e-01, -5.7238e-01,
        -3.3073e-01, -4.6618e-01, -4.1641e-01, -3.8912e-01, -2.3085e-01,
        -5.8487e-01,  1.7653e+00,  2.5116e-01, -1.3323e-15, -1.3323e-15,
        -5.0232e-02, -7.2598e-01, -1.5988e+00,  2.0591e-01,  6.1437e-01,
        -8.5679e-03, -6.7703e-02, -7.3742e-03, -8.3765e-01,  1.9078e-01,
         3.9580e+00, -1.6830e-01, -1.8694e-01,  2.3162e+00, -6.9272e-01,
        -4.2502e-01,  2.1316e-14,  3.4075e-01, -6.5667e-02, -6.3208e-01,
        -3.4313e+00, -5.9664e-01, -2.5386e-01,  1.7505e-02, -5.3497e-01,
        -6.5585e-01, -5.4200e-01, -5.1239e-01,  3.3924e-01,  1.9796e-01,
        -3.1040e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00]), tensor([2197]), tensor(-0.0197))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.2904e-01,  9.2588e-01,  7.0911e-02, -1.6655e+00, -1.0686e-01,
        -8.4260e-01, -1.4763e-01, -3.4686e-01,  4.4350e-01, -1.6939e-01,
        -7.1850e-01,  8.3978e-02, -7.0821e-01, -5.4436e-01,  9.7482e-02,
         5.1761e-01, -1.2350e-01,  2.0757e-01, -8.5328e-02,  6.1631e-01,
        -4.1361e-01, -6.5030e-02, -1.7684e-01,  9.7866e-03, -9.2777e-02,
        -3.3863e-01, -5.9503e-01, -8.8227e-02,  3.0764e-01,  1.4156e+00,
         3.4922e-01, -1.2115e-01,  7.9205e-01,  3.1936e-01, -2.2586e-01,
        -2.2776e-01,  1.5482e-01,  9.1311e-01, -8.8896e-03, -1.1311e+00,
        -2.7333e-01,  3.1240e-01,  3.7591e-01,  2.9822e-02, -1.5864e-01,
        -7.4281e-01,  1.1925e-01, -6.2772e-02, -3.5156e-01, -1.3709e-01,
        -8.4971e-01,  3.2353e-01, -4.7305e-01,  8.6838e-02, -1.5873e-02,
         4.9029e-01, -5.6320e-01, -1.8334e-01, -2.4927e-01, -3.2158e-02,
         1.6769e-03, -3.0652e-01,  6.9735e-02,  2.1304e-01,  6.8220e-02,
        -1.9241e-01,  7.6922e-01, -2.6027e-01,  6.1771e-01, -5.7536e-01,
        -3.5340e-01, -1.7720e-01, -2.7315e-02, -8.9587e-01,  1.8304e-01,
         7.7466e-01,  9.0272e-01, -1.1830e+00,  2.7094e-01,  2.0407e-02,
        -1.0081e+00,  2.0158e-01,  3.8435e-01, -1.0811e-02, -5.7639e-01,
        -4.6642e-01, -5.5856e-01, -2.7316e-01,  9.7122e-02,  1.1322e-01,
        -6.0763e-01, -1.3379e+00,  2.5438e-01,  2.3315e-15,  2.3315e-15,
         3.2922e+00,  1.5467e-01,  2.4655e+00, -2.9649e+00,  6.0536e-01,
        -4.2735e-01,  2.0571e-01, -4.1955e-03,  1.2508e-02,  1.8407e-01,
         4.3527e-02, -1.4988e-01,  2.6931e-01,  7.0499e-01, -8.8011e-01,
         8.4883e-01, -2.6645e-14,  3.3098e-01,  2.7776e-02,  7.9749e-02,
         9.6244e-03,  3.6517e-01, -2.2720e-01,  3.0853e-02, -5.6306e-01,
         1.4047e-01, -2.3965e-01, -3.5712e-01,  3.5960e-01,  3.6295e-01,
        -4.1716e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5900]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-1.4326e-01, -3.7082e-01,  1.9029e-01,  1.1913e+00, -1.5569e-01,
        -5.2536e-01, -1.2305e+00, -8.3148e-01,  3.1653e-01,  4.0505e-01,
        -7.1466e-01, -4.0230e-02, -7.0821e-01,  5.9293e-01,  1.1293e-01,
        -5.9347e-01, -2.1203e-01,  8.0529e-01, -1.7297e-02, -3.2615e-01,
         5.0807e-02, -1.3391e-01, -8.3475e-02, -2.4875e-01, -2.6626e-01,
        -8.1541e-01, -6.6190e-01, -8.8227e-02,  1.9469e-02,  1.3530e+00,
        -1.4649e+00, -2.4234e-01,  2.4357e-01,  3.1936e-01, -7.6115e-01,
         2.6925e-01,  5.5426e-01, -7.0897e-01,  4.7697e-01, -1.1147e+00,
        -2.6799e-01, -3.2452e-01,  5.9406e-01, -2.9618e-01, -7.5120e-02,
        -7.5298e-01, -4.3760e-01, -1.6335e-01, -8.7961e-02, -2.4470e-01,
         7.4623e-01, -3.3055e-01, -4.7305e-01, -3.8688e-01, -1.5873e-02,
        -4.6541e-02, -9.4508e-01, -4.6730e-01, -5.9638e-01, -2.6596e-01,
        -2.0335e-01, -6.1293e-01,  5.4078e-02, -1.0759e+00, -3.8564e-02,
        -1.8678e-01, -4.8444e-01,  2.0774e-01,  6.1771e-01, -7.0267e-01,
        -3.5340e-01, -1.7720e-01, -2.7315e-02, -8.5030e-01, -2.1120e-02,
        -5.7656e-02,  9.0272e-01,  4.0475e-01,  1.5048e+00,  2.0407e-02,
         8.2155e-01, -6.2158e-01, -3.3935e-01, -8.3619e-01, -5.3270e-01,
        -3.7519e-01, -4.9104e-01, -3.5532e-01, -6.1545e-01, -7.1434e-01,
        -4.9258e-01,  6.6994e-01,  2.5438e-01,  2.3315e-15,  2.3315e-15,
        -8.7580e-02, -9.4629e-01, -1.5122e+00,  9.9657e-02, -1.4822e-01,
        -3.2254e-01, -1.8771e-01, -4.1955e-03, -8.3887e-01,  1.8407e-01,
         3.9178e+00, -2.2981e-01,  7.4825e-01,  5.5489e-01, -9.6234e-01,
        -6.8662e-01, -2.6645e-14,  2.2063e-01, -1.9818e+00, -3.7859e-01,
        -3.3979e+00, -5.0775e-01, -1.5019e-01,  3.0853e-02, -2.0206e-01,
         3.7997e-01, -6.5685e-01, -8.0389e-01,  1.8180e-01,  3.7697e-02,
        -3.3792e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2132]), tensor(0.0627))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:main_restricted_month.py:Testing data year: 2012
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15854
            device: cpu
            
2024-07-31 17:26:22,728	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-31 17:26:22,796	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-31 17:26:22,848	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_14c409843300b763.zip' (1.47MiB) to Ray cluster...
2024-07-31 17:26:22,853	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_14c409843300b763.zip'.
2024-07-31 17:26:29,318	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-31 21:29:39,787	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-31_17-26-29' in 0.2460s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 2, 'num_embeddings': 15854, 'embedding_dim': 10, 'dropout_rate': 0.54, 'lr': 0.00034703605955441544, 'weight_decay': 1.3674518065224943e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03314725157342259
INFO:model_data_nn.py:Best trial testing loss: 0.020925082506062738
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-07-31_17-26-19_581301_365373/artifacts/2024-07-31_17-26-29/train_fnn_2024-07-31_17-26-29/driver_artifacts/train_fnn_b217a_00054_54_dropout_rate=0.5400,embedding_dim=10,hidden_dim=45,lr=0.0003,num_layers=2,weight_decay=0.0000_2024-07-31_17-26-30
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 45, 'num_layers': 2, 'num_embeddings': 15992, 'embedding_dim': 10, 'dropout_rate': 0.54, 'lr': 0.00034703605955441544, 'weight_decay': 1.3674518065224943e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03422214147428803, 'avg_test_loss': 0.017441792688040053}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.0338713197752584, 'avg_test_loss': 0.017499096109344355}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.033717794291963026, 'avg_test_loss': 0.01741346207877768}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.033622212809607165, 'avg_test_loss': 0.017277175156045675}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.0334953645569922, 'avg_test_loss': 0.01722224466705128}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03339283346604796, 'avg_test_loss': 0.017212111261806745}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03331622446601675, 'avg_test_loss': 0.017300739808266026}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03326072697797279, 'avg_test_loss': 0.01739642751739089}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03319911136260172, 'avg_test_loss': 0.01729506739953626}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03317194251542148, 'avg_test_loss': 0.0171586237690335}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.0331470164316093, 'avg_test_loss': 0.017319091710437468}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.03312903832518107, 'avg_test_loss': 0.017284275680456474}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.03313245812035069, 'avg_test_loss': 0.0171741662275544}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.03311465244435415, 'avg_test_loss': 0.01723223474835032}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.03306811093672783, 'avg_test_loss': 0.01721041707543959}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.03307229197573778, 'avg_test_loss': 0.01735413233500616}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.03307041077356013, 'avg_test_loss': 0.017283175160115564}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.03302531168141687, 'avg_test_loss': 0.017203422331126726}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.03300273133684019, 'avg_test_loss': 0.017388593979875726}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.03299859650005479, 'avg_test_loss': 0.017168316366630885}
INFO:model_data_nn.py:Early stopping at epoch 20
INFO:main_restricted_month.py:Making prediction for data in year: 2013
INFO:main_restricted_month.py:Prediction data shape: (39683,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2013: 0.13091172238798443
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  39683.000000  39683.000000
mean       0.032175      0.019192
std        0.130473      0.007225
min       -0.898559     -0.071459
25%       -0.025732      0.018159
50%        0.023150      0.019795
75%        0.077193      0.021604
max        3.746377      0.155611
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:transform_data_nn.py:Train_data: (1629525, 161)

INFO:transform_data_nn.py:Test data years: [2013]
INFO:transform_data_nn.py:Test_data: (39683, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:transform_data_nn.py:Retrain_data: (1669208, 161)

INFO:transform_data_nn.py:Prediction data years: [2014]
INFO:transform_data_nn.py:Prediction_data: (39216, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1629525, 138])
            y_train_tf: torch.Size([1629525])

            x_test_tf: torch.Size([39683, 138])
            y_test_tf: torch.Size([39683])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1669208, 138])
            y_retrain_tf: torch.Size([1669208])

            x_prediction_tf: torch.Size([39216, 138])
            y_prediction_tf: torch.Size([39216])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.2904e-01,  9.2588e-01,  7.0911e-02, -1.6655e+00, -1.0686e-01,
        -8.4260e-01, -1.4763e-01, -3.4686e-01,  4.4350e-01, -1.6939e-01,
        -7.1850e-01,  8.3978e-02, -7.0821e-01, -5.4436e-01,  9.7482e-02,
         5.1761e-01, -1.2350e-01,  2.0757e-01, -8.5328e-02,  6.1631e-01,
        -4.1361e-01, -6.5030e-02, -1.7684e-01,  9.7866e-03, -9.2777e-02,
        -3.3863e-01, -5.9503e-01, -8.8227e-02,  3.0764e-01,  1.4156e+00,
         3.4922e-01, -1.2115e-01,  7.9205e-01,  3.1936e-01, -2.2586e-01,
        -2.2776e-01,  1.5482e-01,  9.1311e-01, -8.8896e-03, -1.1311e+00,
        -2.7333e-01,  3.1240e-01,  3.7591e-01,  2.9822e-02, -1.5864e-01,
        -7.4281e-01,  1.1925e-01, -6.2772e-02, -3.5156e-01, -1.3709e-01,
        -8.4971e-01,  3.2353e-01, -4.7305e-01,  8.6838e-02, -1.5873e-02,
         4.9029e-01, -5.6320e-01, -1.8334e-01, -2.4927e-01, -3.2158e-02,
         1.6769e-03, -3.0652e-01,  6.9735e-02,  2.1304e-01,  6.8220e-02,
        -1.9241e-01,  7.6922e-01, -2.6027e-01,  6.1771e-01, -5.7536e-01,
        -3.5340e-01, -1.7720e-01, -2.7315e-02, -8.9587e-01,  1.8304e-01,
         7.7466e-01,  9.0272e-01, -1.1830e+00,  2.7094e-01,  2.0407e-02,
        -1.0081e+00,  2.0158e-01,  3.8435e-01, -1.0811e-02, -5.7639e-01,
        -4.6642e-01, -5.5856e-01, -2.7316e-01,  9.7122e-02,  1.1322e-01,
        -6.0763e-01, -1.3379e+00,  2.5438e-01,  2.3315e-15,  2.3315e-15,
         3.2922e+00,  1.5467e-01,  2.4655e+00, -2.9649e+00,  6.0536e-01,
        -4.2735e-01,  2.0571e-01, -4.1955e-03,  1.2508e-02,  1.8407e-01,
         4.3527e-02, -1.4988e-01,  2.6931e-01,  7.0499e-01, -8.8011e-01,
         8.4883e-01, -2.6645e-14,  3.3098e-01,  2.7776e-02,  7.9749e-02,
         9.6244e-03,  3.6517e-01, -2.2720e-01,  3.0853e-02, -5.6306e-01,
         1.4047e-01, -2.3965e-01, -3.5712e-01,  3.5960e-01,  3.6295e-01,
        -4.1716e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5900]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-1.4326e-01, -3.7082e-01,  1.9029e-01,  1.1913e+00, -1.5569e-01,
        -5.2536e-01, -1.2305e+00, -8.3148e-01,  3.1653e-01,  4.0505e-01,
        -7.1466e-01, -4.0230e-02, -7.0821e-01,  5.9293e-01,  1.1293e-01,
        -5.9347e-01, -2.1203e-01,  8.0529e-01, -1.7297e-02, -3.2615e-01,
         5.0807e-02, -1.3391e-01, -8.3475e-02, -2.4875e-01, -2.6626e-01,
        -8.1541e-01, -6.6190e-01, -8.8227e-02,  1.9469e-02,  1.3530e+00,
        -1.4649e+00, -2.4234e-01,  2.4357e-01,  3.1936e-01, -7.6115e-01,
         2.6925e-01,  5.5426e-01, -7.0897e-01,  4.7697e-01, -1.1147e+00,
        -2.6799e-01, -3.2452e-01,  5.9406e-01, -2.9618e-01, -7.5120e-02,
        -7.5298e-01, -4.3760e-01, -1.6335e-01, -8.7961e-02, -2.4470e-01,
         7.4623e-01, -3.3055e-01, -4.7305e-01, -3.8688e-01, -1.5873e-02,
        -4.6541e-02, -9.4508e-01, -4.6730e-01, -5.9638e-01, -2.6596e-01,
        -2.0335e-01, -6.1293e-01,  5.4078e-02, -1.0759e+00, -3.8564e-02,
        -1.8678e-01, -4.8444e-01,  2.0774e-01,  6.1771e-01, -7.0267e-01,
        -3.5340e-01, -1.7720e-01, -2.7315e-02, -8.5030e-01, -2.1120e-02,
        -5.7656e-02,  9.0272e-01,  4.0475e-01,  1.5048e+00,  2.0407e-02,
         8.2155e-01, -6.2158e-01, -3.3935e-01, -8.3619e-01, -5.3270e-01,
        -3.7519e-01, -4.9104e-01, -3.5532e-01, -6.1545e-01, -7.1434e-01,
        -4.9258e-01,  6.6994e-01,  2.5438e-01,  2.3315e-15,  2.3315e-15,
        -8.7580e-02, -9.4629e-01, -1.5122e+00,  9.9657e-02, -1.4822e-01,
        -3.2254e-01, -1.8771e-01, -4.1955e-03, -8.3887e-01,  1.8407e-01,
         3.9178e+00, -2.2981e-01,  7.4825e-01,  5.5489e-01, -9.6234e-01,
        -6.8662e-01, -2.6645e-14,  2.2063e-01, -1.9818e+00, -3.7859e-01,
        -3.3979e+00, -5.0775e-01, -1.5019e-01,  3.0853e-02, -2.0206e-01,
         3.7997e-01, -6.5685e-01, -8.0389e-01,  1.8180e-01,  3.7697e-02,
        -3.3792e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2132]), tensor(0.0627))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.2511e-01,  9.3275e-01,  6.9032e-02, -1.6779e+00, -1.0372e-01,
        -8.3908e-01, -1.5048e-01, -3.4875e-01,  4.4744e-01, -1.6829e-01,
        -7.2095e-01,  8.4767e-02, -7.0936e-01, -5.5003e-01,  9.9669e-02,
         5.2145e-01, -1.2187e-01,  2.0511e-01, -8.7589e-02,  6.2321e-01,
        -4.1828e-01, -6.8465e-02, -1.8015e-01,  1.1259e-02, -9.3232e-02,
        -3.3859e-01, -5.9442e-01, -8.8215e-02,  2.8774e-01,  1.4183e+00,
         3.5026e-01, -1.1897e-01,  7.9418e-01,  3.2387e-01, -2.2571e-01,
        -2.2907e-01,  1.5939e-01,  9.1479e-01, -7.1619e-03, -1.1237e+00,
        -2.7126e-01,  3.0657e-01,  3.8249e-01,  2.9439e-02, -1.5667e-01,
        -7.3743e-01,  1.1529e-01, -6.6457e-02, -3.5121e-01, -1.4270e-01,
        -8.5121e-01,  3.0699e-01, -4.7307e-01,  8.9165e-02, -1.3376e-02,
         4.8777e-01, -5.5674e-01, -1.8258e-01, -2.4933e-01, -3.0187e-02,
         7.2991e-04, -3.0655e-01,  7.0122e-02,  2.1463e-01,  7.1067e-02,
        -1.9231e-01,  7.7804e-01, -2.5774e-01,  6.1410e-01, -5.7600e-01,
        -3.5497e-01, -1.7821e-01, -2.7461e-02, -8.8919e-01,  1.8416e-01,
         7.8318e-01,  9.1046e-01, -1.1845e+00,  2.6847e-01,  2.0299e-02,
        -1.0165e+00,  2.0661e-01,  3.9133e-01,  3.9541e-03, -5.7695e-01,
        -4.6958e-01, -5.6008e-01, -2.7362e-01,  1.0124e-01,  1.1420e-01,
        -6.1272e-01, -1.3364e+00,  2.5788e-01, -1.8874e-15, -1.8874e-15,
         3.3349e+00,  1.6496e-01,  2.4653e+00, -3.0001e+00,  6.2017e-01,
        -4.2434e-01,  2.1128e-01, -3.2378e-03, -6.4234e-02,  1.7868e-01,
         6.3353e-02, -1.5135e-01,  2.6132e-01,  7.4485e-01, -8.7168e-01,
         8.6667e-01, -3.3751e-14,  3.2715e-01,  3.2018e-02,  8.1440e-02,
         5.3465e-03,  3.7510e-01, -2.2634e-01,  5.1440e-02, -5.6171e-01,
         1.4176e-01, -2.3398e-01, -3.5403e-01,  3.5998e-01,  3.6210e-01,
        -4.1695e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5961]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-7.5348e-01,  1.3554e-01, -2.9087e-02,  1.1752e+00,  5.8472e-02,
        -4.6495e-01, -1.2306e+00, -8.3428e-01,  5.0188e-01,  7.2936e-01,
        -4.5772e-01,  3.4096e-02, -7.0936e-01,  2.2801e-01, -1.0923e-01,
         3.8983e-01, -1.5016e-01,  2.2063e-01,  2.3608e-01, -1.2307e-01,
        -7.1905e-01, -1.3374e-01, -2.1147e-02, -5.5224e-02, -7.1776e-02,
        -7.3495e-01, -6.6613e-01, -8.8215e-02,  8.7682e-01,  1.1964e+00,
        -3.4320e-01,  1.1315e-01,  3.9256e-01,  3.2387e-01, -7.1805e-01,
         8.3507e-02,  5.8209e-01, -7.0493e-01, -2.3222e-01, -1.2263e+00,
        -2.7175e-01,  3.1995e-01,  1.1293e+00, -2.8959e-01, -1.6379e-01,
        -6.9048e-01, -2.7985e-01, -4.5707e-01, -3.5778e-01, -5.7033e-01,
         7.4483e-01, -2.9821e-01, -4.7307e-01, -3.9351e-01, -7.3777e-01,
        -1.2796e-02, -9.4049e-01, -1.9648e-01,  3.6965e-01, -1.5662e-01,
         4.7428e-02,  5.4356e-01,  6.5940e-01,  8.6141e-01, -3.8418e-02,
         1.0883e-01, -3.4278e-01, -5.8231e-01,  1.9588e+00, -6.1354e-01,
        -3.5497e-01, -1.7821e-01, -2.7461e-02, -7.0124e-01,  6.8416e-02,
         8.6056e-02,  3.1839e-01,  8.8236e-01,  1.5077e+00,  2.0299e-02,
         9.0630e-01,  2.8118e-01, -2.7513e-01, -1.2173e+00, -1.1363e-01,
        -3.9740e-01, -5.0734e-01, -3.4772e-01, -3.4396e-01, -1.8867e-01,
         5.0457e-01, -9.5179e-01,  2.5788e-01, -1.8874e-15, -1.8874e-15,
        -2.9877e-01,  2.4693e-01, -1.4548e+00,  1.0317e+00, -6.3375e-01,
        -3.7270e-01, -3.6190e-01, -3.2378e-03, -4.8629e-01,  1.7868e-01,
         3.3095e+00, -2.0456e-01,  9.6982e-02,  6.2453e-01, -4.9548e-01,
        -1.7226e-01, -3.3751e-14,  2.8503e-01, -1.3409e+00, -1.5301e-01,
        -3.3747e+00, -5.0306e-01, -2.4199e-01,  5.1440e-02, -5.6842e-01,
        -3.5317e-01, -6.2841e-01, -6.7730e-01,  2.5577e-01,  1.1221e-01,
        -3.3692e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2122]), tensor(0.1476))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:main_restricted_month.py:Testing data year: 2013
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15992
            device: cpu
            
2024-08-01 01:06:30,116	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-01 01:06:30,209	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-01 01:06:30,240	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_14c409843300b763.zip' (1.47MiB) to Ray cluster...
2024-08-01 01:06:30,244	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_14c409843300b763.zip'.
2024-08-01 01:06:34,983	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-01 03:03:48,532	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_01-06-34' in 0.2256s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 4, 'num_embeddings': 15992, 'embedding_dim': 9, 'dropout_rate': 0.4, 'lr': 0.0023885558178688595, 'weight_decay': 0.0001745662692265934, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.0344392958007144
INFO:model_data_nn.py:Best trial testing loss: 0.01728669604010604
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-08-01_01-06-27_569169_365373/artifacts/2024-08-01_01-06-34/train_fnn_2024-08-01_01-06-34/driver_artifacts/train_fnn_f85a0_00008_8_dropout_rate=0.4000,embedding_dim=9,hidden_dim=35,lr=0.0024,num_layers=4,weight_decay=0.0002_2024-08-01_01-06-35
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 4, 'num_embeddings': 16138, 'embedding_dim': 9, 'dropout_rate': 0.4, 'lr': 0.0023885558178688595, 'weight_decay': 0.0001745662692265934, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03404765055610854, 'avg_test_loss': 0.018316121106104376}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.0340353230061006, 'avg_test_loss': 0.018438350572972443}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.034035718182119555, 'avg_test_loss': 0.01829543522540875}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03403477961467515, 'avg_test_loss': 0.01829762401387436}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03403446082962088, 'avg_test_loss': 0.01835423439238251}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03403404555073527, 'avg_test_loss': 0.018358309294794477}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.034036530763047676, 'avg_test_loss': 0.0184045149880153}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03403640736882325, 'avg_test_loss': 0.018509018647394845}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.034033324075861335, 'avg_test_loss': 0.018442052076942914}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03403270569845355, 'avg_test_loss': 0.018379575279685645}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03403349482726022, 'avg_test_loss': 0.01838038525077686}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.034033238237357204, 'avg_test_loss': 0.01829555389269287}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.03403231579819736, 'avg_test_loss': 0.01836315713113335}
INFO:model_data_nn.py:Early stopping at epoch 13
INFO:main_restricted_month.py:Making prediction for data in year: 2014
INFO:main_restricted_month.py:Prediction data shape: (39216,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2014: 0.13548670047241654
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  39216.000000  39216.000000
mean       0.004751      0.012978
std        0.135238      0.000000
min       -0.813122      0.012978
25%       -0.053242      0.012978
50%        0.003382      0.012978
75%        0.054622      0.012978
max        6.080164      0.012978
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:transform_data_nn.py:Train_data: (1669208, 161)

INFO:transform_data_nn.py:Test data years: [2014]
INFO:transform_data_nn.py:Test_data: (39216, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:transform_data_nn.py:Retrain_data: (1708424, 161)

INFO:transform_data_nn.py:Prediction data years: [2015]
INFO:transform_data_nn.py:Prediction_data: (39863, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1669208, 138])
            y_train_tf: torch.Size([1669208])

            x_test_tf: torch.Size([39216, 138])
            y_test_tf: torch.Size([39216])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1708424, 138])
            y_retrain_tf: torch.Size([1708424])

            x_prediction_tf: torch.Size([39863, 138])
            y_prediction_tf: torch.Size([39863])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.2511e-01,  9.3275e-01,  6.9032e-02, -1.6779e+00, -1.0372e-01,
        -8.3908e-01, -1.5048e-01, -3.4875e-01,  4.4744e-01, -1.6829e-01,
        -7.2095e-01,  8.4767e-02, -7.0936e-01, -5.5003e-01,  9.9669e-02,
         5.2145e-01, -1.2187e-01,  2.0511e-01, -8.7589e-02,  6.2321e-01,
        -4.1828e-01, -6.8465e-02, -1.8015e-01,  1.1259e-02, -9.3232e-02,
        -3.3859e-01, -5.9442e-01, -8.8215e-02,  2.8774e-01,  1.4183e+00,
         3.5026e-01, -1.1897e-01,  7.9418e-01,  3.2387e-01, -2.2571e-01,
        -2.2907e-01,  1.5939e-01,  9.1479e-01, -7.1619e-03, -1.1237e+00,
        -2.7126e-01,  3.0657e-01,  3.8249e-01,  2.9439e-02, -1.5667e-01,
        -7.3743e-01,  1.1529e-01, -6.6457e-02, -3.5121e-01, -1.4270e-01,
        -8.5121e-01,  3.0699e-01, -4.7307e-01,  8.9165e-02, -1.3376e-02,
         4.8777e-01, -5.5674e-01, -1.8258e-01, -2.4933e-01, -3.0187e-02,
         7.2991e-04, -3.0655e-01,  7.0122e-02,  2.1463e-01,  7.1067e-02,
        -1.9231e-01,  7.7804e-01, -2.5774e-01,  6.1410e-01, -5.7600e-01,
        -3.5497e-01, -1.7821e-01, -2.7461e-02, -8.8919e-01,  1.8416e-01,
         7.8318e-01,  9.1046e-01, -1.1845e+00,  2.6847e-01,  2.0299e-02,
        -1.0165e+00,  2.0661e-01,  3.9133e-01,  3.9541e-03, -5.7695e-01,
        -4.6958e-01, -5.6008e-01, -2.7362e-01,  1.0124e-01,  1.1420e-01,
        -6.1272e-01, -1.3364e+00,  2.5788e-01, -1.8874e-15, -1.8874e-15,
         3.3349e+00,  1.6496e-01,  2.4653e+00, -3.0001e+00,  6.2017e-01,
        -4.2434e-01,  2.1128e-01, -3.2378e-03, -6.4234e-02,  1.7868e-01,
         6.3353e-02, -1.5135e-01,  2.6132e-01,  7.4485e-01, -8.7168e-01,
         8.6667e-01, -3.3751e-14,  3.2715e-01,  3.2018e-02,  8.1440e-02,
         5.3465e-03,  3.7510e-01, -2.2634e-01,  5.1440e-02, -5.6171e-01,
         1.4176e-01, -2.3398e-01, -3.5403e-01,  3.5998e-01,  3.6210e-01,
        -4.1695e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5961]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-7.5348e-01,  1.3554e-01, -2.9087e-02,  1.1752e+00,  5.8472e-02,
        -4.6495e-01, -1.2306e+00, -8.3428e-01,  5.0188e-01,  7.2936e-01,
        -4.5772e-01,  3.4096e-02, -7.0936e-01,  2.2801e-01, -1.0923e-01,
         3.8983e-01, -1.5016e-01,  2.2063e-01,  2.3608e-01, -1.2307e-01,
        -7.1905e-01, -1.3374e-01, -2.1147e-02, -5.5224e-02, -7.1776e-02,
        -7.3495e-01, -6.6613e-01, -8.8215e-02,  8.7682e-01,  1.1964e+00,
        -3.4320e-01,  1.1315e-01,  3.9256e-01,  3.2387e-01, -7.1805e-01,
         8.3507e-02,  5.8209e-01, -7.0493e-01, -2.3222e-01, -1.2263e+00,
        -2.7175e-01,  3.1995e-01,  1.1293e+00, -2.8959e-01, -1.6379e-01,
        -6.9048e-01, -2.7985e-01, -4.5707e-01, -3.5778e-01, -5.7033e-01,
         7.4483e-01, -2.9821e-01, -4.7307e-01, -3.9351e-01, -7.3777e-01,
        -1.2796e-02, -9.4049e-01, -1.9648e-01,  3.6965e-01, -1.5662e-01,
         4.7428e-02,  5.4356e-01,  6.5940e-01,  8.6141e-01, -3.8418e-02,
         1.0883e-01, -3.4278e-01, -5.8231e-01,  1.9588e+00, -6.1354e-01,
        -3.5497e-01, -1.7821e-01, -2.7461e-02, -7.0124e-01,  6.8416e-02,
         8.6056e-02,  3.1839e-01,  8.8236e-01,  1.5077e+00,  2.0299e-02,
         9.0630e-01,  2.8118e-01, -2.7513e-01, -1.2173e+00, -1.1363e-01,
        -3.9740e-01, -5.0734e-01, -3.4772e-01, -3.4396e-01, -1.8867e-01,
         5.0457e-01, -9.5179e-01,  2.5788e-01, -1.8874e-15, -1.8874e-15,
        -2.9877e-01,  2.4693e-01, -1.4548e+00,  1.0317e+00, -6.3375e-01,
        -3.7270e-01, -3.6190e-01, -3.2378e-03, -4.8629e-01,  1.7868e-01,
         3.3095e+00, -2.0456e-01,  9.6982e-02,  6.2453e-01, -4.9548e-01,
        -1.7226e-01, -3.3751e-14,  2.8503e-01, -1.3409e+00, -1.5301e-01,
        -3.3747e+00, -5.0306e-01, -2.4199e-01,  5.1440e-02, -5.6842e-01,
        -3.5317e-01, -6.2841e-01, -6.7730e-01,  2.5577e-01,  1.1221e-01,
        -3.3692e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2122]), tensor(0.1476))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.2117e-01,  9.4017e-01,  6.8041e-02, -1.6892e+00, -1.0254e-01,
        -8.3625e-01, -1.5348e-01, -3.5084e-01,  4.5434e-01, -1.6803e-01,
        -7.2305e-01,  8.6450e-02, -7.1228e-01, -5.5549e-01,  1.0220e-01,
         5.2455e-01, -1.2040e-01,  2.0547e-01, -8.8091e-02,  6.3003e-01,
        -4.1612e-01, -6.7278e-02, -1.8340e-01,  1.1769e-02, -9.3727e-02,
        -3.3884e-01, -5.9391e-01, -9.0562e-02,  2.6577e-01,  1.4232e+00,
         3.5196e-01, -1.1880e-01,  7.9736e-01,  3.2753e-01, -2.2514e-01,
        -2.2765e-01,  1.6363e-01,  9.1467e-01, -4.9379e-03, -1.1150e+00,
        -2.6879e-01,  3.0096e-01,  3.8889e-01,  3.0609e-02, -1.5499e-01,
        -7.3152e-01,  1.1152e-01, -6.5919e-02, -3.5284e-01, -1.4409e-01,
        -8.5217e-01,  2.8902e-01, -4.7305e-01,  9.0998e-02, -1.0899e-02,
         4.8583e-01, -5.5041e-01, -1.8201e-01, -2.5025e-01, -2.7822e-02,
        -4.3288e-04, -3.0736e-01,  6.7678e-02,  2.1622e-01,  7.2545e-02,
        -1.9429e-01,  7.8581e-01, -2.5494e-01,  6.1112e-01, -5.7655e-01,
        -3.5621e-01, -1.7933e-01, -2.7362e-02, -8.8272e-01,  1.8598e-01,
         7.9173e-01,  9.1821e-01, -1.1874e+00,  2.6615e-01,  2.0602e-02,
        -1.0197e+00,  2.1042e-01,  4.0040e-01,  2.0162e-02, -5.7754e-01,
        -4.7272e-01, -5.6151e-01, -2.7329e-01,  1.0497e-01,  1.1512e-01,
        -6.1823e-01, -1.3357e+00,  2.6129e-01,  2.5535e-15,  2.5535e-15,
         3.3763e+00,  1.6144e-01,  2.4680e+00, -3.0349e+00,  6.4125e-01,
        -4.2102e-01,  2.1697e-01, -1.4005e-04, -6.2528e-02,  1.7156e-01,
         6.3363e-02, -1.5268e-01,  2.6718e-01,  7.8774e-01, -8.6347e-01,
         8.8283e-01, -5.3291e-15,  3.2339e-01,  2.2560e-02,  7.2049e-02,
         8.5025e-03,  3.8468e-01, -2.2609e-01,  6.5159e-02, -5.6027e-01,
         1.4211e-01, -2.2795e-01, -3.5203e-01,  3.6064e-01,  3.6088e-01,
        -4.1634e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6037]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-3.5717e-01, -1.8188e-01, -5.3783e-01,  1.1607e+00, -2.2890e-01,
        -5.5991e-01, -9.9019e-01, -7.7564e-01,  1.0474e-01,  3.6153e-01,
        -7.4988e-01,  7.2767e-03, -7.1228e-01,  3.7581e-01,  6.9916e-02,
         3.3126e-01, -2.1001e-01,  7.3168e-01, -2.0650e-02, -9.3916e-04,
        -6.0838e-01, -1.2317e+00, -3.6269e-01, -1.8257e-01, -3.4554e-01,
        -8.0149e-01, -6.6441e-01, -9.0562e-02,  1.7216e-01,  9.1449e-01,
        -1.8451e-01, -2.3643e-01,  2.8778e-01,  3.2753e-01, -7.7692e-01,
        -3.7060e-01,  1.6908e-01, -7.0935e-01,  2.9487e-01, -9.8413e-01,
        -2.6828e-01,  2.5531e-02, -2.2523e-01, -3.5729e-01, -1.7557e-01,
        -8.1330e-01,  6.6405e-01, -3.1822e-01, -5.8136e-01,  1.7219e-01,
         1.5416e+00, -1.6327e-01, -4.7305e-01, -4.0049e-01, -1.0899e-02,
        -7.1759e-02, -9.3602e-01,  5.3200e-02, -4.7390e-01,  1.0957e-01,
        -7.1146e-01, -5.2165e-01,  2.8551e-01,  7.6178e-01, -3.8956e-02,
        -9.7441e-02, -4.7923e-01,  1.3843e-01,  6.1112e-01, -6.8187e-01,
        -3.5621e-01, -1.7933e-01, -2.7362e-02, -8.9762e-01,  2.2869e-03,
        -1.0320e-01,  9.1821e-01,  8.8175e-01,  1.5113e+00,  2.0602e-02,
         8.6809e-01,  2.8700e-01, -3.2937e-01, -1.0419e+00, -4.4081e-01,
        -3.7626e-01, -4.9719e-01, -3.3133e-01, -6.5548e-01, -3.9117e-01,
        -3.2848e-01, -2.6037e-01,  2.6129e-01,  2.5535e-15,  2.5535e-15,
        -2.0460e-01, -8.7127e-02, -1.4164e+00,  1.0176e-01, -1.9013e-01,
        -1.3304e-01, -5.3304e-04, -1.4005e-04, -2.2024e-01,  1.7156e-01,
         2.6423e+00, -2.0643e-01,  4.9580e-01,  5.4163e-01, -3.5714e-01,
        -4.3687e-01, -5.3291e-15,  1.2211e-01, -6.5600e-01, -5.0500e-01,
        -6.9602e-01, -4.5728e-01, -2.4597e-01,  6.5159e-02, -3.8607e-01,
         2.9223e-01, -4.9867e-01, -7.1642e-01,  2.3093e-01,  9.0875e-02,
        -3.8462e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2177]), tensor(-0.1152))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:main_restricted_month.py:Testing data year: 2014
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 16138
            device: cpu
            
2024-08-01 06:48:43,565	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-01 06:48:43,606	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-01 06:48:43,640	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_14c409843300b763.zip' (1.47MiB) to Ray cluster...
2024-08-01 06:48:43,645	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_14c409843300b763.zip'.
2024-08-01 06:48:48,340	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-01 06:54:40,968	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 30.25 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-01 09:43:18,664	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_06-48-48' in 0.2342s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 3, 'num_embeddings': 16138, 'embedding_dim': 9, 'dropout_rate': 0.37, 'lr': 0.0005884968350790236, 'weight_decay': 6.4303853792601085e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03254062752251904
INFO:model_data_nn.py:Best trial testing loss: 0.018304408669204346
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-08-01_06-48-40_990211_365373/artifacts/2024-08-01_06-48-48/train_fnn_2024-08-01_06-48-48/driver_artifacts/train_fnn_c72fb_00019_19_dropout_rate=0.3700,embedding_dim=9,hidden_dim=65,lr=0.0006,num_layers=3,weight_decay=0.0000_2024-08-01_06-48-48
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 3, 'num_embeddings': 16336, 'embedding_dim': 9, 'dropout_rate': 0.37, 'lr': 0.0005884968350790236, 'weight_decay': 6.4303853792601085e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.033347383396824574, 'avg_test_loss': 0.03173433469098665}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.03286995549533969, 'avg_test_loss': 0.03148594662961199}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.03259776063484254, 'avg_test_loss': 0.031820892241602554}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03244533954780618, 'avg_test_loss': 0.031618931360638446}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03237558548215035, 'avg_test_loss': 0.031254238692332015}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03238639548845836, 'avg_test_loss': 0.03175821920324649}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03235103818555688, 'avg_test_loss': 0.0315151924919935}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03232135685099005, 'avg_test_loss': 0.03179937487626583}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03232452163220186, 'avg_test_loss': 0.031428710234622036}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.032282601192099566, 'avg_test_loss': 0.03178352418088057}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03229816763824552, 'avg_test_loss': 0.031586302719026634}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.03228730708924105, 'avg_test_loss': 0.031002978860052304}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.032340789682961515, 'avg_test_loss': 0.031247039345716446}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.03226665556388952, 'avg_test_loss': 0.031629161729460904}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.03229332400636239, 'avg_test_loss': 0.03156254908748653}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.03229818267433423, 'avg_test_loss': 0.031615198491945454}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.03230511667405742, 'avg_test_loss': 0.03169268896028902}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.03229417961476659, 'avg_test_loss': 0.03183870839573933}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.03229460746932884, 'avg_test_loss': 0.03162128417072504}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.03226810362412242, 'avg_test_loss': 0.031495511573687025}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.03228709636113758, 'avg_test_loss': 0.03170329265716526}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.03227653439849403, 'avg_test_loss': 0.03161427465433413}
INFO:model_data_nn.py:Early stopping at epoch 22
INFO:main_restricted_month.py:Making prediction for data in year: 2015
INFO:main_restricted_month.py:Prediction data shape: (39863,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2015: 0.17779608580287296
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  39863.000000  39863.000000
mean      -0.004509      0.022655
std        0.175769      0.013365
min       -0.928773     -0.121092
25%       -0.066785      0.018579
50%       -0.005785      0.021490
75%        0.050659      0.025810
max       15.984456      0.230130
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:transform_data_nn.py:Train_data: (1708424, 161)

INFO:transform_data_nn.py:Test data years: [2015]
INFO:transform_data_nn.py:Test_data: (39863, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:transform_data_nn.py:Retrain_data: (1748287, 161)

INFO:transform_data_nn.py:Prediction data years: [2016]
INFO:transform_data_nn.py:Prediction_data: (40029, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1708424, 138])
            y_train_tf: torch.Size([1708424])

            x_test_tf: torch.Size([39863, 138])
            y_test_tf: torch.Size([39863])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1748287, 138])
            y_retrain_tf: torch.Size([1748287])

            x_prediction_tf: torch.Size([40029, 138])
            y_prediction_tf: torch.Size([40029])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.2117e-01,  9.4017e-01,  6.8041e-02, -1.6892e+00, -1.0254e-01,
        -8.3625e-01, -1.5348e-01, -3.5084e-01,  4.5434e-01, -1.6803e-01,
        -7.2305e-01,  8.6450e-02, -7.1228e-01, -5.5549e-01,  1.0220e-01,
         5.2455e-01, -1.2040e-01,  2.0547e-01, -8.8091e-02,  6.3003e-01,
        -4.1612e-01, -6.7278e-02, -1.8340e-01,  1.1769e-02, -9.3727e-02,
        -3.3884e-01, -5.9391e-01, -9.0562e-02,  2.6577e-01,  1.4232e+00,
         3.5196e-01, -1.1880e-01,  7.9736e-01,  3.2753e-01, -2.2514e-01,
        -2.2765e-01,  1.6363e-01,  9.1467e-01, -4.9379e-03, -1.1150e+00,
        -2.6879e-01,  3.0096e-01,  3.8889e-01,  3.0609e-02, -1.5499e-01,
        -7.3152e-01,  1.1152e-01, -6.5919e-02, -3.5284e-01, -1.4409e-01,
        -8.5217e-01,  2.8902e-01, -4.7305e-01,  9.0998e-02, -1.0899e-02,
         4.8583e-01, -5.5041e-01, -1.8201e-01, -2.5025e-01, -2.7822e-02,
        -4.3288e-04, -3.0736e-01,  6.7678e-02,  2.1622e-01,  7.2545e-02,
        -1.9429e-01,  7.8581e-01, -2.5494e-01,  6.1112e-01, -5.7655e-01,
        -3.5621e-01, -1.7933e-01, -2.7362e-02, -8.8272e-01,  1.8598e-01,
         7.9173e-01,  9.1821e-01, -1.1874e+00,  2.6615e-01,  2.0602e-02,
        -1.0197e+00,  2.1042e-01,  4.0040e-01,  2.0162e-02, -5.7754e-01,
        -4.7272e-01, -5.6151e-01, -2.7329e-01,  1.0497e-01,  1.1512e-01,
        -6.1823e-01, -1.3357e+00,  2.6129e-01,  2.5535e-15,  2.5535e-15,
         3.3763e+00,  1.6144e-01,  2.4680e+00, -3.0349e+00,  6.4125e-01,
        -4.2102e-01,  2.1697e-01, -1.4005e-04, -6.2528e-02,  1.7156e-01,
         6.3363e-02, -1.5268e-01,  2.6718e-01,  7.8774e-01, -8.6347e-01,
         8.8283e-01, -5.3291e-15,  3.2339e-01,  2.2560e-02,  7.2049e-02,
         8.5025e-03,  3.8468e-01, -2.2609e-01,  6.5159e-02, -5.6027e-01,
         1.4211e-01, -2.2795e-01, -3.5203e-01,  3.6064e-01,  3.6088e-01,
        -4.1634e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6037]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-3.5717e-01, -1.8188e-01, -5.3783e-01,  1.1607e+00, -2.2890e-01,
        -5.5991e-01, -9.9019e-01, -7.7564e-01,  1.0474e-01,  3.6153e-01,
        -7.4988e-01,  7.2767e-03, -7.1228e-01,  3.7581e-01,  6.9916e-02,
         3.3126e-01, -2.1001e-01,  7.3168e-01, -2.0650e-02, -9.3916e-04,
        -6.0838e-01, -1.2317e+00, -3.6269e-01, -1.8257e-01, -3.4554e-01,
        -8.0149e-01, -6.6441e-01, -9.0562e-02,  1.7216e-01,  9.1449e-01,
        -1.8451e-01, -2.3643e-01,  2.8778e-01,  3.2753e-01, -7.7692e-01,
        -3.7060e-01,  1.6908e-01, -7.0935e-01,  2.9487e-01, -9.8413e-01,
        -2.6828e-01,  2.5531e-02, -2.2523e-01, -3.5729e-01, -1.7557e-01,
        -8.1330e-01,  6.6405e-01, -3.1822e-01, -5.8136e-01,  1.7219e-01,
         1.5416e+00, -1.6327e-01, -4.7305e-01, -4.0049e-01, -1.0899e-02,
        -7.1759e-02, -9.3602e-01,  5.3200e-02, -4.7390e-01,  1.0957e-01,
        -7.1146e-01, -5.2165e-01,  2.8551e-01,  7.6178e-01, -3.8956e-02,
        -9.7441e-02, -4.7923e-01,  1.3843e-01,  6.1112e-01, -6.8187e-01,
        -3.5621e-01, -1.7933e-01, -2.7362e-02, -8.9762e-01,  2.2869e-03,
        -1.0320e-01,  9.1821e-01,  8.8175e-01,  1.5113e+00,  2.0602e-02,
         8.6809e-01,  2.8700e-01, -3.2937e-01, -1.0419e+00, -4.4081e-01,
        -3.7626e-01, -4.9719e-01, -3.3133e-01, -6.5548e-01, -3.9117e-01,
        -3.2848e-01, -2.6037e-01,  2.6129e-01,  2.5535e-15,  2.5535e-15,
        -2.0460e-01, -8.7127e-02, -1.4164e+00,  1.0176e-01, -1.9013e-01,
        -1.3304e-01, -5.3304e-04, -1.4005e-04, -2.2024e-01,  1.7156e-01,
         2.6423e+00, -2.0643e-01,  4.9580e-01,  5.4163e-01, -3.5714e-01,
        -4.3687e-01, -5.3291e-15,  1.2211e-01, -6.5600e-01, -5.0500e-01,
        -6.9602e-01, -4.5728e-01, -2.4597e-01,  6.5159e-02, -3.8607e-01,
         2.9223e-01, -4.9867e-01, -7.1642e-01,  2.3093e-01,  9.0875e-02,
        -3.8462e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2177]), tensor(-0.1152))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.1815e-01,  9.4640e-01,  6.6655e-02, -1.6980e+00, -1.0146e-01,
        -8.3540e-01, -1.5721e-01, -3.5341e-01,  4.5826e-01, -1.6808e-01,
        -7.2445e-01,  9.0484e-02, -7.1443e-01, -5.5737e-01,  1.0486e-01,
         5.2677e-01, -1.1883e-01,  2.0488e-01, -8.7526e-02,  6.3612e-01,
        -4.1634e-01, -6.9795e-02, -1.8558e-01,  1.3202e-02, -9.4613e-02,
        -3.3940e-01, -5.9356e-01, -9.1272e-02,  2.4365e-01,  1.4273e+00,
         3.5248e-01, -1.1696e-01,  7.9910e-01,  3.3120e-01, -2.2369e-01,
        -2.2649e-01,  1.6691e-01,  9.1763e-01, -4.4140e-03, -1.1055e+00,
        -2.6668e-01,  3.1237e-01,  3.9505e-01,  3.0835e-02, -1.5472e-01,
        -7.2759e-01,  1.1625e-01, -6.4468e-02, -3.5893e-01, -1.4108e-01,
        -8.5296e-01,  2.7210e-01, -4.7298e-01,  9.3382e-02, -8.0430e-03,
         4.8317e-01, -5.4415e-01, -1.8111e-01, -2.5027e-01, -2.6867e-02,
        -2.6593e-04, -3.0700e-01,  6.8521e-02,  2.1563e-01,  7.3669e-02,
        -1.9392e-01,  7.9265e-01, -2.5264e-01,  6.0946e-01, -5.7690e-01,
        -3.5781e-01, -1.8066e-01, -2.7231e-02, -8.7891e-01,  1.8938e-01,
         7.9892e-01,  9.2576e-01, -1.1904e+00,  2.6247e-01,  2.0212e-02,
        -1.0253e+00,  2.1242e-01,  4.0796e-01,  3.5258e-02, -5.7837e-01,
        -4.7698e-01, -5.6319e-01, -2.7321e-01,  1.0871e-01,  1.1597e-01,
        -6.2392e-01, -1.3339e+00,  2.6491e-01,  3.4417e-15,  3.4417e-15,
         3.4186e+00,  1.7989e-01,  2.4735e+00, -3.0718e+00,  6.4556e-01,
        -4.2210e-01,  2.2223e-01,  6.3960e-06, -5.9170e-02,  1.6632e-01,
         4.8699e-02, -1.5337e-01,  2.6683e-01,  8.2349e-01, -8.6196e-01,
         8.9944e-01,  0.0000e+00,  3.2056e-01,  3.1167e-02,  6.3727e-02,
         8.7324e-03,  3.9406e-01, -2.2657e-01,  7.6658e-02, -5.5855e-01,
         1.4346e-01, -2.2182e-01, -3.4903e-01,  3.6199e-01,  3.5951e-01,
        -4.1503e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6148]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-3.6207e-01, -1.7088e-01, -6.7639e-01,  1.1481e+00, -4.0391e-01,
        -1.7848e-01, -1.0166e+00, -7.8513e-01,  6.7677e-01,  7.9195e-01,
        -6.7890e-01, -7.5354e-02, -7.1443e-01,  4.7845e-01,  9.8616e-02,
        -1.9618e-01, -2.0521e-01, -5.2216e-01, -2.1302e-02, -3.9874e-01,
        -4.2657e-01, -1.3381e-01, -1.5661e-01, -2.1226e-01, -2.2060e-01,
        -8.1051e-01, -6.7302e-01, -9.1272e-02, -3.3184e-01,  1.6398e+00,
        -3.3535e-01, -2.0838e-01,  1.9171e-01,  3.3120e-01, -8.0817e-01,
        -3.1582e-01, -1.2723e-01, -7.1070e-01, -9.2046e-01, -9.9129e-01,
        -2.6203e-01, -6.1019e-01, -1.5432e-01, -2.4310e-01, -4.0899e-01,
         1.0035e+00, -5.3086e-01, -9.4895e-01,  6.8735e-03, -5.1251e-01,
         7.4322e-01, -3.5985e-01, -4.7298e-01, -4.0719e-01, -7.3828e-01,
        -1.3526e-01, -9.3164e-01, -2.0107e-01, -2.0248e-01, -3.1305e-01,
        -3.8403e-02, -1.9839e-01,  3.6470e-01,  4.8632e-01, -3.8397e-02,
         2.8691e-02, -4.7732e-01,  2.5637e-01,  6.0946e-01, -6.8792e-01,
        -3.5781e-01, -1.8066e-01, -2.7231e-02,  3.6602e-01, -6.9906e-02,
        -1.4043e-01,  9.2576e-01,  8.8097e-01,  1.5140e+00,  2.0212e-02,
         8.4911e-01, -5.7603e-01, -1.8850e-01, -5.4227e-01, -2.8406e-01,
        -3.6601e-01, -4.9672e-01, -4.1937e-01, -4.6640e-01, -2.7863e-01,
        -2.5935e-01, -4.2232e-01,  2.6491e-01,  3.4417e-15,  3.4417e-15,
        -2.5088e-01, -1.4914e+00, -1.3054e+00,  1.1437e-01,  1.0312e+00,
         3.0446e-02, -9.4918e-01,  6.3960e-06, -2.4860e-02,  1.6632e-01,
         2.1899e+00,  2.0727e-02, -3.3416e+00,  7.6775e-01, -6.7283e-01,
        -1.8512e-01,  0.0000e+00,  8.8638e-02, -1.4849e+00, -2.9543e-01,
        -6.9062e-01, -5.2278e-01, -3.5835e-01,  7.6658e-02, -2.8026e-01,
        -9.7116e-02, -5.6274e-01, -8.1925e-01,  1.4522e-01, -1.1762e-02,
        -4.0288e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00]), tensor([2140]), tensor(0.1168))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:main_restricted_month.py:Testing data year: 2015
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 16336
            device: cpu
            
2024-08-01 13:44:56,915	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-01 13:44:56,962	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-01 13:44:57,000	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_14c409843300b763.zip' (1.47MiB) to Ray cluster...
2024-08-01 13:44:57,004	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_14c409843300b763.zip'.
2024-08-01 13:45:01,782	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-01 19:30:12,842	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_13-45-01' in 0.2414s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 16336, 'embedding_dim': 10, 'dropout_rate': 0.22, 'lr': 1.0672476836323728e-06, 'weight_decay': 1.1727009450102268e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.033602733549058905
INFO:model_data_nn.py:Best trial testing loss: 0.03111487111700086
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-08-01_13-44-54_340714_365373/artifacts/2024-08-01_13-45-01/train_fnn_2024-08-01_13-45-01/driver_artifacts/train_fnn_ec847_00002_2_dropout_rate=0.2200,embedding_dim=10,hidden_dim=5,lr=0.0000,num_layers=4,weight_decay=0.0000_2024-08-01_13-45-01
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 16626, 'embedding_dim': 10, 'dropout_rate': 0.22, 'lr': 1.0672476836323728e-06, 'weight_decay': 1.1727009450102268e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03382523632058943, 'avg_test_loss': 0.028442347200197605}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.033660852949907866, 'avg_test_loss': 0.02838360126124332}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.033625981258734707, 'avg_test_loss': 0.028366434305665284}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.033608575492886476, 'avg_test_loss': 0.02835980427344315}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03360509119429646, 'avg_test_loss': 0.028358287557724494}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03359890539134951, 'avg_test_loss': 0.02835604481208629}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.033595524614290696, 'avg_test_loss': 0.028356658096556155}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03359468443358136, 'avg_test_loss': 0.028356427429452206}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03359156371763774, 'avg_test_loss': 0.02835479594831066}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03359048653510719, 'avg_test_loss': 0.028354717946697635}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.0335893136316604, 'avg_test_loss': 0.02835424473961464}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.03358889387756647, 'avg_test_loss': 0.028355758674011324}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.03358847125513061, 'avg_test_loss': 0.028354052663260042}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.03358847210393072, 'avg_test_loss': 0.028354888360504024}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.03358692192420457, 'avg_test_loss': 0.02835497056422666}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.03358715643797589, 'avg_test_loss': 0.028353670341581608}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.03358663530276985, 'avg_test_loss': 0.028355627325541987}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.033587206423647556, 'avg_test_loss': 0.028353111827731155}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.033585769732209954, 'avg_test_loss': 0.02835356815236088}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.03358629151690755, 'avg_test_loss': 0.02835434206654303}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.033585491662871406, 'avg_test_loss': 0.028355440689836996}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.033584416402972904, 'avg_test_loss': 0.028354979062545152}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.03358407904614111, 'avg_test_loss': 0.028353965743415106}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.03358380256544106, 'avg_test_loss': 0.028353516078262496}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.03358327112247799, 'avg_test_loss': 0.02835434427806221}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.03358146572056265, 'avg_test_loss': 0.02835524437901454}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.03358119163620193, 'avg_test_loss': 0.028351545935651413}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.03358000077065981, 'avg_test_loss': 0.02835608250387132}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.033580212339570814, 'avg_test_loss': 0.028355923581707736}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.03358034214692056, 'avg_test_loss': 0.028353499582992457}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.03357783120261087, 'avg_test_loss': 0.028355285337495324}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.03357835261543743, 'avg_test_loss': 0.02835461287796438}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.033577461491584415, 'avg_test_loss': 0.028354794594099203}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.03357477189028821, 'avg_test_loss': 0.0283552972628131}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.033574362596467004, 'avg_test_loss': 0.02835837308430491}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.0335744717614714, 'avg_test_loss': 0.028354911631294572}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.03357352132382227, 'avg_test_loss': 0.028353539069358724}
INFO:model_data_nn.py:Early stopping at epoch 37
INFO:main_restricted_month.py:Making prediction for data in year: 2016
INFO:main_restricted_month.py:Prediction data shape: (40029,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2016: 0.16840099137652065
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  40029.000000  40029.000000
mean       0.015965      0.012335
std        0.168371      0.002637
min       -0.961852      0.009635
25%       -0.051377      0.009850
50%        0.009668      0.011170
75%        0.073842      0.014932
max        7.634921      0.025856
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:transform_data_nn.py:Train_data: (1748287, 161)

INFO:transform_data_nn.py:Test data years: [2016]
INFO:transform_data_nn.py:Test_data: (40029, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]
INFO:transform_data_nn.py:Retrain_data: (1788316, 161)

INFO:transform_data_nn.py:Prediction data years: [2017]
INFO:transform_data_nn.py:Prediction_data: (39152, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1748287, 138])
            y_train_tf: torch.Size([1748287])

            x_test_tf: torch.Size([40029, 138])
            y_test_tf: torch.Size([40029])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1788316, 138])
            y_retrain_tf: torch.Size([1788316])

            x_prediction_tf: torch.Size([39152, 138])
            y_prediction_tf: torch.Size([39152])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.1815e-01,  9.4640e-01,  6.6655e-02, -1.6980e+00, -1.0146e-01,
        -8.3540e-01, -1.5721e-01, -3.5341e-01,  4.5826e-01, -1.6808e-01,
        -7.2445e-01,  9.0484e-02, -7.1443e-01, -5.5737e-01,  1.0486e-01,
         5.2677e-01, -1.1883e-01,  2.0488e-01, -8.7526e-02,  6.3612e-01,
        -4.1634e-01, -6.9795e-02, -1.8558e-01,  1.3202e-02, -9.4613e-02,
        -3.3940e-01, -5.9356e-01, -9.1272e-02,  2.4365e-01,  1.4273e+00,
         3.5248e-01, -1.1696e-01,  7.9910e-01,  3.3120e-01, -2.2369e-01,
        -2.2649e-01,  1.6691e-01,  9.1763e-01, -4.4140e-03, -1.1055e+00,
        -2.6668e-01,  3.1237e-01,  3.9505e-01,  3.0835e-02, -1.5472e-01,
        -7.2759e-01,  1.1625e-01, -6.4468e-02, -3.5893e-01, -1.4108e-01,
        -8.5296e-01,  2.7210e-01, -4.7298e-01,  9.3382e-02, -8.0430e-03,
         4.8317e-01, -5.4415e-01, -1.8111e-01, -2.5027e-01, -2.6867e-02,
        -2.6593e-04, -3.0700e-01,  6.8521e-02,  2.1563e-01,  7.3669e-02,
        -1.9392e-01,  7.9265e-01, -2.5264e-01,  6.0946e-01, -5.7690e-01,
        -3.5781e-01, -1.8066e-01, -2.7231e-02, -8.7891e-01,  1.8938e-01,
         7.9892e-01,  9.2576e-01, -1.1904e+00,  2.6247e-01,  2.0212e-02,
        -1.0253e+00,  2.1242e-01,  4.0796e-01,  3.5258e-02, -5.7837e-01,
        -4.7698e-01, -5.6319e-01, -2.7321e-01,  1.0871e-01,  1.1597e-01,
        -6.2392e-01, -1.3339e+00,  2.6491e-01,  3.4417e-15,  3.4417e-15,
         3.4186e+00,  1.7989e-01,  2.4735e+00, -3.0718e+00,  6.4556e-01,
        -4.2210e-01,  2.2223e-01,  6.3960e-06, -5.9170e-02,  1.6632e-01,
         4.8699e-02, -1.5337e-01,  2.6683e-01,  8.2349e-01, -8.6196e-01,
         8.9944e-01,  0.0000e+00,  3.2056e-01,  3.1167e-02,  6.3727e-02,
         8.7324e-03,  3.9406e-01, -2.2657e-01,  7.6658e-02, -5.5855e-01,
         1.4346e-01, -2.2182e-01, -3.4903e-01,  3.6199e-01,  3.5951e-01,
        -4.1503e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6148]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-3.6207e-01, -1.7088e-01, -6.7639e-01,  1.1481e+00, -4.0391e-01,
        -1.7848e-01, -1.0166e+00, -7.8513e-01,  6.7677e-01,  7.9195e-01,
        -6.7890e-01, -7.5354e-02, -7.1443e-01,  4.7845e-01,  9.8616e-02,
        -1.9618e-01, -2.0521e-01, -5.2216e-01, -2.1302e-02, -3.9874e-01,
        -4.2657e-01, -1.3381e-01, -1.5661e-01, -2.1226e-01, -2.2060e-01,
        -8.1051e-01, -6.7302e-01, -9.1272e-02, -3.3184e-01,  1.6398e+00,
        -3.3535e-01, -2.0838e-01,  1.9171e-01,  3.3120e-01, -8.0817e-01,
        -3.1582e-01, -1.2723e-01, -7.1070e-01, -9.2046e-01, -9.9129e-01,
        -2.6203e-01, -6.1019e-01, -1.5432e-01, -2.4310e-01, -4.0899e-01,
         1.0035e+00, -5.3086e-01, -9.4895e-01,  6.8735e-03, -5.1251e-01,
         7.4322e-01, -3.5985e-01, -4.7298e-01, -4.0719e-01, -7.3828e-01,
        -1.3526e-01, -9.3164e-01, -2.0107e-01, -2.0248e-01, -3.1305e-01,
        -3.8403e-02, -1.9839e-01,  3.6470e-01,  4.8632e-01, -3.8397e-02,
         2.8691e-02, -4.7732e-01,  2.5637e-01,  6.0946e-01, -6.8792e-01,
        -3.5781e-01, -1.8066e-01, -2.7231e-02,  3.6602e-01, -6.9906e-02,
        -1.4043e-01,  9.2576e-01,  8.8097e-01,  1.5140e+00,  2.0212e-02,
         8.4911e-01, -5.7603e-01, -1.8850e-01, -5.4227e-01, -2.8406e-01,
        -3.6601e-01, -4.9672e-01, -4.1937e-01, -4.6640e-01, -2.7863e-01,
        -2.5935e-01, -4.2232e-01,  2.6491e-01,  3.4417e-15,  3.4417e-15,
        -2.5088e-01, -1.4914e+00, -1.3054e+00,  1.1437e-01,  1.0312e+00,
         3.0446e-02, -9.4918e-01,  6.3960e-06, -2.4860e-02,  1.6632e-01,
         2.1899e+00,  2.0727e-02, -3.3416e+00,  7.6775e-01, -6.7283e-01,
        -1.8512e-01,  0.0000e+00,  8.8638e-02, -1.4849e+00, -2.9543e-01,
        -6.9062e-01, -5.2278e-01, -3.5835e-01,  7.6658e-02, -2.8026e-01,
        -9.7116e-02, -5.6274e-01, -8.1925e-01,  1.4522e-01, -1.1762e-02,
        -4.0288e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00]), tensor([2140]), tensor(0.1168))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.1763e-01,  9.5219e-01,  6.5611e-02, -1.7060e+00, -9.8155e-02,
        -8.3588e-01, -1.5969e-01, -3.5494e-01,  4.6149e-01, -1.6720e-01,
        -7.2541e-01,  9.7231e-02, -7.1562e-01, -5.5695e-01,  1.0518e-01,
         5.3003e-01, -1.1721e-01,  2.0461e-01, -8.8165e-02,  6.4341e-01,
        -4.2011e-01, -6.7377e-02, -1.8395e-01,  1.5133e-02, -9.3628e-02,
        -3.3986e-01, -5.9362e-01, -9.3008e-02,  2.2500e-01,  1.4296e+00,
         3.5246e-01, -1.1374e-01,  8.0018e-01,  3.3454e-01, -2.2029e-01,
        -2.2597e-01,  1.7064e-01,  9.2059e-01, -4.2516e-03, -1.0979e+00,
        -2.6469e-01,  3.2821e-01,  4.0297e-01,  3.0438e-02, -1.5354e-01,
        -7.2488e-01,  1.2386e-01, -6.4427e-02, -3.5937e-01, -1.3871e-01,
        -8.5454e-01,  2.5731e-01, -4.7272e-01,  9.6298e-02, -5.2202e-03,
         4.7992e-01, -5.3824e-01, -1.8040e-01, -2.4883e-01, -2.7247e-02,
         4.0819e-05, -3.0542e-01,  6.8207e-02,  2.1552e-01,  7.5761e-02,
        -1.9428e-01,  8.0060e-01, -2.5112e-01,  6.0873e-01, -5.7701e-01,
        -3.5981e-01, -1.8248e-01, -2.7479e-02, -8.7669e-01,  1.9472e-01,
         8.0588e-01,  9.3293e-01, -1.1937e+00,  2.5847e-01,  1.9554e-02,
        -1.0474e+00,  2.1564e-01,  4.1447e-01,  4.9761e-02, -5.7877e-01,
        -4.8335e-01, -5.6522e-01, -2.7366e-01,  1.1228e-01,  1.1667e-01,
        -6.2921e-01, -1.3327e+00,  2.6799e-01,  2.3315e-15,  2.3315e-15,
         3.4606e+00,  2.1398e-01,  2.4852e+00, -3.0952e+00,  6.4673e-01,
        -4.2188e-01,  2.2978e-01,  7.6728e-06, -5.6486e-02,  1.6403e-01,
         4.7145e-02, -1.5407e-01,  2.3249e-01,  8.2087e-01, -8.4948e-01,
         9.1819e-01, -4.2633e-14,  3.1952e-01,  3.6817e-02,  5.7159e-02,
         6.1785e-03,  4.0358e-01, -2.2603e-01,  8.7077e-02, -5.5734e-01,
         1.4496e-01, -2.1624e-01, -3.4399e-01,  3.6469e-01,  3.5811e-01,
        -4.1345e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6211]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-3.9759e-01, -1.3312e-01, -5.5374e-01,  1.1362e+00, -4.6411e-01,
        -1.0041e+00, -1.3257e+00, -8.5645e-01, -5.7581e-02,  1.2036e-01,
        -6.5205e-01, -7.3877e-02, -5.8461e-01,  1.2690e-01, -1.8803e-01,
        -2.3635e-01, -2.0487e-01, -1.3920e-01, -2.2370e-02, -2.1553e-01,
         1.8015e+00, -1.3374e-01, -5.4120e-02, -2.8857e-01, -3.1344e-01,
        -7.0795e-01, -6.5426e-01, -9.3008e-02,  6.7193e-01,  8.8108e-01,
         1.1558e-01, -3.2450e-01,  9.7662e-02,  3.3454e-01, -8.5727e-01,
        -6.2755e-01, -3.7026e-01, -7.0229e-01, -5.8366e-01, -8.9576e-02,
        -2.6580e-01,  3.7638e-01, -4.3459e-01, -4.1506e-01, -3.7243e-01,
        -9.0863e-01,  1.0845e+00,  2.6114e-03, -3.0365e-01,  2.2217e+00,
        -5.6064e-02, -1.2922e-01, -4.7272e-01, -4.1366e-01, -7.3855e-01,
        -2.0219e-01, -9.2752e-01, -4.2305e-01,  5.1937e-01,  1.8264e-01,
        -2.3803e-01,  3.7431e-01, -3.0920e-01, -1.0074e+00, -3.7874e-02,
        -3.9331e-01, -4.7557e-01,  9.5393e-01, -7.3707e-01, -6.1656e-01,
        -3.5981e-01, -1.8248e-01, -2.7479e-02, -1.1145e+00, -1.3183e-01,
        -8.5962e-02,  9.3293e-01,  8.7934e-01,  1.5139e+00,  1.9554e-02,
         7.1515e-01, -7.7032e-01, -4.7822e-01, -4.9699e-01, -2.0887e-01,
        -3.6939e-01, -4.9617e-01, -3.2084e-01, -3.5408e-01,  3.2478e-01,
        -2.4470e-01, -4.1879e-01,  2.6799e-01,  2.3315e-15,  2.3315e-15,
        -3.4870e-01, -1.5644e+00, -1.1789e+00, -5.4354e-02, -6.1084e-01,
        -4.1139e-01, -4.7106e-02,  1.0885e+00,  3.5691e-01,  7.6950e-01,
         1.5397e+00, -3.1704e-01, -3.8934e-02,  1.8413e+00, -8.1387e-01,
        -6.8520e-01, -4.2633e-14, -4.0584e-02, -2.3663e+00, -1.0179e+00,
         7.2153e+00, -6.0934e-01, -2.1093e-01,  8.7077e-02, -1.1896e-01,
        -7.2392e-02, -6.4513e-01, -6.3491e-01,  1.0261e-01, -6.1558e-02,
        -3.8091e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2083]), tensor(0.0080))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:main_restricted_month.py:Testing data year: 2016
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 16626
            device: cpu
            
2024-08-02 00:09:22,586	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-02 00:09:22,720	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-02 00:09:22,773	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip' (5.13MiB) to Ray cluster...
2024-08-02 00:09:22,786	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip'.
2024-08-02 00:09:29,119	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-02 02:49:39,302	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_00-09-29' in 0.2137s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 125, 'num_layers': 3, 'num_embeddings': 16626, 'embedding_dim': 8, 'dropout_rate': 0.36, 'lr': 4.696605981338128e-05, 'weight_decay': 0.000799358605203772, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03179343687650665
INFO:model_data_nn.py:Best trial testing loss: 0.02817364244761999
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-08-02_00-09-20_028085_365373/artifacts/2024-08-02_00-09-29/train_fnn_2024-08-02_00-09-29/driver_artifacts/train_fnn_28ca7_00060_60_dropout_rate=0.3600,embedding_dim=8,hidden_dim=125,lr=0.0000,num_layers=3,weight_decay=0.0008_2024-08-02_00-09-29
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 125, 'num_layers': 3, 'num_embeddings': 16828, 'embedding_dim': 8, 'dropout_rate': 0.36, 'lr': 4.696605981338128e-05, 'weight_decay': 0.000799358605203772, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03322052788693961, 'avg_test_loss': 0.022439816868879216}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.0325838669344505, 'avg_test_loss': 0.022450797208067443}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.032293781757347935, 'avg_test_loss': 0.022325915837617824}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.032132927574785516, 'avg_test_loss': 0.022354318591419096}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03202126203923423, 'avg_test_loss': 0.02231501994671276}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03194082486920998, 'avg_test_loss': 0.022280094513191774}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03188976057767892, 'avg_test_loss': 0.022333047070062652}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03186380022816306, 'avg_test_loss': 0.02235756791995692}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03183103806102866, 'avg_test_loss': 0.022399610433471846}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.0318542859027996, 'avg_test_loss': 0.022326896071747506}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.0318324085330602, 'avg_test_loss': 0.022354600116385306}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.031820636353398254, 'avg_test_loss': 0.02238121481492105}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.031811875014151635, 'avg_test_loss': 0.022334339583727828}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.031824630742360485, 'avg_test_loss': 0.022418450937359866}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.0318023574055953, 'avg_test_loss': 0.02237356910322263}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.03182925853446111, 'avg_test_loss': 0.022401858567415427}
INFO:model_data_nn.py:Early stopping at epoch 16
INFO:main_restricted_month.py:Making prediction for data in year: 2017
INFO:main_restricted_month.py:Prediction data shape: (39152,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2017: 0.14968676166947473
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  39152.000000  39152.000000
mean       0.013804      0.009051
std        0.149936      0.015130
min       -0.871053     -0.090942
25%       -0.044052      0.004000
50%        0.007340      0.010585
75%        0.060976      0.015257
max        8.336493      0.155370
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]
INFO:transform_data_nn.py:Train_data: (1788316, 161)

INFO:transform_data_nn.py:Test data years: [2017]
INFO:transform_data_nn.py:Test_data: (39152, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]
INFO:transform_data_nn.py:Retrain_data: (1827468, 161)

INFO:transform_data_nn.py:Prediction data years: [2018]
INFO:transform_data_nn.py:Prediction_data: (38407, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1788316, 138])
            y_train_tf: torch.Size([1788316])

            x_test_tf: torch.Size([39152, 138])
            y_test_tf: torch.Size([39152])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1827468, 138])
            y_retrain_tf: torch.Size([1827468])

            x_prediction_tf: torch.Size([38407, 138])
            y_prediction_tf: torch.Size([38407])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.1763e-01,  9.5219e-01,  6.5611e-02, -1.7060e+00, -9.8155e-02,
        -8.3588e-01, -1.5969e-01, -3.5494e-01,  4.6149e-01, -1.6720e-01,
        -7.2541e-01,  9.7231e-02, -7.1562e-01, -5.5695e-01,  1.0518e-01,
         5.3003e-01, -1.1721e-01,  2.0461e-01, -8.8165e-02,  6.4341e-01,
        -4.2011e-01, -6.7377e-02, -1.8395e-01,  1.5133e-02, -9.3628e-02,
        -3.3986e-01, -5.9362e-01, -9.3008e-02,  2.2500e-01,  1.4296e+00,
         3.5246e-01, -1.1374e-01,  8.0018e-01,  3.3454e-01, -2.2029e-01,
        -2.2597e-01,  1.7064e-01,  9.2059e-01, -4.2516e-03, -1.0979e+00,
        -2.6469e-01,  3.2821e-01,  4.0297e-01,  3.0438e-02, -1.5354e-01,
        -7.2488e-01,  1.2386e-01, -6.4427e-02, -3.5937e-01, -1.3871e-01,
        -8.5454e-01,  2.5731e-01, -4.7272e-01,  9.6298e-02, -5.2202e-03,
         4.7992e-01, -5.3824e-01, -1.8040e-01, -2.4883e-01, -2.7247e-02,
         4.0819e-05, -3.0542e-01,  6.8207e-02,  2.1552e-01,  7.5761e-02,
        -1.9428e-01,  8.0060e-01, -2.5112e-01,  6.0873e-01, -5.7701e-01,
        -3.5981e-01, -1.8248e-01, -2.7479e-02, -8.7669e-01,  1.9472e-01,
         8.0588e-01,  9.3293e-01, -1.1937e+00,  2.5847e-01,  1.9554e-02,
        -1.0474e+00,  2.1564e-01,  4.1447e-01,  4.9761e-02, -5.7877e-01,
        -4.8335e-01, -5.6522e-01, -2.7366e-01,  1.1228e-01,  1.1667e-01,
        -6.2921e-01, -1.3327e+00,  2.6799e-01,  2.3315e-15,  2.3315e-15,
         3.4606e+00,  2.1398e-01,  2.4852e+00, -3.0952e+00,  6.4673e-01,
        -4.2188e-01,  2.2978e-01,  7.6728e-06, -5.6486e-02,  1.6403e-01,
         4.7145e-02, -1.5407e-01,  2.3249e-01,  8.2087e-01, -8.4948e-01,
         9.1819e-01, -4.2633e-14,  3.1952e-01,  3.6817e-02,  5.7159e-02,
         6.1785e-03,  4.0358e-01, -2.2603e-01,  8.7077e-02, -5.5734e-01,
         1.4496e-01, -2.1624e-01, -3.4399e-01,  3.6469e-01,  3.5811e-01,
        -4.1345e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6211]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-3.9759e-01, -1.3312e-01, -5.5374e-01,  1.1362e+00, -4.6411e-01,
        -1.0041e+00, -1.3257e+00, -8.5645e-01, -5.7581e-02,  1.2036e-01,
        -6.5205e-01, -7.3877e-02, -5.8461e-01,  1.2690e-01, -1.8803e-01,
        -2.3635e-01, -2.0487e-01, -1.3920e-01, -2.2370e-02, -2.1553e-01,
         1.8015e+00, -1.3374e-01, -5.4120e-02, -2.8857e-01, -3.1344e-01,
        -7.0795e-01, -6.5426e-01, -9.3008e-02,  6.7193e-01,  8.8108e-01,
         1.1558e-01, -3.2450e-01,  9.7662e-02,  3.3454e-01, -8.5727e-01,
        -6.2755e-01, -3.7026e-01, -7.0229e-01, -5.8366e-01, -8.9576e-02,
        -2.6580e-01,  3.7638e-01, -4.3459e-01, -4.1506e-01, -3.7243e-01,
        -9.0863e-01,  1.0845e+00,  2.6114e-03, -3.0365e-01,  2.2217e+00,
        -5.6064e-02, -1.2922e-01, -4.7272e-01, -4.1366e-01, -7.3855e-01,
        -2.0219e-01, -9.2752e-01, -4.2305e-01,  5.1937e-01,  1.8264e-01,
        -2.3803e-01,  3.7431e-01, -3.0920e-01, -1.0074e+00, -3.7874e-02,
        -3.9331e-01, -4.7557e-01,  9.5393e-01, -7.3707e-01, -6.1656e-01,
        -3.5981e-01, -1.8248e-01, -2.7479e-02, -1.1145e+00, -1.3183e-01,
        -8.5962e-02,  9.3293e-01,  8.7934e-01,  1.5139e+00,  1.9554e-02,
         7.1515e-01, -7.7032e-01, -4.7822e-01, -4.9699e-01, -2.0887e-01,
        -3.6939e-01, -4.9617e-01, -3.2084e-01, -3.5408e-01,  3.2478e-01,
        -2.4470e-01, -4.1879e-01,  2.6799e-01,  2.3315e-15,  2.3315e-15,
        -3.4870e-01, -1.5644e+00, -1.1789e+00, -5.4354e-02, -6.1084e-01,
        -4.1139e-01, -4.7106e-02,  1.0885e+00,  3.5691e-01,  7.6950e-01,
         1.5397e+00, -3.1704e-01, -3.8934e-02,  1.8413e+00, -8.1387e-01,
        -6.8520e-01, -4.2633e-14, -4.0584e-02, -2.3663e+00, -1.0179e+00,
         7.2153e+00, -6.0934e-01, -2.1093e-01,  8.7077e-02, -1.1896e-01,
        -7.2392e-02, -6.4513e-01, -6.3491e-01,  1.0261e-01, -6.1558e-02,
        -3.8091e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2083]), tensor(0.0080))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.1704e-01,  9.5800e-01,  6.3555e-02, -1.7130e+00, -9.5157e-02,
        -8.3415e-01, -1.6278e-01, -3.5694e-01,  4.6810e-01, -1.6699e-01,
        -7.2623e-01,  1.0356e-01, -7.1803e-01, -5.5604e-01,  1.0637e-01,
         5.3278e-01, -1.1675e-01,  2.0419e-01, -8.8258e-02,  6.5038e-01,
        -4.1977e-01, -6.7672e-02, -1.8081e-01,  1.6217e-02, -9.3431e-02,
        -3.3982e-01, -5.9351e-01, -9.3326e-02,  2.0274e-01,  1.4333e+00,
         3.5311e-01, -1.1150e-01,  8.0227e-01,  3.3842e-01, -2.1677e-01,
        -2.2396e-01,  1.7596e-01,  9.2300e-01, -2.6724e-03, -1.0916e+00,
        -2.6232e-01,  3.2581e-01,  4.1020e-01,  3.2012e-02, -1.5225e-01,
        -7.2046e-01,  1.2149e-01, -6.5140e-02, -3.5400e-01, -1.4043e-01,
        -8.5586e-01,  2.4180e-01, -4.7252e-01,  9.7031e-02, -3.8811e-03,
         4.7732e-01, -5.3270e-01, -1.7948e-01, -2.4762e-01, -2.7147e-02,
         5.4282e-04, -3.0431e-01,  6.7240e-02,  2.1685e-01,  7.5890e-02,
        -1.9512e-01,  8.0845e-01, -2.4935e-01,  6.0657e-01, -5.7677e-01,
        -3.6120e-01, -1.8445e-01, -2.8291e-02, -8.7180e-01,  1.9989e-01,
         8.1271e-01,  9.4055e-01, -1.1971e+00,  2.5468e-01,  2.0101e-02,
        -1.0803e+00,  2.1795e-01,  4.2170e-01,  6.4136e-02, -5.7827e-01,
        -4.8981e-01, -5.6711e-01, -2.7362e-01,  1.1533e-01,  1.1757e-01,
        -6.3364e-01, -1.3316e+00,  2.7126e-01,  7.7716e-16,  7.7716e-16,
         3.5001e+00,  2.3628e-01,  2.5048e+00, -3.1142e+00,  6.6617e-01,
        -4.1622e-01,  2.3672e-01,  7.6090e-04, -5.4622e-02,  1.6060e-01,
         4.7642e-02, -1.5645e-01,  2.2695e-01,  8.3639e-01, -8.3692e-01,
         9.3803e-01, -7.1054e-15,  3.1873e-01,  3.4956e-02,  5.3345e-02,
         6.3019e-03,  4.1324e-01, -2.2476e-01,  9.5181e-02, -5.5594e-01,
         1.4670e-01, -2.1081e-01, -3.3950e-01,  3.6719e-01,  3.5664e-01,
        -4.1251e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6272]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-3.8143e-01, -1.3893e-01, -1.3556e-01,  1.1265e+00, -1.3555e-01,
        -5.5164e-01, -6.6445e-01, -6.5059e-01, -6.6507e-01, -1.0575e+00,
         7.5032e-02,  1.4423e+00,  1.9418e+00, -4.0269e-03, -4.9035e-02,
         3.2889e-01, -2.0563e-01, -2.1021e+00, -2.5665e-02,  1.7193e-01,
         2.9675e-01, -1.3416e-01, -1.6392e-01,  1.9590e-01,  3.9477e-02,
         1.3803e-01, -3.4674e-01, -4.0598e-01,  8.7021e-01, -1.5554e-01,
         6.7471e-01, -1.4150e-01,  2.2979e-01,  3.3842e-01,  4.0347e-01,
        -2.0425e-01,  3.4714e-01, -3.1099e-01,  2.2147e-01, -1.1116e+00,
        -2.6401e-01, -2.4555e-02,  9.9557e-02, -6.2432e-01, -3.5947e-02,
        -8.6592e-01,  3.9162e-02, -1.3048e-02, -4.3974e-02,  2.8258e-01,
         7.4163e-01,  1.2750e+00, -4.7252e-01,  1.4274e-01, -7.3925e-01,
         1.5220e-01, -3.5264e-01,  5.4926e-02, -2.6915e-01, -5.2402e-01,
        -6.1212e-02, -3.0862e-01, -2.1061e-01, -4.6933e-01, -1.2188e-01,
        -3.1671e-01, -3.3992e-01, -3.0010e-01,  6.0657e-01,  3.9857e-02,
        -3.5807e-01, -1.8367e-01, -2.8291e-02, -9.9956e-01,  1.2112e+00,
         1.5067e-02, -1.2764e-01,  3.6398e-01,  5.4954e-01,  3.6228e-01,
         7.7414e-01, -1.6242e-01, -6.0831e-01, -9.3979e-01, -4.1397e-01,
        -4.9528e-01, -5.7012e-01, -3.5530e-01, -2.7735e-01,  1.8163e-01,
        -3.3659e-01, -1.8328e-01,  2.7126e-01,  7.7716e-16,  7.7716e-16,
        -6.3214e-01, -1.2786e+00, -8.9751e-01, -7.8197e-01, -7.3492e-01,
        -4.6013e-01,  6.2478e-02, -4.7500e-01, -4.4778e-01, -2.7965e+00,
         1.4453e+00, -1.7040e-01,  4.3614e-01,  8.3639e-01, -6.3444e-01,
        -7.4800e-01, -7.1054e-15,  2.7877e-01,  3.4956e-02, -8.0024e-01,
        -3.2617e-02, -7.6170e-02, -3.9300e-01,  9.5181e-02, -5.6406e-01,
        -4.6753e-02,  8.9887e-02,  2.5440e+00,  5.9304e-01,  2.8160e-01,
        -4.1281e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00]), tensor([2852]), tensor(-0.0882))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]
INFO:main_restricted_month.py:Testing data year: 2017
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 16828
            device: cpu
            
2024-08-02 06:53:29,461	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-02 06:53:29,506	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-02 06:53:29,556	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip' (5.13MiB) to Ray cluster...
2024-08-02 06:53:29,566	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_76bb54b95b2bef74.zip'.
2024-08-02 06:53:34,568	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-02 07:40:32,939	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 30.15 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:40:56,425	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 53.64 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:41:06,516	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 63.73 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:41:16,562	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 73.78 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:41:26,615	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 83.83 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:41:36,658	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 93.87 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:41:46,700	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 103.91 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:45:59,402	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 30.17 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:46:11,587	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 42.35 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:46:21,637	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 52.40 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:46:31,712	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 62.48 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:46:41,757	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 72.52 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:46:51,804	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 82.57 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:47:01,908	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 92.67 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:47:11,957	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 102.72 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:47:22,006	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 112.77 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:47:32,060	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 122.82 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:47:42,102	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 132.87 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:47:52,145	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 142.91 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:50:02,862	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 30.12 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:50:58,277	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 85.53 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:51:08,330	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 95.58 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:51:18,372	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 105.63 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:51:28,778	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 116.03 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:51:38,828	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 126.08 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 07:51:48,867	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 136.12 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-02 08:32:38,544	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_06-53-34' in 0.2501s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 1, 'num_embeddings': 16828, 'embedding_dim': 1, 'dropout_rate': 0.27, 'lr': 5.110120656497166e-05, 'weight_decay': 0.00028447512555118215, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.031754878799515385
INFO:model_data_nn.py:Best trial testing loss: 0.022336394711720203
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-08-02_06-53-26_874201_365373/artifacts/2024-08-02_06-53-34/train_fnn_2024-08-02_06-53-34/driver_artifacts/train_fnn_9c346_00018_18_dropout_rate=0.2700,embedding_dim=1,hidden_dim=65,lr=0.0001,num_layers=1,weight_decay=0.0003_2024-08-02_06-53-34
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 1, 'num_embeddings': 16984, 'embedding_dim': 1, 'dropout_rate': 0.27, 'lr': 5.110120656497166e-05, 'weight_decay': 0.00028447512555118215, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.032848067948719605, 'avg_test_loss': 0.024692717744750334}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.03239443499653308, 'avg_test_loss': 0.024806928284739}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.03218496975344965, 'avg_test_loss': 0.02487583500805765}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03204001633305578, 'avg_test_loss': 0.024688034244393076}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.031953691501878795, 'avg_test_loss': 0.02466768419297223}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.031875791198229426, 'avg_test_loss': 0.024500228618403366}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03182631435448076, 'avg_test_loss': 0.02471477811932936}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.031801359757788854, 'avg_test_loss': 0.024623557884159333}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03177088241211416, 'avg_test_loss': 0.024524234980654695}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.031751646514968285, 'avg_test_loss': 0.02480482380022101}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.0317248879260568, 'avg_test_loss': 0.024620961195273253}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.031708882195896904, 'avg_test_loss': 0.024620552266019703}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.03169772541987027, 'avg_test_loss': 0.02440197828586853}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.031672988824299766, 'avg_test_loss': 0.02488475283003488}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.031673677787452156, 'avg_test_loss': 0.02480769011783979}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.03167140989842729, 'avg_test_loss': 0.025140642849403046}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.03166586714763291, 'avg_test_loss': 0.024440127561649868}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.03165397997347061, 'avg_test_loss': 0.024577766228017835}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.03165518031573806, 'avg_test_loss': 0.024453298872516502}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.031644856845273475, 'avg_test_loss': 0.024723349005052086}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.03164221380095759, 'avg_test_loss': 0.024461790077471967}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.03164074367034226, 'avg_test_loss': 0.02436821661562583}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.03163528140509383, 'avg_test_loss': 0.024565927878009798}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.031630933112340096, 'avg_test_loss': 0.024639522394912315}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.031640304659589974, 'avg_test_loss': 0.024488101712584545}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.03163458927301486, 'avg_test_loss': 0.025105044882226975}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.0316267057695408, 'avg_test_loss': 0.024924518698562995}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.03161166935790258, 'avg_test_loss': 0.024469192106100095}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.031608067002510114, 'avg_test_loss': 0.024337717721675724}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.03161840459532127, 'avg_test_loss': 0.02479716435116646}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.03162008959891653, 'avg_test_loss': 0.024563450382142242}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.03161450921892311, 'avg_test_loss': 0.024540350858831838}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.031602259638674086, 'avg_test_loss': 0.024565347710147054}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.03159221964080237, 'avg_test_loss': 0.024493155464415318}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.03161026435613768, 'avg_test_loss': 0.02461426263596063}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.031599508274873, 'avg_test_loss': 0.02440348055876928}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.03161320533806295, 'avg_test_loss': 0.024335757629735125}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.03159886294254432, 'avg_test_loss': 0.024385391437013116}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.03161772848551301, 'avg_test_loss': 0.024481549934978395}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.03159908558689012, 'avg_test_loss': 0.024476558338856935}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.0316086741310279, 'avg_test_loss': 0.024906346777426126}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.03160094775554987, 'avg_test_loss': 0.024874471664543384}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.0316097982329072, 'avg_test_loss': 0.024530286555133524}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.03160580947349082, 'avg_test_loss': 0.02451423853566055}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.03159895476819421, 'avg_test_loss': 0.024548090409375913}
INFO:model_data_nn.py:Epoch 46/50, metrics: {'avg_train_loss': 0.03160406408868658, 'avg_test_loss': 0.024590639745004587}
INFO:model_data_nn.py:Epoch 47/50, metrics: {'avg_train_loss': 0.031604824958649955, 'avg_test_loss': 0.024594030676552168}
INFO:model_data_nn.py:Early stopping at epoch 47
INFO:main_restricted_month.py:Making prediction for data in year: 2018
INFO:main_restricted_month.py:Prediction data shape: (38407,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2018: 0.15672086570733404
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  38407.000000  38407.000000
mean      -0.011608      0.013443
std        0.154625      0.015389
min       -0.993600     -0.102303
25%       -0.078015      0.008638
50%       -0.008815      0.014123
75%        0.048674      0.019123
max        6.428011      0.221048
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]
INFO:transform_data_nn.py:Train_data: (1827468, 161)

INFO:transform_data_nn.py:Test data years: [2018]
INFO:transform_data_nn.py:Test_data: (38407, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]
INFO:transform_data_nn.py:Retrain_data: (1865875, 161)

INFO:transform_data_nn.py:Prediction data years: [2019]
INFO:transform_data_nn.py:Prediction_data: (38497, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1827468, 138])
            y_train_tf: torch.Size([1827468])

            x_test_tf: torch.Size([38407, 138])
            y_test_tf: torch.Size([38407])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1865875, 138])
            y_retrain_tf: torch.Size([1865875])

            x_prediction_tf: torch.Size([38497, 138])
            y_prediction_tf: torch.Size([38497])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.1704e-01,  9.5800e-01,  6.3555e-02, -1.7130e+00, -9.5157e-02,
        -8.3415e-01, -1.6278e-01, -3.5694e-01,  4.6810e-01, -1.6699e-01,
        -7.2623e-01,  1.0356e-01, -7.1803e-01, -5.5604e-01,  1.0637e-01,
         5.3278e-01, -1.1675e-01,  2.0419e-01, -8.8258e-02,  6.5038e-01,
        -4.1977e-01, -6.7672e-02, -1.8081e-01,  1.6217e-02, -9.3431e-02,
        -3.3982e-01, -5.9351e-01, -9.3326e-02,  2.0274e-01,  1.4333e+00,
         3.5311e-01, -1.1150e-01,  8.0227e-01,  3.3842e-01, -2.1677e-01,
        -2.2396e-01,  1.7596e-01,  9.2300e-01, -2.6724e-03, -1.0916e+00,
        -2.6232e-01,  3.2581e-01,  4.1020e-01,  3.2012e-02, -1.5225e-01,
        -7.2046e-01,  1.2149e-01, -6.5140e-02, -3.5400e-01, -1.4043e-01,
        -8.5586e-01,  2.4180e-01, -4.7252e-01,  9.7031e-02, -3.8811e-03,
         4.7732e-01, -5.3270e-01, -1.7948e-01, -2.4762e-01, -2.7147e-02,
         5.4282e-04, -3.0431e-01,  6.7240e-02,  2.1685e-01,  7.5890e-02,
        -1.9512e-01,  8.0845e-01, -2.4935e-01,  6.0657e-01, -5.7677e-01,
        -3.6120e-01, -1.8445e-01, -2.8291e-02, -8.7180e-01,  1.9989e-01,
         8.1271e-01,  9.4055e-01, -1.1971e+00,  2.5468e-01,  2.0101e-02,
        -1.0803e+00,  2.1795e-01,  4.2170e-01,  6.4136e-02, -5.7827e-01,
        -4.8981e-01, -5.6711e-01, -2.7362e-01,  1.1533e-01,  1.1757e-01,
        -6.3364e-01, -1.3316e+00,  2.7126e-01,  7.7716e-16,  7.7716e-16,
         3.5001e+00,  2.3628e-01,  2.5048e+00, -3.1142e+00,  6.6617e-01,
        -4.1622e-01,  2.3672e-01,  7.6090e-04, -5.4622e-02,  1.6060e-01,
         4.7642e-02, -1.5645e-01,  2.2695e-01,  8.3639e-01, -8.3692e-01,
         9.3803e-01, -7.1054e-15,  3.1873e-01,  3.4956e-02,  5.3345e-02,
         6.3019e-03,  4.1324e-01, -2.2476e-01,  9.5181e-02, -5.5594e-01,
         1.4670e-01, -2.1081e-01, -3.3950e-01,  3.6719e-01,  3.5664e-01,
        -4.1251e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6272]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-3.8143e-01, -1.3893e-01, -1.3556e-01,  1.1265e+00, -1.3555e-01,
        -5.5164e-01, -6.6445e-01, -6.5059e-01, -6.6507e-01, -1.0575e+00,
         7.5032e-02,  1.4423e+00,  1.9418e+00, -4.0269e-03, -4.9035e-02,
         3.2889e-01, -2.0563e-01, -2.1021e+00, -2.5665e-02,  1.7193e-01,
         2.9675e-01, -1.3416e-01, -1.6392e-01,  1.9590e-01,  3.9477e-02,
         1.3803e-01, -3.4674e-01, -4.0598e-01,  8.7021e-01, -1.5554e-01,
         6.7471e-01, -1.4150e-01,  2.2979e-01,  3.3842e-01,  4.0347e-01,
        -2.0425e-01,  3.4714e-01, -3.1099e-01,  2.2147e-01, -1.1116e+00,
        -2.6401e-01, -2.4555e-02,  9.9557e-02, -6.2432e-01, -3.5947e-02,
        -8.6592e-01,  3.9162e-02, -1.3048e-02, -4.3974e-02,  2.8258e-01,
         7.4163e-01,  1.2750e+00, -4.7252e-01,  1.4274e-01, -7.3925e-01,
         1.5220e-01, -3.5264e-01,  5.4926e-02, -2.6915e-01, -5.2402e-01,
        -6.1212e-02, -3.0862e-01, -2.1061e-01, -4.6933e-01, -1.2188e-01,
        -3.1671e-01, -3.3992e-01, -3.0010e-01,  6.0657e-01,  3.9857e-02,
        -3.5807e-01, -1.8367e-01, -2.8291e-02, -9.9956e-01,  1.2112e+00,
         1.5067e-02, -1.2764e-01,  3.6398e-01,  5.4954e-01,  3.6228e-01,
         7.7414e-01, -1.6242e-01, -6.0831e-01, -9.3979e-01, -4.1397e-01,
        -4.9528e-01, -5.7012e-01, -3.5530e-01, -2.7735e-01,  1.8163e-01,
        -3.3659e-01, -1.8328e-01,  2.7126e-01,  7.7716e-16,  7.7716e-16,
        -6.3214e-01, -1.2786e+00, -8.9751e-01, -7.8197e-01, -7.3492e-01,
        -4.6013e-01,  6.2478e-02, -4.7500e-01, -4.4778e-01, -2.7965e+00,
         1.4453e+00, -1.7040e-01,  4.3614e-01,  8.3639e-01, -6.3444e-01,
        -7.4800e-01, -7.1054e-15,  2.7877e-01,  3.4956e-02, -8.0024e-01,
        -3.2617e-02, -7.6170e-02, -3.9300e-01,  9.5181e-02, -5.6406e-01,
        -4.6753e-02,  8.9887e-02,  2.5440e+00,  5.9304e-01,  2.8160e-01,
        -4.1281e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00]), tensor([2852]), tensor(-0.0882))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.1576e-01,  9.6224e-01,  6.1638e-02, -1.7205e+00, -9.4606e-02,
        -8.3439e-01, -1.6602e-01, -3.5902e-01,  4.7418e-01, -1.6647e-01,
        -7.2661e-01,  1.0893e-01, -7.2099e-01, -5.5530e-01,  1.0774e-01,
         5.3534e-01, -1.1646e-01,  2.0252e-01, -9.2181e-02,  6.5560e-01,
        -4.1992e-01, -6.8493e-02, -1.8295e-01,  1.8396e-02, -9.4103e-02,
        -3.3987e-01, -5.9288e-01, -9.4382e-02,  1.8197e-01,  1.4357e+00,
         3.5269e-01, -1.1145e-01,  8.0371e-01,  3.4073e-01, -2.1332e-01,
        -2.2151e-01,  1.7995e-01,  9.2418e-01, -1.4260e-03, -1.0858e+00,
        -2.5996e-01,  3.2775e-01,  4.1588e-01,  3.4052e-02, -1.5131e-01,
        -7.1695e-01,  1.2120e-01, -6.3799e-02, -3.5255e-01, -1.4124e-01,
        -8.5584e-01,  2.2608e-01, -4.7232e-01,  9.7673e-02, -2.1515e-03,
         4.7621e-01, -5.2720e-01, -1.7821e-01, -2.4768e-01, -2.6645e-02,
         7.6342e-04, -3.0434e-01,  6.5386e-02,  2.1840e-01,  7.3606e-02,
        -1.9663e-01,  8.1575e-01, -2.4754e-01,  6.0608e-01, -5.7660e-01,
        -3.6244e-01, -1.8637e-01, -2.8660e-02, -8.6887e-01,  2.0453e-01,
         8.1805e-01,  9.4735e-01, -1.2006e+00,  2.5226e-01,  2.0016e-02,
        -1.0960e+00,  2.1739e-01,  4.2847e-01,  7.8642e-02, -5.7835e-01,
        -4.9617e-01, -5.6875e-01, -2.7305e-01,  1.1779e-01,  1.1944e-01,
        -6.3864e-01, -1.3304e+00,  2.7403e-01,  4.4409e-15,  4.4409e-15,
         3.5363e+00,  2.6106e-01,  2.5321e+00, -3.1066e+00,  6.8064e-01,
        -4.1696e-01,  2.4093e-01,  2.5921e-03, -5.2058e-02,  1.6035e-01,
         4.7411e-02, -1.5973e-01,  2.2455e-01,  8.4621e-01, -8.2806e-01,
         9.5833e-01, -1.2434e-14,  3.1778e-01,  3.1800e-02,  4.7928e-02,
         8.8315e-03,  4.2260e-01, -2.2396e-01,  1.0226e-01, -5.5429e-01,
         1.4701e-01, -2.0542e-01, -3.3596e-01,  3.6909e-01,  3.5491e-01,
        -4.1249e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6339]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-7.0015e-01,  1.3146e-01,  2.9713e-02,  1.1172e+00, -1.8643e-01,
        -3.4146e-01, -7.0817e-01, -6.7083e-01, -6.0852e-01, -1.2000e+00,
        -8.2074e-02,  1.7285e+00,  1.9368e+00,  2.0365e-03, -5.0218e-01,
        -1.2580e-01, -1.9911e-01,  3.5225e-01, -3.1327e-02,  4.8661e-02,
        -1.5253e-01,  1.1154e+00, -2.1503e-01, -4.0936e-01, -6.0619e-02,
         1.5030e-01, -3.3302e-01, -4.3095e-01,  8.6826e-01, -1.1081e-01,
        -4.2110e-01, -8.0454e-02,  2.7818e-01,  3.4073e-01,  3.4823e-01,
        -2.8601e-01, -1.7796e-01, -3.2285e-01, -6.4703e-02, -1.1305e+00,
        -2.6160e-01, -3.6006e-01, -1.6918e-02, -6.2379e-01, -4.1569e-01,
        -7.0940e-01, -1.4285e-01, -5.7041e-01,  4.5247e-02, -5.4173e-02,
         7.4185e-01,  1.2343e+00, -4.7232e-01,  4.0883e-01, -7.4010e-01,
         9.8438e-02, -3.3310e-01, -4.6620e-01, -1.0836e-01, -1.5261e-01,
        -7.2717e-02, -1.8388e-01, -1.3510e-01, -2.8912e-02, -9.0516e-02,
        -2.8700e-01, -1.3259e-01, -3.5016e-01,  6.0608e-01,  1.6283e-02,
        -3.5943e-01, -1.8570e-01, -2.8660e-02, -5.4105e-01,  1.2276e+00,
        -1.3146e-01,  1.5197e-01,  2.4645e-01,  5.1942e-01,  3.6498e-01,
         7.7149e-01, -2.5635e-01, -5.8935e-01, -1.0961e+00, -3.2594e-01,
        -5.0362e-01, -5.7207e-01, -3.5381e-01, -4.7684e-01, -2.0606e-01,
        -2.8598e-01, -2.6603e-01,  2.7403e-01,  4.4409e-15,  4.4409e-15,
        -4.5941e-01, -1.2118e+00, -5.5194e-01, -1.3260e+00,  1.9449e-01,
         8.2546e-01,  1.3026e-01, -8.1024e-01, -5.3729e-01, -2.0517e+00,
         1.3861e+00, -1.9084e-01, -2.1493e+00,  8.4621e-01, -8.3385e-01,
        -9.6826e-01, -1.2434e-14,  2.4163e-01,  3.1800e-02, -7.4281e-01,
        -6.8644e-01, -2.4757e-02, -3.4495e-01,  1.0226e-01, -5.6319e-01,
        -7.1877e-02,  7.7230e-02,  2.5494e+00,  6.9762e-01,  3.3971e-01,
        -3.9362e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00]), tensor([2900]), tensor(0.0675))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]
INFO:main_restricted_month.py:Testing data year: 2018
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 16984
            device: cpu
            
2024-08-02 13:02:23,644	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-02 13:02:23,703	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-02 13:02:23,752	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_e65415f55bf86f5e.zip' (5.14MiB) to Ray cluster...
2024-08-02 13:02:23,762	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_e65415f55bf86f5e.zip'.
2024-08-02 13:02:28,828	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-02 14:42:33,416	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_13-02-28' in 0.2200s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 5, 'num_embeddings': 16984, 'embedding_dim': 7, 'dropout_rate': 0.39, 'lr': 4.380580767905661e-05, 'weight_decay': 0.00018477934173519273, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03193055706837732
INFO:model_data_nn.py:Best trial testing loss: 0.02425930996273587
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-08-02_13-02-21_133348_365373/artifacts/2024-08-02_13-02-28/train_fnn_2024-08-02_13-02-28/driver_artifacts/train_fnn_25407_00015_15_dropout_rate=0.3900,embedding_dim=7,hidden_dim=35,lr=0.0000,num_layers=5,weight_decay=0.0002_2024-08-02_13-02-29
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 35, 'num_layers': 5, 'num_embeddings': 17157, 'embedding_dim': 7, 'dropout_rate': 0.39, 'lr': 4.380580767905661e-05, 'weight_decay': 0.00018477934173519273, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03306517831483178, 'avg_test_loss': 0.03198091342134024}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.03273344706287798, 'avg_test_loss': 0.03212132316161615}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.03254787168181095, 'avg_test_loss': 0.03200085926878319}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03236231151107354, 'avg_test_loss': 0.0318742641216868}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03222759377592742, 'avg_test_loss': 0.03203941771545543}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03209601944717182, 'avg_test_loss': 0.031894928665113856}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03200665601993804, 'avg_test_loss': 0.03197339739328702}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03191640574163709, 'avg_test_loss': 0.03184957455447643}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03191472541368684, 'avg_test_loss': 0.03178611044126851}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03186549644684379, 'avg_test_loss': 0.031853475372393636}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03184775699184298, 'avg_test_loss': 0.03195708266929708}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.031794617044153414, 'avg_test_loss': 0.03190765458204013}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.031816701405341305, 'avg_test_loss': 0.03171125589715212}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.03175917336914661, 'avg_test_loss': 0.03174210310313368}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.031762868724396036, 'avg_test_loss': 0.03169650588829714}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.031766498163792886, 'avg_test_loss': 0.03181944830239475}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.03171825146596784, 'avg_test_loss': 0.031835803944243124}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.031721882006931934, 'avg_test_loss': 0.031691571606703696}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.03171497123749408, 'avg_test_loss': 0.03170950082324111}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.031683345489274845, 'avg_test_loss': 0.03179501189132441}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.03167524737531303, 'avg_test_loss': 0.0317157626328402}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.031695024438935175, 'avg_test_loss': 0.031813425896070474}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.03168981709167594, 'avg_test_loss': 0.03180147829137594}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.03167111098118187, 'avg_test_loss': 0.031879458563677666}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.03164287327899456, 'avg_test_loss': 0.031891133623086286}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.03166856970099783, 'avg_test_loss': 0.03176740135694312}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.0316728486550601, 'avg_test_loss': 0.032017540051276945}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.03166983109061777, 'avg_test_loss': 0.03186931115098644}
INFO:model_data_nn.py:Early stopping at epoch 28
INFO:main_restricted_month.py:Making prediction for data in year: 2019
INFO:main_restricted_month.py:Prediction data shape: (38497,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2019: 0.17851688022824552
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  38497.000000  38497.000000
mean       0.019638      0.001928
std        0.178531      0.011416
min       -0.867110     -0.110845
25%       -0.053333     -0.001040
50%        0.015359      0.003632
75%        0.079920      0.006125
max        6.842308      0.384141
INFO:main_restricted_month.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]
INFO:transform_data_nn.py:Train_data: (1865875, 161)

INFO:transform_data_nn.py:Test data years: [2019]
INFO:transform_data_nn.py:Test_data: (38497, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019]
INFO:transform_data_nn.py:Retrain_data: (1904372, 161)

INFO:transform_data_nn.py:Prediction data years: [2020]
INFO:transform_data_nn.py:Prediction_data: (38579, 161)

INFO:main_restricted_month.py:

Generate X and y with train_data and test_data

INFO:main_restricted_month.py:
            x_train_tf: torch.Size([1865875, 138])
            y_train_tf: torch.Size([1865875])

            x_test_tf: torch.Size([38497, 138])
            y_test_tf: torch.Size([38497])

        
INFO:main_restricted_month.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted_month.py:
            x_retrain_tf: torch.Size([1904372, 138])
            y_retrain_tf: torch.Size([1904372])

            x_prediction_tf: torch.Size([38579, 138])
            y_prediction_tf: torch.Size([38579])

        
INFO:main_restricted_month.py:

Create dataset

INFO:main_restricted_month.py:Create train_dataset
INFO:main_restricted_month.py:train_dataset first example: (tensor([-1.1576e-01,  9.6224e-01,  6.1638e-02, -1.7205e+00, -9.4606e-02,
        -8.3439e-01, -1.6602e-01, -3.5902e-01,  4.7418e-01, -1.6647e-01,
        -7.2661e-01,  1.0893e-01, -7.2099e-01, -5.5530e-01,  1.0774e-01,
         5.3534e-01, -1.1646e-01,  2.0252e-01, -9.2181e-02,  6.5560e-01,
        -4.1992e-01, -6.8493e-02, -1.8295e-01,  1.8396e-02, -9.4103e-02,
        -3.3987e-01, -5.9288e-01, -9.4382e-02,  1.8197e-01,  1.4357e+00,
         3.5269e-01, -1.1145e-01,  8.0371e-01,  3.4073e-01, -2.1332e-01,
        -2.2151e-01,  1.7995e-01,  9.2418e-01, -1.4260e-03, -1.0858e+00,
        -2.5996e-01,  3.2775e-01,  4.1588e-01,  3.4052e-02, -1.5131e-01,
        -7.1695e-01,  1.2120e-01, -6.3799e-02, -3.5255e-01, -1.4124e-01,
        -8.5584e-01,  2.2608e-01, -4.7232e-01,  9.7673e-02, -2.1515e-03,
         4.7621e-01, -5.2720e-01, -1.7821e-01, -2.4768e-01, -2.6645e-02,
         7.6342e-04, -3.0434e-01,  6.5386e-02,  2.1840e-01,  7.3606e-02,
        -1.9663e-01,  8.1575e-01, -2.4754e-01,  6.0608e-01, -5.7660e-01,
        -3.6244e-01, -1.8637e-01, -2.8660e-02, -8.6887e-01,  2.0453e-01,
         8.1805e-01,  9.4735e-01, -1.2006e+00,  2.5226e-01,  2.0016e-02,
        -1.0960e+00,  2.1739e-01,  4.2847e-01,  7.8642e-02, -5.7835e-01,
        -4.9617e-01, -5.6875e-01, -2.7305e-01,  1.1779e-01,  1.1944e-01,
        -6.3864e-01, -1.3304e+00,  2.7403e-01,  4.4409e-15,  4.4409e-15,
         3.5363e+00,  2.6106e-01,  2.5321e+00, -3.1066e+00,  6.8064e-01,
        -4.1696e-01,  2.4093e-01,  2.5921e-03, -5.2058e-02,  1.6035e-01,
         4.7411e-02, -1.5973e-01,  2.2455e-01,  8.4621e-01, -8.2806e-01,
         9.5833e-01, -1.2434e-14,  3.1778e-01,  3.1800e-02,  4.7928e-02,
         8.8315e-03,  4.2260e-01, -2.2396e-01,  1.0226e-01, -5.5429e-01,
         1.4701e-01, -2.0542e-01, -3.3596e-01,  3.6909e-01,  3.5491e-01,
        -4.1249e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6339]), tensor(0.2117))
INFO:main_restricted_month.py:Create test_dataset
INFO:main_restricted_month.py:test_dataset first example: (tensor([-7.0015e-01,  1.3146e-01,  2.9713e-02,  1.1172e+00, -1.8643e-01,
        -3.4146e-01, -7.0817e-01, -6.7083e-01, -6.0852e-01, -1.2000e+00,
        -8.2074e-02,  1.7285e+00,  1.9368e+00,  2.0365e-03, -5.0218e-01,
        -1.2580e-01, -1.9911e-01,  3.5225e-01, -3.1327e-02,  4.8661e-02,
        -1.5253e-01,  1.1154e+00, -2.1503e-01, -4.0936e-01, -6.0619e-02,
         1.5030e-01, -3.3302e-01, -4.3095e-01,  8.6826e-01, -1.1081e-01,
        -4.2110e-01, -8.0454e-02,  2.7818e-01,  3.4073e-01,  3.4823e-01,
        -2.8601e-01, -1.7796e-01, -3.2285e-01, -6.4703e-02, -1.1305e+00,
        -2.6160e-01, -3.6006e-01, -1.6918e-02, -6.2379e-01, -4.1569e-01,
        -7.0940e-01, -1.4285e-01, -5.7041e-01,  4.5247e-02, -5.4173e-02,
         7.4185e-01,  1.2343e+00, -4.7232e-01,  4.0883e-01, -7.4010e-01,
         9.8438e-02, -3.3310e-01, -4.6620e-01, -1.0836e-01, -1.5261e-01,
        -7.2717e-02, -1.8388e-01, -1.3510e-01, -2.8912e-02, -9.0516e-02,
        -2.8700e-01, -1.3259e-01, -3.5016e-01,  6.0608e-01,  1.6283e-02,
        -3.5943e-01, -1.8570e-01, -2.8660e-02, -5.4105e-01,  1.2276e+00,
        -1.3146e-01,  1.5197e-01,  2.4645e-01,  5.1942e-01,  3.6498e-01,
         7.7149e-01, -2.5635e-01, -5.8935e-01, -1.0961e+00, -3.2594e-01,
        -5.0362e-01, -5.7207e-01, -3.5381e-01, -4.7684e-01, -2.0606e-01,
        -2.8598e-01, -2.6603e-01,  2.7403e-01,  4.4409e-15,  4.4409e-15,
        -4.5941e-01, -1.2118e+00, -5.5194e-01, -1.3260e+00,  1.9449e-01,
         8.2546e-01,  1.3026e-01, -8.1024e-01, -5.3729e-01, -2.0517e+00,
         1.3861e+00, -1.9084e-01, -2.1493e+00,  8.4621e-01, -8.3385e-01,
        -9.6826e-01, -1.2434e-14,  2.4163e-01,  3.1800e-02, -7.4281e-01,
        -6.8644e-01, -2.4757e-02, -3.4495e-01,  1.0226e-01, -5.6319e-01,
        -7.1877e-02,  7.7230e-02,  2.5494e+00,  6.9762e-01,  3.3971e-01,
        -3.9362e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00]), tensor([2900]), tensor(0.0675))
INFO:main_restricted_month.py:Create retrain_dataset
INFO:main_restricted_month.py:retrain_dataset first example: (tensor([-1.1453e-01,  9.6605e-01,  6.0483e-02, -1.7254e+00, -9.4831e-02,
        -8.3554e-01, -1.7113e-01, -3.6256e-01,  4.7529e-01, -1.6472e-01,
        -7.2655e-01,  1.1544e-01, -7.2241e-01, -5.5142e-01,  1.0819e-01,
         5.3767e-01, -1.1547e-01,  2.0161e-01, -9.2816e-02,  6.6055e-01,
        -4.1863e-01, -6.6290e-02, -1.8830e-01,  2.0065e-02, -9.8023e-02,
        -3.3974e-01, -5.9234e-01, -9.6869e-02,  1.5711e-01,  1.4332e+00,
         3.5273e-01, -1.1042e-01,  8.0112e-01,  3.4399e-01, -2.0907e-01,
        -2.2039e-01,  1.8287e-01,  9.2397e-01, -1.2868e-03, -1.0804e+00,
        -2.5790e-01,  3.4276e-01,  4.1862e-01,  3.3351e-02, -1.5204e-01,
        -7.1489e-01,  1.2819e-01, -6.2906e-02, -3.5456e-01, -1.3631e-01,
        -8.5687e-01,  2.1225e-01, -4.7196e-01,  9.8354e-02,  6.5096e-04,
         4.7590e-01, -5.2155e-01, -1.7529e-01, -2.4678e-01, -1.9665e-02,
         2.1402e-03, -3.0325e-01,  6.5474e-02,  2.1841e-01,  7.2421e-02,
        -1.9749e-01,  8.2269e-01, -2.4422e-01,  6.0652e-01, -5.7586e-01,
        -3.6360e-01, -1.8832e-01, -2.6445e-02, -8.6750e-01,  2.1051e-01,
         8.2159e-01,  9.5409e-01, -1.2040e+00,  2.4908e-01,  2.2840e-02,
        -1.1099e+00,  2.1722e-01,  4.3181e-01,  9.2356e-02, -5.7810e-01,
        -5.0280e-01, -5.7014e-01, -2.7272e-01,  1.1989e-01,  1.2474e-01,
        -6.4312e-01, -1.3286e+00,  2.7701e-01, -1.9984e-15, -1.9984e-15,
         3.5719e+00,  2.8199e-01,  2.5605e+00, -3.0271e+00,  6.8810e-01,
        -4.1754e-01,  2.4516e-01, -2.0170e-04, -5.0849e-02,  1.5389e-01,
         4.6042e-02, -1.6116e-01,  1.6135e-01,  8.5526e-01, -8.2879e-01,
         9.7391e-01,  2.3093e-14,  3.1729e-01,  3.6650e-02,  4.1952e-02,
         7.8312e-03,  4.3180e-01, -2.2524e-01,  1.0891e-01, -5.5078e-01,
         1.4716e-01, -1.9964e-01, -3.3120e-01,  3.7058e-01,  3.5405e-01,
        -4.1234e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6432]), tensor(0.2117))
INFO:main_restricted_month.py:Create prediction_dataset
INFO:main_restricted_month.py:prediction_dataset first example: (tensor([-3.9349e-01, -1.1664e-01, -3.4957e-01,  1.1106e+00, -1.4296e-01,
        -8.2460e-01, -1.0271e+00, -7.9148e-01, -6.5919e-01, -1.2087e+00,
         3.8524e-01,  1.6350e+00,  1.4476e+00, -9.1522e-03, -5.6722e-01,
        -9.7026e-02, -2.0492e-01,  6.2864e-02, -8.7834e-01, -9.0778e-02,
         3.0962e-02,  2.3396e+00, -1.7573e-01, -3.8204e-01, -7.9543e-02,
         4.9695e-01, -3.3477e-01, -4.8785e-01,  8.7132e-01, -1.6251e-01,
        -4.8216e-01, -9.9496e-02,  2.3139e-01,  3.4399e-01,  2.8800e-01,
        -4.6251e-01, -2.1797e-01, -2.9489e-01, -2.1386e-01, -1.1037e+00,
        -2.5965e-01,  1.5562e-01, -5.3063e-01, -6.2667e-01, -2.2670e-01,
        -8.6135e-01,  3.1282e-01, -6.8559e-02, -2.1199e-01,  3.0197e-01,
         7.4152e-01,  1.3301e+00, -4.7196e-01,  1.1697e-01, -7.4033e-01,
         8.2148e-02, -3.6034e-01, -1.6770e-01,  3.9023e-01, -2.1892e-01,
        -3.4024e-02,  4.8338e-01,  1.6157e-02, -5.5122e-02, -3.3011e-02,
        -2.1528e-01, -3.1860e-01, -2.9785e-01, -6.7083e-02,  3.7894e-01,
        -3.6121e-01, -1.8767e-01, -2.6445e-02, -9.7664e-01,  1.2358e+00,
        -7.6230e-02, -5.9460e-01,  2.6643e-01,  4.6854e-01,  3.7031e-01,
         7.6821e-01, -2.7297e-01, -6.1425e-01, -1.1155e+00, -2.3452e-01,
        -5.1119e-01, -5.7387e-01, -4.0304e-01,  6.1836e-02, -1.0063e-02,
        -8.2638e-02, -6.5849e-01,  2.7701e-01, -1.9984e-15, -1.9984e-15,
        -6.8725e-01, -5.9373e-01, -8.0888e-01, -1.3837e+00, -3.6370e-01,
        -4.1105e-01, -2.4010e-02, -2.0170e-04, -4.9901e-01,  1.5389e-01,
         1.6645e+00, -1.8019e-01,  2.9992e-01,  8.5526e-01, -1.0712e-01,
         2.5620e-01,  2.3093e-14,  2.4657e-01,  3.6650e-02, -6.6400e-01,
         1.7463e-01,  6.1301e-03, -2.8369e-01,  1.0891e-01, -5.6362e-01,
         1.1633e-01,  2.0681e-02,  2.5606e+00,  6.0114e-01,  2.7374e-01,
        -3.9262e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  1.0000e+00]), tensor([2881]), tensor(-0.1000))
INFO:main_restricted_month.py:

Create dataloader

INFO:main_restricted_month.py:Create train and test dataloader
INFO:main_restricted_month.py:Create retrain and prediction dataloader
INFO:main_restricted_month.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted_month.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]
INFO:main_restricted_month.py:Testing data year: 2019
INFO:main_restricted_month.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 17157
            device: cpu
            
2024-08-02 19:25:53,798	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-02 19:25:53,841	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-02 19:25:53,892	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_c0c9c192f51f26da.zip' (5.14MiB) to Ray cluster...
2024-08-02 19:25:53,902	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_c0c9c192f51f26da.zip'.
2024-08-02 19:25:59,095	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-02 22:24:20,042	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_19-25-59' in 0.2519s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 95, 'num_layers': 2, 'num_embeddings': 17157, 'embedding_dim': 7, 'dropout_rate': 0.14, 'lr': 0.00015780309954142968, 'weight_decay': 2.111502034025126e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.029676930406141232
INFO:model_data_nn.py:Best trial testing loss: 0.03155563479603463
INFO:main_restricted_month.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted_month.py:Best trial directory: /tmp/ray/session_2024-08-02_19-25-51_100899_365373/artifacts/2024-08-02_19-25-59/train_fnn_2024-08-02_19-25-59/driver_artifacts/train_fnn_b8708_00067_67_dropout_rate=0.1400,embedding_dim=7,hidden_dim=95,lr=0.0002,num_layers=2,weight_decay=0.0000_2024-08-02_19-25-59
INFO:main_restricted_month.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 95, 'num_layers': 2, 'num_embeddings': 17387, 'embedding_dim': 7, 'dropout_rate': 0.14, 'lr': 0.00015780309954142968, 'weight_decay': 2.111502034025126e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03253299330366133, 'avg_test_loss': 0.08222196429927724}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.03185679318624899, 'avg_test_loss': 0.08070485303904336}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.031304833969597205, 'avg_test_loss': 0.08140981915927373}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.030906440416359225, 'avg_test_loss': 0.08271206837613908}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03064160344769858, 'avg_test_loss': 0.08298941197608957}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.030455642842210924, 'avg_test_loss': 0.0850589763547663}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.030291857143687137, 'avg_test_loss': 0.08327059282428564}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03021867020403505, 'avg_test_loss': 0.08660058020791703}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03010858944822218, 'avg_test_loss': 0.08135898446951488}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.030035943710725314, 'avg_test_loss': 0.08356201568090205}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03001756753762106, 'avg_test_loss': 0.08793748731170449}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.029946087706927475, 'avg_test_loss': 0.08392052524406494}
INFO:model_data_nn.py:Early stopping at epoch 12
INFO:main_restricted_month.py:Making prediction for data in year: 2020
INFO:main_restricted_month.py:Prediction data shape: (38579,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted_month.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted_month.py:Root Mean Squared Error for Prediction in 2020: 0.2897144569731444
INFO:main_restricted_month.py:Prediction Stats:                 ret          pred
count  38579.000000  38579.000000
mean       0.033419      0.005505
std        0.281326      0.049066
min       -0.889030     -0.412459
25%       -0.081633     -0.004408
50%        0.009837      0.010217
75%        0.111111      0.022322
max       14.458016      0.580201

 Configuration for experiment     train_fnn_2024-07-27_13-27-00   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_13-27-00
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_13-26-57_025009_365373/artifacts/2024-07-27_13-27-01/train_fnn_2024-07-27_13-27-00/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_13-53-43   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_13-53-43
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_13-53-39_877688_365373/artifacts/2024-07-27_13-53-43/train_fnn_2024-07-27_13-53-43/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_14-35-17   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_14-35-17
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_14-35-13_360453_365373/artifacts/2024-07-27_14-35-17/train_fnn_2024-07-27_14-35-17/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_15-28-38   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_15-28-38
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_15-28-34_282229_365373/artifacts/2024-07-27_15-28-38/train_fnn_2024-07-27_15-28-38/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_16-33-22   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_16-33-22
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_16-33-18_693928_365373/artifacts/2024-07-27_16-33-22/train_fnn_2024-07-27_16-33-22/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_17-37-56   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_17-37-56
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_17-37-52_077231_365373/artifacts/2024-07-27_17-37-56/train_fnn_2024-07-27_17-37-56/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_18-46-40   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_18-46-40
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_18-46-36_898777_365373/artifacts/2024-07-27_18-46-40/train_fnn_2024-07-27_18-46-40/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_20-08-19   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_20-08-19
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_20-08-15_953340_365373/artifacts/2024-07-27_20-08-19/train_fnn_2024-07-27_20-08-19/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_22-13-59   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_22-13-59
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_22-13-56_030335_365373/artifacts/2024-07-27_22-13-59/train_fnn_2024-07-27_22-13-59/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-27_23-48-10   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-27_23-48-10
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-27_23-48-05_828383_365373/artifacts/2024-07-27_23-48-10/train_fnn_2024-07-27_23-48-10/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-28_01-45-23   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_01-45-23
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-28_01-45-19_459551_365373/artifacts/2024-07-28_01-45-23/train_fnn_2024-07-28_01-45-23/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-28_03-46-28   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_03-46-28
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-28_03-46-23_875776_365373/artifacts/2024-07-28_03-46-28/train_fnn_2024-07-28_03-46-28/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-28_06-47-59   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_06-47-59
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-28_06-47-55_413595_365373/artifacts/2024-07-28_06-47-59/train_fnn_2024-07-28_06-47-59/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-28_09-45-09   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_09-45-09
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-28_09-45-04_771888_365373/artifacts/2024-07-28_09-45-09/train_fnn_2024-07-28_09-45-09/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-28_13-13-29   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_13-13-29
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-28_13-13-24_340457_365373/artifacts/2024-07-28_13-13-29/train_fnn_2024-07-28_13-13-29/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-28_15-39-59   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_15-39-59
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-28_15-39-53_599134_365373/artifacts/2024-07-28_15-39-59/train_fnn_2024-07-28_15-39-59/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-28_19-20-11   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_19-20-11
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-28_19-20-06_145231_365373/artifacts/2024-07-28_19-20-11/train_fnn_2024-07-28_19-20-11/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-28_22-51-17   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-28_22-51-17
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-28_22-51-11_932955_365373/artifacts/2024-07-28_22-51-17/train_fnn_2024-07-28_22-51-17/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-29_03-33-20   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_03-33-20
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-29_03-33-14_291502_365373/artifacts/2024-07-29_03-33-20/train_fnn_2024-07-29_03-33-20/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-29_10-04-02   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_10-04-02
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-29_10-03-56_248420_365373/artifacts/2024-07-29_10-04-02/train_fnn_2024-07-29_10-04-02/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-29_13-25-40   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_13-25-40
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-29_13-25-34_059510_365373/artifacts/2024-07-29_13-25-40/train_fnn_2024-07-29_13-25-40/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-29_18-41-46   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-29_18-41-46
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-29_18-41-39_094787_365373/artifacts/2024-07-29_18-41-46/train_fnn_2024-07-29_18-41-46/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-30_00-25-18   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_00-25-18
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-30_00-25-11_438974_365373/artifacts/2024-07-30_00-25-18/train_fnn_2024-07-30_00-25-18/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-30_05-15-04   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_05-15-04
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-30_05-14-57_676383_365373/artifacts/2024-07-30_05-15-04/train_fnn_2024-07-30_05-15-04/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-30_12-16-38   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_12-16-38
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-30_12-16-32_004701_365373/artifacts/2024-07-30_12-16-38/train_fnn_2024-07-30_12-16-38/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-30_20-49-25   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-30_20-49-25
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-30_20-49-18_385529_365373/artifacts/2024-07-30_20-49-25/train_fnn_2024-07-30_20-49-25/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-31_03-07-24   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-31_03-07-24
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-31_03-07-13_795595_365373/artifacts/2024-07-31_03-07-24/train_fnn_2024-07-31_03-07-24/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-31_10-57-29   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-31_10-57-29
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-31_10-57-20_667385_365373/artifacts/2024-07-31_10-57-29/train_fnn_2024-07-31_10-57-29/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-31_17-26-29   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-31_17-26-29
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-31_17-26-19_581301_365373/artifacts/2024-07-31_17-26-29/train_fnn_2024-07-31_17-26-29/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-01_01-06-34   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_01-06-34
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-01_01-06-27_569169_365373/artifacts/2024-08-01_01-06-34/train_fnn_2024-08-01_01-06-34/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-01_06-48-48   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_06-48-48
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-01_06-48-40_990211_365373/artifacts/2024-08-01_06-48-48/train_fnn_2024-08-01_06-48-48/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-01_13-45-01   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-01_13-45-01
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-01_13-44-54_340714_365373/artifacts/2024-08-01_13-45-01/train_fnn_2024-08-01_13-45-01/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-02_00-09-29   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_00-09-29
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-02_00-09-20_028085_365373/artifacts/2024-08-02_00-09-29/train_fnn_2024-08-02_00-09-29/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-02_06-53-34   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_06-53-34
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-02_06-53-26_874201_365373/artifacts/2024-08-02_06-53-34/train_fnn_2024-08-02_06-53-34/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-02_13-02-28   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_13-02-28
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-02_13-02-21_133348_365373/artifacts/2024-08-02_13-02-28/train_fnn_2024-08-02_13-02-28/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-02_19-25-59   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-02_19-25-59
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-02_19-25-51_100899_365373/artifacts/2024-08-02_19-25-59/train_fnn_2024-08-02_19-25-59/driver_artifacts`

INFO:postprocess_predictions.py:Post processing prediction files
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1985.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1986.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1987.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1988.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1989.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1990.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1991.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1992.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1993.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1994.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1995.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1996.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1997.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1998.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1999.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2000.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2001.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2002.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2003.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2004.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2005.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2006.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2007.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2008.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2009.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2010.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2011.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2012.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2013.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2014.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2015.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2016.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2017.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2018.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2019.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2020.csv
INFO:postprocess_predictions.py:Sort the result by date and rank both ascendingly
INFO:postprocess_predictions.py:Saved the result file: result.csv
to the directory: kevin/output/prediction/monthly_new_restricted
