Current working directory
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml
source kevin/venv/bin/activate
which python3
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/bin/python3
2024-08-06 12:54:04,383	PANIC scripts.py:900 -- `--address` is a required flag unless starting a head node with `--head`.
Error: `{}` is a required flag unless starting a head node with `{}`.
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
INFO:preprocess_data_nn.py:

Loading and preprocessing data...

DEBUG:preprocess_data_nn.py:          date   permno
626    1980-01  10006.0
5399   1980-01  10057.0
11398  1980-01  10137.0
12828  1980-01  10145.0
13984  1980-01  10153.0
DEBUG:preprocess_data_nn.py:--------------------------------------------------
INFO:main_restricted.py:preprocessed df: (2005900, 161)
INFO:preprocess_data_nn.py:

Applying secondary data preprocessing..

INFO:main_restricted.py:secondary preprocessed df: (1942951, 161)
INFO:main_restricted.py:df sample:     permno       pdate        ym  gvkey  sic2    absacc       acc    aeavol  ...      roaa      roea   roavola       ret        mve_m      retq  pyear     date
0  10006.0  1980-01-01  198001.0   1010    37  0.083420  0.083420  1.001090  ...  0.048684  0.141715  0.004512  0.211679   303420.750 -0.055806   1980  1980-01
1  10057.0  1980-01-01  198001.0   1098    36  0.088951  0.088951 -0.613146  ...  0.092434  0.174252  0.035698  0.282297   111423.125 -0.069431   1980  1980-01
2  10137.0  1980-01-01  198001.0   1279    49  0.041008  0.041008 -0.491307  ...  0.034895  0.097554  0.006254 -0.032258   617349.500 -0.108065   1980  1980-01
3  10145.0  1980-01-01  198001.0   1300    99  0.050486  0.050486 -0.256932  ...  0.049028  0.122729  0.004320  0.150127  1415193.000 -0.085950   1980  1980-01
4  10153.0  1980-01-01  198001.0   1308    13       NaN       NaN  1.631801  ...  0.049860  0.109950  0.009149 -0.122744   429488.500 -0.285199   1980  1980-01

[5 rows x 161 columns]
INFO:main_restricted.py:Train year start: 1980
INFO:main_restricted.py:Prediction data years: [1986, 1987, 1989, 1991, 1993, 1996, 2000, 2002, 2004, 2005, 2011, 2014, 2016, 2020]
INFO:main_restricted.py:

Loop through all the prediction years and build optimized model for each year

INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984]
INFO:transform_data_nn.py:Train_data: (149870, 161)

INFO:transform_data_nn.py:Test data years: [1985]
INFO:transform_data_nn.py:Test_data: (43492, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Retrain_data: (193362, 161)

INFO:transform_data_nn.py:Prediction data years: [1986]
INFO:transform_data_nn.py:Prediction_data: (43785, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([149870, 138])
            y_train_tf: torch.Size([149870])

            x_test_tf: torch.Size([43492, 138])
            y_test_tf: torch.Size([43492])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([193362, 138])
            y_retrain_tf: torch.Size([193362])

            x_prediction_tf: torch.Size([43785, 138])
            y_prediction_tf: torch.Size([43785])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-0.0054,  0.3203,  0.2194, -1.2084, -0.1250, -0.6240, -0.0916, -0.2813,
         0.1755, -0.1609, -0.7181, -0.2985, -0.4316, -0.1709,  0.1224,  0.6069,
        -0.1464,  0.0913,  0.0000,  0.5148, -0.3331,  0.1067, -0.0306, -0.0081,
        -0.1190, -0.2124, -0.5798,  0.0000,  0.4178,  0.7142,  0.4837, -0.1548,
         0.3823,  0.0000, -0.4281, -0.1804,  0.0945,  0.3886,  0.1901, -1.1776,
        -0.2458,  0.0141,  0.1895, -0.1257, -0.0936, -0.6817, -0.0587, -0.1134,
        -0.6202, -0.2558, -0.6133,  0.6308, -0.1811, -0.2689,  0.0209,  0.4466,
        -0.7806, -0.1405, -0.3113,  0.2011,  0.0943, -0.3883,  0.1554,  0.3174,
         0.2508, -0.0946,  0.1179, -0.0439,  0.6406, -0.4199,  0.0000,  0.0000,
         0.0000, -0.8552, -0.1174,  0.5194,  0.0462, -0.3339, -0.1861, -0.0368,
         0.0000,  0.5389, -0.0828, -0.0897, -0.5511, -0.0648, -0.0503, -0.3859,
        -0.1629,  0.1517, -0.4628, -1.2766,  0.0000,  0.7191,  1.4805,  1.0988,
        -0.1931,  0.5645, -1.7373, -1.0139, -1.1352,  0.3032,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0558, -0.2886,  0.0000, -1.3168, -0.9630, -1.2887,
         0.0878, -0.0825,  0.0000,  0.0000, -0.0100, -0.1309, -0.0592,  0.1436,
         0.2215, -0.4598, -0.4234,  0.0705,  0.2044, -0.4644,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([2484]), tensor(0.2117))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-4.1209e-02, -3.4561e-02,  6.9167e+00, -4.8258e-01, -4.2263e-02,
         1.8296e+00,  1.8592e+00,  2.1082e+00, -5.0464e-01, -4.7138e-01,
         1.1591e+00,  1.8816e-02,  2.0313e-01,  3.1117e-02,  8.6985e-03,
        -8.5387e-03, -2.2131e-01, -2.1334e+00,  0.0000e+00, -1.2459e-02,
        -2.5757e-01,  1.0670e-01,  8.9147e-03, -2.0070e-02, -1.0279e-02,
        -2.9700e-01,  2.4394e-02,  0.0000e+00, -1.3788e+00, -9.4805e-01,
         1.4267e+00, -4.3503e-02,  1.4899e-01,  0.0000e+00,  3.3403e+00,
         1.7326e-02,  1.5988e-02, -2.1585e-01, -1.7642e-01,  1.3349e+00,
        -8.7883e-02, -1.3674e+00, -1.6666e-02, -4.1929e-01, -2.3189e-02,
         3.1896e-01, -1.3621e+00,  1.6841e-01, -3.7548e-01, -1.5424e+00,
         2.8157e+00, -1.1174e+00, -9.7091e-02, -2.6889e-01,  7.8921e-01,
         3.4179e-01, -3.2325e-02,  2.3563e-02, -2.1498e-02,  4.2200e-02,
        -1.4704e-02, -2.0302e-02,  4.3394e-02,  4.9887e-02, -1.1005e-02,
         2.2852e-02, -2.4194e-02,  6.0221e-03,  6.4058e-01,  4.5177e-02,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  3.3045e-01,  3.1348e-01,
        -1.0899e-02, -2.0691e-01,  1.2023e+00,  6.9023e+00, -3.6842e-02,
         0.0000e+00,  2.5110e-02, -3.3694e-01, -9.2152e-01, -5.3683e-01,
        -6.5317e-02, -5.0028e-02, -5.2869e-02,  5.5624e-01, -2.6465e-02,
        -4.0950e-01,  1.9470e+00,  0.0000e+00, -6.6848e-01, -2.8689e-01,
        -1.0407e+00, -3.0734e+00, -1.0772e+00,  1.0322e+00, -1.1352e+00,
        -5.1966e-01, -3.7978e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00, -6.1909e-03,  2.3739e-01,  0.0000e+00,  6.3793e-01,
        -1.0868e+00,  9.2511e-01, -3.1371e-03, -8.2525e-02,  0.0000e+00,
         0.0000e+00,  3.2516e-02, -1.1784e-02, -5.9187e-02, -1.3858e-02,
         3.9036e-02,  5.0149e-01,  9.5115e-02,  5.3401e-01,  2.4000e-01,
        -4.4588e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3719]), tensor(0.3115))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.0606e-01,  2.1628e-01,  1.8668e-01, -1.2410e+00, -1.4494e-01,
        -6.0633e-01, -1.0954e-01, -2.9638e-01,  2.3780e-01, -1.6025e-01,
        -7.1284e-01, -1.8976e-01, -4.4614e-01, -9.4623e-02,  9.0774e-02,
         5.5178e-01, -1.4248e-01,  8.6219e-02,  0.0000e+00,  4.3647e-01,
        -3.7530e-01, -2.5503e-01,  1.0047e-02,  1.1415e-03, -1.0654e-01,
        -2.2533e-01, -5.9233e-01,  0.0000e+00,  4.2527e-01,  8.0503e-01,
         4.9132e-01, -1.4382e-01,  3.9378e-01,  0.0000e+00, -4.2043e-01,
        -1.8670e-01,  7.8142e-02,  4.4022e-01,  1.0672e-01, -1.1782e+00,
        -2.5288e-01,  9.5831e-02,  1.3909e-01, -1.0046e-01, -1.3948e-01,
        -6.6383e-01, -1.2032e-02, -1.1862e-01, -6.2645e-01, -2.4628e-01,
        -6.1617e-01,  6.5491e-01, -1.8197e-01, -2.1855e-01,  2.0195e-02,
         4.4404e-01, -7.7944e-01, -1.0039e-01, -2.7536e-01,  1.6007e-01,
         9.5258e-02, -3.4429e-01,  1.6728e-01,  3.0232e-01,  2.1065e-01,
        -9.3216e-02,  6.5847e-02, -5.5111e-02,  6.5773e-01, -4.1490e-01,
         0.0000e+00,  0.0000e+00, -1.9328e-01, -8.2029e-01, -6.4020e-02,
         5.3669e-01,  4.6422e-02, -3.4006e-01, -1.8259e-01, -1.4627e-02,
         0.0000e+00,  4.0856e-01, -3.2098e-02, -1.7225e-01, -5.5690e-01,
        -7.2067e-02, -5.7593e-02, -3.7818e-01, -1.6905e-01,  1.5664e-01,
        -4.8309e-01, -1.2800e+00, -3.2037e+00,  9.6812e-01,  1.7009e+00,
         1.3394e+00,  3.1469e-01,  8.2406e-01, -2.0144e+00, -8.0466e-01,
        -1.0104e+00,  1.9333e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.9434e-02, -1.3831e-01,  0.0000e+00, -1.4905e+00,
        -4.0360e-01, -1.5524e+00,  1.0246e-01, -2.3560e-02,  0.0000e+00,
         0.0000e+00,  8.3697e-03, -1.5481e-01, -7.6564e-02,  1.0933e-01,
         2.4903e-01, -4.4572e-01, -4.1504e-01,  1.0480e-01,  2.1010e-01,
        -3.8213e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2774]), tensor(0.2117))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-4.7975e-01, -1.6167e+00, -5.5251e-01, -1.7881e-03,  4.3567e+00,
        -3.5114e-01,  1.3639e+00,  1.3271e+00, -9.6472e-01, -9.5801e-01,
        -4.1834e-03, -1.9898e-01,  2.2943e-01,  5.7273e-01,  2.5503e+00,
        -1.0944e-03, -2.1737e-01, -3.3214e-01,  0.0000e+00, -5.0717e-02,
        -2.9242e-01, -2.5503e-01,  1.4144e-02,  3.5297e-01,  1.5825e+00,
        -9.2067e-01, -3.0061e-01,  0.0000e+00,  8.4623e-02, -8.8211e-01,
         9.6014e-04,  2.5318e-01, -4.3382e-02,  0.0000e+00,  1.1384e+00,
        -1.3600e-02,  2.4599e+00, -2.5919e-01,  7.5326e-02,  7.4560e-01,
        -2.5262e-01, -4.8858e-01,  1.6070e+00, -3.6384e-01,  5.7743e+00,
        -7.7914e-02,  2.5166e+00,  4.2342e-01, -1.0561e+00,  1.3393e+00,
         8.0689e-01, -4.6382e-01, -1.0910e-01, -2.1855e-01,  7.7845e-01,
         2.3948e-01,  2.1400e+00, -7.6941e-02, -2.0483e+00, -1.8413e+00,
         4.9467e-02, -1.7352e+00, -1.0563e+00, -1.6353e+00,  5.2063e-02,
        -8.4755e-01, -8.5137e-01, -2.4456e-01, -8.7060e-03, -6.8216e-01,
         0.0000e+00,  0.0000e+00,  7.7087e+00, -6.7828e-01, -2.7095e-01,
         1.2457e-02, -2.2114e-01,  6.3579e-01,  6.9452e+00, -1.4627e-02,
         0.0000e+00,  3.0474e-01, -6.1411e-01,  1.0833e+00,  1.5821e+00,
        -6.0828e-02, -5.2250e-02, -2.7738e-01, -1.1855e+00,  4.7502e-01,
         1.8004e+00, -7.8204e-01, -3.2037e+00, -1.9508e+00, -1.9736e+00,
        -1.5938e+00, -1.1760e+00, -1.1428e+00,  2.3535e-01, -5.5798e-01,
        -3.2455e-01, -1.6361e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0372e-02, -6.3615e-02,  0.0000e+00, -8.4418e-02,
        -1.2895e+00,  8.1146e-01, -1.2125e-03, -2.3560e-02,  0.0000e+00,
         0.0000e+00, -1.7574e+00,  1.4393e+00, -7.6564e-02,  1.3622e+00,
        -3.0531e-03, -4.9288e-01, -1.1785e+00, -7.6976e-02,  1.1980e-01,
         4.8359e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3725]), tensor(0.))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984]
INFO:main_restricted.py:Testing data year: 1985
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 4258
            device: cpu
            
2024-08-06 13:22:49,550	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-06 13:22:49,601	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-06 13:22:49,655	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_1c61b63ddcb23de0.zip' (5.14MiB) to Ray cluster...
2024-08-06 13:22:49,674	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_1c61b63ddcb23de0.zip'.
2024-08-06 13:22:51,349	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-06 13:30:15,574	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-06_13-22-51' in 0.2856s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 3, 'num_embeddings': 4258, 'embedding_dim': 2, 'dropout_rate': 0.25, 'lr': 3.791105473537746e-05, 'weight_decay': 0.0003409097499797901, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.014322345150220725
INFO:model_data_nn.py:Best trial testing loss: 0.019340566275915242
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-06_13-22-46_607612_871373/artifacts/2024-08-06_13-22-51/train_fnn_2024-08-06_13-22-51/driver_artifacts/train_fnn_a78ec_00039_39_dropout_rate=0.2500,embedding_dim=2,hidden_dim=5,lr=0.0000,num_layers=3,weight_decay=0.0003_2024-08-06_13-22-51
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 3, 'num_embeddings': 4766, 'embedding_dim': 2, 'dropout_rate': 0.25, 'lr': 3.791105473537746e-05, 'weight_decay': 0.0003409097499797901, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.016386125129431682, 'avg_test_loss': 0.020975647252541762}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.01635145849412591, 'avg_test_loss': 0.02098850031592408}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.016338829937335472, 'avg_test_loss': 0.020983854975312428}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.016308374912015453, 'avg_test_loss': 0.020971057939264414}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.01625888228249915, 'avg_test_loss': 0.02096113233498512}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.016206091941513172, 'avg_test_loss': 0.02096013133020382}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.01615396637457195, 'avg_test_loss': 0.021025868917410817}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.01610025315613344, 'avg_test_loss': 0.02112131742841996}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.016039472040010997, 'avg_test_loss': 0.02123723840123754}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.015994912545992345, 'avg_test_loss': 0.021326178139070208}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.01596611680937869, 'avg_test_loss': 0.021527589598817225}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.01590010660965711, 'avg_test_loss': 0.02170436932778654}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.015870507131176475, 'avg_test_loss': 0.0218502665345853}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.015860847221527075, 'avg_test_loss': 0.022160948768703392}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.01583531804857714, 'avg_test_loss': 0.022948028416571047}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.01578229541785472, 'avg_test_loss': 0.024794431082882616}
INFO:model_data_nn.py:Early stopping at epoch 16
INFO:main_restricted.py:Making prediction for data in year: 1986
INFO:main_restricted.py:Prediction data shape: (43785,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1986: 0.15757481139283505
INFO:main_restricted.py:Prediction Stats:                 ret          pred
count  43785.000000  43785.000000
mean       0.007006     -0.007399
std        0.144800      0.059584
min       -0.808824     -0.230491
25%       -0.068966     -0.004012
50%        0.000000      0.002557
75%        0.070270      0.008922
max        3.600000      0.322020
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Train_data: (193362, 161)

INFO:transform_data_nn.py:Test data years: [1986]
INFO:transform_data_nn.py:Test_data: (43785, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:transform_data_nn.py:Retrain_data: (237147, 161)

INFO:transform_data_nn.py:Prediction data years: [1987]
INFO:transform_data_nn.py:Prediction_data: (44352, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([193362, 138])
            y_train_tf: torch.Size([193362])

            x_test_tf: torch.Size([43785, 138])
            y_test_tf: torch.Size([43785])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([237147, 138])
            y_retrain_tf: torch.Size([237147])

            x_prediction_tf: torch.Size([44352, 138])
            y_prediction_tf: torch.Size([44352])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.0606e-01,  2.1628e-01,  1.8668e-01, -1.2410e+00, -1.4494e-01,
        -6.0633e-01, -1.0954e-01, -2.9638e-01,  2.3780e-01, -1.6025e-01,
        -7.1284e-01, -1.8976e-01, -4.4614e-01, -9.4623e-02,  9.0774e-02,
         5.5178e-01, -1.4248e-01,  8.6219e-02,  0.0000e+00,  4.3647e-01,
        -3.7530e-01, -2.5503e-01,  1.0047e-02,  1.1415e-03, -1.0654e-01,
        -2.2533e-01, -5.9233e-01,  0.0000e+00,  4.2527e-01,  8.0503e-01,
         4.9132e-01, -1.4382e-01,  3.9378e-01,  0.0000e+00, -4.2043e-01,
        -1.8670e-01,  7.8142e-02,  4.4022e-01,  1.0672e-01, -1.1782e+00,
        -2.5288e-01,  9.5831e-02,  1.3909e-01, -1.0046e-01, -1.3948e-01,
        -6.6383e-01, -1.2032e-02, -1.1862e-01, -6.2645e-01, -2.4628e-01,
        -6.1617e-01,  6.5491e-01, -1.8197e-01, -2.1855e-01,  2.0195e-02,
         4.4404e-01, -7.7944e-01, -1.0039e-01, -2.7536e-01,  1.6007e-01,
         9.5258e-02, -3.4429e-01,  1.6728e-01,  3.0232e-01,  2.1065e-01,
        -9.3216e-02,  6.5847e-02, -5.5111e-02,  6.5773e-01, -4.1490e-01,
         0.0000e+00,  0.0000e+00, -1.9328e-01, -8.2029e-01, -6.4020e-02,
         5.3669e-01,  4.6422e-02, -3.4006e-01, -1.8259e-01, -1.4627e-02,
         0.0000e+00,  4.0856e-01, -3.2098e-02, -1.7225e-01, -5.5690e-01,
        -7.2067e-02, -5.7593e-02, -3.7818e-01, -1.6905e-01,  1.5664e-01,
        -4.8309e-01, -1.2800e+00, -3.2037e+00,  9.6812e-01,  1.7009e+00,
         1.3394e+00,  3.1469e-01,  8.2406e-01, -2.0144e+00, -8.0466e-01,
        -1.0104e+00,  1.9333e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.9434e-02, -1.3831e-01,  0.0000e+00, -1.4905e+00,
        -4.0360e-01, -1.5524e+00,  1.0246e-01, -2.3560e-02,  0.0000e+00,
         0.0000e+00,  8.3697e-03, -1.5481e-01, -7.6564e-02,  1.0933e-01,
         2.4903e-01, -4.4572e-01, -4.1504e-01,  1.0480e-01,  2.1010e-01,
        -3.8213e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2774]), tensor(0.2117))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-4.7975e-01, -1.6167e+00, -5.5251e-01, -1.7881e-03,  4.3567e+00,
        -3.5114e-01,  1.3639e+00,  1.3271e+00, -9.6472e-01, -9.5801e-01,
        -4.1834e-03, -1.9898e-01,  2.2943e-01,  5.7273e-01,  2.5503e+00,
        -1.0944e-03, -2.1737e-01, -3.3214e-01,  0.0000e+00, -5.0717e-02,
        -2.9242e-01, -2.5503e-01,  1.4144e-02,  3.5297e-01,  1.5825e+00,
        -9.2067e-01, -3.0061e-01,  0.0000e+00,  8.4623e-02, -8.8211e-01,
         9.6014e-04,  2.5318e-01, -4.3382e-02,  0.0000e+00,  1.1384e+00,
        -1.3600e-02,  2.4599e+00, -2.5919e-01,  7.5326e-02,  7.4560e-01,
        -2.5262e-01, -4.8858e-01,  1.6070e+00, -3.6384e-01,  5.7743e+00,
        -7.7914e-02,  2.5166e+00,  4.2342e-01, -1.0561e+00,  1.3393e+00,
         8.0689e-01, -4.6382e-01, -1.0910e-01, -2.1855e-01,  7.7845e-01,
         2.3948e-01,  2.1400e+00, -7.6941e-02, -2.0483e+00, -1.8413e+00,
         4.9467e-02, -1.7352e+00, -1.0563e+00, -1.6353e+00,  5.2063e-02,
        -8.4755e-01, -8.5137e-01, -2.4456e-01, -8.7060e-03, -6.8216e-01,
         0.0000e+00,  0.0000e+00,  7.7087e+00, -6.7828e-01, -2.7095e-01,
         1.2457e-02, -2.2114e-01,  6.3579e-01,  6.9452e+00, -1.4627e-02,
         0.0000e+00,  3.0474e-01, -6.1411e-01,  1.0833e+00,  1.5821e+00,
        -6.0828e-02, -5.2250e-02, -2.7738e-01, -1.1855e+00,  4.7502e-01,
         1.8004e+00, -7.8204e-01, -3.2037e+00, -1.9508e+00, -1.9736e+00,
        -1.5938e+00, -1.1760e+00, -1.1428e+00,  2.3535e-01, -5.5798e-01,
        -3.2455e-01, -1.6361e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0372e-02, -6.3615e-02,  0.0000e+00, -8.4418e-02,
        -1.2895e+00,  8.1146e-01, -1.2125e-03, -2.3560e-02,  0.0000e+00,
         0.0000e+00, -1.7574e+00,  1.4393e+00, -7.6564e-02,  1.3622e+00,
        -3.0531e-03, -4.9288e-01, -1.1785e+00, -7.6976e-02,  1.1980e-01,
         4.8359e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3725]), tensor(0.))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.1378,  0.2011,  0.1735, -1.2736, -0.1414, -0.6129, -0.1248, -0.3115,
         0.2968, -0.1604, -0.7119, -0.1284, -0.4702, -0.0566,  0.0624,  0.5452,
        -0.1485,  0.1085,  0.0000,  0.4475, -0.3672, -0.2125,  0.0325,  0.0146,
        -0.0833, -0.2362, -0.5806,  0.0000,  0.3954,  0.8854,  0.4877, -0.1312,
         0.4150,  0.0000, -0.4067, -0.2013,  0.0756,  0.4689,  0.0805, -1.1706,
        -0.2576,  0.0846,  0.1459, -0.0784, -0.1491, -0.6672, -0.0211, -0.1119,
        -0.5597, -0.2513, -0.6202,  0.6533, -0.1762, -0.0731,  0.0316,  0.4455,
        -0.7773, -0.0479, -0.2733,  0.0933,  0.1035, -0.3434,  0.1623,  0.2965,
         0.2079, -0.1035,  0.0400, -0.0618,  0.7032, -0.4171,  0.0000,  0.0000,
         0.0282, -0.8190, -0.0195,  0.5824,  0.0410, -0.3436, -0.1796, -0.0104,
         0.0000,  0.3771,  0.0150, -0.2020, -0.5611, -0.0783, -0.0633, -0.3700,
        -0.1631,  0.1329, -0.5081, -1.2896,  0.2434,  1.0516,  1.6154,  1.4313,
         0.4921,  1.0178, -2.2250, -0.7145, -1.0838,  0.1765,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0681,  0.1245,  0.0000, -1.6484, -0.1374, -1.7709,
         0.1165,  0.0567,  0.0000,  0.0000,  0.0141, -0.1652, -0.0921,  0.0665,
         0.2107, -0.4339, -0.4025,  0.1455,  0.2247, -0.3825,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([4611]), tensor(0.2117))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([ 1.8020e+00,  1.9152e+00,  3.4486e-01, -1.8913e-01,  1.3689e+00,
         2.6924e+00, -8.9300e-01, -7.8639e-01, -4.9107e-01, -6.5433e-01,
        -5.3155e-01, -1.2724e-01,  2.2762e-01, -3.8230e-01,  1.8586e+00,
         2.3049e+00, -2.2689e-01,  3.8296e+00,  0.0000e+00,  3.2700e+00,
         5.0575e-03, -2.1251e-01,  2.0621e-02, -2.5567e-03,  6.3772e-02,
         1.0327e+00,  2.0287e+00,  0.0000e+00, -1.3956e+00, -8.2966e-01,
        -4.6975e-01, -1.4919e-01,  4.2877e-02,  0.0000e+00,  1.2218e+00,
        -2.0587e-01,  2.0151e-01,  5.4386e-01,  4.6245e+00, -5.7104e-01,
         3.3704e-01, -5.3257e-01,  2.2907e+00, -3.5756e-01,  2.8893e+00,
        -1.0363e+00, -2.0763e-01, -1.0985e+00, -6.9351e-01,  1.0851e-01,
        -6.2015e-01, -1.1060e+00, -1.3256e-01, -7.3100e-02, -7.3521e-01,
         4.8096e-02,  1.0329e+00, -3.2643e-01,  6.0915e-01,  3.3914e+00,
         1.9910e-01,  6.6620e-01,  8.5977e-01,  5.6841e-01, -1.9664e+00,
         3.9913e-01,  1.1799e+00, -6.0768e-01, -1.2768e+00, -3.7900e-01,
         0.0000e+00,  0.0000e+00,  2.8222e-02, -6.5080e-01, -1.0827e-01,
         1.6211e+00, -7.8200e-02, -3.9600e-01,  2.2145e-01, -9.8606e-01,
         0.0000e+00,  2.3511e+00, -2.7285e-01,  1.9970e+00, -6.8303e-02,
        -4.8069e-02, -4.9363e-02, -3.5668e-01, -2.2977e-01, -1.3200e-01,
        -6.0629e-01,  3.0339e+00,  2.4336e-01, -1.5991e+00, -1.6971e+00,
        -1.5188e+00, -6.1921e-01, -1.3641e+00,  1.8554e-01, -2.9779e-01,
        -3.4293e-01,  1.8998e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6694e-02,  1.2451e-01,  0.0000e+00,  7.3645e-01,
        -1.3529e+00,  3.0857e-01, -2.1738e-02,  5.6721e-02,  0.0000e+00,
         0.0000e+00,  2.7793e+00,  5.4316e-01, -9.2059e-02,  3.3375e-01,
         1.7586e+00,  4.1795e-01, -6.4637e-02,  4.0987e-03,  4.2907e-02,
         3.3521e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3160]), tensor(0.0417))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:main_restricted.py:Testing data year: 1986
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 4766
            device: cpu
            
2024-08-06 14:03:16,136	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-06 14:03:16,183	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-06 14:03:16,239	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_1c61b63ddcb23de0.zip' (5.14MiB) to Ray cluster...
2024-08-06 14:03:16,257	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_1c61b63ddcb23de0.zip'.
2024-08-06 14:03:17,934	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-06 14:18:01,166	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-06_14-03-17' in 0.2366s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 135, 'num_layers': 4, 'num_embeddings': 4766, 'embedding_dim': 5, 'dropout_rate': 0.47, 'lr': 1.4551749476072273e-06, 'weight_decay': 0.000368452707362187, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.016333333155238963
INFO:model_data_nn.py:Best trial testing loss: 0.020964871128103302
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-06_14-03-13_305442_871373/artifacts/2024-08-06_14-03-17/train_fnn_2024-08-06_14-03-17/driver_artifacts/train_fnn_4df0c_00052_52_dropout_rate=0.4700,embedding_dim=5,hidden_dim=135,lr=0.0000,num_layers=4,weight_decay=0.0004_2024-08-06_14-03-18
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 135, 'num_layers': 4, 'num_embeddings': 5109, 'embedding_dim': 5, 'dropout_rate': 0.47, 'lr': 1.4551749476072273e-06, 'weight_decay': 0.000368452707362187, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.028990211714557967, 'avg_test_loss': 0.031089438367044548}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.02580344165448043, 'avg_test_loss': 0.030759801378242822}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.023969263563005026, 'avg_test_loss': 0.03063174571589666}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.022528140940934773, 'avg_test_loss': 0.030678657001630544}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.021435233273042555, 'avg_test_loss': 0.03057301491472108}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.020551889166276153, 'avg_test_loss': 0.030583954319594056}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.019849784754731613, 'avg_test_loss': 0.03064066097703937}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.019345871868822924, 'avg_test_loss': 0.030672060327083733}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.01888280661804823, 'avg_test_loss': 0.030593011755045363}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.018497280832822587, 'avg_test_loss': 0.030571534046071235}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.0182225903959796, 'avg_test_loss': 0.030339712000610333}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.018009402098729563, 'avg_test_loss': 0.030361618049528655}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.017879588198576518, 'avg_test_loss': 0.030354064953666427}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.017724927878872237, 'avg_test_loss': 0.030262577081748662}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.017639291458149676, 'avg_test_loss': 0.030241566133129838}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.017516740133631855, 'avg_test_loss': 0.03023119157137247}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.017483590618047468, 'avg_test_loss': 0.03019514358642723}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.017423690943908325, 'avg_test_loss': 0.03017185813068313}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.017373815613354257, 'avg_test_loss': 0.030118735301810227}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.01736003262610386, 'avg_test_loss': 0.030138278938293114}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.01732311646059783, 'avg_test_loss': 0.030126872598609595}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.017301728182570853, 'avg_test_loss': 0.030095389668402996}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.017290048538073574, 'avg_test_loss': 0.03007593715660038}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.01726405816147663, 'avg_test_loss': 0.030066467665930303}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.017260656263890475, 'avg_test_loss': 0.030067650071192286}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.017249364778248604, 'avg_test_loss': 0.030051855166423905}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.017232590052248913, 'avg_test_loss': 0.030054014884686953}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.017230216240747703, 'avg_test_loss': 0.030091795599308156}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.01723270990395995, 'avg_test_loss': 0.03005934504507598}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.01722512239958391, 'avg_test_loss': 0.030077658162884394}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.01722630552171084, 'avg_test_loss': 0.03007089378451794}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.01721527935589058, 'avg_test_loss': 0.030062146459354535}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.01721925259045814, 'avg_test_loss': 0.030045002319122684}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.017209758246609173, 'avg_test_loss': 0.030031624350761215}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.017212219337669258, 'avg_test_loss': 0.03004257995447396}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.017207701485573875, 'avg_test_loss': 0.030034806288145376}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.01721024329217903, 'avg_test_loss': 0.03002441662259035}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.01720450162514441, 'avg_test_loss': 0.030060317188834167}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.0172026872621813, 'avg_test_loss': 0.030038511300035445}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.017202677568782836, 'avg_test_loss': 0.030003792666682506}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.01720693705278624, 'avg_test_loss': 0.029969868278372443}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.01719751686348578, 'avg_test_loss': 0.030022451446072254}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.017196530936845048, 'avg_test_loss': 0.03002881208939279}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.017193278625152894, 'avg_test_loss': 0.030024245746369322}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.017195925073040404, 'avg_test_loss': 0.03004135719100577}
INFO:model_data_nn.py:Epoch 46/50, metrics: {'avg_train_loss': 0.01719596770946057, 'avg_test_loss': 0.03002476084156107}
INFO:model_data_nn.py:Epoch 47/50, metrics: {'avg_train_loss': 0.017191657649160044, 'avg_test_loss': 0.03002717597302726}
INFO:model_data_nn.py:Epoch 48/50, metrics: {'avg_train_loss': 0.01719852681845008, 'avg_test_loss': 0.030064419715769956}
INFO:model_data_nn.py:Epoch 49/50, metrics: {'avg_train_loss': 0.017191567724735575, 'avg_test_loss': 0.03004774821235098}
INFO:model_data_nn.py:Epoch 50/50, metrics: {'avg_train_loss': 0.01717600804053601, 'avg_test_loss': 0.030043237111249385}
INFO:main_restricted.py:Making prediction for data in year: 1987
INFO:main_restricted.py:Prediction data shape: (44352,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1987: 0.17322826981127318
INFO:main_restricted.py:Prediction Stats:                 ret          pred
count  44352.000000  44352.000000
mean      -0.003042      0.011837
std        0.172848      0.003995
min       -0.875000     -0.023176
25%       -0.079210      0.010131
50%        0.000000      0.012723
75%        0.077401      0.014664
max        2.750000      0.019560
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:transform_data_nn.py:Train_data: (281499, 161)

INFO:transform_data_nn.py:Test data years: [1988]
INFO:transform_data_nn.py:Test_data: (46885, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:transform_data_nn.py:Retrain_data: (328384, 161)

INFO:transform_data_nn.py:Prediction data years: [1989]
INFO:transform_data_nn.py:Prediction_data: (47501, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([281499, 138])
            y_train_tf: torch.Size([281499])

            x_test_tf: torch.Size([46885, 138])
            y_test_tf: torch.Size([46885])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([328384, 138])
            y_retrain_tf: torch.Size([328384])

            x_prediction_tf: torch.Size([47501, 138])
            y_prediction_tf: torch.Size([47501])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.6485e-01,  1.8230e-01,  1.7097e-01, -1.2895e+00, -1.4861e-01,
        -6.3361e-01, -1.3953e-01, -3.2412e-01,  3.5052e-01, -1.6415e-01,
        -7.1298e-01, -8.7418e-02, -4.8984e-01, -2.8638e-02,  5.3805e-02,
         5.3585e-01, -1.5057e-01,  1.4105e-01,  0.0000e+00,  4.4826e-01,
        -3.6039e-01, -2.0729e-02,  2.5868e-02,  2.6469e-03, -6.5325e-02,
        -2.4458e-01, -5.7430e-01,  0.0000e+00,  3.6729e-01,  9.5292e-01,
         4.8242e-01, -1.2829e-01,  4.3593e-01,  0.0000e+00, -3.9010e-01,
        -1.9800e-01,  7.8118e-02,  4.8214e-01,  6.1557e-02, -1.1636e+00,
        -2.6444e-01,  1.3808e-01,  1.6335e-01, -6.4053e-02, -1.6169e-01,
        -6.7458e-01,  5.4317e-03, -7.7477e-02, -5.5695e-01, -2.3816e-01,
        -6.2338e-01,  6.4888e-01, -1.6650e-01, -1.9579e-03,  2.7732e-02,
         4.4700e-01, -7.7374e-01, -1.7885e-02, -2.7024e-01,  5.4831e-02,
         1.0554e-01, -3.3980e-01,  1.6083e-01,  2.9301e-01,  1.9625e-01,
        -1.0893e-01,  1.9625e-02, -6.5275e-02,  7.2753e-01, -4.1686e-01,
         0.0000e+00,  0.0000e+00, -1.7687e-02, -8.1674e-01,  1.3622e-02,
         6.0146e-01,  4.2794e-02, -3.4357e-01, -1.8006e-01, -1.1661e-02,
         0.0000e+00,  3.4367e-01,  5.3540e-02, -2.1577e-01, -5.6823e-01,
        -8.4531e-02, -6.9139e-02, -3.6387e-01, -1.5407e-01,  1.0011e-01,
        -5.2393e-01, -1.2947e+00,  1.1243e-01,  1.0997e+00,  1.5975e+00,
         1.5071e+00,  5.2009e-01,  1.1836e+00, -2.4439e+00, -5.6879e-01,
        -2.7414e-01,  1.5649e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.1913e-02, -4.5387e-02,  0.0000e+00, -1.7755e+00,
         4.2778e-02, -1.9666e+00,  1.2646e-01,  9.4528e-02,  0.0000e+00,
         0.0000e+00,  2.1740e-02, -1.7337e-01, -8.7121e-02,  3.3313e-02,
         1.9914e-01, -4.1977e-01, -3.9246e-01,  1.7793e-01,  2.3912e-01,
        -3.9531e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5136]), tensor(0.2117))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-1.1594e-02, -5.2073e-03, -6.3248e-01, -8.0822e-01, -7.0266e-01,
        -1.4151e-01, -1.8634e+00, -1.0292e+00, -8.8950e-03,  9.8507e-03,
        -3.5172e-01, -2.3780e-01,  5.1335e-02, -3.8287e-03,  3.3370e-02,
        -1.4351e+00, -2.2808e-01, -1.2205e-01,  0.0000e+00, -2.4636e-01,
         3.8865e-01, -2.0729e-02,  8.3911e-03,  3.7377e-02,  7.5325e-03,
        -6.3693e-01, -7.4307e-01,  0.0000e+00, -7.7996e-01,  3.6407e-02,
        -9.5491e-01, -3.4028e-01,  4.7802e-02,  0.0000e+00, -2.4158e+00,
         7.5641e-03, -6.2660e-01, -6.6273e-01, -2.9067e-01, -7.8528e-01,
         6.4925e-01, -9.4471e-01, -5.3122e-01, -1.8937e-01,  1.4665e-02,
        -1.4826e-01, -5.0533e-01, -3.3594e-01, -2.8811e-01, -7.2144e-03,
         1.2393e-01, -1.4796e+00, -4.8504e-01, -1.9579e-03, -7.4145e-01,
        -1.6221e+00, -1.0965e+00, -3.7581e-01, -5.2418e-02,  1.4472e-02,
        -2.8946e+00, -4.9031e-02, -8.8467e-02, -5.0532e+00, -9.7408e-03,
        -3.8957e-01, -1.0467e-02,  1.8309e+00, -5.8154e-01, -3.6450e-01,
         0.0000e+00,  0.0000e+00, -1.7687e-02,  8.9230e-02, -1.9116e-01,
        -2.3047e-01, -1.4984e-01,  3.2335e+00, -2.0202e-01, -1.1661e-02,
         0.0000e+00, -1.0029e+00, -2.6086e-02,  2.4173e+00,  3.8172e+00,
        -7.2883e-02, -6.3519e-02, -2.3079e-01,  6.0293e-01, -2.8818e-01,
         7.5226e-01,  5.6420e-01,  1.1243e-01, -7.3275e-01, -5.6379e-01,
        -1.0268e+00,  6.7123e-01, -1.0431e+00,  7.4876e-01, -9.3762e-01,
         5.1446e-01, -7.1605e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.0050e-02, -4.5387e-02,  0.0000e+00, -1.2264e+00,
        -1.4060e+00,  7.4562e-02, -1.6812e-02,  5.0167e+00,  0.0000e+00,
         0.0000e+00, -1.4247e+00, -2.3928e-01, -8.7121e-02,  1.6202e+00,
         2.5870e-03,  7.5664e-01, -3.9878e-01, -8.1722e-02, -1.6801e-02,
         1.0158e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3475]), tensor(0.0638))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.9844e-01,  1.5880e-01,  1.6742e-01, -1.2964e+00, -1.4980e-01,
        -6.3783e-01, -1.5070e-01, -3.3081e-01,  3.6132e-01, -1.5750e-01,
        -7.1271e-01, -3.7380e-02, -4.9664e-01,  9.8005e-03,  3.3467e-02,
         5.2172e-01, -1.3992e-01,  1.7420e-01,  0.0000e+00,  4.3468e-01,
        -3.6828e-01,  7.5725e-02,  2.5460e-02,  9.3107e-03, -6.7596e-02,
        -2.5247e-01, -5.6868e-01,  0.0000e+00,  3.8144e-01,  1.0111e+00,
         4.7515e-01, -1.2195e-01,  4.4010e-01,  0.0000e+00, -3.8085e-01,
        -1.9431e-01,  6.8593e-02,  5.1761e-01,  3.3254e-02, -1.1662e+00,
        -2.7735e-01,  2.7510e-01,  1.9260e-01, -6.6024e-02, -1.7060e-01,
        -6.7784e-01,  8.4519e-02, -8.4395e-02, -5.4257e-01, -1.9077e-01,
        -6.1714e-01,  6.5989e-01, -1.6348e-01,  1.0159e-03,  2.1732e-02,
         4.4457e-01, -7.6868e-01, -1.5251e-04, -2.6248e-01,  2.1522e-02,
         1.1277e-01, -3.2948e-01,  1.5361e-01,  2.8391e-01,  1.4703e-01,
        -1.1827e-01,  2.8385e-03, -7.3083e-02,  7.4370e-01, -4.1918e-01,
         0.0000e+00,  0.0000e+00, -2.3610e-01, -8.1725e-01,  3.7470e-02,
         5.8416e-01,  4.2455e-02, -3.4501e-01, -1.8188e-01, -2.3916e-03,
         0.0000e+00,  2.8639e-01,  6.1073e-02, -2.5530e-01, -5.5517e-01,
        -9.0869e-02, -7.4242e-02, -3.6215e-01, -1.4420e-01,  1.0281e-01,
        -5.1478e-01, -1.2853e+00,  4.8167e-02,  1.2549e+00,  1.7486e+00,
         1.6574e+00,  5.6220e-01,  1.3352e+00, -2.6341e+00, -4.1360e-01,
        -2.9873e-01,  1.2191e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.2007e-02,  2.3354e-01,  0.0000e+00, -1.4879e+00,
         2.6651e-01, -2.1535e+00,  1.3354e-01,  2.7724e-02,  0.0000e+00,
         0.0000e+00,  2.5039e-02, -1.7800e-01,  7.3311e-03,  7.8641e-03,
         1.7098e-01, -4.2237e-01, -3.8414e-01,  1.9750e-01,  2.4554e-01,
        -3.9752e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5647]), tensor(0.2117))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-1.1408e-02,  2.9146e-03, -6.1383e-01, -4.2858e-01, -2.9630e-01,
        -6.0289e-02, -1.9494e+00, -1.0588e+00, -3.6764e-02,  1.0514e-01,
        -2.3164e-02,  1.5815e-02, -4.1062e-02, -1.5777e-02,  4.1894e-02,
         3.7534e-01, -2.2006e-01, -4.8981e-01,  0.0000e+00,  2.6484e-03,
        -8.1112e-02,  7.5725e-02,  4.7021e-02,  9.6214e-01, -9.3196e-03,
        -5.7378e-03, -7.2997e-01,  0.0000e+00, -1.4391e+00,  4.6592e-02,
         4.3140e-01, -1.7324e-01,  2.7589e-01,  0.0000e+00,  4.8498e-04,
        -6.5325e-01,  7.3700e-03, -6.8489e-01, -8.4842e-01, -7.9342e-01,
         8.1526e-01,  9.7328e-02,  1.1858e-02,  2.3842e-02, -5.9593e-03,
         3.5118e-01,  8.3150e-02, -2.4606e-01, -4.1683e-01,  5.9663e-02,
         8.9991e-01, -1.3893e+00, -5.1699e-01, -2.5068e+00, -7.4364e-01,
         1.1063e-02, -1.0926e+00,  6.9774e-01,  6.0065e-03, -3.9788e-01,
        -6.2875e-03,  6.3306e-03,  1.2690e-02,  1.5952e-02, -2.4946e-02,
         4.0374e-03, -5.0861e-03,  1.7707e+00,  1.3950e+00, -1.1070e-02,
         0.0000e+00,  0.0000e+00, -2.3610e-01,  6.2752e-01,  1.6399e-02,
        -8.9769e-02,  3.0359e-04, -2.2936e-04,  6.4728e-04, -2.3916e-03,
         0.0000e+00, -3.2955e-01, -5.9469e-02, -4.4773e-01, -5.7442e-01,
        -7.8031e-02, -6.8496e-02,  2.5780e-02, -2.3675e-03, -9.3063e-02,
        -6.5661e-01,  6.1256e-01,  4.8167e-02, -6.9923e-01,  9.4130e-02,
        -1.0595e+00, -1.2968e+00, -1.1704e-01, -7.1630e-01, -1.0437e+00,
        -2.7773e-01, -9.0227e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0181e-02,  2.3354e-01,  0.0000e+00, -1.2998e+00,
        -1.2019e+00,  4.1334e-01,  6.2665e-02,  2.7724e-02,  0.0000e+00,
         0.0000e+00,  1.3064e-02, -2.0316e-01,  7.3311e-03, -1.8639e-02,
        -1.0349e-02,  1.1680e-03, -2.4945e-02,  2.4751e-01,  1.9720e-01,
         1.3884e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3357]), tensor(0.0196))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:main_restricted.py:Testing data year: 1988
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 5697
            device: cpu
            
2024-08-06 15:12:40,493	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-06 15:12:40,539	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-06 15:12:40,592	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_1c61b63ddcb23de0.zip' (5.14MiB) to Ray cluster...
2024-08-06 15:12:40,608	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_1c61b63ddcb23de0.zip'.
2024-08-06 15:12:42,386	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-06 15:34:12,279	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-06_15-12-42' in 0.2129s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 5697, 'embedding_dim': 1, 'dropout_rate': 0.49, 'lr': 1.036720427012069e-05, 'weight_decay': 5.503363365456109e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.01856777112441423
INFO:model_data_nn.py:Best trial testing loss: 0.02156883837878501
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-06_15-12-37_609679_871373/artifacts/2024-08-06_15-12-42/train_fnn_2024-08-06_15-12-42/driver_artifacts/train_fnn_0025b_00020_20_dropout_rate=0.4900,embedding_dim=1,hidden_dim=85,lr=0.0000,num_layers=4,weight_decay=0.0000_2024-08-06_15-12-42
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 6283, 'embedding_dim': 1, 'dropout_rate': 0.49, 'lr': 1.036720427012069e-05, 'weight_decay': 5.503363365456109e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.022293318398514686, 'avg_test_loss': 0.023572182429263427}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.019895492015918444, 'avg_test_loss': 0.023538768021089417}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.01963405100715875, 'avg_test_loss': 0.02353163938393556}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.019600845595229902, 'avg_test_loss': 0.02353581772636502}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.019596841083894, 'avg_test_loss': 0.023533907817846905}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.019589579464108855, 'avg_test_loss': 0.023532433236288206}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.019581432161275406, 'avg_test_loss': 0.023531081800859784}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.019576799174403994, 'avg_test_loss': 0.02353354250656701}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.019567252360792653, 'avg_test_loss': 0.02354114719726626}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.01955644862824365, 'avg_test_loss': 0.02353643295880888}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.019548035477656604, 'avg_test_loss': 0.023542820527318424}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.01953342710903049, 'avg_test_loss': 0.023534889774827625}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.01953454033578755, 'avg_test_loss': 0.023538820264029807}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.019519031864407583, 'avg_test_loss': 0.023530355687203106}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.019504507309366852, 'avg_test_loss': 0.023525194416413465}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.01949079251588553, 'avg_test_loss': 0.023526841576801995}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.019464888054420027, 'avg_test_loss': 0.023531715530822034}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.019459550264591015, 'avg_test_loss': 0.023523652862246718}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.019438921689958137, 'avg_test_loss': 0.023521053570983632}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.019418166158085445, 'avg_test_loss': 0.023515085404318188}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.019412157694731074, 'avg_test_loss': 0.02351458586492045}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.019393703872682872, 'avg_test_loss': 0.02350700236556511}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.019358108937377237, 'avg_test_loss': 0.023497635128116735}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.019354773426453854, 'avg_test_loss': 0.023500775695548103}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.019333611521325265, 'avg_test_loss': 0.02348872562820312}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.0193165614344107, 'avg_test_loss': 0.023481460996673153}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.01928156806450141, 'avg_test_loss': 0.023480150744729544}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.019283621684152482, 'avg_test_loss': 0.023468238024932322}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.0192557903453272, 'avg_test_loss': 0.023453689440684294}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.019252583529023166, 'avg_test_loss': 0.023449166919485294}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.019233120552338587, 'avg_test_loss': 0.023441429067182766}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.01922174112882182, 'avg_test_loss': 0.023437208875322774}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.019200662848109392, 'avg_test_loss': 0.02343491957177438}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.019201261214330995, 'avg_test_loss': 0.02342194124745826}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.019180371143562868, 'avg_test_loss': 0.02341383190885667}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.019151465421212113, 'avg_test_loss': 0.023404907580384965}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.01913109227659119, 'avg_test_loss': 0.023396065106905835}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.019131986135671363, 'avg_test_loss': 0.023388208418343496}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.019110398720695726, 'avg_test_loss': 0.023379608305291302}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.019103701167592878, 'avg_test_loss': 0.02338017650719692}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.01907667172509908, 'avg_test_loss': 0.023369078305349636}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.01907189141407057, 'avg_test_loss': 0.023366021758486188}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.01906939851806352, 'avg_test_loss': 0.02336327444827084}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.01904981168636918, 'avg_test_loss': 0.023356704741105516}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.01903421808085014, 'avg_test_loss': 0.0233572056224089}
INFO:model_data_nn.py:Epoch 46/50, metrics: {'avg_train_loss': 0.019013836600619855, 'avg_test_loss': 0.023351115913140357}
INFO:model_data_nn.py:Epoch 47/50, metrics: {'avg_train_loss': 0.01901569101836017, 'avg_test_loss': 0.023346589505171742}
INFO:model_data_nn.py:Epoch 48/50, metrics: {'avg_train_loss': 0.018996618347166226, 'avg_test_loss': 0.02335362784784808}
INFO:model_data_nn.py:Epoch 49/50, metrics: {'avg_train_loss': 0.01898043338557956, 'avg_test_loss': 0.023351669799716722}
INFO:model_data_nn.py:Epoch 50/50, metrics: {'avg_train_loss': 0.01898188387891586, 'avg_test_loss': 0.0233416213961919}
INFO:main_restricted.py:Making prediction for data in year: 1989
INFO:main_restricted.py:Prediction data shape: (47501,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1989: 0.15275952148783084
INFO:main_restricted.py:Prediction Stats:                 ret          pred
count  47501.000000  47501.000000
mean       0.011252      0.005748
std        0.153399      0.011218
min       -0.900000     -0.075693
25%       -0.055556     -0.000292
50%        0.000000      0.006701
75%        0.066140      0.012771
max        6.384615      0.052976
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:transform_data_nn.py:Train_data: (375885, 161)

INFO:transform_data_nn.py:Test data years: [1990]
INFO:transform_data_nn.py:Test_data: (46774, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:transform_data_nn.py:Retrain_data: (422659, 161)

INFO:transform_data_nn.py:Prediction data years: [1991]
INFO:transform_data_nn.py:Prediction_data: (47150, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([375885, 138])
            y_train_tf: torch.Size([375885])

            x_test_tf: torch.Size([46774, 138])
            y_test_tf: torch.Size([46774])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([422659, 138])
            y_retrain_tf: torch.Size([422659])

            x_prediction_tf: torch.Size([47150, 138])
            y_prediction_tf: torch.Size([47150])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.8972e-01,  2.6420e-01,  1.5363e-01, -1.3069e+00, -1.4162e-01,
        -6.3605e-01, -1.6024e-01, -3.3749e-01,  3.7729e-01, -1.5824e-01,
        -7.1147e-01, -2.1879e-02, -5.0366e-01, -4.2017e-02,  5.9299e-02,
         5.1382e-01, -1.3424e-01,  1.9280e-01, -1.6829e-02,  4.2506e-01,
        -3.7289e-01,  9.2791e-02,  3.2835e-02,  1.1438e-02, -6.5504e-02,
        -2.5784e-01, -5.7382e-01, -6.8662e-02,  3.8562e-01,  1.0585e+00,
         4.7048e-01, -1.0666e-01,  4.4478e-01,  9.8409e-02, -3.7696e-01,
        -1.9346e-01,  7.3482e-02,  5.4720e-01,  1.7244e-02, -1.1608e+00,
        -2.8468e-01,  2.8830e-01,  2.1189e-01, -6.6772e-02, -1.7456e-01,
        -6.7313e-01,  8.4234e-02, -8.6078e-02, -4.8579e-01, -1.9296e-01,
        -6.3076e-01,  6.6311e-01, -1.5736e-01, -9.1068e-02,  2.1848e-02,
         4.3744e-01, -7.6442e-01,  1.3773e-02, -2.5472e-01, -4.8971e-03,
         1.1931e-01, -3.1866e-01,  1.4727e-01,  2.7139e-01,  1.2354e-01,
        -1.2522e-01,  8.2618e-02, -8.0370e-02,  7.3884e-01, -4.1938e-01,
         0.0000e+00,  0.0000e+00, -1.4421e-01, -8.1085e-01,  5.6494e-02,
         5.8140e-01,  3.9013e-02, -3.4606e-01, -1.8280e-01,  7.9242e-04,
        -2.2414e-02,  2.5705e-01,  6.6266e-02, -2.8663e-01, -5.5589e-01,
        -9.6492e-02, -7.8649e-02, -3.5369e-01, -1.2660e-01,  1.1666e-01,
        -5.1295e-01, -1.2772e+00,  1.3821e-02,  1.3845e+00,  1.8870e+00,
         1.7755e+00,  7.0894e-01,  1.4378e+00, -2.4874e+00, -2.2063e-01,
        -2.9489e-01,  1.0297e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.4179e-02,  2.6416e-01,  0.0000e+00, -1.2481e+00,
         4.0861e-01, -2.3284e+00,  1.3995e-01,  3.2667e-02,  0.0000e+00,
         0.0000e+00,  1.9527e-02, -1.8033e-01,  6.7643e-03, -1.7292e-02,
         6.7000e-02, -4.3188e-01, -3.7835e-01,  2.1099e-01,  2.4922e-01,
        -3.9976e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([5893]), tensor(0.2117))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([ 1.8820e-02,  8.3680e-02, -7.9874e-01, -1.1744e-01,  8.1926e-01,
        -7.0996e-01, -1.9966e+00, -1.0775e+00, -3.6405e-01, -1.3855e-01,
        -1.6774e-02,  9.3288e-03, -4.2412e-02, -6.4712e-02,  3.6116e-02,
         5.4810e-01, -1.9479e-01,  7.7155e-01,  4.5852e-01,  8.7119e-03,
         7.4209e-01, -1.8899e-01,  5.2501e-02, -4.2265e-01,  5.2064e-01,
        -6.4386e-03, -7.2439e-01, -6.8662e-02, -8.0948e-01,  4.1203e-02,
         1.8714e-01,  1.3541e-02,  3.3481e-01,  9.8409e-02, -1.4494e-03,
        -1.1368e+00,  1.3192e-02, -7.0466e-01,  6.3335e-01, -7.0855e-01,
        -1.4501e-01,  1.5804e-01,  1.2192e-02,  2.3968e-02, -3.7000e-03,
        -4.4552e-01,  9.5932e-01,  2.0401e-01, -4.1580e-01,  1.2171e+00,
         1.6730e+00, -1.1007e+00, -6.2636e-01, -1.2679e+00, -7.4223e-01,
         8.0022e-03, -1.0893e+00,  1.1615e+00, -7.9993e-04,  6.2808e-02,
        -3.9909e-03, -2.7642e-04,  9.0410e-03,  1.8528e-02, -1.0378e-02,
         3.0594e-05,  5.1983e-02, -2.5582e+00,  8.5946e-02, -1.0104e-02,
         0.0000e+00,  0.0000e+00, -1.4421e-01, -5.5099e-01,  1.1204e-02,
         3.0825e-01,  9.9530e-04, -1.9123e-03,  2.5390e-03,  7.9242e-04,
         1.9376e-01,  6.0692e-01, -1.5442e-01,  2.0061e-02, -4.6656e-01,
        -8.4911e-02, -7.3589e-02,  3.1820e-02,  5.3414e-03,  2.8129e-01,
        -5.4592e-01, -1.2772e+00,  1.3821e-02, -1.1170e+00, -8.8277e-01,
        -1.2188e+00, -5.4814e-01, -2.8496e-01, -9.4263e-01, -1.1195e+00,
        -2.3083e-01,  1.6644e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.6646e-02,  3.1921e-01,  0.0000e+00, -9.3808e-01,
        -9.4247e-01,  2.4640e-01,  1.1855e-01,  3.2667e-02,  0.0000e+00,
         0.0000e+00,  1.1356e-02,  2.3742e-01,  6.7643e-03, -1.8907e-02,
        -5.7504e-02,  4.7245e-04, -2.3224e-02,  3.4302e-01,  3.7060e-01,
        -2.7359e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3288]), tensor(-0.0185))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.7425e-01,  3.7754e-01,  1.4934e-01, -1.3170e+00, -1.3253e-01,
        -6.4465e-01, -1.6967e-01, -3.4584e-01,  3.4598e-01, -1.5492e-01,
        -7.0767e-01, -1.1320e-02, -4.9315e-01, -1.1341e-01,  7.7373e-02,
         5.1234e-01, -1.2838e-01,  1.9862e-01, -4.8695e-02,  4.3362e-01,
        -3.5150e-01,  3.8941e-02,  3.6587e-02,  1.5554e-02, -5.9349e-02,
        -2.6173e-01, -5.6831e-01, -2.7338e-04,  3.9550e-01,  1.0619e+00,
         4.6676e-01, -9.5131e-02,  4.4205e-01,  8.6933e-03, -3.7636e-01,
        -1.9066e-01,  7.8067e-02,  5.6022e-01,  1.4630e-02, -1.1506e+00,
        -2.9475e-01,  3.6848e-01,  2.3401e-01, -8.0414e-02, -1.7311e-01,
        -6.7188e-01,  1.2521e-01, -5.8672e-02, -4.5347e-01, -1.4579e-01,
        -6.4478e-01,  6.6964e-01, -1.5089e-01, -6.6906e-02,  2.4691e-02,
         4.3137e-01, -7.5919e-01,  3.8151e-02, -2.5174e-01, -1.8652e-02,
         1.2382e-01, -3.1448e-01,  1.4006e-01,  2.6348e-01,  1.1506e-01,
        -1.3377e-01,  1.6539e-01, -8.0429e-02,  7.3199e-01, -4.2069e-01,
         0.0000e+00,  0.0000e+00, -9.4989e-02, -8.0793e-01,  6.9545e-02,
         5.7868e-01,  3.3156e-02, -3.4722e-01, -1.8260e-01,  3.4026e-03,
        -6.5914e-03,  2.4846e-01,  4.3762e-02, -3.1158e-01, -5.5520e-01,
        -1.0190e-01, -8.3315e-02, -3.4428e-01, -1.0836e-01,  1.3599e-01,
        -5.0767e-01, -1.2661e+00,  3.9227e-03,  1.4985e+00,  2.0153e+00,
         1.9005e+00,  7.5873e-01,  1.5519e+00, -2.5355e+00, -1.0712e-01,
        -3.0477e-01,  1.0635e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0060e-02,  2.7572e-01,  0.0000e+00, -1.1510e+00,
         5.3159e-01, -2.2985e+00,  1.4497e-01,  3.1339e-02,  0.0000e+00,
         0.0000e+00,  1.4065e-02, -1.8017e-01,  9.3949e-03, -3.9383e-02,
         3.7427e-02, -4.3923e-01, -3.6782e-01,  2.2340e-01,  2.5535e-01,
        -4.0639e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6123]), tensor(0.2117))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([ 1.2993e-02,  7.0280e-02,  5.4580e-01,  1.4098e-01, -3.7937e-01,
        -3.2199e-01, -2.0970e+00, -1.0822e+00, -2.2737e-01, -3.1425e-01,
        -1.5613e-02,  5.8420e-03, -2.8197e-02, -5.8125e-02,  3.6224e-02,
        -1.3633e+00, -1.4110e-01,  5.8407e-02,  1.1676e-01,  1.4697e-02,
         6.4857e-02, -1.1747e-01,  5.8770e-01, -2.9751e-01, -3.5050e-01,
        -6.5498e-03, -6.6369e-01, -2.7338e-04, -1.0685e+00,  2.7080e-02,
        -2.0452e-01, -4.7176e-02,  2.9836e-01,  8.6933e-03, -5.4638e-04,
        -5.2011e-01,  7.9955e-03, -7.1260e-01, -1.1614e-01, -9.4484e-01,
         6.9123e-02, -7.7512e-01,  1.3185e-02,  1.1272e-02,  7.3407e-04,
         6.7760e-02, -2.7334e-01, -4.8967e-02,  7.1605e-01, -1.4864e-01,
         9.0603e-01, -1.0786e+00, -5.5943e-01, -9.6500e-01, -7.4081e-01,
         7.2555e-03, -1.0852e+00, -3.4742e-01, -2.2293e-03,  1.3772e-01,
        -5.0189e-03, -3.0738e-03,  9.1674e-03,  1.3885e-02, -7.3406e-03,
         7.6830e-04,  4.4575e-02, -4.2739e-01,  7.5308e-02, -9.8693e-03,
         0.0000e+00,  0.0000e+00, -9.4989e-02,  1.4364e-02,  9.7428e-03,
        -3.9122e-01,  1.5581e-03, -2.7052e-03,  7.7936e-04,  3.4026e-03,
         1.6028e-01, -5.3828e-01, -1.7883e-01,  6.0396e-01, -4.9598e-01,
        -9.2094e-02, -7.8620e-02,  2.6062e-02,  4.3028e-03,  1.0161e-01,
        -6.5284e-01,  9.4613e-01,  3.9227e-03, -2.9295e-01, -8.0607e-01,
        -7.0806e-01,  4.3613e-02, -6.3081e-01, -1.5640e-01,  4.2306e-02,
        -2.5627e-01,  9.5470e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.8296e-02,  2.1888e-01,  0.0000e+00, -1.0606e+00,
        -1.5565e+00, -1.9042e+00,  1.1952e-01,  3.1339e-02,  0.0000e+00,
         0.0000e+00,  1.1698e-02, -2.3071e-01,  9.3949e-03, -1.7782e-02,
         8.5195e-03,  7.6178e-05, -1.4510e-02,  2.6743e-01,  2.6624e-01,
        -2.8328e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3320]), tensor(0.0132))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:main_restricted.py:Testing data year: 1990
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 6562
            device: cpu
            
2024-08-06 16:40:20,748	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-06 16:40:20,797	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-06 16:40:20,852	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_cec3868ec8a8aeba.zip' (5.14MiB) to Ray cluster...
2024-08-06 16:40:20,868	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_cec3868ec8a8aeba.zip'.
2024-08-06 16:40:22,916	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-06 16:54:57,536	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-06_16-40-22' in 0.2443s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 4, 'num_embeddings': 6562, 'embedding_dim': 8, 'dropout_rate': 0.21, 'lr': 4.207988669606639e-06, 'weight_decay': 2.9375384576328334e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.01957203164647209
INFO:model_data_nn.py:Best trial testing loss: 0.03173521981457544
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-06_16-40-17_949704_871373/artifacts/2024-08-06_16-40-22/train_fnn_2024-08-06_16-40-22/driver_artifacts/train_fnn_3faae_00000_0_dropout_rate=0.2100,embedding_dim=8,hidden_dim=65,lr=0.0000,num_layers=4,weight_decay=0.0000_2024-08-06_16-40-23
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 4, 'num_embeddings': 6817, 'embedding_dim': 8, 'dropout_rate': 0.21, 'lr': 4.207988669606639e-06, 'weight_decay': 2.9375384576328334e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.022911324998085188, 'avg_test_loss': 0.04858047754420498}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.02202087542299364, 'avg_test_loss': 0.048291120952030586}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.021677770147857107, 'avg_test_loss': 0.04815674355748263}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.021552770603606098, 'avg_test_loss': 0.04800397828271799}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.021461667053554904, 'avg_test_loss': 0.0479130326242749}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.021424310015337365, 'avg_test_loss': 0.047909820052292856}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.021400711655973268, 'avg_test_loss': 0.047824893801707805}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.021374721267908757, 'avg_test_loss': 0.04785721636500947}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.021352484280459, 'avg_test_loss': 0.04780988126417728}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.021335422656505055, 'avg_test_loss': 0.047897143024436345}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.0213254348432441, 'avg_test_loss': 0.047882714773197645}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.02130290913197586, 'avg_test_loss': 0.04786340616577807}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.021302458866844027, 'avg_test_loss': 0.047916367143988205}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.02128411252485946, 'avg_test_loss': 0.04789906078167159}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.02126012900254736, 'avg_test_loss': 0.047940575743603914}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.021252195232929712, 'avg_test_loss': 0.04798102170748884}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.021241127279813293, 'avg_test_loss': 0.04794574323233954}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.02122010452659301, 'avg_test_loss': 0.047975901992572595}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.021199641970106414, 'avg_test_loss': 0.0478445354099499}
INFO:model_data_nn.py:Early stopping at epoch 19
INFO:main_restricted.py:Making prediction for data in year: 1991
INFO:main_restricted.py:Prediction data shape: (47150,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1991: 0.2187438903783398
INFO:main_restricted.py:Prediction Stats:                 ret          pred
count  47150.000000  47150.000000
mean       0.038270      0.002417
std        0.216332      0.011825
min       -0.937500     -0.104257
25%       -0.058140     -0.004830
50%        0.011494      0.002654
75%        0.100000      0.010381
max        9.000000      0.042178
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:transform_data_nn.py:Train_data: (469809, 161)

INFO:transform_data_nn.py:Test data years: [1992]
INFO:transform_data_nn.py:Test_data: (47572, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Retrain_data: (517381, 161)

INFO:transform_data_nn.py:Prediction data years: [1993]
INFO:transform_data_nn.py:Prediction_data: (50974, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([469809, 138])
            y_train_tf: torch.Size([469809])

            x_test_tf: torch.Size([47572, 138])
            y_test_tf: torch.Size([47572])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([517381, 138])
            y_retrain_tf: torch.Size([517381])

            x_prediction_tf: torch.Size([50974, 138])
            y_prediction_tf: torch.Size([50974])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.7234e-01,  4.6972e-01,  1.3369e-01, -1.3233e+00, -1.1615e-01,
        -6.5763e-01, -1.7787e-01, -3.5546e-01,  3.2117e-01, -1.5645e-01,
        -7.0541e-01, -1.5574e-03, -4.8483e-01, -1.7368e-01,  8.8285e-02,
         5.0900e-01, -1.2565e-01,  1.9820e-01, -8.7710e-02,  4.5217e-01,
        -3.6214e-01,  1.5567e-03,  1.2075e-02,  2.0896e-02, -5.7166e-02,
        -2.6419e-01, -5.6232e-01, -1.1018e-02,  3.9683e-01,  1.0666e+00,
         4.3934e-01, -8.5856e-02,  4.4396e-01, -5.2619e-03, -3.7864e-01,
        -1.8745e-01,  8.5812e-02,  5.7862e-01,  2.0035e-02, -1.1342e+00,
        -3.0314e-01,  3.5782e-01,  2.6210e-01, -9.0749e-02, -1.6322e-01,
        -6.7575e-01,  1.2232e-01, -7.2473e-02, -4.3025e-01, -1.6126e-01,
        -6.6996e-01,  6.6997e-01, -1.4319e-01, -4.9841e-02,  3.0161e-02,
         4.2920e-01, -7.5336e-01,  5.1860e-02, -2.4874e-01, -2.6112e-02,
         1.2572e-01, -3.1123e-01,  1.3579e-01,  2.5557e-01,  1.1514e-01,
        -1.4038e-01,  2.3383e-01, -9.0486e-02,  7.2582e-01, -4.2017e-01,
        -1.2030e-01, -4.4965e-02, -7.9972e-02, -8.0907e-01,  8.3420e-02,
         5.8997e-01,  2.7258e-02, -3.4975e-01, -1.8380e-01, -2.8744e-04,
        -1.9863e-02,  2.5660e-01,  2.5976e-02, -3.2665e-01, -5.5216e-01,
        -1.0612e-01, -8.7828e-02, -3.3475e-01, -9.2894e-02,  1.5286e-01,
        -5.0040e-01, -1.2594e+00,  3.0052e-03,  1.6066e+00,  2.0217e+00,
         2.0209e+00,  6.7476e-01,  1.6506e+00, -2.6817e+00, -3.3824e-02,
        -3.0674e-01,  1.2242e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.5031e-02,  2.6305e-01,  0.0000e+00, -1.1035e+00,
         6.1772e-01, -2.2042e+00,  1.4834e-01,  3.5943e-02,  0.0000e+00,
         0.0000e+00,  1.1816e-02, -1.7538e-01,  9.9392e-03, -5.9433e-02,
         4.2013e-02, -4.4646e-01, -3.5918e-01,  2.3720e-01,  2.6317e-01,
        -4.1316e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6418]), tensor(0.2117))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([ 6.2642e-03,  6.7182e-02, -6.4165e-01,  3.5846e-01, -2.5759e-01,
        -4.6121e-01, -2.1794e+00, -1.0532e+00, -5.0706e-01, -3.2195e-01,
        -1.5071e-02,  4.0833e-03, -4.0119e-02, -5.0377e-02,  3.2950e-02,
         2.5575e-01, -1.9624e-01,  5.8189e-02,  1.8857e-01,  2.0410e-02,
         5.6067e-01, -8.3279e-02,  2.3434e-02, -2.9241e-01, -1.5860e-01,
        -6.7403e-03, -6.9119e-01, -9.8580e-01, -6.3083e-01,  3.5019e-02,
        -2.1587e-02, -8.3943e-02,  2.2857e-01, -5.2619e-03, -1.2769e-03,
        -5.1239e-01,  1.3431e-02, -7.3048e-01, -1.5444e-01, -1.0767e+00,
         9.0696e-03,  2.6169e-01,  1.9195e-02,  2.4653e-02,  7.3430e-03,
        -2.5199e-01,  9.6112e-01, -1.2186e-01,  3.9670e-01,  1.1515e+00,
         1.6549e+00, -8.2762e-01, -6.1543e-01, -8.2104e-01, -7.3789e-01,
         5.2873e-03, -1.0808e+00,  1.1631e+00, -2.7504e-03, -7.3552e-01,
        -4.3126e-03, -3.2616e-03,  7.3414e-03,  9.9719e-03, -7.7297e-03,
        -1.0633e-03,  4.0335e-02, -5.7112e+00,  7.2582e-01, -9.7144e-03,
        -1.2030e-01, -4.4965e-02, -7.9972e-02, -1.1711e-01,  9.2094e-03,
        -2.6444e-02,  1.6299e-03, -4.6931e-03,  3.7746e-04, -2.8744e-04,
         1.3632e-01, -2.4099e-01, -3.6805e-01,  7.0494e-01, -3.3731e-01,
        -3.1895e-03, -1.5419e-03,  3.1128e-02,  4.8253e-03,  1.0913e-01,
        -4.2202e-01, -3.7713e-01,  3.0052e-03, -1.3418e+00, -2.4070e+00,
        -9.2789e-01,  1.9075e+00, -1.6080e+00,  8.2921e-01, -9.7018e-01,
        -5.8507e-02,  1.3223e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  4.1613e-02,  5.8432e-01,  0.0000e+00, -2.3980e-01,
        -1.7502e-01, -1.5754e+00,  1.2281e-01,  3.5943e-02,  0.0000e+00,
         0.0000e+00,  1.3431e-02, -1.9908e-01,  9.9392e-03, -1.5549e-02,
         8.2946e-04, -7.8995e-04, -2.5634e-02,  2.8180e-01,  2.6638e-01,
        -3.9954e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3415]), tensor(-0.0517))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.7017e-01,  5.4430e-01,  1.2009e-01, -1.3250e+00, -1.0880e-01,
        -6.7292e-01, -1.8004e-01, -3.5933e-01,  3.2668e-01, -1.5317e-01,
        -7.0589e-01,  7.4726e-03, -4.8743e-01, -2.2608e-01,  1.0144e-01,
         5.1039e-01, -1.2794e-01,  2.0643e-01, -1.0678e-01,  4.7095e-01,
        -3.3926e-01,  1.6034e-03,  1.7851e-02,  1.7928e-02, -5.3087e-02,
        -2.6831e-01, -5.6195e-01, -1.7845e-02,  3.8549e-01,  1.0970e+00,
         4.2313e-01, -8.9777e-02,  4.4965e-01, -1.3829e-02, -3.8024e-01,
        -1.8186e-01,  1.0190e-01,  5.8749e-01,  2.8611e-02, -1.1229e+00,
        -3.0893e-01,  3.1183e-01,  2.8781e-01, -8.9431e-02, -1.5191e-01,
        -6.8379e-01,  1.0111e-01, -7.6698e-02, -4.0679e-01, -1.6009e-01,
        -6.9287e-01,  6.6100e-01, -1.3563e-01, -3.9684e-02,  2.3737e-02,
         4.2900e-01, -7.4683e-01,  5.1487e-02, -2.5445e-01, -2.8726e-02,
         1.2699e-01, -3.1623e-01,  1.3253e-01,  2.5171e-01,  1.1643e-01,
        -1.4354e-01,  2.8767e-01, -1.0047e-01,  7.1446e-01, -4.1912e-01,
        -1.6563e-01, -6.4405e-02, -3.0634e-02, -8.1485e-01,  9.5358e-02,
         6.0610e-01,  2.5212e-02, -3.5232e-01, -1.8446e-01,  6.2203e-03,
        -2.2769e-02,  2.6777e-01,  2.8779e-02, -3.3119e-01, -5.5081e-01,
        -1.0952e-01, -9.1631e-02, -3.2660e-01, -8.1110e-02,  1.6108e-01,
        -4.9870e-01, -1.2566e+00,  4.5272e-03,  1.6870e+00,  1.9463e+00,
         2.1191e+00,  3.9819e-01,  1.6656e+00, -2.7099e+00,  7.7995e-02,
        -2.9821e-01,  1.3334e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0548e-02,  3.9668e-01,  0.0000e+00, -1.1758e+00,
         6.5412e-01, -2.1153e+00,  1.5104e-01,  2.5704e-02,  0.0000e+00,
         0.0000e+00,  1.5606e-02, -1.6936e-01,  1.0378e-02, -6.9491e-02,
         4.7393e-02, -4.4982e-01, -3.5714e-01,  2.4907e-01,  2.6962e-01,
        -4.1738e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([6754]), tensor(0.2117))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([ 8.2728e-03,  5.4755e-02, -4.9370e-01,  5.4448e-01,  2.9865e-01,
        -6.0803e-01, -2.2079e+00, -1.0301e+00, -4.6674e-01, -2.4042e-01,
        -1.7592e-02,  4.2173e-03, -3.7468e-02, -4.0824e-02,  2.9185e-02,
        -1.0207e+00, -1.7753e-01,  6.2290e-01,  1.4153e-01,  1.1150e-02,
         7.8102e-01, -7.0740e-02, -2.0869e-02, -3.4765e-01,  1.4737e-01,
        -9.8068e-03, -6.4582e-01, -7.3177e-01, -1.2937e+00,  3.8182e-02,
        -2.6866e-02, -2.1075e-01,  1.8523e-01, -1.3829e-02,  1.1890e-03,
         1.3803e+00,  1.7985e-02, -7.3909e-01,  4.1833e-01, -1.0074e+00,
        -4.5112e-02, -2.2884e-01,  1.1162e-02,  3.1080e-02,  4.3183e-03,
        -5.2148e-01, -2.0603e-01, -1.8556e-01,  3.2134e-01,  5.6058e-01,
         1.6397e+00, -8.3847e-01, -5.9076e-01, -7.3768e-01, -7.3865e-01,
         2.3038e-03, -1.0761e+00, -4.3372e-02, -9.3552e-03,  2.7181e-01,
        -5.0712e-03, -9.1803e-03,  1.0368e-02,  1.4657e-02, -9.1383e-03,
         5.3932e-03,  3.0839e-02,  1.1480e+00,  5.0633e-02, -1.2962e-02,
        -1.6563e-01, -6.4405e-02, -3.0634e-02, -4.5080e-01,  8.8855e-03,
         2.7061e-02,  1.3338e-03, -4.3063e-03,  1.4568e-03,  6.2203e-03,
         1.1851e-01, -4.7181e-01, -3.6238e-01, -1.7764e-01, -5.0873e-01,
        -3.4696e-03, -2.0132e-03,  3.1328e-02,  3.6180e-03,  1.2567e-01,
        -6.3390e-01,  9.6623e-01,  4.5272e-03, -1.3421e+00, -1.5261e+00,
        -9.5565e-01,  1.8065e+00, -1.6348e+00,  1.2081e+00, -1.1387e+00,
        -2.9790e-01,  3.0578e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.3509e-02,  2.2757e-01,  0.0000e+00,  5.2594e-01,
        -3.2482e-02,  5.0274e-01,  1.0084e-01,  2.5704e-02,  0.0000e+00,
         0.0000e+00,  1.5330e-02,  2.4573e-02,  1.0378e-02, -8.7727e-03,
         6.8298e-03,  1.7210e-03, -2.3708e-02,  1.1407e-01,  1.7418e-01,
        -3.3056e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3685]), tensor(0.))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:main_restricted.py:Testing data year: 1992
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 7144
            device: cpu
            
2024-08-06 18:05:37,467	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-06 18:05:37,522	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-06 18:05:37,577	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_cec3868ec8a8aeba.zip' (5.14MiB) to Ray cluster...
2024-08-06 18:05:37,592	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_cec3868ec8a8aeba.zip'.
2024-08-06 18:05:39,821	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-06 18:27:52,926	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-06_18-05-39' in 0.2417s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 165, 'num_layers': 1, 'num_embeddings': 7144, 'embedding_dim': 1, 'dropout_rate': 0.53, 'lr': 0.0017996169659044356, 'weight_decay': 0.0001132905062949675, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.02331179778170277
INFO:model_data_nn.py:Best trial testing loss: 0.03813864025087046
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-06_18-05-34_720050_871373/artifacts/2024-08-06_18-05-39/train_fnn_2024-08-06_18-05-39/driver_artifacts/train_fnn_2994a_00080_80_dropout_rate=0.5300,embedding_dim=1,hidden_dim=165,lr=0.0018,num_layers=1,weight_decay=0.0001_2024-08-06_18-05-40
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 165, 'num_layers': 1, 'num_embeddings': 7524, 'embedding_dim': 1, 'dropout_rate': 0.53, 'lr': 0.0017996169659044356, 'weight_decay': 0.0001132905062949675, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.025132546261946484, 'avg_test_loss': 0.0383246252324927}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.024753190400304697, 'avg_test_loss': 0.03749374884710575}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.024733962313622744, 'avg_test_loss': 0.037378402388325536}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.024725296391973264, 'avg_test_loss': 0.03747609219418134}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.02470227376106741, 'avg_test_loss': 0.037395127105963114}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.02470387049933609, 'avg_test_loss': 0.03733881304792145}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.02468944080026506, 'avg_test_loss': 0.03774638352145378}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.024706525679950533, 'avg_test_loss': 0.03716941234798061}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.024687258311017854, 'avg_test_loss': 0.03758074129163696}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.024689319993533795, 'avg_test_loss': 0.03752002072401513}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.024715090209442177, 'avg_test_loss': 0.03765308153920604}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.024660577859318474, 'avg_test_loss': 0.037385824850683376}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.02469091883131046, 'avg_test_loss': 0.03722455273417378}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.02467869930195114, 'avg_test_loss': 0.037066479953458735}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.024682689238088976, 'avg_test_loss': 0.03733044531765886}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.024694825872365996, 'avg_test_loss': 0.03785736761861166}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.02468574064853336, 'avg_test_loss': 0.03722803645480172}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.024694294276574, 'avg_test_loss': 0.03773743784367889}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.024695081487463907, 'avg_test_loss': 0.03710594035236907}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.024675039915051836, 'avg_test_loss': 0.03708328614781674}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.0246749734994483, 'avg_test_loss': 0.037481225144706275}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.024687585645557585, 'avg_test_loss': 0.037444722707987876}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.02471019993448618, 'avg_test_loss': 0.03764084282501561}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.024694220143803965, 'avg_test_loss': 0.03717334034915706}
INFO:model_data_nn.py:Early stopping at epoch 24
INFO:main_restricted.py:Making prediction for data in year: 1993
INFO:main_restricted.py:Prediction data shape: (50974,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1993: 0.19286117849814413
INFO:main_restricted.py:Prediction Stats:                 ret          pred
count  50974.000000  50974.000000
mean       0.018012      0.007249
std        0.193299      0.018629
min       -0.950000     -0.116049
25%       -0.061224     -0.001268
50%        0.000000      0.006501
75%        0.075000      0.013371
max       19.000000      0.186367
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:transform_data_nn.py:Train_data: (625283, 161)

INFO:transform_data_nn.py:Test data years: [1995]
INFO:transform_data_nn.py:Test_data: (64688, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:transform_data_nn.py:Retrain_data: (689971, 161)

INFO:transform_data_nn.py:Prediction data years: [1996]
INFO:transform_data_nn.py:Prediction_data: (66364, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([625283, 138])
            y_train_tf: torch.Size([625283])

            x_test_tf: torch.Size([64688, 138])
            y_test_tf: torch.Size([64688])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([689971, 138])
            y_retrain_tf: torch.Size([689971])

            x_prediction_tf: torch.Size([66364, 138])
            y_prediction_tf: torch.Size([66364])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-0.1577,  0.6453,  0.0969, -1.3052, -0.1139, -0.7019, -0.1833, -0.3657,
         0.3767, -0.1564, -0.7027,  0.0357, -0.4985, -0.2952,  0.1126,  0.5035,
        -0.1339,  0.2252, -0.0874,  0.4801, -0.3405,  0.0155,  0.0080,  0.0090,
        -0.0575, -0.2752, -0.5657, -0.0178,  0.3429,  1.1855,  0.4104, -0.0981,
         0.4655, -0.0238, -0.3644, -0.1862,  0.1035,  0.6340,  0.0177, -1.1194,
        -0.3136,  0.3177,  0.2852, -0.0695, -0.1550, -0.7002,  0.0979, -0.0723,
        -0.4205, -0.1636, -0.7271,  0.6331, -0.1250, -0.0247,  0.0110,  0.4260,
        -0.7312,  0.0713, -0.2568, -0.0265,  0.1289, -0.3170,  0.1312,  0.2541,
         0.1071, -0.1490,  0.3530, -0.1167,  0.6825, -0.4193, -0.2245, -0.0319,
        -0.0325, -0.8322,  0.1209,  0.6343,  0.0206, -0.3592, -0.1850,  0.0147,
        -0.0055,  0.2536,  0.0685, -0.3348, -0.5537, -0.1190, -0.1021, -0.3105,
        -0.0476,  0.1767, -0.5039, -1.2578,  0.0097,  1.8202,  2.0971,  2.2607,
         0.0844,  1.7846, -2.9385,  0.3121, -0.2769,  0.1251,  0.0000, -1.3687,
         0.0000,  2.5697,  0.0523,  0.4312,  0.0000, -1.3243,  0.7496, -2.3021,
         0.1531,  0.0370,  0.0000, -0.4823,  0.0434, -0.1689,  0.0072, -0.0806,
         0.0807, -0.4368, -0.3565,  0.2660,  0.2791, -0.4143,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([8206]), tensor(0.2117))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-4.8066e-01, -5.3158e-01, -7.6841e-01,  8.6130e-01, -2.9824e-01,
        -2.2998e-01, -1.5583e+00, -9.7009e-01, -4.2586e-01, -3.5658e-01,
        -6.7166e-01,  3.1419e-04, -1.0122e-02,  5.5465e-01, -7.0534e-02,
        -4.6088e-01, -1.7403e-01,  4.1837e-01, -8.7361e-02, -7.1934e-02,
         1.0543e-03, -6.5737e-02, -1.4886e-01, -2.2623e-01, -5.5274e-02,
        -5.5608e-01, -5.8789e-01, -1.7779e-02, -1.3612e+00,  6.9908e-01,
        -2.9599e-02, -1.1618e-01,  2.4594e-01, -2.3766e-02, -7.5812e-01,
         6.2633e-04,  3.3862e-02, -7.4003e-01,  3.1846e-01, -8.3698e-01,
         2.0403e-01, -1.1175e+00,  1.0480e-01, -2.3817e-01, -3.0323e-01,
        -4.0674e-01, -3.7382e-01, -3.1333e-01,  3.7712e-02, -2.2814e-01,
         1.5775e+00, -7.7847e-01, -4.7933e-01, -6.4357e-01, -7.3522e-01,
         3.6407e-01, -1.0666e+00,  1.1197e-01, -3.2990e-01, -2.1675e-01,
         1.1525e-01, -4.1919e-01, -1.9774e-01,  2.1786e-01, -1.4641e-02,
        -4.3009e-01, -2.6660e-01,  6.9628e-01,  1.3476e+00, -4.6254e-01,
        -2.2454e-01, -3.1857e-02, -3.2545e-02, -1.0438e-01,  3.7271e-02,
        -3.0687e-01, -1.0035e-01, -1.8808e-01, -5.0568e-02,  1.4729e-02,
        -5.4953e-03, -5.0477e-01, -3.4215e-01, -4.9930e-01, -6.5569e-01,
        -1.0229e-01, -9.2467e-02, -3.2483e-01, -6.4822e-01,  1.1650e-01,
        -7.0002e-01,  4.9078e-01,  9.7207e-03, -9.8185e-01, -5.1013e-02,
        -1.1580e+00,  3.5138e-01, -4.4943e-01, -2.9017e-02, -1.2657e+00,
        -2.3464e-01, -2.5423e-01,  0.0000e+00, -1.3687e+00,  0.0000e+00,
         2.5697e+00,  2.0467e-02, -1.9099e-01,  0.0000e+00, -1.7541e-01,
        -4.9659e-01,  8.8398e-01,  1.2988e-01,  7.7985e-01,  0.0000e+00,
        -4.8228e-01, -4.5178e-01, -1.9502e-01, -3.7534e+00,  7.7595e-01,
         2.9813e-01, -5.3571e-01, -4.7830e-01,  2.0182e-01,  2.6188e-01,
        -3.6246e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2716]), tensor(-0.0312))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.5115e-01,  6.7878e-01,  8.6460e-02, -1.2846e+00, -1.2093e-01,
        -7.1391e-01, -1.7670e-01, -3.6376e-01,  4.0088e-01, -1.6083e-01,
        -6.9722e-01,  4.7871e-02, -4.9641e-01, -3.2117e-01,  1.1761e-01,
         4.9977e-01, -1.3510e-01,  2.3261e-01, -8.1522e-02,  4.7643e-01,
        -3.6452e-01,  8.5700e-03, -1.6375e-02,  2.7922e-03, -5.7475e-02,
        -2.7246e-01, -5.7264e-01, -1.7562e-02,  3.2162e-01,  1.2292e+00,
         4.0564e-01, -1.0071e-01,  4.7209e-01, -2.1404e-02, -3.4663e-01,
        -1.9729e-01,  9.3637e-02,  6.7096e-01,  6.0137e-03, -1.1201e+00,
        -3.1364e-01,  3.3389e-01,  2.7511e-01, -6.6658e-02, -1.6334e-01,
        -7.0643e-01,  1.0276e-01, -7.9072e-02, -4.1991e-01, -1.7377e-01,
        -7.4343e-01,  6.2106e-01, -1.1911e-01, -1.8509e-02, -5.8326e-04,
         4.2330e-01, -7.1753e-01,  7.7758e-02, -2.5199e-01, -1.6758e-02,
         1.2850e-01, -3.1115e-01,  1.3145e-01,  2.5882e-01,  1.0167e-01,
        -1.5566e-01,  3.7438e-01, -1.2248e-01,  6.7024e-01, -4.1602e-01,
        -2.4363e-01, -4.1873e-02,  1.0253e-02, -8.3795e-01,  1.3184e-01,
         6.4058e-01,  1.7745e-02, -3.6379e-01, -1.8291e-01,  1.5171e-02,
        -5.9800e-03,  2.4079e-01,  9.0698e-02, -3.3896e-01, -5.5515e-01,
        -1.2394e-01, -1.0768e-01, -3.0361e-01, -2.4351e-02,  1.7289e-01,
        -5.0532e-01, -1.2586e+00,  1.1638e-02,  1.8495e+00,  2.2177e+00,
         2.3412e+00,  7.3758e-02,  1.9010e+00, -2.9626e+00,  4.2520e-01,
        -2.6368e-01,  1.1265e-01,  8.7652e-01,  2.0998e-01, -2.8435e-01,
         3.2755e-01,  4.8188e-02,  3.4251e-01,  0.0000e+00, -1.3148e+00,
         8.3954e-01, -2.4254e+00,  1.5367e-01,  5.6624e-02,  0.0000e+00,
        -1.7589e-01,  7.0891e-02, -1.7468e-01, -7.7470e-03, -9.1207e-02,
         9.3465e-02, -4.1693e-01, -3.4837e-01,  2.7132e-01,  2.8253e-01,
        -4.1336e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([8923]), tensor(0.2117))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.4436e-01, -5.7929e-01, -5.1359e-01,  1.0057e+00, -8.1645e-02,
        -1.9217e-01, -6.2659e-01, -6.4998e-01, -4.6026e-01, -4.1355e-01,
        -7.1484e-01,  2.1049e-02, -1.3242e-01,  5.6856e-01,  1.4881e-01,
         6.9657e-02, -2.1576e-01,  3.3217e-01, -1.9636e-01,  1.4227e-01,
         2.0832e-01, -6.1980e-02, -2.1628e-02, -2.2795e-01,  9.1561e-02,
        -5.9874e-01, -6.0964e-01, -1.7562e-02, -1.3131e+00,  6.1630e-01,
        -4.4554e-01, -6.0665e-02,  2.4826e-01, -2.1404e-02, -7.3475e-01,
        -5.8997e-02,  2.5754e-01, -7.4060e-01, -6.5291e-02, -8.8391e-01,
        -1.2951e-02,  2.1373e-01,  2.6887e-01, -2.5199e-01, -1.5242e-01,
         1.9085e-01, -6.0896e-04,  5.1835e-01, -1.2395e-01,  4.5563e-02,
         1.5505e+00, -7.0046e-01, -5.8815e-01, -6.1109e-01, -7.3629e-01,
         3.9249e-01, -1.0568e+00,  3.6373e-01, -5.0217e-01, -3.7325e-01,
         1.0860e-01, -5.2731e-01, -2.1279e-01,  6.5980e-02, -1.5879e-02,
        -4.0546e-01, -2.6970e-01, -5.8012e-02,  1.3366e+00, -5.0869e-01,
        -2.4363e-01, -4.1873e-02,  1.0253e-02,  6.2562e-02,  5.6102e-02,
        -8.0481e-02,  8.5257e-02, -2.2827e-01, -5.2710e-02,  1.5171e-02,
         1.2069e-01, -6.1242e-02, -3.4225e-01,  1.1214e+00, -4.0444e-01,
        -1.0315e-01, -9.6106e-02, -3.4683e-01, -5.6943e-01,  2.5184e-01,
        -5.2606e-01, -6.4604e-01,  1.1638e-02, -1.8631e+00, -6.1791e-01,
        -1.1931e+00,  3.0440e-01, -5.8663e-01, -1.0121e+00, -1.0404e+00,
        -1.9768e-01,  9.6121e-02,  8.7652e-01, -3.5540e+00, -2.8435e-01,
         5.7011e+00,  2.1198e-02,  5.5717e-01,  0.0000e+00, -3.3296e-01,
        -8.1562e-01,  4.5206e-01,  1.3306e-01,  1.2583e+00,  0.0000e+00,
        -1.7589e-01, -3.9161e-01, -1.5439e-01, -3.7189e+00,  7.2864e-01,
         4.8963e-02, -4.9380e-01, -5.1432e-01,  2.2382e-01,  2.8417e-01,
        -3.8725e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2739]), tensor(-0.0267))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:main_restricted.py:Testing data year: 1995
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 9176
            device: cpu
            
2024-08-06 20:05:56,080	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-06 20:05:56,133	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-06 20:05:56,190	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_aa2eb759f0569a14.zip' (5.14MiB) to Ray cluster...
2024-08-06 20:05:56,206	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_aa2eb759f0569a14.zip'.
2024-08-06 20:05:58,461	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-06 20:58:34,379	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-06_20-05-58' in 0.2450s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 135, 'num_layers': 5, 'num_embeddings': 9176, 'embedding_dim': 3, 'dropout_rate': 0.54, 'lr': 0.004211096085003152, 'weight_decay': 2.0099400153590414e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.026380185245468587
INFO:model_data_nn.py:Best trial testing loss: 0.02704941248429181
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-06_20-05-53_241239_871373/artifacts/2024-08-06_20-05-58/train_fnn_2024-08-06_20-05-58/driver_artifacts/train_fnn_f839a_00035_35_dropout_rate=0.5400,embedding_dim=3,hidden_dim=135,lr=0.0042,num_layers=5,weight_decay=0.0000_2024-08-06_20-05-58
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 135, 'num_layers': 5, 'num_embeddings': 9990, 'embedding_dim': 3, 'dropout_rate': 0.54, 'lr': 0.004211096085003152, 'weight_decay': 2.0099400153590414e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.026662551349543852, 'avg_test_loss': 0.028915636275530666}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.02639705715605951, 'avg_test_loss': 0.02887429955087042}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.026462746580374983, 'avg_test_loss': 0.028853036203064557}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.026458773475506642, 'avg_test_loss': 0.0288412174082546}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.026460271530848598, 'avg_test_loss': 0.028840892312972877}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.026460597234914607, 'avg_test_loss': 0.028840963713473035}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.02645728857323859, 'avg_test_loss': 0.02884536426647177}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.026463660675555414, 'avg_test_loss': 0.028891875247088816}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.026459314910166228, 'avg_test_loss': 0.02884216666820967}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.026456660661735815, 'avg_test_loss': 0.028881386432057402}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.02645888504406337, 'avg_test_loss': 0.028842018003824934}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.026456919577186978, 'avg_test_loss': 0.028865044420631692}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.02645467074038478, 'avg_test_loss': 0.028836188094083916}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.026458760527531048, 'avg_test_loss': 0.02885477186982773}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.02645861621953008, 'avg_test_loss': 0.02883693956014537}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.02645883537044469, 'avg_test_loss': 0.02884030219361272}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.026459969446609048, 'avg_test_loss': 0.02883752954851025}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.02645803720557264, 'avg_test_loss': 0.02887297251310221}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.026459673204647587, 'avg_test_loss': 0.028873304038816393}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.02645723688414455, 'avg_test_loss': 0.028841180486428714}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.026457816618797068, 'avg_test_loss': 0.02885536094481459}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.026456327721518024, 'avg_test_loss': 0.02883832975378644}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.02645770070732248, 'avg_test_loss': 0.02889014366719879}
INFO:model_data_nn.py:Early stopping at epoch 23
INFO:main_restricted.py:Making prediction for data in year: 1996
INFO:main_restricted.py:Prediction data shape: (66364,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 1996: 0.16996704093197085
INFO:main_restricted.py:Prediction Stats:                 ret          pred
count  66364.000000  66364.000000
mean       0.016258      0.008834
std        0.169806      0.000000
min       -0.909091      0.008834
25%       -0.058824      0.008834
50%        0.003930      0.008834
75%        0.074962      0.008834
max        7.000000      0.008834
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Train_data: (896818, 161)

INFO:transform_data_nn.py:Test data years: [1999]
INFO:transform_data_nn.py:Test_data: (67277, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:transform_data_nn.py:Retrain_data: (964095, 161)

INFO:transform_data_nn.py:Prediction data years: [2000]
INFO:transform_data_nn.py:Prediction_data: (64295, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([896818, 138])
            y_train_tf: torch.Size([896818])

            x_test_tf: torch.Size([67277, 138])
            y_test_tf: torch.Size([67277])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([964095, 138])
            y_retrain_tf: torch.Size([964095])

            x_prediction_tf: torch.Size([64295, 138])
            y_prediction_tf: torch.Size([64295])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-0.1488,  0.7533,  0.0750, -1.2476, -0.1519, -0.7569, -0.1656, -0.3602,
         0.4780, -0.1583, -0.6885,  0.0783, -0.5135, -0.3668,  0.1212,  0.4896,
        -0.1480,  0.2461, -0.0563,  0.4904, -0.3380,  0.0060, -0.0411, -0.0043,
        -0.0578, -0.2754, -0.5904, -0.0276,  0.2305,  1.3513,  0.3869, -0.1161,
         0.4940, -0.0339, -0.3068, -0.2204,  0.0647,  0.7642, -0.0350, -1.1255,
        -0.3035,  0.3123,  0.2498, -0.0369, -0.1863, -0.7300,  0.0889, -0.0739,
        -0.4202, -0.1616, -0.7783,  0.5612, -0.0844, -0.0127, -0.0243,  0.4213,
        -0.6786,  0.0858, -0.2526, -0.0237,  0.1279, -0.3096,  0.1299,  0.2553,
         0.0939, -0.1723,  0.4206, -0.1331,  0.6621, -0.4178, -0.2869, -0.0715,
        -0.0063, -0.8678,  0.1638,  0.6726,  0.0182, -0.3751, -0.1779,  0.0122,
        -0.0064,  0.1907,  0.1541, -0.3084, -0.5612, -0.1376, -0.1242, -0.2829,
         0.0144,  0.1725, -0.5253, -1.2665,  0.0196,  1.6403,  2.3776,  2.5092,
        -0.0479,  2.2301, -3.0209,  0.6813, -0.3183,  0.1031, -0.1093,  0.0089,
         0.3125,  0.1606,  0.0519,  0.1725,  0.0000, -1.4881,  0.9867, -2.5294,
         0.1607,  0.0172,  0.0000, -0.0508,  0.1429, -0.1886, -0.0317, -0.1156,
         0.1113, -0.3708, -0.3355,  0.2916,  0.2944, -0.4155,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([10841]), tensor(0.2117))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-0.2410, -0.5335, -0.3746,  1.3860, -0.3429, -0.8196, -1.6391, -0.9134,
        -0.3522, -0.3109, -0.7424,  0.0232, -1.1585,  0.7056,  0.2790,  0.4521,
        -0.1871, -0.3078,  0.1022, -0.8319,  0.3385, -0.0601, -0.0390, -0.0513,
        -0.1370, -0.4237, -0.6392, -0.0276, -0.8768,  0.8968,  0.3119, -0.1579,
         0.2593, -2.2702, -0.7467, -0.4078, -0.4598, -0.6830, -0.7193, -1.0713,
        -0.2487, -0.5816, -0.5942, -0.1637, -0.3288, -0.8004, -0.0977,  0.1501,
        -0.3370,  0.1589,  0.7805, -0.7106, -0.7014, -0.5570, -0.7355,  0.3257,
        -1.0281, -0.0882, -0.1050, -0.1825, -0.0057,  0.3419,  0.7976, -0.8114,
        -0.0135,  0.6677, -0.3726,  0.4967,  0.6621, -0.3881, -0.2869, -0.0715,
        -0.0063, -0.8087,  0.0763,  0.7144,  1.6919, -0.2827, -0.1454,  0.0122,
         0.1191,  0.0638, -0.1463,  0.4895, -0.0530, -0.1227, -0.1160, -0.3504,
        -0.5495,  0.1847, -0.3889,  0.1537,  0.0196, -2.2990, -2.0316, -1.1479,
         0.4338, -0.7692, -0.8244, -0.0223,  0.2681, -0.5595, -0.1093,  1.7894,
         0.3125,  2.7875,  0.0287,  0.3256,  0.0000, -1.3763, -0.4234,  0.9716,
         0.1285,  2.6816,  0.0000, -0.0508,  0.0459, -0.2381, -3.6215,  0.6355,
         0.9841, -0.2907, -0.3943,  0.2007,  0.2682, -0.4057,  1.0000,  0.0000,
         0.0000,  0.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([2791]), tensor(0.))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.4963e-01,  7.7331e-01,  7.5467e-02, -1.2401e+00, -1.5562e-01,
        -7.7538e-01, -1.6396e-01, -3.5874e-01,  4.7901e-01, -1.5475e-01,
        -6.8697e-01,  8.7942e-02, -5.1425e-01, -3.7712e-01,  1.2134e-01,
         4.8733e-01, -1.4502e-01,  2.4296e-01, -5.7820e-02,  4.9726e-01,
        -3.4779e-01,  5.9739e-03, -3.9149e-02, -1.6977e-03, -5.1713e-02,
        -2.7604e-01, -5.9599e-01, -3.1014e-02,  2.0480e-01,  1.3757e+00,
         3.7385e-01, -1.1353e-01,  4.9929e-01, -2.1032e-02, -2.9519e-01,
        -2.2633e-01,  5.1461e-02,  7.9116e-01, -4.7016e-02, -1.1333e+00,
        -3.0087e-01,  3.3386e-01,  2.4733e-01, -3.3277e-02, -1.9322e-01,
        -7.3974e-01,  1.0270e-01, -7.3550e-02, -4.1774e-01, -1.5868e-01,
        -7.8968e-01,  5.4365e-01, -6.6836e-02, -1.3350e-02, -2.6730e-02,
         4.1966e-01, -6.6864e-01,  8.1968e-02, -2.4812e-01, -3.2814e-02,
         1.2860e-01, -3.0517e-01,  1.3017e-01,  2.5374e-01,  9.6638e-02,
        -1.7596e-01,  4.3228e-01, -1.3719e-01,  6.6238e-01, -4.1963e-01,
        -2.9754e-01, -2.5008e-02, -1.7887e-02, -8.8182e-01,  1.7426e-01,
         6.7406e-01,  1.9789e-02, -3.7784e-01, -1.7609e-01,  1.3414e-02,
        -9.6442e-03,  1.8168e-01,  1.6324e-01, -2.9306e-01, -5.5933e-01,
        -1.4113e-01, -1.2892e-01, -2.7914e-01,  2.6413e-02,  1.8375e-01,
        -5.2859e-01, -1.2705e+00,  2.0404e-02,  1.5788e+00,  2.3115e+00,
         2.5636e+00, -8.0809e-02,  2.3229e+00, -3.0747e+00,  7.2771e-01,
        -3.4287e-01,  1.0487e-01, -1.1082e-01, -3.6085e-03,  3.3826e-01,
         1.9396e-01,  5.3803e-02,  2.0500e-01,  0.0000e+00, -1.3818e+00,
         1.0458e+00, -2.5509e+00,  1.6421e-01,  2.0667e-02,  0.0000e+00,
        -2.5277e-02,  1.6155e-01, -1.9412e-01, -3.2054e-02, -1.2410e-01,
         1.1805e-01, -3.5857e-01, -3.2868e-01,  2.9897e-01,  2.9757e-01,
        -4.1361e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([11340]), tensor(0.2117))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-0.0150, -0.6763, -0.5130,  1.5026, -0.2554, -0.8136, -1.6103, -0.9120,
        -0.2097, -0.2357, -0.6851,  0.0328, -0.3096,  1.0031,  0.5485,  0.6054,
        -0.2260,  0.1459,  0.0427, -0.9663,  0.1900, -0.0626, -0.0425, -0.0517,
         0.0441, -0.4774, -0.6575, -0.0310, -0.9150,  1.2192, -0.0404, -0.1499,
         0.2957, -2.2210, -0.7824, -0.2834, -0.1834, -0.6235, -0.1686, -1.1178,
        -0.0530, -0.3106, -0.3606, -0.0957, -0.2657, -0.3779, -0.3610, -0.1023,
        -0.0484, -0.1090,  0.7758, -0.7794, -0.5548, -0.5490, -0.7351,  0.2577,
        -1.0209,  0.1240, -0.4132, -0.4364, -0.1778, -0.1046,  1.0675,  0.1030,
        -0.0132,  1.3116, -0.4845,  2.0911,  0.6624, -0.3817, -0.2975, -0.0250,
        -0.0179, -0.4363,  0.0702,  0.7979,  0.0561, -0.1098, -0.1514,  0.0134,
         0.1229,  0.0936,  0.0500,  0.2358, -0.5666, -0.1321, -0.1234, -0.2959,
        -0.5168, -0.3630, -0.5877, -0.1240,  0.0204, -2.2266, -1.5614, -1.1605,
         0.3023, -0.4107, -0.3642, -0.8625, -0.1967, -0.9605, -0.1108,  0.8525,
         0.3383,  2.0245,  0.0322, -0.8599,  0.0000, -0.6321,  0.0461,  1.2698,
         0.1188,  5.0115,  0.0000, -0.0253, -0.1566, -0.2267, -3.5661,  0.6462,
         0.1414, -0.1086, -0.4046,  0.2089,  0.2710, -0.4243,  1.0000,  0.0000,
         0.0000,  0.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([2653]), tensor(-0.0441))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:main_restricted.py:Testing data year: 1999
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 12154
            device: cpu
            
2024-08-06 23:37:19,586	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-06 23:37:19,641	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-06 23:37:19,697	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_aa2eb759f0569a14.zip' (5.14MiB) to Ray cluster...
2024-08-06 23:37:19,714	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_aa2eb759f0569a14.zip'.
2024-08-06 23:37:23,573	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-07 00:23:08,949	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-06_23-37-23' in 0.2540s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 2, 'num_embeddings': 12154, 'embedding_dim': 9, 'dropout_rate': 0.28, 'lr': 0.0028340904295147754, 'weight_decay': 7.411299781083247e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.028662143055936617
INFO:model_data_nn.py:Best trial testing loss: 0.0586925608587554
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-06_23-37-16_757829_871373/artifacts/2024-08-06_23-37-23/train_fnn_2024-08-06_23-37-23/driver_artifacts/train_fnn_81242_00011_11_dropout_rate=0.2800,embedding_dim=9,hidden_dim=65,lr=0.0028,num_layers=2,weight_decay=0.0001_2024-08-06_23-37-23
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 2, 'num_embeddings': 12714, 'embedding_dim': 9, 'dropout_rate': 0.28, 'lr': 0.0028340904295147754, 'weight_decay': 7.411299781083247e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.030853269919762966, 'avg_test_loss': 0.06832417319519501}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.030754012037763605, 'avg_test_loss': 0.06952717658465592}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.03076373737146122, 'avg_test_loss': 0.06818377178266022}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03076019568724701, 'avg_test_loss': 0.06890797505625496}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.030770621850024084, 'avg_test_loss': 0.06861586313857651}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03075378899014977, 'avg_test_loss': 0.06788108858352093}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.030767884451211838, 'avg_test_loss': 0.06838797899722224}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.030755683680537008, 'avg_test_loss': 0.06833217083430196}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.030782881787074244, 'avg_test_loss': 0.06846002376014386}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03077489066715181, 'avg_test_loss': 0.06891174317628264}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.030754296937018786, 'avg_test_loss': 0.06828488889067003}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.03076846277748847, 'avg_test_loss': 0.06810179644562378}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.030796829780607986, 'avg_test_loss': 0.06821835500967668}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.03078118560442711, 'avg_test_loss': 0.06826566787951331}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.030782759461545475, 'avg_test_loss': 0.06829141883575775}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.030797013808019552, 'avg_test_loss': 0.06814321731707862}
INFO:model_data_nn.py:Early stopping at epoch 16
INFO:main_restricted.py:Making prediction for data in year: 2000
INFO:main_restricted.py:Prediction data shape: (64295,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2000: 0.26106927375888794
INFO:main_restricted.py:Prediction Stats:                 ret          pred
count  64295.000000  64295.000000
mean      -0.001434      0.009964
std        0.261681      0.013806
min       -0.961538     -0.261429
25%       -0.124228      0.003697
50%       -0.013216      0.011947
75%        0.086957      0.018153
max       10.344000      0.725052
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:transform_data_nn.py:Train_data: (1028390, 161)

INFO:transform_data_nn.py:Test data years: [2001]
INFO:transform_data_nn.py:Test_data: (62104, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:transform_data_nn.py:Retrain_data: (1090494, 161)

INFO:transform_data_nn.py:Prediction data years: [2002]
INFO:transform_data_nn.py:Prediction_data: (59934, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([1028390, 138])
            y_train_tf: torch.Size([1028390])

            x_test_tf: torch.Size([62104, 138])
            y_test_tf: torch.Size([62104])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_retrain_tf: torch.Size([1090494, 138])
            y_retrain_tf: torch.Size([1090494])

            x_prediction_tf: torch.Size([59934, 138])
            y_prediction_tf: torch.Size([59934])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.5003e-01,  7.9058e-01,  8.1780e-02, -1.2347e+00, -1.6170e-01,
        -7.9695e-01, -1.6017e-01, -3.5635e-01,  4.6382e-01, -1.4839e-01,
        -6.8473e-01,  9.6144e-02, -5.1021e-01, -3.8909e-01,  1.2193e-01,
         4.8299e-01, -1.4612e-01,  2.4280e-01, -5.7477e-02,  5.0610e-01,
        -3.3304e-01,  4.0716e-03, -3.7353e-02, -3.4706e-03, -4.6997e-02,
        -2.7613e-01, -5.9417e-01, -3.1584e-02,  1.7564e-01,  1.3893e+00,
         3.6471e-01, -1.1564e-01,  5.0128e-01, -3.0722e-02, -2.8498e-01,
        -2.2596e-01,  4.5413e-02,  8.1149e-01, -5.1130e-02, -1.1384e+00,
        -2.9813e-01,  2.7513e-01,  2.5159e-01, -3.8434e-02, -1.9698e-01,
        -7.5245e-01,  9.0346e-02, -6.6200e-02, -4.0176e-01, -1.5585e-01,
        -7.9920e-01,  5.2479e-01, -4.8720e-02, -1.1011e-02, -2.8857e-02,
         4.1787e-01, -6.5838e-01,  8.2408e-02, -2.4810e-01, -4.1027e-02,
         1.2828e-01, -3.0477e-01,  1.2568e-01,  2.5317e-01,  9.2543e-02,
        -1.8401e-01,  4.4294e-01, -1.3756e-01,  6.5963e-01, -4.2033e-01,
        -3.0442e-01, -1.6989e-02, -2.0014e-02, -8.9778e-01,  1.8310e-01,
         6.7055e-01,  1.6905e-02, -3.8115e-01, -1.7439e-01,  1.1837e-02,
        -4.1039e-03,  1.7110e-01,  1.6247e-01, -2.7181e-01, -5.5922e-01,
        -1.4469e-01, -1.3347e-01, -2.7508e-01,  3.9311e-02,  1.9095e-01,
        -5.3083e-01, -1.2732e+00,  2.0767e-02,  1.5554e+00,  2.3470e+00,
         2.6177e+00, -8.0706e-02,  2.4073e+00, -2.9402e+00,  7.8232e-01,
        -3.7331e-01,  1.0774e-01, -6.3810e-02,  4.9231e-02,  2.1016e-01,
         1.8497e-01,  5.4038e-02,  2.6684e-01,  0.0000e+00, -1.4004e+00,
         8.6704e-01, -2.5540e+00,  1.6761e-01,  7.8416e-03, -3.5470e-01,
        -1.8634e-03,  1.7986e-01, -1.9652e-01, -7.2173e-02, -1.3031e-01,
         1.1697e-01, -3.4537e-01, -3.2558e-01,  3.0497e-01,  2.9960e-01,
        -4.1311e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([11822]), tensor(0.2117))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-7.8155e-01,  2.9863e-01, -2.6455e-01,  1.6144e+00, -1.3151e-01,
        -6.4774e-01, -1.6327e+00, -9.0350e-01, -2.7611e-01, -5.2427e-01,
        -7.4705e-01,  4.3307e-02, -1.8074e-02,  3.2187e-02, -4.9218e-01,
         6.2184e-01, -2.2092e-01,  9.8563e-02,  2.4917e-01,  3.1690e-01,
         5.4051e-01, -5.7433e-02, -4.0387e-02,  3.9809e-01,  1.8641e-02,
        -5.1085e-01, -6.4987e-01, -3.1584e-02, -8.8556e-01,  1.0707e+00,
         4.5311e-02, -1.2936e-01,  2.8789e-01, -2.1698e+00, -7.4284e-01,
        -1.7989e-01, -6.7393e-02, -5.4426e-01, -2.4384e-01, -1.1524e+00,
        -2.3032e-01,  1.1930e-01,  1.3787e-01, -1.0921e-01, -1.7468e-01,
        -7.1678e-01,  6.7817e-02,  1.5170e-01, -3.2939e-01,  4.5092e-01,
        -7.9920e-01, -7.1528e-01, -7.8128e-01, -5.4239e-01, -7.3400e-01,
         3.0674e-01, -1.0132e+00,  1.3695e-01, -3.5488e-01, -1.2432e-01,
         1.0936e-03, -3.8591e-01, -2.1444e-01,  4.4070e-01, -1.7470e-02,
        -3.9417e-01,  2.4717e-01,  3.5690e-01,  6.5963e-01, -4.2365e-01,
        -3.0442e-01, -1.6989e-02, -2.0014e-02, -6.5114e-01,  9.2238e-02,
         7.7743e-01,  3.3144e-03, -1.5722e-01, -8.7829e-02,  1.1837e-02,
         1.2291e-01,  3.2644e-01,  1.7267e-01, -2.8522e-02, -5.9734e-01,
        -1.3666e-01, -1.2899e-01, -3.5258e-01, -6.1016e-01, -1.3135e-01,
        -6.1622e-01, -4.1902e-03,  2.0767e-02, -1.7123e+00, -1.0682e+00,
        -1.0638e+00, -7.6175e-01, -1.7670e-01, -1.6409e+00, -4.3100e-01,
         6.8829e-01,  5.7639e-01, -6.3810e-02, -1.0282e-01,  2.1016e-01,
         8.5482e-01,  5.4667e-02,  1.3218e+00,  0.0000e+00,  3.6432e+00,
         2.9382e+00,  5.5339e-01,  1.2082e-01,  8.0602e+00, -3.5470e-01,
        -1.8634e-03, -1.2010e-01, -1.4793e-01, -3.4710e+00,  6.5598e-01,
        -9.0712e-01,  1.8469e-01, -3.8436e-01,  2.1459e-01,  2.8072e-01,
        -4.2464e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2592]), tensor(0.0128))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.1586,  0.8064,  0.0876, -1.2287, -0.1595, -0.8100, -0.1547, -0.3535,
         0.4353, -0.1385, -0.6847,  0.1083, -0.5059, -0.3799,  0.1162,  0.4810,
        -0.1436,  0.2410, -0.0440,  0.5166, -0.3344, -0.0096, -0.0348,  0.0031,
        -0.0449, -0.2766, -0.5865, -0.0457,  0.1597,  1.3691,  0.3576, -0.1138,
         0.4955, -0.0151, -0.2735, -0.2270,  0.0408,  0.8313, -0.0544, -1.1414,
        -0.2990,  0.3093,  0.2607, -0.0450, -0.1960, -0.7588,  0.1068, -0.0657,
        -0.3888, -0.1417, -0.8087,  0.5109, -0.0388, -0.0117, -0.0264,  0.4191,
        -0.6486,  0.0795, -0.2451, -0.0521,  0.1310, -0.3016,  0.1264,  0.2429,
         0.0861, -0.1877,  0.4527, -0.1369,  0.6642, -0.4217, -0.3116, -0.0191,
        -0.0254, -0.9051,  0.1966,  0.6720,  0.0159, -0.3841, -0.1737,  0.0086,
         0.0038,  0.1575,  0.1564, -0.2541, -0.5610, -0.1486, -0.1379, -0.2741,
         0.0496,  0.1912, -0.5340, -1.2737,  0.0210,  1.5867,  2.3335,  2.6672,
        -0.0535,  2.4516, -2.9617,  0.8248, -0.4047,  0.1143, -0.0776,  0.0298,
         0.2141,  0.1960,  0.0672,  0.2640,  0.0000, -1.2144,  0.6173, -2.6076,
         0.1731, -0.0393,  0.2582, -0.0191,  0.1997, -0.1961, -0.0766, -0.1415,
         0.1249, -0.3337, -0.3158,  0.3138,  0.3040, -0.4072,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([12410]), tensor(0.2117))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-4.4271e-01, -2.8657e-01, -5.4112e-01,  1.7223e+00,  1.2791e-01,
        -7.2758e-01, -1.6145e+00, -8.8335e-01, -3.5326e-01, -4.7428e-01,
        -7.4585e-01,  5.6984e-02, -1.8806e-02,  6.3419e-01,  3.0459e-01,
         2.5086e+00, -8.7727e-02,  1.9522e-01,  1.9799e-01,  1.5400e+00,
        -4.5036e-01, -5.6030e-02, -3.0106e-02,  3.9506e-02, -4.3974e-02,
        -5.0832e-01, -6.4088e-01, -4.5684e-02, -6.5200e-01,  8.5437e-01,
        -2.6626e-01, -1.1076e-01,  3.2285e-01, -2.1166e+00, -7.6734e-01,
        -3.5201e-01, -4.6172e-01, -5.5369e-01, -1.6259e-01, -1.0099e+00,
        -2.3403e-01, -6.5267e-01,  5.0908e-01, -8.6439e-02,  2.3468e-02,
        -8.0030e-01,  1.6257e-01, -2.0365e-02, -2.2480e-01, -1.8963e-01,
        -1.8954e-02, -6.3108e-01, -7.0994e-01, -5.3802e-01, -2.6445e-02,
         3.3073e-01, -1.0056e+00, -3.8869e-03, -1.3339e-01, -2.8006e-01,
        -3.0459e-01, -3.5814e-01, -1.1735e+00,  1.0976e+00, -1.6674e-02,
        -6.9679e-01, -1.5458e-01,  1.0886e+00,  1.3371e+00, -4.5529e-01,
        -3.1160e-01, -1.9145e-02, -2.5361e-02, -7.9685e-01,  9.8504e-02,
         7.3055e-02, -1.9542e-04, -2.7171e-01,  1.2449e-01,  8.5546e-03,
         1.3094e-01,  8.5354e-01,  4.1512e-01, -9.4846e-02, -5.5554e-01,
        -1.3874e-01, -1.3308e-01, -3.5146e-01, -7.9408e-01,  4.8027e-01,
        -5.4107e-01, -1.2737e+00,  2.0963e-02, -1.3357e+00, -2.3685e+00,
        -1.0774e+00,  1.0671e-01, -1.7903e+00,  1.5713e+00,  7.2729e-01,
        -1.0746e-01,  2.6270e-01, -7.7583e-02,  3.6254e+00,  2.1410e-01,
         1.5701e+00,  5.2948e-02,  3.5263e-01,  0.0000e+00,  7.1195e-01,
         1.9486e+00, -2.4186e-01,  1.1852e-01,  1.3833e+01,  2.5821e-01,
        -1.9104e-02,  6.3610e-02, -2.0462e-01, -3.3141e+00,  6.0176e-01,
         5.7319e-01,  6.3205e-01, -3.2629e-01,  2.4644e-01,  3.5078e-01,
        -3.9848e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2328]), tensor(-0.0131))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:main_restricted.py:Testing data year: 2001
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 13269
            device: cpu
            
2024-08-07 02:33:06,294	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-07 02:33:06,346	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-07 02:33:06,397	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_aa2eb759f0569a14.zip' (5.14MiB) to Ray cluster...
2024-08-07 02:33:06,412	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_aa2eb759f0569a14.zip'.
2024-08-07 02:33:09,846	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-07 03:11:30,988	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-07_02-33-09' in 0.2610s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 13269, 'embedding_dim': 1, 'dropout_rate': 0.05, 'lr': 8.331842907625309e-06, 'weight_decay': 3.144706654325597e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03282958030504079
INFO:model_data_nn.py:Best trial testing loss: 0.07239712428477872
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-07_02-33-03_817195_871373/artifacts/2024-08-07_02-33-09/train_fnn_2024-08-07_02-33-09/driver_artifacts/train_fnn_0f35a_00036_36_dropout_rate=0.0500,embedding_dim=1,hidden_dim=5,lr=0.0000,num_layers=4,weight_decay=0.0000_2024-08-07_02-33-10
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 13927, 'embedding_dim': 1, 'dropout_rate': 0.05, 'lr': 8.331842907625309e-06, 'weight_decay': 3.144706654325597e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.0358852686276081, 'avg_test_loss': 0.046921497320077186}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.03576137680677982, 'avg_test_loss': 0.04695312818810185}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.035752271302263036, 'avg_test_loss': 0.046927060679729175}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03574555781456188, 'avg_test_loss': 0.046926995111839856}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03573827070201216, 'avg_test_loss': 0.04692208476420214}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03572172761726077, 'avg_test_loss': 0.046912118973238257}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03570531077870133, 'avg_test_loss': 0.04691462520398756}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03568044188856022, 'avg_test_loss': 0.046942043896597715}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.035659938349586084, 'avg_test_loss': 0.046934470927505606}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03563446422046406, 'avg_test_loss': 0.04698332920988231}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03560241138806788, 'avg_test_loss': 0.046991593198481396}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.03557332478844531, 'avg_test_loss': 0.04699567068955982}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.035544225739994925, 'avg_test_loss': 0.046952391847539174}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.035517898253302385, 'avg_test_loss': 0.046842861952367365}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.035497413551554474, 'avg_test_loss': 0.04699512870549393}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.03545673322286761, 'avg_test_loss': 0.04720000252485085}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.035432276955089326, 'avg_test_loss': 0.047082295019759426}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.035407200751165636, 'avg_test_loss': 0.04727078533407722}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.03538034845376196, 'avg_test_loss': 0.04742725388502388}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.035352688951128974, 'avg_test_loss': 0.047181365213223865}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.03533577349094655, 'avg_test_loss': 0.047536234639442045}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.035304311402505, 'avg_test_loss': 0.04756344545648487}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.03529116288315072, 'avg_test_loss': 0.04764224998335213}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.035266596763147154, 'avg_test_loss': 0.04757413040520921}
INFO:model_data_nn.py:Early stopping at epoch 24
INFO:main_restricted.py:Making prediction for data in year: 2002
INFO:main_restricted.py:Prediction data shape: (59934,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2002: 0.21817504255957418
INFO:main_restricted.py:Prediction Stats:                 ret          pred
count  59934.000000  59934.000000
mean      -0.008055      0.031431
std        0.215604      0.036954
min       -0.943662     -0.012168
25%       -0.103582      0.010786
50%       -0.010669      0.014459
75%        0.066667      0.039496
max        5.640000      0.310954
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:transform_data_nn.py:Train_data: (1150428, 161)

INFO:transform_data_nn.py:Test data years: [2003]
INFO:transform_data_nn.py:Test_data: (55419, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:transform_data_nn.py:Retrain_data: (1205847, 161)

INFO:transform_data_nn.py:Prediction data years: [2004]
INFO:transform_data_nn.py:Prediction_data: (52500, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main_restricted.py:
            x_train_tf: torch.Size([1150428, 138])
            y_train_tf: torch.Size([1150428])

            x_test_tf: torch.Size([55419, 138])
            y_test_tf: torch.Size([55419])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([1205847, 138])
            y_retrain_tf: torch.Size([1205847])

            x_prediction_tf: torch.Size([52500, 138])
            y_prediction_tf: torch.Size([52500])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.7116e-01,  8.2591e-01,  8.9769e-02, -1.2241e+00, -1.4464e-01,
        -8.2049e-01, -1.4991e-01, -3.5151e-01,  4.2190e-01, -1.3743e-01,
        -6.8725e-01,  1.2156e-01, -5.0705e-01, -3.6798e-01,  1.0485e-01,
         4.8707e-01, -1.4148e-01,  2.3734e-01, -4.6621e-02,  5.3575e-01,
        -3.2435e-01, -9.3329e-03, -1.9246e-02,  8.4216e-03, -3.7868e-02,
        -2.7713e-01, -5.8501e-01, -4.9842e-02,  1.4605e-01,  1.3202e+00,
         3.5273e-01, -1.0498e-01,  4.9351e-01, -2.0463e-03, -2.6066e-01,
        -2.2402e-01,  5.4795e-02,  8.4688e-01, -4.7742e-02, -1.1462e+00,
        -2.9924e-01,  3.2817e-01,  2.8007e-01, -4.9046e-02, -1.8754e-01,
        -7.6304e-01,  1.1420e-01, -6.1253e-02, -3.7545e-01, -1.3122e-01,
        -8.2010e-01,  4.9866e-01, -3.2872e-02, -1.1337e-02, -2.8201e-02,
         4.2178e-01, -6.3963e-01,  7.2807e-02, -2.4308e-01, -5.8345e-02,
         1.3098e-01, -3.0099e-01,  1.2807e-01,  2.3673e-01,  8.9501e-02,
        -1.9047e-01,  4.6496e-01, -1.3852e-01,  6.6373e-01, -4.2363e-01,
        -3.1924e-01, -2.1984e-02, -2.8254e-02, -9.1110e-01,  2.1188e-01,
         6.8313e-01,  1.9191e-02, -3.8730e-01, -1.7354e-01,  1.2541e-02,
         3.0178e-03,  1.6863e-01,  1.5687e-01, -2.3267e-01, -5.6024e-01,
        -1.5245e-01, -1.4272e-01, -2.7571e-01,  5.5402e-02,  1.8981e-01,
        -5.3707e-01, -1.2746e+00,  1.8266e-02,  1.6373e+00,  2.2893e+00,
         2.7389e+00, -8.0259e-02,  2.4169e+00, -2.9631e+00,  7.9023e-01,
        -4.3805e-01,  1.3119e-01, -8.0883e-02,  1.8536e-02,  2.1539e-01,
         1.7498e-01,  6.1703e-02,  3.1424e-01,  0.0000e+00, -1.1888e+00,
         5.9158e-01, -2.6573e+00,  1.7831e-01,  1.7976e-03,  2.0100e-01,
        -4.3975e-02,  2.2156e-01, -1.9400e-01, -3.7220e-02, -1.5561e-01,
         1.3058e-01, -3.2229e-01, -3.0179e-01,  3.2513e-01,  3.0975e-01,
        -4.0562e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([12555]), tensor(0.2117))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-2.3912e-02, -5.8418e-01,  2.6615e-01,  1.8227e+00, -7.9206e-01,
        -5.7132e-01, -1.5597e+00, -8.6613e-01,  1.3448e-02, -4.0320e-01,
        -7.3818e-01,  4.7034e-02, -3.8436e+00,  1.1724e+00,  4.2549e-01,
        -1.9630e+00, -1.8135e-01, -3.7993e-01, -4.6621e-02, -1.6919e+00,
        -1.4811e-01, -5.3354e-02, -2.6453e-02, -5.3272e-01,  6.4118e-02,
        -5.3700e-01, -6.4345e-01, -4.9842e-02, -9.5630e-01,  1.6872e+00,
        -5.0354e-01, -2.1994e-01,  2.2919e-01, -2.0463e-03, -7.7073e-01,
        -2.8178e-01, -1.0711e-01, -6.7097e-01, -4.4602e-01, -1.0738e+00,
        -2.4302e-01, -9.7469e-01, -4.7558e-01, -1.4572e-02, -6.5785e-01,
        -7.3570e-01, -6.3836e-01, -7.4691e-01,  1.8460e-01, -4.9137e-01,
         7.6610e-01, -8.5028e-01, -5.3733e-01, -5.3597e-01, -7.3272e-01,
         1.9813e-01, -9.9838e-01,  2.1446e-01, -3.4673e-01, -3.3022e-01,
         1.3082e-02, -3.8348e-01,  4.2007e-01,  2.2035e-01, -1.4582e-02,
         3.2187e-01, -1.3924e+00,  9.4919e-01, -8.5109e-03, -4.8587e-01,
        -3.1924e-01, -2.1984e-02, -2.8254e-02, -6.3183e-01,  1.0355e-01,
        -1.2528e+00,  2.1320e+00, -2.0209e-01,  1.8162e-01,  1.2541e-02,
         3.0178e-03, -8.5876e-01,  6.3903e-01,  7.2192e-02, -4.7227e-01,
        -1.4130e-01, -1.3768e-01, -3.4183e-01, -3.7515e-01,  1.5278e+00,
        -4.8235e-01,  1.1426e+00,  1.8266e-02, -6.5426e-01, -1.2414e+00,
        -3.8822e-01,  7.6086e-01, -1.8048e+00,  1.1585e+00,  5.9327e-01,
         4.2696e-02, -1.7440e+00, -8.0883e-02,  1.7935e+00,  2.1539e-01,
         2.4999e+00,  1.3570e-02,  3.1424e-01,  0.0000e+00, -1.4868e+00,
        -7.2428e-01, -4.2164e-01,  1.2112e-01,  9.5453e+00,  2.0100e-01,
        -4.3975e-02, -9.9337e-02, -2.6256e-01, -3.2969e+00,  7.2596e-01,
         2.9793e-01,  5.6518e-01, -3.6796e-01,  1.5587e-01,  1.5892e-01,
        -3.7067e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2183]), tensor(0.1481))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-0.1753,  0.8439,  0.0867, -1.2221, -0.1328, -0.8232, -0.1465, -0.3496,
         0.4204, -0.1375, -0.6908,  0.1272, -0.5098, -0.3726,  0.1052,  0.4888,
        -0.1389,  0.2331, -0.0478,  0.5492, -0.3443, -0.0067, -0.0063,  0.0070,
        -0.0316, -0.2768, -0.5875, -0.0547,  0.1296,  1.3271,  0.3483, -0.0982,
         0.4962,  0.0109, -0.2525, -0.2154,  0.0773,  0.8623, -0.0372, -1.1511,
        -0.2970,  0.3194,  0.2974, -0.0499, -0.1808, -0.7614,  0.1143, -0.0696,
        -0.3653, -0.1449, -0.8306,  0.4838, -0.0284, -0.0118, -0.0295,  0.4222,
        -0.6315,  0.0657, -0.2425, -0.0523,  0.1291, -0.3008,  0.1307,  0.2347,
         0.0898, -0.1910,  0.4765, -0.1394,  0.6524, -0.4250, -0.3258, -0.0241,
        -0.0301, -0.9095,  0.2190,  0.6918,  0.0230, -0.3900, -0.1737,  0.0151,
        -0.0062,  0.1789,  0.1615, -0.2088, -0.5597, -0.1549, -0.1460, -0.2768,
         0.0611,  0.1879, -0.5417, -1.2757,  0.0165,  1.6888,  2.3405,  2.8106,
        -0.0858,  2.3790, -2.9726,  0.7926, -0.4489,  0.1438,  0.4357,  0.0452,
         0.5575,  0.1573,  0.0500,  0.2120,  0.0000, -1.0689,  0.6337, -2.6821,
         0.1799,  0.0048,  0.1828, -0.0406,  0.2423, -0.1914, -0.0647, -0.1598,
         0.1314, -0.3116, -0.2920,  0.3313,  0.3122, -0.4080,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([12693]), tensor(0.2117))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.2936e-01, -3.2354e-01, -5.4633e-01,  1.9132e+00, -6.0531e-04,
        -4.1457e-01, -1.4304e+00, -8.5136e-01,  2.3520e-01,  3.1459e-01,
        -3.9811e-01,  5.1732e-02, -8.8107e-02,  8.9970e-01,  3.6307e-01,
        -2.8172e-01, -2.1926e-01,  2.1350e-01, -4.7779e-02, -1.1668e-01,
         2.8434e-01, -5.4769e-02, -6.0819e-04,  3.0307e-01, -7.7617e-03,
        -5.4888e-01, -6.3310e-01, -5.4709e-02, -9.9213e-01,  1.6441e+00,
         5.8696e-02, -2.3628e-01,  1.8150e-01,  1.0890e-02, -8.5428e-01,
        -2.5411e-01, -1.5820e-01, -6.7610e-01, -2.9616e-01, -6.4421e-01,
        -2.4797e-01,  6.5678e-01,  8.8970e-02,  2.4571e-01, -3.0490e-02,
        -6.7759e-01, -5.2205e-01, -9.1243e-02, -5.2986e-01, -1.6908e-01,
         7.6003e-01, -9.6388e-01, -6.9590e-01, -5.3523e-01, -2.9458e-02,
         1.0544e-01, -9.9226e-01,  1.4390e-02, -2.3924e-01,  2.8336e-02,
         1.1181e-01, -7.2856e-02, -5.4846e-02, -5.3577e-02, -1.7329e-02,
        -3.4757e-01, -2.5320e+00,  5.9189e-01,  1.3237e+00, -4.7865e-01,
        -3.2580e-01, -2.4051e-02, -3.0081e-02, -7.0693e-01,  7.1596e-02,
         5.2629e-01, -1.4765e-01, -2.5753e-01,  5.6461e-02,  1.5098e-02,
        -6.1875e-03, -5.1219e-01,  6.8059e-01, -1.6487e-01, -8.7337e-02,
        -1.3890e-01, -1.3914e-01,  2.8332e-01, -3.4090e-01, -3.1705e+00,
        -2.2172e-01, -2.4002e-01,  1.6535e-02, -9.6717e-01, -4.0192e-01,
        -6.8940e-01, -2.8601e-01, -1.7415e+00,  1.4858e+00, -6.1973e-02,
        -3.5294e-01, -1.3030e-01, -3.1220e+00,  1.0108e-01,  2.1820e+00,
         1.7184e+00,  5.6388e-02,  2.1205e-01,  1.4270e+00, -1.7971e+00,
        -1.0456e+00,  1.1128e-01,  1.1716e-01,  7.1392e+00,  1.8278e-01,
        -4.0582e-02, -2.6079e-01, -1.3555e-01, -3.2903e+00,  7.9523e-01,
        -4.1853e-01,  3.0141e-02, -4.7988e-01,  1.1897e-01,  1.0567e-01,
        -3.5705e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3648]), tensor(0.0101))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:main_restricted.py:Testing data year: 2003
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 14098
            device: cpu
            
2024-08-07 05:36:51,092	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-07 05:36:51,144	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-07 05:36:51,194	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_aa2eb759f0569a14.zip' (5.14MiB) to Ray cluster...
2024-08-07 05:36:51,207	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_aa2eb759f0569a14.zip'.
2024-08-07 05:36:55,213	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-07 06:10:06,781	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-07_05-36-55' in 0.2770s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 165, 'num_layers': 1, 'num_embeddings': 14098, 'embedding_dim': 5, 'dropout_rate': 0.06, 'lr': 3.02436916127265e-05, 'weight_decay': 1.1126788925493306e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03483731816731592
INFO:model_data_nn.py:Best trial testing loss: 0.03589729343779712
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-07_05-36-48_547771_871373/artifacts/2024-08-07_05-36-55/train_fnn_2024-08-07_05-36-55/driver_artifacts/train_fnn_bad74_00037_37_dropout_rate=0.0600,embedding_dim=5,hidden_dim=165,lr=0.0000,num_layers=1,weight_decay=0.0000_2024-08-07_05-36-55
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 165, 'num_layers': 1, 'num_embeddings': 14254, 'embedding_dim': 5, 'dropout_rate': 0.06, 'lr': 3.02436916127265e-05, 'weight_decay': 1.1126788925493306e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.036291153655108654, 'avg_test_loss': 0.02300336489730363}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.035546796943007664, 'avg_test_loss': 0.022906373589188584}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.03534574462812702, 'avg_test_loss': 0.023008073233702468}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.035196753524069826, 'avg_test_loss': 0.023363909481315354}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.035045831178704516, 'avg_test_loss': 0.02319021676859644}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03492021640602523, 'avg_test_loss': 0.023488582468788773}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03476623634643647, 'avg_test_loss': 0.023616464986463605}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.034646041709494695, 'avg_test_loss': 0.02395745645528727}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.034533041217532444, 'avg_test_loss': 0.02382945062687797}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03442913931576958, 'avg_test_loss': 0.024076040120401085}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03432683953876961, 'avg_test_loss': 0.024750106227006356}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.03424828632066378, 'avg_test_loss': 0.02448275394583633}
INFO:model_data_nn.py:Early stopping at epoch 12
INFO:main_restricted.py:Making prediction for data in year: 2004
INFO:main_restricted.py:Prediction data shape: (52500,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2004: 0.1562631185052865
INFO:main_restricted.py:Prediction Stats:                 ret          pred
count  52500.000000  52500.000000
mean       0.017988      0.032233
std        0.151285      0.049476
min       -0.918750     -0.273118
25%       -0.046307      0.000450
50%        0.009646      0.029345
75%        0.068970      0.060481
max        6.908072      0.753002
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:transform_data_nn.py:Train_data: (1205847, 161)

INFO:transform_data_nn.py:Test data years: [2004]
INFO:transform_data_nn.py:Test_data: (52500, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]
INFO:transform_data_nn.py:Retrain_data: (1258347, 161)

INFO:transform_data_nn.py:Prediction data years: [2005]
INFO:transform_data_nn.py:Prediction_data: (50879, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([1205847, 138])
            y_train_tf: torch.Size([1205847])

            x_test_tf: torch.Size([52500, 138])
            y_test_tf: torch.Size([52500])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([1258347, 138])
            y_retrain_tf: torch.Size([1258347])

            x_prediction_tf: torch.Size([50879, 138])
            y_prediction_tf: torch.Size([50879])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-0.1753,  0.8439,  0.0867, -1.2221, -0.1328, -0.8232, -0.1465, -0.3496,
         0.4204, -0.1375, -0.6908,  0.1272, -0.5098, -0.3726,  0.1052,  0.4888,
        -0.1389,  0.2331, -0.0478,  0.5492, -0.3443, -0.0067, -0.0063,  0.0070,
        -0.0316, -0.2768, -0.5875, -0.0547,  0.1296,  1.3271,  0.3483, -0.0982,
         0.4962,  0.0109, -0.2525, -0.2154,  0.0773,  0.8623, -0.0372, -1.1511,
        -0.2970,  0.3194,  0.2974, -0.0499, -0.1808, -0.7614,  0.1143, -0.0696,
        -0.3653, -0.1449, -0.8306,  0.4838, -0.0284, -0.0118, -0.0295,  0.4222,
        -0.6315,  0.0657, -0.2425, -0.0523,  0.1291, -0.3008,  0.1307,  0.2347,
         0.0898, -0.1910,  0.4765, -0.1394,  0.6524, -0.4250, -0.3258, -0.0241,
        -0.0301, -0.9095,  0.2190,  0.6918,  0.0230, -0.3900, -0.1737,  0.0151,
        -0.0062,  0.1789,  0.1615, -0.2088, -0.5597, -0.1549, -0.1460, -0.2768,
         0.0611,  0.1879, -0.5417, -1.2757,  0.0165,  1.6888,  2.3405,  2.8106,
        -0.0858,  2.3790, -2.9726,  0.7926, -0.4489,  0.1438,  0.4357,  0.0452,
         0.5575,  0.1573,  0.0500,  0.2120,  0.0000, -1.0689,  0.6337, -2.6821,
         0.1799,  0.0048,  0.1828, -0.0406,  0.2423, -0.1914, -0.0647, -0.1598,
         0.1314, -0.3116, -0.2920,  0.3313,  0.3122, -0.4080,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000]), tensor([12693]), tensor(0.2117))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-3.2936e-01, -3.2354e-01, -5.4633e-01,  1.9132e+00, -6.0531e-04,
        -4.1457e-01, -1.4304e+00, -8.5136e-01,  2.3520e-01,  3.1459e-01,
        -3.9811e-01,  5.1732e-02, -8.8107e-02,  8.9970e-01,  3.6307e-01,
        -2.8172e-01, -2.1926e-01,  2.1350e-01, -4.7779e-02, -1.1668e-01,
         2.8434e-01, -5.4769e-02, -6.0819e-04,  3.0307e-01, -7.7617e-03,
        -5.4888e-01, -6.3310e-01, -5.4709e-02, -9.9213e-01,  1.6441e+00,
         5.8696e-02, -2.3628e-01,  1.8150e-01,  1.0890e-02, -8.5428e-01,
        -2.5411e-01, -1.5820e-01, -6.7610e-01, -2.9616e-01, -6.4421e-01,
        -2.4797e-01,  6.5678e-01,  8.8970e-02,  2.4571e-01, -3.0490e-02,
        -6.7759e-01, -5.2205e-01, -9.1243e-02, -5.2986e-01, -1.6908e-01,
         7.6003e-01, -9.6388e-01, -6.9590e-01, -5.3523e-01, -2.9458e-02,
         1.0544e-01, -9.9226e-01,  1.4390e-02, -2.3924e-01,  2.8336e-02,
         1.1181e-01, -7.2856e-02, -5.4846e-02, -5.3577e-02, -1.7329e-02,
        -3.4757e-01, -2.5320e+00,  5.9189e-01,  1.3237e+00, -4.7865e-01,
        -3.2580e-01, -2.4051e-02, -3.0081e-02, -7.0693e-01,  7.1596e-02,
         5.2629e-01, -1.4765e-01, -2.5753e-01,  5.6461e-02,  1.5098e-02,
        -6.1875e-03, -5.1219e-01,  6.8059e-01, -1.6487e-01, -8.7337e-02,
        -1.3890e-01, -1.3914e-01,  2.8332e-01, -3.4090e-01, -3.1705e+00,
        -2.2172e-01, -2.4002e-01,  1.6535e-02, -9.6717e-01, -4.0192e-01,
        -6.8940e-01, -2.8601e-01, -1.7415e+00,  1.4858e+00, -6.1973e-02,
        -3.5294e-01, -1.3030e-01, -3.1220e+00,  1.0108e-01,  2.1820e+00,
         1.7184e+00,  5.6388e-02,  2.1205e-01,  1.4270e+00, -1.7971e+00,
        -1.0456e+00,  1.1128e-01,  1.1716e-01,  7.1392e+00,  1.8278e-01,
        -4.0582e-02, -2.6079e-01, -1.3555e-01, -3.2903e+00,  7.9523e-01,
        -4.1853e-01,  3.0141e-02, -4.7988e-01,  1.1897e-01,  1.0567e-01,
        -3.5705e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3648]), tensor(0.0101))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.7118e-01,  8.5868e-01,  8.8566e-02, -1.5388e+00, -1.3117e-01,
        -8.2291e-01, -1.4596e-01, -3.4926e-01,  4.3716e-01, -1.7202e-01,
        -6.9485e-01,  8.8289e-02, -7.0847e-01, -4.7390e-01,  8.9443e-02,
         4.9313e-01, -1.3942e-01,  2.1304e-01, -8.4367e-02,  5.5897e-01,
        -3.9582e-01, -4.3030e-02, -1.4308e-01,  4.1671e-03, -7.9695e-02,
        -3.3579e-01, -5.8883e-01, -5.5108e-02,  4.7181e-01,  1.4085e+00,
         3.5091e-01, -1.3127e-01,  7.5088e-01,  2.7912e-01, -2.4717e-01,
        -2.4284e-01,  9.4743e-02,  8.7583e-01, -2.9307e-02, -1.1505e+00,
        -2.9232e-01,  2.5186e-01,  3.1120e-01,  4.6181e-02, -1.7703e-01,
        -7.5647e-01,  8.8821e-02, -7.1044e-02, -3.6089e-01, -1.5067e-01,
        -8.3754e-01,  4.6113e-01, -4.7766e-01,  8.9538e-02, -3.2225e-02,
         4.9715e-01, -6.2360e-01, -1.7517e-01, -2.4635e-01, -4.8498e-02,
         9.5382e-03, -3.0470e-01,  5.9635e-02,  2.2723e-01,  7.4789e-02,
        -1.9747e-01,  6.8953e-01, -2.6385e-01,  6.4149e-01, -5.6310e-01,
        -3.2999e-01, -1.6304e-01, -3.0124e-02, -9.0452e-01,  1.7914e-01,
         7.0433e-01,  8.2017e-01, -1.1292e+00,  2.8310e-01,  1.7434e-02,
        -8.0780e-01,  1.8336e-01,  3.2381e-01, -1.8027e-01, -5.5950e-01,
        -4.2899e-01, -5.2643e-01, -2.7535e-01,  6.5333e-02,  1.2012e-01,
        -5.4874e-01, -1.3395e+00,  2.2352e-01, -1.2212e-15, -1.2212e-15,
         2.8768e+00, -8.6174e-02,  2.3731e+00, -2.9939e+00,  8.2695e-01,
        -4.4387e-01,  1.5121e-01,  1.4902e-01,  5.1638e-02,  3.2754e-01,
         1.5920e-01, -1.1663e-01,  2.1836e-01, -4.0870e-01, -1.0226e+00,
         6.7248e-01,  0.0000e+00,  3.4785e-01,  6.1027e-03,  1.5095e-01,
        -1.4524e-02,  2.6119e-01, -2.3570e-01,  1.9133e-02, -5.5246e-01,
         1.2929e-01, -3.0036e-01, -3.9254e-01,  3.4894e-01,  3.7255e-01,
        -4.0992e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([12817]), tensor(0.2117))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-2.9575e-01,  7.5992e-01, -6.9763e-01,  1.3736e+00, -4.7082e-01,
        -1.9137e-01, -1.3387e+00, -8.3885e-01, -1.0608e-01,  4.1549e-02,
        -6.1054e-01, -2.2612e-01, -7.0847e-01, -1.3475e+00, -1.6805e+00,
        -9.6217e-01, -2.2287e-01, -5.3969e-01, -8.4367e-02,  8.7016e-01,
        -1.9377e-01, -1.1485e-01, -1.3815e-01, -7.0141e-01, -1.3445e-01,
        -7.3153e-01, -6.3885e-01, -5.5108e-02, -9.6655e-01, -4.9648e-01,
        -4.0629e-02, -4.8002e-01, -1.9631e-01,  2.7912e-01, -9.1284e-01,
        -6.2998e-01, -4.2541e-01, -6.9317e-01, -6.3625e-01, -5.6744e-01,
        -2.3498e-01,  1.3396e-01, -4.8989e-02,  3.3717e-01, -3.5330e-01,
         2.2912e-01, -2.4069e-01,  9.7884e-01, -8.3168e-01, -4.6010e-01,
        -1.6338e+00, -9.0996e-01, -4.7766e-01, -6.7559e-01, -7.3432e-01,
        -3.4541e-01, -9.8688e-01, -4.9924e-01,  1.5879e-01, -3.0380e-01,
        -6.5167e-02, -3.7344e-01, -1.6896e+00,  2.4800e-01, -3.7743e-02,
        -8.0434e-01,  1.8065e+00,  9.9232e-01, -2.0433e+00, -6.8280e-01,
        -3.2999e-01, -1.6304e-01, -3.0124e-02, -1.8661e-01, -1.8362e-01,
        -2.9208e-01,  8.2017e-01, -4.3453e-01,  1.4889e+00,  1.7434e-02,
        -8.0780e-01, -5.8614e-01,  6.5976e-01,  1.0894e+00,  1.7405e-01,
        -3.0383e-01, -4.2754e-01, -1.3450e-01, -4.1190e-01,  5.6320e-01,
        -2.5824e-01, -1.0285e+00,  2.2352e-01, -1.2212e-15, -1.2212e-15,
        -4.6121e-01,  5.6279e-02, -1.1615e+00,  2.9942e-01, -8.0517e-01,
        -3.8434e-01,  2.6993e-01,  1.4902e-01, -2.3841e-01,  3.2754e-01,
         9.2274e-01, -2.1288e-01,  2.1836e-01,  1.9116e+00, -5.1760e-01,
        -7.3498e-01,  0.0000e+00, -6.4815e-02,  5.1628e+00,  1.5095e-01,
        -1.4524e-02, -1.1131e-01, -2.1950e-01,  1.9133e-02,  1.0239e+00,
        -1.1874e+00,  6.4891e-03, -7.3250e-01, -7.6827e-03, -3.3562e-01,
        -3.1238e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3572]), tensor(-0.0406))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:main_restricted.py:Testing data year: 2004
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 14254
            device: cpu
            
2024-08-07 08:32:17,764	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-07 08:32:17,828	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-07 08:32:17,885	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_aa2eb759f0569a14.zip' (5.14MiB) to Ray cluster...
2024-08-07 08:32:17,900	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_aa2eb759f0569a14.zip'.
2024-08-07 08:32:21,894	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-07 09:31:19,988	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-07_08-32-21' in 0.2620s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 3, 'num_embeddings': 14254, 'embedding_dim': 2, 'dropout_rate': 0.25, 'lr': 3.791105473537746e-05, 'weight_decay': 0.0003409097499797901, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.035345859722493336
INFO:model_data_nn.py:Best trial testing loss: 0.02277766249240025
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-07_08-32-15_039252_871373/artifacts/2024-08-07_08-32-21/train_fnn_2024-08-07_08-32-21/driver_artifacts/train_fnn_3d3b4_00039_39_dropout_rate=0.2500,embedding_dim=2,hidden_dim=5,lr=0.0000,num_layers=3,weight_decay=0.0003_2024-08-07_08-32-22
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 5, 'num_layers': 3, 'num_embeddings': 14395, 'embedding_dim': 2, 'dropout_rate': 0.25, 'lr': 3.791105473537746e-05, 'weight_decay': 0.0003409097499797901, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.035828362411268945, 'avg_test_loss': 0.01755405634515287}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.03565207157901745, 'avg_test_loss': 0.01758300189757205}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.035522673700937084, 'avg_test_loss': 0.017552702836271132}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03544302385760848, 'avg_test_loss': 0.017557335703928565}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.035372827822931815, 'avg_test_loss': 0.017521759691699664}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03533098760723219, 'avg_test_loss': 0.01752637470393774}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03527699862706304, 'avg_test_loss': 0.017526060076027958}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.035239944563437695, 'avg_test_loss': 0.017500507750609264}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03520335380531779, 'avg_test_loss': 0.01749011141425888}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03517280851565643, 'avg_test_loss': 0.01745993284223105}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03514544124168364, 'avg_test_loss': 0.017494121078523484}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.035108285186677746, 'avg_test_loss': 0.01748236804503255}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.0350843412778885, 'avg_test_loss': 0.01743720777112822}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.035058835578091356, 'avg_test_loss': 0.01754864169888423}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.035051988675386954, 'avg_test_loss': 0.017513129021270415}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.035024709820970966, 'avg_test_loss': 0.01747939283327766}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.03504432097393811, 'avg_test_loss': 0.01748089540993149}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.03502707638335343, 'avg_test_loss': 0.017546508183946187}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.03503200800716119, 'avg_test_loss': 0.017504916488937098}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.03502392730934286, 'avg_test_loss': 0.017509560216564555}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.03501997423421739, 'avg_test_loss': 0.017535227017439713}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.035014850117781576, 'avg_test_loss': 0.017501217048690097}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.035005361877196106, 'avg_test_loss': 0.017569804306717673}
INFO:model_data_nn.py:Early stopping at epoch 23
INFO:main_restricted.py:Making prediction for data in year: 2005
INFO:main_restricted.py:Prediction data shape: (50879,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2005: 0.13259705773068925
INFO:main_restricted.py:Prediction Stats:                 ret          pred
count  50879.000000  50879.000000
mean       0.004015      0.012225
std        0.132264      0.015264
min       -0.820889     -0.075507
25%       -0.055669      0.003383
50%        0.000000      0.017361
75%        0.055960      0.020025
max        3.303279      0.245741
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:transform_data_nn.py:Train_data: (1502283, 161)

INFO:transform_data_nn.py:Test data years: [2010]
INFO:transform_data_nn.py:Test_data: (44043, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:transform_data_nn.py:Retrain_data: (1546326, 161)

INFO:transform_data_nn.py:Prediction data years: [2011]
INFO:transform_data_nn.py:Prediction_data: (42205, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([1502283, 138])
            y_train_tf: torch.Size([1502283])

            x_test_tf: torch.Size([44043, 138])
            y_test_tf: torch.Size([44043])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([1546326, 138])
            y_retrain_tf: torch.Size([1546326])

            x_prediction_tf: torch.Size([42205, 138])
            y_prediction_tf: torch.Size([42205])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.3918e-01,  9.0404e-01,  7.3500e-02, -1.6232e+00, -1.1790e-01,
        -8.3842e-01, -1.4621e-01, -3.4811e-01,  4.4908e-01, -1.7393e-01,
        -7.0784e-01,  8.6048e-02, -7.1140e-01, -5.2363e-01,  9.1166e-02,
         5.1143e-01, -1.2924e-01,  2.1199e-01, -8.8560e-02,  5.9630e-01,
        -4.2101e-01, -5.6085e-02, -1.7379e-01,  1.0927e-02, -9.1971e-02,
        -3.3794e-01, -5.9463e-01, -8.2695e-02,  3.6367e-01,  1.4167e+00,
         3.4630e-01, -1.2601e-01,  7.8905e-01,  3.0500e-01, -2.2435e-01,
        -2.4326e-01,  1.2809e-01,  9.1061e-01, -2.1375e-02, -1.1246e+00,
        -2.7869e-01,  3.3716e-01,  3.5137e-01,  4.0492e-02, -1.6855e-01,
        -7.4820e-01,  1.3041e-01, -6.1203e-02, -3.7114e-01, -1.3355e-01,
        -8.4475e-01,  3.6704e-01, -4.7373e-01,  8.7016e-02, -1.9033e-02,
         4.9349e-01, -5.8406e-01, -1.8695e-01, -2.4741e-01, -3.9234e-02,
         5.8171e-03, -3.0467e-01,  5.7297e-02,  2.1041e-01,  6.7821e-02,
        -1.9852e-01,  7.4045e-01, -2.6642e-01,  6.3921e-01, -5.7172e-01,
        -3.4661e-01, -1.7463e-01, -2.8932e-02, -8.9856e-01,  1.8209e-01,
         7.5716e-01,  8.7362e-01, -1.1755e+00,  2.7790e-01,  1.7225e-02,
        -9.2702e-01,  1.8722e-01,  3.6767e-01, -6.3533e-02, -5.7313e-01,
        -4.5457e-01, -5.5074e-01, -2.6891e-01,  8.7131e-02,  1.1535e-01,
        -5.8962e-01, -1.3419e+00,  2.4388e-01, -3.3307e-15, -3.3307e-15,
         3.1607e+00,  1.3828e-01,  2.4971e+00, -2.8941e+00,  6.0091e-01,
        -4.1590e-01,  1.8731e-01, -2.2732e-02,  6.7517e-03,  2.0576e-01,
         1.1964e-01, -1.3272e-01,  2.2645e-01,  6.6501e-01, -9.6645e-01,
         8.0410e-01,  2.3093e-14,  3.3824e-01,  6.1975e-03,  9.5904e-02,
         1.6866e-03,  3.3125e-01, -2.3450e-01,  1.7897e-02, -5.6951e-01,
         1.3896e-01, -2.5995e-01, -3.7094e-01,  3.5949e-01,  3.6571e-01,
        -4.1248e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([13925]), tensor(0.2117))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-2.5185e-01, -3.0627e-01, -6.7369e-01,  1.2482e+00, -4.0793e-01,
        -2.6530e-01, -5.0523e-01, -5.6910e-01, -7.6360e-02, -1.2156e-01,
        -3.0566e-01,  5.0731e-02, -7.1140e-01,  5.6680e-01,  2.6004e-01,
         1.5959e+00, -1.1254e-01,  1.5008e+00, -8.8560e-02, -1.3051e+00,
         2.8418e-01, -1.2732e-01, -5.1089e-01, -4.3179e-01,  3.2870e-01,
        -7.4241e-01, -6.4546e-01, -8.2695e-02, -6.2903e-01,  1.2934e-02,
        -2.9901e-01, -2.3096e-01,  4.1847e-01,  3.0500e-01, -5.5577e-01,
         4.8227e-01,  6.9566e-01, -7.1712e-01,  1.2408e+00, -4.8652e-01,
        -2.7450e-01,  2.5683e-02, -4.1523e-01, -3.7367e-01, -3.9193e-01,
         6.6065e-01,  4.2467e-02,  1.0023e+00, -9.9839e-02,  3.5749e-02,
         2.3466e+00, -5.4451e-01, -4.7373e-01, -6.7850e-01, -7.3414e-01,
         2.5588e-01, -9.5994e-01,  8.9939e-01, -2.0937e-01, -3.7883e-01,
         2.0168e+00,  2.1862e-01,  2.2134e+00,  2.0714e+00, -3.7948e-02,
         1.5148e+00, -4.9179e-01, -3.1165e-01,  6.3921e-01, -6.6845e-01,
        -3.4661e-01, -1.7463e-01, -2.8932e-02,  1.4230e-01,  1.7371e-01,
        -8.0579e-01,  8.7362e-01,  1.6291e-01,  1.4995e+00,  1.7225e-02,
        -9.2702e-01,  7.4812e-01, -1.5470e-01,  6.5891e-01,  1.0031e+00,
        -3.0984e-01, -4.5084e-01, -2.8951e-02, -2.5745e-01, -4.8541e-01,
         4.7059e-01, -9.4753e-01,  2.4388e-01, -3.3307e-15, -3.3307e-15,
        -1.9327e-01,  1.4220e-01, -1.7583e+00,  1.6815e+00,  1.5033e-01,
        -3.3209e-01, -1.4781e+00, -2.2732e-02, -1.1065e+00,  2.0576e-01,
         3.0751e-02, -1.9868e-01,  2.2645e-01, -1.1908e+00, -1.5293e+00,
         1.0305e+00,  2.3093e-14,  2.7595e-01,  4.5552e+00,  9.5904e-02,
         1.6866e-03, -3.0564e-01, -3.1522e-01,  1.7897e-02, -4.3676e-01,
         1.0624e+00, -8.3723e-02, -3.8061e-01,  3.5085e-01,  2.5214e-01,
        -3.3652e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([3039]), tensor(-0.0189))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.3927e-01,  9.1362e-01,  7.3040e-02, -1.6380e+00, -1.1193e-01,
        -8.4131e-01, -1.4537e-01, -3.4648e-01,  4.4611e-01, -1.7234e-01,
        -7.1204e-01,  8.8603e-02, -7.0973e-01, -5.3057e-01,  9.3019e-02,
         5.1464e-01, -1.2764e-01,  2.1285e-01, -8.8361e-02,  6.0712e-01,
        -4.1162e-01, -6.0162e-02, -1.7526e-01,  9.5381e-03, -8.8918e-02,
        -3.3825e-01, -5.9550e-01, -8.5255e-02,  3.4450e-01,  1.4138e+00,
         3.4766e-01, -1.2383e-01,  7.9050e-01,  3.0998e-01, -2.2421e-01,
        -2.3519e-01,  1.4277e-01,  9.1161e-01, -1.3247e-02, -1.1311e+00,
        -2.7677e-01,  3.0116e-01,  3.6358e-01,  3.5865e-02, -1.6293e-01,
        -7.4726e-01,  1.1604e-01, -6.3421e-02, -3.4996e-01, -1.3595e-01,
        -8.4847e-01,  3.5329e-01, -4.7331e-01,  8.5049e-02, -1.9453e-02,
         4.9264e-01, -5.7712e-01, -1.8437e-01, -2.4903e-01, -3.8648e-02,
         4.9528e-03, -3.0698e-01,  6.3616e-02,  2.1423e-01,  7.0318e-02,
        -1.9574e-01,  7.5221e-01, -2.6464e-01,  6.3217e-01, -5.7330e-01,
        -3.4933e-01, -1.7559e-01, -2.9092e-02, -8.9872e-01,  1.8520e-01,
         7.6351e-01,  8.8474e-01, -1.1792e+00,  2.7609e-01,  1.8951e-02,
        -9.6567e-01,  1.9667e-01,  3.7361e-01, -4.4194e-02, -5.7447e-01,
        -4.5898e-01, -5.5389e-01, -2.7038e-01,  8.9678e-02,  1.1469e-01,
        -5.9617e-01, -1.3397e+00,  2.4770e-01,  1.6653e-15,  1.6653e-15,
         3.2045e+00,  1.2849e-01,  2.4799e+00, -2.9059e+00,  6.0545e-01,
        -4.2080e-01,  1.9761e-01, -1.4282e-02, -5.6949e-02,  2.0421e-01,
         1.1749e-01, -1.4323e-01,  2.4634e-01,  5.3020e-01, -9.0624e-01,
         8.0823e-01, -8.8818e-15,  3.3851e-01,  1.3375e-02,  9.3341e-02,
         8.8609e-03,  3.4298e-01, -2.2962e-01,  1.7690e-02, -5.6735e-01,
         1.3758e-01, -2.5264e-01, -3.6472e-01,  3.6131e-01,  3.6599e-01,
        -4.1448e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([14005]), tensor(0.2117))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-1.4593e-01, -3.8136e-01,  1.7007e+00,  1.2281e+00,  1.3378e+00,
        -8.6637e-01, -5.5292e-01, -5.9307e-01, -1.2677e-01, -7.7821e-02,
        -4.8795e-01,  2.7126e-01, -7.0973e-01,  6.1386e-01,  9.6481e-02,
        -9.4817e-01,  2.0251e+00,  1.5007e+00, -8.8361e-02, -5.2999e-02,
        -2.1600e-01, -1.3043e-01, -1.5659e-01, -9.0095e-01,  8.6518e-01,
        -8.5948e-01, -5.7521e-01, -8.5255e-02,  6.5512e-01,  4.1118e-01,
         2.2221e-03,  7.8361e-01,  5.5636e-01,  3.0998e-01, -6.4979e-01,
         6.8597e-01,  4.4710e-01, -7.1851e-01,  1.1294e+00, -3.9751e-01,
        -2.7684e-01, -1.6970e-01,  3.6364e-01, -3.8339e-01,  7.1276e-01,
        -8.7437e-01, -1.7867e-01,  2.7941e-01, -8.7806e-02, -3.0062e-01,
         2.3450e+00, -2.6722e-01, -4.7331e-01, -6.7984e-01, -7.3664e-01,
         1.3883e-01, -9.5501e-01,  9.5136e-02, -7.1711e-01, -3.6146e-01,
         6.3871e-01, -5.5510e-01, -6.6889e-02, -1.3412e+00, -4.1492e-02,
        -2.5361e-01, -4.8886e-01, -3.9092e-01,  2.6562e+00, -7.3027e-01,
        -3.4933e-01, -1.7559e-01, -2.9092e-02, -1.0677e+00,  1.0917e-01,
         6.8587e-02,  8.8474e-01,  1.1271e-01,  1.5018e+00,  1.8951e-02,
        -9.6567e-01, -2.3218e-01, -4.1358e-01, -8.6765e-01, -3.7993e-01,
        -3.1589e-01, -4.5597e-01, -1.6292e-01, -5.7360e-01,  5.4074e-01,
        -2.6168e-01, -3.5320e-01,  2.4770e-01,  1.6653e-15,  1.6653e-15,
        -4.6751e-02,  2.3229e-01, -1.6333e+00,  1.2606e+00,  8.3593e-02,
        -3.5448e-01, -1.0159e-01, -1.4282e-02, -1.1116e+00,  2.0421e-01,
        -6.1516e-01, -1.6577e-01,  2.4634e-01,  1.3764e+00, -1.2562e+00,
        -8.3904e-01, -8.8818e-15,  3.7177e-01,  1.3788e+00,  9.3341e-02,
         8.8609e-03, -6.0953e-01,  2.4734e-01,  1.7690e-02, -3.5042e-01,
         1.2694e-01, -5.7492e-01, -7.4430e-01,  4.7313e-01,  4.0679e-01,
        -3.0843e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2932]), tensor(0.0290))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:main_restricted.py:Testing data year: 2010
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15618
            device: cpu
            
2024-08-07 12:33:11,140	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-07 12:33:11,208	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-07 12:33:11,265	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_26ed888e58593a30.zip' (5.14MiB) to Ray cluster...
2024-08-07 12:33:11,276	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_26ed888e58593a30.zip'.
2024-08-07 12:33:15,766	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-07 14:27:38,536	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-07_12-33-15' in 0.2432s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 15, 'num_layers': 4, 'num_embeddings': 15618, 'embedding_dim': 8, 'dropout_rate': 0.39, 'lr': 0.00048561577077656747, 'weight_decay': 3.638506061069974e-05, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.034590662797486335
INFO:model_data_nn.py:Best trial testing loss: 0.025221581955480833
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-07_12-33-08_497848_871373/artifacts/2024-08-07_12-33-15/train_fnn_2024-08-07_12-33-15/driver_artifacts/train_fnn_e4693_00088_88_dropout_rate=0.3900,embedding_dim=8,hidden_dim=15,lr=0.0005,num_layers=4,weight_decay=0.0000_2024-08-07_12-33-16
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 15, 'num_layers': 4, 'num_embeddings': 15706, 'embedding_dim': 8, 'dropout_rate': 0.39, 'lr': 0.00048561577077656747, 'weight_decay': 3.638506061069974e-05, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03487065812774829, 'avg_test_loss': 0.021863868843876956}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.034532187677787256, 'avg_test_loss': 0.021613479535462277}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.03441748033687842, 'avg_test_loss': 0.021503246796430286}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.034359593801462515, 'avg_test_loss': 0.021740516634291093}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.034329786416781534, 'avg_test_loss': 0.02137399343703168}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03431867638229707, 'avg_test_loss': 0.02150189673288189}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03429376765266862, 'avg_test_loss': 0.02150314608729924}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03425571797145777, 'avg_test_loss': 0.02170702199536291}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.034266311403314605, 'avg_test_loss': 0.021364915603771805}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.03424710400297695, 'avg_test_loss': 0.021651128400822707}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03426555621866383, 'avg_test_loss': 0.021434494637827754}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.03424753373834175, 'avg_test_loss': 0.021486266632564366}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.03424786320210601, 'avg_test_loss': 0.021624612289650198}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.034252180335488144, 'avg_test_loss': 0.021779642698609016}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.03423984017884606, 'avg_test_loss': 0.021824447437415295}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.03423517085719755, 'avg_test_loss': 0.02148159607454683}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.03424316893419596, 'avg_test_loss': 0.021449227308656907}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.03425977552041337, 'avg_test_loss': 0.02149944981263781}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.034243963958097264, 'avg_test_loss': 0.021826820421230162}
INFO:model_data_nn.py:Early stopping at epoch 19
INFO:main_restricted.py:Making prediction for data in year: 2011
INFO:main_restricted.py:Prediction data shape: (42205,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2011: 0.14773266358582265
INFO:main_restricted.py:Prediction Stats:                 ret          pred
count  42205.000000  42205.000000
mean      -0.005365      0.016834
std        0.146266      0.015797
min       -0.935356     -0.057734
25%       -0.073850      0.012424
50%       -0.008264      0.018966
75%        0.050858      0.020438
max        3.993939      0.267661
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:transform_data_nn.py:Train_data: (1629525, 161)

INFO:transform_data_nn.py:Test data years: [2013]
INFO:transform_data_nn.py:Test_data: (39683, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:transform_data_nn.py:Retrain_data: (1669208, 161)

INFO:transform_data_nn.py:Prediction data years: [2014]
INFO:transform_data_nn.py:Prediction_data: (39216, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([1629525, 138])
            y_train_tf: torch.Size([1629525])

            x_test_tf: torch.Size([39683, 138])
            y_test_tf: torch.Size([39683])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([1669208, 138])
            y_retrain_tf: torch.Size([1669208])

            x_prediction_tf: torch.Size([39216, 138])
            y_prediction_tf: torch.Size([39216])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.2904e-01,  9.2588e-01,  7.0911e-02, -1.6655e+00, -1.0686e-01,
        -8.4260e-01, -1.4763e-01, -3.4686e-01,  4.4350e-01, -1.6939e-01,
        -7.1850e-01,  8.3978e-02, -7.0821e-01, -5.4436e-01,  9.7482e-02,
         5.1761e-01, -1.2350e-01,  2.0757e-01, -8.5328e-02,  6.1631e-01,
        -4.1361e-01, -6.5030e-02, -1.7684e-01,  9.7866e-03, -9.2777e-02,
        -3.3863e-01, -5.9503e-01, -8.8227e-02,  3.0764e-01,  1.4156e+00,
         3.4922e-01, -1.2115e-01,  7.9205e-01,  3.1936e-01, -2.2586e-01,
        -2.2776e-01,  1.5482e-01,  9.1311e-01, -8.8896e-03, -1.1311e+00,
        -2.7333e-01,  3.1240e-01,  3.7591e-01,  2.9822e-02, -1.5864e-01,
        -7.4281e-01,  1.1925e-01, -6.2772e-02, -3.5156e-01, -1.3709e-01,
        -8.4971e-01,  3.2353e-01, -4.7305e-01,  8.6838e-02, -1.5873e-02,
         4.9029e-01, -5.6320e-01, -1.8334e-01, -2.4927e-01, -3.2158e-02,
         1.6769e-03, -3.0652e-01,  6.9735e-02,  2.1304e-01,  6.8220e-02,
        -1.9241e-01,  7.6922e-01, -2.6027e-01,  6.1771e-01, -5.7536e-01,
        -3.5340e-01, -1.7720e-01, -2.7315e-02, -8.9587e-01,  1.8304e-01,
         7.7466e-01,  9.0272e-01, -1.1830e+00,  2.7094e-01,  2.0407e-02,
        -1.0081e+00,  2.0158e-01,  3.8435e-01, -1.0811e-02, -5.7639e-01,
        -4.6642e-01, -5.5856e-01, -2.7316e-01,  9.7122e-02,  1.1322e-01,
        -6.0763e-01, -1.3379e+00,  2.5438e-01,  2.3315e-15,  2.3315e-15,
         3.2922e+00,  1.5467e-01,  2.4655e+00, -2.9649e+00,  6.0536e-01,
        -4.2735e-01,  2.0571e-01, -4.1955e-03,  1.2508e-02,  1.8407e-01,
         4.3527e-02, -1.4988e-01,  2.6931e-01,  7.0499e-01, -8.8011e-01,
         8.4883e-01, -2.6645e-14,  3.3098e-01,  2.7776e-02,  7.9749e-02,
         9.6244e-03,  3.6517e-01, -2.2720e-01,  3.0853e-02, -5.6306e-01,
         1.4047e-01, -2.3965e-01, -3.5712e-01,  3.5960e-01,  3.6295e-01,
        -4.1716e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([14247]), tensor(0.2117))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-1.4326e-01, -3.7082e-01,  1.9029e-01,  1.1913e+00, -1.5569e-01,
        -5.2536e-01, -1.2305e+00, -8.3148e-01,  3.1653e-01,  4.0505e-01,
        -7.1466e-01, -4.0230e-02, -7.0821e-01,  5.9293e-01,  1.1293e-01,
        -5.9347e-01, -2.1203e-01,  8.0529e-01, -1.7297e-02, -3.2615e-01,
         5.0807e-02, -1.3391e-01, -8.3475e-02, -2.4875e-01, -2.6626e-01,
        -8.1541e-01, -6.6190e-01, -8.8227e-02,  1.9469e-02,  1.3530e+00,
        -1.4649e+00, -2.4234e-01,  2.4357e-01,  3.1936e-01, -7.6115e-01,
         2.6925e-01,  5.5426e-01, -7.0897e-01,  4.7697e-01, -1.1147e+00,
        -2.6799e-01, -3.2452e-01,  5.9406e-01, -2.9618e-01, -7.5120e-02,
        -7.5298e-01, -4.3760e-01, -1.6335e-01, -8.7961e-02, -2.4470e-01,
         7.4623e-01, -3.3055e-01, -4.7305e-01, -3.8688e-01, -1.5873e-02,
        -4.6541e-02, -9.4508e-01, -4.6730e-01, -5.9638e-01, -2.6596e-01,
        -2.0335e-01, -6.1293e-01,  5.4078e-02, -1.0759e+00, -3.8564e-02,
        -1.8678e-01, -4.8444e-01,  2.0774e-01,  6.1771e-01, -7.0267e-01,
        -3.5340e-01, -1.7720e-01, -2.7315e-02, -8.5030e-01, -2.1120e-02,
        -5.7656e-02,  9.0272e-01,  4.0475e-01,  1.5048e+00,  2.0407e-02,
         8.2155e-01, -6.2158e-01, -3.3935e-01, -8.3619e-01, -5.3270e-01,
        -3.7519e-01, -4.9104e-01, -3.5532e-01, -6.1545e-01, -7.1434e-01,
        -4.9258e-01,  6.6994e-01,  2.5438e-01,  2.3315e-15,  2.3315e-15,
        -8.7580e-02, -9.4629e-01, -1.5122e+00,  9.9657e-02, -1.4822e-01,
        -3.2254e-01, -1.8771e-01, -4.1955e-03, -8.3887e-01,  1.8407e-01,
         3.9178e+00, -2.2981e-01,  7.4825e-01,  5.5489e-01, -9.6234e-01,
        -6.8662e-01, -2.6645e-14,  2.2063e-01, -1.9818e+00, -3.7859e-01,
        -3.3979e+00, -5.0775e-01, -1.5019e-01,  3.0853e-02, -2.0206e-01,
         3.7997e-01, -6.5685e-01, -8.0389e-01,  1.8180e-01,  3.7697e-02,
        -3.3792e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2735]), tensor(0.0627))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.2511e-01,  9.3275e-01,  6.9032e-02, -1.6779e+00, -1.0372e-01,
        -8.3908e-01, -1.5048e-01, -3.4875e-01,  4.4744e-01, -1.6829e-01,
        -7.2095e-01,  8.4767e-02, -7.0936e-01, -5.5003e-01,  9.9669e-02,
         5.2145e-01, -1.2187e-01,  2.0511e-01, -8.7589e-02,  6.2321e-01,
        -4.1828e-01, -6.8465e-02, -1.8015e-01,  1.1259e-02, -9.3232e-02,
        -3.3859e-01, -5.9442e-01, -8.8215e-02,  2.8774e-01,  1.4183e+00,
         3.5026e-01, -1.1897e-01,  7.9418e-01,  3.2387e-01, -2.2571e-01,
        -2.2907e-01,  1.5939e-01,  9.1479e-01, -7.1619e-03, -1.1237e+00,
        -2.7126e-01,  3.0657e-01,  3.8249e-01,  2.9439e-02, -1.5667e-01,
        -7.3743e-01,  1.1529e-01, -6.6457e-02, -3.5121e-01, -1.4270e-01,
        -8.5121e-01,  3.0699e-01, -4.7307e-01,  8.9165e-02, -1.3376e-02,
         4.8777e-01, -5.5674e-01, -1.8258e-01, -2.4933e-01, -3.0187e-02,
         7.2991e-04, -3.0655e-01,  7.0122e-02,  2.1463e-01,  7.1067e-02,
        -1.9231e-01,  7.7804e-01, -2.5774e-01,  6.1410e-01, -5.7600e-01,
        -3.5497e-01, -1.7821e-01, -2.7461e-02, -8.8919e-01,  1.8416e-01,
         7.8318e-01,  9.1046e-01, -1.1845e+00,  2.6847e-01,  2.0299e-02,
        -1.0165e+00,  2.0661e-01,  3.9133e-01,  3.9541e-03, -5.7695e-01,
        -4.6958e-01, -5.6008e-01, -2.7362e-01,  1.0124e-01,  1.1420e-01,
        -6.1272e-01, -1.3364e+00,  2.5788e-01, -1.8874e-15, -1.8874e-15,
         3.3349e+00,  1.6496e-01,  2.4653e+00, -3.0001e+00,  6.2017e-01,
        -4.2434e-01,  2.1128e-01, -3.2378e-03, -6.4234e-02,  1.7868e-01,
         6.3353e-02, -1.5135e-01,  2.6132e-01,  7.4485e-01, -8.7168e-01,
         8.6667e-01, -3.3751e-14,  3.2715e-01,  3.2018e-02,  8.1440e-02,
         5.3465e-03,  3.7510e-01, -2.2634e-01,  5.1440e-02, -5.6171e-01,
         1.4176e-01, -2.3398e-01, -3.5403e-01,  3.5998e-01,  3.6210e-01,
        -4.1695e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([14375]), tensor(0.2117))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-7.5348e-01,  1.3554e-01, -2.9087e-02,  1.1752e+00,  5.8472e-02,
        -4.6495e-01, -1.2306e+00, -8.3428e-01,  5.0188e-01,  7.2936e-01,
        -4.5772e-01,  3.4096e-02, -7.0936e-01,  2.2801e-01, -1.0923e-01,
         3.8983e-01, -1.5016e-01,  2.2063e-01,  2.3608e-01, -1.2307e-01,
        -7.1905e-01, -1.3374e-01, -2.1147e-02, -5.5224e-02, -7.1776e-02,
        -7.3495e-01, -6.6613e-01, -8.8215e-02,  8.7682e-01,  1.1964e+00,
        -3.4320e-01,  1.1315e-01,  3.9256e-01,  3.2387e-01, -7.1805e-01,
         8.3507e-02,  5.8209e-01, -7.0493e-01, -2.3222e-01, -1.2263e+00,
        -2.7175e-01,  3.1995e-01,  1.1293e+00, -2.8959e-01, -1.6379e-01,
        -6.9048e-01, -2.7985e-01, -4.5707e-01, -3.5778e-01, -5.7033e-01,
         7.4483e-01, -2.9821e-01, -4.7307e-01, -3.9351e-01, -7.3777e-01,
        -1.2796e-02, -9.4049e-01, -1.9648e-01,  3.6965e-01, -1.5662e-01,
         4.7428e-02,  5.4356e-01,  6.5940e-01,  8.6141e-01, -3.8418e-02,
         1.0883e-01, -3.4278e-01, -5.8231e-01,  1.9588e+00, -6.1354e-01,
        -3.5497e-01, -1.7821e-01, -2.7461e-02, -7.0124e-01,  6.8416e-02,
         8.6056e-02,  3.1839e-01,  8.8236e-01,  1.5077e+00,  2.0299e-02,
         9.0630e-01,  2.8118e-01, -2.7513e-01, -1.2173e+00, -1.1363e-01,
        -3.9740e-01, -5.0734e-01, -3.4772e-01, -3.4396e-01, -1.8867e-01,
         5.0457e-01, -9.5179e-01,  2.5788e-01, -1.8874e-15, -1.8874e-15,
        -2.9877e-01,  2.4693e-01, -1.4548e+00,  1.0317e+00, -6.3375e-01,
        -3.7270e-01, -3.6190e-01, -3.2378e-03, -4.8629e-01,  1.7868e-01,
         3.3095e+00, -2.0456e-01,  9.6982e-02,  6.2453e-01, -4.9548e-01,
        -1.7226e-01, -3.3751e-14,  2.8503e-01, -1.3409e+00, -1.5301e-01,
        -3.3747e+00, -5.0306e-01, -2.4199e-01,  5.1440e-02, -5.6842e-01,
        -3.5317e-01, -6.2841e-01, -6.7730e-01,  2.5577e-01,  1.1221e-01,
        -3.3692e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2717]), tensor(0.1476))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:main_restricted.py:Testing data year: 2013
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 15992
            device: cpu
            
2024-08-07 17:43:48,434	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-07 17:43:48,487	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-07 17:43:48,537	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_26ed888e58593a30.zip' (5.14MiB) to Ray cluster...
2024-08-07 17:43:48,549	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_26ed888e58593a30.zip'.
2024-08-07 17:43:53,196	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-07 19:02:06,864	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-07_17-43-53' in 0.2561s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 3, 'num_embeddings': 15992, 'embedding_dim': 9, 'dropout_rate': 0.37, 'lr': 0.0005884968350790236, 'weight_decay': 6.4303853792601085e-06, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03221298032356112
INFO:model_data_nn.py:Best trial testing loss: 0.017372869621435257
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-07_17-43-45_613172_871373/artifacts/2024-08-07_17-43-53/train_fnn_2024-08-07_17-43-53/driver_artifacts/train_fnn_492f5_00019_19_dropout_rate=0.3700,embedding_dim=9,hidden_dim=65,lr=0.0006,num_layers=3,weight_decay=0.0000_2024-08-07_17-43-53
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 65, 'num_layers': 3, 'num_embeddings': 16138, 'embedding_dim': 9, 'dropout_rate': 0.37, 'lr': 0.0005884968350790236, 'weight_decay': 6.4303853792601085e-06, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.033664782165386854, 'avg_test_loss': 0.018383664062325555}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.03322739876439635, 'avg_test_loss': 0.018456449740526876}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.0329182157254395, 'avg_test_loss': 0.018385942743223537}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03269473930943666, 'avg_test_loss': 0.018407539915026496}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03253927116126588, 'avg_test_loss': 0.018322089176582543}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03240722972582569, 'avg_test_loss': 0.01836366135193223}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03236824994473975, 'avg_test_loss': 0.018273091095375317}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.032319254772109125, 'avg_test_loss': 0.018359655373295956}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03225236464794611, 'avg_test_loss': 0.018370805236932606}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.032218717223253285, 'avg_test_loss': 0.01826804442974323}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.03217188551274922, 'avg_test_loss': 0.018380960023352204}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.032181812526138234, 'avg_test_loss': 0.01839177104559536}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.032145848581738815, 'avg_test_loss': 0.018282082527178167}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.03213347858467933, 'avg_test_loss': 0.01842105761777112}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.03208400437921183, 'avg_test_loss': 0.018365267808291248}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.03208903968098511, 'avg_test_loss': 0.018422423538839876}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.03205230495688203, 'avg_test_loss': 0.018432055118399692}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.03201373767284848, 'avg_test_loss': 0.018434729930680814}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.03200947615072314, 'avg_test_loss': 0.01835326765169441}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.032016583034365886, 'avg_test_loss': 0.018539157439727057}
INFO:model_data_nn.py:Early stopping at epoch 20
INFO:main_restricted.py:Making prediction for data in year: 2014
INFO:main_restricted.py:Prediction data shape: (39216,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2014: 0.1360269206145421
INFO:main_restricted.py:Prediction Stats:                 ret          pred
count  39216.000000  39216.000000
mean       0.004751      0.022535
std        0.135238      0.011496
min       -0.813122     -0.156181
25%       -0.053242      0.020508
50%        0.003382      0.023994
75%        0.054622      0.026985
max        6.080164      0.197417
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:transform_data_nn.py:Train_data: (1708424, 161)

INFO:transform_data_nn.py:Test data years: [2015]
INFO:transform_data_nn.py:Test_data: (39863, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:transform_data_nn.py:Retrain_data: (1748287, 161)

INFO:transform_data_nn.py:Prediction data years: [2016]
INFO:transform_data_nn.py:Prediction_data: (40029, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([1708424, 138])
            y_train_tf: torch.Size([1708424])

            x_test_tf: torch.Size([39863, 138])
            y_test_tf: torch.Size([39863])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([1748287, 138])
            y_retrain_tf: torch.Size([1748287])

            x_prediction_tf: torch.Size([40029, 138])
            y_prediction_tf: torch.Size([40029])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.2117e-01,  9.4017e-01,  6.8041e-02, -1.6892e+00, -1.0254e-01,
        -8.3625e-01, -1.5348e-01, -3.5084e-01,  4.5434e-01, -1.6803e-01,
        -7.2305e-01,  8.6450e-02, -7.1228e-01, -5.5549e-01,  1.0220e-01,
         5.2455e-01, -1.2040e-01,  2.0547e-01, -8.8091e-02,  6.3003e-01,
        -4.1612e-01, -6.7278e-02, -1.8340e-01,  1.1769e-02, -9.3727e-02,
        -3.3884e-01, -5.9391e-01, -9.0562e-02,  2.6577e-01,  1.4232e+00,
         3.5196e-01, -1.1880e-01,  7.9736e-01,  3.2753e-01, -2.2514e-01,
        -2.2765e-01,  1.6363e-01,  9.1467e-01, -4.9379e-03, -1.1150e+00,
        -2.6879e-01,  3.0096e-01,  3.8889e-01,  3.0609e-02, -1.5499e-01,
        -7.3152e-01,  1.1152e-01, -6.5919e-02, -3.5284e-01, -1.4409e-01,
        -8.5217e-01,  2.8902e-01, -4.7305e-01,  9.0998e-02, -1.0899e-02,
         4.8583e-01, -5.5041e-01, -1.8201e-01, -2.5025e-01, -2.7822e-02,
        -4.3288e-04, -3.0736e-01,  6.7678e-02,  2.1622e-01,  7.2545e-02,
        -1.9429e-01,  7.8581e-01, -2.5494e-01,  6.1112e-01, -5.7655e-01,
        -3.5621e-01, -1.7933e-01, -2.7362e-02, -8.8272e-01,  1.8598e-01,
         7.9173e-01,  9.1821e-01, -1.1874e+00,  2.6615e-01,  2.0602e-02,
        -1.0197e+00,  2.1042e-01,  4.0040e-01,  2.0162e-02, -5.7754e-01,
        -4.7272e-01, -5.6151e-01, -2.7329e-01,  1.0497e-01,  1.1512e-01,
        -6.1823e-01, -1.3357e+00,  2.6129e-01,  2.5535e-15,  2.5535e-15,
         3.3763e+00,  1.6144e-01,  2.4680e+00, -3.0349e+00,  6.4125e-01,
        -4.2102e-01,  2.1697e-01, -1.4005e-04, -6.2528e-02,  1.7156e-01,
         6.3363e-02, -1.5268e-01,  2.6718e-01,  7.8774e-01, -8.6347e-01,
         8.8283e-01, -5.3291e-15,  3.2339e-01,  2.2560e-02,  7.2049e-02,
         8.5025e-03,  3.8468e-01, -2.2609e-01,  6.5159e-02, -5.6027e-01,
         1.4211e-01, -2.2795e-01, -3.5203e-01,  3.6064e-01,  3.6088e-01,
        -4.1634e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([14550]), tensor(0.2117))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-3.5717e-01, -1.8188e-01, -5.3783e-01,  1.1607e+00, -2.2890e-01,
        -5.5991e-01, -9.9019e-01, -7.7564e-01,  1.0474e-01,  3.6153e-01,
        -7.4988e-01,  7.2767e-03, -7.1228e-01,  3.7581e-01,  6.9916e-02,
         3.3126e-01, -2.1001e-01,  7.3168e-01, -2.0650e-02, -9.3916e-04,
        -6.0838e-01, -1.2317e+00, -3.6269e-01, -1.8257e-01, -3.4554e-01,
        -8.0149e-01, -6.6441e-01, -9.0562e-02,  1.7216e-01,  9.1449e-01,
        -1.8451e-01, -2.3643e-01,  2.8778e-01,  3.2753e-01, -7.7692e-01,
        -3.7060e-01,  1.6908e-01, -7.0935e-01,  2.9487e-01, -9.8413e-01,
        -2.6828e-01,  2.5531e-02, -2.2523e-01, -3.5729e-01, -1.7557e-01,
        -8.1330e-01,  6.6405e-01, -3.1822e-01, -5.8136e-01,  1.7219e-01,
         1.5416e+00, -1.6327e-01, -4.7305e-01, -4.0049e-01, -1.0899e-02,
        -7.1759e-02, -9.3602e-01,  5.3200e-02, -4.7390e-01,  1.0957e-01,
        -7.1146e-01, -5.2165e-01,  2.8551e-01,  7.6178e-01, -3.8956e-02,
        -9.7441e-02, -4.7923e-01,  1.3843e-01,  6.1112e-01, -6.8187e-01,
        -3.5621e-01, -1.7933e-01, -2.7362e-02, -8.9762e-01,  2.2869e-03,
        -1.0320e-01,  9.1821e-01,  8.8175e-01,  1.5113e+00,  2.0602e-02,
         8.6809e-01,  2.8700e-01, -3.2937e-01, -1.0419e+00, -4.4081e-01,
        -3.7626e-01, -4.9719e-01, -3.3133e-01, -6.5548e-01, -3.9117e-01,
        -3.2848e-01, -2.6037e-01,  2.6129e-01,  2.5535e-15,  2.5535e-15,
        -2.0460e-01, -8.7127e-02, -1.4164e+00,  1.0176e-01, -1.9013e-01,
        -1.3304e-01, -5.3304e-04, -1.4005e-04, -2.2024e-01,  1.7156e-01,
         2.6423e+00, -2.0643e-01,  4.9580e-01,  5.4163e-01, -3.5714e-01,
        -4.3687e-01, -5.3291e-15,  1.2211e-01, -6.5600e-01, -5.0500e-01,
        -6.9602e-01, -4.5728e-01, -2.4597e-01,  6.5159e-02, -3.8607e-01,
         2.9223e-01, -4.9867e-01, -7.1642e-01,  2.3093e-01,  9.0875e-02,
        -3.8462e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2817]), tensor(-0.1152))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.1815e-01,  9.4640e-01,  6.6655e-02, -1.6980e+00, -1.0146e-01,
        -8.3540e-01, -1.5721e-01, -3.5341e-01,  4.5826e-01, -1.6808e-01,
        -7.2445e-01,  9.0484e-02, -7.1443e-01, -5.5737e-01,  1.0486e-01,
         5.2677e-01, -1.1883e-01,  2.0488e-01, -8.7526e-02,  6.3612e-01,
        -4.1634e-01, -6.9795e-02, -1.8558e-01,  1.3202e-02, -9.4613e-02,
        -3.3940e-01, -5.9356e-01, -9.1272e-02,  2.4365e-01,  1.4273e+00,
         3.5248e-01, -1.1696e-01,  7.9910e-01,  3.3120e-01, -2.2369e-01,
        -2.2649e-01,  1.6691e-01,  9.1763e-01, -4.4140e-03, -1.1055e+00,
        -2.6668e-01,  3.1237e-01,  3.9505e-01,  3.0835e-02, -1.5472e-01,
        -7.2759e-01,  1.1625e-01, -6.4468e-02, -3.5893e-01, -1.4108e-01,
        -8.5296e-01,  2.7210e-01, -4.7298e-01,  9.3382e-02, -8.0430e-03,
         4.8317e-01, -5.4415e-01, -1.8111e-01, -2.5027e-01, -2.6867e-02,
        -2.6593e-04, -3.0700e-01,  6.8521e-02,  2.1563e-01,  7.3669e-02,
        -1.9392e-01,  7.9265e-01, -2.5264e-01,  6.0946e-01, -5.7690e-01,
        -3.5781e-01, -1.8066e-01, -2.7231e-02, -8.7891e-01,  1.8938e-01,
         7.9892e-01,  9.2576e-01, -1.1904e+00,  2.6247e-01,  2.0212e-02,
        -1.0253e+00,  2.1242e-01,  4.0796e-01,  3.5258e-02, -5.7837e-01,
        -4.7698e-01, -5.6319e-01, -2.7321e-01,  1.0871e-01,  1.1597e-01,
        -6.2392e-01, -1.3339e+00,  2.6491e-01,  3.4417e-15,  3.4417e-15,
         3.4186e+00,  1.7989e-01,  2.4735e+00, -3.0718e+00,  6.4556e-01,
        -4.2210e-01,  2.2223e-01,  6.3960e-06, -5.9170e-02,  1.6632e-01,
         4.8699e-02, -1.5337e-01,  2.6683e-01,  8.2349e-01, -8.6196e-01,
         8.9944e-01,  0.0000e+00,  3.2056e-01,  3.1167e-02,  6.3727e-02,
         8.7324e-03,  3.9406e-01, -2.2657e-01,  7.6658e-02, -5.5855e-01,
         1.4346e-01, -2.2182e-01, -3.4903e-01,  3.6199e-01,  3.5951e-01,
        -4.1503e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([14806]), tensor(0.2117))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.6207e-01, -1.7088e-01, -6.7639e-01,  1.1481e+00, -4.0391e-01,
        -1.7848e-01, -1.0166e+00, -7.8513e-01,  6.7677e-01,  7.9195e-01,
        -6.7890e-01, -7.5354e-02, -7.1443e-01,  4.7845e-01,  9.8616e-02,
        -1.9618e-01, -2.0521e-01, -5.2216e-01, -2.1302e-02, -3.9874e-01,
        -4.2657e-01, -1.3381e-01, -1.5661e-01, -2.1226e-01, -2.2060e-01,
        -8.1051e-01, -6.7302e-01, -9.1272e-02, -3.3184e-01,  1.6398e+00,
        -3.3535e-01, -2.0838e-01,  1.9171e-01,  3.3120e-01, -8.0817e-01,
        -3.1582e-01, -1.2723e-01, -7.1070e-01, -9.2046e-01, -9.9129e-01,
        -2.6203e-01, -6.1019e-01, -1.5432e-01, -2.4310e-01, -4.0899e-01,
         1.0035e+00, -5.3086e-01, -9.4895e-01,  6.8735e-03, -5.1251e-01,
         7.4322e-01, -3.5985e-01, -4.7298e-01, -4.0719e-01, -7.3828e-01,
        -1.3526e-01, -9.3164e-01, -2.0107e-01, -2.0248e-01, -3.1305e-01,
        -3.8403e-02, -1.9839e-01,  3.6470e-01,  4.8632e-01, -3.8397e-02,
         2.8691e-02, -4.7732e-01,  2.5637e-01,  6.0946e-01, -6.8792e-01,
        -3.5781e-01, -1.8066e-01, -2.7231e-02,  3.6602e-01, -6.9906e-02,
        -1.4043e-01,  9.2576e-01,  8.8097e-01,  1.5140e+00,  2.0212e-02,
         8.4911e-01, -5.7603e-01, -1.8850e-01, -5.4227e-01, -2.8406e-01,
        -3.6601e-01, -4.9672e-01, -4.1937e-01, -4.6640e-01, -2.7863e-01,
        -2.5935e-01, -4.2232e-01,  2.6491e-01,  3.4417e-15,  3.4417e-15,
        -2.5088e-01, -1.4914e+00, -1.3054e+00,  1.1437e-01,  1.0312e+00,
         3.0446e-02, -9.4918e-01,  6.3960e-06, -2.4860e-02,  1.6632e-01,
         2.1899e+00,  2.0727e-02, -3.3416e+00,  7.6775e-01, -6.7283e-01,
        -1.8512e-01,  0.0000e+00,  8.8638e-02, -1.4849e+00, -2.9543e-01,
        -6.9062e-01, -5.2278e-01, -3.5835e-01,  7.6658e-02, -2.8026e-01,
        -9.7116e-02, -5.6274e-01, -8.1925e-01,  1.4522e-01, -1.1762e-02,
        -4.0288e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00]), tensor([2793]), tensor(0.1168))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:main_restricted.py:Testing data year: 2015
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 16336
            device: cpu
            
2024-08-07 22:26:53,215	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-07 22:26:53,271	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-07 22:26:53,326	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_26ed888e58593a30.zip' (5.14MiB) to Ray cluster...
2024-08-07 22:26:53,341	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_26ed888e58593a30.zip'.
2024-08-07 22:26:58,257	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-08 01:01:20,683	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-07_22-26-58' in 0.2804s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 195, 'num_layers': 3, 'num_embeddings': 16336, 'embedding_dim': 5, 'dropout_rate': 0.36, 'lr': 0.006092256381316039, 'weight_decay': 0.00022074361547391359, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.033692519088300364
INFO:model_data_nn.py:Best trial testing loss: 0.031081627094700266
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-07_22-26-50_454589_871373/artifacts/2024-08-07_22-26-58/train_fnn_2024-08-07_22-26-58/driver_artifacts/train_fnn_d511d_00066_66_dropout_rate=0.3600,embedding_dim=5,hidden_dim=195,lr=0.0061,num_layers=3,weight_decay=0.0002_2024-08-07_22-26-58
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 195, 'num_layers': 3, 'num_embeddings': 16626, 'embedding_dim': 5, 'dropout_rate': 0.36, 'lr': 0.006092256381316039, 'weight_decay': 0.00022074361547391359, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03373187020382024, 'avg_test_loss': 0.02840871356885892}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.03364244360326171, 'avg_test_loss': 0.028338949240672703}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.0336433108585758, 'avg_test_loss': 0.028473064278850494}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03364164447837393, 'avg_test_loss': 0.028463734281859315}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.03364355049125642, 'avg_test_loss': 0.028403979944832885}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.03364250305673193, 'avg_test_loss': 0.028364646658390617}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.03363949286642756, 'avg_test_loss': 0.028339536612133343}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.03364182004413496, 'avg_test_loss': 0.02840194833902315}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.03364500194044176, 'avg_test_loss': 0.02834213462125617}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.033638807259383285, 'avg_test_loss': 0.028338448128130394}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.033636608988912374, 'avg_test_loss': 0.0283535086287977}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.033638956654557205, 'avg_test_loss': 0.028656496085411015}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.03363823299400529, 'avg_test_loss': 0.02875233436235414}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.03363884942733468, 'avg_test_loss': 0.028411348424732877}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.03363608593857065, 'avg_test_loss': 0.028441488981609957}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.033637514359240395, 'avg_test_loss': 0.028375222853506906}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.03363796206628136, 'avg_test_loss': 0.028447499607329646}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.03363616272017768, 'avg_test_loss': 0.02854669829399084}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.03363633932070369, 'avg_test_loss': 0.02833970490851984}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.03363721410951595, 'avg_test_loss': 0.028358709964954768}
INFO:model_data_nn.py:Early stopping at epoch 20
INFO:main_restricted.py:Making prediction for data in year: 2016
INFO:main_restricted.py:Prediction data shape: (40029,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2016: 0.16842939274463528
INFO:main_restricted.py:Prediction Stats:                 ret          pred
count  40029.000000  40029.000000
mean       0.015965      0.011451
std        0.168371      0.000000
min       -0.961852      0.011451
25%       -0.051377      0.011451
50%        0.009668      0.011451
75%        0.073842      0.011451
max        7.634921      0.011451
INFO:main_restricted.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]
INFO:transform_data_nn.py:Train_data: (1865875, 161)

INFO:transform_data_nn.py:Test data years: [2019]
INFO:transform_data_nn.py:Test_data: (38497, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019]
INFO:transform_data_nn.py:Retrain_data: (1904372, 161)

INFO:transform_data_nn.py:Prediction data years: [2020]
INFO:transform_data_nn.py:Prediction_data: (38579, 161)

INFO:main_restricted.py:

Generate X and y with train_data and test_data

INFO:main_restricted.py:
            x_train_tf: torch.Size([1865875, 138])
            y_train_tf: torch.Size([1865875])

            x_test_tf: torch.Size([38497, 138])
            y_test_tf: torch.Size([38497])

        
INFO:main_restricted.py:

Generate X and y with retrain_data and prediction_data

INFO:main_restricted.py:
            x_retrain_tf: torch.Size([1904372, 138])
            y_retrain_tf: torch.Size([1904372])

            x_prediction_tf: torch.Size([38579, 138])
            y_prediction_tf: torch.Size([38579])

        
INFO:main_restricted.py:

Create dataset

INFO:main_restricted.py:Create train_dataset
INFO:main_restricted.py:train_dataset first example: (tensor([-1.1576e-01,  9.6224e-01,  6.1638e-02, -1.7205e+00, -9.4606e-02,
        -8.3439e-01, -1.6602e-01, -3.5902e-01,  4.7418e-01, -1.6647e-01,
        -7.2661e-01,  1.0893e-01, -7.2099e-01, -5.5530e-01,  1.0774e-01,
         5.3534e-01, -1.1646e-01,  2.0252e-01, -9.2181e-02,  6.5560e-01,
        -4.1992e-01, -6.8493e-02, -1.8295e-01,  1.8396e-02, -9.4103e-02,
        -3.3987e-01, -5.9288e-01, -9.4382e-02,  1.8197e-01,  1.4357e+00,
         3.5269e-01, -1.1145e-01,  8.0371e-01,  3.4073e-01, -2.1332e-01,
        -2.2151e-01,  1.7995e-01,  9.2418e-01, -1.4260e-03, -1.0858e+00,
        -2.5996e-01,  3.2775e-01,  4.1588e-01,  3.4052e-02, -1.5131e-01,
        -7.1695e-01,  1.2120e-01, -6.3799e-02, -3.5255e-01, -1.4124e-01,
        -8.5584e-01,  2.2608e-01, -4.7232e-01,  9.7673e-02, -2.1515e-03,
         4.7621e-01, -5.2720e-01, -1.7821e-01, -2.4768e-01, -2.6645e-02,
         7.6342e-04, -3.0434e-01,  6.5386e-02,  2.1840e-01,  7.3606e-02,
        -1.9663e-01,  8.1575e-01, -2.4754e-01,  6.0608e-01, -5.7660e-01,
        -3.6244e-01, -1.8637e-01, -2.8660e-02, -8.6887e-01,  2.0453e-01,
         8.1805e-01,  9.4735e-01, -1.2006e+00,  2.5226e-01,  2.0016e-02,
        -1.0960e+00,  2.1739e-01,  4.2847e-01,  7.8642e-02, -5.7835e-01,
        -4.9617e-01, -5.6875e-01, -2.7305e-01,  1.1779e-01,  1.1944e-01,
        -6.3864e-01, -1.3304e+00,  2.7403e-01,  4.4409e-15,  4.4409e-15,
         3.5363e+00,  2.6106e-01,  2.5321e+00, -3.1066e+00,  6.8064e-01,
        -4.1696e-01,  2.4093e-01,  2.5921e-03, -5.2058e-02,  1.6035e-01,
         4.7411e-02, -1.5973e-01,  2.2455e-01,  8.4621e-01, -8.2806e-01,
         9.5833e-01, -1.2434e-14,  3.1778e-01,  3.1800e-02,  4.7928e-02,
         8.8315e-03,  4.2260e-01, -2.2396e-01,  1.0226e-01, -5.5429e-01,
         1.4701e-01, -2.0542e-01, -3.3596e-01,  3.6909e-01,  3.5491e-01,
        -4.1249e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([15269]), tensor(0.2117))
INFO:main_restricted.py:Create test_dataset
INFO:main_restricted.py:test_dataset first example: (tensor([-7.0015e-01,  1.3146e-01,  2.9713e-02,  1.1172e+00, -1.8643e-01,
        -3.4146e-01, -7.0817e-01, -6.7083e-01, -6.0852e-01, -1.2000e+00,
        -8.2074e-02,  1.7285e+00,  1.9368e+00,  2.0365e-03, -5.0218e-01,
        -1.2580e-01, -1.9911e-01,  3.5225e-01, -3.1327e-02,  4.8661e-02,
        -1.5253e-01,  1.1154e+00, -2.1503e-01, -4.0936e-01, -6.0619e-02,
         1.5030e-01, -3.3302e-01, -4.3095e-01,  8.6826e-01, -1.1081e-01,
        -4.2110e-01, -8.0454e-02,  2.7818e-01,  3.4073e-01,  3.4823e-01,
        -2.8601e-01, -1.7796e-01, -3.2285e-01, -6.4703e-02, -1.1305e+00,
        -2.6160e-01, -3.6006e-01, -1.6918e-02, -6.2379e-01, -4.1569e-01,
        -7.0940e-01, -1.4285e-01, -5.7041e-01,  4.5247e-02, -5.4173e-02,
         7.4185e-01,  1.2343e+00, -4.7232e-01,  4.0883e-01, -7.4010e-01,
         9.8438e-02, -3.3310e-01, -4.6620e-01, -1.0836e-01, -1.5261e-01,
        -7.2717e-02, -1.8388e-01, -1.3510e-01, -2.8912e-02, -9.0516e-02,
        -2.8700e-01, -1.3259e-01, -3.5016e-01,  6.0608e-01,  1.6283e-02,
        -3.5943e-01, -1.8570e-01, -2.8660e-02, -5.4105e-01,  1.2276e+00,
        -1.3146e-01,  1.5197e-01,  2.4645e-01,  5.1942e-01,  3.6498e-01,
         7.7149e-01, -2.5635e-01, -5.8935e-01, -1.0961e+00, -3.2594e-01,
        -5.0362e-01, -5.7207e-01, -3.5381e-01, -4.7684e-01, -2.0606e-01,
        -2.8598e-01, -2.6603e-01,  2.7403e-01,  4.4409e-15,  4.4409e-15,
        -4.5941e-01, -1.2118e+00, -5.5194e-01, -1.3260e+00,  1.9449e-01,
         8.2546e-01,  1.3026e-01, -8.1024e-01, -5.3729e-01, -2.0517e+00,
         1.3861e+00, -1.9084e-01, -2.1493e+00,  8.4621e-01, -8.3385e-01,
        -9.6826e-01, -1.2434e-14,  2.4163e-01,  3.1800e-02, -7.4281e-01,
        -6.8644e-01, -2.4757e-02, -3.4495e-01,  1.0226e-01, -5.6319e-01,
        -7.1877e-02,  7.7230e-02,  2.5494e+00,  6.9762e-01,  3.3971e-01,
        -3.9362e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00]), tensor([1133]), tensor(0.0675))
INFO:main_restricted.py:Create retrain_dataset
INFO:main_restricted.py:retrain_dataset first example: (tensor([-1.1453e-01,  9.6605e-01,  6.0483e-02, -1.7254e+00, -9.4831e-02,
        -8.3554e-01, -1.7113e-01, -3.6256e-01,  4.7529e-01, -1.6472e-01,
        -7.2655e-01,  1.1544e-01, -7.2241e-01, -5.5142e-01,  1.0819e-01,
         5.3767e-01, -1.1547e-01,  2.0161e-01, -9.2816e-02,  6.6055e-01,
        -4.1863e-01, -6.6290e-02, -1.8830e-01,  2.0065e-02, -9.8023e-02,
        -3.3974e-01, -5.9234e-01, -9.6869e-02,  1.5711e-01,  1.4332e+00,
         3.5273e-01, -1.1042e-01,  8.0112e-01,  3.4399e-01, -2.0907e-01,
        -2.2039e-01,  1.8287e-01,  9.2397e-01, -1.2868e-03, -1.0804e+00,
        -2.5790e-01,  3.4276e-01,  4.1862e-01,  3.3351e-02, -1.5204e-01,
        -7.1489e-01,  1.2819e-01, -6.2906e-02, -3.5456e-01, -1.3631e-01,
        -8.5687e-01,  2.1225e-01, -4.7196e-01,  9.8354e-02,  6.5096e-04,
         4.7590e-01, -5.2155e-01, -1.7529e-01, -2.4678e-01, -1.9665e-02,
         2.1402e-03, -3.0325e-01,  6.5474e-02,  2.1841e-01,  7.2421e-02,
        -1.9749e-01,  8.2269e-01, -2.4422e-01,  6.0652e-01, -5.7586e-01,
        -3.6360e-01, -1.8832e-01, -2.6445e-02, -8.6750e-01,  2.1051e-01,
         8.2159e-01,  9.5409e-01, -1.2040e+00,  2.4908e-01,  2.2840e-02,
        -1.1099e+00,  2.1722e-01,  4.3181e-01,  9.2356e-02, -5.7810e-01,
        -5.0280e-01, -5.7014e-01, -2.7272e-01,  1.1989e-01,  1.2474e-01,
        -6.4312e-01, -1.3286e+00,  2.7701e-01, -1.9984e-15, -1.9984e-15,
         3.5719e+00,  2.8199e-01,  2.5605e+00, -3.0271e+00,  6.8810e-01,
        -4.1754e-01,  2.4516e-01, -2.0170e-04, -5.0849e-02,  1.5389e-01,
         4.6042e-02, -1.6116e-01,  1.6135e-01,  8.5526e-01, -8.2879e-01,
         9.7391e-01,  2.3093e-14,  3.1729e-01,  3.6650e-02,  4.1952e-02,
         7.8312e-03,  4.3180e-01, -2.2524e-01,  1.0891e-01, -5.5078e-01,
         1.4716e-01, -1.9964e-01, -3.3120e-01,  3.7058e-01,  3.5405e-01,
        -4.1234e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([15481]), tensor(0.2117))
INFO:main_restricted.py:Create prediction_dataset
INFO:main_restricted.py:prediction_dataset first example: (tensor([-3.9349e-01, -1.1664e-01, -3.4957e-01,  1.1106e+00, -1.4296e-01,
        -8.2460e-01, -1.0271e+00, -7.9148e-01, -6.5919e-01, -1.2087e+00,
         3.8524e-01,  1.6350e+00,  1.4476e+00, -9.1522e-03, -5.6722e-01,
        -9.7026e-02, -2.0492e-01,  6.2864e-02, -8.7834e-01, -9.0778e-02,
         3.0962e-02,  2.3396e+00, -1.7573e-01, -3.8204e-01, -7.9543e-02,
         4.9695e-01, -3.3477e-01, -4.8785e-01,  8.7132e-01, -1.6251e-01,
        -4.8216e-01, -9.9496e-02,  2.3139e-01,  3.4399e-01,  2.8800e-01,
        -4.6251e-01, -2.1797e-01, -2.9489e-01, -2.1386e-01, -1.1037e+00,
        -2.5965e-01,  1.5562e-01, -5.3063e-01, -6.2667e-01, -2.2670e-01,
        -8.6135e-01,  3.1282e-01, -6.8559e-02, -2.1199e-01,  3.0197e-01,
         7.4152e-01,  1.3301e+00, -4.7196e-01,  1.1697e-01, -7.4033e-01,
         8.2148e-02, -3.6034e-01, -1.6770e-01,  3.9023e-01, -2.1892e-01,
        -3.4024e-02,  4.8338e-01,  1.6157e-02, -5.5122e-02, -3.3011e-02,
        -2.1528e-01, -3.1860e-01, -2.9785e-01, -6.7083e-02,  3.7894e-01,
        -3.6121e-01, -1.8767e-01, -2.6445e-02, -9.7664e-01,  1.2358e+00,
        -7.6230e-02, -5.9460e-01,  2.6643e-01,  4.6854e-01,  3.7031e-01,
         7.6821e-01, -2.7297e-01, -6.1425e-01, -1.1155e+00, -2.3452e-01,
        -5.1119e-01, -5.7387e-01, -4.0304e-01,  6.1836e-02, -1.0063e-02,
        -8.2638e-02, -6.5849e-01,  2.7701e-01, -1.9984e-15, -1.9984e-15,
        -6.8725e-01, -5.9373e-01, -8.0888e-01, -1.3837e+00, -3.6370e-01,
        -4.1105e-01, -2.4010e-02, -2.0170e-04, -4.9901e-01,  1.5389e-01,
         1.6645e+00, -1.8019e-01,  2.9992e-01,  8.5526e-01, -1.0712e-01,
         2.5620e-01,  2.3093e-14,  2.4657e-01,  3.6650e-02, -6.6400e-01,
         1.7463e-01,  6.1301e-03, -2.8369e-01,  1.0891e-01, -5.6362e-01,
         1.1633e-01,  2.0681e-02,  2.5606e+00,  6.0114e-01,  2.7374e-01,
        -3.9262e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  1.0000e+00]), tensor([1126]), tensor(-0.1000))
INFO:main_restricted.py:

Create dataloader

INFO:main_restricted.py:Create train and test dataloader
INFO:main_restricted.py:Create retrain and prediction dataloader
INFO:main_restricted.py:

Hyperparameters tuning with Ray Tune

INFO:main_restricted.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018]
INFO:main_restricted.py:Testing data year: 2019
INFO:main_restricted.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 100
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 137
            num_embeddings: 17157
            device: cpu
            
2024-08-08 04:46:27,139	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-08 04:46:27,188	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-08 04:46:27,240	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_26ed888e58593a30.zip' (5.14MiB) to Ray cluster...
2024-08-08 04:46:27,252	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_26ed888e58593a30.zip'.
2024-08-08 04:46:32,393	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-08 06:13:52,176	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-08_04-46-32' in 0.2596s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 137, 'hidden_dim': 145, 'num_layers': 4, 'num_embeddings': 17157, 'embedding_dim': 2, 'dropout_rate': 0.02, 'lr': 5.674093553227247e-05, 'weight_decay': 0.0001037715744189126, 'num_epochs': 50, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.02629776580016167
INFO:model_data_nn.py:Best trial testing loss: 0.03121425088594027
INFO:main_restricted.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main_restricted.py:Best trial directory: /tmp/ray/session_2024-08-08_04-46-24_411031_871373/artifacts/2024-08-08_04-46-32/train_fnn_2024-08-08_04-46-32/driver_artifacts/train_fnn_db833_00044_44_dropout_rate=0.0200,embedding_dim=2,hidden_dim=145,lr=0.0001,num_layers=4,weight_decay=0.0001_2024-08-08_04-46-32
INFO:main_restricted.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019]

            Using the optimized hyperparameters: {'continuous_dim': 137, 'hidden_dim': 145, 'num_layers': 4, 'num_embeddings': 17387, 'embedding_dim': 2, 'dropout_rate': 0.02, 'lr': 5.674093553227247e-05, 'weight_decay': 0.0001037715744189126, 'num_epochs': 50, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.03268518995218454, 'avg_test_loss': 0.08271561459551831}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.03196068198666194, 'avg_test_loss': 0.08391894213546881}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.031430491590090516, 'avg_test_loss': 0.08733990900866095}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.03099028490940251, 'avg_test_loss': 0.08459929863780441}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.030551887574755448, 'avg_test_loss': 0.08347356945757341}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.030178157912605193, 'avg_test_loss': 0.08420200293439607}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.0298213138939735, 'avg_test_loss': 0.0887202643974382}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.029484902607529822, 'avg_test_loss': 0.08518339913887348}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.029193607542518325, 'avg_test_loss': 0.0847000874060866}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.028960146087735696, 'avg_test_loss': 0.0826212971637778}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.028756208723331962, 'avg_test_loss': 0.08830326137638694}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.02858285067240279, 'avg_test_loss': 0.0841948312879941}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.028403886420409502, 'avg_test_loss': 0.08469212452406126}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.028289538804160484, 'avg_test_loss': 0.09460407000386606}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.02815491554925216, 'avg_test_loss': 0.08088266262969632}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.028063305758364004, 'avg_test_loss': 0.08172003422487552}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.027917163389171322, 'avg_test_loss': 0.08723150879539401}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.027856042505764466, 'avg_test_loss': 0.08259921288117766}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.027769611418627087, 'avg_test_loss': 0.08089387040918335}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.027631767158740037, 'avg_test_loss': 0.07925082856499349}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.02757971218807855, 'avg_test_loss': 0.08223377947775734}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.02753534897944786, 'avg_test_loss': 0.08387078123093145}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.027421833720151355, 'avg_test_loss': 0.08155931553353142}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.027396566114021123, 'avg_test_loss': 0.08725460158315616}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.027363669764947397, 'avg_test_loss': 0.08354441258926808}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.027230724629085847, 'avg_test_loss': 0.08948606394681562}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.027187891193124876, 'avg_test_loss': 0.08733611608183148}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.02712341848575042, 'avg_test_loss': 0.08394971674474709}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.027154696862019063, 'avg_test_loss': 0.08426364263001558}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.02703927192271583, 'avg_test_loss': 0.08401313935104289}
INFO:model_data_nn.py:Early stopping at epoch 30
INFO:main_restricted.py:Making prediction for data in year: 2020
INFO:main_restricted.py:Prediction data shape: (38579,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main_restricted.py:352: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main_restricted.py:Root Mean Squared Error for Prediction in 2020: 0.2899841133152059
INFO:main_restricted.py:Prediction Stats:                 ret          pred
count  38579.000000  38579.000000
mean       0.033419      0.022018
std        0.281326      0.084112
min       -0.889030     -0.421954
25%       -0.081633     -0.009451
50%        0.009837      0.020444
75%        0.111111      0.049818
max       14.458016      2.672123

 Configuration for experiment     train_fnn_2024-08-06_13-22-51   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-06_13-22-51
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-06_13-22-46_607612_871373/artifacts/2024-08-06_13-22-51/train_fnn_2024-08-06_13-22-51/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-06_14-03-17   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-06_14-03-17
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-06_14-03-13_305442_871373/artifacts/2024-08-06_14-03-17/train_fnn_2024-08-06_14-03-17/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-06_15-12-42   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-06_15-12-42
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-06_15-12-37_609679_871373/artifacts/2024-08-06_15-12-42/train_fnn_2024-08-06_15-12-42/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-06_16-40-22   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-06_16-40-22
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-06_16-40-17_949704_871373/artifacts/2024-08-06_16-40-22/train_fnn_2024-08-06_16-40-22/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-06_18-05-39   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-06_18-05-39
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-06_18-05-34_720050_871373/artifacts/2024-08-06_18-05-39/train_fnn_2024-08-06_18-05-39/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-06_20-05-58   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-06_20-05-58
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-06_20-05-53_241239_871373/artifacts/2024-08-06_20-05-58/train_fnn_2024-08-06_20-05-58/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-06_23-37-23   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-06_23-37-23
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-06_23-37-16_757829_871373/artifacts/2024-08-06_23-37-23/train_fnn_2024-08-06_23-37-23/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-07_02-33-09   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-07_02-33-09
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-07_02-33-03_817195_871373/artifacts/2024-08-07_02-33-09/train_fnn_2024-08-07_02-33-09/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-07_05-36-55   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-07_05-36-55
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-07_05-36-48_547771_871373/artifacts/2024-08-07_05-36-55/train_fnn_2024-08-07_05-36-55/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-07_08-32-21   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-07_08-32-21
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-07_08-32-15_039252_871373/artifacts/2024-08-07_08-32-21/train_fnn_2024-08-07_08-32-21/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-07_12-33-15   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-07_12-33-15
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-07_12-33-08_497848_871373/artifacts/2024-08-07_12-33-15/train_fnn_2024-08-07_12-33-15/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-07_17-43-53   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-07_17-43-53
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-07_17-43-45_613172_871373/artifacts/2024-08-07_17-43-53/train_fnn_2024-08-07_17-43-53/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-07_22-26-58   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-07_22-26-58
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-07_22-26-50_454589_871373/artifacts/2024-08-07_22-26-58/train_fnn_2024-08-07_22-26-58/driver_artifacts`


 Configuration for experiment     train_fnn_2024-08-08_04-46-32   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 100                             


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-08_04-46-32
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-08-08_04-46-24_411031_871373/artifacts/2024-08-08_04-46-32/train_fnn_2024-08-08_04-46-32/driver_artifacts`

INFO:postprocess_predictions.py:Post processing prediction files
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1985.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1986.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1987.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1988.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1989.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1990.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1991.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1992.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1993.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1994.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1995.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1996.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1997.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1998.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_1999.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2000.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2001.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2002.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2003.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2004.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2005.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2006.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2007.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2008.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2009.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2010.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2011.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2012.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2013.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2014.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2015.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2016.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2017.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2018.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2019.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_restricted/monthly_prediction_2020.csv
INFO:postprocess_predictions.py:Sort the result by date and rank both ascendingly
INFO:postprocess_predictions.py:Saved the result file: result.csv
to the directory: kevin/output/prediction/monthly_new_restricted
