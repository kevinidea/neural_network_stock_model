Current working directory
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml
source kevin/venv/bin/activate
which python3
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/bin/python3
2024-08-23 16:13:11,260	PANIC scripts.py:900 -- `--address` is a required flag unless starting a head node with `--head`.
Error: `{}` is a required flag unless starting a head node with `{}`.
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
INFO:preprocess_data_nn.py:

Loading and preprocessing data...

DEBUG:preprocess_data_nn.py:          date   permno
626    1980-01  10006.0
5399   1980-01  10057.0
11398  1980-01  10137.0
12828  1980-01  10145.0
13984  1980-01  10153.0
DEBUG:preprocess_data_nn.py:--------------------------------------------------
INFO:main.py:preprocessed df: (2005900, 161)
INFO:preprocess_data_nn.py:

Applying secondary data preprocessing..

INFO:main.py:secondary preprocessed df: (1942951, 161)
INFO:main.py:df sample:     permno       pdate        ym  gvkey  sic2    absacc       acc  ...      roea   roavola       ret        mve_m      retq  pyear     date
0  10006.0  1980-01-01  198001.0   1010    37  0.083420  0.083420  ...  0.141715  0.004512  0.211679   303420.750 -0.055806   1980  1980-01
1  10057.0  1980-01-01  198001.0   1098    36  0.088951  0.088951  ...  0.174252  0.035698  0.282297   111423.125 -0.069431   1980  1980-01
2  10137.0  1980-01-01  198001.0   1279    49  0.041008  0.041008  ...  0.097554  0.006254 -0.032258   617349.500 -0.108065   1980  1980-01
3  10145.0  1980-01-01  198001.0   1300    99  0.050486  0.050486  ...  0.122729  0.004320  0.150127  1415193.000 -0.085950   1980  1980-01
4  10153.0  1980-01-01  198001.0   1308    13       NaN       NaN  ...  0.109950  0.009149 -0.122744   429488.500 -0.285199   1980  1980-01

[5 rows x 161 columns]
INFO:main.py:Train year start: 1980
INFO:main.py:Prediction data years: [1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020]
INFO:main.py:

Loop through all the prediction years and build optimized model for each year

INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983]
INFO:transform_data_nn.py:Train_data: (110027, 161)

INFO:transform_data_nn.py:Test data years: [1984]
INFO:transform_data_nn.py:Test_data: (39843, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984]
INFO:transform_data_nn.py:Retrain_data: (149870, 161)

INFO:transform_data_nn.py:Prediction data years: [1985]
INFO:transform_data_nn.py:Prediction_data: (43492, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([110027, 152])
            y_train_tf: torch.Size([110027])

            x_test_tf: torch.Size([39843, 152])
            y_test_tf: torch.Size([39843])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([149870, 152])
            y_retrain_tf: torch.Size([149870])

            x_prediction_tf: torch.Size([43492, 152])
            y_prediction_tf: torch.Size([43492])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983]
INFO:main.py:Testing data year: 1984
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 3605
            device: cpu
            
2024-08-23 16:31:28,822	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 16:31:28,870	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 16:31:28,921	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5e14e6f7dd199c56.zip' (5.23MiB) to Ray cluster...
2024-08-23 16:31:28,935	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5e14e6f7dd199c56.zip'.
2024-08-23 16:31:30,456	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-23 16:41:27,646	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_16-31-30' in 0.4008s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 2, 'num_embeddings': 3605, 'embedding_dim': 10, 'dropout_rate': 0.33, 'lr': 2.4887971903743735e-05, 'weight_decay': 6.491820836730888e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.08382538912266302
INFO:model_data_nn.py:Best trial testing loss: 0.08399965042430746
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_16-31-26_013459_2457762/artifacts/2024-08-23_16-31-30/train_fnn_2024-08-23_16-31-30/driver_artifacts/train_fnn_d34bd_00075_75_batch_size=32,dropout_rate=0.3300,embedding_dim=10,hidden_dim=135,lr=0.0000,num_layers=2,weight_decay=0.0_2024-08-23_16-31-30
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 2, 'num_embeddings': 4258, 'embedding_dim': 10, 'dropout_rate': 0.33, 'lr': 2.4887971903743735e-05, 'weight_decay': 6.491820836730888e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/cuda/__init__.py:619: UserWarning: Can't initialize NVML
  warnings.warn("Can't initialize NVML")
INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.09242244939053897, 'avg_test_loss': 0.09070233048542457}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.08625251015784673, 'avg_test_loss': 0.09038841434042244}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.08574398968010001, 'avg_test_loss': 0.09058353703140336}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.08535243444798621, 'avg_test_loss': 0.09074282453340643}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.08502125728516631, 'avg_test_loss': 0.09125940315425396}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.08484168854640917, 'avg_test_loss': 0.09106558573651402}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.08460810271967, 'avg_test_loss': 0.09145401593516855}
INFO:model_data_nn.py:Early stopping at epoch 7
INFO:main.py:Making prediction for data in year: 1985
INFO:main.py:Prediction data shape: (43492,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1985: 0.13980745638163633
INFO:main.py:Prediction Stats:                 ret          pred
count  43492.000000  43492.000000
mean       0.020246      0.018827
std        0.138818      0.023635
min       -0.850000     -0.148852
25%       -0.049128      0.007359
50%        0.009615      0.023159
75%        0.077179      0.034583
max        3.666667      0.080706
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984]
INFO:transform_data_nn.py:Train_data: (149870, 161)

INFO:transform_data_nn.py:Test data years: [1985]
INFO:transform_data_nn.py:Test_data: (43492, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Retrain_data: (193362, 161)

INFO:transform_data_nn.py:Prediction data years: [1986]
INFO:transform_data_nn.py:Prediction_data: (43785, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([149870, 152])
            y_train_tf: torch.Size([149870])

            x_test_tf: torch.Size([43492, 152])
            y_test_tf: torch.Size([43492])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([193362, 152])
            y_retrain_tf: torch.Size([193362])

            x_prediction_tf: torch.Size([43785, 152])
            y_prediction_tf: torch.Size([43785])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984]
INFO:main.py:Testing data year: 1985
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 4258
            device: cpu
            
2024-08-23 17:05:59,958	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 17:06:00,003	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 17:06:00,050	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_59839a8b5916af4e.zip' (5.16MiB) to Ray cluster...
2024-08-23 17:06:00,065	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_59839a8b5916af4e.zip'.
2024-08-23 17:06:01,504	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-23 17:20:15,654	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_17-06-01' in 0.3502s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 3, 'num_embeddings': 4258, 'embedding_dim': 1, 'dropout_rate': 0.42, 'lr': 7.981463367180082e-06, 'weight_decay': 1.2406602290401242e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.08572528494103149
INFO:model_data_nn.py:Best trial testing loss: 0.09028676940566477
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_17-05-57_550964_2457762/artifacts/2024-08-23_17-06-01/train_fnn_2024-08-23_17-06-01/driver_artifacts/train_fnn_a5c29_00089_89_batch_size=32,dropout_rate=0.4200,embedding_dim=1,hidden_dim=55,lr=0.0000,num_layers=3,weight_decay=0.000_2024-08-23_17-06-02
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 3, 'num_embeddings': 4766, 'embedding_dim': 1, 'dropout_rate': 0.42, 'lr': 7.981463367180082e-06, 'weight_decay': 1.2406602290401242e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.09298332366514032, 'avg_test_loss': 0.09744423793845146}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.08853830140761017, 'avg_test_loss': 0.09744025908078566}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.08815539320292692, 'avg_test_loss': 0.097525111041076}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.08804481702085087, 'avg_test_loss': 0.09756315967858578}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.0880102854818895, 'avg_test_loss': 0.09760259814054274}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.08794383996976148, 'avg_test_loss': 0.09776537662672682}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.08786774479230088, 'avg_test_loss': 0.09837027751807316}
INFO:model_data_nn.py:Early stopping at epoch 7
INFO:main.py:Making prediction for data in year: 1986
INFO:main.py:Prediction data shape: (43785,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1986: 0.14594005688751807
INFO:main.py:Prediction Stats:                 ret          pred
count  43785.000000  43785.000000
mean       0.007006     -0.000947
std        0.144800      0.016130
min       -0.808824     -0.141661
25%       -0.068966     -0.005930
50%        0.000000      0.005114
75%        0.070270      0.009547
max        3.600000      0.041049
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Train_data: (193362, 161)

INFO:transform_data_nn.py:Test data years: [1986]
INFO:transform_data_nn.py:Test_data: (43785, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:transform_data_nn.py:Retrain_data: (237147, 161)

INFO:transform_data_nn.py:Prediction data years: [1987]
INFO:transform_data_nn.py:Prediction_data: (44352, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([193362, 152])
            y_train_tf: torch.Size([193362])

            x_test_tf: torch.Size([43785, 152])
            y_test_tf: torch.Size([43785])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([237147, 152])
            y_retrain_tf: torch.Size([237147])

            x_prediction_tf: torch.Size([44352, 152])
            y_prediction_tf: torch.Size([44352])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:main.py:Testing data year: 1986
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 4766
            device: cpu
            
2024-08-23 17:51:47,657	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 17:51:47,705	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 17:51:47,757	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_59839a8b5916af4e.zip' (5.16MiB) to Ray cluster...
2024-08-23 17:51:47,771	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_59839a8b5916af4e.zip'.
2024-08-23 17:51:49,481	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
[36m(train_fnn pid=3819043)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3819043)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3819042)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3819042)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3819113)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3819113)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3820345)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3820345)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3844165)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3844165)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3831932)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.[32m [repeated 2x across cluster] (Ray deduplicates logs by default. Set RAY_DEDUP_LOGS=0 to disable log deduplication, or see https://docs.ray.io/en/master/ray-observability/user-guides/configure-logging.html#log-deduplication for more options.)[0m
[36m(train_fnn pid=3831932)[0m   return F.l1_loss(input, target, reduction=self.reduction)[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=3844839)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=3844839)[0m   return F.l1_loss(input, target, reduction=self.reduction)[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=3863556)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3863556)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3855995)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3855995)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3863841)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3863841)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3879550)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3879550)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3881185)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3881185)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3893731)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3893731)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3894207)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3894207)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3911745)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3911745)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3893909)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3893909)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3915746)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3915746)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3915127)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3915127)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3918565)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3918565)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3931830)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3931830)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3943627)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3943627)[0m   return F.l1_loss(input, target, reduction=self.reduction)
2024-08-23 18:23:45,074	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_17-51-49' in 0.3149s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 65, 'num_layers': 3, 'num_embeddings': 4766, 'embedding_dim': 10, 'dropout_rate': 0.28, 'lr': 2.4906405708868028e-06, 'weight_decay': 8.286831145615929e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}
INFO:model_data_nn.py:Best trial training loss: 0.08738441211202287
INFO:model_data_nn.py:Best trial testing loss: 0.09672964104714617
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_17-51-45_264603_2457762/artifacts/2024-08-23_17-51-49/train_fnn_2024-08-23_17-51-49/driver_artifacts/train_fnn_0bae9_00043_43_batch_size=128,dropout_rate=0.2800,embedding_dim=10,hidden_dim=65,lr=0.0000,num_layers=3,weight_decay=0.0_2024-08-23_17-51-49
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 65, 'num_layers': 3, 'num_embeddings': 5109, 'embedding_dim': 10, 'dropout_rate': 0.28, 'lr': 2.4906405708868028e-06, 'weight_decay': 8.286831145615929e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.09598510915143958, 'avg_test_loss': 0.11974235641252066}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.09363749100712025, 'avg_test_loss': 0.11922852376137756}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.09229295569638969, 'avg_test_loss': 0.11913676657620012}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.09146937168732318, 'avg_test_loss': 0.11855524427308473}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.09087443880769011, 'avg_test_loss': 0.11845649903377126}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.09051690574888277, 'avg_test_loss': 0.11844648055796664}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.09027041255076039, 'avg_test_loss': 0.11818696729173234}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.09006572795174936, 'avg_test_loss': 0.11813448399563001}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.08993472986035934, 'avg_test_loss': 0.11815248436216662}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.08981575227903753, 'avg_test_loss': 0.11778105767470616}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.08974844247875152, 'avg_test_loss': 0.11786367771046649}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.08966937091515337, 'avg_test_loss': 0.11777853160581259}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.08962607737550146, 'avg_test_loss': 0.11771005237480406}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.08956841372967281, 'avg_test_loss': 0.1178369395413385}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.08951876996000564, 'avg_test_loss': 0.11783994126646251}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.08951298675658764, 'avg_test_loss': 0.11776034605906745}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.08944679121637705, 'avg_test_loss': 0.1177698267188986}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.08945054698083751, 'avg_test_loss': 0.1177520040497828}
INFO:model_data_nn.py:Early stopping at epoch 18
INFO:main.py:Making prediction for data in year: 1987
INFO:main.py:Prediction data shape: (44352,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1987: 0.1725108906362074
INFO:main.py:Prediction Stats:                 ret          pred
count  44352.000000  44352.000000
mean      -0.003042     -0.002044
std        0.172848      0.010868
min       -0.875000     -0.073713
25%       -0.079210     -0.005439
50%        0.000000      0.000804
75%        0.077401      0.004630
max        2.750000      0.037053
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:transform_data_nn.py:Train_data: (237147, 161)

INFO:transform_data_nn.py:Test data years: [1987]
INFO:transform_data_nn.py:Test_data: (44352, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:transform_data_nn.py:Retrain_data: (281499, 161)

INFO:transform_data_nn.py:Prediction data years: [1988]
INFO:transform_data_nn.py:Prediction_data: (46885, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([237147, 152])
            y_train_tf: torch.Size([237147])

            x_test_tf: torch.Size([44352, 152])
            y_test_tf: torch.Size([44352])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([281499, 152])
            y_retrain_tf: torch.Size([281499])

            x_prediction_tf: torch.Size([46885, 152])
            y_prediction_tf: torch.Size([46885])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:main.py:Testing data year: 1987
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 5109
            device: cpu
            
2024-08-23 19:02:55,056	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 19:02:55,112	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 19:02:55,171	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-23 19:02:55,186	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-23 19:02:56,714	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-23 19:23:17,433	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_19-02-56' in 0.4434s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 75, 'num_layers': 4, 'num_embeddings': 5109, 'embedding_dim': 1, 'dropout_rate': 0.34, 'lr': 2.2374256001123632e-06, 'weight_decay': 0.0006840679663108072, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.08951550910146291
INFO:model_data_nn.py:Best trial testing loss: 0.11749134340134018
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_19-02-52_723840_2457762/artifacts/2024-08-23_19-02-56/train_fnn_2024-08-23_19-02-56/driver_artifacts/train_fnn_fb26a_00111_111_batch_size=32,dropout_rate=0.3400,embedding_dim=1,hidden_dim=75,lr=0.0000,num_layers=4,weight_decay=0.00_2024-08-23_19-02-57
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 75, 'num_layers': 4, 'num_embeddings': 5697, 'embedding_dim': 1, 'dropout_rate': 0.34, 'lr': 2.2374256001123632e-06, 'weight_decay': 0.0006840679663108072, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10488814631161052, 'avg_test_loss': 0.09427870185677302}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.09772389546577133, 'avg_test_loss': 0.09335286957484963}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.09562941956180925, 'avg_test_loss': 0.09316556822981223}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.09481457443530923, 'avg_test_loss': 0.09314068588256673}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.09449382225689344, 'avg_test_loss': 0.09314283028773526}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.09431841513400338, 'avg_test_loss': 0.09315768499206879}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.09423155846856043, 'avg_test_loss': 0.09320793104438063}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.09420336432341637, 'avg_test_loss': 0.09319057341253367}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.09416296182385815, 'avg_test_loss': 0.09316633537025439}
INFO:model_data_nn.py:Early stopping at epoch 9
INFO:main.py:Making prediction for data in year: 1988
INFO:main.py:Prediction data shape: (46885,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1988: 0.14777509401764594
INFO:main.py:Prediction Stats:                 ret          pred
count  46885.000000  46885.000000
mean       0.017541      0.006252
std        0.147384      0.005696
min       -0.847619     -0.099088
25%       -0.052632      0.003900
50%        0.000000      0.007819
75%        0.070922      0.010180
max        5.562500      0.014499
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:transform_data_nn.py:Train_data: (281499, 161)

INFO:transform_data_nn.py:Test data years: [1988]
INFO:transform_data_nn.py:Test_data: (46885, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:transform_data_nn.py:Retrain_data: (328384, 161)

INFO:transform_data_nn.py:Prediction data years: [1989]
INFO:transform_data_nn.py:Prediction_data: (47501, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([281499, 152])
            y_train_tf: torch.Size([281499])

            x_test_tf: torch.Size([46885, 152])
            y_test_tf: torch.Size([46885])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([328384, 152])
            y_retrain_tf: torch.Size([328384])

            x_prediction_tf: torch.Size([47501, 152])
            y_prediction_tf: torch.Size([47501])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:main.py:Testing data year: 1988
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 5697
            device: cpu
            
2024-08-23 20:09:42,203	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 20:09:42,251	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 20:09:42,302	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-23 20:09:42,316	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-23 20:09:43,929	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-23 20:53:18,481	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_20-09-43' in 0.3447s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 4, 'num_embeddings': 5697, 'embedding_dim': 7, 'dropout_rate': 0.43, 'lr': 5.007204585568977e-06, 'weight_decay': 3.916500311149412e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 8}
INFO:model_data_nn.py:Best trial training loss: 0.09402575410474674
INFO:model_data_nn.py:Best trial testing loss: 0.09314793490179772
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_20-09-39_817292_2457762/artifacts/2024-08-23_20-09-43/train_fnn_2024-08-23_20-09-43/driver_artifacts/train_fnn_4fa33_00112_112_batch_size=8,dropout_rate=0.4300,embedding_dim=7,hidden_dim=45,lr=0.0000,num_layers=4,weight_decay=0.000_2024-08-23_20-09-44
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 4, 'num_embeddings': 6283, 'embedding_dim': 7, 'dropout_rate': 0.43, 'lr': 5.007204585568977e-06, 'weight_decay': 3.916500311149412e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 8}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.09613606311658844, 'avg_test_loss': 0.09362359219517731}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.09422620961672562, 'avg_test_loss': 0.09357176036798229}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.0942112484699904, 'avg_test_loss': 0.09356731493791402}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.09419702539417207, 'avg_test_loss': 0.0936125464147379}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.0941642707974645, 'avg_test_loss': 0.09352701242464827}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.09414298351644625, 'avg_test_loss': 0.09350211826460822}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.09411239557731821, 'avg_test_loss': 0.09344865596527281}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.09406586201971585, 'avg_test_loss': 0.09340050449166992}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.0940228051896817, 'avg_test_loss': 0.09344190718689555}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.09398815511945287, 'avg_test_loss': 0.09349086687926161}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.0939277883101225, 'avg_test_loss': 0.0933168703652843}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.09391364279000552, 'avg_test_loss': 0.09327870167154441}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.09387203730672564, 'avg_test_loss': 0.09325143954794729}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.09386194569194939, 'avg_test_loss': 0.09326898317445921}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.09379635141996634, 'avg_test_loss': 0.09332761509640725}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.093758694811425, 'avg_test_loss': 0.093285119554681}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.09372643557899633, 'avg_test_loss': 0.09323958825692033}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.09367490615805074, 'avg_test_loss': 0.09326462481364121}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.09363994608073992, 'avg_test_loss': 0.09321523550050895}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.09359584863236291, 'avg_test_loss': 0.09313141111298297}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.09363109909048473, 'avg_test_loss': 0.09318817804171335}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.0935482083034508, 'avg_test_loss': 0.0932089930211102}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.09352279026562262, 'avg_test_loss': 0.09303281878918891}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.09350847165459483, 'avg_test_loss': 0.093101508552494}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.0935043640457612, 'avg_test_loss': 0.09302819423511142}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.09348420743270819, 'avg_test_loss': 0.09310099282187469}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.09341228232962498, 'avg_test_loss': 0.09304056550668155}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.0934049490236134, 'avg_test_loss': 0.09301545275764213}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.09339130869104131, 'avg_test_loss': 0.0930902441074578}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.09334547283247065, 'avg_test_loss': 0.09296672768171271}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.09329695370101558, 'avg_test_loss': 0.09293186056163223}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.09331048384397846, 'avg_test_loss': 0.09299674681138465}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.09326222370929735, 'avg_test_loss': 0.09291009214694486}
INFO:model_data_nn.py:Epoch 34/50, metrics: {'avg_train_loss': 0.09326090663578471, 'avg_test_loss': 0.09294186698858782}
INFO:model_data_nn.py:Epoch 35/50, metrics: {'avg_train_loss': 0.0932427689724329, 'avg_test_loss': 0.09295113836865246}
INFO:model_data_nn.py:Epoch 36/50, metrics: {'avg_train_loss': 0.09323209728061851, 'avg_test_loss': 0.09289801524670994}
INFO:model_data_nn.py:Epoch 37/50, metrics: {'avg_train_loss': 0.09316866234824939, 'avg_test_loss': 0.09296900836130402}
INFO:model_data_nn.py:Epoch 38/50, metrics: {'avg_train_loss': 0.09318338565904934, 'avg_test_loss': 0.09291387432947774}
INFO:model_data_nn.py:Epoch 39/50, metrics: {'avg_train_loss': 0.09316133314731295, 'avg_test_loss': 0.09287550152489918}
INFO:model_data_nn.py:Epoch 40/50, metrics: {'avg_train_loss': 0.09311595084281343, 'avg_test_loss': 0.09286898378039368}
INFO:model_data_nn.py:Epoch 41/50, metrics: {'avg_train_loss': 0.09312635149870357, 'avg_test_loss': 0.09289490650560106}
INFO:model_data_nn.py:Epoch 42/50, metrics: {'avg_train_loss': 0.0930865787948585, 'avg_test_loss': 0.09292783778607494}
INFO:model_data_nn.py:Epoch 43/50, metrics: {'avg_train_loss': 0.09309354065032122, 'avg_test_loss': 0.09285154155527363}
INFO:model_data_nn.py:Epoch 44/50, metrics: {'avg_train_loss': 0.09304563380067954, 'avg_test_loss': 0.09289141906454843}
INFO:model_data_nn.py:Epoch 45/50, metrics: {'avg_train_loss': 0.09302642852018214, 'avg_test_loss': 0.0928629767623347}
INFO:model_data_nn.py:Epoch 46/50, metrics: {'avg_train_loss': 0.09304657407775009, 'avg_test_loss': 0.09285345217216172}
INFO:model_data_nn.py:Epoch 47/50, metrics: {'avg_train_loss': 0.09302926743011926, 'avg_test_loss': 0.09291473504531665}
INFO:model_data_nn.py:Epoch 48/50, metrics: {'avg_train_loss': 0.09301603657999019, 'avg_test_loss': 0.09290795573750156}
INFO:model_data_nn.py:Early stopping at epoch 48
INFO:main.py:Making prediction for data in year: 1989
INFO:main.py:Prediction data shape: (47501,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1989: 0.15396193321932516
INFO:main.py:Prediction Stats:                 ret          pred
count  47501.000000  47501.000000
mean       0.011252     -0.004711
std        0.153399      0.018585
min       -0.900000     -0.175321
25%       -0.055556     -0.010335
50%        0.000000      0.001509
75%        0.066140      0.006803
max        6.384615      0.031150
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:transform_data_nn.py:Train_data: (328384, 161)

INFO:transform_data_nn.py:Test data years: [1989]
INFO:transform_data_nn.py:Test_data: (47501, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:transform_data_nn.py:Retrain_data: (375885, 161)

INFO:transform_data_nn.py:Prediction data years: [1990]
INFO:transform_data_nn.py:Prediction_data: (46774, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([328384, 152])
            y_train_tf: torch.Size([328384])

            x_test_tf: torch.Size([47501, 152])
            y_test_tf: torch.Size([47501])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([375885, 152])
            y_retrain_tf: torch.Size([375885])

            x_prediction_tf: torch.Size([46774, 152])
            y_prediction_tf: torch.Size([46774])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:main.py:Testing data year: 1989
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 6283
            device: cpu
            
2024-08-23 23:31:32,526	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-23 23:31:32,579	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-23 23:31:32,634	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-23 23:31:32,647	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-23 23:31:34,271	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 00:19:02,445	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-23_23-31-34' in 0.4370s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 145, 'num_layers': 3, 'num_embeddings': 6283, 'embedding_dim': 6, 'dropout_rate': 0.46, 'lr': 7.050588972347781e-06, 'weight_decay': 1.0772976160614845e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.09256079241915117
INFO:model_data_nn.py:Best trial testing loss: 0.09297470255231215
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-23_23-31-30_136548_2457762/artifacts/2024-08-23_23-31-34/train_fnn_2024-08-23_23-31-34/driver_artifacts/train_fnn_81f6c_00122_122_batch_size=32,dropout_rate=0.4600,embedding_dim=6,hidden_dim=145,lr=0.0000,num_layers=3,weight_decay=0.0_2024-08-23_23-31-35
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 145, 'num_layers': 3, 'num_embeddings': 6562, 'embedding_dim': 6, 'dropout_rate': 0.46, 'lr': 7.050588972347781e-06, 'weight_decay': 1.0772976160614845e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10314831714782209, 'avg_test_loss': 0.11774093047212478}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.0941441318496907, 'avg_test_loss': 0.11812679618393185}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.09390404577311981, 'avg_test_loss': 0.11793452860830828}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.09380081471036082, 'avg_test_loss': 0.11791574521048859}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.09369625767260643, 'avg_test_loss': 0.11761698930711573}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.09360231108178216, 'avg_test_loss': 0.11744796527006884}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.09350516755503668, 'avg_test_loss': 0.11750446044153212}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.09341791591156834, 'avg_test_loss': 0.11767888382566448}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.09333377695556304, 'avg_test_loss': 0.11775917190900416}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.09322755804411317, 'avg_test_loss': 0.11752325305065443}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.09315322437725622, 'avg_test_loss': 0.11731505343529985}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.09311558106600497, 'avg_test_loss': 0.11740288507351308}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.09302181920245044, 'avg_test_loss': 0.11717020333190378}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.09299473873395571, 'avg_test_loss': 0.11720478283967593}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.09294993053375153, 'avg_test_loss': 0.11753086509786943}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.09285811077509688, 'avg_test_loss': 0.11752086319284138}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.09280586821259733, 'avg_test_loss': 0.11729561806326444}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.09275257765673381, 'avg_test_loss': 0.1175991185315249}
INFO:model_data_nn.py:Early stopping at epoch 18
INFO:main.py:Making prediction for data in year: 1990
INFO:main.py:Prediction data shape: (46774,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1990: 0.17777447373383645
INFO:main.py:Prediction Stats:                 ret          pred
count  46774.000000  46774.000000
mean      -0.017088      0.004686
std        0.177055      0.017793
min       -0.916667     -0.123738
25%       -0.103448     -0.004023
50%       -0.017544      0.008440
75%        0.054461      0.016567
max        3.400000      0.044850
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:transform_data_nn.py:Train_data: (375885, 161)

INFO:transform_data_nn.py:Test data years: [1990]
INFO:transform_data_nn.py:Test_data: (46774, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:transform_data_nn.py:Retrain_data: (422659, 161)

INFO:transform_data_nn.py:Prediction data years: [1991]
INFO:transform_data_nn.py:Prediction_data: (47150, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([375885, 152])
            y_train_tf: torch.Size([375885])

            x_test_tf: torch.Size([46774, 152])
            y_test_tf: torch.Size([46774])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([422659, 152])
            y_retrain_tf: torch.Size([422659])

            x_prediction_tf: torch.Size([47150, 152])
            y_prediction_tf: torch.Size([47150])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:main.py:Testing data year: 1990
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 6562
            device: cpu
            
2024-08-24 01:23:55,946	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 01:23:55,993	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 01:23:56,046	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-24 01:23:56,058	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-24 01:23:57,985	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 02:06:35,263	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_01-23-57' in 0.3823s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 2, 'num_embeddings': 6562, 'embedding_dim': 2, 'dropout_rate': 0.31, 'lr': 7.27389749647455e-06, 'weight_decay': 2.40639741081584e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.09270806823711714
INFO:model_data_nn.py:Best trial testing loss: 0.11697282964203165
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_01-23-53_606167_2457762/artifacts/2024-08-24_01-23-57/train_fnn_2024-08-24_01-23-57/driver_artifacts/train_fnn_3587c_00111_111_batch_size=32,dropout_rate=0.3100,embedding_dim=2,hidden_dim=135,lr=0.0000,num_layers=2,weight_decay=0.0_2024-08-24_01-23-58
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 2, 'num_embeddings': 6817, 'embedding_dim': 2, 'dropout_rate': 0.31, 'lr': 7.27389749647455e-06, 'weight_decay': 2.40639741081584e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10258630637659368, 'avg_test_loss': 0.12589684772473259}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.09631002731570497, 'avg_test_loss': 0.1254361104978352}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.09593807866905157, 'avg_test_loss': 0.12497815102328681}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.09576142443059693, 'avg_test_loss': 0.1252321644232506}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.09558987026348223, 'avg_test_loss': 0.1251372103345564}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.09546272133362521, 'avg_test_loss': 0.1259063840407772}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.09536321320374136, 'avg_test_loss': 0.12517959302546536}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.09524878892547782, 'avg_test_loss': 0.1248339967198134}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.09512214161803115, 'avg_test_loss': 0.12543819202779916}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.09511038051976815, 'avg_test_loss': 0.12501262844094105}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.09498529820908864, 'avg_test_loss': 0.1253243943491857}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.09491073475391358, 'avg_test_loss': 0.1259052404903856}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.09482490755493518, 'avg_test_loss': 0.12544568635907474}
INFO:model_data_nn.py:Early stopping at epoch 13
INFO:main.py:Making prediction for data in year: 1991
INFO:main.py:Prediction data shape: (47150,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1991: 0.2230448381631491
INFO:main.py:Prediction Stats:                 ret          pred
count  47150.000000  47150.000000
mean       0.038270     -0.016363
std        0.216332      0.028053
min       -0.937500     -0.232276
25%       -0.058140     -0.031667
50%        0.011494     -0.013621
75%        0.100000      0.001928
max        9.000000      0.067480
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:transform_data_nn.py:Train_data: (422659, 161)

INFO:transform_data_nn.py:Test data years: [1991]
INFO:transform_data_nn.py:Test_data: (47150, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:transform_data_nn.py:Retrain_data: (469809, 161)

INFO:transform_data_nn.py:Prediction data years: [1992]
INFO:transform_data_nn.py:Prediction_data: (47572, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([422659, 152])
            y_train_tf: torch.Size([422659])

            x_test_tf: torch.Size([47150, 152])
            y_test_tf: torch.Size([47150])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([469809, 152])
            y_retrain_tf: torch.Size([469809])

            x_prediction_tf: torch.Size([47572, 152])
            y_prediction_tf: torch.Size([47572])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:main.py:Testing data year: 1991
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 6817
            device: cpu
            
2024-08-24 03:11:47,333	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 03:11:47,390	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 03:11:47,448	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-24 03:11:47,461	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-24 03:11:49,615	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 05:05:01,209	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_03-11-49' in 0.3515s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 175, 'num_layers': 5, 'num_embeddings': 6817, 'embedding_dim': 2, 'dropout_rate': 0.38, 'lr': 9.1595938819971e-06, 'weight_decay': 1.048548171612637e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}
INFO:model_data_nn.py:Best trial training loss: 0.09504214729917722
INFO:model_data_nn.py:Best trial testing loss: 0.12349762955524374
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_03-11-44_833546_2457762/artifacts/2024-08-24_03-11-49/train_fnn_2024-08-24_03-11-49/driver_artifacts/train_fnn_46ec2_00007_7_batch_size=16,dropout_rate=0.3800,embedding_dim=2,hidden_dim=175,lr=0.0000,num_layers=5,weight_decay=0.000_2024-08-24_03-11-49
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 175, 'num_layers': 5, 'num_embeddings': 7144, 'embedding_dim': 2, 'dropout_rate': 0.38, 'lr': 9.1595938819971e-06, 'weight_decay': 1.048548171612637e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10444064415874332, 'avg_test_loss': 0.1124361168590663}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.09946271006841438, 'avg_test_loss': 0.11240949864150417}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.09928738493740669, 'avg_test_loss': 0.11222633794601443}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.09911193519491199, 'avg_test_loss': 0.1121583330215136}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.09893110630570638, 'avg_test_loss': 0.11218487512553267}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.09874854107642912, 'avg_test_loss': 0.11200061940889312}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.0986319714356283, 'avg_test_loss': 0.11195245827407287}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.09847344003064101, 'avg_test_loss': 0.1119382471715494}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.09839651406749388, 'avg_test_loss': 0.11189176732450022}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.09827822148652726, 'avg_test_loss': 0.1118075466059053}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.09819810774433718, 'avg_test_loss': 0.1118263042160506}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.09809102417670064, 'avg_test_loss': 0.11179208458747612}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.09801278006748125, 'avg_test_loss': 0.11187436392752513}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.09793397433297375, 'avg_test_loss': 0.11182229323080906}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.09784419788864399, 'avg_test_loss': 0.11189970254983249}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.09778339468243144, 'avg_test_loss': 0.11193008687116691}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.09769462317198375, 'avg_test_loss': 0.11202556032514564}
INFO:model_data_nn.py:Early stopping at epoch 17
INFO:main.py:Making prediction for data in year: 1992
INFO:main.py:Prediction data shape: (47572,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1992: 0.19893840993133982
INFO:main.py:Prediction Stats:                 ret          pred
count  47572.000000  47572.000000
mean       0.021557     -0.002391
std        0.196838      0.024402
min       -0.958333     -0.190530
25%       -0.064271     -0.005520
50%        0.000000      0.002507
75%        0.078377      0.006690
max        5.769231      0.195907
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:transform_data_nn.py:Train_data: (469809, 161)

INFO:transform_data_nn.py:Test data years: [1992]
INFO:transform_data_nn.py:Test_data: (47572, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Retrain_data: (517381, 161)

INFO:transform_data_nn.py:Prediction data years: [1993]
INFO:transform_data_nn.py:Prediction_data: (50974, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([469809, 152])
            y_train_tf: torch.Size([469809])

            x_test_tf: torch.Size([47572, 152])
            y_test_tf: torch.Size([47572])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([517381, 152])
            y_retrain_tf: torch.Size([517381])

            x_prediction_tf: torch.Size([50974, 152])
            y_prediction_tf: torch.Size([50974])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:main.py:Testing data year: 1992
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 7144
            device: cpu
            
2024-08-24 06:47:32,259	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 06:47:32,307	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 06:47:32,357	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-24 06:47:32,369	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-24 06:47:34,373	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 07:57:50,711	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_06-47-34' in 0.3449s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 35, 'num_layers': 3, 'num_embeddings': 7144, 'embedding_dim': 8, 'dropout_rate': 0.4, 'lr': 1.1060721029662158e-05, 'weight_decay': 0.0001053479365130609, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.09740221164864316
INFO:model_data_nn.py:Best trial testing loss: 0.111563761378485
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_06-47-29_832351_2457762/artifacts/2024-08-24_06-47-34/train_fnn_2024-08-24_06-47-34/driver_artifacts/train_fnn_6a997_00012_12_batch_size=32,dropout_rate=0.4000,embedding_dim=8,hidden_dim=35,lr=0.0000,num_layers=3,weight_decay=0.000_2024-08-24_06-47-34
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 35, 'num_layers': 3, 'num_embeddings': 7524, 'embedding_dim': 8, 'dropout_rate': 0.4, 'lr': 1.1060721029662158e-05, 'weight_decay': 0.0001053479365130609, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10144087866032547, 'avg_test_loss': 0.10330121074870406}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10059114635766718, 'avg_test_loss': 0.10325822058763433}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10049406671804412, 'avg_test_loss': 0.10322680179092844}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10039582314870178, 'avg_test_loss': 0.1032100142460908}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10028393577138227, 'avg_test_loss': 0.10321309252853147}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10014845464053254, 'avg_test_loss': 0.10319073525376089}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10005187181403832, 'avg_test_loss': 0.10310212288423672}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.0999517770613581, 'avg_test_loss': 0.10309116717261933}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.0998019404579848, 'avg_test_loss': 0.10304042068120076}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.09971394065656007, 'avg_test_loss': 0.10303240151794094}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.09963116372111984, 'avg_test_loss': 0.10299179616939026}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.09951030921268396, 'avg_test_loss': 0.10309766862267829}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.09941208471356532, 'avg_test_loss': 0.10307304333598451}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.09932703444667858, 'avg_test_loss': 0.10308812178404766}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.09929892002641307, 'avg_test_loss': 0.10314624663968544}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.0991746618399532, 'avg_test_loss': 0.1029665848147884}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.09911159225377793, 'avg_test_loss': 0.10294907995630044}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.09903336449686156, 'avg_test_loss': 0.10304319201421977}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.09897732022478771, 'avg_test_loss': 0.1032362793199835}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.09890513164408317, 'avg_test_loss': 0.10308001023686239}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.09889459814774937, 'avg_test_loss': 0.10311398656111578}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.09885327356537082, 'avg_test_loss': 0.1029879216523344}
INFO:model_data_nn.py:Early stopping at epoch 22
INFO:main.py:Making prediction for data in year: 1993
INFO:main.py:Prediction data shape: (50974,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1993: 0.19483473654761868
INFO:main.py:Prediction Stats:                 ret          pred
count  50974.000000  50974.000000
mean       0.018012     -0.005161
std        0.193299      0.017857
min       -0.950000     -0.154754
25%       -0.061224     -0.012359
50%        0.000000     -0.000070
75%        0.075000      0.005337
max       19.000000      0.058580
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Train_data: (517381, 161)

INFO:transform_data_nn.py:Test data years: [1993]
INFO:transform_data_nn.py:Test_data: (50974, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:transform_data_nn.py:Retrain_data: (568355, 161)

INFO:transform_data_nn.py:Prediction data years: [1994]
INFO:transform_data_nn.py:Prediction_data: (56928, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([517381, 152])
            y_train_tf: torch.Size([517381])

            x_test_tf: torch.Size([50974, 152])
            y_test_tf: torch.Size([50974])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([568355, 152])
            y_retrain_tf: torch.Size([568355])

            x_prediction_tf: torch.Size([56928, 152])
            y_prediction_tf: torch.Size([56928])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:main.py:Testing data year: 1993
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 7524
            device: cpu
            
2024-08-24 09:26:04,687	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 09:26:04,742	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 09:26:04,800	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip' (5.16MiB) to Ray cluster...
2024-08-24 09:26:04,812	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_d3e05ccb97f9c442.zip'.
2024-08-24 09:26:07,331	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 11:12:55,482	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_09-26-07' in 0.3921s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 35, 'num_layers': 5, 'num_embeddings': 7524, 'embedding_dim': 4, 'dropout_rate': 0.39, 'lr': 2.398794901173308e-05, 'weight_decay': 2.1588162403667697e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.09862084534108631
INFO:model_data_nn.py:Best trial testing loss: 0.10277360290223446
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_09-26-02_145846_2457762/artifacts/2024-08-24_09-26-07/train_fnn_2024-08-24_09-26-07/driver_artifacts/train_fnn_90c38_00059_59_batch_size=32,dropout_rate=0.3900,embedding_dim=4,hidden_dim=35,lr=0.0000,num_layers=5,weight_decay=0.000_2024-08-24_09-26-08
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 35, 'num_layers': 5, 'num_embeddings': 8135, 'embedding_dim': 4, 'dropout_rate': 0.39, 'lr': 2.398794901173308e-05, 'weight_decay': 2.1588162403667697e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10141212064188702, 'avg_test_loss': 0.09437434877540671}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10093442116319264, 'avg_test_loss': 0.09464081472174346}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10086794939785852, 'avg_test_loss': 0.09476771419464772}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10075938727973677, 'avg_test_loss': 0.0951182951720378}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10066957658997937, 'avg_test_loss': 0.09469640834708272}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.1005299430816441, 'avg_test_loss': 0.0949508484113729}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 1994
INFO:main.py:Prediction data shape: (56928,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1994: 0.15759694397456797
INFO:main.py:Prediction Stats:                 ret          pred
count  56928.000000  56928.000000
mean      -0.002534      0.007076
std        0.157461      0.010719
min       -0.937500     -1.168953
25%       -0.071429      0.004035
50%       -0.005882      0.010115
75%        0.054054      0.011779
max       12.500000      0.012958
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:transform_data_nn.py:Train_data: (568355, 161)

INFO:transform_data_nn.py:Test data years: [1994]
INFO:transform_data_nn.py:Test_data: (56928, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:transform_data_nn.py:Retrain_data: (625283, 161)

INFO:transform_data_nn.py:Prediction data years: [1995]
INFO:transform_data_nn.py:Prediction_data: (64688, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([568355, 152])
            y_train_tf: torch.Size([568355])

            x_test_tf: torch.Size([56928, 152])
            y_test_tf: torch.Size([56928])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([625283, 152])
            y_retrain_tf: torch.Size([625283])

            x_prediction_tf: torch.Size([64688, 152])
            y_prediction_tf: torch.Size([64688])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993]
INFO:main.py:Testing data year: 1994
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 8135
            device: cpu
            
2024-08-24 12:35:20,754	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 12:35:20,810	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 12:35:20,867	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip' (5.16MiB) to Ray cluster...
2024-08-24 12:35:20,880	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip'.
2024-08-24 12:35:23,206	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 12:47:19,705	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 30.20 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
[33m(raylet)[0m [2024-08-24 12:47:48,814 E 1028266 1028266] (raylet) worker_pool.cc:565: Some workers of the worker process(1196403) have not registered within the timeout. The process is still alive, probably it's hanging during start.
2024-08-24 14:15:27,344	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_12-35-23' in 0.3537s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 85, 'num_layers': 1, 'num_embeddings': 8135, 'embedding_dim': 3, 'dropout_rate': 0.33, 'lr': 6.496556932286167e-05, 'weight_decay': 1.7589810358774018e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}
INFO:model_data_nn.py:Best trial training loss: 0.09674675191945589
INFO:model_data_nn.py:Best trial testing loss: 0.09272063737839795
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_12-35-18_201478_2457762/artifacts/2024-08-24_12-35-23/train_fnn_2024-08-24_12-35-23/driver_artifacts/train_fnn_0164c_00141_141_batch_size=128,dropout_rate=0.3300,embedding_dim=3,hidden_dim=85,lr=0.0001,num_layers=1,weight_decay=0.0_2024-08-24_12-35-24
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 85, 'num_layers': 1, 'num_embeddings': 9176, 'embedding_dim': 3, 'dropout_rate': 0.33, 'lr': 6.496556932286167e-05, 'weight_decay': 1.7589810358774018e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.1000919934747285, 'avg_test_loss': 0.10128712018752993}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.09882246182207685, 'avg_test_loss': 0.1016063788250501}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.09844397464757566, 'avg_test_loss': 0.10146660367284603}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.09814042917232553, 'avg_test_loss': 0.10320075794229866}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.09788243790579428, 'avg_test_loss': 0.10240281425534266}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.09768643004775901, 'avg_test_loss': 0.10363526586369563}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 1995
INFO:main.py:Prediction data shape: (64688,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1995: 0.17064456018977595
INFO:main.py:Prediction Stats:                 ret          pred
count  64688.000000  64688.000000
mean       0.023566     -0.020930
std        0.164422      0.029729
min       -0.885714     -0.227978
25%       -0.048029     -0.037420
50%        0.012255     -0.016707
75%        0.078947     -0.001190
max        6.000000      0.109967
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:transform_data_nn.py:Train_data: (625283, 161)

INFO:transform_data_nn.py:Test data years: [1995]
INFO:transform_data_nn.py:Test_data: (64688, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:transform_data_nn.py:Retrain_data: (689971, 161)

INFO:transform_data_nn.py:Prediction data years: [1996]
INFO:transform_data_nn.py:Prediction_data: (66364, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([625283, 152])
            y_train_tf: torch.Size([625283])

            x_test_tf: torch.Size([64688, 152])
            y_test_tf: torch.Size([64688])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([689971, 152])
            y_retrain_tf: torch.Size([689971])

            x_prediction_tf: torch.Size([66364, 152])
            y_prediction_tf: torch.Size([66364])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994]
INFO:main.py:Testing data year: 1995
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 9176
            device: cpu
            
2024-08-24 15:40:36,557	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 15:40:36,605	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 15:40:36,656	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip' (5.16MiB) to Ray cluster...
2024-08-24 15:40:36,670	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip'.
2024-08-24 15:40:39,063	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 20:17:33,760	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_15-40-39' in 0.3628s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 5, 'num_embeddings': 9176, 'embedding_dim': 10, 'dropout_rate': 0.5, 'lr': 1.7198272904257826e-06, 'weight_decay': 2.9634403572353045e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}
INFO:model_data_nn.py:Best trial training loss: 0.09942891379678193
INFO:model_data_nn.py:Best trial testing loss: 0.09914788014444124
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_15-40-34_115229_2457762/artifacts/2024-08-24_15-40-39/train_fnn_2024-08-24_15-40-39/driver_artifacts/train_fnn_e2f5d_00126_126_batch_size=16,dropout_rate=0.5000,embedding_dim=10,hidden_dim=135,lr=0.0000,num_layers=5,weight_decay=0._2024-08-24_15-40-39
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 5, 'num_embeddings': 9990, 'embedding_dim': 10, 'dropout_rate': 0.5, 'lr': 1.7198272904257826e-06, 'weight_decay': 2.9634403572353045e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.11464516543072385, 'avg_test_loss': 0.10439961540567524}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10123492967784599, 'avg_test_loss': 0.10418162725393444}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10035559508704264, 'avg_test_loss': 0.10418444386258606}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1003122978316547, 'avg_test_loss': 0.104181558018588}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10030183767901556, 'avg_test_loss': 0.10415865850779465}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10028781050420221, 'avg_test_loss': 0.10417273783249818}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10027211756517969, 'avg_test_loss': 0.10418916360871182}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10026037751646273, 'avg_test_loss': 0.10418056283485622}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10023358540676731, 'avg_test_loss': 0.10420245056380963}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.1002282459855797, 'avg_test_loss': 0.10423040283321185}
INFO:model_data_nn.py:Early stopping at epoch 10
INFO:main.py:Making prediction for data in year: 1996
INFO:main.py:Prediction data shape: (66364,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1996: 0.16985217725300708
INFO:main.py:Prediction Stats:                 ret          pred
count  66364.000000  66364.000000
mean       0.016258      0.010498
std        0.169806      0.002356
min       -0.909091     -0.015751
25%       -0.058824      0.010296
50%        0.003930      0.011355
75%        0.074962      0.011755
max        7.000000      0.012686
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:transform_data_nn.py:Train_data: (689971, 161)

INFO:transform_data_nn.py:Test data years: [1996]
INFO:transform_data_nn.py:Test_data: (66364, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:transform_data_nn.py:Retrain_data: (756335, 161)

INFO:transform_data_nn.py:Prediction data years: [1997]
INFO:transform_data_nn.py:Prediction_data: (69689, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([689971, 152])
            y_train_tf: torch.Size([689971])

            x_test_tf: torch.Size([66364, 152])
            y_test_tf: torch.Size([66364])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([756335, 152])
            y_retrain_tf: torch.Size([756335])

            x_prediction_tf: torch.Size([69689, 152])
            y_prediction_tf: torch.Size([69689])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995]
INFO:main.py:Testing data year: 1996
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 9990
            device: cpu
            
2024-08-24 22:21:43,721	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-24 22:21:43,771	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-24 22:21:43,822	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip' (5.16MiB) to Ray cluster...
2024-08-24 22:21:43,833	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip'.
2024-08-24 22:21:46,220	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-24 23:23:31,137	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-24_22-21-46' in 0.3440s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 125, 'num_layers': 5, 'num_embeddings': 9990, 'embedding_dim': 3, 'dropout_rate': 0.43, 'lr': 0.00023257419039889323, 'weight_decay': 4.005106079874894e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.09689694802893137
INFO:model_data_nn.py:Best trial testing loss: 0.10345409173256176
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-24_22-21-41_197134_2457762/artifacts/2024-08-24_22-21-46/train_fnn_2024-08-24_22-21-46/driver_artifacts/train_fnn_ec1a8_00006_6_batch_size=32,dropout_rate=0.4300,embedding_dim=3,hidden_dim=125,lr=0.0002,num_layers=5,weight_decay=0.000_2024-08-24_22-21-46
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 125, 'num_layers': 5, 'num_embeddings': 10575, 'embedding_dim': 3, 'dropout_rate': 0.43, 'lr': 0.00023257419039889323, 'weight_decay': 4.005106079874894e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10083378793662665, 'avg_test_loss': 0.1109359685290533}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.09937759689736093, 'avg_test_loss': 0.11035733377172709}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.09869999927154348, 'avg_test_loss': 0.11038824872954435}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.09833190619223638, 'avg_test_loss': 0.11024661036336553}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.09812474061683946, 'avg_test_loss': 0.11103528696629736}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.0979998411669435, 'avg_test_loss': 0.11039858536505721}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.09792250483055459, 'avg_test_loss': 0.11062442630878329}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.0978409824860961, 'avg_test_loss': 0.11052743543394396}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.09782482098077956, 'avg_test_loss': 0.11063775220754171}
INFO:model_data_nn.py:Early stopping at epoch 9
INFO:main.py:Making prediction for data in year: 1997
INFO:main.py:Prediction data shape: (69689,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1997: 0.17683273561568644
INFO:main.py:Prediction Stats:                 ret          pred
count  69689.000000  69689.000000
mean       0.018636     -0.006206
std        0.175911      0.023011
min       -0.937500     -0.219926
25%       -0.063158     -0.011995
50%        0.008772      0.002048
75%        0.086420      0.006520
max        6.076923      0.045874
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:transform_data_nn.py:Train_data: (756335, 161)

INFO:transform_data_nn.py:Test data years: [1997]
INFO:transform_data_nn.py:Test_data: (69689, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:transform_data_nn.py:Retrain_data: (826024, 161)

INFO:transform_data_nn.py:Prediction data years: [1998]
INFO:transform_data_nn.py:Prediction_data: (70794, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([756335, 152])
            y_train_tf: torch.Size([756335])

            x_test_tf: torch.Size([69689, 152])
            y_test_tf: torch.Size([69689])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([826024, 152])
            y_retrain_tf: torch.Size([826024])

            x_prediction_tf: torch.Size([70794, 152])
            y_prediction_tf: torch.Size([70794])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:main.py:Testing data year: 1997
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 10575
            device: cpu
            
2024-08-25 01:21:21,016	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-25 01:21:21,065	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-25 01:21:21,119	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip' (5.16MiB) to Ray cluster...
2024-08-25 01:21:21,132	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip'.
2024-08-25 01:21:24,315	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
[36m(train_fnn pid=1885897)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=1885897)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=1886503)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=1886503)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=1886865)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=1886865)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=1925344)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=1925344)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=1885763)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=1885763)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=1885923)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=1885923)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=1886528)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=1886528)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=1953765)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=1953765)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=1986560)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=1986560)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=1990002)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=1990002)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=1971733)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=1971733)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=1952720)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=1952720)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=1953207)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=1953207)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=1885949)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=1885949)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2078900)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2078900)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2096686)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2096686)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2096930)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2096930)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2140204)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2140204)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2082422)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2082422)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2158546)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2158546)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2178320)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2178320)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2220597)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2220597)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2159287)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2159287)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2236728)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2236728)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2282547)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2282547)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2238830)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2238830)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2264808)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2264808)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2264402)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2264402)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2281993)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2281993)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2281817)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2281817)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=2354956)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=2354956)[0m   return F.l1_loss(input, target, reduction=self.reduction)
2024-08-25 02:12:52,745	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_01-21-24' in 0.4024s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 4, 'num_embeddings': 10575, 'embedding_dim': 2, 'dropout_rate': 0.28, 'lr': 5.698364299312678e-05, 'weight_decay': 1.3725123259897096e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}
INFO:model_data_nn.py:Best trial training loss: 0.09735951427377876
INFO:model_data_nn.py:Best trial testing loss: 0.11016197562654377
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-25_01-21-18_506687_2457762/artifacts/2024-08-25_01-21-24/train_fnn_2024-08-25_01-21-24/driver_artifacts/train_fnn_04594_00098_98_batch_size=256,dropout_rate=0.2800,embedding_dim=2,hidden_dim=135,lr=0.0001,num_layers=4,weight_decay=0.0_2024-08-25_01-21-24
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 135, 'num_layers': 4, 'num_embeddings': 11490, 'embedding_dim': 2, 'dropout_rate': 0.28, 'lr': 5.698364299312678e-05, 'weight_decay': 1.3725123259897096e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10290452901687373, 'avg_test_loss': 0.13512637831996924}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10119594458977924, 'avg_test_loss': 0.13437921338670952}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10081606925282136, 'avg_test_loss': 0.13367921388321405}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10052594685233016, 'avg_test_loss': 0.13368802098053026}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10030559523138509, 'avg_test_loss': 0.13349590380592036}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10010847543993871, 'avg_test_loss': 0.13339781658959302}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.099946420006939, 'avg_test_loss': 0.13349903369530874}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.09978909588200072, 'avg_test_loss': 0.13335290723328985}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.09964004254357754, 'avg_test_loss': 0.13349576227178642}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.09950729160438541, 'avg_test_loss': 0.1330314866310853}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.09935210399232662, 'avg_test_loss': 0.13293702287148912}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.09920695678360404, 'avg_test_loss': 0.13284146029919064}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.09902258306944954, 'avg_test_loss': 0.1327839448025941}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.0988757716675427, 'avg_test_loss': 0.1328796466227473}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.09874152464206663, 'avg_test_loss': 0.1325496402888522}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.09859504189483143, 'avg_test_loss': 0.13235709913048072}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.0984417007680606, 'avg_test_loss': 0.13238730289660636}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.09832090678666958, 'avg_test_loss': 0.13225451942923266}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.09819202081191192, 'avg_test_loss': 0.13230280470546832}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.09802821387582437, 'avg_test_loss': 0.1321237938821531}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.09791971257179329, 'avg_test_loss': 0.1321256029476758}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.09779218412238253, 'avg_test_loss': 0.13199182121009173}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.0977000388843963, 'avg_test_loss': 0.13218548466259822}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.0975654725509627, 'avg_test_loss': 0.13216656306590413}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.09746937414484591, 'avg_test_loss': 0.13227811748908314}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.0973194898726847, 'avg_test_loss': 0.13201406998862428}
INFO:model_data_nn.py:Epoch 27/50, metrics: {'avg_train_loss': 0.09727691363841202, 'avg_test_loss': 0.13194723440744385}
INFO:model_data_nn.py:Epoch 28/50, metrics: {'avg_train_loss': 0.09715861417653393, 'avg_test_loss': 0.13194252499496895}
INFO:model_data_nn.py:Epoch 29/50, metrics: {'avg_train_loss': 0.09706309736606429, 'avg_test_loss': 0.13204570179166347}
INFO:model_data_nn.py:Epoch 30/50, metrics: {'avg_train_loss': 0.09699096977803105, 'avg_test_loss': 0.13202419616147498}
INFO:model_data_nn.py:Epoch 31/50, metrics: {'avg_train_loss': 0.09690311826160437, 'avg_test_loss': 0.13201893379219173}
INFO:model_data_nn.py:Epoch 32/50, metrics: {'avg_train_loss': 0.09679981740740094, 'avg_test_loss': 0.1320520426123151}
INFO:model_data_nn.py:Epoch 33/50, metrics: {'avg_train_loss': 0.09674892678478085, 'avg_test_loss': 0.1320313567073767}
INFO:model_data_nn.py:Early stopping at epoch 33
INFO:main.py:Making prediction for data in year: 1998
INFO:main.py:Prediction data shape: (70794,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1998: 0.22642817357309813
INFO:main.py:Prediction Stats:                 ret          pred
count  70794.000000  70794.000000
mean       0.002258     -0.007737
std        0.229048      0.038306
min       -0.973684     -0.222241
25%       -0.097561     -0.025816
50%       -0.006724     -0.000377
75%        0.080000      0.015133
max       12.666667      0.220340
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:transform_data_nn.py:Train_data: (826024, 161)

INFO:transform_data_nn.py:Test data years: [1998]
INFO:transform_data_nn.py:Test_data: (70794, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Retrain_data: (896818, 161)

INFO:transform_data_nn.py:Prediction data years: [1999]
INFO:transform_data_nn.py:Prediction_data: (67277, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([826024, 152])
            y_train_tf: torch.Size([826024])

            x_test_tf: torch.Size([70794, 152])
            y_test_tf: torch.Size([70794])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([896818, 152])
            y_retrain_tf: torch.Size([896818])

            x_prediction_tf: torch.Size([67277, 152])
            y_prediction_tf: torch.Size([67277])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:main.py:Testing data year: 1998
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 11490
            device: cpu
            
2024-08-25 04:17:09,932	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-25 04:17:09,984	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-25 04:17:10,039	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip' (5.16MiB) to Ray cluster...
2024-08-25 04:17:10,053	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip'.
2024-08-25 04:17:13,770	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-25 05:18:55,214	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_04-17-13' in 0.2963s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 65, 'num_layers': 2, 'num_embeddings': 11490, 'embedding_dim': 4, 'dropout_rate': 0.49, 'lr': 0.000120144091734209, 'weight_decay': 5.6702593661747345e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 64}
INFO:model_data_nn.py:Best trial training loss: 0.09750243380328638
INFO:model_data_nn.py:Best trial testing loss: 0.12867186871687894
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-25_04-17-07_350238_2457762/artifacts/2024-08-25_04-17-13/train_fnn_2024-08-25_04-17-13/driver_artifacts/train_fnn_94506_00091_91_batch_size=64,dropout_rate=0.4900,embedding_dim=4,hidden_dim=65,lr=0.0001,num_layers=2,weight_decay=0.000_2024-08-25_04-17-14
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 65, 'num_layers': 2, 'num_embeddings': 12154, 'embedding_dim': 4, 'dropout_rate': 0.49, 'lr': 0.000120144091734209, 'weight_decay': 5.6702593661747345e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 64}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10405147832754788, 'avg_test_loss': 0.13998056418428856}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10303796986647029, 'avg_test_loss': 0.13997342312857225}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10253247862712055, 'avg_test_loss': 0.14000251316978904}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1020469108445965, 'avg_test_loss': 0.1421984784666293}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10170677570504374, 'avg_test_loss': 0.14234782576900926}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10144896632208761, 'avg_test_loss': 0.14328058839495872}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10126672460517601, 'avg_test_loss': 0.14613835477117917}
INFO:model_data_nn.py:Early stopping at epoch 7
INFO:main.py:Making prediction for data in year: 1999
INFO:main.py:Prediction data shape: (67277,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1999: 0.25912853330182584
INFO:main.py:Prediction Stats:                 ret          pred
count  67277.000000  67277.000000
mean       0.025442     -0.048184
std        0.242779      0.056224
min       -0.959091     -6.251724
25%       -0.087282     -0.077704
50%       -0.005181     -0.042770
75%        0.089806     -0.010666
max        7.000000      0.094164
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Train_data: (896818, 161)

INFO:transform_data_nn.py:Test data years: [1999]
INFO:transform_data_nn.py:Test_data: (67277, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:transform_data_nn.py:Retrain_data: (964095, 161)

INFO:transform_data_nn.py:Prediction data years: [2000]
INFO:transform_data_nn.py:Prediction_data: (64295, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([896818, 152])
            y_train_tf: torch.Size([896818])

            x_test_tf: torch.Size([67277, 152])
            y_test_tf: torch.Size([67277])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([964095, 152])
            y_retrain_tf: torch.Size([964095])

            x_prediction_tf: torch.Size([64295, 152])
            y_prediction_tf: torch.Size([64295])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:main.py:Testing data year: 1999
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 12154
            device: cpu
            
2024-08-25 07:18:51,316	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-25 07:18:51,363	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-25 07:18:51,414	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip' (5.16MiB) to Ray cluster...
2024-08-25 07:18:51,426	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_ab7425f336d1ca13.zip'.
2024-08-25 07:18:54,997	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-25 12:43:58,685	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_07-18-54' in 0.3892s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 4, 'num_embeddings': 12154, 'embedding_dim': 5, 'dropout_rate': 0.28, 'lr': 0.00012706930428292917, 'weight_decay': 5.821208861386001e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.10251124286231561
INFO:model_data_nn.py:Best trial testing loss: 0.13951173168042416
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-25_07-18-48_752996_2457762/artifacts/2024-08-25_07-18-54/train_fnn_2024-08-25_07-18-54/driver_artifacts/train_fnn_f5f3b_00057_57_batch_size=32,dropout_rate=0.2800,embedding_dim=5,hidden_dim=15,lr=0.0001,num_layers=4,weight_decay=0.000_2024-08-25_07-18-55
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 4, 'num_embeddings': 12714, 'embedding_dim': 5, 'dropout_rate': 0.28, 'lr': 0.00012706930428292917, 'weight_decay': 5.821208861386001e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10662343604382274, 'avg_test_loss': 0.16065010089631104}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10611317784489872, 'avg_test_loss': 0.1600962876550742}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10580940415029402, 'avg_test_loss': 0.1611015697524174}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10555243676975154, 'avg_test_loss': 0.16076699822436813}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10537154614578167, 'avg_test_loss': 0.16119286679658132}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10519989311119371, 'avg_test_loss': 0.1605311994528889}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10507619374842475, 'avg_test_loss': 0.16067037050663238}
INFO:model_data_nn.py:Early stopping at epoch 7
INFO:main.py:Making prediction for data in year: 2000
INFO:main.py:Prediction data shape: (64295,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2000: 0.26121752232871315
INFO:main.py:Prediction Stats:                 ret          pred
count  64295.000000  64295.000000
mean      -0.001434     -0.007402
std        0.261681      0.027728
min       -0.961538     -2.036021
25%       -0.124228     -0.016025
50%       -0.013216     -0.001584
75%        0.086957      0.005167
max       10.344000      0.062517
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:transform_data_nn.py:Train_data: (964095, 161)

INFO:transform_data_nn.py:Test data years: [2000]
INFO:transform_data_nn.py:Test_data: (64295, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:transform_data_nn.py:Retrain_data: (1028390, 161)

INFO:transform_data_nn.py:Prediction data years: [2001]
INFO:transform_data_nn.py:Prediction_data: (62104, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([964095, 152])
            y_train_tf: torch.Size([964095])

            x_test_tf: torch.Size([64295, 152])
            y_test_tf: torch.Size([64295])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([1028390, 152])
            y_retrain_tf: torch.Size([1028390])

            x_prediction_tf: torch.Size([62104, 152])
            y_prediction_tf: torch.Size([62104])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:main.py:Testing data year: 2000
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 12714
            device: cpu
            
2024-08-25 15:00:51,615	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-25 15:00:51,663	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-25 15:00:51,712	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip' (5.16MiB) to Ray cluster...
2024-08-25 15:00:51,724	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip'.
2024-08-25 15:00:55,459	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-25 18:01:00,156	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_15-00-55' in 0.3564s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 165, 'num_layers': 1, 'num_embeddings': 12714, 'embedding_dim': 9, 'dropout_rate': 0.36, 'lr': 9.261738494446737e-06, 'weight_decay': 5.773031906874289e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}
INFO:model_data_nn.py:Best trial training loss: 0.10490029777818555
INFO:model_data_nn.py:Best trial testing loss: 0.15956002787851672
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-25_15-00-49_058002_2457762/artifacts/2024-08-25_15-00-55/train_fnn_2024-08-25_15-00-55/driver_artifacts/train_fnn_80a26_00039_39_batch_size=128,dropout_rate=0.3600,embedding_dim=9,hidden_dim=165,lr=0.0000,num_layers=1,weight_decay=0.0_2024-08-25_15-00-55
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 165, 'num_layers': 1, 'num_embeddings': 13269, 'embedding_dim': 9, 'dropout_rate': 0.36, 'lr': 9.261738494446737e-06, 'weight_decay': 5.773031906874289e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.11465662426250563, 'avg_test_loss': 0.1583841797194363}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.1093954670629915, 'avg_test_loss': 0.15856493367150487}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10918143759594054, 'avg_test_loss': 0.1580100612477265}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10904226941305784, 'avg_test_loss': 0.15834074991720695}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10893821275802522, 'avg_test_loss': 0.15771893526852868}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10881156818132096, 'avg_test_loss': 0.1579140224359899}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10873751259759673, 'avg_test_loss': 0.15770656682949497}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10864643310955992, 'avg_test_loss': 0.15787413445734438}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10857327779134114, 'avg_test_loss': 0.15763674110726075}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.1085136237496059, 'avg_test_loss': 0.15800935394080823}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10844735336509219, 'avg_test_loss': 0.15787242610513427}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10839160830468748, 'avg_test_loss': 0.15794912340127146}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10832893831355375, 'avg_test_loss': 0.15787751020656693}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.1082548859877197, 'avg_test_loss': 0.158055422551654}
INFO:model_data_nn.py:Early stopping at epoch 14
INFO:main.py:Making prediction for data in year: 2001
INFO:main.py:Prediction data shape: (62104,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2001: 0.2770729477696176
INFO:main.py:Prediction Stats:                 ret          pred
count  62104.000000  62104.000000
mean       0.028327     -0.007532
std        0.270550      0.051124
min       -0.981295     -0.422035
25%       -0.090273     -0.028133
50%        0.005234      0.007206
75%        0.102421      0.026344
max        8.666667      0.101307
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:transform_data_nn.py:Train_data: (1028390, 161)

INFO:transform_data_nn.py:Test data years: [2001]
INFO:transform_data_nn.py:Test_data: (62104, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:transform_data_nn.py:Retrain_data: (1090494, 161)

INFO:transform_data_nn.py:Prediction data years: [2002]
INFO:transform_data_nn.py:Prediction_data: (59934, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([1028390, 152])
            y_train_tf: torch.Size([1028390])

            x_test_tf: torch.Size([62104, 152])
            y_test_tf: torch.Size([62104])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([1090494, 152])
            y_retrain_tf: torch.Size([1090494])

            x_prediction_tf: torch.Size([59934, 152])
            y_prediction_tf: torch.Size([59934])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:main.py:Testing data year: 2001
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 13269
            device: cpu
            
2024-08-25 20:18:10,709	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-25 20:18:10,756	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-25 20:18:10,807	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip' (5.16MiB) to Ray cluster...
2024-08-25 20:18:10,820	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip'.
2024-08-25 20:18:14,632	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-25 21:58:55,381	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-25_20-18-14' in 0.3639s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 195, 'num_layers': 1, 'num_embeddings': 13269, 'embedding_dim': 10, 'dropout_rate': 0.32, 'lr': 7.380204547098562e-06, 'weight_decay': 9.045632816984079e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}
INFO:model_data_nn.py:Best trial training loss: 0.10864687913169545
INFO:model_data_nn.py:Best trial testing loss: 0.15781146123882675
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-25_20-18-08_256096_2457762/artifacts/2024-08-25_20-18-14/train_fnn_2024-08-25_20-18-14/driver_artifacts/train_fnn_d4ddd_00057_57_batch_size=128,dropout_rate=0.3200,embedding_dim=10,hidden_dim=195,lr=0.0000,num_layers=1,weight_decay=0._2024-08-25_20-18-15
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 195, 'num_layers': 1, 'num_embeddings': 13927, 'embedding_dim': 10, 'dropout_rate': 0.32, 'lr': 7.380204547098562e-06, 'weight_decay': 9.045632816984079e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.11991943479500854, 'avg_test_loss': 0.13259923724985834}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.11234925083237951, 'avg_test_loss': 0.13228554767903997}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.111988743072504, 'avg_test_loss': 0.1323800719082991}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.11184368195797807, 'avg_test_loss': 0.13289452766749396}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.11171851988192218, 'avg_test_loss': 0.13234206198502196}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.11162743860164122, 'avg_test_loss': 0.13259021261099305}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.1115164072754056, 'avg_test_loss': 0.13268571879182542}
INFO:model_data_nn.py:Early stopping at epoch 7
INFO:main.py:Making prediction for data in year: 2002
INFO:main.py:Prediction data shape: (59934,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2002: 0.21361566964973358
INFO:main.py:Prediction Stats:                 ret          pred
count  59934.000000  59934.000000
mean      -0.008055      0.001549
std        0.215604      0.024547
min       -0.943662     -0.213631
25%       -0.103582     -0.009455
50%       -0.010669      0.006087
75%        0.066667      0.016436
max        5.640000      0.110474
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:transform_data_nn.py:Train_data: (1090494, 161)

INFO:transform_data_nn.py:Test data years: [2002]
INFO:transform_data_nn.py:Test_data: (59934, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:transform_data_nn.py:Retrain_data: (1150428, 161)

INFO:transform_data_nn.py:Prediction data years: [2003]
INFO:transform_data_nn.py:Prediction_data: (55419, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([1090494, 152])
            y_train_tf: torch.Size([1090494])

            x_test_tf: torch.Size([59934, 152])
            y_test_tf: torch.Size([59934])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([1150428, 152])
            y_retrain_tf: torch.Size([1150428])

            x_prediction_tf: torch.Size([55419, 152])
            y_prediction_tf: torch.Size([55419])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:main.py:Testing data year: 2002
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 13927
            device: cpu
            
2024-08-26 00:19:17,843	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-26 00:19:17,890	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-26 00:19:17,945	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip' (5.16MiB) to Ray cluster...
2024-08-26 00:19:17,956	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip'.
2024-08-26 00:19:21,926	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-26 02:34:51,921	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-26_00-19-21' in 0.3428s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 115, 'num_layers': 1, 'num_embeddings': 13927, 'embedding_dim': 9, 'dropout_rate': 0.49, 'lr': 5.903528888900268e-06, 'weight_decay': 9.791095734427403e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}
INFO:model_data_nn.py:Best trial training loss: 0.11172349742774547
INFO:model_data_nn.py:Best trial testing loss: 0.13254232890506798
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-26_00-19-15_365219_2457762/artifacts/2024-08-26_00-19-21/train_fnn_2024-08-26_00-19-21/driver_artifacts/train_fnn_840ba_00028_28_batch_size=128,dropout_rate=0.4900,embedding_dim=9,hidden_dim=115,lr=0.0000,num_layers=1,weight_decay=0.0_2024-08-26_00-19-22
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 115, 'num_layers': 1, 'num_embeddings': 14098, 'embedding_dim': 9, 'dropout_rate': 0.49, 'lr': 5.903528888900268e-06, 'weight_decay': 9.791095734427403e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.1198450549342641, 'avg_test_loss': 0.11419761446724037}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.11353798950373085, 'avg_test_loss': 0.11357127615265702}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.11335956346717416, 'avg_test_loss': 0.11371618680501094}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1132680220367567, 'avg_test_loss': 0.11325249306461828}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.11319252822842045, 'avg_test_loss': 0.11305063230783505}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.11313670305335191, 'avg_test_loss': 0.11347303472407695}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.11305534762861043, 'avg_test_loss': 0.11339174745298973}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.11298998282034511, 'avg_test_loss': 0.11328553494418742}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.11293251603871628, 'avg_test_loss': 0.1130051774856813}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.1129015317998965, 'avg_test_loss': 0.11312418025821516}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.11286631156983173, 'avg_test_loss': 0.11289810096763297}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.11280537884725113, 'avg_test_loss': 0.11326902444037774}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.11276651445008948, 'avg_test_loss': 0.11278827042764109}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.11275611239001179, 'avg_test_loss': 0.11277605714513028}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.11269408097747463, 'avg_test_loss': 0.11303022001411843}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.11268222298175909, 'avg_test_loss': 0.11262930588104157}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.11264244032851896, 'avg_test_loss': 0.11295534333958361}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.11263869684162614, 'avg_test_loss': 0.11302483648784442}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.11259487270396955, 'avg_test_loss': 0.11294058527943719}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.11256474684051324, 'avg_test_loss': 0.11305383825136937}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.11255285413870493, 'avg_test_loss': 0.1131635021943143}
INFO:model_data_nn.py:Early stopping at epoch 21
INFO:main.py:Making prediction for data in year: 2003
INFO:main.py:Prediction data shape: (55419,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2003: 0.19847069513422838
INFO:main.py:Prediction Stats:                 ret          pred
count  55419.000000  55419.000000
mean       0.050470      0.001284
std        0.190533      0.020894
min       -0.941860     -0.138446
25%       -0.034663     -0.007071
50%        0.024451      0.005766
75%        0.101886      0.014130
max        5.178572      0.072929
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:transform_data_nn.py:Train_data: (1150428, 161)

INFO:transform_data_nn.py:Test data years: [2003]
INFO:transform_data_nn.py:Test_data: (55419, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:transform_data_nn.py:Retrain_data: (1205847, 161)

INFO:transform_data_nn.py:Prediction data years: [2004]
INFO:transform_data_nn.py:Prediction_data: (52500, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([1150428, 152])
            y_train_tf: torch.Size([1150428])

            x_test_tf: torch.Size([55419, 152])
            y_test_tf: torch.Size([55419])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1205847, 152])
            y_retrain_tf: torch.Size([1205847])

            x_prediction_tf: torch.Size([52500, 152])
            y_prediction_tf: torch.Size([52500])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:main.py:Testing data year: 2003
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 14098
            device: cpu
            
2024-08-26 05:12:01,890	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-26 05:12:01,944	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-26 05:12:02,004	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip' (5.16MiB) to Ray cluster...
2024-08-26 05:12:02,016	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip'.
2024-08-26 05:12:06,170	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-26 07:14:48,473	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-26_05-12-06' in 0.3607s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 85, 'num_layers': 5, 'num_embeddings': 14098, 'embedding_dim': 1, 'dropout_rate': 0.5, 'lr': 4.5358555488633846e-05, 'weight_decay': 1.6634835396159415e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}
INFO:model_data_nn.py:Best trial training loss: 0.11168289891985778
INFO:model_data_nn.py:Best trial testing loss: 0.11071878249332102
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-26_05-11-59_358849_2457762/artifacts/2024-08-26_05-12-06/train_fnn_2024-08-26_05-12-06/driver_artifacts/train_fnn_69269_00000_0_batch_size=256,dropout_rate=0.5000,embedding_dim=1,hidden_dim=85,lr=0.0000,num_layers=5,weight_decay=0.000_2024-08-26_05-12-06
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 85, 'num_layers': 5, 'num_embeddings': 14254, 'embedding_dim': 1, 'dropout_rate': 0.5, 'lr': 4.5358555488633846e-05, 'weight_decay': 1.6634835396159415e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.115004592823881, 'avg_test_loss': 0.09044642939946605}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.11401324556733139, 'avg_test_loss': 0.09036682645600398}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.11379210542088608, 'avg_test_loss': 0.09029829751663995}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.11357905611933669, 'avg_test_loss': 0.09026559266867568}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.11340254698652624, 'avg_test_loss': 0.0902407878955591}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.11327442906148368, 'avg_test_loss': 0.09021311338303738}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.11318091665989781, 'avg_test_loss': 0.090241689234972}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.11311893983884476, 'avg_test_loss': 0.0901296716183424}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.11302381278571302, 'avg_test_loss': 0.09013228841776987}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.11296897909095839, 'avg_test_loss': 0.09010720976348062}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.11289766347015992, 'avg_test_loss': 0.09011889231002447}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.11285282763832441, 'avg_test_loss': 0.09010842654094534}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.11278016964278151, 'avg_test_loss': 0.09018356248157695}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.11272529141380276, 'avg_test_loss': 0.09021081120788473}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.11267837406849912, 'avg_test_loss': 0.09023624891867336}
INFO:model_data_nn.py:Early stopping at epoch 15
INFO:main.py:Making prediction for data in year: 2004
INFO:main.py:Prediction data shape: (52500,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2004: 0.15107726646310674
INFO:main.py:Prediction Stats:                 ret          pred
count  52500.000000  52500.000000
mean       0.017988      0.015066
std        0.151285      0.007558
min       -0.918750     -0.189863
25%       -0.046307      0.013563
50%        0.009646      0.018601
75%        0.068970      0.019711
max        6.908072      0.019965
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:transform_data_nn.py:Train_data: (1205847, 161)

INFO:transform_data_nn.py:Test data years: [2004]
INFO:transform_data_nn.py:Test_data: (52500, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]
INFO:transform_data_nn.py:Retrain_data: (1258347, 161)

INFO:transform_data_nn.py:Prediction data years: [2005]
INFO:transform_data_nn.py:Prediction_data: (50879, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1205847, 152])
            y_train_tf: torch.Size([1205847])

            x_test_tf: torch.Size([52500, 152])
            y_test_tf: torch.Size([52500])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1258347, 152])
            y_retrain_tf: torch.Size([1258347])

            x_prediction_tf: torch.Size([50879, 152])
            y_prediction_tf: torch.Size([50879])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003]
INFO:main.py:Testing data year: 2004
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 14254
            device: cpu
            
2024-08-26 09:55:39,259	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-26 09:55:39,310	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-26 09:55:39,366	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip' (5.16MiB) to Ray cluster...
2024-08-26 09:55:39,378	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f0f33e047eacedb4.zip'.
2024-08-26 09:55:43,703	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-26 11:46:26,470	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-26_09-55-43' in 0.3827s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 2, 'num_embeddings': 14254, 'embedding_dim': 8, 'dropout_rate': 0.33, 'lr': 1.4656263345254046e-05, 'weight_decay': 2.2776891969450935e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.11251586488380907
INFO:model_data_nn.py:Best trial testing loss: 0.08975859454592905
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-26_09-55-36_688938_2457762/artifacts/2024-08-26_09-55-43/train_fnn_2024-08-26_09-55-43/driver_artifacts/train_fnn_0863f_00146_146_batch_size=32,dropout_rate=0.3300,embedding_dim=8,hidden_dim=15,lr=0.0000,num_layers=2,weight_decay=0.00_2024-08-26_09-55-44
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 15, 'num_layers': 2, 'num_embeddings': 14395, 'embedding_dim': 8, 'dropout_rate': 0.33, 'lr': 1.4656263345254046e-05, 'weight_decay': 2.2776891969450935e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.11309519992634505, 'avg_test_loss': 0.08452120704705235}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.11274125828251083, 'avg_test_loss': 0.0843474846391839}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.11254255169483855, 'avg_test_loss': 0.08432992862877231}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.11240230288168114, 'avg_test_loss': 0.08440008376426292}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.11230896348744965, 'avg_test_loss': 0.08432047150490231}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.11221504986893988, 'avg_test_loss': 0.08433017938883987}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.11213433995420034, 'avg_test_loss': 0.08445968925952911}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.11211291685604922, 'avg_test_loss': 0.08426472016569203}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.11205408776379464, 'avg_test_loss': 0.08440063725336917}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.11201719772045542, 'avg_test_loss': 0.08436238752127444}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.11199121218491777, 'avg_test_loss': 0.0843517683411263}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.11195470030302222, 'avg_test_loss': 0.08437778303317679}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.11190297594747499, 'avg_test_loss': 0.08430048364607043}
INFO:model_data_nn.py:Early stopping at epoch 13
INFO:main.py:Making prediction for data in year: 2005
INFO:main.py:Prediction data shape: (50879,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2005: 0.13204876129378726
INFO:main.py:Prediction Stats:                 ret          pred
count  50879.000000  50879.000000
mean       0.004015      0.000613
std        0.132264      0.015880
min       -0.820889     -0.119009
25%       -0.055669     -0.003916
50%        0.000000      0.005743
75%        0.055960      0.010109
max        3.303279      0.044113
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]
INFO:transform_data_nn.py:Train_data: (1258347, 161)

INFO:transform_data_nn.py:Test data years: [2005]
INFO:transform_data_nn.py:Test_data: (50879, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]
INFO:transform_data_nn.py:Retrain_data: (1309226, 161)

INFO:transform_data_nn.py:Prediction data years: [2006]
INFO:transform_data_nn.py:Prediction_data: (49969, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1258347, 152])
            y_train_tf: torch.Size([1258347])

            x_test_tf: torch.Size([50879, 152])
            y_test_tf: torch.Size([50879])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1309226, 152])
            y_retrain_tf: torch.Size([1309226])

            x_prediction_tf: torch.Size([49969, 152])
            y_prediction_tf: torch.Size([49969])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004]
INFO:main.py:Testing data year: 2005
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 14395
            device: cpu
            
2024-08-26 14:49:39,658	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-26 14:49:39,716	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-26 14:49:39,770	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_77c141fdb006e9ae.zip' (5.16MiB) to Ray cluster...
2024-08-26 14:49:39,781	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_77c141fdb006e9ae.zip'.
2024-08-26 14:49:44,181	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-26 18:07:12,303	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-26_14-49-44' in 0.3405s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 145, 'num_layers': 1, 'num_embeddings': 14395, 'embedding_dim': 9, 'dropout_rate': 0.32, 'lr': 7.174143758418913e-06, 'weight_decay': 3.243359487891771e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.11161165779756192
INFO:model_data_nn.py:Best trial testing loss: 0.0842482457464596
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-26_14-49-36_968229_2457762/artifacts/2024-08-26_14-49-44/train_fnn_2024-08-26_14-49-44/driver_artifacts/train_fnn_1aef6_00088_88_batch_size=32,dropout_rate=0.3200,embedding_dim=9,hidden_dim=145,lr=0.0000,num_layers=1,weight_decay=0.00_2024-08-26_14-49-44
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 145, 'num_layers': 1, 'num_embeddings': 14659, 'embedding_dim': 9, 'dropout_rate': 0.32, 'lr': 7.174143758418913e-06, 'weight_decay': 3.243359487891771e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.11348393405183162, 'avg_test_loss': 0.08085278279258942}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.1111068024893005, 'avg_test_loss': 0.08078841470711401}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.11093988097748685, 'avg_test_loss': 0.0807035687962659}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.11083415594776252, 'avg_test_loss': 0.0807166609295409}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.11074768982499322, 'avg_test_loss': 0.08070714011902846}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.11067871158979958, 'avg_test_loss': 0.08067592888087911}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.11060186306355335, 'avg_test_loss': 0.0807300079005762}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.1105598282069241, 'avg_test_loss': 0.0806095150052528}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.1105093551881649, 'avg_test_loss': 0.0806378730228135}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.11047371539779621, 'avg_test_loss': 0.08065754016467803}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.11042641834749585, 'avg_test_loss': 0.08061050985452078}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.11037398099471703, 'avg_test_loss': 0.08069988441022731}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.11033853210633203, 'avg_test_loss': 0.08064174551931752}
INFO:model_data_nn.py:Early stopping at epoch 13
INFO:main.py:Making prediction for data in year: 2006
INFO:main.py:Prediction data shape: (49969,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2006: 0.12747203646350116
INFO:main.py:Prediction Stats:                 ret          pred
count  49969.000000  49969.000000
mean       0.013986      0.006737
std        0.127375      0.016844
min       -0.879154     -0.144090
25%       -0.043374     -0.000372
50%        0.006972      0.009342
75%        0.062176      0.017312
max        4.022988      0.075920
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]
INFO:transform_data_nn.py:Train_data: (1309226, 161)

INFO:transform_data_nn.py:Test data years: [2006]
INFO:transform_data_nn.py:Test_data: (49969, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]
INFO:transform_data_nn.py:Retrain_data: (1359195, 161)

INFO:transform_data_nn.py:Prediction data years: [2007]
INFO:transform_data_nn.py:Prediction_data: (48760, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1309226, 152])
            y_train_tf: torch.Size([1309226])

            x_test_tf: torch.Size([49969, 152])
            y_test_tf: torch.Size([49969])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1359195, 152])
            y_retrain_tf: torch.Size([1359195])

            x_prediction_tf: torch.Size([48760, 152])
            y_prediction_tf: torch.Size([48760])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005]
INFO:main.py:Testing data year: 2006
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 14659
            device: cpu
            
2024-08-26 21:06:45,752	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-26 21:06:45,801	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-26 21:06:45,855	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_77c141fdb006e9ae.zip' (5.16MiB) to Ray cluster...
2024-08-26 21:06:45,868	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_77c141fdb006e9ae.zip'.
2024-08-26 21:06:50,525	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
[36m(train_fnn pid=3968048)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3968048)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3967053)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3967053)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3966869)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3966869)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3967072)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3967072)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3966741)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3966741)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3967868)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3967868)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3967981)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3967981)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4093100)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4093100)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3966939)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3966939)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4013410)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4013410)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4049457)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4049457)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=3968045)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=3968045)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4075636)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4075636)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4093282)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4093282)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4111292)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4111292)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4155563)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4155563)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=6299)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=6299)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4094252)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4094252)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4058634)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4058634)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4094078)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4094078)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4111535)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4111535)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4093405)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4093405)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=66979)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=66979)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=101561)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=101561)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=101806)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=101806)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4173477)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4173477)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4112023)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4112023)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=101982)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=101982)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=144405)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=144405)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=204174)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=204174)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=94425)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=94425)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=247321)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=247321)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=203998)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=203998)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=282491)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=282491)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=325505)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=325505)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=342920)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=342920)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=368776)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=368776)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=369021)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=369021)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=386616)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=386616)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=347467)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=347467)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=371144)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=371144)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=325504)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=325504)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=369384)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=369384)[0m   return F.l1_loss(input, target, reduction=self.reduction)
2024-08-26 23:49:10,430	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-26_21-06-50' in 0.5065s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 65, 'num_layers': 1, 'num_embeddings': 14659, 'embedding_dim': 10, 'dropout_rate': 0.36, 'lr': 1.6731627576147082e-05, 'weight_decay': 0.0001701908376603135, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}
INFO:model_data_nn.py:Best trial training loss: 0.10955521601806244
INFO:model_data_nn.py:Best trial testing loss: 0.08046128519851228
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-26_21-06-43_178698_2457762/artifacts/2024-08-26_21-06-50/train_fnn_2024-08-26_21-06-50/driver_artifacts/train_fnn_c9497_00059_59_batch_size=128,dropout_rate=0.3600,embedding_dim=10,hidden_dim=65,lr=0.0000,num_layers=1,weight_decay=0.0_2024-08-26_21-06-51
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 65, 'num_layers': 1, 'num_embeddings': 14929, 'embedding_dim': 10, 'dropout_rate': 0.36, 'lr': 1.6731627576147082e-05, 'weight_decay': 0.0001701908376603135, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.11128275744430335, 'avg_test_loss': 0.08334902653426636}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.11003579832873095, 'avg_test_loss': 0.08329351089914327}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10978055198603733, 'avg_test_loss': 0.08331840275114602}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10961755029864176, 'avg_test_loss': 0.08344293372055364}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10949229444893746, 'avg_test_loss': 0.08345390760444907}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10936999290249716, 'avg_test_loss': 0.0837613160959066}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10925069202090594, 'avg_test_loss': 0.08366025210873974}
INFO:model_data_nn.py:Early stopping at epoch 7
INFO:main.py:Making prediction for data in year: 2007
INFO:main.py:Prediction data shape: (48760,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2007: 0.1327341220590302
INFO:main.py:Prediction Stats:                 ret          pred
count  48760.000000  48760.000000
mean      -0.004704      0.004115
std        0.132528      0.016316
min       -0.952684     -0.133352
25%       -0.062474     -0.001708
50%       -0.005420      0.007847
75%        0.048320      0.014183
max        5.801008      0.062856
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]
INFO:transform_data_nn.py:Train_data: (1359195, 161)

INFO:transform_data_nn.py:Test data years: [2007]
INFO:transform_data_nn.py:Test_data: (48760, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:transform_data_nn.py:Retrain_data: (1407955, 161)

INFO:transform_data_nn.py:Prediction data years: [2008]
INFO:transform_data_nn.py:Prediction_data: (47807, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1359195, 152])
            y_train_tf: torch.Size([1359195])

            x_test_tf: torch.Size([48760, 152])
            y_test_tf: torch.Size([48760])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1407955, 152])
            y_retrain_tf: torch.Size([1407955])

            x_prediction_tf: torch.Size([47807, 152])
            y_prediction_tf: torch.Size([47807])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006]
INFO:main.py:Testing data year: 2007
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 14929
            device: cpu
            
2024-08-27 02:38:43,973	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-27 02:38:44,026	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-27 02:38:44,076	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_77c141fdb006e9ae.zip' (5.16MiB) to Ray cluster...
2024-08-27 02:38:44,088	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_77c141fdb006e9ae.zip'.
2024-08-27 02:38:48,779	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-27 06:00:15,960	WARNING experiment_state.py:233 -- Saving the experiment state (which holds a global view of trial statuses and is used to restore the experiment) has already taken 30.21 seconds, which may cause consistency issues upon restoration if your driver script ungracefully exits.
This could be due to a large number of trials, large logfiles from lots of reported metrics, or throttling from the remote storage if uploading too frequently.
You may want to consider switching the `RunConfig(storage_filesystem)` to a more performant storage backend such as s3fs for a S3 storage path.
You can suppress this error by setting the environment variable TUNE_WARN_SLOW_EXPERIMENT_CHECKPOINT_SYNC_THRESHOLD_S to a higher value than the current threshold (30.0).
2024-08-27 10:47:50,193	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-27_02-38-48' in 0.3654s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 2, 'num_embeddings': 14929, 'embedding_dim': 2, 'dropout_rate': 0.1, 'lr': 5.261895134071224e-06, 'weight_decay': 6.259541226867041e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}
INFO:model_data_nn.py:Best trial training loss: 0.11001640850774717
INFO:model_data_nn.py:Best trial testing loss: 0.08309046629623185
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-27_02-38-41_296997_2457762/artifacts/2024-08-27_02-38-48/train_fnn_2024-08-27_02-38-48/driver_artifacts/train_fnn_297dd_00113_113_batch_size=16,dropout_rate=0.1000,embedding_dim=2,hidden_dim=5,lr=0.0000,num_layers=2,weight_decay=0.000_2024-08-27_02-38-49
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 2, 'num_embeddings': 15183, 'embedding_dim': 2, 'dropout_rate': 0.1, 'lr': 5.261895134071224e-06, 'weight_decay': 6.259541226867041e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10992813599206748, 'avg_test_loss': 0.13984346524170205}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10970337402006482, 'avg_test_loss': 0.1402447550311944}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10958760342585654, 'avg_test_loss': 0.14023976744847044}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10946371448955852, 'avg_test_loss': 0.13954196438452646}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10940293961551507, 'avg_test_loss': 0.14000114590587864}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10933643063203696, 'avg_test_loss': 0.1400846386256028}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10928182043644871, 'avg_test_loss': 0.14059253333951813}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10923017719823086, 'avg_test_loss': 0.14010173294922634}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10917957533435695, 'avg_test_loss': 0.14037167611799964}
INFO:model_data_nn.py:Early stopping at epoch 9
INFO:main.py:Making prediction for data in year: 2008
INFO:main.py:Prediction data shape: (47807,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2008: 0.20442285146602648
INFO:main.py:Prediction Stats:                 ret          pred
count  47807.000000  47807.000000
mean      -0.043596      0.005869
std        0.200372      0.016748
min       -0.944667     -0.131457
25%       -0.142140      0.002082
50%       -0.035885      0.008765
75%        0.051560      0.015604
max        4.900000      0.052892
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:transform_data_nn.py:Train_data: (1407955, 161)

INFO:transform_data_nn.py:Test data years: [2008]
INFO:transform_data_nn.py:Test_data: (47807, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:transform_data_nn.py:Retrain_data: (1455762, 161)

INFO:transform_data_nn.py:Prediction data years: [2009]
INFO:transform_data_nn.py:Prediction_data: (46521, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1407955, 152])
            y_train_tf: torch.Size([1407955])

            x_test_tf: torch.Size([47807, 152])
            y_test_tf: torch.Size([47807])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1455762, 152])
            y_retrain_tf: torch.Size([1455762])

            x_prediction_tf: torch.Size([46521, 152])
            y_prediction_tf: torch.Size([46521])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:main.py:Testing data year: 2008
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15183
            device: cpu
            
2024-08-27 14:07:29,863	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-27 14:07:29,913	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-27 14:07:29,966	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_c0e6c97425991ae4.zip' (5.16MiB) to Ray cluster...
2024-08-27 14:07:29,981	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_c0e6c97425991ae4.zip'.
2024-08-27 14:07:34,845	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-27 18:04:57,088	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-27_14-07-34' in 0.3410s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 175, 'num_layers': 3, 'num_embeddings': 15183, 'embedding_dim': 7, 'dropout_rate': 0.11, 'lr': 0.0004951500102987758, 'weight_decay': 2.1845812910338888e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}
INFO:model_data_nn.py:Best trial training loss: 0.10286404678676116
INFO:model_data_nn.py:Best trial testing loss: 0.13356829356940034
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-27_14-07-27_133620_2457762/artifacts/2024-08-27_14-07-34/train_fnn_2024-08-27_14-07-34/driver_artifacts/train_fnn_61bef_00123_123_batch_size=128,dropout_rate=0.1100,embedding_dim=7,hidden_dim=175,lr=0.0005,num_layers=3,weight_decay=0._2024-08-27_14-07-35
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 175, 'num_layers': 3, 'num_embeddings': 15465, 'embedding_dim': 7, 'dropout_rate': 0.11, 'lr': 0.0004951500102987758, 'weight_decay': 2.1845812910338888e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10951467814390886, 'avg_test_loss': 0.15460697934031487}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.1072917943254505, 'avg_test_loss': 0.15362114537056987}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10561418466503844, 'avg_test_loss': 0.1536198554785697}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10475790608865253, 'avg_test_loss': 0.15531282022513532}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10435557695921122, 'avg_test_loss': 0.1562445085127275}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10407354545634664, 'avg_test_loss': 0.15079407682539997}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10390355620180451, 'avg_test_loss': 0.15424326631230312}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10377843707870664, 'avg_test_loss': 0.15280140340737589}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10367826645959496, 'avg_test_loss': 0.15506126678415708}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.10360351037032621, 'avg_test_loss': 0.15033710913753118}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10353201898390549, 'avg_test_loss': 0.1595594305135719}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10344475405931913, 'avg_test_loss': 0.1512050545764166}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10344423961156718, 'avg_test_loss': 0.15537586241223655}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.1033822409792258, 'avg_test_loss': 0.15441948511115797}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10339080609933457, 'avg_test_loss': 0.15507500119261688}
INFO:model_data_nn.py:Early stopping at epoch 15
INFO:main.py:Making prediction for data in year: 2009
INFO:main.py:Prediction data shape: (46521,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2009: 0.27044961048698524
INFO:main.py:Prediction Stats:                 ret          pred
count  46521.000000  46521.000000
mean       0.047317      0.064746
std        0.269893      0.046414
min       -0.972173     -0.233293
25%       -0.069401      0.035564
50%        0.020202      0.059380
75%        0.120234      0.087207
max       15.774193      0.366174
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:transform_data_nn.py:Train_data: (1455762, 161)

INFO:transform_data_nn.py:Test data years: [2009]
INFO:transform_data_nn.py:Test_data: (46521, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:transform_data_nn.py:Retrain_data: (1502283, 161)

INFO:transform_data_nn.py:Prediction data years: [2010]
INFO:transform_data_nn.py:Prediction_data: (44043, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1455762, 152])
            y_train_tf: torch.Size([1455762])

            x_test_tf: torch.Size([46521, 152])
            y_test_tf: torch.Size([46521])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1502283, 152])
            y_retrain_tf: torch.Size([1502283])

            x_prediction_tf: torch.Size([44043, 152])
            y_prediction_tf: torch.Size([44043])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:main.py:Testing data year: 2009
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15465
            device: cpu
            
2024-08-27 21:18:20,003	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-27 21:18:20,069	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-27 21:18:20,129	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_c0e6c97425991ae4.zip' (5.16MiB) to Ray cluster...
2024-08-27 21:18:20,142	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_c0e6c97425991ae4.zip'.
2024-08-27 21:18:24,946	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
[36m(train_fnn pid=4164718)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4164718)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4164785)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4164785)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4164917)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4164917)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4164918)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4164918)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=61474)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=61474)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=96352)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=96352)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=4164719)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=4164719)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=361)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=361)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=96110)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=96110)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=198338)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=198338)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=78747)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=78747)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=181128)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=181128)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=377295)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=377295)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=420060)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=420060)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=437616)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=437616)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=488886)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=488886)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=613656)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=613656)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=636676)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=636676)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=662726)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=662726)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=676008)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=676008)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=515466)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=515466)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=757206)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=757206)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=697034)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=697034)[0m   return F.l1_loss(input, target, reduction=self.reduction)
[36m(train_fnn pid=598735)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=598735)[0m   return F.l1_loss(input, target, reduction=self.reduction)[32m [repeated 2x across cluster][0m
[36m(train_fnn pid=774190)[0m /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/nn/modules/loss.py:101: UserWarning: Using a target size (torch.Size([1])) that is different to the input size (torch.Size([])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
[36m(train_fnn pid=774190)[0m   return F.l1_loss(input, target, reduction=self.reduction)
2024-08-28 07:13:11,317	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-27_21-18-24' in 0.3461s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 65, 'num_layers': 3, 'num_embeddings': 15465, 'embedding_dim': 5, 'dropout_rate': 0.4, 'lr': 0.0006533150751579553, 'weight_decay': 1.3215578790145583e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.10860538643520402
INFO:model_data_nn.py:Best trial testing loss: 0.14796393939090235
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-27_21-18-17_286907_2457762/artifacts/2024-08-27_21-18-24/train_fnn_2024-08-27_21-18-24/driver_artifacts/train_fnn_919b6_00008_8_batch_size=32,dropout_rate=0.4000,embedding_dim=5,hidden_dim=65,lr=0.0007,num_layers=3,weight_decay=0.0000_2024-08-27_21-18-25
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 65, 'num_layers': 3, 'num_embeddings': 15618, 'embedding_dim': 5, 'dropout_rate': 0.4, 'lr': 0.0006533150751579553, 'weight_decay': 1.3215578790145583e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.11150906959437737, 'avg_test_loss': 0.10371090941666777}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.11069701618566098, 'avg_test_loss': 0.10302050426310184}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.1103426152425639, 'avg_test_loss': 0.10371125023609153}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.11013996428766615, 'avg_test_loss': 0.10392169182012284}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.11004355191892114, 'avg_test_loss': 0.10336788084436432}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10996923538628188, 'avg_test_loss': 0.10419791618182163}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10988114008180302, 'avg_test_loss': 0.10408522264954831}
INFO:model_data_nn.py:Early stopping at epoch 7
INFO:main.py:Making prediction for data in year: 2010
INFO:main.py:Prediction data shape: (44043,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2010: 0.15956849298556888
INFO:main.py:Prediction Stats:                 ret          pred
count  44043.000000  44043.000000
mean       0.023938      0.020830
std        0.158845      0.020510
min       -0.895194     -0.119499
25%       -0.056751      0.008146
50%        0.015038      0.019932
75%        0.089069      0.034338
max        6.107143      0.147672
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:transform_data_nn.py:Train_data: (1502283, 161)

INFO:transform_data_nn.py:Test data years: [2010]
INFO:transform_data_nn.py:Test_data: (44043, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:transform_data_nn.py:Retrain_data: (1546326, 161)

INFO:transform_data_nn.py:Prediction data years: [2011]
INFO:transform_data_nn.py:Prediction_data: (42205, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1502283, 152])
            y_train_tf: torch.Size([1502283])

            x_test_tf: torch.Size([44043, 152])
            y_test_tf: torch.Size([44043])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1546326, 152])
            y_retrain_tf: torch.Size([1546326])

            x_prediction_tf: torch.Size([42205, 152])
            y_prediction_tf: torch.Size([42205])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:main.py:Testing data year: 2010
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15618
            device: cpu
            
2024-08-28 10:24:28,942	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-28 10:24:28,991	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-28 10:24:29,050	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_6274589bddaaa027.zip' (5.16MiB) to Ray cluster...
2024-08-28 10:24:29,064	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_6274589bddaaa027.zip'.
2024-08-28 10:24:34,345	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-28 13:29:00,653	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-28_10-24-34' in 0.3222s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 5, 'num_embeddings': 15618, 'embedding_dim': 10, 'dropout_rate': 0.47, 'lr': 5.9561936414353374e-05, 'weight_decay': 1.1814827007866493e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}
INFO:model_data_nn.py:Best trial training loss: 0.1104643952365566
INFO:model_data_nn.py:Best trial testing loss: 0.1027304002143055
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-28_10-24-26_085861_2457762/artifacts/2024-08-28_10-24-34/train_fnn_2024-08-28_10-24-34/driver_artifacts/train_fnn_64c28_00123_123_batch_size=256,dropout_rate=0.4700,embedding_dim=10,hidden_dim=55,lr=0.0001,num_layers=5,weight_decay=0._2024-08-28_10-24-35
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 5, 'num_embeddings': 15706, 'embedding_dim': 10, 'dropout_rate': 0.47, 'lr': 5.9561936414353374e-05, 'weight_decay': 1.1814827007866493e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 256}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.11224649880352794, 'avg_test_loss': 0.09537970261140304}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.11161819977056704, 'avg_test_loss': 0.09531333974816582}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.11137976996131883, 'avg_test_loss': 0.09537917095603365}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.11120050979395774, 'avg_test_loss': 0.09565125785090707}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.11109887041792964, 'avg_test_loss': 0.09568595096017375}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.11099389596959415, 'avg_test_loss': 0.0958402759875312}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.11092193440120938, 'avg_test_loss': 0.09573061969695669}
INFO:model_data_nn.py:Early stopping at epoch 7
INFO:main.py:Making prediction for data in year: 2011
INFO:main.py:Prediction data shape: (42205,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2011: 0.14687065782596276
INFO:main.py:Prediction Stats:                 ret          pred
count  42205.000000  42205.000000
mean      -0.005365      0.011315
std        0.146266      0.003510
min       -0.935356     -0.028836
25%       -0.073850      0.011881
50%       -0.008264      0.012747
75%        0.050858      0.012828
max        3.993939      0.012852
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:transform_data_nn.py:Train_data: (1546326, 161)

INFO:transform_data_nn.py:Test data years: [2011]
INFO:transform_data_nn.py:Test_data: (42205, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:transform_data_nn.py:Retrain_data: (1588531, 161)

INFO:transform_data_nn.py:Prediction data years: [2012]
INFO:transform_data_nn.py:Prediction_data: (40994, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1546326, 152])
            y_train_tf: torch.Size([1546326])

            x_test_tf: torch.Size([42205, 152])
            y_test_tf: torch.Size([42205])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1588531, 152])
            y_retrain_tf: torch.Size([1588531])

            x_prediction_tf: torch.Size([40994, 152])
            y_prediction_tf: torch.Size([40994])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:main.py:Testing data year: 2011
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15706
            device: cpu
            
2024-08-28 17:19:04,100	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-28 17:19:04,197	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-28 17:19:04,260	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_16e238066c1d420d.zip' (5.17MiB) to Ray cluster...
2024-08-28 17:19:04,278	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_16e238066c1d420d.zip'.
2024-08-28 17:19:11,528	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-28 23:20:51,488	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-28_17-19-11' in 0.3259s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 35, 'num_layers': 1, 'num_embeddings': 15706, 'embedding_dim': 3, 'dropout_rate': 0.36, 'lr': 2.534594143233629e-06, 'weight_decay': 4.5197682084994396e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}
INFO:model_data_nn.py:Best trial training loss: 0.11121210136592684
INFO:model_data_nn.py:Best trial testing loss: 0.09411454831786228
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-28_17-19-00_936857_2457762/artifacts/2024-08-28_17-19-11/train_fnn_2024-08-28_17-19-11/driver_artifacts/train_fnn_50b76_00133_133_batch_size=128,dropout_rate=0.3600,embedding_dim=3,hidden_dim=35,lr=0.0000,num_layers=1,weight_decay=0.0_2024-08-28_17-19-12
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 35, 'num_layers': 1, 'num_embeddings': 15854, 'embedding_dim': 3, 'dropout_rate': 0.36, 'lr': 2.534594143233629e-06, 'weight_decay': 4.5197682084994396e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.11274707086570411, 'avg_test_loss': 0.08721904739783931}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.111240186510453, 'avg_test_loss': 0.08665142204856204}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.11109580027838564, 'avg_test_loss': 0.08668273906702194}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.11102117449525477, 'avg_test_loss': 0.08664483947220993}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.11096717324723264, 'avg_test_loss': 0.08669355209928435}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.11088425401090903, 'avg_test_loss': 0.08665255979399815}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.11083807136974538, 'avg_test_loss': 0.08669921053672133}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.11078400273149192, 'avg_test_loss': 0.08672008462644812}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.11072962238460082, 'avg_test_loss': 0.08670232315022626}
INFO:model_data_nn.py:Early stopping at epoch 9
INFO:main.py:Making prediction for data in year: 2012
INFO:main.py:Prediction data shape: (40994,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2012: 0.1458741790458944
INFO:main.py:Prediction Stats:                 ret          pred
count  40994.000000  40994.000000
mean       0.016349      0.005061
std        0.144873      0.012530
min       -0.830303     -0.097508
25%       -0.043610      0.000508
50%        0.010396      0.007713
75%        0.065653      0.012845
max        5.210484      0.059286
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:transform_data_nn.py:Train_data: (1588531, 161)

INFO:transform_data_nn.py:Test data years: [2012]
INFO:transform_data_nn.py:Test_data: (40994, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:transform_data_nn.py:Retrain_data: (1629525, 161)

INFO:transform_data_nn.py:Prediction data years: [2013]
INFO:transform_data_nn.py:Prediction_data: (39683, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1588531, 152])
            y_train_tf: torch.Size([1588531])

            x_test_tf: torch.Size([40994, 152])
            y_test_tf: torch.Size([40994])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1629525, 152])
            y_retrain_tf: torch.Size([1629525])

            x_prediction_tf: torch.Size([39683, 152])
            y_prediction_tf: torch.Size([39683])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:main.py:Testing data year: 2012
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15854
            device: cpu
            
2024-08-29 03:22:02,602	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-29 03:22:02,664	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-29 03:22:02,724	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_16e238066c1d420d.zip' (5.17MiB) to Ray cluster...
2024-08-29 03:22:02,739	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_16e238066c1d420d.zip'.
2024-08-29 03:22:09,018	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-29 08:02:24,076	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-29_03-22-09' in 0.3316s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 75, 'num_layers': 3, 'num_embeddings': 15854, 'embedding_dim': 9, 'dropout_rate': 0.51, 'lr': 2.782873361239868e-06, 'weight_decay': 9.279840906271429e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}
INFO:model_data_nn.py:Best trial training loss: 0.11066281848525832
INFO:model_data_nn.py:Best trial testing loss: 0.0864141347977597
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-29_03-21-59_519721_2457762/artifacts/2024-08-29_03-22-09/train_fnn_2024-08-29_03-22-09/driver_artifacts/train_fnn_8c2e4_00058_58_batch_size=16,dropout_rate=0.5100,embedding_dim=9,hidden_dim=75,lr=0.0000,num_layers=3,weight_decay=0.000_2024-08-29_03-22-09
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 75, 'num_layers': 3, 'num_embeddings': 15992, 'embedding_dim': 9, 'dropout_rate': 0.51, 'lr': 2.782873361239868e-06, 'weight_decay': 9.279840906271429e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.11227137678171098, 'avg_test_loss': 0.08127194181300852}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.11075797992192819, 'avg_test_loss': 0.08093572248348493}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.11064231531766133, 'avg_test_loss': 0.08100420038911399}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.1105313804651888, 'avg_test_loss': 0.08103372226666294}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.11042607330647969, 'avg_test_loss': 0.08101313433646315}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.1103474344431621, 'avg_test_loss': 0.08062280268708288}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.11027936939651398, 'avg_test_loss': 0.08057262156052077}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.11020049890962799, 'avg_test_loss': 0.08039050432299712}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.11014349738282155, 'avg_test_loss': 0.08033423401874816}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.11007728379850193, 'avg_test_loss': 0.0801980272701242}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.11003046253528465, 'avg_test_loss': 0.08011855992178123}
INFO:model_data_nn.py:Epoch 12/50, metrics: {'avg_train_loss': 0.10999137499502779, 'avg_test_loss': 0.08020996898923224}
INFO:model_data_nn.py:Epoch 13/50, metrics: {'avg_train_loss': 0.10993157386506547, 'avg_test_loss': 0.0802021016100634}
INFO:model_data_nn.py:Epoch 14/50, metrics: {'avg_train_loss': 0.10990362092737371, 'avg_test_loss': 0.08004697736732569}
INFO:model_data_nn.py:Epoch 15/50, metrics: {'avg_train_loss': 0.10987266505206493, 'avg_test_loss': 0.08015508338259454}
INFO:model_data_nn.py:Epoch 16/50, metrics: {'avg_train_loss': 0.10985334635339064, 'avg_test_loss': 0.08011004077221827}
INFO:model_data_nn.py:Epoch 17/50, metrics: {'avg_train_loss': 0.10980363819524855, 'avg_test_loss': 0.08002153077868145}
INFO:model_data_nn.py:Epoch 18/50, metrics: {'avg_train_loss': 0.10978010515051656, 'avg_test_loss': 0.08000070620395756}
INFO:model_data_nn.py:Epoch 19/50, metrics: {'avg_train_loss': 0.10976179591344624, 'avg_test_loss': 0.08006063303754413}
INFO:model_data_nn.py:Epoch 20/50, metrics: {'avg_train_loss': 0.10972905091886856, 'avg_test_loss': 0.08004297739355039}
INFO:model_data_nn.py:Epoch 21/50, metrics: {'avg_train_loss': 0.10971433388028945, 'avg_test_loss': 0.07994872270507083}
INFO:model_data_nn.py:Epoch 22/50, metrics: {'avg_train_loss': 0.1096720031117176, 'avg_test_loss': 0.08000048441029349}
INFO:model_data_nn.py:Epoch 23/50, metrics: {'avg_train_loss': 0.10965290719509634, 'avg_test_loss': 0.0800673892831896}
INFO:model_data_nn.py:Epoch 24/50, metrics: {'avg_train_loss': 0.10963299192186059, 'avg_test_loss': 0.08007424864775349}
INFO:model_data_nn.py:Epoch 25/50, metrics: {'avg_train_loss': 0.10960733502422174, 'avg_test_loss': 0.07996797381387104}
INFO:model_data_nn.py:Epoch 26/50, metrics: {'avg_train_loss': 0.10958480921671006, 'avg_test_loss': 0.07998936322428728}
INFO:model_data_nn.py:Early stopping at epoch 26
INFO:main.py:Making prediction for data in year: 2013
INFO:main.py:Prediction data shape: (39683,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2013: 0.13238392532427665
INFO:main.py:Prediction Stats:                 ret          pred
count  39683.000000  39683.000000
mean       0.032175      0.011860
std        0.130473      0.011110
min       -0.898559     -0.123509
25%       -0.025732      0.009163
50%        0.023150      0.013675
75%        0.077193      0.017515
max        3.746377      0.041981
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:transform_data_nn.py:Train_data: (1629525, 161)

INFO:transform_data_nn.py:Test data years: [2013]
INFO:transform_data_nn.py:Test_data: (39683, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:transform_data_nn.py:Retrain_data: (1669208, 161)

INFO:transform_data_nn.py:Prediction data years: [2014]
INFO:transform_data_nn.py:Prediction_data: (39216, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1629525, 152])
            y_train_tf: torch.Size([1629525])

            x_test_tf: torch.Size([39683, 152])
            y_test_tf: torch.Size([39683])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1669208, 152])
            y_retrain_tf: torch.Size([1669208])

            x_prediction_tf: torch.Size([39216, 152])
            y_prediction_tf: torch.Size([39216])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:main.py:Testing data year: 2013
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15992
            device: cpu
            
2024-08-29 14:48:31,041	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-29 14:48:31,096	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-29 14:48:31,154	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_135ba0bdaf57e9d1.zip' (5.17MiB) to Ray cluster...
2024-08-29 14:48:31,169	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_135ba0bdaf57e9d1.zip'.
2024-08-29 14:48:38,096	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-29 18:12:17,937	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-29_14-48-38' in 0.5230s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 105, 'num_layers': 5, 'num_embeddings': 15992, 'embedding_dim': 7, 'dropout_rate': 0.42, 'lr': 0.00013621167112855783, 'weight_decay': 0.0005589714535521003, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}
INFO:model_data_nn.py:Best trial training loss: 0.11016776949402082
INFO:model_data_nn.py:Best trial testing loss: 0.0803087134468296
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-29_14-48-27_723634_2457762/artifacts/2024-08-29_14-48-38/train_fnn_2024-08-29_14-48-38/driver_artifacts/train_fnn_72c8c_00008_8_batch_size=16,dropout_rate=0.4200,embedding_dim=7,hidden_dim=105,lr=0.0001,num_layers=5,weight_decay=0.000_2024-08-29_14-48-38
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 105, 'num_layers': 5, 'num_embeddings': 16138, 'embedding_dim': 7, 'dropout_rate': 0.42, 'lr': 0.00013621167112855783, 'weight_decay': 0.0005589714535521003, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 16}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10962146135725094, 'avg_test_loss': 0.080898386199424}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10940632052019707, 'avg_test_loss': 0.08092815889883824}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10941890794565116, 'avg_test_loss': 0.08075460610718982}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10943886317603742, 'avg_test_loss': 0.08087276413304156}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10943055837998324, 'avg_test_loss': 0.08042316616830876}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10945248114348187, 'avg_test_loss': 0.08054598810714345}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10946492771507595, 'avg_test_loss': 0.08071056452151562}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.10947060093433629, 'avg_test_loss': 0.0808400807234218}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.10947414687002002, 'avg_test_loss': 0.08088553730916705}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.10947863227874577, 'avg_test_loss': 0.08092906295809392}
INFO:model_data_nn.py:Early stopping at epoch 10
INFO:main.py:Making prediction for data in year: 2014
INFO:main.py:Prediction data shape: (39216,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2014: 0.13536269908263313
INFO:main.py:Prediction Stats:                 ret          pred
count  39216.000000  39216.000000
mean       0.004751      0.010674
std        0.135238      0.007994
min       -0.813122     -0.108502
25%       -0.053242      0.010016
50%        0.003382      0.012519
75%        0.054622      0.014732
max        6.080164      0.027591
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:transform_data_nn.py:Train_data: (1669208, 161)

INFO:transform_data_nn.py:Test data years: [2014]
INFO:transform_data_nn.py:Test_data: (39216, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:transform_data_nn.py:Retrain_data: (1708424, 161)

INFO:transform_data_nn.py:Prediction data years: [2015]
INFO:transform_data_nn.py:Prediction_data: (39863, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1669208, 152])
            y_train_tf: torch.Size([1669208])

            x_test_tf: torch.Size([39216, 152])
            y_test_tf: torch.Size([39216])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1708424, 152])
            y_retrain_tf: torch.Size([1708424])

            x_prediction_tf: torch.Size([39863, 152])
            y_prediction_tf: torch.Size([39863])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:main.py:Testing data year: 2014
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 16138
            device: cpu
            
2024-08-29 22:58:53,024	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-29 22:58:53,079	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-29 22:58:53,131	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_135ba0bdaf57e9d1.zip' (5.17MiB) to Ray cluster...
2024-08-29 22:58:53,145	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_135ba0bdaf57e9d1.zip'.
2024-08-29 22:58:58,901	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-30 02:24:21,793	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-29_22-58-58' in 0.3539s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 165, 'num_layers': 1, 'num_embeddings': 16138, 'embedding_dim': 3, 'dropout_rate': 0.21, 'lr': 0.0004673344108744442, 'weight_decay': 1.938637291842969e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}
INFO:model_data_nn.py:Best trial training loss: 0.1053201917896013
INFO:model_data_nn.py:Best trial testing loss: 0.07933064516184772
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-29_22-58-50_154842_2457762/artifacts/2024-08-29_22-58-58/train_fnn_2024-08-29_22-58-58/driver_artifacts/train_fnn_f2f37_00123_123_batch_size=128,dropout_rate=0.2100,embedding_dim=3,hidden_dim=165,lr=0.0005,num_layers=1,weight_decay=0._2024-08-29_22-58-59
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 165, 'num_layers': 1, 'num_embeddings': 16336, 'embedding_dim': 3, 'dropout_rate': 0.21, 'lr': 0.0004673344108744442, 'weight_decay': 1.938637291842969e-05, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 128}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10841270765334182, 'avg_test_loss': 0.0923788407459282}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10681969203033134, 'avg_test_loss': 0.09414902600483635}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10618476221601535, 'avg_test_loss': 0.09312272942266785}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10582891194581218, 'avg_test_loss': 0.09266639460260287}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10560695054093988, 'avg_test_loss': 0.09344342030966893}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10543803227216177, 'avg_test_loss': 0.09462969144806266}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 2015
INFO:main.py:Prediction data shape: (39863,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:335: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2015: 0.17882800334103865
INFO:main.py:Prediction Stats:                 ret          pred
count  39863.000000  39863.000000
mean      -0.004509      0.020897
std        0.175769      0.029613
min       -0.928773     -0.215667
25%       -0.066785      0.006775
50%       -0.005785      0.016443
75%        0.050659      0.033186
max       15.984456      0.222144
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:transform_data_nn.py:Train_data: (1708424, 161)

INFO:transform_data_nn.py:Test data years: [2015]
INFO:transform_data_nn.py:Test_data: (39863, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]
INFO:transform_data_nn.py:Retrain_data: (1748287, 161)

INFO:transform_data_nn.py:Prediction data years: [2016]
INFO:transform_data_nn.py:Prediction_data: (40029, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1708424, 152])
            y_train_tf: torch.Size([1708424])

            x_test_tf: torch.Size([39863, 152])
            y_test_tf: torch.Size([39863])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1748287, 152])
            y_retrain_tf: torch.Size([1748287])

            x_prediction_tf: torch.Size([40029, 152])
            y_prediction_tf: torch.Size([40029])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:Create test_dataset
INFO:main.py:Create retrain_dataset
INFO:main.py:Create prediction_dataset
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:main.py:Testing data year: 2015
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 150
            max_num_epochs: 50
            num_cpus: 26
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 16336
            device: cpu
            
2024-08-30 06:05:35,252	INFO worker.py:1753 -- Started a local Ray instance.
2024-08-30 06:05:35,303	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-08-30 06:05:35,350	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_135ba0bdaf57e9d1.zip' (5.17MiB) to Ray cluster...
2024-08-30 06:05:35,364	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_135ba0bdaf57e9d1.zip'.
2024-08-30 06:05:41,586	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-08-30 15:29:10,842	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-08-30_06-05-41' in 0.4261s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 16336, 'embedding_dim': 5, 'dropout_rate': 0.55, 'lr': 5.305997032947034e-06, 'weight_decay': 3.8068164029803815e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}
INFO:model_data_nn.py:Best trial training loss: 0.10952057965685107
INFO:model_data_nn.py:Best trial testing loss: 0.09030860428508508
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-08-30_06-05-32_408065_2457762/artifacts/2024-08-30_06-05-41/train_fnn_2024-08-30_06-05-41/driver_artifacts/train_fnn_8f571_00136_136_batch_size=32,dropout_rate=0.5500,embedding_dim=5,hidden_dim=5,lr=0.0000,num_layers=4,weight_decay=0.000_2024-08-30_06-05-42
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 16626, 'embedding_dim': 5, 'dropout_rate': 0.55, 'lr': 5.305997032947034e-06, 'weight_decay': 3.8068164029803815e-06, 'num_epochs': 50, 'num_gpus': 0, 'batch_size': 32}

INFO:model_data_nn.py:Epoch 1/50, metrics: {'avg_train_loss': 0.10928840019832882, 'avg_test_loss': 0.09921426447234946}
INFO:model_data_nn.py:Epoch 2/50, metrics: {'avg_train_loss': 0.10912914951768911, 'avg_test_loss': 0.09923093693016721}
INFO:model_data_nn.py:Epoch 3/50, metrics: {'avg_train_loss': 0.10912890972472179, 'avg_test_loss': 0.0992327317771175}
INFO:model_data_nn.py:Epoch 4/50, metrics: {'avg_train_loss': 0.10912871301114704, 'avg_test_loss': 0.09922162160801468}
INFO:model_data_nn.py:Epoch 5/50, metrics: {'avg_train_loss': 0.10912759382601414, 'avg_test_loss': 0.09917732690580838}
INFO:model_data_nn.py:Epoch 6/50, metrics: {'avg_train_loss': 0.10912623238682075, 'avg_test_loss': 0.09914243993141668}
INFO:model_data_nn.py:Epoch 7/50, metrics: {'avg_train_loss': 0.10912338868214491, 'avg_test_loss': 0.09916642015363625}
INFO:model_data_nn.py:Epoch 8/50, metrics: {'avg_train_loss': 0.1091193828060878, 'avg_test_loss': 0.09913152772531235}
INFO:model_data_nn.py:Epoch 9/50, metrics: {'avg_train_loss': 0.1091166252235804, 'avg_test_loss': 0.09908363700574108}
INFO:model_data_nn.py:Epoch 10/50, metrics: {'avg_train_loss': 0.10911256039086477, 'avg_test_loss': 0.09909455472831245}
INFO:model_data_nn.py:Epoch 11/50, metrics: {'avg_train_loss': 0.10910451599293922, 'avg_test_loss': 0.09908590378086392}
slurmstepd-yen16: error: *** JOB 447102 ON yen16 CANCELLED AT 2024-08-30T16:13:08 DUE TO TIME LIMIT ***
