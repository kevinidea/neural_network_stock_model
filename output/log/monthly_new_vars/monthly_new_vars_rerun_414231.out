Current working directory
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml
source kevin/venv/bin/activate
which python3
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/bin/python3
2024-07-15 19:34:06,226	PANIC scripts.py:900 -- `--address` is a required flag unless starting a head node with `--head`.
Error: `{}` is a required flag unless starting a head node with `{}`.
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
INFO:preprocess_data_nn.py:

Loading and preprocessing data...

DEBUG:preprocess_data_nn.py:          date   permno
626    1980-01  10006.0
5399   1980-01  10057.0
11398  1980-01  10137.0
12828  1980-01  10145.0
13984  1980-01  10153.0
DEBUG:preprocess_data_nn.py:--------------------------------------------------
INFO:main.py:preprocessed df: (2005900, 161)
INFO:preprocess_data_nn.py:

Applying secondary data preprocessing..

INFO:main.py:secondary preprocessed df: (1942951, 161)
INFO:main.py:df sample:     permno       pdate        ym  gvkey  sic2    absacc       acc    aeavol  ...      roaa      roea   roavola       ret        mve_m      retq  pyear     date
0  10006.0  1980-01-01  198001.0   1010    37  0.083420  0.083420  1.001090  ...  0.048684  0.141715  0.004512  0.211679   303420.750 -0.055806   1980  1980-01
1  10057.0  1980-01-01  198001.0   1098    36  0.088951  0.088951 -0.613146  ...  0.092434  0.174252  0.035698  0.282297   111423.125 -0.069431   1980  1980-01
2  10137.0  1980-01-01  198001.0   1279    49  0.041008  0.041008 -0.491307  ...  0.034895  0.097554  0.006254 -0.032258   617349.500 -0.108065   1980  1980-01
3  10145.0  1980-01-01  198001.0   1300    99  0.050486  0.050486 -0.256932  ...  0.049028  0.122729  0.004320  0.150127  1415193.000 -0.085950   1980  1980-01
4  10153.0  1980-01-01  198001.0   1308    13       NaN       NaN  1.631801  ...  0.049860  0.109950  0.009149 -0.122744   429488.500 -0.285199   1980  1980-01

[5 rows x 161 columns]
INFO:main.py:Train year start: 1980
INFO:main.py:Prediction data years: [1986, 1987, 1991, 1998, 1999, 2000, 2001, 2003, 2009, 2012, 2020]
INFO:main.py:

Loop through all the prediction years and build optimized model for each year

INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984]
INFO:transform_data_nn.py:Train_data: (149870, 161)

INFO:transform_data_nn.py:Test data years: [1985]
INFO:transform_data_nn.py:Test_data: (43492, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Retrain_data: (193362, 161)

INFO:transform_data_nn.py:Prediction data years: [1986]
INFO:transform_data_nn.py:Prediction_data: (43785, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([149870, 152])
            y_train_tf: torch.Size([149870])

            x_test_tf: torch.Size([43492, 152])
            y_test_tf: torch.Size([43492])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([193362, 152])
            y_retrain_tf: torch.Size([193362])

            x_prediction_tf: torch.Size([43785, 152])
            y_prediction_tf: torch.Size([43785])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-0.0054,  0.3203,  0.2194, -1.2084, -0.1250, -0.6240, -0.0916, -0.2813,
         0.1755, -0.1609, -0.7181, -0.2985, -0.4316, -0.1709,  0.1224,  0.6069,
        -0.1464,  0.0913,  0.0000,  0.5148, -0.3331,  0.1067, -0.0306, -0.0081,
        -0.1190, -0.2124, -0.5798,  0.0000,  0.4178,  0.7142,  0.4837, -0.1548,
         0.3823,  0.0000, -0.4281, -0.1804,  0.0945,  0.3886,  0.1901, -1.1776,
        -0.2458,  0.0141,  0.1895, -0.1257, -0.0936, -0.6817, -0.0587, -0.1134,
        -0.6202, -0.2558, -0.6133,  0.6308, -0.1811, -0.2689,  0.0209,  0.4466,
        -0.7806, -0.1405, -0.3113,  0.2011,  0.0943, -0.3883,  0.1554,  0.3174,
         0.2508, -0.0946,  0.1179, -0.0439,  0.6406, -0.4199,  0.0000,  0.0000,
         0.0000, -0.8552, -0.1174,  0.5194,  0.0462, -0.3339, -0.1861, -0.0368,
         0.0000,  0.5389, -0.0828, -0.0897, -0.5511, -0.0648, -0.0503, -0.3859,
        -0.1629,  0.1517, -0.4628, -1.2766,  0.0000,  0.7191,  1.4805,  1.0988,
        -0.1931,  0.5645, -1.7373, -1.0139, -1.1352,  0.3032,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0558, -0.2886,  0.0000, -1.3168, -0.9630, -1.2887,
         0.0878, -0.0825,  0.0000,  0.0000, -0.0100, -0.1309, -0.0592,  0.1436,
         0.2215, -0.4598, -0.4234,  0.0705,  0.2044, -0.4644,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([2256]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-4.1209e-02, -3.4561e-02,  6.9167e+00, -4.8258e-01, -4.2263e-02,
         1.8296e+00,  1.8592e+00,  2.1082e+00, -5.0464e-01, -4.7138e-01,
         1.1591e+00,  1.8816e-02,  2.0313e-01,  3.1117e-02,  8.6985e-03,
        -8.5387e-03, -2.2131e-01, -2.1334e+00,  0.0000e+00, -1.2459e-02,
        -2.5757e-01,  1.0670e-01,  8.9147e-03, -2.0070e-02, -1.0279e-02,
        -2.9700e-01,  2.4394e-02,  0.0000e+00, -1.3788e+00, -9.4805e-01,
         1.4267e+00, -4.3503e-02,  1.4899e-01,  0.0000e+00,  3.3403e+00,
         1.7326e-02,  1.5988e-02, -2.1585e-01, -1.7642e-01,  1.3349e+00,
        -8.7883e-02, -1.3674e+00, -1.6666e-02, -4.1929e-01, -2.3189e-02,
         3.1896e-01, -1.3621e+00,  1.6841e-01, -3.7548e-01, -1.5424e+00,
         2.8157e+00, -1.1174e+00, -9.7091e-02, -2.6889e-01,  7.8921e-01,
         3.4179e-01, -3.2325e-02,  2.3563e-02, -2.1498e-02,  4.2200e-02,
        -1.4704e-02, -2.0302e-02,  4.3394e-02,  4.9887e-02, -1.1005e-02,
         2.2852e-02, -2.4194e-02,  6.0221e-03,  6.4058e-01,  4.5177e-02,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  3.3045e-01,  3.1348e-01,
        -1.0899e-02, -2.0691e-01,  1.2023e+00,  6.9023e+00, -3.6842e-02,
         0.0000e+00,  2.5110e-02, -3.3694e-01, -9.2152e-01, -5.3683e-01,
        -6.5317e-02, -5.0028e-02, -5.2869e-02,  5.5624e-01, -2.6465e-02,
        -4.0950e-01,  1.9470e+00,  0.0000e+00, -6.6848e-01, -2.8689e-01,
        -1.0407e+00, -3.0734e+00, -1.0772e+00,  1.0322e+00, -1.1352e+00,
        -5.1966e-01, -3.7978e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00, -6.1909e-03,  2.3739e-01,  0.0000e+00,  6.3793e-01,
        -1.0868e+00,  9.2511e-01, -3.1371e-03, -8.2525e-02,  0.0000e+00,
         0.0000e+00,  3.2516e-02, -1.1784e-02, -5.9187e-02, -1.3858e-02,
         3.9036e-02,  5.0149e-01,  9.5115e-02,  5.3401e-01,  2.4000e-01,
        -4.4588e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([102]), tensor(0.3115))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.0606e-01,  2.1628e-01,  1.8668e-01, -1.2410e+00, -1.4494e-01,
        -6.0633e-01, -1.0954e-01, -2.9638e-01,  2.3780e-01, -1.6025e-01,
        -7.1284e-01, -1.8976e-01, -4.4614e-01, -9.4623e-02,  9.0774e-02,
         5.5178e-01, -1.4248e-01,  8.6219e-02,  0.0000e+00,  4.3647e-01,
        -3.7530e-01, -2.5503e-01,  1.0047e-02,  1.1415e-03, -1.0654e-01,
        -2.2533e-01, -5.9233e-01,  0.0000e+00,  4.2527e-01,  8.0503e-01,
         4.9132e-01, -1.4382e-01,  3.9378e-01,  0.0000e+00, -4.2043e-01,
        -1.8670e-01,  7.8142e-02,  4.4022e-01,  1.0672e-01, -1.1782e+00,
        -2.5288e-01,  9.5831e-02,  1.3909e-01, -1.0046e-01, -1.3948e-01,
        -6.6383e-01, -1.2032e-02, -1.1862e-01, -6.2645e-01, -2.4628e-01,
        -6.1617e-01,  6.5491e-01, -1.8197e-01, -2.1855e-01,  2.0195e-02,
         4.4404e-01, -7.7944e-01, -1.0039e-01, -2.7536e-01,  1.6007e-01,
         9.5258e-02, -3.4429e-01,  1.6728e-01,  3.0232e-01,  2.1065e-01,
        -9.3216e-02,  6.5847e-02, -5.5111e-02,  6.5773e-01, -4.1490e-01,
         0.0000e+00,  0.0000e+00, -1.9328e-01, -8.2029e-01, -6.4020e-02,
         5.3669e-01,  4.6422e-02, -3.4006e-01, -1.8259e-01, -1.4627e-02,
         0.0000e+00,  4.0856e-01, -3.2098e-02, -1.7225e-01, -5.5690e-01,
        -7.2067e-02, -5.7593e-02, -3.7818e-01, -1.6905e-01,  1.5664e-01,
        -4.8309e-01, -1.2800e+00, -3.2037e+00,  9.6812e-01,  1.7009e+00,
         1.3394e+00,  3.1469e-01,  8.2406e-01, -2.0144e+00, -8.0466e-01,
        -1.0104e+00,  1.9333e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.9434e-02, -1.3831e-01,  0.0000e+00, -1.4905e+00,
        -4.0360e-01, -1.5524e+00,  1.0246e-01, -2.3560e-02,  0.0000e+00,
         0.0000e+00,  8.3697e-03, -1.5481e-01, -7.6564e-02,  1.0933e-01,
         2.4903e-01, -4.4572e-01, -4.1504e-01,  1.0480e-01,  2.1010e-01,
        -3.8213e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2503]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-4.7975e-01, -1.6167e+00, -5.5251e-01, -1.7881e-03,  4.3567e+00,
        -3.5114e-01,  1.3639e+00,  1.3271e+00, -9.6472e-01, -9.5801e-01,
        -4.1834e-03, -1.9898e-01,  2.2943e-01,  5.7273e-01,  2.5503e+00,
        -1.0944e-03, -2.1737e-01, -3.3214e-01,  0.0000e+00, -5.0717e-02,
        -2.9242e-01, -2.5503e-01,  1.4144e-02,  3.5297e-01,  1.5825e+00,
        -9.2067e-01, -3.0061e-01,  0.0000e+00,  8.4623e-02, -8.8211e-01,
         9.6014e-04,  2.5318e-01, -4.3382e-02,  0.0000e+00,  1.1384e+00,
        -1.3600e-02,  2.4599e+00, -2.5919e-01,  7.5326e-02,  7.4560e-01,
        -2.5262e-01, -4.8858e-01,  1.6070e+00, -3.6384e-01,  5.7743e+00,
        -7.7914e-02,  2.5166e+00,  4.2342e-01, -1.0561e+00,  1.3393e+00,
         8.0689e-01, -4.6382e-01, -1.0910e-01, -2.1855e-01,  7.7845e-01,
         2.3948e-01,  2.1400e+00, -7.6941e-02, -2.0483e+00, -1.8413e+00,
         4.9467e-02, -1.7352e+00, -1.0563e+00, -1.6353e+00,  5.2063e-02,
        -8.4755e-01, -8.5137e-01, -2.4456e-01, -8.7060e-03, -6.8216e-01,
         0.0000e+00,  0.0000e+00,  7.7087e+00, -6.7828e-01, -2.7095e-01,
         1.2457e-02, -2.2114e-01,  6.3579e-01,  6.9452e+00, -1.4627e-02,
         0.0000e+00,  3.0474e-01, -6.1411e-01,  1.0833e+00,  1.5821e+00,
        -6.0828e-02, -5.2250e-02, -2.7738e-01, -1.1855e+00,  4.7502e-01,
         1.8004e+00, -7.8204e-01, -3.2037e+00, -1.9508e+00, -1.9736e+00,
        -1.5938e+00, -1.1760e+00, -1.1428e+00,  2.3535e-01, -5.5798e-01,
        -3.2455e-01, -1.6361e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0372e-02, -6.3615e-02,  0.0000e+00, -8.4418e-02,
        -1.2895e+00,  8.1146e-01, -1.2125e-03, -2.3560e-02,  0.0000e+00,
         0.0000e+00, -1.7574e+00,  1.4393e+00, -7.6564e-02,  1.3622e+00,
        -3.0531e-03, -4.9288e-01, -1.1785e+00, -7.6976e-02,  1.1980e-01,
         4.8359e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00]), tensor([107]), tensor(0.))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984]
INFO:main.py:Testing data year: 1985
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 30
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 4258
            device: cpu
            
2024-07-15 20:01:11,662	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-15 20:01:11,700	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-15 20:01:11,736	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-15 20:01:11,742	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-15 20:01:13,978	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-15 20:03:33,210	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_20-01-13' in 0.1383s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 4, 'num_embeddings': 4258, 'embedding_dim': 5, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 5.891087281171031e-05, 'num_epochs': 30, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.016052707767514544
INFO:model_data_nn.py:Best trial testing loss: 0.0194431281182915
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-15_20-01-08_514143_2708215/artifacts/2024-07-15_20-01-13/train_fnn_2024-07-15_20-01-13/driver_artifacts/train_fnn_a98c6_00044_44_dropout_rate=0.5200,embedding_dim=5,hidden_dim=25,lr=0.0100,num_layers=4,weight_decay=0.0001_2024-07-15_20-01-14
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 4, 'num_embeddings': 4766, 'embedding_dim': 5, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 5.891087281171031e-05, 'num_epochs': 30, 'num_gpus': 0}

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/cuda/__init__.py:619: UserWarning: Can't initialize NVML
  warnings.warn("Can't initialize NVML")
INFO:model_data_nn.py:Epoch 1/30, metrics: {'avg_train_loss': 3.3674447418242277, 'avg_test_loss': 0.027427588399976145}
INFO:model_data_nn.py:Epoch 2/30, metrics: {'avg_train_loss': 0.01751642175038498, 'avg_test_loss': 0.021170507753701058}
INFO:model_data_nn.py:Epoch 3/30, metrics: {'avg_train_loss': 0.01663336514805754, 'avg_test_loss': 0.021041311708084025}
INFO:model_data_nn.py:Epoch 4/30, metrics: {'avg_train_loss': 0.01685161163251867, 'avg_test_loss': 0.021067259470434037}
INFO:model_data_nn.py:Epoch 5/30, metrics: {'avg_train_loss': 0.017705921156371318, 'avg_test_loss': 0.021111086985572826}
INFO:model_data_nn.py:Epoch 6/30, metrics: {'avg_train_loss': 0.018061107841305553, 'avg_test_loss': 0.021376151472416727}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 1986
INFO:main.py:Prediction data shape: (43785,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:356: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  
INFO:main.py:Root Mean Squared Error for Prediction in 1986: 0.14636356511162624
INFO:main.py:Prediction Stats:                 ret          pred
count  43785.000000  43785.000000
mean       0.007006      0.024854
std        0.144800      0.010777
min       -0.808824     -0.136937
25%       -0.068966      0.019667
50%        0.000000      0.024672
75%        0.070270      0.030725
max        3.600000      0.088530
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:transform_data_nn.py:Train_data: (193362, 161)

INFO:transform_data_nn.py:Test data years: [1986]
INFO:transform_data_nn.py:Test_data: (43785, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:transform_data_nn.py:Retrain_data: (237147, 161)

INFO:transform_data_nn.py:Prediction data years: [1987]
INFO:transform_data_nn.py:Prediction_data: (44352, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([193362, 152])
            y_train_tf: torch.Size([193362])

            x_test_tf: torch.Size([43785, 152])
            y_test_tf: torch.Size([43785])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([237147, 152])
            y_retrain_tf: torch.Size([237147])

            x_prediction_tf: torch.Size([44352, 152])
            y_prediction_tf: torch.Size([44352])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.0606e-01,  2.1628e-01,  1.8668e-01, -1.2410e+00, -1.4494e-01,
        -6.0633e-01, -1.0954e-01, -2.9638e-01,  2.3780e-01, -1.6025e-01,
        -7.1284e-01, -1.8976e-01, -4.4614e-01, -9.4623e-02,  9.0774e-02,
         5.5178e-01, -1.4248e-01,  8.6219e-02,  0.0000e+00,  4.3647e-01,
        -3.7530e-01, -2.5503e-01,  1.0047e-02,  1.1415e-03, -1.0654e-01,
        -2.2533e-01, -5.9233e-01,  0.0000e+00,  4.2527e-01,  8.0503e-01,
         4.9132e-01, -1.4382e-01,  3.9378e-01,  0.0000e+00, -4.2043e-01,
        -1.8670e-01,  7.8142e-02,  4.4022e-01,  1.0672e-01, -1.1782e+00,
        -2.5288e-01,  9.5831e-02,  1.3909e-01, -1.0046e-01, -1.3948e-01,
        -6.6383e-01, -1.2032e-02, -1.1862e-01, -6.2645e-01, -2.4628e-01,
        -6.1617e-01,  6.5491e-01, -1.8197e-01, -2.1855e-01,  2.0195e-02,
         4.4404e-01, -7.7944e-01, -1.0039e-01, -2.7536e-01,  1.6007e-01,
         9.5258e-02, -3.4429e-01,  1.6728e-01,  3.0232e-01,  2.1065e-01,
        -9.3216e-02,  6.5847e-02, -5.5111e-02,  6.5773e-01, -4.1490e-01,
         0.0000e+00,  0.0000e+00, -1.9328e-01, -8.2029e-01, -6.4020e-02,
         5.3669e-01,  4.6422e-02, -3.4006e-01, -1.8259e-01, -1.4627e-02,
         0.0000e+00,  4.0856e-01, -3.2098e-02, -1.7225e-01, -5.5690e-01,
        -7.2067e-02, -5.7593e-02, -3.7818e-01, -1.6905e-01,  1.5664e-01,
        -4.8309e-01, -1.2800e+00, -3.2037e+00,  9.6812e-01,  1.7009e+00,
         1.3394e+00,  3.1469e-01,  8.2406e-01, -2.0144e+00, -8.0466e-01,
        -1.0104e+00,  1.9333e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.9434e-02, -1.3831e-01,  0.0000e+00, -1.4905e+00,
        -4.0360e-01, -1.5524e+00,  1.0246e-01, -2.3560e-02,  0.0000e+00,
         0.0000e+00,  8.3697e-03, -1.5481e-01, -7.6564e-02,  1.0933e-01,
         2.4903e-01, -4.4572e-01, -4.1504e-01,  1.0480e-01,  2.1010e-01,
        -3.8213e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2503]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-4.7975e-01, -1.6167e+00, -5.5251e-01, -1.7881e-03,  4.3567e+00,
        -3.5114e-01,  1.3639e+00,  1.3271e+00, -9.6472e-01, -9.5801e-01,
        -4.1834e-03, -1.9898e-01,  2.2943e-01,  5.7273e-01,  2.5503e+00,
        -1.0944e-03, -2.1737e-01, -3.3214e-01,  0.0000e+00, -5.0717e-02,
        -2.9242e-01, -2.5503e-01,  1.4144e-02,  3.5297e-01,  1.5825e+00,
        -9.2067e-01, -3.0061e-01,  0.0000e+00,  8.4623e-02, -8.8211e-01,
         9.6014e-04,  2.5318e-01, -4.3382e-02,  0.0000e+00,  1.1384e+00,
        -1.3600e-02,  2.4599e+00, -2.5919e-01,  7.5326e-02,  7.4560e-01,
        -2.5262e-01, -4.8858e-01,  1.6070e+00, -3.6384e-01,  5.7743e+00,
        -7.7914e-02,  2.5166e+00,  4.2342e-01, -1.0561e+00,  1.3393e+00,
         8.0689e-01, -4.6382e-01, -1.0910e-01, -2.1855e-01,  7.7845e-01,
         2.3948e-01,  2.1400e+00, -7.6941e-02, -2.0483e+00, -1.8413e+00,
         4.9467e-02, -1.7352e+00, -1.0563e+00, -1.6353e+00,  5.2063e-02,
        -8.4755e-01, -8.5137e-01, -2.4456e-01, -8.7060e-03, -6.8216e-01,
         0.0000e+00,  0.0000e+00,  7.7087e+00, -6.7828e-01, -2.7095e-01,
         1.2457e-02, -2.2114e-01,  6.3579e-01,  6.9452e+00, -1.4627e-02,
         0.0000e+00,  3.0474e-01, -6.1411e-01,  1.0833e+00,  1.5821e+00,
        -6.0828e-02, -5.2250e-02, -2.7738e-01, -1.1855e+00,  4.7502e-01,
         1.8004e+00, -7.8204e-01, -3.2037e+00, -1.9508e+00, -1.9736e+00,
        -1.5938e+00, -1.1760e+00, -1.1428e+00,  2.3535e-01, -5.5798e-01,
        -3.2455e-01, -1.6361e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0372e-02, -6.3615e-02,  0.0000e+00, -8.4418e-02,
        -1.2895e+00,  8.1146e-01, -1.2125e-03, -2.3560e-02,  0.0000e+00,
         0.0000e+00, -1.7574e+00,  1.4393e+00, -7.6564e-02,  1.3622e+00,
        -3.0531e-03, -4.9288e-01, -1.1785e+00, -7.6976e-02,  1.1980e-01,
         4.8359e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00]), tensor([107]), tensor(0.))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-0.1378,  0.2011,  0.1735, -1.2736, -0.1414, -0.6129, -0.1248, -0.3115,
         0.2968, -0.1604, -0.7119, -0.1284, -0.4702, -0.0566,  0.0624,  0.5452,
        -0.1485,  0.1085,  0.0000,  0.4475, -0.3672, -0.2125,  0.0325,  0.0146,
        -0.0833, -0.2362, -0.5806,  0.0000,  0.3954,  0.8854,  0.4877, -0.1312,
         0.4150,  0.0000, -0.4067, -0.2013,  0.0756,  0.4689,  0.0805, -1.1706,
        -0.2576,  0.0846,  0.1459, -0.0784, -0.1491, -0.6672, -0.0211, -0.1119,
        -0.5597, -0.2513, -0.6202,  0.6533, -0.1762, -0.0731,  0.0316,  0.4455,
        -0.7773, -0.0479, -0.2733,  0.0933,  0.1035, -0.3434,  0.1623,  0.2965,
         0.2079, -0.1035,  0.0400, -0.0618,  0.7032, -0.4171,  0.0000,  0.0000,
         0.0282, -0.8190, -0.0195,  0.5824,  0.0410, -0.3436, -0.1796, -0.0104,
         0.0000,  0.3771,  0.0150, -0.2020, -0.5611, -0.0783, -0.0633, -0.3700,
        -0.1631,  0.1329, -0.5081, -1.2896,  0.2434,  1.0516,  1.6154,  1.4313,
         0.4921,  1.0178, -2.2250, -0.7145, -1.0838,  0.1765,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0681,  0.1245,  0.0000, -1.6484, -0.1374, -1.7709,
         0.1165,  0.0567,  0.0000,  0.0000,  0.0141, -0.1652, -0.0921,  0.0665,
         0.2107, -0.4339, -0.4025,  0.1455,  0.2247, -0.3825,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([4531]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([ 1.8020e+00,  1.9152e+00,  3.4486e-01, -1.8913e-01,  1.3689e+00,
         2.6924e+00, -8.9300e-01, -7.8639e-01, -4.9107e-01, -6.5433e-01,
        -5.3155e-01, -1.2724e-01,  2.2762e-01, -3.8230e-01,  1.8586e+00,
         2.3049e+00, -2.2689e-01,  3.8296e+00,  0.0000e+00,  3.2700e+00,
         5.0575e-03, -2.1251e-01,  2.0621e-02, -2.5567e-03,  6.3772e-02,
         1.0327e+00,  2.0287e+00,  0.0000e+00, -1.3956e+00, -8.2966e-01,
        -4.6975e-01, -1.4919e-01,  4.2877e-02,  0.0000e+00,  1.2218e+00,
        -2.0587e-01,  2.0151e-01,  5.4386e-01,  4.6245e+00, -5.7104e-01,
         3.3704e-01, -5.3257e-01,  2.2907e+00, -3.5756e-01,  2.8893e+00,
        -1.0363e+00, -2.0763e-01, -1.0985e+00, -6.9351e-01,  1.0851e-01,
        -6.2015e-01, -1.1060e+00, -1.3256e-01, -7.3100e-02, -7.3521e-01,
         4.8096e-02,  1.0329e+00, -3.2643e-01,  6.0915e-01,  3.3914e+00,
         1.9910e-01,  6.6620e-01,  8.5977e-01,  5.6841e-01, -1.9664e+00,
         3.9913e-01,  1.1799e+00, -6.0768e-01, -1.2768e+00, -3.7900e-01,
         0.0000e+00,  0.0000e+00,  2.8222e-02, -6.5080e-01, -1.0827e-01,
         1.6211e+00, -7.8200e-02, -3.9600e-01,  2.2145e-01, -9.8606e-01,
         0.0000e+00,  2.3511e+00, -2.7285e-01,  1.9970e+00, -6.8303e-02,
        -4.8069e-02, -4.9363e-02, -3.5668e-01, -2.2977e-01, -1.3200e-01,
        -6.0629e-01,  3.0339e+00,  2.4336e-01, -1.5991e+00, -1.6971e+00,
        -1.5188e+00, -6.1921e-01, -1.3641e+00,  1.8554e-01, -2.9779e-01,
        -3.4293e-01,  1.8998e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6694e-02,  1.2451e-01,  0.0000e+00,  7.3645e-01,
        -1.3529e+00,  3.0857e-01, -2.1738e-02,  5.6721e-02,  0.0000e+00,
         0.0000e+00,  2.7793e+00,  5.4316e-01, -9.2059e-02,  3.3375e-01,
         1.7586e+00,  4.1795e-01, -6.4637e-02,  4.0987e-03,  4.2907e-02,
         3.3521e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([391]), tensor(0.0417))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985]
INFO:main.py:Testing data year: 1986
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 30
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 4766
            device: cpu
            
2024-07-15 20:37:24,838	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-15 20:37:24,918	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-15 20:37:24,965	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-15 20:37:24,974	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-15 20:37:27,651	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-15 20:41:32,909	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_20-37-27' in 0.1691s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 2, 'num_embeddings': 4766, 'embedding_dim': 20, 'dropout_rate': 0.54, 'lr': 0.01, 'weight_decay': 0.0008692991511139556, 'num_epochs': 30, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.01639865819862477
INFO:model_data_nn.py:Best trial testing loss: 0.021124308885529984
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-15_20-37-21_979083_2708215/artifacts/2024-07-15_20-37-27/train_fnn_2024-07-15_20-37-27/driver_artifacts/train_fnn_b92eb_00009_9_dropout_rate=0.5400,embedding_dim=20,hidden_dim=55,lr=0.0100,num_layers=2,weight_decay=0.0009_2024-07-15_20-37-27
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 2, 'num_embeddings': 5109, 'embedding_dim': 20, 'dropout_rate': 0.54, 'lr': 0.01, 'weight_decay': 0.0008692991511139556, 'num_epochs': 30, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/30, metrics: {'avg_train_loss': 1.969243148195094, 'avg_test_loss': 0.03098557910335989}
INFO:model_data_nn.py:Epoch 2/30, metrics: {'avg_train_loss': 0.018747154447454013, 'avg_test_loss': 0.03134343802029717}
INFO:model_data_nn.py:Epoch 3/30, metrics: {'avg_train_loss': 0.019816721062162868, 'avg_test_loss': 0.031470314813670755}
INFO:model_data_nn.py:Epoch 4/30, metrics: {'avg_train_loss': 0.021752246259686567, 'avg_test_loss': 0.03484599069082018}
INFO:model_data_nn.py:Early stopping at epoch 4
INFO:main.py:Making prediction for data in year: 1987
INFO:main.py:Prediction data shape: (44352,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:356: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  
INFO:main.py:Root Mean Squared Error for Prediction in 1987: 0.18636944798632346
INFO:main.py:Prediction Stats:                 ret          pred
count  44352.000000  44352.000000
mean      -0.003042      0.055609
std        0.172848      0.043135
min       -0.875000     -0.229417
25%       -0.079210      0.032717
50%        0.000000      0.045820
75%        0.077401      0.066113
max        2.750000      0.699778
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:transform_data_nn.py:Train_data: (375885, 161)

INFO:transform_data_nn.py:Test data years: [1990]
INFO:transform_data_nn.py:Test_data: (46774, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:transform_data_nn.py:Retrain_data: (422659, 161)

INFO:transform_data_nn.py:Prediction data years: [1991]
INFO:transform_data_nn.py:Prediction_data: (47150, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([375885, 152])
            y_train_tf: torch.Size([375885])

            x_test_tf: torch.Size([46774, 152])
            y_test_tf: torch.Size([46774])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([422659, 152])
            y_retrain_tf: torch.Size([422659])

            x_prediction_tf: torch.Size([47150, 152])
            y_prediction_tf: torch.Size([47150])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.8972e-01,  2.6420e-01,  1.5363e-01, -1.3069e+00, -1.4162e-01,
        -6.3605e-01, -1.6024e-01, -3.3749e-01,  3.7729e-01, -1.5824e-01,
        -7.1147e-01, -2.1879e-02, -5.0366e-01, -4.2017e-02,  5.9299e-02,
         5.1382e-01, -1.3424e-01,  1.9280e-01, -1.6829e-02,  4.2506e-01,
        -3.7289e-01,  9.2791e-02,  3.2835e-02,  1.1438e-02, -6.5504e-02,
        -2.5784e-01, -5.7382e-01, -6.8662e-02,  3.8562e-01,  1.0585e+00,
         4.7048e-01, -1.0666e-01,  4.4478e-01,  9.8409e-02, -3.7696e-01,
        -1.9346e-01,  7.3482e-02,  5.4720e-01,  1.7244e-02, -1.1608e+00,
        -2.8468e-01,  2.8830e-01,  2.1189e-01, -6.6772e-02, -1.7456e-01,
        -6.7313e-01,  8.4234e-02, -8.6078e-02, -4.8579e-01, -1.9296e-01,
        -6.3076e-01,  6.6311e-01, -1.5736e-01, -9.1068e-02,  2.1848e-02,
         4.3744e-01, -7.6442e-01,  1.3773e-02, -2.5472e-01, -4.8971e-03,
         1.1931e-01, -3.1866e-01,  1.4727e-01,  2.7139e-01,  1.2354e-01,
        -1.2522e-01,  8.2618e-02, -8.0370e-02,  7.3884e-01, -4.1938e-01,
         0.0000e+00,  0.0000e+00, -1.4421e-01, -8.1085e-01,  5.6494e-02,
         5.8140e-01,  3.9013e-02, -3.4606e-01, -1.8280e-01,  7.9242e-04,
        -2.2414e-02,  2.5705e-01,  6.6266e-02, -2.8663e-01, -5.5589e-01,
        -9.6492e-02, -7.8649e-02, -3.5369e-01, -1.2660e-01,  1.1666e-01,
        -5.1295e-01, -1.2772e+00,  1.3821e-02,  1.3845e+00,  1.8870e+00,
         1.7755e+00,  7.0894e-01,  1.4378e+00, -2.4874e+00, -2.2063e-01,
        -2.9489e-01,  1.0297e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.4179e-02,  2.6416e-01,  0.0000e+00, -1.2481e+00,
         4.0861e-01, -2.3284e+00,  1.3995e-01,  3.2667e-02,  0.0000e+00,
         0.0000e+00,  1.9527e-02, -1.8033e-01,  6.7643e-03, -1.7292e-02,
         6.7000e-02, -4.3188e-01, -3.7835e-01,  2.1099e-01,  2.4922e-01,
        -3.9976e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([5832]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([ 1.8820e-02,  8.3680e-02, -7.9874e-01, -1.1744e-01,  8.1926e-01,
        -7.0996e-01, -1.9966e+00, -1.0775e+00, -3.6405e-01, -1.3855e-01,
        -1.6774e-02,  9.3288e-03, -4.2412e-02, -6.4712e-02,  3.6116e-02,
         5.4810e-01, -1.9479e-01,  7.7155e-01,  4.5852e-01,  8.7119e-03,
         7.4209e-01, -1.8899e-01,  5.2501e-02, -4.2265e-01,  5.2064e-01,
        -6.4386e-03, -7.2439e-01, -6.8662e-02, -8.0948e-01,  4.1203e-02,
         1.8714e-01,  1.3541e-02,  3.3481e-01,  9.8409e-02, -1.4494e-03,
        -1.1368e+00,  1.3192e-02, -7.0466e-01,  6.3335e-01, -7.0855e-01,
        -1.4501e-01,  1.5804e-01,  1.2192e-02,  2.3968e-02, -3.7000e-03,
        -4.4552e-01,  9.5932e-01,  2.0401e-01, -4.1580e-01,  1.2171e+00,
         1.6730e+00, -1.1007e+00, -6.2636e-01, -1.2679e+00, -7.4223e-01,
         8.0022e-03, -1.0893e+00,  1.1615e+00, -7.9993e-04,  6.2808e-02,
        -3.9909e-03, -2.7642e-04,  9.0410e-03,  1.8528e-02, -1.0378e-02,
         3.0594e-05,  5.1983e-02, -2.5582e+00,  8.5946e-02, -1.0104e-02,
         0.0000e+00,  0.0000e+00, -1.4421e-01, -5.5099e-01,  1.1204e-02,
         3.0825e-01,  9.9530e-04, -1.9123e-03,  2.5390e-03,  7.9242e-04,
         1.9376e-01,  6.0692e-01, -1.5442e-01,  2.0061e-02, -4.6656e-01,
        -8.4911e-02, -7.3589e-02,  3.1820e-02,  5.3414e-03,  2.8129e-01,
        -5.4592e-01, -1.2772e+00,  1.3821e-02, -1.1170e+00, -8.8277e-01,
        -1.2188e+00, -5.4814e-01, -2.8496e-01, -9.4263e-01, -1.1195e+00,
        -2.3083e-01,  1.6644e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.6646e-02,  3.1921e-01,  0.0000e+00, -9.3808e-01,
        -9.4247e-01,  2.4640e-01,  1.1855e-01,  3.2667e-02,  0.0000e+00,
         0.0000e+00,  1.1356e-02,  2.3742e-01,  6.7643e-03, -1.8907e-02,
        -5.7504e-02,  4.7245e-04, -2.3224e-02,  3.4302e-01,  3.7060e-01,
        -2.7359e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([3931]), tensor(-0.0185))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.7425e-01,  3.7754e-01,  1.4934e-01, -1.3170e+00, -1.3253e-01,
        -6.4465e-01, -1.6967e-01, -3.4584e-01,  3.4598e-01, -1.5492e-01,
        -7.0767e-01, -1.1320e-02, -4.9315e-01, -1.1341e-01,  7.7373e-02,
         5.1234e-01, -1.2838e-01,  1.9862e-01, -4.8695e-02,  4.3362e-01,
        -3.5150e-01,  3.8941e-02,  3.6587e-02,  1.5554e-02, -5.9349e-02,
        -2.6173e-01, -5.6831e-01, -2.7338e-04,  3.9550e-01,  1.0619e+00,
         4.6676e-01, -9.5131e-02,  4.4205e-01,  8.6933e-03, -3.7636e-01,
        -1.9066e-01,  7.8067e-02,  5.6022e-01,  1.4630e-02, -1.1506e+00,
        -2.9475e-01,  3.6848e-01,  2.3401e-01, -8.0414e-02, -1.7311e-01,
        -6.7188e-01,  1.2521e-01, -5.8672e-02, -4.5347e-01, -1.4579e-01,
        -6.4478e-01,  6.6964e-01, -1.5089e-01, -6.6906e-02,  2.4691e-02,
         4.3137e-01, -7.5919e-01,  3.8151e-02, -2.5174e-01, -1.8652e-02,
         1.2382e-01, -3.1448e-01,  1.4006e-01,  2.6348e-01,  1.1506e-01,
        -1.3377e-01,  1.6539e-01, -8.0429e-02,  7.3199e-01, -4.2069e-01,
         0.0000e+00,  0.0000e+00, -9.4989e-02, -8.0793e-01,  6.9545e-02,
         5.7868e-01,  3.3156e-02, -3.4722e-01, -1.8260e-01,  3.4026e-03,
        -6.5914e-03,  2.4846e-01,  4.3762e-02, -3.1158e-01, -5.5520e-01,
        -1.0190e-01, -8.3315e-02, -3.4428e-01, -1.0836e-01,  1.3599e-01,
        -5.0767e-01, -1.2661e+00,  3.9227e-03,  1.4985e+00,  2.0153e+00,
         1.9005e+00,  7.5873e-01,  1.5519e+00, -2.5355e+00, -1.0712e-01,
        -3.0477e-01,  1.0635e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0060e-02,  2.7572e-01,  0.0000e+00, -1.1510e+00,
         5.3159e-01, -2.2985e+00,  1.4497e-01,  3.1339e-02,  0.0000e+00,
         0.0000e+00,  1.4065e-02, -1.8017e-01,  9.3949e-03, -3.9383e-02,
         3.7427e-02, -4.3923e-01, -3.6782e-01,  2.2340e-01,  2.5535e-01,
        -4.0639e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([6053]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([ 1.2993e-02,  7.0280e-02,  5.4580e-01,  1.4098e-01, -3.7937e-01,
        -3.2199e-01, -2.0970e+00, -1.0822e+00, -2.2737e-01, -3.1425e-01,
        -1.5613e-02,  5.8420e-03, -2.8197e-02, -5.8125e-02,  3.6224e-02,
        -1.3633e+00, -1.4110e-01,  5.8407e-02,  1.1676e-01,  1.4697e-02,
         6.4857e-02, -1.1747e-01,  5.8770e-01, -2.9751e-01, -3.5050e-01,
        -6.5498e-03, -6.6369e-01, -2.7338e-04, -1.0685e+00,  2.7080e-02,
        -2.0452e-01, -4.7176e-02,  2.9836e-01,  8.6933e-03, -5.4638e-04,
        -5.2011e-01,  7.9955e-03, -7.1260e-01, -1.1614e-01, -9.4484e-01,
         6.9123e-02, -7.7512e-01,  1.3185e-02,  1.1272e-02,  7.3407e-04,
         6.7760e-02, -2.7334e-01, -4.8967e-02,  7.1605e-01, -1.4864e-01,
         9.0603e-01, -1.0786e+00, -5.5943e-01, -9.6500e-01, -7.4081e-01,
         7.2555e-03, -1.0852e+00, -3.4742e-01, -2.2293e-03,  1.3772e-01,
        -5.0189e-03, -3.0738e-03,  9.1674e-03,  1.3885e-02, -7.3406e-03,
         7.6830e-04,  4.4575e-02, -4.2739e-01,  7.5308e-02, -9.8693e-03,
         0.0000e+00,  0.0000e+00, -9.4989e-02,  1.4364e-02,  9.7428e-03,
        -3.9122e-01,  1.5581e-03, -2.7052e-03,  7.7936e-04,  3.4026e-03,
         1.6028e-01, -5.3828e-01, -1.7883e-01,  6.0396e-01, -4.9598e-01,
        -9.2094e-02, -7.8620e-02,  2.6062e-02,  4.3028e-03,  1.0161e-01,
        -6.5284e-01,  9.4613e-01,  3.9227e-03, -2.9295e-01, -8.0607e-01,
        -7.0806e-01,  4.3613e-02, -6.3081e-01, -1.5640e-01,  4.2306e-02,
        -2.5627e-01,  9.5470e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.8296e-02,  2.1888e-01,  0.0000e+00, -1.0606e+00,
        -1.5565e+00, -1.9042e+00,  1.1952e-01,  3.1339e-02,  0.0000e+00,
         0.0000e+00,  1.1698e-02, -2.3071e-01,  9.3949e-03, -1.7782e-02,
         8.5195e-03,  7.6178e-05, -1.4510e-02,  2.6743e-01,  2.6624e-01,
        -2.8328e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([3952]), tensor(0.0132))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:main.py:Testing data year: 1990
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 30
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 6562
            device: cpu
            
2024-07-15 21:40:04,876	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-15 21:40:04,930	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-15 21:40:04,963	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-15 21:40:04,969	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-15 21:40:09,692	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-15 21:45:30,811	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_21-40-09' in 0.1352s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 6562, 'embedding_dim': 5, 'dropout_rate': 0.44, 'lr': 0.007, 'weight_decay': 8.707410675803571e-05, 'num_epochs': 30, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.019973133236088667
INFO:model_data_nn.py:Best trial testing loss: 0.032714134245052366
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-15_21-40-01_622983_2708215/artifacts/2024-07-15_21-40-09/train_fnn_2024-07-15_21-40-09/driver_artifacts/train_fnn_7b88a_00042_42_dropout_rate=0.4400,embedding_dim=5,hidden_dim=25,lr=0.0070,num_layers=1,weight_decay=0.0001_2024-07-15_21-40-09
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 1, 'num_embeddings': 6817, 'embedding_dim': 5, 'dropout_rate': 0.44, 'lr': 0.007, 'weight_decay': 8.707410675803571e-05, 'num_epochs': 30, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/30, metrics: {'avg_train_loss': 0.5927707659961209, 'avg_test_loss': 0.047503023297601456}
INFO:model_data_nn.py:Epoch 2/30, metrics: {'avg_train_loss': 0.022133975082864087, 'avg_test_loss': 0.04709271909417333}
INFO:model_data_nn.py:Epoch 3/30, metrics: {'avg_train_loss': 0.023023052504128318, 'avg_test_loss': 0.048966512647834984}
INFO:model_data_nn.py:Epoch 4/30, metrics: {'avg_train_loss': 0.022453828286334476, 'avg_test_loss': 0.058166354431493865}
INFO:model_data_nn.py:Epoch 5/30, metrics: {'avg_train_loss': 0.022030600925037055, 'avg_test_loss': 0.0600238709786051}
INFO:model_data_nn.py:Early stopping at epoch 5
INFO:main.py:Making prediction for data in year: 1991
INFO:main.py:Prediction data shape: (47150,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:356: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  
INFO:main.py:Root Mean Squared Error for Prediction in 1991: 0.24499312623428057
INFO:main.py:Prediction Stats:                 ret          pred
count  47150.000000  47150.000000
mean       0.038270     -0.065917
std        0.216332      0.060662
min       -0.937500     -0.599439
25%       -0.058140     -0.103136
50%        0.011494     -0.060645
75%        0.100000     -0.016907
max        9.000000      0.090697
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:transform_data_nn.py:Train_data: (756335, 161)

INFO:transform_data_nn.py:Test data years: [1997]
INFO:transform_data_nn.py:Test_data: (69689, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:transform_data_nn.py:Retrain_data: (826024, 161)

INFO:transform_data_nn.py:Prediction data years: [1998]
INFO:transform_data_nn.py:Prediction_data: (70794, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([756335, 152])
            y_train_tf: torch.Size([756335])

            x_test_tf: torch.Size([69689, 152])
            y_test_tf: torch.Size([69689])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([826024, 152])
            y_retrain_tf: torch.Size([826024])

            x_prediction_tf: torch.Size([70794, 152])
            y_prediction_tf: torch.Size([70794])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.4631e-01,  7.0476e-01,  8.0238e-02, -1.2704e+00, -1.3231e-01,
        -7.2684e-01, -1.7092e-01, -3.6127e-01,  4.2792e-01, -1.6026e-01,
        -6.9211e-01,  5.6735e-02, -4.9922e-01, -3.4349e-01,  1.2150e-01,
         4.9917e-01, -1.4035e-01,  2.3843e-01, -7.0488e-02,  4.7859e-01,
        -3.5053e-01,  1.6771e-02, -3.9675e-02,  9.1100e-04, -5.5481e-02,
        -2.7161e-01, -5.7818e-01, -2.3942e-02,  2.9207e-01,  1.2764e+00,
         3.9673e-01, -1.0894e-01,  4.7959e-01, -3.2311e-02, -3.3145e-01,
        -2.0663e-01,  8.7599e-02,  7.0316e-01, -4.4676e-03, -1.1186e+00,
        -3.1060e-01,  2.9868e-01,  2.6866e-01, -5.9542e-02, -1.6888e-01,
        -7.1389e-01,  8.5738e-02, -8.1407e-02, -4.1178e-01, -1.7512e-01,
        -7.5511e-01,  6.0300e-01, -1.1067e-01, -1.5875e-02, -1.0794e-02,
         4.2188e-01, -7.0269e-01,  7.8057e-02, -2.5571e-01, -1.4129e-02,
         1.2983e-01, -3.1328e-01,  1.3267e-01,  2.5925e-01,  9.2818e-02,
        -1.6081e-01,  3.9165e-01, -1.2856e-01,  6.6928e-01, -4.1450e-01,
        -2.5878e-01, -5.0830e-02,  1.8030e-02, -8.4610e-01,  1.4071e-01,
         6.5265e-01,  1.5256e-02, -3.6777e-01, -1.8135e-01,  1.2927e-02,
        -4.3960e-03,  2.2777e-01,  1.1225e-01, -3.3574e-01, -5.5726e-01,
        -1.2834e-01, -1.1268e-01, -2.9582e-01, -6.4119e-03,  1.7198e-01,
        -5.1009e-01, -1.2605e+00,  1.5577e-02,  1.8174e+00,  2.3333e+00,
         2.4016e+00,  1.6237e-02,  2.0134e+00, -3.0296e+00,  5.1546e-01,
        -2.6230e-01,  1.0536e-01, -5.2831e-01,  8.2116e-02,  3.6758e-01,
         2.0728e-01,  4.8601e-02,  2.9171e-01,  0.0000e+00, -1.3834e+00,
         8.8043e-01, -2.5414e+00,  1.5481e-01,  4.0843e-02,  0.0000e+00,
        -8.5139e-02,  9.6993e-02, -1.7834e-01,  8.3234e-03, -9.9765e-02,
         9.8050e-02, -3.9986e-01, -3.4468e-01,  2.7656e-01,  2.8572e-01,
        -4.1571e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([9378]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-8.5422e-01,  1.6240e-01,  2.0889e-01,  1.1386e+00, -7.8209e-02,
        -4.7811e-01, -6.1331e-01, -6.3954e-01, -3.0587e-01, -2.9231e-01,
        -7.4798e-01,  8.7101e-03, -2.1885e+00,  8.3494e-02, -4.2192e-01,
        -4.5103e-01, -1.8882e-01, -1.3108e-01,  5.3114e-02, -3.6595e-03,
         3.4090e-01, -5.8376e-02, -1.3241e-01, -2.3101e-01,  5.6787e-02,
        -5.9577e-01, -6.2372e-01, -5.4654e-01, -9.1072e-01,  9.1853e-01,
        -4.3404e-01, -1.2069e-01,  2.4516e-01, -2.4143e+00, -7.7776e-01,
        -1.1204e-01,  5.5958e-02, -7.3600e-01, -2.5842e-01, -8.6813e-01,
         7.6487e-02, -1.1220e-01,  2.8900e-01, -1.7797e-01, -1.2388e-01,
        -1.7953e-01, -3.3173e-01, -5.0788e-01, -2.6052e-01,  1.4590e-01,
         1.5105e-02, -7.7359e-01, -5.7993e-01, -5.8762e-01, -7.3549e-01,
         2.8197e-01, -1.0456e+00,  1.0569e-01, -2.0260e-01, -3.4978e-01,
         5.6972e-02, -1.5908e-01, -1.1655e-01, -7.0048e-02, -1.5375e-02,
        -3.6011e-01,  1.7346e-01, -6.1534e-01,  1.2145e-03, -5.0418e-01,
        -2.5878e-01, -5.0830e-02,  1.8030e-02,  3.9091e-01,  4.9053e-02,
         4.1437e-02,  1.1649e+00, -2.6284e-01, -9.5820e-02,  1.2927e-02,
         1.1827e-01, -3.0074e-01, -2.7075e-01, -8.9647e-03, -5.0889e-01,
        -1.0903e-01, -1.0206e-01, -3.5952e-01, -6.1812e-01,  2.2710e-02,
        -5.4684e-01, -9.6776e-01,  1.5577e-02, -1.9293e+00, -7.3268e-01,
        -1.2622e+00,  6.5780e-01, -6.3239e-01, -3.4182e-01, -9.0899e-01,
        -1.8571e-02,  1.0156e-01, -5.2831e-01, -2.8377e+00,  3.6758e-01,
         4.4166e+00,  1.5510e-02, -3.5244e-01,  0.0000e+00,  7.7182e-01,
         5.6876e-01,  9.8288e-01,  1.2841e-01,  6.9218e-01,  0.0000e+00,
        -8.5139e-02, -2.7258e-01, -1.7472e-01, -3.7231e+00,  7.8711e-01,
        -7.5983e-01, -5.6157e-01, -5.6083e-01,  1.7114e-01,  2.3170e-01,
        -4.0181e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([6501]), tensor(0.0615))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.4683e-01,  7.3049e-01,  7.4898e-02, -1.2582e+00, -1.4219e-01,
        -7.3956e-01, -1.6756e-01, -3.6013e-01,  4.5746e-01, -1.5994e-01,
        -6.8931e-01,  6.6008e-02, -5.0557e-01, -3.5929e-01,  1.2351e-01,
         4.9518e-01, -1.4301e-01,  2.4676e-01, -6.7788e-02,  4.8690e-01,
        -3.6376e-01,  1.6124e-02, -3.8150e-02, -2.7243e-03, -5.7213e-02,
        -2.7309e-01, -5.8374e-01, -1.9330e-02,  2.6012e-01,  1.3201e+00,
         3.9170e-01, -1.1481e-01,  4.8776e-01, -4.5291e-02, -3.1853e-01,
        -2.1267e-01,  7.8759e-02,  7.3391e-01, -1.7976e-02, -1.1195e+00,
        -3.0680e-01,  3.0366e-01,  2.5901e-01, -4.8297e-02, -1.7506e-01,
        -7.2198e-01,  8.4849e-02, -8.5478e-02, -4.1490e-01, -1.8374e-01,
        -7.6658e-01,  5.8183e-01, -9.8943e-02, -1.3336e-02, -1.7753e-02,
         4.2230e-01, -6.8937e-01,  8.4191e-02, -2.5562e-01, -1.6637e-02,
         1.2924e-01, -3.1309e-01,  1.2849e-01,  2.5773e-01,  9.4726e-02,
        -1.6932e-01,  4.0680e-01, -1.3059e-01,  6.6447e-01, -4.1543e-01,
        -2.7321e-01, -6.0853e-02,  1.1193e-02, -8.5560e-01,  1.5152e-01,
         6.6525e-01,  1.5886e-02, -3.7198e-01, -1.7954e-01,  1.2926e-02,
        -4.3101e-03,  2.1018e-01,  1.3499e-01, -3.2391e-01, -5.5957e-01,
        -1.3286e-01, -1.1836e-01, -2.8842e-01,  5.5548e-03,  1.7253e-01,
        -5.1673e-01, -1.2633e+00,  1.8662e-02,  1.7233e+00,  2.4117e+00,
         2.4502e+00, -1.1452e-02,  2.1252e+00, -3.0934e+00,  6.0488e-01,
        -2.8784e-01,  1.0569e-01, -2.8706e-01,  7.1308e-02,  1.8342e-01,
         1.8289e-01,  4.9651e-02,  2.1546e-01,  0.0000e+00, -1.4712e+00,
         9.1192e-01, -2.5322e+00,  1.5715e-01,  1.9054e-02,  0.0000e+00,
        -4.2191e-02,  1.2099e-01, -1.8224e-01, -6.7759e-03, -1.0689e-01,
         1.0200e-01, -3.8446e-01, -3.4147e-01,  2.8360e-01,  2.9023e-01,
        -4.1681e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([10184]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-4.9663e-01,  4.6190e-01, -7.9757e-01,  1.2642e+00, -2.5219e-02,
        -8.1604e-01, -1.2726e+00, -8.7505e-01, -3.5281e-01, -8.8977e-02,
        -7.5350e-01,  6.6598e-03, -4.6465e+00, -1.7014e-01, -4.3760e-01,
         1.6392e-01, -1.7324e-01, -1.0821e-02, -6.7788e-02,  1.0957e+00,
         1.4933e-01, -5.8762e-02, -4.6725e-02, -1.6078e-01, -6.0928e-02,
        -4.3095e-01, -6.4169e-01, -1.9330e-02, -1.2362e+00,  8.8859e-01,
        -1.3184e-01, -1.9349e-01,  2.3311e-01, -4.5291e-02, -7.8238e-01,
        -3.9833e-01, -2.3464e-01, -7.0097e-01, -2.4690e-01, -8.9766e-01,
        -2.3508e-01,  1.5829e-01,  3.6629e-01, -1.5355e-01, -5.2459e-02,
        -6.6629e-01, -4.8151e-02,  2.0784e-01, -2.6399e-01,  3.4967e-02,
         8.2149e-03, -7.3321e-01, -6.7126e-01, -5.7049e-01, -7.3640e-01,
         2.8091e-01, -1.0359e+00, -1.4148e-01,  1.2761e+00, -4.4375e-01,
        -1.9959e-02,  3.3199e-01, -1.1786e+00,  5.3515e-01, -1.0222e-02,
        -7.9445e-01,  4.2686e-01,  1.3247e+00, -2.0112e+00, -4.5252e-01,
        -2.7321e-01, -6.0853e-02,  1.1193e-02, -7.7603e-01,  5.2913e-02,
         1.7433e-02,  5.2563e+00, -3.4693e-01, -2.1444e-03,  1.2926e-02,
        -4.3101e-03,  9.7567e-02, -2.1786e-01,  1.1664e+00,  3.0650e-01,
        -1.1572e-01, -1.0890e-01, -3.6080e-01, -6.1957e-01,  8.4451e-04,
        -2.3736e-01, -7.0050e-01,  1.8662e-02, -2.2412e+00, -1.4105e+00,
        -1.2400e+00,  2.3543e-01, -5.0520e-01, -1.0279e+00, -1.1069e+00,
         7.4595e-02,  5.1235e-01, -2.8706e-01,  3.3388e+00,  1.8342e-01,
         1.5976e+00,  2.3821e-02,  7.1755e-01,  0.0000e+00,  4.2332e-01,
        -6.9145e-01,  1.2894e+00,  1.2793e-01,  1.3641e+00,  0.0000e+00,
        -4.2191e-02, -5.0398e-02, -1.3832e-01, -3.6980e+00,  7.0131e-01,
        -3.1486e-01, -4.7536e-01, -4.3661e-01,  1.6006e-01,  2.3175e-01,
        -4.0177e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([6533]), tensor(0.))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996]
INFO:main.py:Testing data year: 1997
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 30
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 10575
            device: cpu
            
2024-07-15 23:37:34,761	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-15 23:37:34,805	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-15 23:37:34,839	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-15 23:37:34,847	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-15 23:37:37,897	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-15 23:49:06,127	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_23-37-37' in 0.1519s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 2, 'num_embeddings': 10575, 'embedding_dim': 5, 'dropout_rate': 0.24, 'lr': 0.01, 'weight_decay': 1.4560904745083134e-05, 'num_epochs': 30, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.0265473540427948
INFO:model_data_nn.py:Best trial testing loss: 0.030877621677250434
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-15_23-37-31_779687_2708215/artifacts/2024-07-15_23-37-37/train_fnn_2024-07-15_23-37-37/driver_artifacts/train_fnn_e4974_00048_48_dropout_rate=0.2400,embedding_dim=5,hidden_dim=25,lr=0.0100,num_layers=2,weight_decay=0.0000_2024-07-15_23-37-38
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 2, 'num_embeddings': 11490, 'embedding_dim': 5, 'dropout_rate': 0.24, 'lr': 0.01, 'weight_decay': 1.4560904745083134e-05, 'num_epochs': 30, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/30, metrics: {'avg_train_loss': 0.30677465566754025, 'avg_test_loss': 0.053019878051045355}
INFO:model_data_nn.py:Epoch 2/30, metrics: {'avg_train_loss': 0.02862623885076529, 'avg_test_loss': 0.05341170232621986}
INFO:model_data_nn.py:Epoch 3/30, metrics: {'avg_train_loss': 0.02762142167091, 'avg_test_loss': 0.05240212927239574}
INFO:model_data_nn.py:Epoch 4/30, metrics: {'avg_train_loss': 0.026895446595188943, 'avg_test_loss': 0.051933239183862716}
INFO:model_data_nn.py:Epoch 5/30, metrics: {'avg_train_loss': 0.026845260578094252, 'avg_test_loss': 0.05221089516978186}
INFO:model_data_nn.py:Epoch 6/30, metrics: {'avg_train_loss': 0.026939687171912263, 'avg_test_loss': 0.05168639387034337}
INFO:model_data_nn.py:Epoch 7/30, metrics: {'avg_train_loss': 0.026941032084827735, 'avg_test_loss': 0.052271985274063765}
INFO:model_data_nn.py:Epoch 8/30, metrics: {'avg_train_loss': 0.026922339028331067, 'avg_test_loss': 0.052457482506948046}
INFO:model_data_nn.py:Epoch 9/30, metrics: {'avg_train_loss': 0.026938986837249775, 'avg_test_loss': 0.05209295732046508}
INFO:model_data_nn.py:Early stopping at epoch 9
INFO:main.py:Making prediction for data in year: 1998
INFO:main.py:Prediction data shape: (70794,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:356: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  
INFO:main.py:Root Mean Squared Error for Prediction in 1998: 0.22833556275044453
INFO:main.py:Prediction Stats:                 ret          pred
count  70794.000000  70794.000000
mean       0.002258      0.015652
std        0.229048      0.014631
min       -0.973684     -0.176360
25%       -0.097561      0.008599
50%       -0.006724      0.013529
75%        0.080000      0.020894
max       12.666667      0.159434
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:transform_data_nn.py:Train_data: (826024, 161)

INFO:transform_data_nn.py:Test data years: [1998]
INFO:transform_data_nn.py:Test_data: (70794, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Retrain_data: (896818, 161)

INFO:transform_data_nn.py:Prediction data years: [1999]
INFO:transform_data_nn.py:Prediction_data: (67277, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([826024, 152])
            y_train_tf: torch.Size([826024])

            x_test_tf: torch.Size([70794, 152])
            y_test_tf: torch.Size([70794])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([896818, 152])
            y_retrain_tf: torch.Size([896818])

            x_prediction_tf: torch.Size([67277, 152])
            y_prediction_tf: torch.Size([67277])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.4683e-01,  7.3049e-01,  7.4898e-02, -1.2582e+00, -1.4219e-01,
        -7.3956e-01, -1.6756e-01, -3.6013e-01,  4.5746e-01, -1.5994e-01,
        -6.8931e-01,  6.6008e-02, -5.0557e-01, -3.5929e-01,  1.2351e-01,
         4.9518e-01, -1.4301e-01,  2.4676e-01, -6.7788e-02,  4.8690e-01,
        -3.6376e-01,  1.6124e-02, -3.8150e-02, -2.7243e-03, -5.7213e-02,
        -2.7309e-01, -5.8374e-01, -1.9330e-02,  2.6012e-01,  1.3201e+00,
         3.9170e-01, -1.1481e-01,  4.8776e-01, -4.5291e-02, -3.1853e-01,
        -2.1267e-01,  7.8759e-02,  7.3391e-01, -1.7976e-02, -1.1195e+00,
        -3.0680e-01,  3.0366e-01,  2.5901e-01, -4.8297e-02, -1.7506e-01,
        -7.2198e-01,  8.4849e-02, -8.5478e-02, -4.1490e-01, -1.8374e-01,
        -7.6658e-01,  5.8183e-01, -9.8943e-02, -1.3336e-02, -1.7753e-02,
         4.2230e-01, -6.8937e-01,  8.4191e-02, -2.5562e-01, -1.6637e-02,
         1.2924e-01, -3.1309e-01,  1.2849e-01,  2.5773e-01,  9.4726e-02,
        -1.6932e-01,  4.0680e-01, -1.3059e-01,  6.6447e-01, -4.1543e-01,
        -2.7321e-01, -6.0853e-02,  1.1193e-02, -8.5560e-01,  1.5152e-01,
         6.6525e-01,  1.5886e-02, -3.7198e-01, -1.7954e-01,  1.2926e-02,
        -4.3101e-03,  2.1018e-01,  1.3499e-01, -3.2391e-01, -5.5957e-01,
        -1.3286e-01, -1.1836e-01, -2.8842e-01,  5.5548e-03,  1.7253e-01,
        -5.1673e-01, -1.2633e+00,  1.8662e-02,  1.7233e+00,  2.4117e+00,
         2.4502e+00, -1.1452e-02,  2.1252e+00, -3.0934e+00,  6.0488e-01,
        -2.8784e-01,  1.0569e-01, -2.8706e-01,  7.1308e-02,  1.8342e-01,
         1.8289e-01,  4.9651e-02,  2.1546e-01,  0.0000e+00, -1.4712e+00,
         9.1192e-01, -2.5322e+00,  1.5715e-01,  1.9054e-02,  0.0000e+00,
        -4.2191e-02,  1.2099e-01, -1.8224e-01, -6.7759e-03, -1.0689e-01,
         1.0200e-01, -3.8446e-01, -3.4147e-01,  2.8360e-01,  2.9023e-01,
        -4.1681e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([10184]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-4.9663e-01,  4.6190e-01, -7.9757e-01,  1.2642e+00, -2.5219e-02,
        -8.1604e-01, -1.2726e+00, -8.7505e-01, -3.5281e-01, -8.8977e-02,
        -7.5350e-01,  6.6598e-03, -4.6465e+00, -1.7014e-01, -4.3760e-01,
         1.6392e-01, -1.7324e-01, -1.0821e-02, -6.7788e-02,  1.0957e+00,
         1.4933e-01, -5.8762e-02, -4.6725e-02, -1.6078e-01, -6.0928e-02,
        -4.3095e-01, -6.4169e-01, -1.9330e-02, -1.2362e+00,  8.8859e-01,
        -1.3184e-01, -1.9349e-01,  2.3311e-01, -4.5291e-02, -7.8238e-01,
        -3.9833e-01, -2.3464e-01, -7.0097e-01, -2.4690e-01, -8.9766e-01,
        -2.3508e-01,  1.5829e-01,  3.6629e-01, -1.5355e-01, -5.2459e-02,
        -6.6629e-01, -4.8151e-02,  2.0784e-01, -2.6399e-01,  3.4967e-02,
         8.2149e-03, -7.3321e-01, -6.7126e-01, -5.7049e-01, -7.3640e-01,
         2.8091e-01, -1.0359e+00, -1.4148e-01,  1.2761e+00, -4.4375e-01,
        -1.9959e-02,  3.3199e-01, -1.1786e+00,  5.3515e-01, -1.0222e-02,
        -7.9445e-01,  4.2686e-01,  1.3247e+00, -2.0112e+00, -4.5252e-01,
        -2.7321e-01, -6.0853e-02,  1.1193e-02, -7.7603e-01,  5.2913e-02,
         1.7433e-02,  5.2563e+00, -3.4693e-01, -2.1444e-03,  1.2926e-02,
        -4.3101e-03,  9.7567e-02, -2.1786e-01,  1.1664e+00,  3.0650e-01,
        -1.1572e-01, -1.0890e-01, -3.6080e-01, -6.1957e-01,  8.4451e-04,
        -2.3736e-01, -7.0050e-01,  1.8662e-02, -2.2412e+00, -1.4105e+00,
        -1.2400e+00,  2.3543e-01, -5.0520e-01, -1.0279e+00, -1.1069e+00,
         7.4595e-02,  5.1235e-01, -2.8706e-01,  3.3388e+00,  1.8342e-01,
         1.5976e+00,  2.3821e-02,  7.1755e-01,  0.0000e+00,  4.2332e-01,
        -6.9145e-01,  1.2894e+00,  1.2793e-01,  1.3641e+00,  0.0000e+00,
        -4.2191e-02, -5.0398e-02, -1.3832e-01, -3.6980e+00,  7.0131e-01,
        -3.1486e-01, -4.7536e-01, -4.3661e-01,  1.6006e-01,  2.3175e-01,
        -4.0177e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([6533]), tensor(0.))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-0.1488,  0.7533,  0.0750, -1.2476, -0.1519, -0.7569, -0.1656, -0.3602,
         0.4780, -0.1583, -0.6885,  0.0783, -0.5135, -0.3668,  0.1212,  0.4896,
        -0.1480,  0.2461, -0.0563,  0.4904, -0.3380,  0.0060, -0.0411, -0.0043,
        -0.0578, -0.2754, -0.5904, -0.0276,  0.2305,  1.3513,  0.3869, -0.1161,
         0.4940, -0.0339, -0.3068, -0.2204,  0.0647,  0.7642, -0.0350, -1.1255,
        -0.3035,  0.3123,  0.2498, -0.0369, -0.1863, -0.7300,  0.0889, -0.0739,
        -0.4202, -0.1616, -0.7783,  0.5612, -0.0844, -0.0127, -0.0243,  0.4213,
        -0.6786,  0.0858, -0.2526, -0.0237,  0.1279, -0.3096,  0.1299,  0.2553,
         0.0939, -0.1723,  0.4206, -0.1331,  0.6621, -0.4178, -0.2869, -0.0715,
        -0.0063, -0.8678,  0.1638,  0.6726,  0.0182, -0.3751, -0.1779,  0.0122,
        -0.0064,  0.1907,  0.1541, -0.3084, -0.5612, -0.1376, -0.1242, -0.2829,
         0.0144,  0.1725, -0.5253, -1.2665,  0.0196,  1.6403,  2.3776,  2.5092,
        -0.0479,  2.2301, -3.0209,  0.6813, -0.3183,  0.1031, -0.1093,  0.0089,
         0.3125,  0.1606,  0.0519,  0.1725,  0.0000, -1.4881,  0.9867, -2.5294,
         0.1607,  0.0172,  0.0000, -0.0508,  0.1429, -0.1886, -0.0317, -0.1156,
         0.1113, -0.3708, -0.3355,  0.2916,  0.2944, -0.4155,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([10772]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-0.2410, -0.5335, -0.3746,  1.3860, -0.3429, -0.8196, -1.6391, -0.9134,
        -0.3522, -0.3109, -0.7424,  0.0232, -1.1585,  0.7056,  0.2790,  0.4521,
        -0.1871, -0.3078,  0.1022, -0.8319,  0.3385, -0.0601, -0.0390, -0.0513,
        -0.1370, -0.4237, -0.6392, -0.0276, -0.8768,  0.8968,  0.3119, -0.1579,
         0.2593, -2.2702, -0.7467, -0.4078, -0.4598, -0.6830, -0.7193, -1.0713,
        -0.2487, -0.5816, -0.5942, -0.1637, -0.3288, -0.8004, -0.0977,  0.1501,
        -0.3370,  0.1589,  0.7805, -0.7106, -0.7014, -0.5570, -0.7355,  0.3257,
        -1.0281, -0.0882, -0.1050, -0.1825, -0.0057,  0.3419,  0.7976, -0.8114,
        -0.0135,  0.6677, -0.3726,  0.4967,  0.6621, -0.3881, -0.2869, -0.0715,
        -0.0063, -0.8087,  0.0763,  0.7144,  1.6919, -0.2827, -0.1454,  0.0122,
         0.1191,  0.0638, -0.1463,  0.4895, -0.0530, -0.1227, -0.1160, -0.3504,
        -0.5495,  0.1847, -0.3889,  0.1537,  0.0196, -2.2990, -2.0316, -1.1479,
         0.4338, -0.7692, -0.8244, -0.0223,  0.2681, -0.5595, -0.1093,  1.7894,
         0.3125,  2.7875,  0.0287,  0.3256,  0.0000, -1.3763, -0.4234,  0.9716,
         0.1285,  2.6816,  0.0000, -0.0508,  0.0459, -0.2381, -3.6215,  0.6355,
         0.9841, -0.2907, -0.3943,  0.2007,  0.2682, -0.4057,  1.0000,  0.0000,
         0.0000,  0.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([6252]), tensor(0.))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997]
INFO:main.py:Testing data year: 1998
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 30
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 11490
            device: cpu
            
2024-07-16 01:54:38,874	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 01:54:38,920	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 01:54:38,956	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 01:54:38,964	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 01:54:42,373	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 02:07:14,053	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_01-54-42' in 0.1505s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 11490, 'embedding_dim': 5, 'dropout_rate': 0.05, 'lr': 0.007, 'weight_decay': 0.00027855068482535877, 'num_epochs': 30, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.026893845290929162
INFO:model_data_nn.py:Best trial testing loss: 0.0521792135191308
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_01-54-36_043587_2708215/artifacts/2024-07-16_01-54-42/train_fnn_2024-07-16_01-54-42/driver_artifacts/train_fnn_0ac2c_00041_41_dropout_rate=0.0500,embedding_dim=5,hidden_dim=5,lr=0.0070,num_layers=4,weight_decay=0.0003_2024-07-16_01-54-42
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 12154, 'embedding_dim': 5, 'dropout_rate': 0.05, 'lr': 0.007, 'weight_decay': 0.00027855068482535877, 'num_epochs': 30, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/30, metrics: {'avg_train_loss': 0.5191203401858289, 'avg_test_loss': 0.058440254611660775}
INFO:model_data_nn.py:Epoch 2/30, metrics: {'avg_train_loss': 0.029342127806819617, 'avg_test_loss': 0.05894619284530556}
INFO:model_data_nn.py:Epoch 3/30, metrics: {'avg_train_loss': 0.029136122970099744, 'avg_test_loss': 0.05939618751987418}
INFO:model_data_nn.py:Epoch 4/30, metrics: {'avg_train_loss': 0.028778729937730365, 'avg_test_loss': 0.05859098570357597}
INFO:model_data_nn.py:Early stopping at epoch 4
INFO:main.py:Making prediction for data in year: 1999
INFO:main.py:Prediction data shape: (67277,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:356: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  
INFO:main.py:Root Mean Squared Error for Prediction in 1999: 0.24195826293024184
INFO:main.py:Prediction Stats:                 ret          pred
count  67277.000000  67277.000000
mean       0.025442      0.022498
std        0.242779      0.013323
min       -0.959091     -1.414169
25%       -0.087282      0.016328
50%       -0.005181      0.019179
75%        0.089806      0.024640
max        7.000000      0.144846
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:transform_data_nn.py:Train_data: (896818, 161)

INFO:transform_data_nn.py:Test data years: [1999]
INFO:transform_data_nn.py:Test_data: (67277, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:transform_data_nn.py:Retrain_data: (964095, 161)

INFO:transform_data_nn.py:Prediction data years: [2000]
INFO:transform_data_nn.py:Prediction_data: (64295, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([896818, 152])
            y_train_tf: torch.Size([896818])

            x_test_tf: torch.Size([67277, 152])
            y_test_tf: torch.Size([67277])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([964095, 152])
            y_retrain_tf: torch.Size([964095])

            x_prediction_tf: torch.Size([64295, 152])
            y_prediction_tf: torch.Size([64295])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-0.1488,  0.7533,  0.0750, -1.2476, -0.1519, -0.7569, -0.1656, -0.3602,
         0.4780, -0.1583, -0.6885,  0.0783, -0.5135, -0.3668,  0.1212,  0.4896,
        -0.1480,  0.2461, -0.0563,  0.4904, -0.3380,  0.0060, -0.0411, -0.0043,
        -0.0578, -0.2754, -0.5904, -0.0276,  0.2305,  1.3513,  0.3869, -0.1161,
         0.4940, -0.0339, -0.3068, -0.2204,  0.0647,  0.7642, -0.0350, -1.1255,
        -0.3035,  0.3123,  0.2498, -0.0369, -0.1863, -0.7300,  0.0889, -0.0739,
        -0.4202, -0.1616, -0.7783,  0.5612, -0.0844, -0.0127, -0.0243,  0.4213,
        -0.6786,  0.0858, -0.2526, -0.0237,  0.1279, -0.3096,  0.1299,  0.2553,
         0.0939, -0.1723,  0.4206, -0.1331,  0.6621, -0.4178, -0.2869, -0.0715,
        -0.0063, -0.8678,  0.1638,  0.6726,  0.0182, -0.3751, -0.1779,  0.0122,
        -0.0064,  0.1907,  0.1541, -0.3084, -0.5612, -0.1376, -0.1242, -0.2829,
         0.0144,  0.1725, -0.5253, -1.2665,  0.0196,  1.6403,  2.3776,  2.5092,
        -0.0479,  2.2301, -3.0209,  0.6813, -0.3183,  0.1031, -0.1093,  0.0089,
         0.3125,  0.1606,  0.0519,  0.1725,  0.0000, -1.4881,  0.9867, -2.5294,
         0.1607,  0.0172,  0.0000, -0.0508,  0.1429, -0.1886, -0.0317, -0.1156,
         0.1113, -0.3708, -0.3355,  0.2916,  0.2944, -0.4155,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([10772]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-0.2410, -0.5335, -0.3746,  1.3860, -0.3429, -0.8196, -1.6391, -0.9134,
        -0.3522, -0.3109, -0.7424,  0.0232, -1.1585,  0.7056,  0.2790,  0.4521,
        -0.1871, -0.3078,  0.1022, -0.8319,  0.3385, -0.0601, -0.0390, -0.0513,
        -0.1370, -0.4237, -0.6392, -0.0276, -0.8768,  0.8968,  0.3119, -0.1579,
         0.2593, -2.2702, -0.7467, -0.4078, -0.4598, -0.6830, -0.7193, -1.0713,
        -0.2487, -0.5816, -0.5942, -0.1637, -0.3288, -0.8004, -0.0977,  0.1501,
        -0.3370,  0.1589,  0.7805, -0.7106, -0.7014, -0.5570, -0.7355,  0.3257,
        -1.0281, -0.0882, -0.1050, -0.1825, -0.0057,  0.3419,  0.7976, -0.8114,
        -0.0135,  0.6677, -0.3726,  0.4967,  0.6621, -0.3881, -0.2869, -0.0715,
        -0.0063, -0.8087,  0.0763,  0.7144,  1.6919, -0.2827, -0.1454,  0.0122,
         0.1191,  0.0638, -0.1463,  0.4895, -0.0530, -0.1227, -0.1160, -0.3504,
        -0.5495,  0.1847, -0.3889,  0.1537,  0.0196, -2.2990, -2.0316, -1.1479,
         0.4338, -0.7692, -0.8244, -0.0223,  0.2681, -0.5595, -0.1093,  1.7894,
         0.3125,  2.7875,  0.0287,  0.3256,  0.0000, -1.3763, -0.4234,  0.9716,
         0.1285,  2.6816,  0.0000, -0.0508,  0.0459, -0.2381, -3.6215,  0.6355,
         0.9841, -0.2907, -0.3943,  0.2007,  0.2682, -0.4057,  1.0000,  0.0000,
         0.0000,  0.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([6252]), tensor(0.))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.4963e-01,  7.7331e-01,  7.5467e-02, -1.2401e+00, -1.5562e-01,
        -7.7538e-01, -1.6396e-01, -3.5874e-01,  4.7901e-01, -1.5475e-01,
        -6.8697e-01,  8.7942e-02, -5.1425e-01, -3.7712e-01,  1.2134e-01,
         4.8733e-01, -1.4502e-01,  2.4296e-01, -5.7820e-02,  4.9726e-01,
        -3.4779e-01,  5.9739e-03, -3.9149e-02, -1.6977e-03, -5.1713e-02,
        -2.7604e-01, -5.9599e-01, -3.1014e-02,  2.0480e-01,  1.3757e+00,
         3.7385e-01, -1.1353e-01,  4.9929e-01, -2.1032e-02, -2.9519e-01,
        -2.2633e-01,  5.1461e-02,  7.9116e-01, -4.7016e-02, -1.1333e+00,
        -3.0087e-01,  3.3386e-01,  2.4733e-01, -3.3277e-02, -1.9322e-01,
        -7.3974e-01,  1.0270e-01, -7.3550e-02, -4.1774e-01, -1.5868e-01,
        -7.8968e-01,  5.4365e-01, -6.6836e-02, -1.3350e-02, -2.6730e-02,
         4.1966e-01, -6.6864e-01,  8.1968e-02, -2.4812e-01, -3.2814e-02,
         1.2860e-01, -3.0517e-01,  1.3017e-01,  2.5374e-01,  9.6638e-02,
        -1.7596e-01,  4.3228e-01, -1.3719e-01,  6.6238e-01, -4.1963e-01,
        -2.9754e-01, -2.5008e-02, -1.7887e-02, -8.8182e-01,  1.7426e-01,
         6.7406e-01,  1.9789e-02, -3.7784e-01, -1.7609e-01,  1.3414e-02,
        -9.6442e-03,  1.8168e-01,  1.6324e-01, -2.9306e-01, -5.5933e-01,
        -1.4113e-01, -1.2892e-01, -2.7914e-01,  2.6413e-02,  1.8375e-01,
        -5.2859e-01, -1.2705e+00,  2.0404e-02,  1.5788e+00,  2.3115e+00,
         2.5636e+00, -8.0809e-02,  2.3229e+00, -3.0747e+00,  7.2771e-01,
        -3.4287e-01,  1.0487e-01, -1.1082e-01, -3.6085e-03,  3.3826e-01,
         1.9396e-01,  5.3803e-02,  2.0500e-01,  0.0000e+00, -1.3818e+00,
         1.0458e+00, -2.5509e+00,  1.6421e-01,  2.0667e-02,  0.0000e+00,
        -2.5277e-02,  1.6155e-01, -1.9412e-01, -3.2054e-02, -1.2410e-01,
         1.1805e-01, -3.5857e-01, -3.2868e-01,  2.9897e-01,  2.9757e-01,
        -4.1361e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([11283]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-0.0150, -0.6763, -0.5130,  1.5026, -0.2554, -0.8136, -1.6103, -0.9120,
        -0.2097, -0.2357, -0.6851,  0.0328, -0.3096,  1.0031,  0.5485,  0.6054,
        -0.2260,  0.1459,  0.0427, -0.9663,  0.1900, -0.0626, -0.0425, -0.0517,
         0.0441, -0.4774, -0.6575, -0.0310, -0.9150,  1.2192, -0.0404, -0.1499,
         0.2957, -2.2210, -0.7824, -0.2834, -0.1834, -0.6235, -0.1686, -1.1178,
        -0.0530, -0.3106, -0.3606, -0.0957, -0.2657, -0.3779, -0.3610, -0.1023,
        -0.0484, -0.1090,  0.7758, -0.7794, -0.5548, -0.5490, -0.7351,  0.2577,
        -1.0209,  0.1240, -0.4132, -0.4364, -0.1778, -0.1046,  1.0675,  0.1030,
        -0.0132,  1.3116, -0.4845,  2.0911,  0.6624, -0.3817, -0.2975, -0.0250,
        -0.0179, -0.4363,  0.0702,  0.7979,  0.0561, -0.1098, -0.1514,  0.0134,
         0.1229,  0.0936,  0.0500,  0.2358, -0.5666, -0.1321, -0.1234, -0.2959,
        -0.5168, -0.3630, -0.5877, -0.1240,  0.0204, -2.2266, -1.5614, -1.1605,
         0.3023, -0.4107, -0.3642, -0.8625, -0.1967, -0.9605, -0.1108,  0.8525,
         0.3383,  2.0245,  0.0322, -0.8599,  0.0000, -0.6321,  0.0461,  1.2698,
         0.1188,  5.0115,  0.0000, -0.0253, -0.1566, -0.2267, -3.5661,  0.6462,
         0.1414, -0.1086, -0.4046,  0.2089,  0.2710, -0.4243,  1.0000,  0.0000,
         0.0000,  0.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  1.0000]), tensor([5973]), tensor(-0.0441))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
INFO:main.py:Testing data year: 1999
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 30
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 12154
            device: cpu
            
2024-07-16 04:22:31,704	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 04:22:31,780	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 04:22:31,836	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 04:22:31,846	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 04:22:35,358	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 04:47:24,370	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_04-22-35' in 0.1605s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 4, 'num_embeddings': 12154, 'embedding_dim': 10, 'dropout_rate': 0.48, 'lr': 0.002, 'weight_decay': 0.00010796221410275565, 'num_epochs': 30, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.028828115010853073
INFO:model_data_nn.py:Best trial testing loss: 0.05848151092690207
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_04-22-27_232925_2708215/artifacts/2024-07-16_04-22-35/train_fnn_2024-07-16_04-22-35/driver_artifacts/train_fnn_b378e_00033_33_dropout_rate=0.4800,embedding_dim=10,hidden_dim=25,lr=0.0020,num_layers=4,weight_decay=0.0001_2024-07-16_04-22-35
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 25, 'num_layers': 4, 'num_embeddings': 12714, 'embedding_dim': 10, 'dropout_rate': 0.48, 'lr': 0.002, 'weight_decay': 0.00010796221410275565, 'num_epochs': 30, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/30, metrics: {'avg_train_loss': 5.590279915209798, 'avg_test_loss': 0.07550848455774406}
INFO:model_data_nn.py:Epoch 2/30, metrics: {'avg_train_loss': 0.031948088587173205, 'avg_test_loss': 0.0697650839870293}
INFO:model_data_nn.py:Epoch 3/30, metrics: {'avg_train_loss': 0.03252448747354939, 'avg_test_loss': 0.07007417770191318}
INFO:model_data_nn.py:Epoch 4/30, metrics: {'avg_train_loss': 0.032059933639077574, 'avg_test_loss': 0.06893624368286322}
INFO:model_data_nn.py:Epoch 5/30, metrics: {'avg_train_loss': 0.031208780366656346, 'avg_test_loss': 0.06864255788691696}
INFO:model_data_nn.py:Epoch 6/30, metrics: {'avg_train_loss': 0.030856716380055462, 'avg_test_loss': 0.06839929582432859}
INFO:model_data_nn.py:Epoch 7/30, metrics: {'avg_train_loss': 0.030882632401655615, 'avg_test_loss': 0.069244659579699}
INFO:model_data_nn.py:Epoch 8/30, metrics: {'avg_train_loss': 0.030906449342359192, 'avg_test_loss': 0.06859356600288598}
INFO:model_data_nn.py:Epoch 9/30, metrics: {'avg_train_loss': 0.030879399577720536, 'avg_test_loss': 0.06836986289699636}
INFO:model_data_nn.py:Epoch 10/30, metrics: {'avg_train_loss': 0.030895858965972384, 'avg_test_loss': 0.06842209894712718}
INFO:model_data_nn.py:Epoch 11/30, metrics: {'avg_train_loss': 0.030907872083744767, 'avg_test_loss': 0.06877117189356968}
INFO:model_data_nn.py:Epoch 12/30, metrics: {'avg_train_loss': 0.03091694627637741, 'avg_test_loss': 0.07095430512720394}
INFO:model_data_nn.py:Early stopping at epoch 12
INFO:main.py:Making prediction for data in year: 2000
INFO:main.py:Prediction data shape: (64295,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:356: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  
INFO:main.py:Root Mean Squared Error for Prediction in 2000: 0.26630083362936824
INFO:main.py:Prediction Stats:                 ret          pred
count  64295.000000  64295.000000
mean      -0.001434      0.020553
std        0.261681      0.044239
min       -0.961538     -0.074334
25%       -0.124228      0.006808
50%       -0.013216      0.009026
75%        0.086957      0.014024
max       10.344000      1.320443
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:transform_data_nn.py:Train_data: (964095, 161)

INFO:transform_data_nn.py:Test data years: [2000]
INFO:transform_data_nn.py:Test_data: (64295, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]
INFO:transform_data_nn.py:Retrain_data: (1028390, 161)

INFO:transform_data_nn.py:Prediction data years: [2001]
INFO:transform_data_nn.py:Prediction_data: (62104, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([964095, 152])
            y_train_tf: torch.Size([964095])

            x_test_tf: torch.Size([64295, 152])
            y_test_tf: torch.Size([64295])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([1028390, 152])
            y_retrain_tf: torch.Size([1028390])

            x_prediction_tf: torch.Size([62104, 152])
            y_prediction_tf: torch.Size([62104])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.4963e-01,  7.7331e-01,  7.5467e-02, -1.2401e+00, -1.5562e-01,
        -7.7538e-01, -1.6396e-01, -3.5874e-01,  4.7901e-01, -1.5475e-01,
        -6.8697e-01,  8.7942e-02, -5.1425e-01, -3.7712e-01,  1.2134e-01,
         4.8733e-01, -1.4502e-01,  2.4296e-01, -5.7820e-02,  4.9726e-01,
        -3.4779e-01,  5.9739e-03, -3.9149e-02, -1.6977e-03, -5.1713e-02,
        -2.7604e-01, -5.9599e-01, -3.1014e-02,  2.0480e-01,  1.3757e+00,
         3.7385e-01, -1.1353e-01,  4.9929e-01, -2.1032e-02, -2.9519e-01,
        -2.2633e-01,  5.1461e-02,  7.9116e-01, -4.7016e-02, -1.1333e+00,
        -3.0087e-01,  3.3386e-01,  2.4733e-01, -3.3277e-02, -1.9322e-01,
        -7.3974e-01,  1.0270e-01, -7.3550e-02, -4.1774e-01, -1.5868e-01,
        -7.8968e-01,  5.4365e-01, -6.6836e-02, -1.3350e-02, -2.6730e-02,
         4.1966e-01, -6.6864e-01,  8.1968e-02, -2.4812e-01, -3.2814e-02,
         1.2860e-01, -3.0517e-01,  1.3017e-01,  2.5374e-01,  9.6638e-02,
        -1.7596e-01,  4.3228e-01, -1.3719e-01,  6.6238e-01, -4.1963e-01,
        -2.9754e-01, -2.5008e-02, -1.7887e-02, -8.8182e-01,  1.7426e-01,
         6.7406e-01,  1.9789e-02, -3.7784e-01, -1.7609e-01,  1.3414e-02,
        -9.6442e-03,  1.8168e-01,  1.6324e-01, -2.9306e-01, -5.5933e-01,
        -1.4113e-01, -1.2892e-01, -2.7914e-01,  2.6413e-02,  1.8375e-01,
        -5.2859e-01, -1.2705e+00,  2.0404e-02,  1.5788e+00,  2.3115e+00,
         2.5636e+00, -8.0809e-02,  2.3229e+00, -3.0747e+00,  7.2771e-01,
        -3.4287e-01,  1.0487e-01, -1.1082e-01, -3.6085e-03,  3.3826e-01,
         1.9396e-01,  5.3803e-02,  2.0500e-01,  0.0000e+00, -1.3818e+00,
         1.0458e+00, -2.5509e+00,  1.6421e-01,  2.0667e-02,  0.0000e+00,
        -2.5277e-02,  1.6155e-01, -1.9412e-01, -3.2054e-02, -1.2410e-01,
         1.1805e-01, -3.5857e-01, -3.2868e-01,  2.9897e-01,  2.9757e-01,
        -4.1361e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([11283]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-0.0150, -0.6763, -0.5130,  1.5026, -0.2554, -0.8136, -1.6103, -0.9120,
        -0.2097, -0.2357, -0.6851,  0.0328, -0.3096,  1.0031,  0.5485,  0.6054,
        -0.2260,  0.1459,  0.0427, -0.9663,  0.1900, -0.0626, -0.0425, -0.0517,
         0.0441, -0.4774, -0.6575, -0.0310, -0.9150,  1.2192, -0.0404, -0.1499,
         0.2957, -2.2210, -0.7824, -0.2834, -0.1834, -0.6235, -0.1686, -1.1178,
        -0.0530, -0.3106, -0.3606, -0.0957, -0.2657, -0.3779, -0.3610, -0.1023,
        -0.0484, -0.1090,  0.7758, -0.7794, -0.5548, -0.5490, -0.7351,  0.2577,
        -1.0209,  0.1240, -0.4132, -0.4364, -0.1778, -0.1046,  1.0675,  0.1030,
        -0.0132,  1.3116, -0.4845,  2.0911,  0.6624, -0.3817, -0.2975, -0.0250,
        -0.0179, -0.4363,  0.0702,  0.7979,  0.0561, -0.1098, -0.1514,  0.0134,
         0.1229,  0.0936,  0.0500,  0.2358, -0.5666, -0.1321, -0.1234, -0.2959,
        -0.5168, -0.3630, -0.5877, -0.1240,  0.0204, -2.2266, -1.5614, -1.1605,
         0.3023, -0.4107, -0.3642, -0.8625, -0.1967, -0.9605, -0.1108,  0.8525,
         0.3383,  2.0245,  0.0322, -0.8599,  0.0000, -0.6321,  0.0461,  1.2698,
         0.1188,  5.0115,  0.0000, -0.0253, -0.1566, -0.2267, -3.5661,  0.6462,
         0.1414, -0.1086, -0.4046,  0.2089,  0.2710, -0.4243,  1.0000,  0.0000,
         0.0000,  0.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  1.0000]), tensor([5973]), tensor(-0.0441))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.5003e-01,  7.9058e-01,  8.1780e-02, -1.2347e+00, -1.6170e-01,
        -7.9695e-01, -1.6017e-01, -3.5635e-01,  4.6382e-01, -1.4839e-01,
        -6.8473e-01,  9.6144e-02, -5.1021e-01, -3.8909e-01,  1.2193e-01,
         4.8299e-01, -1.4612e-01,  2.4280e-01, -5.7477e-02,  5.0610e-01,
        -3.3304e-01,  4.0716e-03, -3.7353e-02, -3.4706e-03, -4.6997e-02,
        -2.7613e-01, -5.9417e-01, -3.1584e-02,  1.7564e-01,  1.3893e+00,
         3.6471e-01, -1.1564e-01,  5.0128e-01, -3.0722e-02, -2.8498e-01,
        -2.2596e-01,  4.5413e-02,  8.1149e-01, -5.1130e-02, -1.1384e+00,
        -2.9813e-01,  2.7513e-01,  2.5159e-01, -3.8434e-02, -1.9698e-01,
        -7.5245e-01,  9.0346e-02, -6.6200e-02, -4.0176e-01, -1.5585e-01,
        -7.9920e-01,  5.2479e-01, -4.8720e-02, -1.1011e-02, -2.8857e-02,
         4.1787e-01, -6.5838e-01,  8.2408e-02, -2.4810e-01, -4.1027e-02,
         1.2828e-01, -3.0477e-01,  1.2568e-01,  2.5317e-01,  9.2543e-02,
        -1.8401e-01,  4.4294e-01, -1.3756e-01,  6.5963e-01, -4.2033e-01,
        -3.0442e-01, -1.6989e-02, -2.0014e-02, -8.9778e-01,  1.8310e-01,
         6.7055e-01,  1.6905e-02, -3.8115e-01, -1.7439e-01,  1.1837e-02,
        -4.1039e-03,  1.7110e-01,  1.6247e-01, -2.7181e-01, -5.5922e-01,
        -1.4469e-01, -1.3347e-01, -2.7508e-01,  3.9311e-02,  1.9095e-01,
        -5.3083e-01, -1.2732e+00,  2.0767e-02,  1.5554e+00,  2.3470e+00,
         2.6177e+00, -8.0706e-02,  2.4073e+00, -2.9402e+00,  7.8232e-01,
        -3.7331e-01,  1.0774e-01, -6.3810e-02,  4.9231e-02,  2.1016e-01,
         1.8497e-01,  5.4038e-02,  2.6684e-01,  0.0000e+00, -1.4004e+00,
         8.6704e-01, -2.5540e+00,  1.6761e-01,  7.8416e-03, -3.5470e-01,
        -1.8634e-03,  1.7986e-01, -1.9652e-01, -7.2173e-02, -1.3031e-01,
         1.1697e-01, -3.4537e-01, -3.2558e-01,  3.0497e-01,  2.9960e-01,
        -4.1311e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([11780]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-7.8155e-01,  2.9863e-01, -2.6455e-01,  1.6144e+00, -1.3151e-01,
        -6.4774e-01, -1.6327e+00, -9.0350e-01, -2.7611e-01, -5.2427e-01,
        -7.4705e-01,  4.3307e-02, -1.8074e-02,  3.2187e-02, -4.9218e-01,
         6.2184e-01, -2.2092e-01,  9.8563e-02,  2.4917e-01,  3.1690e-01,
         5.4051e-01, -5.7433e-02, -4.0387e-02,  3.9809e-01,  1.8641e-02,
        -5.1085e-01, -6.4987e-01, -3.1584e-02, -8.8556e-01,  1.0707e+00,
         4.5311e-02, -1.2936e-01,  2.8789e-01, -2.1698e+00, -7.4284e-01,
        -1.7989e-01, -6.7393e-02, -5.4426e-01, -2.4384e-01, -1.1524e+00,
        -2.3032e-01,  1.1930e-01,  1.3787e-01, -1.0921e-01, -1.7468e-01,
        -7.1678e-01,  6.7817e-02,  1.5170e-01, -3.2939e-01,  4.5092e-01,
        -7.9920e-01, -7.1528e-01, -7.8128e-01, -5.4239e-01, -7.3400e-01,
         3.0674e-01, -1.0132e+00,  1.3695e-01, -3.5488e-01, -1.2432e-01,
         1.0936e-03, -3.8591e-01, -2.1444e-01,  4.4070e-01, -1.7470e-02,
        -3.9417e-01,  2.4717e-01,  3.5690e-01,  6.5963e-01, -4.2365e-01,
        -3.0442e-01, -1.6989e-02, -2.0014e-02, -6.5114e-01,  9.2238e-02,
         7.7743e-01,  3.3144e-03, -1.5722e-01, -8.7829e-02,  1.1837e-02,
         1.2291e-01,  3.2644e-01,  1.7267e-01, -2.8522e-02, -5.9734e-01,
        -1.3666e-01, -1.2899e-01, -3.5258e-01, -6.1016e-01, -1.3135e-01,
        -6.1622e-01, -4.1902e-03,  2.0767e-02, -1.7123e+00, -1.0682e+00,
        -1.0638e+00, -7.6175e-01, -1.7670e-01, -1.6409e+00, -4.3100e-01,
         6.8829e-01,  5.7639e-01, -6.3810e-02, -1.0282e-01,  2.1016e-01,
         8.5482e-01,  5.4667e-02,  1.3218e+00,  0.0000e+00,  3.6432e+00,
         2.9382e+00,  5.5339e-01,  1.2082e-01,  8.0602e+00, -3.5470e-01,
        -1.8634e-03, -1.2010e-01, -1.4793e-01, -3.4710e+00,  6.5598e-01,
        -9.0712e-01,  1.8469e-01, -3.8436e-01,  2.1459e-01,  2.8072e-01,
        -4.2464e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([5843]), tensor(0.0128))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]
INFO:main.py:Testing data year: 2000
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 30
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 12714
            device: cpu
            
2024-07-16 07:20:17,376	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 07:20:17,426	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 07:20:17,462	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 07:20:17,467	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 07:20:21,161	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 07:41:07,204	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_07-20-21' in 0.1368s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 3, 'num_embeddings': 12714, 'embedding_dim': 20, 'dropout_rate': 0.41, 'lr': 0.0005, 'weight_decay': 0.000718848093363433, 'num_epochs': 30, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03060062430562591
INFO:model_data_nn.py:Best trial testing loss: 0.06847355929425075
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_07-20-14_643660_2708215/artifacts/2024-07-16_07-20-21/train_fnn_2024-07-16_07-20-21/driver_artifacts/train_fnn_88c91_00043_43_dropout_rate=0.4100,embedding_dim=20,hidden_dim=55,lr=0.0005,num_layers=3,weight_decay=0.0007_2024-07-16_07-20-21
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 55, 'num_layers': 3, 'num_embeddings': 13269, 'embedding_dim': 20, 'dropout_rate': 0.41, 'lr': 0.0005, 'weight_decay': 0.000718848093363433, 'num_epochs': 30, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/30, metrics: {'avg_train_loss': 7.587917595563087, 'avg_test_loss': 0.07852156694840502}
INFO:model_data_nn.py:Epoch 2/30, metrics: {'avg_train_loss': 0.034982098986414634, 'avg_test_loss': 0.07296436521466132}
INFO:model_data_nn.py:Epoch 3/30, metrics: {'avg_train_loss': 0.03403298804168383, 'avg_test_loss': 0.07330046796504362}
INFO:model_data_nn.py:Epoch 4/30, metrics: {'avg_train_loss': 0.03384973809972309, 'avg_test_loss': 0.073184283622713}
INFO:model_data_nn.py:Epoch 5/30, metrics: {'avg_train_loss': 0.033116050500324436, 'avg_test_loss': 0.07435144845840862}
INFO:model_data_nn.py:Early stopping at epoch 5
INFO:main.py:Making prediction for data in year: 2001
INFO:main.py:Prediction data shape: (62104,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:356: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  
INFO:main.py:Root Mean Squared Error for Prediction in 2001: 0.2726033433005116
INFO:main.py:Prediction Stats:                 ret          pred
count  62104.000000  62104.000000
mean       0.028327     -0.000538
std        0.270550      0.029876
min       -0.981295     -0.246727
25%       -0.090273     -0.003879
50%        0.005234      0.004084
75%        0.102421      0.010169
max        8.666667      0.141956
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:transform_data_nn.py:Train_data: (1090494, 161)

INFO:transform_data_nn.py:Test data years: [2002]
INFO:transform_data_nn.py:Test_data: (59934, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]
INFO:transform_data_nn.py:Retrain_data: (1150428, 161)

INFO:transform_data_nn.py:Prediction data years: [2003]
INFO:transform_data_nn.py:Prediction_data: (55419, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([1090494, 152])
            y_train_tf: torch.Size([1090494])

            x_test_tf: torch.Size([59934, 152])
            y_test_tf: torch.Size([59934])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([1150428, 152])
            y_retrain_tf: torch.Size([1150428])

            x_prediction_tf: torch.Size([55419, 152])
            y_prediction_tf: torch.Size([55419])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-0.1586,  0.8064,  0.0876, -1.2287, -0.1595, -0.8100, -0.1547, -0.3535,
         0.4353, -0.1385, -0.6847,  0.1083, -0.5059, -0.3799,  0.1162,  0.4810,
        -0.1436,  0.2410, -0.0440,  0.5166, -0.3344, -0.0096, -0.0348,  0.0031,
        -0.0449, -0.2766, -0.5865, -0.0457,  0.1597,  1.3691,  0.3576, -0.1138,
         0.4955, -0.0151, -0.2735, -0.2270,  0.0408,  0.8313, -0.0544, -1.1414,
        -0.2990,  0.3093,  0.2607, -0.0450, -0.1960, -0.7588,  0.1068, -0.0657,
        -0.3888, -0.1417, -0.8087,  0.5109, -0.0388, -0.0117, -0.0264,  0.4191,
        -0.6486,  0.0795, -0.2451, -0.0521,  0.1310, -0.3016,  0.1264,  0.2429,
         0.0861, -0.1877,  0.4527, -0.1369,  0.6642, -0.4217, -0.3116, -0.0191,
        -0.0254, -0.9051,  0.1966,  0.6720,  0.0159, -0.3841, -0.1737,  0.0086,
         0.0038,  0.1575,  0.1564, -0.2541, -0.5610, -0.1486, -0.1379, -0.2741,
         0.0496,  0.1912, -0.5340, -1.2737,  0.0210,  1.5867,  2.3335,  2.6672,
        -0.0535,  2.4516, -2.9617,  0.8248, -0.4047,  0.1143, -0.0776,  0.0298,
         0.2141,  0.1960,  0.0672,  0.2640,  0.0000, -1.2144,  0.6173, -2.6076,
         0.1731, -0.0393,  0.2582, -0.0191,  0.1997, -0.1961, -0.0766, -0.1415,
         0.1249, -0.3337, -0.3158,  0.3138,  0.3040, -0.4072,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([12360]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-4.4271e-01, -2.8657e-01, -5.4112e-01,  1.7223e+00,  1.2791e-01,
        -7.2758e-01, -1.6145e+00, -8.8335e-01, -3.5326e-01, -4.7428e-01,
        -7.4585e-01,  5.6984e-02, -1.8806e-02,  6.3419e-01,  3.0459e-01,
         2.5086e+00, -8.7727e-02,  1.9522e-01,  1.9799e-01,  1.5400e+00,
        -4.5036e-01, -5.6030e-02, -3.0106e-02,  3.9506e-02, -4.3974e-02,
        -5.0832e-01, -6.4088e-01, -4.5684e-02, -6.5200e-01,  8.5437e-01,
        -2.6626e-01, -1.1076e-01,  3.2285e-01, -2.1166e+00, -7.6734e-01,
        -3.5201e-01, -4.6172e-01, -5.5369e-01, -1.6259e-01, -1.0099e+00,
        -2.3403e-01, -6.5267e-01,  5.0908e-01, -8.6439e-02,  2.3468e-02,
        -8.0030e-01,  1.6257e-01, -2.0365e-02, -2.2480e-01, -1.8963e-01,
        -1.8954e-02, -6.3108e-01, -7.0994e-01, -5.3802e-01, -2.6445e-02,
         3.3073e-01, -1.0056e+00, -3.8869e-03, -1.3339e-01, -2.8006e-01,
        -3.0459e-01, -3.5814e-01, -1.1735e+00,  1.0976e+00, -1.6674e-02,
        -6.9679e-01, -1.5458e-01,  1.0886e+00,  1.3371e+00, -4.5529e-01,
        -3.1160e-01, -1.9145e-02, -2.5361e-02, -7.9685e-01,  9.8504e-02,
         7.3055e-02, -1.9542e-04, -2.7171e-01,  1.2449e-01,  8.5546e-03,
         1.3094e-01,  8.5354e-01,  4.1512e-01, -9.4846e-02, -5.5554e-01,
        -1.3874e-01, -1.3308e-01, -3.5146e-01, -7.9408e-01,  4.8027e-01,
        -5.4107e-01, -1.2737e+00,  2.0963e-02, -1.3357e+00, -2.3685e+00,
        -1.0774e+00,  1.0671e-01, -1.7903e+00,  1.5713e+00,  7.2729e-01,
        -1.0746e-01,  2.6270e-01, -7.7583e-02,  3.6254e+00,  2.1410e-01,
         1.5701e+00,  5.2948e-02,  3.5263e-01,  0.0000e+00,  7.1195e-01,
         1.9486e+00, -2.4186e-01,  1.1852e-01,  1.3833e+01,  2.5821e-01,
        -1.9104e-02,  6.3610e-02, -2.0462e-01, -3.3141e+00,  6.0176e-01,
         5.7319e-01,  6.3205e-01, -3.2629e-01,  2.4644e-01,  3.5078e-01,
        -3.9848e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([5266]), tensor(-0.0131))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.7116e-01,  8.2591e-01,  8.9769e-02, -1.2241e+00, -1.4464e-01,
        -8.2049e-01, -1.4991e-01, -3.5151e-01,  4.2190e-01, -1.3743e-01,
        -6.8725e-01,  1.2156e-01, -5.0705e-01, -3.6798e-01,  1.0485e-01,
         4.8707e-01, -1.4148e-01,  2.3734e-01, -4.6621e-02,  5.3575e-01,
        -3.2435e-01, -9.3329e-03, -1.9246e-02,  8.4216e-03, -3.7868e-02,
        -2.7713e-01, -5.8501e-01, -4.9842e-02,  1.4605e-01,  1.3202e+00,
         3.5273e-01, -1.0498e-01,  4.9351e-01, -2.0463e-03, -2.6066e-01,
        -2.2402e-01,  5.4795e-02,  8.4688e-01, -4.7742e-02, -1.1462e+00,
        -2.9924e-01,  3.2817e-01,  2.8007e-01, -4.9046e-02, -1.8754e-01,
        -7.6304e-01,  1.1420e-01, -6.1253e-02, -3.7545e-01, -1.3122e-01,
        -8.2010e-01,  4.9866e-01, -3.2872e-02, -1.1337e-02, -2.8201e-02,
         4.2178e-01, -6.3963e-01,  7.2807e-02, -2.4308e-01, -5.8345e-02,
         1.3098e-01, -3.0099e-01,  1.2807e-01,  2.3673e-01,  8.9501e-02,
        -1.9047e-01,  4.6496e-01, -1.3852e-01,  6.6373e-01, -4.2363e-01,
        -3.1924e-01, -2.1984e-02, -2.8254e-02, -9.1110e-01,  2.1188e-01,
         6.8313e-01,  1.9191e-02, -3.8730e-01, -1.7354e-01,  1.2541e-02,
         3.0178e-03,  1.6863e-01,  1.5687e-01, -2.3267e-01, -5.6024e-01,
        -1.5245e-01, -1.4272e-01, -2.7571e-01,  5.5402e-02,  1.8981e-01,
        -5.3707e-01, -1.2746e+00,  1.8266e-02,  1.6373e+00,  2.2893e+00,
         2.7389e+00, -8.0259e-02,  2.4169e+00, -2.9631e+00,  7.9023e-01,
        -4.3805e-01,  1.3119e-01, -8.0883e-02,  1.8536e-02,  2.1539e-01,
         1.7498e-01,  6.1703e-02,  3.1424e-01,  0.0000e+00, -1.1888e+00,
         5.9158e-01, -2.6573e+00,  1.7831e-01,  1.7976e-03,  2.0100e-01,
        -4.3975e-02,  2.2156e-01, -1.9400e-01, -3.7220e-02, -1.5561e-01,
         1.3058e-01, -3.2229e-01, -3.0179e-01,  3.2513e-01,  3.0975e-01,
        -4.0562e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([12511]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-2.3912e-02, -5.8418e-01,  2.6615e-01,  1.8227e+00, -7.9206e-01,
        -5.7132e-01, -1.5597e+00, -8.6613e-01,  1.3448e-02, -4.0320e-01,
        -7.3818e-01,  4.7034e-02, -3.8436e+00,  1.1724e+00,  4.2549e-01,
        -1.9630e+00, -1.8135e-01, -3.7993e-01, -4.6621e-02, -1.6919e+00,
        -1.4811e-01, -5.3354e-02, -2.6453e-02, -5.3272e-01,  6.4118e-02,
        -5.3700e-01, -6.4345e-01, -4.9842e-02, -9.5630e-01,  1.6872e+00,
        -5.0354e-01, -2.1994e-01,  2.2919e-01, -2.0463e-03, -7.7073e-01,
        -2.8178e-01, -1.0711e-01, -6.7097e-01, -4.4602e-01, -1.0738e+00,
        -2.4302e-01, -9.7469e-01, -4.7558e-01, -1.4572e-02, -6.5785e-01,
        -7.3570e-01, -6.3836e-01, -7.4691e-01,  1.8460e-01, -4.9137e-01,
         7.6610e-01, -8.5028e-01, -5.3733e-01, -5.3597e-01, -7.3272e-01,
         1.9813e-01, -9.9838e-01,  2.1446e-01, -3.4673e-01, -3.3022e-01,
         1.3082e-02, -3.8348e-01,  4.2007e-01,  2.2035e-01, -1.4582e-02,
         3.2187e-01, -1.3924e+00,  9.4919e-01, -8.5109e-03, -4.8587e-01,
        -3.1924e-01, -2.1984e-02, -2.8254e-02, -6.3183e-01,  1.0355e-01,
        -1.2528e+00,  2.1320e+00, -2.0209e-01,  1.8162e-01,  1.2541e-02,
         3.0178e-03, -8.5876e-01,  6.3903e-01,  7.2192e-02, -4.7227e-01,
        -1.4130e-01, -1.3768e-01, -3.4183e-01, -3.7515e-01,  1.5278e+00,
        -4.8235e-01,  1.1426e+00,  1.8266e-02, -6.5426e-01, -1.2414e+00,
        -3.8822e-01,  7.6086e-01, -1.8048e+00,  1.1585e+00,  5.9327e-01,
         4.2696e-02, -1.7440e+00, -8.0883e-02,  1.7935e+00,  2.1539e-01,
         2.4999e+00,  1.3570e-02,  3.1424e-01,  0.0000e+00, -1.4868e+00,
        -7.2428e-01, -4.2164e-01,  1.2112e-01,  9.5453e+00,  2.0100e-01,
        -4.3975e-02, -9.9337e-02, -2.6256e-01, -3.2969e+00,  7.2596e-01,
         2.9793e-01,  5.6518e-01, -3.6796e-01,  1.5587e-01,  1.5892e-01,
        -3.7067e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([4880]), tensor(0.1481))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001]
INFO:main.py:Testing data year: 2002
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 30
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 13927
            device: cpu
            
2024-07-16 10:20:02,389	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 10:20:02,434	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 10:20:02,470	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 10:20:02,479	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 10:20:06,442	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 10:40:57,840	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_10-20-06' in 0.1495s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 13927, 'embedding_dim': 25, 'dropout_rate': 0.37, 'lr': 0.005, 'weight_decay': 2.3845927361089558e-05, 'num_epochs': 30, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03559915946551682
INFO:model_data_nn.py:Best trial testing loss: 0.046499310782615176
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_10-19-59_482097_2708215/artifacts/2024-07-16_10-20-06/train_fnn_2024-07-16_10-20-06/driver_artifacts/train_fnn_a5508_00034_34_dropout_rate=0.3700,embedding_dim=25,hidden_dim=5,lr=0.0050,num_layers=4,weight_decay=0.0000_2024-07-16_10-20-06
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 4, 'num_embeddings': 14098, 'embedding_dim': 25, 'dropout_rate': 0.37, 'lr': 0.005, 'weight_decay': 2.3845927361089558e-05, 'num_epochs': 30, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/30, metrics: {'avg_train_loss': 0.2994491307201253, 'avg_test_loss': 0.037742678949411974}
INFO:model_data_nn.py:Epoch 2/30, metrics: {'avg_train_loss': 0.03675479076128796, 'avg_test_loss': 0.03754089698023785}
INFO:model_data_nn.py:Epoch 3/30, metrics: {'avg_train_loss': 0.03642402434763865, 'avg_test_loss': 0.03687623765293835}
INFO:model_data_nn.py:Epoch 4/30, metrics: {'avg_train_loss': 0.03621001759254712, 'avg_test_loss': 0.038188438308918805}
INFO:model_data_nn.py:Epoch 5/30, metrics: {'avg_train_loss': 0.03621001996064304, 'avg_test_loss': 0.036394727892727345}
INFO:model_data_nn.py:Epoch 6/30, metrics: {'avg_train_loss': 0.036207535708241055, 'avg_test_loss': 0.0371479438360317}
INFO:model_data_nn.py:Epoch 7/30, metrics: {'avg_train_loss': 0.03620695799811315, 'avg_test_loss': 0.036424898993103735}
INFO:model_data_nn.py:Epoch 8/30, metrics: {'avg_train_loss': 0.036188453017072075, 'avg_test_loss': 0.03729677898380133}
INFO:model_data_nn.py:Early stopping at epoch 8
INFO:main.py:Making prediction for data in year: 2003
INFO:main.py:Prediction data shape: (55419,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:356: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  
INFO:main.py:Root Mean Squared Error for Prediction in 2003: 0.19324966957875708
INFO:main.py:Prediction Stats:                 ret          pred
count  55419.000000  55419.000000
mean       0.050470      0.013905
std        0.190533      0.016098
min       -0.941860     -0.019993
25%       -0.034663      0.002968
50%        0.024451      0.008022
75%        0.101886      0.018886
max        5.178572      0.133513
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:transform_data_nn.py:Train_data: (1407955, 161)

INFO:transform_data_nn.py:Test data years: [2008]
INFO:transform_data_nn.py:Test_data: (47807, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:transform_data_nn.py:Retrain_data: (1455762, 161)

INFO:transform_data_nn.py:Prediction data years: [2009]
INFO:transform_data_nn.py:Prediction_data: (46521, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1407955, 152])
            y_train_tf: torch.Size([1407955])

            x_test_tf: torch.Size([47807, 152])
            y_test_tf: torch.Size([47807])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1455762, 152])
            y_retrain_tf: torch.Size([1455762])

            x_prediction_tf: torch.Size([46521, 152])
            y_prediction_tf: torch.Size([46521])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.4123e-01,  8.8631e-01,  7.1884e-02, -1.5963e+00, -1.2988e-01,
        -8.1493e-01, -1.4784e-01, -3.5044e-01,  4.8494e-01, -1.8105e-01,
        -7.0387e-01,  7.4739e-02, -7.1867e-01, -5.1933e-01,  9.3083e-02,
         5.0552e-01, -1.3518e-01,  2.0184e-01, -8.9291e-02,  5.7743e-01,
        -4.2096e-01, -5.2113e-02, -1.7388e-01,  2.8521e-03, -9.5203e-02,
        -3.3818e-01, -5.9339e-01, -6.4914e-02,  4.0576e-01,  1.4620e+00,
         3.5585e-01, -1.3656e-01,  7.9712e-01,  2.9356e-01, -2.3266e-01,
        -2.4634e-01,  1.1436e-01,  9.0324e-01, -2.7283e-02, -1.1237e+00,
        -2.7994e-01,  2.7349e-01,  3.3532e-01,  5.8899e-02, -1.7454e-01,
        -7.3735e-01,  9.3254e-02, -6.9056e-02, -3.8341e-01, -1.5377e-01,
        -8.3869e-01,  3.9100e-01, -4.7565e-01,  9.0275e-02, -2.8986e-02,
         4.9662e-01, -5.9960e-01, -1.9345e-01, -2.4803e-01, -3.7506e-02,
        -6.9434e-04, -3.0570e-01,  4.6419e-02,  2.1592e-01,  6.3170e-02,
        -2.0195e-01,  7.1503e-01, -2.6833e-01,  6.3183e-01, -5.6992e-01,
        -3.4024e-01, -1.7085e-01, -2.7676e-02, -8.8375e-01,  1.7102e-01,
         7.5025e-01,  8.5434e-01, -1.1605e+00,  2.8447e-01,  1.9116e-02,
        -8.6020e-01,  1.7818e-01,  3.7074e-01, -1.0326e-01, -5.6656e-01,
        -4.4216e-01, -5.4146e-01, -2.6953e-01,  7.7758e-02,  1.0843e-01,
        -5.7521e-01, -1.3403e+00,  2.3529e-01, -1.9984e-15, -1.9984e-15,
         3.0597e+00,  6.7297e-03,  2.5184e+00, -2.8415e+00,  9.0332e-01,
        -4.3563e-01,  1.6853e-01,  2.9109e-02,  5.3051e-02,  2.2130e-01,
         1.3301e-01, -1.3171e-01,  2.2382e-01,  3.4323e-01, -1.0508e+00,
         7.7589e-01,  3.5527e-14,  3.3807e-01, -7.2559e-03,  5.3484e-02,
         5.2950e-03,  3.0693e-01, -2.3542e-01,  1.8351e-02, -5.7371e-01,
         1.3508e-01, -2.7369e-01, -3.8936e-01,  3.5446e-01,  3.6620e-01,
        -4.1113e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([13464]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-2.7943e-01,  7.7531e-01, -6.4472e-01,  1.2897e+00, -7.5690e-01,
        -3.0547e-01, -3.8866e-01, -5.0463e-01, -2.7411e-01, -4.1117e-02,
        -6.0953e-01, -9.8183e-03, -1.8060e-02, -2.5756e-01, -5.6119e-01,
        -8.4235e-01, -1.7012e-01, -5.0679e-01, -8.9291e-02, -8.6728e-01,
        -8.8892e-01, -1.2913e-01,  1.7832e-01, -1.9660e-01, -4.0706e-01,
        -2.6660e-01, -6.6176e-01, -6.4914e-02, -6.3924e-01,  7.1453e-01,
         1.9307e-01, -3.1002e-02,  3.6506e-01,  2.9356e-01, -5.7415e-01,
        -4.5880e-01, -1.5480e+00, -6.9877e-01, -9.8372e-01, -2.3487e-01,
        -1.8823e-01, -1.3357e-01, -1.8127e+00, -4.1985e-01, -7.7199e-01,
        -4.6519e-01,  3.5896e-01, -9.5155e-02,  3.6774e-01, -2.4064e-01,
        -4.2954e-02, -5.7194e-01, -4.7565e-01, -6.7704e-01, -2.8986e-02,
         1.6750e-01, -9.7081e-01, -3.5513e-01,  1.0076e+00,  4.0178e-01,
         4.4269e-01,  1.0287e+00, -1.4234e-01,  1.9766e-01, -4.2911e-02,
        -3.0277e-01,  6.5446e-01, -1.1146e+00, -4.1720e-02, -5.1963e-01,
        -3.4024e-01, -1.7085e-01, -2.7676e-02, -3.0577e-01,  2.1065e-01,
        -2.6052e-01,  8.5434e-01, -6.6488e-01,  1.4957e+00,  1.9116e-02,
        -8.6020e-01, -8.6404e-01, -2.6620e-01,  7.9185e-01, -5.0705e-01,
        -3.1222e-01, -4.4778e-01, -2.6698e-01, -3.3567e-01,  2.4986e-01,
        -5.9944e-01, -9.9551e-01,  2.3529e-01, -1.9984e-15, -1.9984e-15,
        -5.3086e-01, -2.9218e+00, -8.4928e-01, -4.1238e-01,  4.7547e-01,
         1.8191e-02, -5.8160e-01, -9.7670e-01,  3.0776e+00,  1.9026e+00,
         2.4192e-01, -1.5185e-01,  2.2382e-01,  1.1379e+00, -1.8054e-01,
        -4.4070e-01,  3.5527e-14,  2.4860e-01,  4.5580e+00,  5.3484e-02,
         5.2950e-03, -1.4492e-01, -4.9493e-01,  1.8351e-02, -2.5470e-01,
        -1.3551e+00, -4.7874e-02, -1.2726e-01,  3.6582e-01,  2.8470e-01,
        -2.9134e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([4050]), tensor(-0.0061))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.3556e-01,  8.9501e-01,  7.2648e-02, -1.6100e+00, -1.2826e-01,
        -8.2624e-01, -1.4790e-01, -3.5040e-01,  4.7651e-01, -1.7795e-01,
        -7.0519e-01,  7.7076e-02, -7.1684e-01, -5.2199e-01,  9.2188e-02,
         5.0981e-01, -1.3160e-01,  2.0659e-01, -8.5341e-02,  5.8516e-01,
        -4.1586e-01, -5.2675e-02, -1.7384e-01,  5.2328e-03, -9.5722e-02,
        -3.3812e-01, -5.9416e-01, -7.1346e-02,  3.8254e-01,  1.4512e+00,
         3.5313e-01, -1.3439e-01,  7.9474e-01,  2.9877e-01, -2.2688e-01,
        -2.4613e-01,  1.1696e-01,  9.0783e-01, -2.5742e-02, -1.1184e+00,
        -2.7863e-01,  3.0884e-01,  3.4117e-01,  5.2429e-02, -1.7405e-01,
        -7.4253e-01,  1.1172e-01, -5.6634e-02, -3.8354e-01, -1.3762e-01,
        -8.4047e-01,  3.7580e-01, -4.7466e-01,  8.9405e-02, -2.3847e-02,
         4.9529e-01, -5.9135e-01, -1.9021e-01, -2.4711e-01, -3.5894e-02,
         1.6576e-03, -3.0455e-01,  4.9130e-02,  2.1504e-01,  6.3754e-02,
        -2.0142e-01,  7.2637e-01, -2.6723e-01,  6.3338e-01, -5.7095e-01,
        -3.4318e-01, -1.7305e-01, -2.8461e-02, -8.9090e-01,  1.7429e-01,
         7.5424e-01,  8.6411e-01, -1.1693e+00,  2.8316e-01,  1.8770e-02,
        -8.6453e-01,  1.7930e-01,  3.7423e-01, -8.1412e-02, -5.7120e-01,
        -4.4850e-01, -5.4641e-01, -2.6781e-01,  8.2742e-02,  1.1322e-01,
        -5.8305e-01, -1.3411e+00,  2.3982e-01,  3.1086e-15,  3.1086e-15,
         3.1152e+00,  1.0144e-01,  2.5269e+00, -2.8806e+00,  7.9351e-01,
        -3.9410e-01,  1.7615e-01,  1.5259e-02,  4.8479e-02,  2.0858e-01,
         1.2312e-01, -1.3249e-01,  2.3001e-01,  2.6162e-01, -1.0323e+00,
         7.9886e-01, -2.1316e-14,  3.3662e-01, -6.0556e-03,  3.6523e-02,
         3.7105e-03,  3.1943e-01, -2.3633e-01,  1.8116e-02, -5.7116e-01,
         1.3585e-01, -2.6562e-01, -3.8207e-01,  3.5502e-01,  3.6441e-01,
        -4.1081e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([13708]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-8.5803e-01,  1.6539e-01, -4.3643e-01,  1.2683e+00,  8.8404e-01,
         2.0447e+00,  4.7068e-01,  1.7437e-01,  2.8753e-01, -1.2035e+00,
        -5.1593e-01, -2.7148e-01, -7.1684e-01,  1.8260e-01, -7.2088e-02,
         5.0390e-03, -2.1394e-01,  1.7922e+00, -8.9696e-03,  1.8514e-01,
         3.5480e+00, -1.3240e+00, -1.6457e-01, -1.4603e-01,  5.0152e-01,
        -7.2687e-01, -5.3528e-01, -7.1346e-02,  4.8230e-01,  3.2680e-01,
        -2.7610e+00,  7.7016e-01,  1.6497e-01, -1.1407e+00, -9.2433e-01,
        -1.1777e-01, -2.1817e-01, -3.2063e-02,  1.5511e+00,  3.4593e-01,
        -2.6977e-01, -1.5618e+00, -9.6209e-02,  1.7594e+00,  3.8833e-01,
         1.5907e+00, -9.0257e-02,  1.2190e+00, -7.7373e-01,  2.4789e+00,
         1.5494e+00,  3.0037e-01, -4.7466e-01, -3.6544e-01, -7.3406e-01,
        -1.1065e-01, -9.0610e-01, -3.1777e-01, -1.7248e-01,  4.4821e-01,
        -2.4596e-02, -2.2277e-01, -2.2090e+00, -4.9511e-01, -6.7366e-01,
        -1.3343e+00, -4.9429e-01,  6.0919e-02,  6.3338e-01, -5.0926e-01,
        -3.4318e-01, -1.7305e-01, -2.8461e-02,  2.5520e+00, -1.9842e-01,
        -5.9180e-02, -1.4246e+00, -1.6058e+00, -1.7063e+00,  1.8770e-02,
         7.8991e-01,  2.7818e-01, -5.8609e-01, -2.9817e-01, -1.5207e-01,
         7.8044e-01,  1.5895e+00, -3.8269e-01,  4.2973e-01, -1.8183e-01,
        -3.0082e-03, -6.7356e-01,  2.3982e-01,  3.1086e-15,  3.1086e-15,
        -5.5960e-02, -1.6395e+00, -1.8837e+00,  6.3985e-01,  5.9574e+00,
         3.2213e+00,  4.8334e-03, -2.3350e+00,  1.0134e-01, -3.4640e+00,
        -3.2624e-01, -2.5987e-01, -2.1428e-01,  1.9968e+00, -1.4542e+00,
        -2.8394e-01, -2.1316e-14,  4.0623e-01, -6.0556e-03, -9.9253e-01,
        -7.1666e-01, -1.1255e+00,  9.5026e-02,  1.8116e-02,  3.2015e-01,
         1.4504e-02, -1.2044e+00, -1.1081e+00,  9.9966e-02, -9.7968e-03,
        -4.1341e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([4108]), tensor(-0.3991))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:main.py:Testing data year: 2008
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 30
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15183
            device: cpu
            
2024-07-16 14:00:34,551	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 14:00:34,605	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 14:00:34,658	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip' (1.37MiB) to Ray cluster...
2024-07-16 14:00:34,665	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_5491aab014ee5b6d.zip'.
2024-07-16 14:00:39,018	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 14:29:57,502	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_14-00-39' in 0.1235s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 1, 'num_embeddings': 15183, 'embedding_dim': 15, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 0.000526576127715743, 'num_epochs': 30, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03391598684967242
INFO:model_data_nn.py:Best trial testing loss: 0.043847992299074795
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-16_14-00-31_465738_2708215/artifacts/2024-07-16_14-00-39/train_fnn_2024-07-16_14-00-39/driver_artifacts/train_fnn_748b3_00022_22_dropout_rate=0.5200,embedding_dim=15,hidden_dim=5,lr=0.0100,num_layers=1,weight_decay=0.0005_2024-07-16_14-00-39
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 5, 'num_layers': 1, 'num_embeddings': 15465, 'embedding_dim': 15, 'dropout_rate': 0.52, 'lr': 0.01, 'weight_decay': 0.000526576127715743, 'num_epochs': 30, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/30, metrics: {'avg_train_loss': 1.4722937432027527, 'avg_test_loss': 0.07371379448367017}
INFO:model_data_nn.py:Epoch 2/30, metrics: {'avg_train_loss': 0.03416244705547127, 'avg_test_loss': 0.07232208262903841}
INFO:model_data_nn.py:Epoch 3/30, metrics: {'avg_train_loss': 0.03419937885883709, 'avg_test_loss': 0.07326937605534772}
INFO:model_data_nn.py:Epoch 4/30, metrics: {'avg_train_loss': 0.034203372609950454, 'avg_test_loss': 0.07435247227856583}
INFO:model_data_nn.py:Epoch 5/30, metrics: {'avg_train_loss': 0.03422188275682501, 'avg_test_loss': 0.07384199092348853}
INFO:model_data_nn.py:Early stopping at epoch 5
INFO:main.py:Making prediction for data in year: 2009
INFO:main.py:Prediction data shape: (46521,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:356: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  
INFO:main.py:Root Mean Squared Error for Prediction in 2009: 0.27169106571969953
INFO:main.py:Prediction Stats:                 ret          pred
count  46521.000000  46521.000000
mean       0.047317      0.010332
std        0.269893      0.005621
min       -0.972173      0.002266
25%       -0.069401      0.007091
50%        0.020202      0.007966
75%        0.120234      0.011599
max       15.774193      0.048720
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:transform_data_nn.py:Train_data: (1546326, 161)

INFO:transform_data_nn.py:Test data years: [2011]
INFO:transform_data_nn.py:Test_data: (42205, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:transform_data_nn.py:Retrain_data: (1588531, 161)

INFO:transform_data_nn.py:Prediction data years: [2012]
INFO:transform_data_nn.py:Prediction_data: (40994, 161)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1546326, 152])
            y_train_tf: torch.Size([1546326])

            x_test_tf: torch.Size([42205, 152])
            y_test_tf: torch.Size([42205])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1588531, 152])
            y_retrain_tf: torch.Size([1588531])

            x_prediction_tf: torch.Size([40994, 152])
            y_prediction_tf: torch.Size([40994])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.3927e-01,  9.1362e-01,  7.3040e-02, -1.6380e+00, -1.1193e-01,
        -8.4131e-01, -1.4537e-01, -3.4648e-01,  4.4611e-01, -1.7234e-01,
        -7.1204e-01,  8.8603e-02, -7.0973e-01, -5.3057e-01,  9.3019e-02,
         5.1464e-01, -1.2764e-01,  2.1285e-01, -8.8361e-02,  6.0712e-01,
        -4.1162e-01, -6.0162e-02, -1.7526e-01,  9.5381e-03, -8.8918e-02,
        -3.3825e-01, -5.9550e-01, -8.5255e-02,  3.4450e-01,  1.4138e+00,
         3.4766e-01, -1.2383e-01,  7.9050e-01,  3.0998e-01, -2.2421e-01,
        -2.3519e-01,  1.4277e-01,  9.1161e-01, -1.3247e-02, -1.1311e+00,
        -2.7677e-01,  3.0116e-01,  3.6358e-01,  3.5865e-02, -1.6293e-01,
        -7.4726e-01,  1.1604e-01, -6.3421e-02, -3.4996e-01, -1.3595e-01,
        -8.4847e-01,  3.5329e-01, -4.7331e-01,  8.5049e-02, -1.9453e-02,
         4.9264e-01, -5.7712e-01, -1.8437e-01, -2.4903e-01, -3.8648e-02,
         4.9528e-03, -3.0698e-01,  6.3616e-02,  2.1423e-01,  7.0318e-02,
        -1.9574e-01,  7.5221e-01, -2.6464e-01,  6.3217e-01, -5.7330e-01,
        -3.4933e-01, -1.7559e-01, -2.9092e-02, -8.9872e-01,  1.8520e-01,
         7.6351e-01,  8.8474e-01, -1.1792e+00,  2.7609e-01,  1.8951e-02,
        -9.6567e-01,  1.9667e-01,  3.7361e-01, -4.4194e-02, -5.7447e-01,
        -4.5898e-01, -5.5389e-01, -2.7038e-01,  8.9678e-02,  1.1469e-01,
        -5.9617e-01, -1.3397e+00,  2.4770e-01,  1.6653e-15,  1.6653e-15,
         3.2045e+00,  1.2849e-01,  2.4799e+00, -2.9059e+00,  6.0545e-01,
        -4.2080e-01,  1.9761e-01, -1.4282e-02, -5.6949e-02,  2.0421e-01,
         1.1749e-01, -1.4323e-01,  2.4634e-01,  5.3020e-01, -9.0624e-01,
         8.0823e-01, -8.8818e-15,  3.3851e-01,  1.3375e-02,  9.3341e-02,
         8.8609e-03,  3.4298e-01, -2.2962e-01,  1.7690e-02, -5.6735e-01,
         1.3758e-01, -2.5264e-01, -3.6472e-01,  3.6131e-01,  3.6599e-01,
        -4.1448e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([13918]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-1.4593e-01, -3.8136e-01,  1.7007e+00,  1.2281e+00,  1.3378e+00,
        -8.6637e-01, -5.5292e-01, -5.9307e-01, -1.2677e-01, -7.7821e-02,
        -4.8795e-01,  2.7126e-01, -7.0973e-01,  6.1386e-01,  9.6481e-02,
        -9.4817e-01,  2.0251e+00,  1.5007e+00, -8.8361e-02, -5.2999e-02,
        -2.1600e-01, -1.3043e-01, -1.5659e-01, -9.0095e-01,  8.6518e-01,
        -8.5948e-01, -5.7521e-01, -8.5255e-02,  6.5512e-01,  4.1118e-01,
         2.2221e-03,  7.8361e-01,  5.5636e-01,  3.0998e-01, -6.4979e-01,
         6.8597e-01,  4.4710e-01, -7.1851e-01,  1.1294e+00, -3.9751e-01,
        -2.7684e-01, -1.6970e-01,  3.6364e-01, -3.8339e-01,  7.1276e-01,
        -8.7437e-01, -1.7867e-01,  2.7941e-01, -8.7806e-02, -3.0062e-01,
         2.3450e+00, -2.6722e-01, -4.7331e-01, -6.7984e-01, -7.3664e-01,
         1.3883e-01, -9.5501e-01,  9.5136e-02, -7.1711e-01, -3.6146e-01,
         6.3871e-01, -5.5510e-01, -6.6889e-02, -1.3412e+00, -4.1492e-02,
        -2.5361e-01, -4.8886e-01, -3.9092e-01,  2.6562e+00, -7.3027e-01,
        -3.4933e-01, -1.7559e-01, -2.9092e-02, -1.0677e+00,  1.0917e-01,
         6.8587e-02,  8.8474e-01,  1.1271e-01,  1.5018e+00,  1.8951e-02,
        -9.6567e-01, -2.3218e-01, -4.1358e-01, -8.6765e-01, -3.7993e-01,
        -3.1589e-01, -4.5597e-01, -1.6292e-01, -5.7360e-01,  5.4074e-01,
        -2.6168e-01, -3.5320e-01,  2.4770e-01,  1.6653e-15,  1.6653e-15,
        -4.6751e-02,  2.3229e-01, -1.6333e+00,  1.2606e+00,  8.3593e-02,
        -3.5448e-01, -1.0159e-01, -1.4282e-02, -1.1116e+00,  2.0421e-01,
        -6.1516e-01, -1.6577e-01,  2.4634e-01,  1.3764e+00, -1.2562e+00,
        -8.3904e-01, -8.8818e-15,  3.7177e-01,  1.3788e+00,  9.3341e-02,
         8.8609e-03, -6.0953e-01,  2.4734e-01,  1.7690e-02, -3.5042e-01,
         1.2694e-01, -5.7492e-01, -7.4430e-01,  4.7313e-01,  4.0679e-01,
        -3.0843e-01,  1.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([3488]), tensor(0.0290))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.3421e-01,  9.2012e-01,  7.1742e-02, -1.6520e+00, -1.0992e-01,
        -8.4323e-01, -1.4508e-01, -3.4537e-01,  4.4567e-01, -1.7088e-01,
        -7.1560e-01,  8.5419e-02, -7.0943e-01, -5.3811e-01,  9.5369e-02,
         5.1465e-01, -1.2572e-01,  2.1018e-01, -8.8127e-02,  6.1102e-01,
        -4.0930e-01, -6.4709e-02, -1.7532e-01,  8.7376e-03, -9.0806e-02,
        -3.3850e-01, -5.9558e-01, -8.7117e-02,  3.2482e-01,  1.4134e+00,
         3.4916e-01, -1.2327e-01,  7.9186e-01,  3.1495e-01, -2.2519e-01,
        -2.2767e-01,  1.5045e-01,  9.1205e-01, -1.0170e-02, -1.1348e+00,
        -2.7491e-01,  2.9941e-01,  3.7015e-01,  3.2821e-02, -1.6069e-01,
        -7.4617e-01,  1.1367e-01, -6.2026e-02, -3.4387e-01, -1.3735e-01,
        -8.4920e-01,  3.3791e-01, -4.7321e-01,  8.5036e-02, -1.8521e-02,
         4.9203e-01, -5.7006e-01, -1.8394e-01, -2.4943e-01, -3.5014e-02,
         2.1188e-03, -3.0702e-01,  6.6905e-02,  2.1398e-01,  6.7521e-02,
        -1.9403e-01,  7.6069e-01, -2.6284e-01,  6.2228e-01, -5.7448e-01,
        -3.5127e-01, -1.7636e-01, -2.8452e-02, -8.9912e-01,  1.8356e-01,
         7.6858e-01,  8.9458e-01, -1.1816e+00,  2.7376e-01,  2.0176e-02,
        -9.8291e-01,  1.9850e-01,  3.7997e-01, -2.6430e-02, -5.7605e-01,
        -4.6305e-01, -5.5644e-01, -2.7175e-01,  9.2949e-02,  1.1296e-01,
        -6.0263e-01, -1.3391e+00,  2.5116e-01, -1.3323e-15, -1.3323e-15,
         3.2488e+00,  1.2636e-01,  2.4694e+00, -2.9267e+00,  6.1437e-01,
        -4.2846e-01,  2.0126e-01, -7.3742e-03,  1.1344e-02,  1.9078e-01,
         5.9915e-02, -1.4803e-01,  2.8404e-01,  5.8679e-01, -8.9707e-01,
         8.2537e-01,  2.1316e-14,  3.3517e-01,  2.6516e-02,  8.0245e-02,
         1.1423e-02,  3.5462e-01, -2.2791e-01,  1.7505e-02, -5.6513e-01,
         1.3821e-01, -2.4568e-01, -3.6121e-01,  3.6028e-01,  3.6456e-01,
        -4.1616e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([14055]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-9.1680e-01,  2.5333e-01, -3.3042e-01,  1.2092e+00,  6.4526e-02,
        -8.7021e-01, -1.2434e+00, -8.3151e-01,  7.2332e-02,  1.2866e-01,
        -3.9015e-01,  9.9670e-02, -7.0943e-01,  1.1884e-01, -2.7242e-01,
        -4.2252e-01, -2.1169e-01,  4.4219e-01, -1.5472e-02, -1.8236e-02,
        -2.6021e-01, -1.3249e-01, -2.2232e-01,  1.1231e-01, -2.4745e-01,
        -7.1799e-01, -6.5159e-01, -8.7117e-02, -2.7374e-01,  7.1037e-01,
         1.1697e-02,  2.9420e-01,  4.0988e-01,  3.1495e-01, -6.5863e-01,
        -3.2210e-01,  2.2429e+00, -7.1675e-01,  4.3161e-02, -8.1128e-01,
        -2.7217e-01, -1.1558e-02,  1.5891e+00, -4.0628e-01, -2.8799e-01,
        -8.6979e-01, -7.2526e-02,  2.7887e-01,  1.4523e-01, -2.4733e-01,
        -5.1036e-02, -2.2253e-01, -4.7321e-01, -3.7991e-01, -7.3723e-01,
         6.7478e-02, -9.4996e-01, -4.4855e-01,  8.9354e-01, -2.8457e-01,
        -1.4531e-01,  8.6250e-01,  2.5218e-01,  3.0592e-01, -4.0632e-02,
        -1.0468e-01, -8.1529e-02, -1.4994e+00, -7.2441e-01, -6.1754e-01,
        -3.5127e-01, -1.7636e-01, -2.8452e-02, -1.0305e+00,  2.0811e-01,
        -2.0925e-02,  2.6687e-01,  3.3106e-01,  1.5040e+00,  2.0176e-02,
         9.2158e-01,  1.1675e-01, -3.7812e-01, -5.1189e-01, -5.7238e-01,
        -3.3073e-01, -4.6618e-01, -4.1641e-01, -3.8912e-01, -2.3085e-01,
        -5.8487e-01,  1.7653e+00,  2.5116e-01, -1.3323e-15, -1.3323e-15,
        -5.0232e-02, -7.2598e-01, -1.5988e+00,  2.0591e-01,  6.1437e-01,
        -8.5679e-03, -6.7703e-02, -7.3742e-03, -8.3765e-01,  1.9078e-01,
         3.9580e+00, -1.6830e-01, -1.8694e-01,  2.3162e+00, -6.9272e-01,
        -4.2502e-01,  2.1316e-14,  3.4075e-01, -6.5667e-02, -6.3208e-01,
        -3.4313e+00, -5.9664e-01, -2.5386e-01,  1.7505e-02, -5.3497e-01,
        -6.5585e-01, -5.4200e-01, -5.1239e-01,  3.3924e-01,  1.9796e-01,
        -3.1040e-01,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00]), tensor([3359]), tensor(-0.0197))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:main.py:Testing data year: 2011
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 50
            max_num_epochs: 30
            num_cpus: 50
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 15706
            device: cpu
            
2024-07-16 18:14:10,452	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-16 18:14:10,549	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-16 18:14:10,595	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_524ec76d8a57c10b.zip' (1.31MiB) to Ray cluster...
2024-07-16 18:14:10,604	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_524ec76d8a57c10b.zip'.
2024-07-16 18:14:15,104	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-16 18:14:54,078	ERROR tune_controller.py:1331 -- Trial task failed for trial train_fnn_e209a_00045
Traceback (most recent call last):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/air/execution/_internal/event_manager.py", line 110, in resolve_future
    result = ray.get(future)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/auto_init_hook.py", line 21, in auto_init_wrapper
    return fn(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 2613, in get
    values, debugger_breakpoint = worker.get_objects(object_refs, timeout=timeout)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 863, in get_objects
    raise value
ray.exceptions.ActorDiedError: The actor died unexpectedly before finishing this task.
	class_name: ImplicitFunc
	actor_id: 19d40e5cb5968316a772cac001000000
	pid: 394680
	namespace: 3fa97b35-a2a0-4556-8ac0-8593d2bdf61e
	ip: 10.112.2.34
The actor is dead because its worker process has died. Worker exit type: SYSTEM_ERROR Worker exit detail: Worker unexpectedly exits with a connection error code 2. End of file. There are some potential root causes. (1) The process is killed by SIGKILL by OOM killer due to high memory usage. (2) ray stop --force is called. (3) The worker is crashed unexpectedly due to SIGSEGV or other unexpected errors.
2024-07-16 18:14:54,105	ERROR tune_controller.py:1331 -- Trial task failed for trial train_fnn_e209a_00049
Traceback (most recent call last):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/air/execution/_internal/event_manager.py", line 110, in resolve_future
    result = ray.get(future)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/auto_init_hook.py", line 21, in auto_init_wrapper
    return fn(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 2613, in get
    values, debugger_breakpoint = worker.get_objects(object_refs, timeout=timeout)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 863, in get_objects
    raise value
ray.exceptions.ActorUnavailableError: The actor 07e6557a9b4227b8078cf22e01000000 is unavailable: The actor is temporarily unavailable: GrpcUnavailable: RPC Error message: Socket closed; RPC Error details: . The task may or maynot have been executed on the actor.
2024-07-16 18:14:54,112	ERROR tune_controller.py:1331 -- Trial task failed for trial train_fnn_e209a_00002
Traceback (most recent call last):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/air/execution/_internal/event_manager.py", line 110, in resolve_future
    result = ray.get(future)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/auto_init_hook.py", line 21, in auto_init_wrapper
    return fn(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 2613, in get
    values, debugger_breakpoint = worker.get_objects(object_refs, timeout=timeout)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 863, in get_objects
    raise value
ray.exceptions.ActorUnavailableError: The actor f1a99b35ac96decda16b3ffe01000000 is unavailable: The actor is temporarily unavailable: GrpcUnavailable: RPC Error message: Socket closed; RPC Error details: . The task may or maynot have been executed on the actor.
2024-07-16 18:14:54,121	ERROR tune_controller.py:1331 -- Trial task failed for trial train_fnn_e209a_00027
Traceback (most recent call last):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/air/execution/_internal/event_manager.py", line 110, in resolve_future
    result = ray.get(future)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/auto_init_hook.py", line 21, in auto_init_wrapper
    return fn(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 2613, in get
    values, debugger_breakpoint = worker.get_objects(object_refs, timeout=timeout)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 863, in get_objects
    raise value
ray.exceptions.ActorUnavailableError: The actor 9bb5d8f83f63f3f9670d1d5101000000 is unavailable: The actor is temporarily unavailable: GrpcUnavailable: RPC Error message: Socket closed; RPC Error details: . The task may or maynot have been executed on the actor.
2024-07-16 18:14:54,293	ERROR tune_controller.py:1331 -- Trial task failed for trial train_fnn_e209a_00046
Traceback (most recent call last):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/air/execution/_internal/event_manager.py", line 110, in resolve_future
    result = ray.get(future)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/auto_init_hook.py", line 21, in auto_init_wrapper
    return fn(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 2613, in get
    values, debugger_breakpoint = worker.get_objects(object_refs, timeout=timeout)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 863, in get_objects
    raise value
ray.exceptions.ActorDiedError: The actor died unexpectedly before finishing this task.
	class_name: ImplicitFunc
	actor_id: 7fbcb83ea8a2cb1cd9c37dcf01000000
	pid: 394681
	namespace: 3fa97b35-a2a0-4556-8ac0-8593d2bdf61e
	ip: 10.112.2.34
The actor is dead because its worker process has died. Worker exit type: SYSTEM_ERROR Worker exit detail: Worker unexpectedly exits with a connection error code 2. End of file. There are some potential root causes. (1) The process is killed by SIGKILL by OOM killer due to high memory usage. (2) ray stop --force is called. (3) The worker is crashed unexpectedly due to SIGSEGV or other unexpected errors.
2024-07-16 18:14:54,307	ERROR tune_controller.py:1331 -- Trial task failed for trial train_fnn_e209a_00007
Traceback (most recent call last):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/air/execution/_internal/event_manager.py", line 110, in resolve_future
    result = ray.get(future)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/auto_init_hook.py", line 21, in auto_init_wrapper
    return fn(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 2613, in get
    values, debugger_breakpoint = worker.get_objects(object_refs, timeout=timeout)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 863, in get_objects
    raise value
ray.exceptions.ActorDiedError: The actor died unexpectedly before finishing this task.
	class_name: ImplicitFunc
	actor_id: 18270d63e1594d729e19600a01000000
	pid: 391271
	namespace: 3fa97b35-a2a0-4556-8ac0-8593d2bdf61e
	ip: 10.112.2.34
The actor is dead because its worker process has died. Worker exit type: SYSTEM_ERROR Worker exit detail: Worker unexpectedly exits with a connection error code 2. End of file. There are some potential root causes. (1) The process is killed by SIGKILL by OOM killer due to high memory usage. (2) ray stop --force is called. (3) The worker is crashed unexpectedly due to SIGSEGV or other unexpected errors.
2024-07-16 18:14:54,319	ERROR tune_controller.py:1331 -- Trial task failed for trial train_fnn_e209a_00048
Traceback (most recent call last):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/air/execution/_internal/event_manager.py", line 110, in resolve_future
    result = ray.get(future)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/auto_init_hook.py", line 21, in auto_init_wrapper
    return fn(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 2613, in get
    values, debugger_breakpoint = worker.get_objects(object_refs, timeout=timeout)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 863, in get_objects
    raise value
ray.exceptions.ActorUnavailableError: The actor 58ea9b089ddc7ff85b88347a01000000 is unavailable: The actor is temporarily unavailable: GrpcUnavailable: RPC Error message: Socket closed; RPC Error details: . The task may or maynot have been executed on the actor.
2024-07-16 18:14:56,007	ERROR tune_controller.py:1331 -- Trial task failed for trial train_fnn_e209a_00047
Traceback (most recent call last):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/air/execution/_internal/event_manager.py", line 110, in resolve_future
    result = ray.get(future)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/auto_init_hook.py", line 21, in auto_init_wrapper
    return fn(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 2613, in get
    values, debugger_breakpoint = worker.get_objects(object_refs, timeout=timeout)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 863, in get_objects
    raise value
ray.exceptions.ActorDiedError: The actor died unexpectedly before finishing this task.
	class_name: ImplicitFunc
	actor_id: 0c66366a7eddddf431837fc301000000
	pid: 394746
	namespace: 3fa97b35-a2a0-4556-8ac0-8593d2bdf61e
	ip: 10.112.2.34
The actor is dead because its worker process has died. Worker exit type: SYSTEM_ERROR Worker exit detail: Worker unexpectedly exits with a connection error code 2. End of file. There are some potential root causes. (1) The process is killed by SIGKILL by OOM killer due to high memory usage. (2) ray stop --force is called. (3) The worker is crashed unexpectedly due to SIGSEGV or other unexpected errors.
2024-07-16 19:01:16,933	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_18-14-15' in 0.1766s.

 Configuration for experiment     train_fnn_2024-07-15_20-01-13   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_20-01-13
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-15_20-01-08_514143_2708215/artifacts/2024-07-15_20-01-13/train_fnn_2024-07-15_20-01-13/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-15_20-37-27   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_20-37-27
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-15_20-37-21_979083_2708215/artifacts/2024-07-15_20-37-27/train_fnn_2024-07-15_20-37-27/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-15_21-40-09   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_21-40-09
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-15_21-40-01_622983_2708215/artifacts/2024-07-15_21-40-09/train_fnn_2024-07-15_21-40-09/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-15_23-37-37   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-15_23-37-37
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-15_23-37-31_779687_2708215/artifacts/2024-07-15_23-37-37/train_fnn_2024-07-15_23-37-37/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_01-54-42   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_01-54-42
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_01-54-36_043587_2708215/artifacts/2024-07-16_01-54-42/train_fnn_2024-07-16_01-54-42/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_04-22-35   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_04-22-35
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_04-22-27_232925_2708215/artifacts/2024-07-16_04-22-35/train_fnn_2024-07-16_04-22-35/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_07-20-21   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_07-20-21
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_07-20-14_643660_2708215/artifacts/2024-07-16_07-20-21/train_fnn_2024-07-16_07-20-21/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_10-20-06   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_10-20-06
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_10-19-59_482097_2708215/artifacts/2024-07-16_10-20-06/train_fnn_2024-07-16_10-20-06/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_14-00-39   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_14-00-39
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_14-00-31_465738_2708215/artifacts/2024-07-16_14-00-39/train_fnn_2024-07-16_14-00-39/driver_artifacts`


 Configuration for experiment     train_fnn_2024-07-16_18-14-15   

 Search algorithm                 BasicVariantGenerator           
 Scheduler                        AsyncHyperBandScheduler         
 Number of trials                 50                              


View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-16_18-14-15
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-16_18-14-07_028016_2708215/artifacts/2024-07-16_18-14-15/train_fnn_2024-07-16_18-14-15/driver_artifacts`
[33m(raylet)[0m A worker died or was killed while executing a task by an unexpected system error. To troubleshoot the problem, check the logs for the dead worker. RayTask ID: ffffffffffffffff58ea9b089ddc7ff85b88347a01000000 Worker ID: 6e80764e33ac5e273f997a86b2f3896a98b6f57249da21906d4d2652 Node ID: 4ed5266d783c9e34535f1b4127f580d30c15591cd6c90b4de240dedc Worker IP address: 10.112.2.34 Worker port: 40725 Worker PID: 394811 Worker exit type: SYSTEM_ERROR Worker exit detail: Worker unexpectedly exits with a connection error code 2. End of file. There are some potential root causes. (1) The process is killed by SIGKILL by OOM killer due to high memory usage. (2) ray stop --force is called. (3) The worker is crashed unexpectedly due to SIGSEGV or other unexpected errors.

Trial train_fnn_e209a_00045 errored after 0 iterations at 2024-07-16 18:14:54. Total running time: 38s
Error file: /tmp/ray/session_2024-07-16_18-14-07_028016_2708215/artifacts/2024-07-16_18-14-15/train_fnn_2024-07-16_18-14-15/driver_artifacts/train_fnn_e209a_00045_45_dropout_rate=0.4200,embedding_dim=5,hidden_dim=25,lr=0.0007,num_layers=2,weight_decay=0.0002_2024-07-16_18-14-15/error.txt

Trial train_fnn_e209a_00049 errored after 0 iterations at 2024-07-16 18:14:54. Total running time: 38s
Error file: /tmp/ray/session_2024-07-16_18-14-07_028016_2708215/artifacts/2024-07-16_18-14-15/train_fnn_2024-07-16_18-14-15/driver_artifacts/train_fnn_e209a_00049_49_dropout_rate=0.0100,embedding_dim=20,hidden_dim=35,lr=0.0010,num_layers=5,weight_decay=0.0003_2024-07-16_18-14-15/error.txt

Trial train_fnn_e209a_00002 errored after 0 iterations at 2024-07-16 18:14:54. Total running time: 39s
Error file: /tmp/ray/session_2024-07-16_18-14-07_028016_2708215/artifacts/2024-07-16_18-14-15/train_fnn_2024-07-16_18-14-15/driver_artifacts/train_fnn_e209a_00002_2_dropout_rate=0.3800,embedding_dim=30,hidden_dim=15,lr=0.0001,num_layers=4,weight_decay=0.0000_2024-07-16_18-14-15/error.txt

Trial train_fnn_e209a_00027 errored after 0 iterations at 2024-07-16 18:14:54. Total running time: 39s
Error file: /tmp/ray/session_2024-07-16_18-14-07_028016_2708215/artifacts/2024-07-16_18-14-15/train_fnn_2024-07-16_18-14-15/driver_artifacts/train_fnn_e209a_00027_27_dropout_rate=0.1900,embedding_dim=5,hidden_dim=45,lr=0.0500,num_layers=1,weight_decay=0.0000_2024-07-16_18-14-15/error.txt

Trial train_fnn_e209a_00046 errored after 0 iterations at 2024-07-16 18:14:54. Total running time: 39s
Error file: /tmp/ray/session_2024-07-16_18-14-07_028016_2708215/artifacts/2024-07-16_18-14-15/train_fnn_2024-07-16_18-14-15/driver_artifacts/train_fnn_e209a_00046_46_dropout_rate=0.4200,embedding_dim=15,hidden_dim=175,lr=0.0001,num_layers=2,weight_decay=0.0000_2024-07-16_18-14-15/error.txt

Trial train_fnn_e209a_00007 errored after 0 iterations at 2024-07-16 18:14:54. Total running time: 39s
Error file: /tmp/ray/session_2024-07-16_18-14-07_028016_2708215/artifacts/2024-07-16_18-14-15/train_fnn_2024-07-16_18-14-15/driver_artifacts/train_fnn_e209a_00007_7_dropout_rate=0.4700,embedding_dim=20,hidden_dim=15,lr=0.0070,num_layers=4,weight_decay=0.0000_2024-07-16_18-14-15/error.txt

Trial train_fnn_e209a_00048 errored after 0 iterations at 2024-07-16 18:14:54. Total running time: 39s
Error file: /tmp/ray/session_2024-07-16_18-14-07_028016_2708215/artifacts/2024-07-16_18-14-15/train_fnn_2024-07-16_18-14-15/driver_artifacts/train_fnn_e209a_00048_48_dropout_rate=0.2400,embedding_dim=5,hidden_dim=25,lr=0.0100,num_layers=2,weight_decay=0.0000_2024-07-16_18-14-15/error.txt

Trial train_fnn_e209a_00047 errored after 0 iterations at 2024-07-16 18:14:56. Total running time: 40s
Error file: /tmp/ray/session_2024-07-16_18-14-07_028016_2708215/artifacts/2024-07-16_18-14-15/train_fnn_2024-07-16_18-14-15/driver_artifacts/train_fnn_e209a_00047_47_dropout_rate=0.4800,embedding_dim=30,hidden_dim=85,lr=0.0009,num_layers=3,weight_decay=0.0000_2024-07-16_18-14-15/error.txt

Traceback (most recent call last):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py", line 368, in <module>
    
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py", line 315, in main
    train_loader=train_loader,
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/model_data_nn.py", line 299, in get_best_trial
    result = tune.run(
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/tune.py", line 1035, in run
    raise TuneError("Trials did not complete", incomplete_trials)
ray.tune.error.TuneError: ('Trials did not complete', [train_fnn_e209a_00002, train_fnn_e209a_00007, train_fnn_e209a_00027, train_fnn_e209a_00045, train_fnn_e209a_00046, train_fnn_e209a_00047, train_fnn_e209a_00048, train_fnn_e209a_00049])
[33m(raylet)[0m A worker died or was killed while executing a task by an unexpected system error. To troubleshoot the problem, check the logs for the dead worker. RayTask ID: ffffffffffffffff0c66366a7eddddf431837fc301000000 Worker ID: 440d67e4425ca79cf5f943daa242b9f87b4dd95345e2a58c611ec124 Node ID: 4ed5266d783c9e34535f1b4127f580d30c15591cd6c90b4de240dedc Worker IP address: 10.112.2.34 Worker port: 36147 Worker PID: 394746 Worker exit type: SYSTEM_ERROR Worker exit detail: Worker unexpectedly exits with a connection error code 2. End of file. There are some potential root causes. (1) The process is killed by SIGKILL by OOM killer due to high memory usage. (2) ray stop --force is called. (3) The worker is crashed unexpectedly due to SIGSEGV or other unexpected errors.[32m [repeated 7x across cluster] (Ray deduplicates logs by default. Set RAY_DEDUP_LOGS=0 to disable log deduplication, or see https://docs.ray.io/en/master/ray-observability/user-guides/configure-logging.html#log-deduplication for more options.)[0m
INFO:postprocess_predictions.py:Post processing prediction files
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_1993.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_1994.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2003.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2004.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2015.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2012.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_1985.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2020.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2005.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2002.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_1995.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_1992.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2013.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2014.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_1989.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_1987.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2019.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2017.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2010.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2001.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2006.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2008.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_1991.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_1996.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_1998.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2011.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2016.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2018.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_1986.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_1988.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_1999.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_1997.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_1990.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2009.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2007.csv
INFO:postprocess_predictions.py:Postprocessing data from path: kevin/output/prediction/monthly_new_vars/monthly_prediction_2000.csv
INFO:postprocess_predictions.py:Sort the result by date and rank both ascendingly
INFO:postprocess_predictions.py:Saved the result file: result.csv
to the directory: kevin/output/prediction/monthly_new_vars
slurmstepd-yen11: error: Detected 704 oom-kill event(s) in StepId=414231.batch. Some of your processes may have been killed by the cgroup out-of-memory handler.
