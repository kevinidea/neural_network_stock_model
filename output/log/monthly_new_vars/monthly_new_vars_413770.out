Current working directory
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml
source kevin/venv/bin/activate
which python3
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/bin/python3
2024-07-10 13:03:23,358	PANIC scripts.py:900 -- `--address` is a required flag unless starting a head node with `--head`.
Error: `{}` is a required flag unless starting a head node with `{}`.
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
INFO:preprocess_data_nn.py:

Loading and preprocessing data...

DEBUG:preprocess_data_nn.py:          date   permno
626    1980-01  10006.0
5399   1980-01  10057.0
11398  1980-01  10137.0
12828  1980-01  10145.0
13984  1980-01  10153.0
DEBUG:preprocess_data_nn.py:--------------------------------------------------
INFO:main.py:preprocessed df: (2005900, 161)
INFO:preprocess_data_nn.py:

Applying secondary data preprocessing..

INFO:main.py:secondary preprocessed df: (1942951, 161)
INFO:main.py:df sample:     permno       pdate        ym  gvkey  sic2    absacc       acc    aeavol  ...      roaa      roea   roavola       ret        mve_m      retq  pyear     date
0  10006.0  1980-01-01  198001.0   1010    37  0.083420  0.083420  1.001090  ...  0.048684  0.141715  0.004512  0.211679   303420.750 -0.055806   1980  1980-01
1  10057.0  1980-01-01  198001.0   1098    36  0.088951  0.088951 -0.613146  ...  0.092434  0.174252  0.035698  0.282297   111423.125 -0.069431   1980  1980-01
2  10137.0  1980-01-01  198001.0   1279    49  0.041008  0.041008 -0.491307  ...  0.034895  0.097554  0.006254 -0.032258   617349.500 -0.108065   1980  1980-01
3  10145.0  1980-01-01  198001.0   1300    99  0.050486  0.050486 -0.256932  ...  0.049028  0.122729  0.004320  0.150127  1415193.000 -0.085950   1980  1980-01
4  10153.0  1980-01-01  198001.0   1308    13       NaN       NaN  1.631801  ...  0.049860  0.109950  0.009149 -0.122744   429488.500 -0.285199   1980  1980-01

[5 rows x 161 columns]
INFO:main.py:Train year start: 1980
INFO:main.py:Prediction data years: [1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020]
INFO:main.py:

Loop through all the prediction years and build optimized model for each year

INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:transform_data_nn.py:Train_data: (237147, 161)

INFO:transform_data_nn.py:Test data years: [1987]
INFO:transform_data_nn.py:Test_data: (44352, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:transform_data_nn.py:Retrain_data: (281499, 161)

INFO:transform_data_nn.py:Prediction data years: [1988]
INFO:transform_data_nn.py:Prediction_data: (46885, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([237147, 152])
            y_train_tf: torch.Size([237147])

            x_test_tf: torch.Size([44352, 152])
            y_test_tf: torch.Size([44352])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([281499, 152])
            y_retrain_tf: torch.Size([281499])

            x_prediction_tf: torch.Size([46885, 152])
            y_prediction_tf: torch.Size([46885])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-0.1378,  0.2011,  0.1735, -1.2736, -0.1414, -0.6129, -0.1248, -0.3115,
         0.2968, -0.1604, -0.7119, -0.1284, -0.4702, -0.0566,  0.0624,  0.5452,
        -0.1485,  0.1085,  0.0000,  0.4475, -0.3672, -0.2125,  0.0325,  0.0146,
        -0.0833, -0.2362, -0.5806,  0.0000,  0.3954,  0.8854,  0.4877, -0.1312,
         0.4150,  0.0000, -0.4067, -0.2013,  0.0756,  0.4689,  0.0805, -1.1706,
        -0.2576,  0.0846,  0.1459, -0.0784, -0.1491, -0.6672, -0.0211, -0.1119,
        -0.5597, -0.2513, -0.6202,  0.6533, -0.1762, -0.0731,  0.0316,  0.4455,
        -0.7773, -0.0479, -0.2733,  0.0933,  0.1035, -0.3434,  0.1623,  0.2965,
         0.2079, -0.1035,  0.0400, -0.0618,  0.7032, -0.4171,  0.0000,  0.0000,
         0.0282, -0.8190, -0.0195,  0.5824,  0.0410, -0.3436, -0.1796, -0.0104,
         0.0000,  0.3771,  0.0150, -0.2020, -0.5611, -0.0783, -0.0633, -0.3700,
        -0.1631,  0.1329, -0.5081, -1.2896,  0.2434,  1.0516,  1.6154,  1.4313,
         0.4921,  1.0178, -2.2250, -0.7145, -1.0838,  0.1765,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0681,  0.1245,  0.0000, -1.6484, -0.1374, -1.7709,
         0.1165,  0.0567,  0.0000,  0.0000,  0.0141, -0.1652, -0.0921,  0.0665,
         0.2107, -0.4339, -0.4025,  0.1455,  0.2247, -0.3825,  0.0000,  0.0000,
         0.0000,  1.0000,  1.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([3767]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([ 1.8020e+00,  1.9152e+00,  3.4486e-01, -1.8913e-01,  1.3689e+00,
         2.6924e+00, -8.9300e-01, -7.8639e-01, -4.9107e-01, -6.5433e-01,
        -5.3155e-01, -1.2724e-01,  2.2762e-01, -3.8230e-01,  1.8586e+00,
         2.3049e+00, -2.2689e-01,  3.8296e+00,  0.0000e+00,  3.2700e+00,
         5.0575e-03, -2.1251e-01,  2.0621e-02, -2.5567e-03,  6.3772e-02,
         1.0327e+00,  2.0287e+00,  0.0000e+00, -1.3956e+00, -8.2966e-01,
        -4.6975e-01, -1.4919e-01,  4.2877e-02,  0.0000e+00,  1.2218e+00,
        -2.0587e-01,  2.0151e-01,  5.4386e-01,  4.6245e+00, -5.7104e-01,
         3.3704e-01, -5.3257e-01,  2.2907e+00, -3.5756e-01,  2.8893e+00,
        -1.0363e+00, -2.0763e-01, -1.0985e+00, -6.9351e-01,  1.0851e-01,
        -6.2015e-01, -1.1060e+00, -1.3256e-01, -7.3100e-02, -7.3521e-01,
         4.8096e-02,  1.0329e+00, -3.2643e-01,  6.0915e-01,  3.3914e+00,
         1.9910e-01,  6.6620e-01,  8.5977e-01,  5.6841e-01, -1.9664e+00,
         3.9913e-01,  1.1799e+00, -6.0768e-01, -1.2768e+00, -3.7900e-01,
         0.0000e+00,  0.0000e+00,  2.8222e-02, -6.5080e-01, -1.0827e-01,
         1.6211e+00, -7.8200e-02, -3.9600e-01,  2.2145e-01, -9.8606e-01,
         0.0000e+00,  2.3511e+00, -2.7285e-01,  1.9970e+00, -6.8303e-02,
        -4.8069e-02, -4.9363e-02, -3.5668e-01, -2.2977e-01, -1.3200e-01,
        -6.0629e-01,  3.0339e+00,  2.4336e-01, -1.5991e+00, -1.6971e+00,
        -1.5188e+00, -6.1921e-01, -1.3641e+00,  1.8554e-01, -2.9779e-01,
        -3.4293e-01,  1.8998e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.6694e-02,  1.2451e-01,  0.0000e+00,  7.3645e-01,
        -1.3529e+00,  3.0857e-01, -2.1738e-02,  5.6721e-02,  0.0000e+00,
         0.0000e+00,  2.7793e+00,  5.4316e-01, -9.2059e-02,  3.3375e-01,
         1.7586e+00,  4.1795e-01, -6.4637e-02,  4.0987e-03,  4.2907e-02,
         3.3521e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([2347]), tensor(0.0417))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.6485e-01,  1.8230e-01,  1.7097e-01, -1.2895e+00, -1.4861e-01,
        -6.3361e-01, -1.3953e-01, -3.2412e-01,  3.5052e-01, -1.6415e-01,
        -7.1298e-01, -8.7418e-02, -4.8984e-01, -2.8638e-02,  5.3805e-02,
         5.3585e-01, -1.5057e-01,  1.4105e-01,  0.0000e+00,  4.4826e-01,
        -3.6039e-01, -2.0729e-02,  2.5868e-02,  2.6469e-03, -6.5325e-02,
        -2.4458e-01, -5.7430e-01,  0.0000e+00,  3.6729e-01,  9.5292e-01,
         4.8242e-01, -1.2829e-01,  4.3593e-01,  0.0000e+00, -3.9010e-01,
        -1.9800e-01,  7.8118e-02,  4.8214e-01,  6.1557e-02, -1.1636e+00,
        -2.6444e-01,  1.3808e-01,  1.6335e-01, -6.4053e-02, -1.6169e-01,
        -6.7458e-01,  5.4317e-03, -7.7477e-02, -5.5695e-01, -2.3816e-01,
        -6.2338e-01,  6.4888e-01, -1.6650e-01, -1.9579e-03,  2.7732e-02,
         4.4700e-01, -7.7374e-01, -1.7885e-02, -2.7024e-01,  5.4831e-02,
         1.0554e-01, -3.3980e-01,  1.6083e-01,  2.9301e-01,  1.9625e-01,
        -1.0893e-01,  1.9625e-02, -6.5275e-02,  7.2753e-01, -4.1686e-01,
         0.0000e+00,  0.0000e+00, -1.7687e-02, -8.1674e-01,  1.3622e-02,
         6.0146e-01,  4.2794e-02, -3.4357e-01, -1.8006e-01, -1.1661e-02,
         0.0000e+00,  3.4367e-01,  5.3540e-02, -2.1577e-01, -5.6823e-01,
        -8.4531e-02, -6.9139e-02, -3.6387e-01, -1.5407e-01,  1.0011e-01,
        -5.2393e-01, -1.2947e+00,  1.1243e-01,  1.0997e+00,  1.5975e+00,
         1.5071e+00,  5.2009e-01,  1.1836e+00, -2.4439e+00, -5.6879e-01,
        -2.7414e-01,  1.5649e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.1913e-02, -4.5387e-02,  0.0000e+00, -1.7755e+00,
         4.2778e-02, -1.9666e+00,  1.2646e-01,  9.4528e-02,  0.0000e+00,
         0.0000e+00,  2.1740e-02, -1.7337e-01, -8.7121e-02,  3.3313e-02,
         1.9914e-01, -4.1977e-01, -3.9246e-01,  1.7793e-01,  2.3912e-01,
        -3.9531e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([4206]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-1.1594e-02, -5.2073e-03, -6.3248e-01, -8.0822e-01, -7.0266e-01,
        -1.4151e-01, -1.8634e+00, -1.0292e+00, -8.8950e-03,  9.8507e-03,
        -3.5172e-01, -2.3780e-01,  5.1335e-02, -3.8287e-03,  3.3370e-02,
        -1.4351e+00, -2.2808e-01, -1.2205e-01,  0.0000e+00, -2.4636e-01,
         3.8865e-01, -2.0729e-02,  8.3911e-03,  3.7377e-02,  7.5325e-03,
        -6.3693e-01, -7.4307e-01,  0.0000e+00, -7.7996e-01,  3.6407e-02,
        -9.5491e-01, -3.4028e-01,  4.7802e-02,  0.0000e+00, -2.4158e+00,
         7.5641e-03, -6.2660e-01, -6.6273e-01, -2.9067e-01, -7.8528e-01,
         6.4925e-01, -9.4471e-01, -5.3122e-01, -1.8937e-01,  1.4665e-02,
        -1.4826e-01, -5.0533e-01, -3.3594e-01, -2.8811e-01, -7.2144e-03,
         1.2393e-01, -1.4796e+00, -4.8504e-01, -1.9579e-03, -7.4145e-01,
        -1.6221e+00, -1.0965e+00, -3.7581e-01, -5.2418e-02,  1.4472e-02,
        -2.8946e+00, -4.9031e-02, -8.8467e-02, -5.0532e+00, -9.7408e-03,
        -3.8957e-01, -1.0467e-02,  1.8309e+00, -5.8154e-01, -3.6450e-01,
         0.0000e+00,  0.0000e+00, -1.7687e-02,  8.9230e-02, -1.9116e-01,
        -2.3047e-01, -1.4984e-01,  3.2335e+00, -2.0202e-01, -1.1661e-02,
         0.0000e+00, -1.0029e+00, -2.6086e-02,  2.4173e+00,  3.8172e+00,
        -7.2883e-02, -6.3519e-02, -2.3079e-01,  6.0293e-01, -2.8818e-01,
         7.5226e-01,  5.6420e-01,  1.1243e-01, -7.3275e-01, -5.6379e-01,
        -1.0268e+00,  6.7123e-01, -1.0431e+00,  7.4876e-01, -9.3762e-01,
         5.1446e-01, -7.1605e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.0050e-02, -4.5387e-02,  0.0000e+00, -1.2264e+00,
        -1.4060e+00,  7.4562e-02, -1.6812e-02,  5.0167e+00,  0.0000e+00,
         0.0000e+00, -1.4247e+00, -2.3928e-01, -8.7121e-02,  1.6202e+00,
         2.5870e-03,  7.5664e-01, -3.9878e-01, -8.1722e-02, -1.6801e-02,
         1.0158e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1170]), tensor(0.0638))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986]
INFO:main.py:Testing data year: 1987
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 32
            max_num_epochs: 40
            num_cpus: 32
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 5109
            device: cpu
            
2024-07-10 13:46:37,118	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-10 13:46:37,194	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-10 13:46:37,232	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_a5ff05d4be04538f.zip' (1.26MiB) to Ray cluster...
2024-07-10 13:46:37,240	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_a5ff05d4be04538f.zip'.
2024-07-10 13:46:39,327	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-10 13:53:37,328	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-10_13-46-39' in 0.1048s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 185, 'num_layers': 4, 'num_embeddings': 5109, 'embedding_dim': 10, 'dropout_rate': 0.42, 'lr': 0.0026568139241144955, 'weight_decay': 0.00018484491720988626, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.016990018151539752
INFO:model_data_nn.py:Best trial testing loss: 0.03195712074969263
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-10_13-46-33_964964_2875784/artifacts/2024-07-10_13-46-39/train_fnn_2024-07-10_13-46-39/driver_artifacts/train_fnn_8183a_00018_18_dropout_rate=0.4200,embedding_dim=10,hidden_dim=185,lr=0.0027,num_layers=4,weight_decay=0.0002_2024-07-10_13-46-39
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 185, 'num_layers': 4, 'num_embeddings': 5697, 'embedding_dim': 10, 'dropout_rate': 0.42, 'lr': 0.0026568139241144955, 'weight_decay': 0.00018484491720988626, 'num_epochs': 40, 'num_gpus': 0}

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/cuda/__init__.py:619: UserWarning: Can't initialize NVML
  warnings.warn("Can't initialize NVML")
INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 6.835766377012161, 'avg_test_loss': 0.02827564730187473}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.0237869953753596, 'avg_test_loss': 0.02181218558942656}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.02029399553398517, 'avg_test_loss': 0.02174666813959408}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.021068782486360182, 'avg_test_loss': 0.022345802159575018}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.025431631841612134, 'avg_test_loss': 0.026771817432271073}
INFO:model_data_nn.py:Early stopping at epoch 5
INFO:main.py:Making prediction for data in year: 1988
INFO:main.py:Prediction data shape: (46885,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:349: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1988: 0.1637221106243232
INFO:main.py:Prediction Stats:                 ret          pred
count  46885.000000  46885.000000
mean       0.017541      0.078240
std        0.147384      0.039781
min       -0.847619     -0.731908
25%       -0.052632      0.048867
50%        0.000000      0.081848
75%        0.070922      0.110013
max        5.562500      0.180024
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:transform_data_nn.py:Train_data: (281499, 161)

INFO:transform_data_nn.py:Test data years: [1988]
INFO:transform_data_nn.py:Test_data: (46885, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:transform_data_nn.py:Retrain_data: (328384, 161)

INFO:transform_data_nn.py:Prediction data years: [1989]
INFO:transform_data_nn.py:Prediction_data: (47501, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([281499, 152])
            y_train_tf: torch.Size([281499])

            x_test_tf: torch.Size([46885, 152])
            y_test_tf: torch.Size([46885])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([328384, 152])
            y_retrain_tf: torch.Size([328384])

            x_prediction_tf: torch.Size([47501, 152])
            y_prediction_tf: torch.Size([47501])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.6485e-01,  1.8230e-01,  1.7097e-01, -1.2895e+00, -1.4861e-01,
        -6.3361e-01, -1.3953e-01, -3.2412e-01,  3.5052e-01, -1.6415e-01,
        -7.1298e-01, -8.7418e-02, -4.8984e-01, -2.8638e-02,  5.3805e-02,
         5.3585e-01, -1.5057e-01,  1.4105e-01,  0.0000e+00,  4.4826e-01,
        -3.6039e-01, -2.0729e-02,  2.5868e-02,  2.6469e-03, -6.5325e-02,
        -2.4458e-01, -5.7430e-01,  0.0000e+00,  3.6729e-01,  9.5292e-01,
         4.8242e-01, -1.2829e-01,  4.3593e-01,  0.0000e+00, -3.9010e-01,
        -1.9800e-01,  7.8118e-02,  4.8214e-01,  6.1557e-02, -1.1636e+00,
        -2.6444e-01,  1.3808e-01,  1.6335e-01, -6.4053e-02, -1.6169e-01,
        -6.7458e-01,  5.4317e-03, -7.7477e-02, -5.5695e-01, -2.3816e-01,
        -6.2338e-01,  6.4888e-01, -1.6650e-01, -1.9579e-03,  2.7732e-02,
         4.4700e-01, -7.7374e-01, -1.7885e-02, -2.7024e-01,  5.4831e-02,
         1.0554e-01, -3.3980e-01,  1.6083e-01,  2.9301e-01,  1.9625e-01,
        -1.0893e-01,  1.9625e-02, -6.5275e-02,  7.2753e-01, -4.1686e-01,
         0.0000e+00,  0.0000e+00, -1.7687e-02, -8.1674e-01,  1.3622e-02,
         6.0146e-01,  4.2794e-02, -3.4357e-01, -1.8006e-01, -1.1661e-02,
         0.0000e+00,  3.4367e-01,  5.3540e-02, -2.1577e-01, -5.6823e-01,
        -8.4531e-02, -6.9139e-02, -3.6387e-01, -1.5407e-01,  1.0011e-01,
        -5.2393e-01, -1.2947e+00,  1.1243e-01,  1.0997e+00,  1.5975e+00,
         1.5071e+00,  5.2009e-01,  1.1836e+00, -2.4439e+00, -5.6879e-01,
        -2.7414e-01,  1.5649e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.1913e-02, -4.5387e-02,  0.0000e+00, -1.7755e+00,
         4.2778e-02, -1.9666e+00,  1.2646e-01,  9.4528e-02,  0.0000e+00,
         0.0000e+00,  2.1740e-02, -1.7337e-01, -8.7121e-02,  3.3313e-02,
         1.9914e-01, -4.1977e-01, -3.9246e-01,  1.7793e-01,  2.3912e-01,
        -3.9531e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([4206]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-1.1594e-02, -5.2073e-03, -6.3248e-01, -8.0822e-01, -7.0266e-01,
        -1.4151e-01, -1.8634e+00, -1.0292e+00, -8.8950e-03,  9.8507e-03,
        -3.5172e-01, -2.3780e-01,  5.1335e-02, -3.8287e-03,  3.3370e-02,
        -1.4351e+00, -2.2808e-01, -1.2205e-01,  0.0000e+00, -2.4636e-01,
         3.8865e-01, -2.0729e-02,  8.3911e-03,  3.7377e-02,  7.5325e-03,
        -6.3693e-01, -7.4307e-01,  0.0000e+00, -7.7996e-01,  3.6407e-02,
        -9.5491e-01, -3.4028e-01,  4.7802e-02,  0.0000e+00, -2.4158e+00,
         7.5641e-03, -6.2660e-01, -6.6273e-01, -2.9067e-01, -7.8528e-01,
         6.4925e-01, -9.4471e-01, -5.3122e-01, -1.8937e-01,  1.4665e-02,
        -1.4826e-01, -5.0533e-01, -3.3594e-01, -2.8811e-01, -7.2144e-03,
         1.2393e-01, -1.4796e+00, -4.8504e-01, -1.9579e-03, -7.4145e-01,
        -1.6221e+00, -1.0965e+00, -3.7581e-01, -5.2418e-02,  1.4472e-02,
        -2.8946e+00, -4.9031e-02, -8.8467e-02, -5.0532e+00, -9.7408e-03,
        -3.8957e-01, -1.0467e-02,  1.8309e+00, -5.8154e-01, -3.6450e-01,
         0.0000e+00,  0.0000e+00, -1.7687e-02,  8.9230e-02, -1.9116e-01,
        -2.3047e-01, -1.4984e-01,  3.2335e+00, -2.0202e-01, -1.1661e-02,
         0.0000e+00, -1.0029e+00, -2.6086e-02,  2.4173e+00,  3.8172e+00,
        -7.2883e-02, -6.3519e-02, -2.3079e-01,  6.0293e-01, -2.8818e-01,
         7.5226e-01,  5.6420e-01,  1.1243e-01, -7.3275e-01, -5.6379e-01,
        -1.0268e+00,  6.7123e-01, -1.0431e+00,  7.4876e-01, -9.3762e-01,
         5.1446e-01, -7.1605e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.0050e-02, -4.5387e-02,  0.0000e+00, -1.2264e+00,
        -1.4060e+00,  7.4562e-02, -1.6812e-02,  5.0167e+00,  0.0000e+00,
         0.0000e+00, -1.4247e+00, -2.3928e-01, -8.7121e-02,  1.6202e+00,
         2.5870e-03,  7.5664e-01, -3.9878e-01, -8.1722e-02, -1.6801e-02,
         1.0158e-01,  1.0000e+00,  0.0000e+00,  1.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1170]), tensor(0.0638))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.9844e-01,  1.5880e-01,  1.6742e-01, -1.2964e+00, -1.4980e-01,
        -6.3783e-01, -1.5070e-01, -3.3081e-01,  3.6132e-01, -1.5750e-01,
        -7.1271e-01, -3.7380e-02, -4.9664e-01,  9.8005e-03,  3.3467e-02,
         5.2172e-01, -1.3992e-01,  1.7420e-01,  0.0000e+00,  4.3468e-01,
        -3.6828e-01,  7.5725e-02,  2.5460e-02,  9.3107e-03, -6.7596e-02,
        -2.5247e-01, -5.6868e-01,  0.0000e+00,  3.8144e-01,  1.0111e+00,
         4.7515e-01, -1.2195e-01,  4.4010e-01,  0.0000e+00, -3.8085e-01,
        -1.9431e-01,  6.8593e-02,  5.1761e-01,  3.3254e-02, -1.1662e+00,
        -2.7735e-01,  2.7510e-01,  1.9260e-01, -6.6024e-02, -1.7060e-01,
        -6.7784e-01,  8.4519e-02, -8.4395e-02, -5.4257e-01, -1.9077e-01,
        -6.1714e-01,  6.5989e-01, -1.6348e-01,  1.0159e-03,  2.1732e-02,
         4.4457e-01, -7.6868e-01, -1.5251e-04, -2.6248e-01,  2.1522e-02,
         1.1277e-01, -3.2948e-01,  1.5361e-01,  2.8391e-01,  1.4703e-01,
        -1.1827e-01,  2.8385e-03, -7.3083e-02,  7.4370e-01, -4.1918e-01,
         0.0000e+00,  0.0000e+00, -2.3610e-01, -8.1725e-01,  3.7470e-02,
         5.8416e-01,  4.2455e-02, -3.4501e-01, -1.8188e-01, -2.3916e-03,
         0.0000e+00,  2.8639e-01,  6.1073e-02, -2.5530e-01, -5.5517e-01,
        -9.0869e-02, -7.4242e-02, -3.6215e-01, -1.4420e-01,  1.0281e-01,
        -5.1478e-01, -1.2853e+00,  4.8167e-02,  1.2549e+00,  1.7486e+00,
         1.6574e+00,  5.6220e-01,  1.3352e+00, -2.6341e+00, -4.1360e-01,
        -2.9873e-01,  1.2191e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.2007e-02,  2.3354e-01,  0.0000e+00, -1.4879e+00,
         2.6651e-01, -2.1535e+00,  1.3354e-01,  2.7724e-02,  0.0000e+00,
         0.0000e+00,  2.5039e-02, -1.7800e-01,  7.3311e-03,  7.8641e-03,
         1.7098e-01, -4.2237e-01, -3.8414e-01,  1.9750e-01,  2.4554e-01,
        -3.9752e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([4624]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-1.1408e-02,  2.9146e-03, -6.1383e-01, -4.2858e-01, -2.9630e-01,
        -6.0289e-02, -1.9494e+00, -1.0588e+00, -3.6764e-02,  1.0514e-01,
        -2.3164e-02,  1.5815e-02, -4.1062e-02, -1.5777e-02,  4.1894e-02,
         3.7534e-01, -2.2006e-01, -4.8981e-01,  0.0000e+00,  2.6484e-03,
        -8.1112e-02,  7.5725e-02,  4.7021e-02,  9.6214e-01, -9.3196e-03,
        -5.7378e-03, -7.2997e-01,  0.0000e+00, -1.4391e+00,  4.6592e-02,
         4.3140e-01, -1.7324e-01,  2.7589e-01,  0.0000e+00,  4.8498e-04,
        -6.5325e-01,  7.3700e-03, -6.8489e-01, -8.4842e-01, -7.9342e-01,
         8.1526e-01,  9.7328e-02,  1.1858e-02,  2.3842e-02, -5.9593e-03,
         3.5118e-01,  8.3150e-02, -2.4606e-01, -4.1683e-01,  5.9663e-02,
         8.9991e-01, -1.3893e+00, -5.1699e-01, -2.5068e+00, -7.4364e-01,
         1.1063e-02, -1.0926e+00,  6.9774e-01,  6.0065e-03, -3.9788e-01,
        -6.2875e-03,  6.3306e-03,  1.2690e-02,  1.5952e-02, -2.4946e-02,
         4.0374e-03, -5.0861e-03,  1.7707e+00,  1.3950e+00, -1.1070e-02,
         0.0000e+00,  0.0000e+00, -2.3610e-01,  6.2752e-01,  1.6399e-02,
        -8.9769e-02,  3.0359e-04, -2.2936e-04,  6.4728e-04, -2.3916e-03,
         0.0000e+00, -3.2955e-01, -5.9469e-02, -4.4773e-01, -5.7442e-01,
        -7.8031e-02, -6.8496e-02,  2.5780e-02, -2.3675e-03, -9.3063e-02,
        -6.5661e-01,  6.1256e-01,  4.8167e-02, -6.9923e-01,  9.4130e-02,
        -1.0595e+00, -1.2968e+00, -1.1704e-01, -7.1630e-01, -1.0437e+00,
        -2.7773e-01, -9.0227e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0181e-02,  2.3354e-01,  0.0000e+00, -1.2998e+00,
        -1.2019e+00,  4.1334e-01,  6.2665e-02,  2.7724e-02,  0.0000e+00,
         0.0000e+00,  1.3064e-02, -2.0316e-01,  7.3311e-03, -1.8639e-02,
        -1.0349e-02,  1.1680e-03, -2.4945e-02,  2.4751e-01,  1.9720e-01,
         1.3884e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1128]), tensor(0.0196))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987]
INFO:main.py:Testing data year: 1988
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 32
            max_num_epochs: 40
            num_cpus: 32
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 5697
            device: cpu
            
2024-07-10 14:44:03,245	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-10 14:44:03,288	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-10 14:44:03,323	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_101181d70e78369b.zip' (1.26MiB) to Ray cluster...
2024-07-10 14:44:03,331	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_101181d70e78369b.zip'.
2024-07-10 14:44:05,321	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-10 14:49:34,476	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-10_14-44-05' in 0.1028s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 2, 'num_embeddings': 5697, 'embedding_dim': 10, 'dropout_rate': 0.41, 'lr': 0.005557494308839645, 'weight_decay': 0.0005012762811014234, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.019106797277080742
INFO:model_data_nn.py:Best trial testing loss: 0.021714118873680254
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-10_14-44-00_178744_2875784/artifacts/2024-07-10_14-44-05/train_fnn_2024-07-10_14-44-05/driver_artifacts/train_fnn_878b2_00013_13_dropout_rate=0.4100,embedding_dim=10,hidden_dim=45,lr=0.0056,num_layers=2,weight_decay=0.0005_2024-07-10_14-44-05
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 2, 'num_embeddings': 6283, 'embedding_dim': 10, 'dropout_rate': 0.41, 'lr': 0.005557494308839645, 'weight_decay': 0.0005012762811014234, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 1.7308893913137475, 'avg_test_loss': 0.02421810478973453}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.020333471170837815, 'avg_test_loss': 0.023732227583726246}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.020828626353064275, 'avg_test_loss': 0.023958601593290284}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.021625194078658302, 'avg_test_loss': 0.02666333409386777}
INFO:model_data_nn.py:Early stopping at epoch 4
INFO:main.py:Making prediction for data in year: 1989
INFO:main.py:Prediction data shape: (47501,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:349: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1989: 0.1631076669284319
INFO:main.py:Prediction Stats:                 ret          pred
count  47501.000000  47501.000000
mean       0.011252      0.044476
std        0.153399      0.047045
min       -0.900000     -0.514723
25%       -0.055556      0.024914
50%        0.000000      0.040920
75%        0.066140      0.060433
max        6.384615      0.470066
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:transform_data_nn.py:Train_data: (328384, 161)

INFO:transform_data_nn.py:Test data years: [1989]
INFO:transform_data_nn.py:Test_data: (47501, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:transform_data_nn.py:Retrain_data: (375885, 161)

INFO:transform_data_nn.py:Prediction data years: [1990]
INFO:transform_data_nn.py:Prediction_data: (46774, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([328384, 152])
            y_train_tf: torch.Size([328384])

            x_test_tf: torch.Size([47501, 152])
            y_test_tf: torch.Size([47501])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([375885, 152])
            y_retrain_tf: torch.Size([375885])

            x_prediction_tf: torch.Size([46774, 152])
            y_prediction_tf: torch.Size([46774])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.9844e-01,  1.5880e-01,  1.6742e-01, -1.2964e+00, -1.4980e-01,
        -6.3783e-01, -1.5070e-01, -3.3081e-01,  3.6132e-01, -1.5750e-01,
        -7.1271e-01, -3.7380e-02, -4.9664e-01,  9.8005e-03,  3.3467e-02,
         5.2172e-01, -1.3992e-01,  1.7420e-01,  0.0000e+00,  4.3468e-01,
        -3.6828e-01,  7.5725e-02,  2.5460e-02,  9.3107e-03, -6.7596e-02,
        -2.5247e-01, -5.6868e-01,  0.0000e+00,  3.8144e-01,  1.0111e+00,
         4.7515e-01, -1.2195e-01,  4.4010e-01,  0.0000e+00, -3.8085e-01,
        -1.9431e-01,  6.8593e-02,  5.1761e-01,  3.3254e-02, -1.1662e+00,
        -2.7735e-01,  2.7510e-01,  1.9260e-01, -6.6024e-02, -1.7060e-01,
        -6.7784e-01,  8.4519e-02, -8.4395e-02, -5.4257e-01, -1.9077e-01,
        -6.1714e-01,  6.5989e-01, -1.6348e-01,  1.0159e-03,  2.1732e-02,
         4.4457e-01, -7.6868e-01, -1.5251e-04, -2.6248e-01,  2.1522e-02,
         1.1277e-01, -3.2948e-01,  1.5361e-01,  2.8391e-01,  1.4703e-01,
        -1.1827e-01,  2.8385e-03, -7.3083e-02,  7.4370e-01, -4.1918e-01,
         0.0000e+00,  0.0000e+00, -2.3610e-01, -8.1725e-01,  3.7470e-02,
         5.8416e-01,  4.2455e-02, -3.4501e-01, -1.8188e-01, -2.3916e-03,
         0.0000e+00,  2.8639e-01,  6.1073e-02, -2.5530e-01, -5.5517e-01,
        -9.0869e-02, -7.4242e-02, -3.6215e-01, -1.4420e-01,  1.0281e-01,
        -5.1478e-01, -1.2853e+00,  4.8167e-02,  1.2549e+00,  1.7486e+00,
         1.6574e+00,  5.6220e-01,  1.3352e+00, -2.6341e+00, -4.1360e-01,
        -2.9873e-01,  1.2191e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.2007e-02,  2.3354e-01,  0.0000e+00, -1.4879e+00,
         2.6651e-01, -2.1535e+00,  1.3354e-01,  2.7724e-02,  0.0000e+00,
         0.0000e+00,  2.5039e-02, -1.7800e-01,  7.3311e-03,  7.8641e-03,
         1.7098e-01, -4.2237e-01, -3.8414e-01,  1.9750e-01,  2.4554e-01,
        -3.9752e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([4624]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-1.1408e-02,  2.9146e-03, -6.1383e-01, -4.2858e-01, -2.9630e-01,
        -6.0289e-02, -1.9494e+00, -1.0588e+00, -3.6764e-02,  1.0514e-01,
        -2.3164e-02,  1.5815e-02, -4.1062e-02, -1.5777e-02,  4.1894e-02,
         3.7534e-01, -2.2006e-01, -4.8981e-01,  0.0000e+00,  2.6484e-03,
        -8.1112e-02,  7.5725e-02,  4.7021e-02,  9.6214e-01, -9.3196e-03,
        -5.7378e-03, -7.2997e-01,  0.0000e+00, -1.4391e+00,  4.6592e-02,
         4.3140e-01, -1.7324e-01,  2.7589e-01,  0.0000e+00,  4.8498e-04,
        -6.5325e-01,  7.3700e-03, -6.8489e-01, -8.4842e-01, -7.9342e-01,
         8.1526e-01,  9.7328e-02,  1.1858e-02,  2.3842e-02, -5.9593e-03,
         3.5118e-01,  8.3150e-02, -2.4606e-01, -4.1683e-01,  5.9663e-02,
         8.9991e-01, -1.3893e+00, -5.1699e-01, -2.5068e+00, -7.4364e-01,
         1.1063e-02, -1.0926e+00,  6.9774e-01,  6.0065e-03, -3.9788e-01,
        -6.2875e-03,  6.3306e-03,  1.2690e-02,  1.5952e-02, -2.4946e-02,
         4.0374e-03, -5.0861e-03,  1.7707e+00,  1.3950e+00, -1.1070e-02,
         0.0000e+00,  0.0000e+00, -2.3610e-01,  6.2752e-01,  1.6399e-02,
        -8.9769e-02,  3.0359e-04, -2.2936e-04,  6.4728e-04, -2.3916e-03,
         0.0000e+00, -3.2955e-01, -5.9469e-02, -4.4773e-01, -5.7442e-01,
        -7.8031e-02, -6.8496e-02,  2.5780e-02, -2.3675e-03, -9.3063e-02,
        -6.5661e-01,  6.1256e-01,  4.8167e-02, -6.9923e-01,  9.4130e-02,
        -1.0595e+00, -1.2968e+00, -1.1704e-01, -7.1630e-01, -1.0437e+00,
        -2.7773e-01, -9.0227e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.0181e-02,  2.3354e-01,  0.0000e+00, -1.2998e+00,
        -1.2019e+00,  4.1334e-01,  6.2665e-02,  2.7724e-02,  0.0000e+00,
         0.0000e+00,  1.3064e-02, -2.0316e-01,  7.3311e-03, -1.8639e-02,
        -1.0349e-02,  1.1680e-03, -2.4945e-02,  2.4751e-01,  1.9720e-01,
         1.3884e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1128]), tensor(0.0196))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.8972e-01,  2.6420e-01,  1.5363e-01, -1.3069e+00, -1.4162e-01,
        -6.3605e-01, -1.6024e-01, -3.3749e-01,  3.7729e-01, -1.5824e-01,
        -7.1147e-01, -2.1879e-02, -5.0366e-01, -4.2017e-02,  5.9299e-02,
         5.1382e-01, -1.3424e-01,  1.9280e-01, -1.6829e-02,  4.2506e-01,
        -3.7289e-01,  9.2791e-02,  3.2835e-02,  1.1438e-02, -6.5504e-02,
        -2.5784e-01, -5.7382e-01, -6.8662e-02,  3.8562e-01,  1.0585e+00,
         4.7048e-01, -1.0666e-01,  4.4478e-01,  9.8409e-02, -3.7696e-01,
        -1.9346e-01,  7.3482e-02,  5.4720e-01,  1.7244e-02, -1.1608e+00,
        -2.8468e-01,  2.8830e-01,  2.1189e-01, -6.6772e-02, -1.7456e-01,
        -6.7313e-01,  8.4234e-02, -8.6078e-02, -4.8579e-01, -1.9296e-01,
        -6.3076e-01,  6.6311e-01, -1.5736e-01, -9.1068e-02,  2.1848e-02,
         4.3744e-01, -7.6442e-01,  1.3773e-02, -2.5472e-01, -4.8971e-03,
         1.1931e-01, -3.1866e-01,  1.4727e-01,  2.7139e-01,  1.2354e-01,
        -1.2522e-01,  8.2618e-02, -8.0370e-02,  7.3884e-01, -4.1938e-01,
         0.0000e+00,  0.0000e+00, -1.4421e-01, -8.1085e-01,  5.6494e-02,
         5.8140e-01,  3.9013e-02, -3.4606e-01, -1.8280e-01,  7.9242e-04,
        -2.2414e-02,  2.5705e-01,  6.6266e-02, -2.8663e-01, -5.5589e-01,
        -9.6492e-02, -7.8649e-02, -3.5369e-01, -1.2660e-01,  1.1666e-01,
        -5.1295e-01, -1.2772e+00,  1.3821e-02,  1.3845e+00,  1.8870e+00,
         1.7755e+00,  7.0894e-01,  1.4378e+00, -2.4874e+00, -2.2063e-01,
        -2.9489e-01,  1.0297e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.4179e-02,  2.6416e-01,  0.0000e+00, -1.2481e+00,
         4.0861e-01, -2.3284e+00,  1.3995e-01,  3.2667e-02,  0.0000e+00,
         0.0000e+00,  1.9527e-02, -1.8033e-01,  6.7643e-03, -1.7292e-02,
         6.7000e-02, -4.3188e-01, -3.7835e-01,  2.1099e-01,  2.4922e-01,
        -3.9976e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([4826]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([ 1.8820e-02,  8.3680e-02, -7.9874e-01, -1.1744e-01,  8.1926e-01,
        -7.0996e-01, -1.9966e+00, -1.0775e+00, -3.6405e-01, -1.3855e-01,
        -1.6774e-02,  9.3288e-03, -4.2412e-02, -6.4712e-02,  3.6116e-02,
         5.4810e-01, -1.9479e-01,  7.7155e-01,  4.5852e-01,  8.7119e-03,
         7.4209e-01, -1.8899e-01,  5.2501e-02, -4.2265e-01,  5.2064e-01,
        -6.4386e-03, -7.2439e-01, -6.8662e-02, -8.0948e-01,  4.1203e-02,
         1.8714e-01,  1.3541e-02,  3.3481e-01,  9.8409e-02, -1.4494e-03,
        -1.1368e+00,  1.3192e-02, -7.0466e-01,  6.3335e-01, -7.0855e-01,
        -1.4501e-01,  1.5804e-01,  1.2192e-02,  2.3968e-02, -3.7000e-03,
        -4.4552e-01,  9.5932e-01,  2.0401e-01, -4.1580e-01,  1.2171e+00,
         1.6730e+00, -1.1007e+00, -6.2636e-01, -1.2679e+00, -7.4223e-01,
         8.0022e-03, -1.0893e+00,  1.1615e+00, -7.9993e-04,  6.2808e-02,
        -3.9909e-03, -2.7642e-04,  9.0410e-03,  1.8528e-02, -1.0378e-02,
         3.0594e-05,  5.1983e-02, -2.5582e+00,  8.5946e-02, -1.0104e-02,
         0.0000e+00,  0.0000e+00, -1.4421e-01, -5.5099e-01,  1.1204e-02,
         3.0825e-01,  9.9530e-04, -1.9123e-03,  2.5390e-03,  7.9242e-04,
         1.9376e-01,  6.0692e-01, -1.5442e-01,  2.0061e-02, -4.6656e-01,
        -8.4911e-02, -7.3589e-02,  3.1820e-02,  5.3414e-03,  2.8129e-01,
        -5.4592e-01, -1.2772e+00,  1.3821e-02, -1.1170e+00, -8.8277e-01,
        -1.2188e+00, -5.4814e-01, -2.8496e-01, -9.4263e-01, -1.1195e+00,
        -2.3083e-01,  1.6644e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.6646e-02,  3.1921e-01,  0.0000e+00, -9.3808e-01,
        -9.4247e-01,  2.4640e-01,  1.1855e-01,  3.2667e-02,  0.0000e+00,
         0.0000e+00,  1.1356e-02,  2.3742e-01,  6.7643e-03, -1.8907e-02,
        -5.7504e-02,  4.7245e-04, -2.3224e-02,  3.4302e-01,  3.7060e-01,
        -2.7359e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1093]), tensor(-0.0185))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]
INFO:main.py:Testing data year: 1989
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 32
            max_num_epochs: 40
            num_cpus: 32
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 6283
            device: cpu
            
2024-07-10 15:44:43,506	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-10 15:44:43,541	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-10 15:44:43,577	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_c3ac8b860182a964.zip' (1.27MiB) to Ray cluster...
2024-07-10 15:44:43,584	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_c3ac8b860182a964.zip'.
2024-07-10 15:44:45,681	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-10 15:53:48,147	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-10_15-44-45' in 0.1064s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 6283, 'embedding_dim': 5, 'dropout_rate': 0.19, 'lr': 0.0011018344696523033, 'weight_decay': 0.00011531058266441366, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.018103520430200564
INFO:model_data_nn.py:Best trial testing loss: 0.02343517031160093
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-10_15-44-40_547770_2875784/artifacts/2024-07-10_15-44-45/train_fnn_2024-07-10_15-44-45/driver_artifacts/train_fnn_015e0_00024_24_dropout_rate=0.1900,embedding_dim=5,hidden_dim=45,lr=0.0011,num_layers=1,weight_decay=0.0001_2024-07-10_15-44-45
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 45, 'num_layers': 1, 'num_embeddings': 6562, 'embedding_dim': 5, 'dropout_rate': 0.19, 'lr': 0.0011018344696523033, 'weight_decay': 0.00011531058266441366, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 3.725120125256017, 'avg_test_loss': 0.06791548771895672}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.02734227516353029, 'avg_test_loss': 0.03296524217057098}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.02011774030023992, 'avg_test_loss': 0.033465598139891535}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.02025421062982695, 'avg_test_loss': 0.032376260751135685}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.02055805293086173, 'avg_test_loss': 0.03357376289029753}
INFO:model_data_nn.py:Epoch 6/40, metrics: {'avg_train_loss': 0.020656149041914387, 'avg_test_loss': 0.034131272349893396}
INFO:model_data_nn.py:Early stopping at epoch 6
INFO:main.py:Making prediction for data in year: 1990
INFO:main.py:Prediction data shape: (46774,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:349: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1990: 0.18470479212652058
INFO:main.py:Prediction Stats:                 ret          pred
count  46774.000000  46774.000000
mean      -0.017088      0.032810
std        0.177055      0.020753
min       -0.916667     -0.142480
25%       -0.103448      0.020225
50%       -0.017544      0.029729
75%        0.054461      0.042083
max        3.400000      0.268526
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:transform_data_nn.py:Train_data: (375885, 161)

INFO:transform_data_nn.py:Test data years: [1990]
INFO:transform_data_nn.py:Test_data: (46774, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:transform_data_nn.py:Retrain_data: (422659, 161)

INFO:transform_data_nn.py:Prediction data years: [1991]
INFO:transform_data_nn.py:Prediction_data: (47150, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([375885, 152])
            y_train_tf: torch.Size([375885])

            x_test_tf: torch.Size([46774, 152])
            y_test_tf: torch.Size([46774])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([422659, 152])
            y_retrain_tf: torch.Size([422659])

            x_prediction_tf: torch.Size([47150, 152])
            y_prediction_tf: torch.Size([47150])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.8972e-01,  2.6420e-01,  1.5363e-01, -1.3069e+00, -1.4162e-01,
        -6.3605e-01, -1.6024e-01, -3.3749e-01,  3.7729e-01, -1.5824e-01,
        -7.1147e-01, -2.1879e-02, -5.0366e-01, -4.2017e-02,  5.9299e-02,
         5.1382e-01, -1.3424e-01,  1.9280e-01, -1.6829e-02,  4.2506e-01,
        -3.7289e-01,  9.2791e-02,  3.2835e-02,  1.1438e-02, -6.5504e-02,
        -2.5784e-01, -5.7382e-01, -6.8662e-02,  3.8562e-01,  1.0585e+00,
         4.7048e-01, -1.0666e-01,  4.4478e-01,  9.8409e-02, -3.7696e-01,
        -1.9346e-01,  7.3482e-02,  5.4720e-01,  1.7244e-02, -1.1608e+00,
        -2.8468e-01,  2.8830e-01,  2.1189e-01, -6.6772e-02, -1.7456e-01,
        -6.7313e-01,  8.4234e-02, -8.6078e-02, -4.8579e-01, -1.9296e-01,
        -6.3076e-01,  6.6311e-01, -1.5736e-01, -9.1068e-02,  2.1848e-02,
         4.3744e-01, -7.6442e-01,  1.3773e-02, -2.5472e-01, -4.8971e-03,
         1.1931e-01, -3.1866e-01,  1.4727e-01,  2.7139e-01,  1.2354e-01,
        -1.2522e-01,  8.2618e-02, -8.0370e-02,  7.3884e-01, -4.1938e-01,
         0.0000e+00,  0.0000e+00, -1.4421e-01, -8.1085e-01,  5.6494e-02,
         5.8140e-01,  3.9013e-02, -3.4606e-01, -1.8280e-01,  7.9242e-04,
        -2.2414e-02,  2.5705e-01,  6.6266e-02, -2.8663e-01, -5.5589e-01,
        -9.6492e-02, -7.8649e-02, -3.5369e-01, -1.2660e-01,  1.1666e-01,
        -5.1295e-01, -1.2772e+00,  1.3821e-02,  1.3845e+00,  1.8870e+00,
         1.7755e+00,  7.0894e-01,  1.4378e+00, -2.4874e+00, -2.2063e-01,
        -2.9489e-01,  1.0297e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  5.4179e-02,  2.6416e-01,  0.0000e+00, -1.2481e+00,
         4.0861e-01, -2.3284e+00,  1.3995e-01,  3.2667e-02,  0.0000e+00,
         0.0000e+00,  1.9527e-02, -1.8033e-01,  6.7643e-03, -1.7292e-02,
         6.7000e-02, -4.3188e-01, -3.7835e-01,  2.1099e-01,  2.4922e-01,
        -3.9976e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([4826]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([ 1.8820e-02,  8.3680e-02, -7.9874e-01, -1.1744e-01,  8.1926e-01,
        -7.0996e-01, -1.9966e+00, -1.0775e+00, -3.6405e-01, -1.3855e-01,
        -1.6774e-02,  9.3288e-03, -4.2412e-02, -6.4712e-02,  3.6116e-02,
         5.4810e-01, -1.9479e-01,  7.7155e-01,  4.5852e-01,  8.7119e-03,
         7.4209e-01, -1.8899e-01,  5.2501e-02, -4.2265e-01,  5.2064e-01,
        -6.4386e-03, -7.2439e-01, -6.8662e-02, -8.0948e-01,  4.1203e-02,
         1.8714e-01,  1.3541e-02,  3.3481e-01,  9.8409e-02, -1.4494e-03,
        -1.1368e+00,  1.3192e-02, -7.0466e-01,  6.3335e-01, -7.0855e-01,
        -1.4501e-01,  1.5804e-01,  1.2192e-02,  2.3968e-02, -3.7000e-03,
        -4.4552e-01,  9.5932e-01,  2.0401e-01, -4.1580e-01,  1.2171e+00,
         1.6730e+00, -1.1007e+00, -6.2636e-01, -1.2679e+00, -7.4223e-01,
         8.0022e-03, -1.0893e+00,  1.1615e+00, -7.9993e-04,  6.2808e-02,
        -3.9909e-03, -2.7642e-04,  9.0410e-03,  1.8528e-02, -1.0378e-02,
         3.0594e-05,  5.1983e-02, -2.5582e+00,  8.5946e-02, -1.0104e-02,
         0.0000e+00,  0.0000e+00, -1.4421e-01, -5.5099e-01,  1.1204e-02,
         3.0825e-01,  9.9530e-04, -1.9123e-03,  2.5390e-03,  7.9242e-04,
         1.9376e-01,  6.0692e-01, -1.5442e-01,  2.0061e-02, -4.6656e-01,
        -8.4911e-02, -7.3589e-02,  3.1820e-02,  5.3414e-03,  2.8129e-01,
        -5.4592e-01, -1.2772e+00,  1.3821e-02, -1.1170e+00, -8.8277e-01,
        -1.2188e+00, -5.4814e-01, -2.8496e-01, -9.4263e-01, -1.1195e+00,
        -2.3083e-01,  1.6644e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.6646e-02,  3.1921e-01,  0.0000e+00, -9.3808e-01,
        -9.4247e-01,  2.4640e-01,  1.1855e-01,  3.2667e-02,  0.0000e+00,
         0.0000e+00,  1.1356e-02,  2.3742e-01,  6.7643e-03, -1.8907e-02,
        -5.7504e-02,  4.7245e-04, -2.3224e-02,  3.4302e-01,  3.7060e-01,
        -2.7359e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1093]), tensor(-0.0185))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.7425e-01,  3.7754e-01,  1.4934e-01, -1.3170e+00, -1.3253e-01,
        -6.4465e-01, -1.6967e-01, -3.4584e-01,  3.4598e-01, -1.5492e-01,
        -7.0767e-01, -1.1320e-02, -4.9315e-01, -1.1341e-01,  7.7373e-02,
         5.1234e-01, -1.2838e-01,  1.9862e-01, -4.8695e-02,  4.3362e-01,
        -3.5150e-01,  3.8941e-02,  3.6587e-02,  1.5554e-02, -5.9349e-02,
        -2.6173e-01, -5.6831e-01, -2.7338e-04,  3.9550e-01,  1.0619e+00,
         4.6676e-01, -9.5131e-02,  4.4205e-01,  8.6933e-03, -3.7636e-01,
        -1.9066e-01,  7.8067e-02,  5.6022e-01,  1.4630e-02, -1.1506e+00,
        -2.9475e-01,  3.6848e-01,  2.3401e-01, -8.0414e-02, -1.7311e-01,
        -6.7188e-01,  1.2521e-01, -5.8672e-02, -4.5347e-01, -1.4579e-01,
        -6.4478e-01,  6.6964e-01, -1.5089e-01, -6.6906e-02,  2.4691e-02,
         4.3137e-01, -7.5919e-01,  3.8151e-02, -2.5174e-01, -1.8652e-02,
         1.2382e-01, -3.1448e-01,  1.4006e-01,  2.6348e-01,  1.1506e-01,
        -1.3377e-01,  1.6539e-01, -8.0429e-02,  7.3199e-01, -4.2069e-01,
         0.0000e+00,  0.0000e+00, -9.4989e-02, -8.0793e-01,  6.9545e-02,
         5.7868e-01,  3.3156e-02, -3.4722e-01, -1.8260e-01,  3.4026e-03,
        -6.5914e-03,  2.4846e-01,  4.3762e-02, -3.1158e-01, -5.5520e-01,
        -1.0190e-01, -8.3315e-02, -3.4428e-01, -1.0836e-01,  1.3599e-01,
        -5.0767e-01, -1.2661e+00,  3.9227e-03,  1.4985e+00,  2.0153e+00,
         1.9005e+00,  7.5873e-01,  1.5519e+00, -2.5355e+00, -1.0712e-01,
        -3.0477e-01,  1.0635e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0060e-02,  2.7572e-01,  0.0000e+00, -1.1510e+00,
         5.3159e-01, -2.2985e+00,  1.4497e-01,  3.1339e-02,  0.0000e+00,
         0.0000e+00,  1.4065e-02, -1.8017e-01,  9.3949e-03, -3.9383e-02,
         3.7427e-02, -4.3923e-01, -3.6782e-01,  2.2340e-01,  2.5535e-01,
        -4.0639e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([5006]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([ 1.2993e-02,  7.0280e-02,  5.4580e-01,  1.4098e-01, -3.7937e-01,
        -3.2199e-01, -2.0970e+00, -1.0822e+00, -2.2737e-01, -3.1425e-01,
        -1.5613e-02,  5.8420e-03, -2.8197e-02, -5.8125e-02,  3.6224e-02,
        -1.3633e+00, -1.4110e-01,  5.8407e-02,  1.1676e-01,  1.4697e-02,
         6.4857e-02, -1.1747e-01,  5.8770e-01, -2.9751e-01, -3.5050e-01,
        -6.5498e-03, -6.6369e-01, -2.7338e-04, -1.0685e+00,  2.7080e-02,
        -2.0452e-01, -4.7176e-02,  2.9836e-01,  8.6933e-03, -5.4638e-04,
        -5.2011e-01,  7.9955e-03, -7.1260e-01, -1.1614e-01, -9.4484e-01,
         6.9123e-02, -7.7512e-01,  1.3185e-02,  1.1272e-02,  7.3407e-04,
         6.7760e-02, -2.7334e-01, -4.8967e-02,  7.1605e-01, -1.4864e-01,
         9.0603e-01, -1.0786e+00, -5.5943e-01, -9.6500e-01, -7.4081e-01,
         7.2555e-03, -1.0852e+00, -3.4742e-01, -2.2293e-03,  1.3772e-01,
        -5.0189e-03, -3.0738e-03,  9.1674e-03,  1.3885e-02, -7.3406e-03,
         7.6830e-04,  4.4575e-02, -4.2739e-01,  7.5308e-02, -9.8693e-03,
         0.0000e+00,  0.0000e+00, -9.4989e-02,  1.4364e-02,  9.7428e-03,
        -3.9122e-01,  1.5581e-03, -2.7052e-03,  7.7936e-04,  3.4026e-03,
         1.6028e-01, -5.3828e-01, -1.7883e-01,  6.0396e-01, -4.9598e-01,
        -9.2094e-02, -7.8620e-02,  2.6062e-02,  4.3028e-03,  1.0161e-01,
        -6.5284e-01,  9.4613e-01,  3.9227e-03, -2.9295e-01, -8.0607e-01,
        -7.0806e-01,  4.3613e-02, -6.3081e-01, -1.5640e-01,  4.2306e-02,
        -2.5627e-01,  9.5470e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.8296e-02,  2.1888e-01,  0.0000e+00, -1.0606e+00,
        -1.5565e+00, -1.9042e+00,  1.1952e-01,  3.1339e-02,  0.0000e+00,
         0.0000e+00,  1.1698e-02, -2.3071e-01,  9.3949e-03, -1.7782e-02,
         8.5195e-03,  7.6178e-05, -1.4510e-02,  2.6743e-01,  2.6624e-01,
        -2.8328e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1119]), tensor(0.0132))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989]
INFO:main.py:Testing data year: 1990
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 32
            max_num_epochs: 40
            num_cpus: 32
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 6562
            device: cpu
            
2024-07-10 16:55:43,056	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-10 16:55:43,106	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-10 16:55:43,155	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_843c6072a1ab9dc8.zip' (1.32MiB) to Ray cluster...
2024-07-10 16:55:43,166	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_843c6072a1ab9dc8.zip'.
2024-07-10 16:55:45,259	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-10 17:02:09,324	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-10_16-55-45' in 0.1017s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 65, 'num_layers': 4, 'num_embeddings': 6562, 'embedding_dim': 25, 'dropout_rate': 0.15, 'lr': 0.0015702970884055383, 'weight_decay': 0.00015751320499779724, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.020721272787952844
INFO:model_data_nn.py:Best trial testing loss: 0.03365233863189898
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-10_16-55-39_236519_2875784/artifacts/2024-07-10_16-55-45/train_fnn_2024-07-10_16-55-45/driver_artifacts/train_fnn_ec460_00000_0_dropout_rate=0.1500,embedding_dim=25,hidden_dim=65,lr=0.0016,num_layers=4,weight_decay=0.0002_2024-07-10_16-55-45
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 65, 'num_layers': 4, 'num_embeddings': 6817, 'embedding_dim': 25, 'dropout_rate': 0.15, 'lr': 0.0015702970884055383, 'weight_decay': 0.00015751320499779724, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 1.6950274089601602, 'avg_test_loss': 0.05092516825408549}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.025827140040519777, 'avg_test_loss': 0.0476795659123643}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.02205166270444508, 'avg_test_loss': 0.04686039364519151}
INFO:model_data_nn.py:Epoch 4/40, metrics: {'avg_train_loss': 0.022561720894315882, 'avg_test_loss': 0.04801654170795872}
INFO:model_data_nn.py:Epoch 5/40, metrics: {'avg_train_loss': 0.022711396206634853, 'avg_test_loss': 0.05031661310208005}
INFO:model_data_nn.py:Early stopping at epoch 5
INFO:main.py:Making prediction for data in year: 1991
INFO:main.py:Prediction data shape: (47150,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:349: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1991: 0.22424279716007356
INFO:main.py:Prediction Stats:                 ret          pred
count  47150.000000  47150.000000
mean       0.038270      0.003865
std        0.216332      0.063424
min       -0.937500     -0.142185
25%       -0.058140     -0.034804
50%        0.011494      0.000045
75%        0.100000      0.020045
max        9.000000      0.645945
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:transform_data_nn.py:Train_data: (422659, 161)

INFO:transform_data_nn.py:Test data years: [1991]
INFO:transform_data_nn.py:Test_data: (47150, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:transform_data_nn.py:Retrain_data: (469809, 161)

INFO:transform_data_nn.py:Prediction data years: [1992]
INFO:transform_data_nn.py:Prediction_data: (47572, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([422659, 152])
            y_train_tf: torch.Size([422659])

            x_test_tf: torch.Size([47150, 152])
            y_test_tf: torch.Size([47150])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([469809, 152])
            y_retrain_tf: torch.Size([469809])

            x_prediction_tf: torch.Size([47572, 152])
            y_prediction_tf: torch.Size([47572])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.7425e-01,  3.7754e-01,  1.4934e-01, -1.3170e+00, -1.3253e-01,
        -6.4465e-01, -1.6967e-01, -3.4584e-01,  3.4598e-01, -1.5492e-01,
        -7.0767e-01, -1.1320e-02, -4.9315e-01, -1.1341e-01,  7.7373e-02,
         5.1234e-01, -1.2838e-01,  1.9862e-01, -4.8695e-02,  4.3362e-01,
        -3.5150e-01,  3.8941e-02,  3.6587e-02,  1.5554e-02, -5.9349e-02,
        -2.6173e-01, -5.6831e-01, -2.7338e-04,  3.9550e-01,  1.0619e+00,
         4.6676e-01, -9.5131e-02,  4.4205e-01,  8.6933e-03, -3.7636e-01,
        -1.9066e-01,  7.8067e-02,  5.6022e-01,  1.4630e-02, -1.1506e+00,
        -2.9475e-01,  3.6848e-01,  2.3401e-01, -8.0414e-02, -1.7311e-01,
        -6.7188e-01,  1.2521e-01, -5.8672e-02, -4.5347e-01, -1.4579e-01,
        -6.4478e-01,  6.6964e-01, -1.5089e-01, -6.6906e-02,  2.4691e-02,
         4.3137e-01, -7.5919e-01,  3.8151e-02, -2.5174e-01, -1.8652e-02,
         1.2382e-01, -3.1448e-01,  1.4006e-01,  2.6348e-01,  1.1506e-01,
        -1.3377e-01,  1.6539e-01, -8.0429e-02,  7.3199e-01, -4.2069e-01,
         0.0000e+00,  0.0000e+00, -9.4989e-02, -8.0793e-01,  6.9545e-02,
         5.7868e-01,  3.3156e-02, -3.4722e-01, -1.8260e-01,  3.4026e-03,
        -6.5914e-03,  2.4846e-01,  4.3762e-02, -3.1158e-01, -5.5520e-01,
        -1.0190e-01, -8.3315e-02, -3.4428e-01, -1.0836e-01,  1.3599e-01,
        -5.0767e-01, -1.2661e+00,  3.9227e-03,  1.4985e+00,  2.0153e+00,
         1.9005e+00,  7.5873e-01,  1.5519e+00, -2.5355e+00, -1.0712e-01,
        -3.0477e-01,  1.0635e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0060e-02,  2.7572e-01,  0.0000e+00, -1.1510e+00,
         5.3159e-01, -2.2985e+00,  1.4497e-01,  3.1339e-02,  0.0000e+00,
         0.0000e+00,  1.4065e-02, -1.8017e-01,  9.3949e-03, -3.9383e-02,
         3.7427e-02, -4.3923e-01, -3.6782e-01,  2.2340e-01,  2.5535e-01,
        -4.0639e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([5006]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([ 1.2993e-02,  7.0280e-02,  5.4580e-01,  1.4098e-01, -3.7937e-01,
        -3.2199e-01, -2.0970e+00, -1.0822e+00, -2.2737e-01, -3.1425e-01,
        -1.5613e-02,  5.8420e-03, -2.8197e-02, -5.8125e-02,  3.6224e-02,
        -1.3633e+00, -1.4110e-01,  5.8407e-02,  1.1676e-01,  1.4697e-02,
         6.4857e-02, -1.1747e-01,  5.8770e-01, -2.9751e-01, -3.5050e-01,
        -6.5498e-03, -6.6369e-01, -2.7338e-04, -1.0685e+00,  2.7080e-02,
        -2.0452e-01, -4.7176e-02,  2.9836e-01,  8.6933e-03, -5.4638e-04,
        -5.2011e-01,  7.9955e-03, -7.1260e-01, -1.1614e-01, -9.4484e-01,
         6.9123e-02, -7.7512e-01,  1.3185e-02,  1.1272e-02,  7.3407e-04,
         6.7760e-02, -2.7334e-01, -4.8967e-02,  7.1605e-01, -1.4864e-01,
         9.0603e-01, -1.0786e+00, -5.5943e-01, -9.6500e-01, -7.4081e-01,
         7.2555e-03, -1.0852e+00, -3.4742e-01, -2.2293e-03,  1.3772e-01,
        -5.0189e-03, -3.0738e-03,  9.1674e-03,  1.3885e-02, -7.3406e-03,
         7.6830e-04,  4.4575e-02, -4.2739e-01,  7.5308e-02, -9.8693e-03,
         0.0000e+00,  0.0000e+00, -9.4989e-02,  1.4364e-02,  9.7428e-03,
        -3.9122e-01,  1.5581e-03, -2.7052e-03,  7.7936e-04,  3.4026e-03,
         1.6028e-01, -5.3828e-01, -1.7883e-01,  6.0396e-01, -4.9598e-01,
        -9.2094e-02, -7.8620e-02,  2.6062e-02,  4.3028e-03,  1.0161e-01,
        -6.5284e-01,  9.4613e-01,  3.9227e-03, -2.9295e-01, -8.0607e-01,
        -7.0806e-01,  4.3613e-02, -6.3081e-01, -1.5640e-01,  4.2306e-02,
        -2.5627e-01,  9.5470e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  2.8296e-02,  2.1888e-01,  0.0000e+00, -1.0606e+00,
        -1.5565e+00, -1.9042e+00,  1.1952e-01,  3.1339e-02,  0.0000e+00,
         0.0000e+00,  1.1698e-02, -2.3071e-01,  9.3949e-03, -1.7782e-02,
         8.5195e-03,  7.6178e-05, -1.4510e-02,  2.6743e-01,  2.6624e-01,
        -2.8328e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1119]), tensor(0.0132))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.7234e-01,  4.6972e-01,  1.3369e-01, -1.3233e+00, -1.1615e-01,
        -6.5763e-01, -1.7787e-01, -3.5546e-01,  3.2117e-01, -1.5645e-01,
        -7.0541e-01, -1.5574e-03, -4.8483e-01, -1.7368e-01,  8.8285e-02,
         5.0900e-01, -1.2565e-01,  1.9820e-01, -8.7710e-02,  4.5217e-01,
        -3.6214e-01,  1.5567e-03,  1.2075e-02,  2.0896e-02, -5.7166e-02,
        -2.6419e-01, -5.6232e-01, -1.1018e-02,  3.9683e-01,  1.0666e+00,
         4.3934e-01, -8.5856e-02,  4.4396e-01, -5.2619e-03, -3.7864e-01,
        -1.8745e-01,  8.5812e-02,  5.7862e-01,  2.0035e-02, -1.1342e+00,
        -3.0314e-01,  3.5782e-01,  2.6210e-01, -9.0749e-02, -1.6322e-01,
        -6.7575e-01,  1.2232e-01, -7.2473e-02, -4.3025e-01, -1.6126e-01,
        -6.6996e-01,  6.6997e-01, -1.4319e-01, -4.9841e-02,  3.0161e-02,
         4.2920e-01, -7.5336e-01,  5.1860e-02, -2.4874e-01, -2.6112e-02,
         1.2572e-01, -3.1123e-01,  1.3579e-01,  2.5557e-01,  1.1514e-01,
        -1.4038e-01,  2.3383e-01, -9.0486e-02,  7.2582e-01, -4.2017e-01,
        -1.2030e-01, -4.4965e-02, -7.9972e-02, -8.0907e-01,  8.3420e-02,
         5.8997e-01,  2.7258e-02, -3.4975e-01, -1.8380e-01, -2.8744e-04,
        -1.9863e-02,  2.5660e-01,  2.5976e-02, -3.2665e-01, -5.5216e-01,
        -1.0612e-01, -8.7828e-02, -3.3475e-01, -9.2894e-02,  1.5286e-01,
        -5.0040e-01, -1.2594e+00,  3.0052e-03,  1.6066e+00,  2.0217e+00,
         2.0209e+00,  6.7476e-01,  1.6506e+00, -2.6817e+00, -3.3824e-02,
        -3.0674e-01,  1.2242e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.5031e-02,  2.6305e-01,  0.0000e+00, -1.1035e+00,
         6.1772e-01, -2.2042e+00,  1.4834e-01,  3.5943e-02,  0.0000e+00,
         0.0000e+00,  1.1816e-02, -1.7538e-01,  9.9392e-03, -5.9433e-02,
         4.2013e-02, -4.4646e-01, -3.5918e-01,  2.3720e-01,  2.6317e-01,
        -4.1316e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([5237]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([ 6.2642e-03,  6.7182e-02, -6.4165e-01,  3.5846e-01, -2.5759e-01,
        -4.6121e-01, -2.1794e+00, -1.0532e+00, -5.0706e-01, -3.2195e-01,
        -1.5071e-02,  4.0833e-03, -4.0119e-02, -5.0377e-02,  3.2950e-02,
         2.5575e-01, -1.9624e-01,  5.8189e-02,  1.8857e-01,  2.0410e-02,
         5.6067e-01, -8.3279e-02,  2.3434e-02, -2.9241e-01, -1.5860e-01,
        -6.7403e-03, -6.9119e-01, -9.8580e-01, -6.3083e-01,  3.5019e-02,
        -2.1587e-02, -8.3943e-02,  2.2857e-01, -5.2619e-03, -1.2769e-03,
        -5.1239e-01,  1.3431e-02, -7.3048e-01, -1.5444e-01, -1.0767e+00,
         9.0696e-03,  2.6169e-01,  1.9195e-02,  2.4653e-02,  7.3430e-03,
        -2.5199e-01,  9.6112e-01, -1.2186e-01,  3.9670e-01,  1.1515e+00,
         1.6549e+00, -8.2762e-01, -6.1543e-01, -8.2104e-01, -7.3789e-01,
         5.2873e-03, -1.0808e+00,  1.1631e+00, -2.7504e-03, -7.3552e-01,
        -4.3126e-03, -3.2616e-03,  7.3414e-03,  9.9719e-03, -7.7297e-03,
        -1.0633e-03,  4.0335e-02, -5.7112e+00,  7.2582e-01, -9.7144e-03,
        -1.2030e-01, -4.4965e-02, -7.9972e-02, -1.1711e-01,  9.2094e-03,
        -2.6444e-02,  1.6299e-03, -4.6931e-03,  3.7746e-04, -2.8744e-04,
         1.3632e-01, -2.4099e-01, -3.6805e-01,  7.0494e-01, -3.3731e-01,
        -3.1895e-03, -1.5419e-03,  3.1128e-02,  4.8253e-03,  1.0913e-01,
        -4.2202e-01, -3.7713e-01,  3.0052e-03, -1.3418e+00, -2.4070e+00,
        -9.2789e-01,  1.9075e+00, -1.6080e+00,  8.2921e-01, -9.7018e-01,
        -5.8507e-02,  1.3223e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  4.1613e-02,  5.8432e-01,  0.0000e+00, -2.3980e-01,
        -1.7502e-01, -1.5754e+00,  1.2281e-01,  3.5943e-02,  0.0000e+00,
         0.0000e+00,  1.3431e-02, -1.9908e-01,  9.9392e-03, -1.5549e-02,
         8.2946e-04, -7.8995e-04, -2.5634e-02,  2.8180e-01,  2.6638e-01,
        -3.9954e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1148]), tensor(-0.0517))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990]
INFO:main.py:Testing data year: 1991
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 32
            max_num_epochs: 40
            num_cpus: 32
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 6817
            device: cpu
            
2024-07-10 18:11:26,079	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-10 18:11:26,157	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-10 18:11:26,195	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_843c6072a1ab9dc8.zip' (1.32MiB) to Ray cluster...
2024-07-10 18:11:26,205	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_843c6072a1ab9dc8.zip'.
2024-07-10 18:11:28,460	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-10 18:19:12,994	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-10_18-11-28' in 0.0973s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 151, 'hidden_dim': 185, 'num_layers': 4, 'num_embeddings': 6817, 'embedding_dim': 10, 'dropout_rate': 0.42, 'lr': 0.0026568139241144955, 'weight_decay': 0.00018484491720988626, 'num_epochs': 40, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03258752742710075
INFO:model_data_nn.py:Best trial testing loss: 0.04846426905510393
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-10_18-11-22_000352_2875784/artifacts/2024-07-10_18-11-28/train_fnn_2024-07-10_18-11-28/driver_artifacts/train_fnn_803b6_00018_18_dropout_rate=0.4200,embedding_dim=10,hidden_dim=185,lr=0.0027,num_layers=4,weight_decay=0.0002_2024-07-10_18-11-28
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]

            Using the optimized hyperparameters: {'continuous_dim': 151, 'hidden_dim': 185, 'num_layers': 4, 'num_embeddings': 7144, 'embedding_dim': 10, 'dropout_rate': 0.42, 'lr': 0.0026568139241144955, 'weight_decay': 0.00018484491720988626, 'num_epochs': 40, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/40, metrics: {'avg_train_loss': 3.479524827391834, 'avg_test_loss': 0.03921603187618236}
INFO:model_data_nn.py:Epoch 2/40, metrics: {'avg_train_loss': 0.02629860903061358, 'avg_test_loss': 0.042178834633280836}
INFO:model_data_nn.py:Epoch 3/40, metrics: {'avg_train_loss': 0.03135208184739538, 'avg_test_loss': 0.04794943297622345}
INFO:model_data_nn.py:Early stopping at epoch 3
INFO:main.py:Making prediction for data in year: 1992
INFO:main.py:Prediction data shape: (47572,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:349: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 1992: 0.2189765430630149
INFO:main.py:Prediction Stats:                 ret          pred
count  47572.000000  47572.000000
mean       0.021557      0.059498
std        0.196838      0.095130
min       -0.958333     -0.127462
25%       -0.064271      0.011494
50%        0.000000      0.032392
75%        0.078377      0.075875
max        5.769231      1.237385
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:transform_data_nn.py:Train_data: (469809, 161)

INFO:transform_data_nn.py:Test data years: [1992]
INFO:transform_data_nn.py:Test_data: (47572, 161)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992]
INFO:transform_data_nn.py:Retrain_data: (517381, 161)

INFO:transform_data_nn.py:Prediction data years: [1993]
INFO:transform_data_nn.py:Prediction_data: (50974, 161)

INFO:main.py:

Generate X and y with train_data and test_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_train_tf: torch.Size([469809, 152])
            y_train_tf: torch.Size([469809])

            x_test_tf: torch.Size([47572, 152])
            y_test_tf: torch.Size([47572])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1140: RuntimeWarning: invalid value encountered in divide
  updated_mean = (last_sum + new_sum) / updated_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1145: RuntimeWarning: invalid value encountered in divide
  T = new_sum / new_sample_count
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/sklearn/utils/extmath.py:1165: RuntimeWarning: invalid value encountered in divide
  new_unnormalized_variance -= correction**2 / new_sample_count
INFO:main.py:
            x_retrain_tf: torch.Size([517381, 152])
            y_retrain_tf: torch.Size([517381])

            x_prediction_tf: torch.Size([50974, 152])
            y_prediction_tf: torch.Size([50974])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([-1.7234e-01,  4.6972e-01,  1.3369e-01, -1.3233e+00, -1.1615e-01,
        -6.5763e-01, -1.7787e-01, -3.5546e-01,  3.2117e-01, -1.5645e-01,
        -7.0541e-01, -1.5574e-03, -4.8483e-01, -1.7368e-01,  8.8285e-02,
         5.0900e-01, -1.2565e-01,  1.9820e-01, -8.7710e-02,  4.5217e-01,
        -3.6214e-01,  1.5567e-03,  1.2075e-02,  2.0896e-02, -5.7166e-02,
        -2.6419e-01, -5.6232e-01, -1.1018e-02,  3.9683e-01,  1.0666e+00,
         4.3934e-01, -8.5856e-02,  4.4396e-01, -5.2619e-03, -3.7864e-01,
        -1.8745e-01,  8.5812e-02,  5.7862e-01,  2.0035e-02, -1.1342e+00,
        -3.0314e-01,  3.5782e-01,  2.6210e-01, -9.0749e-02, -1.6322e-01,
        -6.7575e-01,  1.2232e-01, -7.2473e-02, -4.3025e-01, -1.6126e-01,
        -6.6996e-01,  6.6997e-01, -1.4319e-01, -4.9841e-02,  3.0161e-02,
         4.2920e-01, -7.5336e-01,  5.1860e-02, -2.4874e-01, -2.6112e-02,
         1.2572e-01, -3.1123e-01,  1.3579e-01,  2.5557e-01,  1.1514e-01,
        -1.4038e-01,  2.3383e-01, -9.0486e-02,  7.2582e-01, -4.2017e-01,
        -1.2030e-01, -4.4965e-02, -7.9972e-02, -8.0907e-01,  8.3420e-02,
         5.8997e-01,  2.7258e-02, -3.4975e-01, -1.8380e-01, -2.8744e-04,
        -1.9863e-02,  2.5660e-01,  2.5976e-02, -3.2665e-01, -5.5216e-01,
        -1.0612e-01, -8.7828e-02, -3.3475e-01, -9.2894e-02,  1.5286e-01,
        -5.0040e-01, -1.2594e+00,  3.0052e-03,  1.6066e+00,  2.0217e+00,
         2.0209e+00,  6.7476e-01,  1.6506e+00, -2.6817e+00, -3.3824e-02,
        -3.0674e-01,  1.2242e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.5031e-02,  2.6305e-01,  0.0000e+00, -1.1035e+00,
         6.1772e-01, -2.2042e+00,  1.4834e-01,  3.5943e-02,  0.0000e+00,
         0.0000e+00,  1.1816e-02, -1.7538e-01,  9.9392e-03, -5.9433e-02,
         4.2013e-02, -4.4646e-01, -3.5918e-01,  2.3720e-01,  2.6317e-01,
        -4.1316e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([5237]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([ 6.2642e-03,  6.7182e-02, -6.4165e-01,  3.5846e-01, -2.5759e-01,
        -4.6121e-01, -2.1794e+00, -1.0532e+00, -5.0706e-01, -3.2195e-01,
        -1.5071e-02,  4.0833e-03, -4.0119e-02, -5.0377e-02,  3.2950e-02,
         2.5575e-01, -1.9624e-01,  5.8189e-02,  1.8857e-01,  2.0410e-02,
         5.6067e-01, -8.3279e-02,  2.3434e-02, -2.9241e-01, -1.5860e-01,
        -6.7403e-03, -6.9119e-01, -9.8580e-01, -6.3083e-01,  3.5019e-02,
        -2.1587e-02, -8.3943e-02,  2.2857e-01, -5.2619e-03, -1.2769e-03,
        -5.1239e-01,  1.3431e-02, -7.3048e-01, -1.5444e-01, -1.0767e+00,
         9.0696e-03,  2.6169e-01,  1.9195e-02,  2.4653e-02,  7.3430e-03,
        -2.5199e-01,  9.6112e-01, -1.2186e-01,  3.9670e-01,  1.1515e+00,
         1.6549e+00, -8.2762e-01, -6.1543e-01, -8.2104e-01, -7.3789e-01,
         5.2873e-03, -1.0808e+00,  1.1631e+00, -2.7504e-03, -7.3552e-01,
        -4.3126e-03, -3.2616e-03,  7.3414e-03,  9.9719e-03, -7.7297e-03,
        -1.0633e-03,  4.0335e-02, -5.7112e+00,  7.2582e-01, -9.7144e-03,
        -1.2030e-01, -4.4965e-02, -7.9972e-02, -1.1711e-01,  9.2094e-03,
        -2.6444e-02,  1.6299e-03, -4.6931e-03,  3.7746e-04, -2.8744e-04,
         1.3632e-01, -2.4099e-01, -3.6805e-01,  7.0494e-01, -3.3731e-01,
        -3.1895e-03, -1.5419e-03,  3.1128e-02,  4.8253e-03,  1.0913e-01,
        -4.2202e-01, -3.7713e-01,  3.0052e-03, -1.3418e+00, -2.4070e+00,
        -9.2789e-01,  1.9075e+00, -1.6080e+00,  8.2921e-01, -9.7018e-01,
        -5.8507e-02,  1.3223e-02,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  4.1613e-02,  5.8432e-01,  0.0000e+00, -2.3980e-01,
        -1.7502e-01, -1.5754e+00,  1.2281e-01,  3.5943e-02,  0.0000e+00,
         0.0000e+00,  1.3431e-02, -1.9908e-01,  9.9392e-03, -1.5549e-02,
         8.2946e-04, -7.8995e-04, -2.5634e-02,  2.8180e-01,  2.6638e-01,
        -3.9954e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1148]), tensor(-0.0517))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([-1.7017e-01,  5.4430e-01,  1.2009e-01, -1.3250e+00, -1.0880e-01,
        -6.7292e-01, -1.8004e-01, -3.5933e-01,  3.2668e-01, -1.5317e-01,
        -7.0589e-01,  7.4726e-03, -4.8743e-01, -2.2608e-01,  1.0144e-01,
         5.1039e-01, -1.2794e-01,  2.0643e-01, -1.0678e-01,  4.7095e-01,
        -3.3926e-01,  1.6034e-03,  1.7851e-02,  1.7928e-02, -5.3087e-02,
        -2.6831e-01, -5.6195e-01, -1.7845e-02,  3.8549e-01,  1.0970e+00,
         4.2313e-01, -8.9777e-02,  4.4965e-01, -1.3829e-02, -3.8024e-01,
        -1.8186e-01,  1.0190e-01,  5.8749e-01,  2.8611e-02, -1.1229e+00,
        -3.0893e-01,  3.1183e-01,  2.8781e-01, -8.9431e-02, -1.5191e-01,
        -6.8379e-01,  1.0111e-01, -7.6698e-02, -4.0679e-01, -1.6009e-01,
        -6.9287e-01,  6.6100e-01, -1.3563e-01, -3.9684e-02,  2.3737e-02,
         4.2900e-01, -7.4683e-01,  5.1487e-02, -2.5445e-01, -2.8726e-02,
         1.2699e-01, -3.1623e-01,  1.3253e-01,  2.5171e-01,  1.1643e-01,
        -1.4354e-01,  2.8767e-01, -1.0047e-01,  7.1446e-01, -4.1912e-01,
        -1.6563e-01, -6.4405e-02, -3.0634e-02, -8.1485e-01,  9.5358e-02,
         6.0610e-01,  2.5212e-02, -3.5232e-01, -1.8446e-01,  6.2203e-03,
        -2.2769e-02,  2.6777e-01,  2.8779e-02, -3.3119e-01, -5.5081e-01,
        -1.0952e-01, -9.1631e-02, -3.2660e-01, -8.1110e-02,  1.6108e-01,
        -4.9870e-01, -1.2566e+00,  4.5272e-03,  1.6870e+00,  1.9463e+00,
         2.1191e+00,  3.9819e-01,  1.6656e+00, -2.7099e+00,  7.7995e-02,
        -2.9821e-01,  1.3334e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  6.0548e-02,  3.9668e-01,  0.0000e+00, -1.1758e+00,
         6.5412e-01, -2.1153e+00,  1.5104e-01,  2.5704e-02,  0.0000e+00,
         0.0000e+00,  1.5606e-02, -1.6936e-01,  1.0378e-02, -6.9491e-02,
         4.7393e-02, -4.4982e-01, -3.5714e-01,  2.4907e-01,  2.6962e-01,
        -4.1738e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([5495]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([ 8.2728e-03,  5.4755e-02, -4.9370e-01,  5.4448e-01,  2.9865e-01,
        -6.0803e-01, -2.2079e+00, -1.0301e+00, -4.6674e-01, -2.4042e-01,
        -1.7592e-02,  4.2173e-03, -3.7468e-02, -4.0824e-02,  2.9185e-02,
        -1.0207e+00, -1.7753e-01,  6.2290e-01,  1.4153e-01,  1.1150e-02,
         7.8102e-01, -7.0740e-02, -2.0869e-02, -3.4765e-01,  1.4737e-01,
        -9.8068e-03, -6.4582e-01, -7.3177e-01, -1.2937e+00,  3.8182e-02,
        -2.6866e-02, -2.1075e-01,  1.8523e-01, -1.3829e-02,  1.1890e-03,
         1.3803e+00,  1.7985e-02, -7.3909e-01,  4.1833e-01, -1.0074e+00,
        -4.5112e-02, -2.2884e-01,  1.1162e-02,  3.1080e-02,  4.3183e-03,
        -5.2148e-01, -2.0603e-01, -1.8556e-01,  3.2134e-01,  5.6058e-01,
         1.6397e+00, -8.3847e-01, -5.9076e-01, -7.3768e-01, -7.3865e-01,
         2.3038e-03, -1.0761e+00, -4.3372e-02, -9.3552e-03,  2.7181e-01,
        -5.0712e-03, -9.1803e-03,  1.0368e-02,  1.4657e-02, -9.1383e-03,
         5.3932e-03,  3.0839e-02,  1.1480e+00,  5.0633e-02, -1.2962e-02,
        -1.6563e-01, -6.4405e-02, -3.0634e-02, -4.5080e-01,  8.8855e-03,
         2.7061e-02,  1.3338e-03, -4.3063e-03,  1.4568e-03,  6.2203e-03,
         1.1851e-01, -4.7181e-01, -3.6238e-01, -1.7764e-01, -5.0873e-01,
        -3.4696e-03, -2.0132e-03,  3.1328e-02,  3.6180e-03,  1.2567e-01,
        -6.3390e-01,  9.6623e-01,  4.5272e-03, -1.3421e+00, -1.5261e+00,
        -9.5565e-01,  1.8065e+00, -1.6348e+00,  1.2081e+00, -1.1387e+00,
        -2.9790e-01,  3.0578e-03,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  3.3509e-02,  2.2757e-01,  0.0000e+00,  5.2594e-01,
        -3.2482e-02,  5.0274e-01,  1.0084e-01,  2.5704e-02,  0.0000e+00,
         0.0000e+00,  1.5330e-02,  2.4573e-02,  1.0378e-02, -8.7727e-03,
         6.8298e-03,  1.7210e-03, -2.3708e-02,  1.1407e-01,  1.7418e-01,
        -3.3056e-01,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00]), tensor([1220]), tensor(0.))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991]
INFO:main.py:Testing data year: 1992
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 32
            max_num_epochs: 40
            num_cpus: 32
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 151
            num_embeddings: 7144
            device: cpu
            
2024-07-10 19:34:29,026	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-10 19:34:29,102	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-10 19:34:29,137	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_f02e98c34c6f144a.zip' (1.32MiB) to Ray cluster...
2024-07-10 19:34:29,146	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_f02e98c34c6f144a.zip'.
2024-07-10 19:34:31,847	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
slurmstepd-yen11: error: *** JOB 413770 ON yen11 CANCELLED AT 2024-07-10T19:35:43 ***
