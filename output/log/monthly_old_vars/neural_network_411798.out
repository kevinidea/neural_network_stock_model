Current working directory
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin
source venv/bin/activate
which python3
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/bin/python3
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
INFO:preprocess_data_nn.py:

Loading and preprocessing data...

DEBUG:preprocess_data_nn.py:      date  permno
0  1980-01   10006
1  1980-01   10057
2  1980-01   10103
3  1980-01   10137
4  1980-01   10145
DEBUG:preprocess_data_nn.py:--------------------------------------------------
INFO:main.py:preprocessed df: (2216189, 158)
INFO:preprocess_data_nn.py:

Applying secondary data preprocessing..

INFO:main.py:secondary preprocessed df: (2165515, 158)
INFO:main.py:df sample:    permno  gvkey   adatadate  fyear  sic2     spi       mve_f  ...     zerotrade      beta    betasq      rsq1  pricedelay   idiovol  pyear
0   10006   1010  12/31/1978   1978    37  0.0000  269.308500  ...  1.115306e-07  1.060420  1.124491  0.343408    0.029859  0.025576   1980
1   10057   1098  09/30/1978   1978    36  0.0000   97.372000  ...  6.199128e-08  1.526013  2.328716  0.307905    0.092667  0.037473   1980
2   10103   1012  10/31/1978   1978    33     NaN    1.697500  ...           NaN  1.759493  3.095816  0.096753    0.221851  0.087020   1980
3   10137   1279  12/31/1978   1978    49     NaN  537.524500  ...  9.726790e-08  0.492885  0.242936  0.189693    0.125777  0.017540   1980
4   10145   1300  12/31/1978   1978    99 -0.0031  805.633282  ...  6.190654e-08  1.139163  1.297691  0.279437    0.024228  0.031201   1980

[5 rows x 158 columns]
INFO:main.py:Train year start: 1980
INFO:main.py:Prediction data years: [1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020]
INFO:main.py:

Loop through all the prediction years and build optimized model for each year

INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:transform_data_nn.py:Train_data: (1613984, 158)

INFO:transform_data_nn.py:Test data years: [2008]
INFO:transform_data_nn.py:Test_data: (49474, 158)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:transform_data_nn.py:Retrain_data: (1663458, 158)

INFO:transform_data_nn.py:Prediction data years: [2009]
INFO:transform_data_nn.py:Prediction_data: (47649, 158)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1613984, 103])
            y_train_tf: torch.Size([1613984])

            x_test_tf: torch.Size([49474, 103])
            y_test_tf: torch.Size([49474])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1663458, 103])
            y_retrain_tf: torch.Size([1663458])

            x_prediction_tf: torch.Size([47649, 103])
            y_prediction_tf: torch.Size([47649])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([ 1.8081e-01,  1.1299e+00,  8.1754e-02, -8.5688e-01, -2.9729e-03,
        -5.9015e-01, -2.6610e-02, -2.7131e-01,  7.5339e-01, -3.1464e-01,
        -7.6226e-01,  1.3451e-02, -7.2699e-01, -5.4012e-01, -4.2671e-01,
         1.0501e-02, -3.9521e-01,  1.2720e-01, -9.8723e-02,  8.5720e-01,
        -4.9987e-01, -1.4979e-01, -2.7226e-01, -4.4893e-03, -6.4843e-02,
        -2.9821e-01, -5.3236e-01, -7.7792e-02,  6.3565e-01,  1.8706e+00,
         3.7247e-01, -1.6200e-01,  9.2473e-01,  2.2940e-01, -3.4979e-01,
        -2.4244e-01,  1.5359e-01,  4.9836e-01, -2.7892e-02, -1.1199e+00,
        -2.1005e-01,  1.9173e-01,  4.8207e-01,  1.6785e-01, -6.3700e-02,
        -7.0327e-01,  5.6449e-02, -6.8392e-02, -4.7758e-01, -1.6196e-01,
        -4.3977e-01,  5.3375e-01, -4.6882e-01,  2.3686e-01, -2.7563e-02,
        -2.6653e-01, -6.9397e-01, -5.1298e-01, -5.4474e-01, -1.8561e-01,
        -2.4264e-02, -5.5142e-01, -6.4465e-01, -4.3580e-01, -3.6323e-01,
        -4.4318e-01,  1.0833e+00, -2.9267e-01, -6.8522e-01, -5.8088e-01,
        -6.4221e-01, -4.3580e-01,  6.5830e-04, -8.5149e-01,  2.8978e-01,
        -6.7319e-01,  3.2148e-01,  3.8196e-01,  8.7619e-01,  8.5330e-01,
        -1.2770e+00,  2.3675e-01,  4.4636e-03, -5.5726e-01, -1.0409e-01,
         4.2875e-01, -1.5309e-01, -8.5311e-01, -7.4030e-01, -8.9302e-01,
         1.0518e-01,  1.5803e-03,  4.3146e-02, -5.0315e-01, -5.0213e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([11232]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-3.0903e-01,  7.3711e-01, -7.6079e-01,  1.0431e+00, -6.0344e-01,
        -3.1123e-01, -3.2522e-01, -4.7886e-01, -3.0371e-01, -2.2511e-01,
        -5.1001e-02, -6.2754e-02, -4.2656e-01, -1.8681e-01, -4.0545e-01,
        -1.6596e+00, -4.8206e-01, -5.9225e-01, -9.8723e-02, -2.2748e-01,
        -9.9496e-01, -1.8182e-01, -5.2955e-01, -5.0763e-01,  2.8372e-01,
        -1.9479e-01, -5.8072e-01, -7.7792e-02, -2.6690e-01,  7.1187e-01,
         3.7424e-02, -3.4615e-02,  3.1261e-01,  2.2940e-01, -7.5705e-01,
        -5.0702e-01, -1.6651e+00, -6.8575e-01, -9.2762e-01, -3.1140e-01,
        -1.5838e-01, -1.2513e-01, -1.6052e+00, -4.2583e-01, -6.2173e-01,
        -4.4947e-01,  3.1349e-01, -9.2870e-02,  3.2916e-01, -2.4358e-01,
        -1.7155e+00,  5.3375e-01, -4.6882e-01, -1.1336e+00, -7.7706e-01,
        -6.2215e-01,  1.9837e-02, -6.3879e-01,  9.9768e-01, -2.7096e-01,
         5.3430e-01,  1.1035e+00, -8.8223e-01, -4.4429e-01, -2.2210e-02,
        -6.3095e-01,  6.5730e-01, -9.5429e-01,  5.1045e-01, -2.6679e-01,
        -3.5490e-03,  4.1185e-02,  6.5830e-04, -3.0184e-01, -1.9884e-02,
        -3.6101e-01, -9.8605e-02,  4.6718e-01, -1.7182e-01,  3.4168e-01,
         6.8178e-01,  1.3437e+00,  4.4636e-03, -5.5726e-01, -8.3076e-01,
        -2.5493e-01,  7.3786e-01, -7.3500e-01, -5.7143e-01, -7.8691e-01,
        -8.8933e-02,  1.0780e-01,  2.7388e-01, -5.7037e-01, -1.4923e-01,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([1151]), tensor(-0.0061))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([ 1.8690e-01,  1.1421e+00,  8.0233e-02, -8.7104e-01, -2.8282e-03,
        -5.9865e-01, -2.6962e-02, -2.7119e-01,  7.6936e-01, -3.1127e-01,
        -7.6188e-01,  1.4299e-02, -7.3047e-01, -5.4605e-01, -4.2065e-01,
         1.0972e-02, -3.9273e-01,  1.3084e-01, -9.5426e-02,  8.6790e-01,
        -4.9538e-01, -1.5097e-01, -2.7777e-01, -2.3351e-03, -6.6347e-02,
        -2.9934e-01, -5.3475e-01, -8.5307e-02,  6.3549e-01,  1.8872e+00,
         3.7202e-01, -1.6216e-01,  9.2903e-01,  2.3365e-01, -3.4419e-01,
        -2.4352e-01,  1.5239e-01,  5.0722e-01, -2.6697e-02, -1.1150e+00,
        -2.0937e-01,  2.2394e-01,  4.8902e-01,  1.6942e-01, -6.3125e-02,
        -7.0705e-01,  7.3487e-02, -5.7148e-02, -4.7651e-01, -1.4819e-01,
        -4.4636e-01,  5.3399e-01, -4.6863e-01,  2.3538e-01, -2.2685e-02,
        -2.6245e-01, -6.8215e-01, -5.0766e-01, -5.4546e-01, -1.8295e-01,
        -2.2478e-02, -5.5239e-01, -6.4191e-01, -4.3695e-01, -3.6497e-01,
        -4.4228e-01,  1.1013e+00, -2.9181e-01, -6.9592e-01, -5.8259e-01,
        -6.4156e-01, -4.5305e-01, -1.1480e-04, -8.5712e-01,  2.9132e-01,
        -6.5971e-01,  3.2046e-01,  3.8284e-01,  8.8625e-01,  8.6232e-01,
        -1.2863e+00,  2.3439e-01,  2.9738e-03, -5.6038e-01, -1.0313e-01,
         4.4223e-01, -1.3092e-01, -8.5844e-01, -7.4835e-01, -8.9201e-01,
         1.0751e-01,  6.4897e-03,  4.4255e-02, -5.1189e-01, -4.9575e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([11425]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-3.0210e-01,  7.4826e-01,  7.0292e-01,  1.0314e+00, -6.0386e-01,
        -8.6000e-02, -4.6891e-02, -2.8647e-01, -2.9663e-01, -2.2129e-01,
        -6.6110e-01, -6.1696e-02, -4.3043e-01, -1.8832e-01, -3.9922e-01,
        -1.6665e+00, -4.8022e-01, -5.9282e-01, -9.5426e-02, -2.2727e-01,
        -9.1869e-01, -1.8136e-01, -5.2895e-01, -9.2532e-01,  3.6788e-01,
        -1.9649e-01, -5.8272e-01, -8.5307e-02, -3.8034e-01,  7.2132e-01,
        -4.8192e-01, -3.4665e-02,  3.1533e-01,  2.3365e-01, -7.5196e-01,
        -5.0768e-01, -1.6543e+00, -6.8458e-01, -9.3330e-01, -5.7504e-01,
        -1.7047e-01, -1.3148e+00, -1.6104e+00, -4.2375e-01, -6.2226e-01,
         8.3219e-02, -5.9967e-01,  9.1125e-01,  2.2681e-01, -1.0106e+00,
        -1.7201e+00,  3.8712e-01, -4.6863e-01, -1.1322e+00, -7.7525e-01,
        -6.1915e-01,  1.9998e-02, -6.3310e-01,  1.0006e+00, -2.6880e-01,
         5.3985e-01,  1.1098e+00, -8.7979e-01, -4.4545e-01, -2.1724e-02,
        -6.2983e-01,  6.7154e-01, -2.6155e-01,  5.0006e-01, -2.7041e-01,
        -5.2206e-03,  6.9086e-02, -1.1480e-04,  2.5228e-02, -4.1230e-03,
        -2.7578e-01, -6.5138e-02,  4.6764e-01, -2.1679e-01,  3.4514e-01,
         6.6728e-01,  1.3461e+00,  2.9738e-03, -5.6038e-01, -8.3580e-01,
        -2.4543e-01, -7.3550e-02, -6.6621e-01, -6.0691e-01, -8.0740e-01,
        -2.9751e-01,  1.1173e-01,  2.7601e-01, -5.0994e-01, -4.9575e-01,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([1087]), tensor(0.0341))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007]
INFO:main.py:Testing data year: 2008
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 60
            max_num_epochs: 20
            num_cpus: 60
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 102
            num_embeddings: 16943
            device: cpu
            
2024-07-07 10:26:28,234	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-07 10:26:28,998	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-07 10:26:29,029	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_fadad946ef373469.zip' (1.20MiB) to Ray cluster...
2024-07-07 10:26:29,036	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_fadad946ef373469.zip'.
2024-07-07 10:26:59,672	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
[33m(raylet)[0m [2024-07-07 10:27:59,889 E 4039824 4039824] (raylet) worker_pool.cc:565: Some workers of the worker process(4043422) have not registered within the timeout. The process is still alive, probably it's hanging during start.
[33m(raylet)[0m [2024-07-07 10:28:59,964 E 4039824 4039824] (raylet) worker_pool.cc:565: Some workers of the worker process(4047612) have not registered within the timeout. The process is still alive, probably it's hanging during start.[32m [repeated 66x across cluster] (Ray deduplicates logs by default. Set RAY_DEDUP_LOGS=0 to disable log deduplication, or see https://docs.ray.io/en/master/ray-observability/user-guides/configure-logging.html#log-deduplication for more options.)[0m
[33m(raylet)[0m [2024-07-07 10:29:59,960 E 4039824 4039824] (raylet) worker_pool.cc:565: Some workers of the worker process(4047674) have not registered within the timeout. The process is still alive, probably it's hanging during start.[32m [repeated 56x across cluster][0m
[33m(raylet)[0m [2024-07-07 10:30:59,954 E 4039824 4039824] (raylet) worker_pool.cc:565: Some workers of the worker process(4047987) have not registered within the timeout. The process is still alive, probably it's hanging during start.[32m [repeated 59x across cluster][0m
[33m(raylet)[0m [2024-07-07 10:32:00,008 E 4039824 4039824] (raylet) worker_pool.cc:565: Some workers of the worker process(4056303) have not registered within the timeout. The process is still alive, probably it's hanging during start.[32m [repeated 62x across cluster][0m
2024-07-07 11:06:29,787	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-07_10-26-57' in 0.3692s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 102, 'hidden_dim': 155, 'num_layers': 5, 'num_embeddings': 16943, 'embedding_dim': 10, 'dropout_rate': 0.4470550239583974, 'lr': 0.0002693643916317943, 'weight_decay': 0.00039922428866315094, 'num_epochs': 20, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03629047826868995
INFO:model_data_nn.py:Best trial testing loss: 0.04371039046589093
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-07_10-26-16_591806_2505436/artifacts/2024-07-07_10-26-57/train_fnn_2024-07-07_10-26-57/driver_artifacts/train_fnn_71710_00041_41_dropout_rate=0.4471,embedding_dim=10,hidden_dim=155,lr=0.0003,num_layers=5,weight_decay=0.0004_2024-07-07_10-26-59
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]

            Using the optimized hyperparameters: {'continuous_dim': 102, 'hidden_dim': 155, 'num_layers': 5, 'num_embeddings': 17222, 'embedding_dim': 10, 'dropout_rate': 0.4470550239583974, 'lr': 0.0002693643916317943, 'weight_decay': 0.00039922428866315094, 'num_epochs': 20, 'num_gpus': 0}

/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/torch/cuda/__init__.py:619: UserWarning: Can't initialize NVML
  warnings.warn("Can't initialize NVML")
INFO:model_data_nn.py:Epoch 1/20, metrics: {'avg_train_loss': 3.0791623658225715, 'avg_test_loss': 0.07338599257051626}
INFO:model_data_nn.py:Epoch 2/20, metrics: {'avg_train_loss': 0.03778520362264204, 'avg_test_loss': 0.0733714696707174}
INFO:model_data_nn.py:Epoch 3/20, metrics: {'avg_train_loss': 0.03698889443793593, 'avg_test_loss': 0.07317043904633445}
INFO:model_data_nn.py:Epoch 4/20, metrics: {'avg_train_loss': 0.036554241781551526, 'avg_test_loss': 0.0733115528137448}
INFO:model_data_nn.py:Epoch 5/20, metrics: {'avg_train_loss': 0.03652809763977361, 'avg_test_loss': 0.07303797646878875}
INFO:model_data_nn.py:Epoch 6/20, metrics: {'avg_train_loss': 0.03650450697767804, 'avg_test_loss': 0.0735709644395878}
INFO:model_data_nn.py:Epoch 7/20, metrics: {'avg_train_loss': 0.036506683131832966, 'avg_test_loss': 0.07365512896209636}
INFO:model_data_nn.py:Epoch 8/20, metrics: {'avg_train_loss': 0.03650212510571769, 'avg_test_loss': 0.0734404425241332}
INFO:model_data_nn.py:Epoch 9/20, metrics: {'avg_train_loss': 0.036524996938852944, 'avg_test_loss': 0.07356555144835443}
INFO:model_data_nn.py:Epoch 10/20, metrics: {'avg_train_loss': 0.03650852509482746, 'avg_test_loss': 0.07334740453942575}
INFO:model_data_nn.py:Epoch 11/20, metrics: {'avg_train_loss': 0.036507243200249125, 'avg_test_loss': 0.07299454784130349}
INFO:model_data_nn.py:Epoch 12/20, metrics: {'avg_train_loss': 0.03650242789519768, 'avg_test_loss': 0.07311192065736348}
INFO:model_data_nn.py:Epoch 13/20, metrics: {'avg_train_loss': 0.0365138432345241, 'avg_test_loss': 0.07322892224924131}
INFO:model_data_nn.py:Epoch 14/20, metrics: {'avg_train_loss': 0.03651201552457743, 'avg_test_loss': 0.07357241374186495}
INFO:model_data_nn.py:Epoch 15/20, metrics: {'avg_train_loss': 0.03651260504259439, 'avg_test_loss': 0.07316911375438943}
INFO:model_data_nn.py:Epoch 16/20, metrics: {'avg_train_loss': 0.036513090866915114, 'avg_test_loss': 0.07302070425992663}
INFO:model_data_nn.py:Epoch 17/20, metrics: {'avg_train_loss': 0.036516379847779765, 'avg_test_loss': 0.07318878510000712}
INFO:model_data_nn.py:Epoch 18/20, metrics: {'avg_train_loss': 0.03650218196913815, 'avg_test_loss': 0.0729607104318824}
INFO:model_data_nn.py:Epoch 19/20, metrics: {'avg_train_loss': 0.03653588307669994, 'avg_test_loss': 0.07300222464364002}
INFO:model_data_nn.py:Epoch 20/20, metrics: {'avg_train_loss': 0.0365228445487594, 'avg_test_loss': 0.0732772780064354}
[33m(raylet)[0m [2024-07-07 10:32:00,883 E 4039824 4039824] (raylet) worker_pool.cc:565: Some workers of the worker process(4056458) have not registered within the timeout. The process is still alive, probably it's hanging during start.[32m [repeated 44x across cluster][0m
INFO:main.py:Making prediction for data in year: 2008
INFO:main.py:Prediction data shape: (47649,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:372: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2009: 0.2709066880833358
INFO:main.py:Prediction Stats:                 ret          pred
count  47649.000000  47649.000000
mean       0.047378      0.010300
std        0.269669      0.022377
min       -0.972173     -0.078659
25%       -0.069404      0.002423
50%        0.020094      0.006813
75%        0.120185      0.012837
max       15.774193      0.380229
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:transform_data_nn.py:Train_data: (1663458, 158)

INFO:transform_data_nn.py:Test data years: [2009]
INFO:transform_data_nn.py:Test_data: (47649, 158)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:transform_data_nn.py:Retrain_data: (1711107, 158)

INFO:transform_data_nn.py:Prediction data years: [2010]
INFO:transform_data_nn.py:Prediction_data: (45279, 158)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1663458, 103])
            y_train_tf: torch.Size([1663458])

            x_test_tf: torch.Size([47649, 103])
            y_test_tf: torch.Size([47649])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1711107, 103])
            y_retrain_tf: torch.Size([1711107])

            x_prediction_tf: torch.Size([45279, 103])
            y_prediction_tf: torch.Size([45279])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([ 1.8690e-01,  1.1421e+00,  8.0233e-02, -8.7104e-01, -2.8282e-03,
        -5.9865e-01, -2.6962e-02, -2.7119e-01,  7.6936e-01, -3.1127e-01,
        -7.6188e-01,  1.4299e-02, -7.3047e-01, -5.4605e-01, -4.2065e-01,
         1.0972e-02, -3.9273e-01,  1.3084e-01, -9.5426e-02,  8.6790e-01,
        -4.9538e-01, -1.5097e-01, -2.7777e-01, -2.3351e-03, -6.6347e-02,
        -2.9934e-01, -5.3475e-01, -8.5307e-02,  6.3549e-01,  1.8872e+00,
         3.7202e-01, -1.6216e-01,  9.2903e-01,  2.3365e-01, -3.4419e-01,
        -2.4352e-01,  1.5239e-01,  5.0722e-01, -2.6697e-02, -1.1150e+00,
        -2.0937e-01,  2.2394e-01,  4.8902e-01,  1.6942e-01, -6.3125e-02,
        -7.0705e-01,  7.3487e-02, -5.7148e-02, -4.7651e-01, -1.4819e-01,
        -4.4636e-01,  5.3399e-01, -4.6863e-01,  2.3538e-01, -2.2685e-02,
        -2.6245e-01, -6.8215e-01, -5.0766e-01, -5.4546e-01, -1.8295e-01,
        -2.2478e-02, -5.5239e-01, -6.4191e-01, -4.3695e-01, -3.6497e-01,
        -4.4228e-01,  1.1013e+00, -2.9181e-01, -6.9592e-01, -5.8259e-01,
        -6.4156e-01, -4.5305e-01, -1.1480e-04, -8.5712e-01,  2.9132e-01,
        -6.5971e-01,  3.2046e-01,  3.8284e-01,  8.8625e-01,  8.6232e-01,
        -1.2863e+00,  2.3439e-01,  2.9738e-03, -5.6038e-01, -1.0313e-01,
         4.4223e-01, -1.3092e-01, -8.5844e-01, -7.4835e-01, -8.9201e-01,
         1.0751e-01,  6.4897e-03,  4.4255e-02, -5.1189e-01, -4.9575e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([11425]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-3.0210e-01,  7.4826e-01,  7.0292e-01,  1.0314e+00, -6.0386e-01,
        -8.6000e-02, -4.6891e-02, -2.8647e-01, -2.9663e-01, -2.2129e-01,
        -6.6110e-01, -6.1696e-02, -4.3043e-01, -1.8832e-01, -3.9922e-01,
        -1.6665e+00, -4.8022e-01, -5.9282e-01, -9.5426e-02, -2.2727e-01,
        -9.1869e-01, -1.8136e-01, -5.2895e-01, -9.2532e-01,  3.6788e-01,
        -1.9649e-01, -5.8272e-01, -8.5307e-02, -3.8034e-01,  7.2132e-01,
        -4.8192e-01, -3.4665e-02,  3.1533e-01,  2.3365e-01, -7.5196e-01,
        -5.0768e-01, -1.6543e+00, -6.8458e-01, -9.3330e-01, -5.7504e-01,
        -1.7047e-01, -1.3148e+00, -1.6104e+00, -4.2375e-01, -6.2226e-01,
         8.3219e-02, -5.9967e-01,  9.1125e-01,  2.2681e-01, -1.0106e+00,
        -1.7201e+00,  3.8712e-01, -4.6863e-01, -1.1322e+00, -7.7525e-01,
        -6.1915e-01,  1.9998e-02, -6.3310e-01,  1.0006e+00, -2.6880e-01,
         5.3985e-01,  1.1098e+00, -8.7979e-01, -4.4545e-01, -2.1724e-02,
        -6.2983e-01,  6.7154e-01, -2.6155e-01,  5.0006e-01, -2.7041e-01,
        -5.2206e-03,  6.9086e-02, -1.1480e-04,  2.5228e-02, -4.1230e-03,
        -2.7578e-01, -6.5138e-02,  4.6764e-01, -2.1679e-01,  3.4514e-01,
         6.6728e-01,  1.3461e+00,  2.9738e-03, -5.6038e-01, -8.3580e-01,
        -2.4543e-01, -7.3550e-02, -6.6621e-01, -6.0691e-01, -8.0740e-01,
        -2.9751e-01,  1.1173e-01,  2.7601e-01, -5.0994e-01, -4.9575e-01,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([1087]), tensor(0.0341))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([ 1.8724e-01,  1.1521e+00,  8.3052e-02, -8.8464e-01,  1.7334e-03,
        -6.0776e-01, -2.5374e-02, -2.6879e-01,  7.5094e-01, -3.1461e-01,
        -7.6230e-01,  1.8285e-02, -7.2854e-01, -5.5213e-01, -4.1626e-01,
         1.2064e-02, -3.8838e-01,  1.3333e-01, -9.8856e-02,  8.7936e-01,
        -4.9258e-01, -1.5753e-01, -2.8399e-01,  4.0477e-03, -6.4644e-02,
        -2.9976e-01, -5.3607e-01, -9.7856e-02,  6.3678e-01,  1.8618e+00,
         3.5946e-01, -1.5771e-01,  9.2541e-01,  2.3891e-01, -3.3766e-01,
        -2.4198e-01,  1.5730e-01,  5.1368e-01, -2.3466e-02, -1.1199e+00,
        -2.0449e-01,  2.5155e-01,  4.9704e-01,  1.6330e-01, -6.0938e-02,
        -7.0889e-01,  9.0147e-02, -6.1672e-02, -4.6223e-01, -1.4574e-01,
        -4.5334e-01,  5.3607e-01, -4.6847e-01,  2.3062e-01, -1.6033e-02,
        -2.5743e-01, -6.7029e-01, -4.9843e-01, -5.4563e-01, -1.8212e-01,
        -1.9559e-02, -5.5277e-01, -6.3537e-01, -4.3765e-01, -3.6520e-01,
        -4.4164e-01,  1.1203e+00, -2.9036e-01, -7.0336e-01, -5.8382e-01,
        -6.1710e-01, -4.5790e-01, -1.1488e-03, -8.6241e-01,  2.9617e-01,
        -6.5682e-01,  3.2165e-01,  3.8364e-01,  8.9094e-01,  8.6990e-01,
        -1.2946e+00,  2.3082e-01,  3.1893e-03, -5.6476e-01, -1.0011e-01,
         4.4460e-01, -1.1270e-01, -8.6233e-01, -7.5981e-01, -8.9042e-01,
         1.1006e-01,  1.2610e-02,  4.5698e-02, -5.1904e-01, -4.9002e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([11515]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([ 3.2397e+00,  1.6675e+00, -5.5169e-01,  1.0201e+00,  7.2787e-01,
        -2.8604e-01, -4.7657e-01, -5.6648e-01,  2.2260e-01, -1.6943e-01,
        -2.6106e-01,  3.4534e-03, -7.2854e-01, -7.5005e-01, -4.7487e-01,
         1.3710e+00,  1.1504e+00,  1.2412e+00, -9.8856e-02,  1.2379e+00,
         6.8457e-01, -1.8392e-01,  4.9057e-01,  5.8556e-01,  1.2524e-01,
        -7.2357e-01, -5.8569e-01, -9.7856e-02, -2.5540e-01,  5.0406e-03,
         1.9212e-01,  2.5919e-01,  5.7130e-01,  2.3891e-01, -5.7578e-01,
         4.8479e+00,  8.0620e-01, -6.2863e-01,  1.1680e+00, -4.8722e-01,
        -2.0221e-01, -7.3679e-02,  8.4001e-01, -1.9318e-01,  4.1453e-01,
         5.9873e-01, -3.7817e-01,  9.3520e-01,  2.6933e-01,  1.2601e-02,
        -4.5334e-01,  5.3607e-01, -4.6847e-01, -1.1307e+00, -7.7245e-01,
        -5.1204e-01,  1.9464e-02,  2.4699e+00, -1.1385e+00, -2.6815e-01,
        -5.0165e-01, -9.9644e-01, -1.1791e+00, -1.5106e+00, -2.0462e-02,
        -5.2399e-01,  2.7508e+00, -3.2352e-01, -1.3020e+00, -6.4922e-01,
        -2.1238e-02,  7.9240e-02, -1.1488e-03,  1.2620e-01,  2.5921e-01,
        -3.3245e-01,  1.8153e-01,  3.7232e-01, -1.1218e+00,  8.6990e-01,
        -4.0677e-02,  1.3464e+00,  3.1893e-03, -5.6476e-01,  4.4320e-01,
         2.1093e-01,  6.0577e-01,  2.2651e+00, -6.0672e-01, -8.0401e-01,
         3.0722e-01, -6.0080e-01, -2.5447e-01, -5.9396e-02, -4.9002e-01,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([1007]), tensor(-0.0189))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008]
INFO:main.py:Testing data year: 2009
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 60
            max_num_epochs: 20
            num_cpus: 60
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 102
            num_embeddings: 17222
            device: cpu
            
2024-07-07 13:51:43,878	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-07 13:51:43,912	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-07 13:51:43,945	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_fadad946ef373469.zip' (1.20MiB) to Ray cluster...
2024-07-07 13:51:43,949	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_fadad946ef373469.zip'.
2024-07-07 13:51:50,373	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-07 14:30:49,515	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-07_13-51-50' in 0.1528s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 102, 'hidden_dim': 105, 'num_layers': 3, 'num_embeddings': 17222, 'embedding_dim': 25, 'dropout_rate': 0.3346021063413328, 'lr': 0.000133112160807369, 'weight_decay': 1.152798712823241e-06, 'num_epochs': 20, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03623014699871786
INFO:model_data_nn.py:Best trial testing loss: 0.07240931348586306
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-07_13-51-40_972754_2505436/artifacts/2024-07-07_13-51-50/train_fnn_2024-07-07_13-51-50/driver_artifacts/train_fnn_0f5be_00001_1_dropout_rate=0.3346,embedding_dim=25,hidden_dim=105,lr=0.0001,num_layers=3,weight_decay=0.0000_2024-07-07_13-51-50
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]

            Using the optimized hyperparameters: {'continuous_dim': 102, 'hidden_dim': 105, 'num_layers': 3, 'num_embeddings': 17351, 'embedding_dim': 25, 'dropout_rate': 0.3346021063413328, 'lr': 0.000133112160807369, 'weight_decay': 1.152798712823241e-06, 'num_epochs': 20, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/20, metrics: {'avg_train_loss': 8.854082360253207, 'avg_test_loss': 0.027512699815492005}
INFO:model_data_nn.py:Epoch 2/20, metrics: {'avg_train_loss': 0.03837386814608512, 'avg_test_loss': 0.025435593442223167}
INFO:model_data_nn.py:Epoch 3/20, metrics: {'avg_train_loss': 0.03806034587532638, 'avg_test_loss': 0.025313621410563335}
INFO:model_data_nn.py:Epoch 4/20, metrics: {'avg_train_loss': 0.037924114703399285, 'avg_test_loss': 0.025453103369491248}
INFO:model_data_nn.py:Epoch 5/20, metrics: {'avg_train_loss': 0.0377964473909036, 'avg_test_loss': 0.025674866680792496}
INFO:model_data_nn.py:Epoch 6/20, metrics: {'avg_train_loss': 0.03772161652249749, 'avg_test_loss': 0.025445435964370853}
INFO:model_data_nn.py:Epoch 7/20, metrics: {'avg_train_loss': 0.037655575747867084, 'avg_test_loss': 0.025456464202222178}
INFO:model_data_nn.py:Epoch 8/20, metrics: {'avg_train_loss': 0.03763812043890078, 'avg_test_loss': 0.025541986144110983}
INFO:model_data_nn.py:Epoch 9/20, metrics: {'avg_train_loss': 0.03756997181352008, 'avg_test_loss': 0.025616567650294235}
INFO:model_data_nn.py:Epoch 10/20, metrics: {'avg_train_loss': 0.0375203998805363, 'avg_test_loss': 0.026046543334752828}
INFO:model_data_nn.py:Epoch 11/20, metrics: {'avg_train_loss': 0.03746982402375097, 'avg_test_loss': 0.025603680187404828}
INFO:model_data_nn.py:Epoch 12/20, metrics: {'avg_train_loss': 0.037452890991429025, 'avg_test_loss': 0.025603272383874755}
INFO:model_data_nn.py:Epoch 13/20, metrics: {'avg_train_loss': 0.0374063362571548, 'avg_test_loss': 0.025517115964012294}
INFO:model_data_nn.py:Epoch 14/20, metrics: {'avg_train_loss': 0.03738258029135723, 'avg_test_loss': 0.025527791851489557}
INFO:model_data_nn.py:Epoch 15/20, metrics: {'avg_train_loss': 0.037344383516905465, 'avg_test_loss': 0.025487170765165892}
INFO:model_data_nn.py:Epoch 16/20, metrics: {'avg_train_loss': 0.03732661167034293, 'avg_test_loss': 0.02557722457531987}
INFO:model_data_nn.py:Epoch 17/20, metrics: {'avg_train_loss': 0.0373118378252638, 'avg_test_loss': 0.025673297544320423}
INFO:model_data_nn.py:Epoch 18/20, metrics: {'avg_train_loss': 0.03727764883980701, 'avg_test_loss': 0.02558126877256706}
INFO:model_data_nn.py:Epoch 19/20, metrics: {'avg_train_loss': 0.03726366540708244, 'avg_test_loss': 0.02561276589946474}
INFO:model_data_nn.py:Epoch 20/20, metrics: {'avg_train_loss': 0.03723002488327142, 'avg_test_loss': 0.025402243057065933}
INFO:main.py:Making prediction for data in year: 2009
INFO:main.py:Prediction data shape: (45279,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:372: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2010: 0.1593334617174221
INFO:main.py:Prediction Stats:                 ret          pred
count  45279.000000  45279.000000
mean       0.023917      0.016281
std        0.158912      0.017476
min       -0.895194     -0.126276
25%       -0.056851      0.008083
50%        0.015071      0.012022
75%        0.089030      0.019382
max        6.107143      0.258665
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:transform_data_nn.py:Train_data: (1711107, 158)

INFO:transform_data_nn.py:Test data years: [2010]
INFO:transform_data_nn.py:Test_data: (45279, 158)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:transform_data_nn.py:Retrain_data: (1756386, 158)

INFO:transform_data_nn.py:Prediction data years: [2011]
INFO:transform_data_nn.py:Prediction_data: (43382, 158)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1711107, 103])
            y_train_tf: torch.Size([1711107])

            x_test_tf: torch.Size([45279, 103])
            y_test_tf: torch.Size([45279])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1756386, 103])
            y_retrain_tf: torch.Size([1756386])

            x_prediction_tf: torch.Size([43382, 103])
            y_prediction_tf: torch.Size([43382])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([ 1.8724e-01,  1.1521e+00,  8.3052e-02, -8.8464e-01,  1.7334e-03,
        -6.0776e-01, -2.5374e-02, -2.6879e-01,  7.5094e-01, -3.1461e-01,
        -7.6230e-01,  1.8285e-02, -7.2854e-01, -5.5213e-01, -4.1626e-01,
         1.2064e-02, -3.8838e-01,  1.3333e-01, -9.8856e-02,  8.7936e-01,
        -4.9258e-01, -1.5753e-01, -2.8399e-01,  4.0477e-03, -6.4644e-02,
        -2.9976e-01, -5.3607e-01, -9.7856e-02,  6.3678e-01,  1.8618e+00,
         3.5946e-01, -1.5771e-01,  9.2541e-01,  2.3891e-01, -3.3766e-01,
        -2.4198e-01,  1.5730e-01,  5.1368e-01, -2.3466e-02, -1.1199e+00,
        -2.0449e-01,  2.5155e-01,  4.9704e-01,  1.6330e-01, -6.0938e-02,
        -7.0889e-01,  9.0147e-02, -6.1672e-02, -4.6223e-01, -1.4574e-01,
        -4.5334e-01,  5.3607e-01, -4.6847e-01,  2.3062e-01, -1.6033e-02,
        -2.5743e-01, -6.7029e-01, -4.9843e-01, -5.4563e-01, -1.8212e-01,
        -1.9559e-02, -5.5277e-01, -6.3537e-01, -4.3765e-01, -3.6520e-01,
        -4.4164e-01,  1.1203e+00, -2.9036e-01, -7.0336e-01, -5.8382e-01,
        -6.1710e-01, -4.5790e-01, -1.1488e-03, -8.6241e-01,  2.9617e-01,
        -6.5682e-01,  3.2165e-01,  3.8364e-01,  8.9094e-01,  8.6990e-01,
        -1.2946e+00,  2.3082e-01,  3.1893e-03, -5.6476e-01, -1.0011e-01,
         4.4460e-01, -1.1270e-01, -8.6233e-01, -7.5981e-01, -8.9042e-01,
         1.1006e-01,  1.2610e-02,  4.5698e-02, -5.1904e-01, -4.9002e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([11515]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([ 3.2397e+00,  1.6675e+00, -5.5169e-01,  1.0201e+00,  7.2787e-01,
        -2.8604e-01, -4.7657e-01, -5.6648e-01,  2.2260e-01, -1.6943e-01,
        -2.6106e-01,  3.4534e-03, -7.2854e-01, -7.5005e-01, -4.7487e-01,
         1.3710e+00,  1.1504e+00,  1.2412e+00, -9.8856e-02,  1.2379e+00,
         6.8457e-01, -1.8392e-01,  4.9057e-01,  5.8556e-01,  1.2524e-01,
        -7.2357e-01, -5.8569e-01, -9.7856e-02, -2.5540e-01,  5.0406e-03,
         1.9212e-01,  2.5919e-01,  5.7130e-01,  2.3891e-01, -5.7578e-01,
         4.8479e+00,  8.0620e-01, -6.2863e-01,  1.1680e+00, -4.8722e-01,
        -2.0221e-01, -7.3679e-02,  8.4001e-01, -1.9318e-01,  4.1453e-01,
         5.9873e-01, -3.7817e-01,  9.3520e-01,  2.6933e-01,  1.2601e-02,
        -4.5334e-01,  5.3607e-01, -4.6847e-01, -1.1307e+00, -7.7245e-01,
        -5.1204e-01,  1.9464e-02,  2.4699e+00, -1.1385e+00, -2.6815e-01,
        -5.0165e-01, -9.9644e-01, -1.1791e+00, -1.5106e+00, -2.0462e-02,
        -5.2399e-01,  2.7508e+00, -3.2352e-01, -1.3020e+00, -6.4922e-01,
        -2.1238e-02,  7.9240e-02, -1.1488e-03,  1.2620e-01,  2.5921e-01,
        -3.3245e-01,  1.8153e-01,  3.7232e-01, -1.1218e+00,  8.6990e-01,
        -4.0677e-02,  1.3464e+00,  3.1893e-03, -5.6476e-01,  4.4320e-01,
         2.1093e-01,  6.0577e-01,  2.2651e+00, -6.0672e-01, -8.0401e-01,
         3.0722e-01, -6.0080e-01, -2.5447e-01, -5.9396e-02, -4.9002e-01,
         0.0000e+00,  0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([1007]), tensor(-0.0189))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([ 0.1831,  1.1625,  0.0818, -0.8994,  0.0108, -0.6084, -0.0243, -0.2668,
         0.7264, -0.3217, -0.7651,  0.0236, -0.7243, -0.5588, -0.4120,  0.0159,
        -0.3845,  0.1364, -0.0965,  0.8932, -0.4842, -0.1642, -0.2846,  0.0037,
        -0.0670, -0.3000, -0.5374, -0.1001,  0.6373,  1.8420,  0.3591, -0.1522,
         0.9227,  0.2436, -0.3300, -0.2350,  0.1701,  0.5188, -0.0163, -1.1251,
        -0.2031,  0.2192,  0.5097,  0.1550, -0.0548, -0.7089,  0.0758, -0.0635,
        -0.4383, -0.1471, -0.4593,  0.5378, -0.4681,  0.2261, -0.0155, -0.2520,
        -0.6596, -0.4952, -0.5474, -0.1828, -0.0174, -0.5550, -0.6270, -0.4377,
        -0.3626, -0.4399,  1.1373, -0.2880, -0.7095, -0.5849, -0.6094, -0.4578,
        -0.0019, -0.8632,  0.2971, -0.6517,  0.3183,  0.3837,  0.9002,  0.8781,
        -1.3003,  0.2265,  0.0031, -0.6612, -0.0927,  0.4436, -0.0931, -0.8653,
        -0.7727, -0.8867,  0.1038,  0.0181,  0.0405, -0.5255, -0.4821,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([11581]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([ 2.8161e-01, -8.0153e-01, -7.7226e-01,  1.0094e+00, -2.9500e-01,
        -6.2245e-01, -5.1555e-01, -5.8651e-01,  1.2629e-01, -3.0231e-01,
        -4.8811e-01,  1.6422e-01, -7.2426e-01,  6.0292e-01, -2.8125e-01,
        -1.8932e+00, -3.4719e-01,  1.4828e+00, -9.6526e-02, -1.3091e+00,
        -2.8033e-01, -1.8995e-01,  4.5158e+00, -4.6807e-01, -9.2884e-01,
        -7.6814e-01, -5.9652e-01, -1.0008e-01,  6.3726e-01,  1.3273e+00,
        -3.3931e-01,  1.2198e-02,  9.1534e-01,  2.4364e-01, -6.7351e-01,
         9.0371e-01,  3.9899e-01, -5.6320e-01,  1.0636e+00, -3.9699e-01,
        -2.0315e-01, -1.6593e-01, -2.0932e-01, -3.1921e-01, -4.0969e-01,
        -8.2697e-01, -2.0818e-01,  2.5825e-01, -1.7224e-01, -3.0121e-01,
         1.7520e-01,  5.3782e-01, -4.6814e-01, -1.1314e+00, -7.7392e-01,
        -5.3478e-01,  1.8390e-02, -6.2774e-01, -3.3717e-01, -3.6269e-01,
         9.3020e-01, -9.9893e-02,  6.0431e-01, -1.5223e+00, -1.8463e-02,
         3.2867e-01, -4.6031e-01, -3.9294e-01,  1.6864e+00, -6.3794e-01,
        -6.0952e-03,  8.5008e-02, -1.8605e-03, -1.0238e+00,  1.2740e-01,
        -2.0793e-01,  5.8259e-02,  5.1348e-01,  3.1847e-01,  7.1081e-01,
         8.0898e-01,  2.2901e-01,  3.0855e-03, -6.6124e-01, -6.6569e-01,
        -1.5839e-01, -9.1192e-01, -4.7850e-01, -6.1523e-01, -7.9933e-01,
         1.2748e-03, -2.1975e-01,  5.9573e-01, -1.1947e-01, -4.8214e-01,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([967]), tensor(0.0290))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009]
INFO:main.py:Testing data year: 2010
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 60
            max_num_epochs: 20
            num_cpus: 60
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 102
            num_embeddings: 17351
            device: cpu
            
2024-07-07 17:11:04,305	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-07 17:11:04,338	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-07 17:11:04,364	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_fadad946ef373469.zip' (1.20MiB) to Ray cluster...
2024-07-07 17:11:04,369	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_fadad946ef373469.zip'.
2024-07-07 17:11:11,048	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-07 18:00:02,334	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-07_17-11-11' in 0.1242s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 102, 'hidden_dim': 155, 'num_layers': 5, 'num_embeddings': 17351, 'embedding_dim': 10, 'dropout_rate': 0.4470550239583974, 'lr': 0.0002693643916317943, 'weight_decay': 0.00039922428866315094, 'num_epochs': 20, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03753900173410673
INFO:model_data_nn.py:Best trial testing loss: 0.02534105530597985
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-07_17-11-01_427249_2505436/artifacts/2024-07-07_17-11-11/train_fnn_2024-07-07_17-11-11/driver_artifacts/train_fnn_e87a1_00041_41_dropout_rate=0.4471,embedding_dim=10,hidden_dim=155,lr=0.0003,num_layers=5,weight_decay=0.0004_2024-07-07_17-11-11
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]

            Using the optimized hyperparameters: {'continuous_dim': 102, 'hidden_dim': 155, 'num_layers': 5, 'num_embeddings': 17463, 'embedding_dim': 10, 'dropout_rate': 0.4470550239583974, 'lr': 0.0002693643916317943, 'weight_decay': 0.00039922428866315094, 'num_epochs': 20, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/20, metrics: {'avg_train_loss': 6.73371066444758, 'avg_test_loss': 0.02266438641201924}
INFO:model_data_nn.py:Epoch 2/20, metrics: {'avg_train_loss': 0.03848926396341418, 'avg_test_loss': 0.022309074194773154}
INFO:model_data_nn.py:Epoch 3/20, metrics: {'avg_train_loss': 0.03785237084654473, 'avg_test_loss': 0.02190918575369698}
INFO:model_data_nn.py:Epoch 4/20, metrics: {'avg_train_loss': 0.03728491047335086, 'avg_test_loss': 0.021920841513201596}
INFO:model_data_nn.py:Epoch 5/20, metrics: {'avg_train_loss': 0.03723754037270422, 'avg_test_loss': 0.021838990198996138}
INFO:model_data_nn.py:Epoch 6/20, metrics: {'avg_train_loss': 0.037232720148132704, 'avg_test_loss': 0.021870088259525158}
INFO:model_data_nn.py:Epoch 7/20, metrics: {'avg_train_loss': 0.037232565843823125, 'avg_test_loss': 0.021751509119263466}
INFO:model_data_nn.py:Epoch 8/20, metrics: {'avg_train_loss': 0.03724072587286361, 'avg_test_loss': 0.021856259338229017}
INFO:model_data_nn.py:Epoch 9/20, metrics: {'avg_train_loss': 0.0372295511837339, 'avg_test_loss': 0.021866230143453267}
INFO:model_data_nn.py:Epoch 10/20, metrics: {'avg_train_loss': 0.03723865575575869, 'avg_test_loss': 0.021787162883864605}
INFO:model_data_nn.py:Epoch 11/20, metrics: {'avg_train_loss': 0.037242163333353895, 'avg_test_loss': 0.021963448337662745}
INFO:model_data_nn.py:Epoch 12/20, metrics: {'avg_train_loss': 0.03723397252587375, 'avg_test_loss': 0.021839316293378087}
INFO:model_data_nn.py:Epoch 13/20, metrics: {'avg_train_loss': 0.037225088186593557, 'avg_test_loss': 0.02184006777482436}
INFO:model_data_nn.py:Epoch 14/20, metrics: {'avg_train_loss': 0.037240189614311685, 'avg_test_loss': 0.02179113689207417}
INFO:model_data_nn.py:Epoch 15/20, metrics: {'avg_train_loss': 0.03723298811981276, 'avg_test_loss': 0.02185497034669799}
INFO:model_data_nn.py:Epoch 16/20, metrics: {'avg_train_loss': 0.03723047869455087, 'avg_test_loss': 0.02179187171928146}
INFO:model_data_nn.py:Epoch 17/20, metrics: {'avg_train_loss': 0.037233181693465615, 'avg_test_loss': 0.021791758996379727}
INFO:model_data_nn.py:Epoch 18/20, metrics: {'avg_train_loss': 0.037225148174436645, 'avg_test_loss': 0.021852948828874265}
INFO:model_data_nn.py:Epoch 19/20, metrics: {'avg_train_loss': 0.03723445872376723, 'avg_test_loss': 0.02182777023545521}
INFO:model_data_nn.py:Epoch 20/20, metrics: {'avg_train_loss': 0.03721840609480746, 'avg_test_loss': 0.02195089781547294}
INFO:main.py:Making prediction for data in year: 2010
INFO:main.py:Prediction data shape: (43382,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:372: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2011: 0.14816711164969762
INFO:main.py:Prediction Stats:                 ret          pred
count  43382.000000  43382.000000
mean      -0.005575      0.012855
std        0.147037      0.007582
min       -0.935356     -0.000039
25%       -0.074153      0.008901
50%       -0.008511      0.011870
75%        0.050931      0.014936
max        3.993939      0.199849
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:transform_data_nn.py:Train_data: (1756386, 158)

INFO:transform_data_nn.py:Test data years: [2011]
INFO:transform_data_nn.py:Test_data: (43382, 158)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:transform_data_nn.py:Retrain_data: (1799768, 158)

INFO:transform_data_nn.py:Prediction data years: [2012]
INFO:transform_data_nn.py:Prediction_data: (42071, 158)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1756386, 103])
            y_train_tf: torch.Size([1756386])

            x_test_tf: torch.Size([43382, 103])
            y_test_tf: torch.Size([43382])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1799768, 103])
            y_retrain_tf: torch.Size([1799768])

            x_prediction_tf: torch.Size([42071, 103])
            y_prediction_tf: torch.Size([42071])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([ 0.1831,  1.1625,  0.0818, -0.8994,  0.0108, -0.6084, -0.0243, -0.2668,
         0.7264, -0.3217, -0.7651,  0.0236, -0.7243, -0.5588, -0.4120,  0.0159,
        -0.3845,  0.1364, -0.0965,  0.8932, -0.4842, -0.1642, -0.2846,  0.0037,
        -0.0670, -0.3000, -0.5374, -0.1001,  0.6373,  1.8420,  0.3591, -0.1522,
         0.9227,  0.2436, -0.3300, -0.2350,  0.1701,  0.5188, -0.0163, -1.1251,
        -0.2031,  0.2192,  0.5097,  0.1550, -0.0548, -0.7089,  0.0758, -0.0635,
        -0.4383, -0.1471, -0.4593,  0.5378, -0.4681,  0.2261, -0.0155, -0.2520,
        -0.6596, -0.4952, -0.5474, -0.1828, -0.0174, -0.5550, -0.6270, -0.4377,
        -0.3626, -0.4399,  1.1373, -0.2880, -0.7095, -0.5849, -0.6094, -0.4578,
        -0.0019, -0.8632,  0.2971, -0.6517,  0.3183,  0.3837,  0.9002,  0.8781,
        -1.3003,  0.2265,  0.0031, -0.6612, -0.0927,  0.4436, -0.0931, -0.8653,
        -0.7727, -0.8867,  0.1038,  0.0181,  0.0405, -0.5255, -0.4821,  0.0000,
         0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]), tensor([11581]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([ 2.8161e-01, -8.0153e-01, -7.7226e-01,  1.0094e+00, -2.9500e-01,
        -6.2245e-01, -5.1555e-01, -5.8651e-01,  1.2629e-01, -3.0231e-01,
        -4.8811e-01,  1.6422e-01, -7.2426e-01,  6.0292e-01, -2.8125e-01,
        -1.8932e+00, -3.4719e-01,  1.4828e+00, -9.6526e-02, -1.3091e+00,
        -2.8033e-01, -1.8995e-01,  4.5158e+00, -4.6807e-01, -9.2884e-01,
        -7.6814e-01, -5.9652e-01, -1.0008e-01,  6.3726e-01,  1.3273e+00,
        -3.3931e-01,  1.2198e-02,  9.1534e-01,  2.4364e-01, -6.7351e-01,
         9.0371e-01,  3.9899e-01, -5.6320e-01,  1.0636e+00, -3.9699e-01,
        -2.0315e-01, -1.6593e-01, -2.0932e-01, -3.1921e-01, -4.0969e-01,
        -8.2697e-01, -2.0818e-01,  2.5825e-01, -1.7224e-01, -3.0121e-01,
         1.7520e-01,  5.3782e-01, -4.6814e-01, -1.1314e+00, -7.7392e-01,
        -5.3478e-01,  1.8390e-02, -6.2774e-01, -3.3717e-01, -3.6269e-01,
         9.3020e-01, -9.9893e-02,  6.0431e-01, -1.5223e+00, -1.8463e-02,
         3.2867e-01, -4.6031e-01, -3.9294e-01,  1.6864e+00, -6.3794e-01,
        -6.0952e-03,  8.5008e-02, -1.8605e-03, -1.0238e+00,  1.2740e-01,
        -2.0793e-01,  5.8259e-02,  5.1348e-01,  3.1847e-01,  7.1081e-01,
         8.0898e-01,  2.2901e-01,  3.0855e-03, -6.6124e-01, -6.6569e-01,
        -1.5839e-01, -9.1192e-01, -4.7850e-01, -6.1523e-01, -7.9933e-01,
         1.2748e-03, -2.1975e-01,  5.9573e-01, -1.1947e-01, -4.8214e-01,
         0.0000e+00,  1.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([967]), tensor(0.0290))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([ 1.8589e-01,  1.1735e+00,  8.0941e-02, -9.1393e-01,  1.5379e-02,
        -6.0864e-01, -2.3766e-02, -2.6541e-01,  7.2696e-01, -3.2444e-01,
        -7.6776e-01,  2.3507e-02, -7.2299e-01, -5.6569e-01, -4.0751e-01,
         1.5850e-02, -3.8151e-01,  1.3726e-01, -9.6235e-02,  9.0440e-01,
        -4.8213e-01, -1.6605e-01, -2.8001e-01,  2.6310e-03, -6.9560e-02,
        -3.0035e-01, -5.3734e-01, -1.0247e-01,  6.3661e-01,  1.8442e+00,
         3.5980e-01, -1.5169e-01,  9.2501e-01,  2.4799e-01, -3.2446e-01,
        -2.2625e-01,  1.7731e-01,  5.2335e-01, -1.2044e-02, -1.1278e+00,
        -2.0226e-01,  2.1777e-01,  5.2165e-01,  1.5136e-01, -4.9787e-02,
        -7.0872e-01,  7.4493e-02, -6.2192e-02, -4.2939e-01, -1.4795e-01,
        -4.6389e-01,  5.3809e-01, -4.6831e-01,  2.2733e-01, -1.5202e-02,
        -2.4817e-01, -6.5005e-01, -4.9303e-01, -5.4895e-01, -1.8142e-01,
        -2.0770e-02, -5.5709e-01, -6.2199e-01, -4.3646e-01, -3.6346e-01,
        -4.3844e-01,  1.1528e+00, -2.8583e-01, -7.1968e-01, -5.8637e-01,
        -6.1041e-01, -4.5657e-01, -1.5750e-03, -8.6430e-01,  2.9607e-01,
        -6.4794e-01,  3.1600e-01,  3.8123e-01,  9.0591e-01,  8.8688e-01,
        -1.3037e+00,  2.2382e-01,  2.7995e-03, -7.4243e-01, -8.7401e-02,
         4.5022e-01, -7.5117e-02, -8.6803e-01, -7.8151e-01, -8.8242e-01,
         1.0081e-01,  2.2538e-02,  3.5798e-02, -5.3232e-01, -4.7651e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([11682]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-8.9045e-01,  1.5817e-01, -1.0820e-01,  9.9872e-01,  1.3148e+00,
        -6.2384e-01, -1.2062e+00, -8.3437e-01,  2.2784e-01, -2.1396e-01,
        -3.0111e-01,  1.1583e-01, -7.2299e-01,  2.1855e-02, -3.6150e-01,
        -3.7485e-01,  2.3208e+00,  4.1941e-01, -2.7571e-02, -3.7366e-02,
        -3.2665e-01, -1.9238e-01, -1.8168e-01, -7.2120e-02,  5.5281e-01,
        -7.1034e-01, -5.9454e-01, -1.0247e-01,  1.8279e-01,  9.1578e-01,
         1.3376e-01,  1.3905e+00,  4.1814e-01,  2.4799e-01, -5.3499e-01,
        -6.9450e-01,  2.5132e+00, -5.6764e-01,  3.8435e-02, -8.1370e-01,
        -2.0075e-01,  1.0546e-01,  2.3456e+00, -3.9557e-01,  2.7362e-01,
        -8.2375e-01, -1.0512e-01,  2.5815e-01, -2.3942e-01, -2.5102e-01,
        -4.6389e-01,  5.3809e-01, -4.6831e-01, -8.4392e-01, -7.7374e-01,
        -4.9892e-01,  1.7833e-02, -6.2596e-01,  1.3173e-01, -2.2922e-01,
         1.0223e-01,  2.2804e-01,  2.7109e-01, -7.0330e-01, -2.1701e-02,
        -1.0038e-01, -2.4372e-01, -9.9021e-01,  1.0748e+00, -5.6244e-01,
        -4.0598e-03,  8.2285e-02, -1.5750e-03, -9.8925e-01,  1.0324e-01,
        -1.9968e-01,  2.3686e-02,  2.9274e-01,  1.2931e-02, -2.8671e-02,
         8.0811e-01, -8.7091e-02,  2.7995e-03,  8.6427e-01,  1.1663e-01,
        -3.6834e-01, -5.5767e-01, -8.6072e-01, -6.4360e-01, -8.0586e-01,
         6.7798e-02, -2.5688e-01, -2.6290e-01, -6.0743e-01, -4.7651e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([931]), tensor(-0.0197))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
INFO:main.py:Testing data year: 2011
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 60
            max_num_epochs: 20
            num_cpus: 60
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 102
            num_embeddings: 17463
            device: cpu
            
2024-07-07 20:49:13,467	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-07 20:49:14,046	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-07 20:49:14,076	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_fadad946ef373469.zip' (1.20MiB) to Ray cluster...
2024-07-07 20:49:14,082	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_fadad946ef373469.zip'.
2024-07-07 20:49:20,275	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-07 21:20:32,086	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-07_20-49-20' in 0.1459s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 102, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 17463, 'embedding_dim': 25, 'dropout_rate': 0.041424541574559555, 'lr': 0.0005567255883122288, 'weight_decay': 2.1235216307804848e-05, 'num_epochs': 20, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.036740527506344885
INFO:model_data_nn.py:Best trial testing loss: 0.02171313743764425
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-07_20-49-09_934260_2505436/artifacts/2024-07-07_20-49-20/train_fnn_2024-07-07_20-49-20/driver_artifacts/train_fnn_6243b_00048_48_dropout_rate=0.0414,embedding_dim=25,hidden_dim=85,lr=0.0006,num_layers=4,weight_decay=0.0000_2024-07-07_20-49-20
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]

            Using the optimized hyperparameters: {'continuous_dim': 102, 'hidden_dim': 85, 'num_layers': 4, 'num_embeddings': 17619, 'embedding_dim': 25, 'dropout_rate': 0.041424541574559555, 'lr': 0.0005567255883122288, 'weight_decay': 2.1235216307804848e-05, 'num_epochs': 20, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/20, metrics: {'avg_train_loss': 0.7726868893516711, 'avg_test_loss': 0.02126104472148599}
INFO:model_data_nn.py:Epoch 2/20, metrics: {'avg_train_loss': 0.037869625821679964, 'avg_test_loss': 0.020909377929726334}
INFO:model_data_nn.py:Epoch 3/20, metrics: {'avg_train_loss': 0.037173801842325105, 'avg_test_loss': 0.02110802245072343}
INFO:model_data_nn.py:Epoch 4/20, metrics: {'avg_train_loss': 0.03675601937384359, 'avg_test_loss': 0.020754206098729012}
INFO:model_data_nn.py:Epoch 5/20, metrics: {'avg_train_loss': 0.03661343893305139, 'avg_test_loss': 0.021011256451972507}
INFO:model_data_nn.py:Epoch 6/20, metrics: {'avg_train_loss': 0.03655181376719425, 'avg_test_loss': 0.020930775432762776}
INFO:model_data_nn.py:Epoch 7/20, metrics: {'avg_train_loss': 0.03651012706605694, 'avg_test_loss': 0.020734650043375564}
INFO:model_data_nn.py:Epoch 8/20, metrics: {'avg_train_loss': 0.036492238660219674, 'avg_test_loss': 0.020781629639818812}
INFO:model_data_nn.py:Epoch 9/20, metrics: {'avg_train_loss': 0.036478100654361405, 'avg_test_loss': 0.020819390054340615}
INFO:model_data_nn.py:Epoch 10/20, metrics: {'avg_train_loss': 0.03647434579288234, 'avg_test_loss': 0.020793114402190303}
INFO:model_data_nn.py:Epoch 11/20, metrics: {'avg_train_loss': 0.036443265489947786, 'avg_test_loss': 0.02078189578358874}
INFO:model_data_nn.py:Epoch 12/20, metrics: {'avg_train_loss': 0.036440455921279334, 'avg_test_loss': 0.02090511369716489}
INFO:model_data_nn.py:Epoch 13/20, metrics: {'avg_train_loss': 0.03641081219924503, 'avg_test_loss': 0.020900253463310727}
INFO:model_data_nn.py:Epoch 14/20, metrics: {'avg_train_loss': 0.03642289552523946, 'avg_test_loss': 0.02101156094929937}
INFO:model_data_nn.py:Epoch 15/20, metrics: {'avg_train_loss': 0.03641140815985905, 'avg_test_loss': 0.020866063677451828}
INFO:model_data_nn.py:Epoch 16/20, metrics: {'avg_train_loss': 0.036388592053691694, 'avg_test_loss': 0.02092875452486403}
INFO:model_data_nn.py:Epoch 17/20, metrics: {'avg_train_loss': 0.03641438751455379, 'avg_test_loss': 0.020928723266291797}
INFO:model_data_nn.py:Epoch 18/20, metrics: {'avg_train_loss': 0.036387943318705776, 'avg_test_loss': 0.020829908905381507}
INFO:model_data_nn.py:Epoch 19/20, metrics: {'avg_train_loss': 0.0363770321002536, 'avg_test_loss': 0.020813200524020376}
INFO:model_data_nn.py:Epoch 20/20, metrics: {'avg_train_loss': 0.036387482573122076, 'avg_test_loss': 0.020915289643700374}
INFO:main.py:Making prediction for data in year: 2011
INFO:main.py:Prediction data shape: (42071,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:372: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2012: 0.14459484943404166
INFO:main.py:Prediction Stats:                 ret          pred
count  42071.000000  42071.000000
mean       0.016327      0.012960
std        0.144590      0.013117
min       -0.830303     -0.108686
25%       -0.043616      0.007976
50%        0.010413      0.012507
75%        0.065493      0.017294
max        5.210484      0.410498
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:transform_data_nn.py:Train_data: (1799768, 158)

INFO:transform_data_nn.py:Test data years: [2012]
INFO:transform_data_nn.py:Test_data: (42071, 158)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:transform_data_nn.py:Retrain_data: (1841839, 158)

INFO:transform_data_nn.py:Prediction data years: [2013]
INFO:transform_data_nn.py:Prediction_data: (40840, 158)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1799768, 103])
            y_train_tf: torch.Size([1799768])

            x_test_tf: torch.Size([42071, 103])
            y_test_tf: torch.Size([42071])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1841839, 103])
            y_retrain_tf: torch.Size([1841839])

            x_prediction_tf: torch.Size([40840, 103])
            y_prediction_tf: torch.Size([40840])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([ 1.8589e-01,  1.1735e+00,  8.0941e-02, -9.1393e-01,  1.5379e-02,
        -6.0864e-01, -2.3766e-02, -2.6541e-01,  7.2696e-01, -3.2444e-01,
        -7.6776e-01,  2.3507e-02, -7.2299e-01, -5.6569e-01, -4.0751e-01,
         1.5850e-02, -3.8151e-01,  1.3726e-01, -9.6235e-02,  9.0440e-01,
        -4.8213e-01, -1.6605e-01, -2.8001e-01,  2.6310e-03, -6.9560e-02,
        -3.0035e-01, -5.3734e-01, -1.0247e-01,  6.3661e-01,  1.8442e+00,
         3.5980e-01, -1.5169e-01,  9.2501e-01,  2.4799e-01, -3.2446e-01,
        -2.2625e-01,  1.7731e-01,  5.2335e-01, -1.2044e-02, -1.1278e+00,
        -2.0226e-01,  2.1777e-01,  5.2165e-01,  1.5136e-01, -4.9787e-02,
        -7.0872e-01,  7.4493e-02, -6.2192e-02, -4.2939e-01, -1.4795e-01,
        -4.6389e-01,  5.3809e-01, -4.6831e-01,  2.2733e-01, -1.5202e-02,
        -2.4817e-01, -6.5005e-01, -4.9303e-01, -5.4895e-01, -1.8142e-01,
        -2.0770e-02, -5.5709e-01, -6.2199e-01, -4.3646e-01, -3.6346e-01,
        -4.3844e-01,  1.1528e+00, -2.8583e-01, -7.1968e-01, -5.8637e-01,
        -6.1041e-01, -4.5657e-01, -1.5750e-03, -8.6430e-01,  2.9607e-01,
        -6.4794e-01,  3.1600e-01,  3.8123e-01,  9.0591e-01,  8.8688e-01,
        -1.3037e+00,  2.2382e-01,  2.7995e-03, -7.4243e-01, -8.7401e-02,
         4.5022e-01, -7.5117e-02, -8.6803e-01, -7.8151e-01, -8.8242e-01,
         1.0081e-01,  2.2538e-02,  3.5798e-02, -5.3232e-01, -4.7651e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([11682]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-8.9045e-01,  1.5817e-01, -1.0820e-01,  9.9872e-01,  1.3148e+00,
        -6.2384e-01, -1.2062e+00, -8.3437e-01,  2.2784e-01, -2.1396e-01,
        -3.0111e-01,  1.1583e-01, -7.2299e-01,  2.1855e-02, -3.6150e-01,
        -3.7485e-01,  2.3208e+00,  4.1941e-01, -2.7571e-02, -3.7366e-02,
        -3.2665e-01, -1.9238e-01, -1.8168e-01, -7.2120e-02,  5.5281e-01,
        -7.1034e-01, -5.9454e-01, -1.0247e-01,  1.8279e-01,  9.1578e-01,
         1.3376e-01,  1.3905e+00,  4.1814e-01,  2.4799e-01, -5.3499e-01,
        -6.9450e-01,  2.5132e+00, -5.6764e-01,  3.8435e-02, -8.1370e-01,
        -2.0075e-01,  1.0546e-01,  2.3456e+00, -3.9557e-01,  2.7362e-01,
        -8.2375e-01, -1.0512e-01,  2.5815e-01, -2.3942e-01, -2.5102e-01,
        -4.6389e-01,  5.3809e-01, -4.6831e-01, -8.4392e-01, -7.7374e-01,
        -4.9892e-01,  1.7833e-02, -6.2596e-01,  1.3173e-01, -2.2922e-01,
         1.0223e-01,  2.2804e-01,  2.7109e-01, -7.0330e-01, -2.1701e-02,
        -1.0038e-01, -2.4372e-01, -9.9021e-01,  1.0748e+00, -5.6244e-01,
        -4.0598e-03,  8.2285e-02, -1.5750e-03, -9.8925e-01,  1.0324e-01,
        -1.9968e-01,  2.3686e-02,  2.9274e-01,  1.2931e-02, -2.8671e-02,
         8.0811e-01, -8.7091e-02,  2.7995e-03,  8.6427e-01,  1.1663e-01,
        -3.6834e-01, -5.5767e-01, -8.6072e-01, -6.4360e-01, -8.0586e-01,
         6.7798e-02, -2.5688e-01, -2.6290e-01, -6.0743e-01, -4.7651e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([931]), tensor(-0.0197))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([ 1.9239e-01,  1.1833e+00,  8.0576e-02, -9.2781e-01,  1.8095e-02,
        -6.0762e-01, -2.6023e-02, -2.6651e-01,  7.2678e-01, -3.2377e-01,
        -7.6969e-01,  2.1681e-02, -7.2205e-01, -5.7209e-01, -4.0496e-01,
         1.3690e-02, -3.7814e-01,  1.3877e-01, -9.4473e-02,  9.1201e-01,
        -4.8592e-01, -1.6573e-01, -2.7925e-01,  3.6810e-03, -7.0942e-02,
        -3.0078e-01, -5.3711e-01, -1.0404e-01,  6.3623e-01,  1.8477e+00,
         3.6054e-01, -1.5076e-01,  9.2563e-01,  2.5202e-01, -3.2058e-01,
        -2.2452e-01,  1.7943e-01,  5.2766e-01, -1.0920e-02, -1.1241e+00,
        -2.0166e-01,  2.2882e-01,  5.3005e-01,  1.4822e-01, -4.7019e-02,
        -7.0660e-01,  8.0039e-02, -6.2773e-02, -4.3464e-01, -1.4753e-01,
        -4.6803e-01,  5.3834e-01, -4.6891e-01,  2.2946e-01, -1.2632e-02,
        -2.4544e-01, -6.4096e-01, -4.8930e-01, -5.5008e-01, -1.7867e-01,
        -2.3539e-02, -5.5810e-01, -6.2076e-01, -4.3792e-01, -3.6656e-01,
        -4.3805e-01,  1.1673e+00, -2.8336e-01, -7.2951e-01, -5.8759e-01,
        -6.1129e-01, -4.5518e-01, -7.2157e-04, -8.6215e-01,  2.9566e-01,
        -6.4578e-01,  3.1415e-01,  3.7778e-01,  9.1102e-01,  8.9451e-01,
        -1.3058e+00,  2.2072e-01,  2.6512e-03, -7.8429e-01, -8.5437e-02,
         4.5608e-01, -5.9265e-02, -8.6893e-01, -7.8556e-01, -8.7784e-01,
         9.9630e-02,  2.7376e-02,  3.4327e-02, -5.3754e-01, -4.7131e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([11772]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-3.0724e-01, -3.0701e-01,  1.1624e-02,  9.8851e-01, -6.8158e-02,
        -4.2854e-01, -1.1849e+00, -8.3217e-01,  1.3971e-01, -2.7698e-01,
        -7.2725e-01, -1.2888e-02, -7.2205e-01,  1.8915e-01, -3.4202e-01,
        -8.0293e-01, -3.8631e-01,  4.8055e-01, -2.9597e-02, -6.7489e-03,
        -1.4080e-03, -1.9551e-01, -2.0342e-01, -3.6576e-01,  2.0793e-01,
        -7.8171e-01, -6.1245e-01, -1.0404e-01,  5.4686e-01,  1.1302e+00,
        -1.3025e-01, -2.5562e-01,  3.5917e-01,  2.5202e-01, -7.8760e-01,
         3.8877e-01,  6.2084e-01, -5.7370e-01,  4.4948e-01, -1.1176e+00,
        -1.9870e-01, -3.4895e-01,  6.3524e-01, -3.4901e-01,  1.0304e-02,
        -7.1607e-01, -4.5761e-01, -1.5738e-01, -1.5510e-01, -2.4850e-01,
         1.6434e-01,  5.3834e-01, -4.6891e-01, -8.4981e-01, -7.7290e-01,
        -6.8746e-01,  1.7534e-02, -6.2319e-01, -4.4494e-01, -4.8667e-01,
        -3.1980e-01, -4.9570e-01, -4.4164e-01,  4.6807e-01, -2.0140e-02,
        -3.8957e-01, -4.5454e-01,  1.5018e-01, -1.3227e-01, -6.4417e-01,
        -7.2905e-03,  8.2889e-02, -7.2157e-04, -8.1878e-01, -2.2680e-02,
        -2.3589e-01, -8.0530e-02,  2.6052e-01, -6.7815e-01,  5.1146e-01,
         8.0767e-01,  2.7445e-01,  2.6512e-03,  7.0870e-01, -2.0623e-01,
        -3.6547e-01, -8.7941e-01, -7.8198e-01, -6.7758e-01, -8.1505e-01,
        -1.4483e-01, -2.8070e-01, -6.4128e-01, -4.7327e-01, -4.7131e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([916]), tensor(0.0627))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]
INFO:main.py:Testing data year: 2012
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 60
            max_num_epochs: 20
            num_cpus: 60
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 102
            num_embeddings: 17619
            device: cpu
            
2024-07-07 23:57:33,123	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-07 23:57:33,273	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-07 23:57:33,297	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_fadad946ef373469.zip' (1.20MiB) to Ray cluster...
2024-07-07 23:57:33,301	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_fadad946ef373469.zip'.
2024-07-07 23:57:39,014	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-07 23:58:20,749	WARNING util.py:201 -- The `on_step_begin` operation took 11.306 s, which may be a performance bottleneck.
2024-07-07 23:58:55,074	WARNING util.py:201 -- The `on_step_begin` operation took 14.452 s, which may be a performance bottleneck.
2024-07-08 00:32:06,634	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-07_23-57-39' in 0.1284s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 102, 'hidden_dim': 115, 'num_layers': 3, 'num_embeddings': 17619, 'embedding_dim': 15, 'dropout_rate': 0.3917029656777133, 'lr': 0.00015382308040279015, 'weight_decay': 0.00020597335357437212, 'num_epochs': 20, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.036643417703779636
INFO:model_data_nn.py:Best trial testing loss: 0.020879957714880056
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-07_23-57-30_023547_2505436/artifacts/2024-07-07_23-57-39/train_fnn_2024-07-07_23-57-39/driver_artifacts/train_fnn_b0d63_00011_11_dropout_rate=0.3917,embedding_dim=15,hidden_dim=115,lr=0.0002,num_layers=3,weight_decay=0.0002_2024-07-07_23-57-39
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]

            Using the optimized hyperparameters: {'continuous_dim': 102, 'hidden_dim': 115, 'num_layers': 3, 'num_embeddings': 17753, 'embedding_dim': 15, 'dropout_rate': 0.3917029656777133, 'lr': 0.00015382308040279015, 'weight_decay': 0.00020597335357437212, 'num_epochs': 20, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/20, metrics: {'avg_train_loss': 6.538716100637566, 'avg_test_loss': 0.017143300754833037}
INFO:model_data_nn.py:Epoch 2/20, metrics: {'avg_train_loss': 0.0371155219368735, 'avg_test_loss': 0.017302437109174208}
INFO:model_data_nn.py:Epoch 3/20, metrics: {'avg_train_loss': 0.036927161550976445, 'avg_test_loss': 0.017400529122096487}
INFO:model_data_nn.py:Epoch 4/20, metrics: {'avg_train_loss': 0.03654571420282043, 'avg_test_loss': 0.017529196001123636}
INFO:model_data_nn.py:Epoch 5/20, metrics: {'avg_train_loss': 0.036409784597037274, 'avg_test_loss': 0.017454607965191826}
INFO:model_data_nn.py:Epoch 6/20, metrics: {'avg_train_loss': 0.03636700734638501, 'avg_test_loss': 0.01748295776487794}
INFO:model_data_nn.py:Epoch 7/20, metrics: {'avg_train_loss': 0.036327600954818885, 'avg_test_loss': 0.01747860118339304}
INFO:model_data_nn.py:Epoch 8/20, metrics: {'avg_train_loss': 0.036311246162569095, 'avg_test_loss': 0.01748354594456032}
INFO:model_data_nn.py:Epoch 9/20, metrics: {'avg_train_loss': 0.03630846029715749, 'avg_test_loss': 0.017638433864340185}
INFO:model_data_nn.py:Epoch 10/20, metrics: {'avg_train_loss': 0.036293731896624826, 'avg_test_loss': 0.017530277121113613}
INFO:model_data_nn.py:Epoch 11/20, metrics: {'avg_train_loss': 0.03629386370174478, 'avg_test_loss': 0.017437922506360337}
INFO:model_data_nn.py:Epoch 12/20, metrics: {'avg_train_loss': 0.03628907944590288, 'avg_test_loss': 0.017475675483001395}
INFO:model_data_nn.py:Epoch 13/20, metrics: {'avg_train_loss': 0.03629500204871996, 'avg_test_loss': 0.01737586402450688}
INFO:model_data_nn.py:Epoch 14/20, metrics: {'avg_train_loss': 0.0362784475871233, 'avg_test_loss': 0.017469519693986513}
INFO:model_data_nn.py:Epoch 15/20, metrics: {'avg_train_loss': 0.03627698047188854, 'avg_test_loss': 0.017399754433427006}
INFO:model_data_nn.py:Epoch 16/20, metrics: {'avg_train_loss': 0.036284788904026866, 'avg_test_loss': 0.017503335297806188}
INFO:model_data_nn.py:Epoch 17/20, metrics: {'avg_train_loss': 0.03627993759839609, 'avg_test_loss': 0.017475251719588414}
INFO:model_data_nn.py:Epoch 18/20, metrics: {'avg_train_loss': 0.0362905059413644, 'avg_test_loss': 0.017479245239519513}
INFO:model_data_nn.py:Epoch 19/20, metrics: {'avg_train_loss': 0.036280873060081466, 'avg_test_loss': 0.017472256915061733}
INFO:model_data_nn.py:Epoch 20/20, metrics: {'avg_train_loss': 0.03629399270422451, 'avg_test_loss': 0.017472632104181686}
INFO:main.py:Making prediction for data in year: 2012
INFO:main.py:Prediction data shape: (40840,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:372: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2013: 0.1321496220414542
INFO:main.py:Prediction Stats:                 ret          pred
count  40840.000000  40840.000000
mean       0.032106      0.010346
std        0.130441      0.006077
min       -0.898559     -0.071627
25%       -0.026038      0.007339
50%        0.023009      0.010124
75%        0.077113      0.013162
max        3.746377      0.113633
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:transform_data_nn.py:Train_data: (1841839, 158)

INFO:transform_data_nn.py:Test data years: [2013]
INFO:transform_data_nn.py:Test_data: (40840, 158)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:transform_data_nn.py:Retrain_data: (1882679, 158)

INFO:transform_data_nn.py:Prediction data years: [2014]
INFO:transform_data_nn.py:Prediction_data: (40537, 158)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1841839, 103])
            y_train_tf: torch.Size([1841839])

            x_test_tf: torch.Size([40840, 103])
            y_test_tf: torch.Size([40840])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1882679, 103])
            y_retrain_tf: torch.Size([1882679])

            x_prediction_tf: torch.Size([40537, 103])
            y_prediction_tf: torch.Size([40537])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([ 1.9239e-01,  1.1833e+00,  8.0576e-02, -9.2781e-01,  1.8095e-02,
        -6.0762e-01, -2.6023e-02, -2.6651e-01,  7.2678e-01, -3.2377e-01,
        -7.6969e-01,  2.1681e-02, -7.2205e-01, -5.7209e-01, -4.0496e-01,
         1.3690e-02, -3.7814e-01,  1.3877e-01, -9.4473e-02,  9.1201e-01,
        -4.8592e-01, -1.6573e-01, -2.7925e-01,  3.6810e-03, -7.0942e-02,
        -3.0078e-01, -5.3711e-01, -1.0404e-01,  6.3623e-01,  1.8477e+00,
         3.6054e-01, -1.5076e-01,  9.2563e-01,  2.5202e-01, -3.2058e-01,
        -2.2452e-01,  1.7943e-01,  5.2766e-01, -1.0920e-02, -1.1241e+00,
        -2.0166e-01,  2.2882e-01,  5.3005e-01,  1.4822e-01, -4.7019e-02,
        -7.0660e-01,  8.0039e-02, -6.2773e-02, -4.3464e-01, -1.4753e-01,
        -4.6803e-01,  5.3834e-01, -4.6891e-01,  2.2946e-01, -1.2632e-02,
        -2.4544e-01, -6.4096e-01, -4.8930e-01, -5.5008e-01, -1.7867e-01,
        -2.3539e-02, -5.5810e-01, -6.2076e-01, -4.3792e-01, -3.6656e-01,
        -4.3805e-01,  1.1673e+00, -2.8336e-01, -7.2951e-01, -5.8759e-01,
        -6.1129e-01, -4.5518e-01, -7.2157e-04, -8.6215e-01,  2.9566e-01,
        -6.4578e-01,  3.1415e-01,  3.7778e-01,  9.1102e-01,  8.9451e-01,
        -1.3058e+00,  2.2072e-01,  2.6512e-03, -7.8429e-01, -8.5437e-02,
         4.5608e-01, -5.9265e-02, -8.6893e-01, -7.8556e-01, -8.7784e-01,
         9.9630e-02,  2.7376e-02,  3.4327e-02, -5.3754e-01, -4.7131e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([11772]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-3.0724e-01, -3.0701e-01,  1.1624e-02,  9.8851e-01, -6.8158e-02,
        -4.2854e-01, -1.1849e+00, -8.3217e-01,  1.3971e-01, -2.7698e-01,
        -7.2725e-01, -1.2888e-02, -7.2205e-01,  1.8915e-01, -3.4202e-01,
        -8.0293e-01, -3.8631e-01,  4.8055e-01, -2.9597e-02, -6.7489e-03,
        -1.4080e-03, -1.9551e-01, -2.0342e-01, -3.6576e-01,  2.0793e-01,
        -7.8171e-01, -6.1245e-01, -1.0404e-01,  5.4686e-01,  1.1302e+00,
        -1.3025e-01, -2.5562e-01,  3.5917e-01,  2.5202e-01, -7.8760e-01,
         3.8877e-01,  6.2084e-01, -5.7370e-01,  4.4948e-01, -1.1176e+00,
        -1.9870e-01, -3.4895e-01,  6.3524e-01, -3.4901e-01,  1.0304e-02,
        -7.1607e-01, -4.5761e-01, -1.5738e-01, -1.5510e-01, -2.4850e-01,
         1.6434e-01,  5.3834e-01, -4.6891e-01, -8.4981e-01, -7.7290e-01,
        -6.8746e-01,  1.7534e-02, -6.2319e-01, -4.4494e-01, -4.8667e-01,
        -3.1980e-01, -4.9570e-01, -4.4164e-01,  4.6807e-01, -2.0140e-02,
        -3.8957e-01, -4.5454e-01,  1.5018e-01, -1.3227e-01, -6.4417e-01,
        -7.2905e-03,  8.2889e-02, -7.2157e-04, -8.1878e-01, -2.2680e-02,
        -2.3589e-01, -8.0530e-02,  2.6052e-01, -6.7815e-01,  5.1146e-01,
         8.0767e-01,  2.7445e-01,  2.6512e-03,  7.0870e-01, -2.0623e-01,
        -3.6547e-01, -8.7941e-01, -7.8198e-01, -6.7758e-01, -8.1505e-01,
        -1.4483e-01, -2.8070e-01, -6.4128e-01, -4.7327e-01, -4.7131e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([916]), tensor(0.0627))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([ 1.9805e-01,  1.1929e+00,  7.9028e-02, -9.4097e-01,  2.1510e-02,
        -6.0508e-01, -2.8910e-02, -2.6827e-01,  7.2547e-01, -3.2288e-01,
        -7.7108e-01,  2.1590e-02, -7.2063e-01, -5.7781e-01, -4.0247e-01,
         1.4122e-02, -3.7462e-01,  1.3879e-01, -9.8145e-02,  9.2092e-01,
        -4.9027e-01, -1.7344e-01, -2.8397e-01,  5.1624e-03, -7.1720e-02,
        -3.0092e-01, -5.3585e-01, -1.0321e-01,  6.3611e-01,  1.8472e+00,
         3.6142e-01, -1.4889e-01,  9.2551e-01,  2.5621e-01, -3.1644e-01,
        -2.2718e-01,  1.8191e-01,  5.3173e-01, -9.4360e-03, -1.1175e+00,
        -2.0046e-01,  2.2394e-01,  5.3814e-01,  1.4488e-01, -4.4704e-02,
        -7.0271e-01,  7.7202e-02, -6.5904e-02, -4.3374e-01, -1.5220e-01,
        -4.7231e-01,  5.3970e-01, -4.6963e-01,  2.3198e-01, -9.4925e-03,
        -2.4283e-01, -6.3228e-01, -4.8792e-01, -5.5122e-01, -1.7649e-01,
        -2.4337e-02, -5.5908e-01, -6.2127e-01, -4.3915e-01, -3.6707e-01,
        -4.3795e-01,  1.1808e+00, -2.8103e-01, -7.3692e-01, -5.8831e-01,
        -6.1301e-01, -4.5760e-01, -1.2279e-03, -8.5698e-01,  2.9652e-01,
        -6.4073e-01,  3.1369e-01,  3.7569e-01,  9.2014e-01,  9.0140e-01,
        -1.3074e+00,  2.1678e-01,  2.8689e-03, -7.7299e-01, -8.2242e-02,
         4.6031e-01, -4.4363e-02, -8.7040e-01, -7.8820e-01, -8.7306e-01,
         9.9373e-02,  3.2455e-02,  3.3200e-02, -5.4273e-01, -4.6573e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([11858]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-6.6620e-01, -7.6716e-03, -7.8029e-01,  9.7950e-01, -1.1126e-01,
        -3.9356e-01, -1.1918e+00, -8.3599e-01,  4.0991e-01, -1.7166e-01,
        -7.3205e-01, -1.0336e-01, -7.2063e-01,  8.5609e-02, -3.5721e-01,
        -3.5301e-01, -3.0068e-01,  2.0732e-03,  1.8431e-01, -4.2583e-01,
        -8.0421e-01, -1.9666e-01, -3.1832e-01, -1.7572e-01,  5.1240e-02,
        -8.3500e-01, -6.1269e-01, -1.0321e-01,  6.3611e-01,  1.4738e+00,
        -1.6230e-01, -2.4390e-01,  2.9936e-01,  2.5621e-01, -8.1808e-01,
         1.5731e-01,  6.5317e-01, -5.2823e-01, -2.2302e-01, -1.2105e+00,
        -2.0073e-01,  2.4320e-01,  4.4868e-01, -2.1374e-01, -7.8380e-02,
        -6.5890e-01, -3.0483e-01, -4.3363e-01, -4.4071e-01, -5.5395e-01,
        -1.1038e+00,  5.3970e-01, -4.6963e-01, -8.5560e-01, -7.7203e-01,
        -6.9342e-01,  1.7239e-02, -6.2188e-01, -4.1743e-01, -2.7738e-01,
         1.0637e-01, -3.6400e-01,  4.2358e-01, -7.8803e-01, -1.8633e-02,
         6.4148e-02, -4.5177e-01, -5.7258e-01,  4.5704e-01, -6.8276e-01,
        -6.5233e-03,  7.7626e-02, -1.2279e-03, -6.7796e-01, -4.8214e-02,
        -2.1020e-01, -1.1471e-01,  1.6934e-01,  1.6584e-01,  9.0140e-01,
         8.0760e-01, -1.7762e-01,  2.8689e-03,  8.2813e-01, -4.3626e-01,
        -3.0642e-01, -1.2573e+00,  5.2368e-02, -6.9311e-01, -8.1795e-01,
         1.3700e-01, -4.1840e-01, -6.9120e-01,  5.6514e-01, -4.6573e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([926]), tensor(0.1476))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012]
INFO:main.py:Testing data year: 2013
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 60
            max_num_epochs: 20
            num_cpus: 60
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 102
            num_embeddings: 17753
            device: cpu
            
2024-07-08 03:01:45,519	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-08 03:01:45,672	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-08 03:01:45,694	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_fadad946ef373469.zip' (1.20MiB) to Ray cluster...
2024-07-08 03:01:45,698	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_fadad946ef373469.zip'.
2024-07-08 03:01:50,903	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-08 03:02:21,946	WARNING util.py:201 -- The `on_step_begin` operation took 0.715 s, which may be a performance bottleneck.
2024-07-08 03:37:14,909	INFO tune.py:1009 -- Wrote the latest version of all result files and experiment state to '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-08_03-01-50' in 0.1441s.
INFO:model_data_nn.py:Best trial config: {'continuous_dim': 102, 'hidden_dim': 65, 'num_layers': 3, 'num_embeddings': 17753, 'embedding_dim': 5, 'dropout_rate': 0.27180818453385097, 'lr': 0.00011948354480999269, 'weight_decay': 6.4303853792601085e-06, 'num_epochs': 20, 'num_gpus': 0}
INFO:model_data_nn.py:Best trial training loss: 0.03620928118162017
INFO:model_data_nn.py:Best trial testing loss: 0.017401940291165374
INFO:main.py:Ray Tune results have been saved to: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
INFO:main.py:Best trial directory: /tmp/ray/session_2024-07-08_03-01-42_428271_2505436/artifacts/2024-07-08_03-01-50/train_fnn_2024-07-08_03-01-50/driver_artifacts/train_fnn_6c46d_00020_20_dropout_rate=0.2718,embedding_dim=5,hidden_dim=65,lr=0.0001,num_layers=3,weight_decay=0.0000_2024-07-08_03-01-51
INFO:main.py:

Retrain a new model with data in years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]

            Using the optimized hyperparameters: {'continuous_dim': 102, 'hidden_dim': 65, 'num_layers': 3, 'num_embeddings': 17893, 'embedding_dim': 5, 'dropout_rate': 0.27180818453385097, 'lr': 0.00011948354480999269, 'weight_decay': 6.4303853792601085e-06, 'num_epochs': 20, 'num_gpus': 0}

INFO:model_data_nn.py:Epoch 1/20, metrics: {'avg_train_loss': 10.76585403378625, 'avg_test_loss': 0.04731568990497844}
INFO:model_data_nn.py:Epoch 2/20, metrics: {'avg_train_loss': 0.042641411814775335, 'avg_test_loss': 0.018424148890980572}
INFO:model_data_nn.py:Epoch 3/20, metrics: {'avg_train_loss': 0.03642516351785488, 'avg_test_loss': 0.018415169623451976}
INFO:model_data_nn.py:Epoch 4/20, metrics: {'avg_train_loss': 0.036318942762146506, 'avg_test_loss': 0.01843070822808915}
INFO:model_data_nn.py:Epoch 5/20, metrics: {'avg_train_loss': 0.03621310032853498, 'avg_test_loss': 0.018478832998365727}
INFO:model_data_nn.py:Epoch 6/20, metrics: {'avg_train_loss': 0.03613045081118898, 'avg_test_loss': 0.018594153849232308}
INFO:model_data_nn.py:Epoch 7/20, metrics: {'avg_train_loss': 0.03608379356074321, 'avg_test_loss': 0.018376703224724757}
INFO:model_data_nn.py:Epoch 8/20, metrics: {'avg_train_loss': 0.036033770369579804, 'avg_test_loss': 0.018350465747428202}
INFO:model_data_nn.py:Epoch 9/20, metrics: {'avg_train_loss': 0.03600411218237119, 'avg_test_loss': 0.0184658112578422}
INFO:model_data_nn.py:Epoch 10/20, metrics: {'avg_train_loss': 0.03596236679847349, 'avg_test_loss': 0.01840605049938807}
INFO:model_data_nn.py:Epoch 11/20, metrics: {'avg_train_loss': 0.03593102975005827, 'avg_test_loss': 0.018335701727876498}
INFO:model_data_nn.py:Epoch 12/20, metrics: {'avg_train_loss': 0.03590382470741088, 'avg_test_loss': 0.018409004493516946}
INFO:model_data_nn.py:Epoch 13/20, metrics: {'avg_train_loss': 0.035881298660907834, 'avg_test_loss': 0.018366351594808716}
INFO:model_data_nn.py:Epoch 14/20, metrics: {'avg_train_loss': 0.035852594484583326, 'avg_test_loss': 0.018366527682135127}
INFO:model_data_nn.py:Epoch 15/20, metrics: {'avg_train_loss': 0.03580130397650476, 'avg_test_loss': 0.018337424159190565}
INFO:model_data_nn.py:Epoch 16/20, metrics: {'avg_train_loss': 0.035791324822955155, 'avg_test_loss': 0.01834805132879776}
INFO:model_data_nn.py:Epoch 17/20, metrics: {'avg_train_loss': 0.0357704657615548, 'avg_test_loss': 0.01833068542533888}
INFO:model_data_nn.py:Epoch 18/20, metrics: {'avg_train_loss': 0.0357555876442318, 'avg_test_loss': 0.018378409615618253}
INFO:model_data_nn.py:Epoch 19/20, metrics: {'avg_train_loss': 0.03572813610753322, 'avg_test_loss': 0.018343546038270934}
INFO:model_data_nn.py:Epoch 20/20, metrics: {'avg_train_loss': 0.03570803306378895, 'avg_test_loss': 0.01833727775118167}
INFO:main.py:Making prediction for data in year: 2013
INFO:main.py:Prediction data shape: (40537,)
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py:372: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  prediction_data['pred'] = predictions
INFO:main.py:Root Mean Squared Error for Prediction in 2014: 0.135311687770085
INFO:main.py:Prediction Stats:                 ret          pred
count  40537.000000  40537.000000
mean       0.004417      0.009657
std        0.135271      0.006987
min       -0.813122     -0.086874
25%       -0.053594      0.007104
50%        0.003285      0.009267
75%        0.054616      0.011952
max        6.080164      0.179102
INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:transform_data_nn.py:Train_data: (1882679, 158)

INFO:transform_data_nn.py:Test data years: [2014]
INFO:transform_data_nn.py:Test_data: (40537, 158)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:transform_data_nn.py:Retrain_data: (1923216, 158)

INFO:transform_data_nn.py:Prediction data years: [2015]
INFO:transform_data_nn.py:Prediction_data: (41197, 158)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1882679, 103])
            y_train_tf: torch.Size([1882679])

            x_test_tf: torch.Size([40537, 103])
            y_test_tf: torch.Size([40537])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1923216, 103])
            y_retrain_tf: torch.Size([1923216])

            x_prediction_tf: torch.Size([41197, 103])
            y_prediction_tf: torch.Size([41197])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([ 1.9805e-01,  1.1929e+00,  7.9028e-02, -9.4097e-01,  2.1510e-02,
        -6.0508e-01, -2.8910e-02, -2.6827e-01,  7.2547e-01, -3.2288e-01,
        -7.7108e-01,  2.1590e-02, -7.2063e-01, -5.7781e-01, -4.0247e-01,
         1.4122e-02, -3.7462e-01,  1.3879e-01, -9.8145e-02,  9.2092e-01,
        -4.9027e-01, -1.7344e-01, -2.8397e-01,  5.1624e-03, -7.1720e-02,
        -3.0092e-01, -5.3585e-01, -1.0321e-01,  6.3611e-01,  1.8472e+00,
         3.6142e-01, -1.4889e-01,  9.2551e-01,  2.5621e-01, -3.1644e-01,
        -2.2718e-01,  1.8191e-01,  5.3173e-01, -9.4360e-03, -1.1175e+00,
        -2.0046e-01,  2.2394e-01,  5.3814e-01,  1.4488e-01, -4.4704e-02,
        -7.0271e-01,  7.7202e-02, -6.5904e-02, -4.3374e-01, -1.5220e-01,
        -4.7231e-01,  5.3970e-01, -4.6963e-01,  2.3198e-01, -9.4925e-03,
        -2.4283e-01, -6.3228e-01, -4.8792e-01, -5.5122e-01, -1.7649e-01,
        -2.4337e-02, -5.5908e-01, -6.2127e-01, -4.3915e-01, -3.6707e-01,
        -4.3795e-01,  1.1808e+00, -2.8103e-01, -7.3692e-01, -5.8831e-01,
        -6.1301e-01, -4.5760e-01, -1.2279e-03, -8.5698e-01,  2.9652e-01,
        -6.4073e-01,  3.1369e-01,  3.7569e-01,  9.2014e-01,  9.0140e-01,
        -1.3074e+00,  2.1678e-01,  2.8689e-03, -7.7299e-01, -8.2242e-02,
         4.6031e-01, -4.4363e-02, -8.7040e-01, -7.8820e-01, -8.7306e-01,
         9.9373e-02,  3.2455e-02,  3.3200e-02, -5.4273e-01, -4.6573e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([11858]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-6.6620e-01, -7.6716e-03, -7.8029e-01,  9.7950e-01, -1.1126e-01,
        -3.9356e-01, -1.1918e+00, -8.3599e-01,  4.0991e-01, -1.7166e-01,
        -7.3205e-01, -1.0336e-01, -7.2063e-01,  8.5609e-02, -3.5721e-01,
        -3.5301e-01, -3.0068e-01,  2.0732e-03,  1.8431e-01, -4.2583e-01,
        -8.0421e-01, -1.9666e-01, -3.1832e-01, -1.7572e-01,  5.1240e-02,
        -8.3500e-01, -6.1269e-01, -1.0321e-01,  6.3611e-01,  1.4738e+00,
        -1.6230e-01, -2.4390e-01,  2.9936e-01,  2.5621e-01, -8.1808e-01,
         1.5731e-01,  6.5317e-01, -5.2823e-01, -2.2302e-01, -1.2105e+00,
        -2.0073e-01,  2.4320e-01,  4.4868e-01, -2.1374e-01, -7.8380e-02,
        -6.5890e-01, -3.0483e-01, -4.3363e-01, -4.4071e-01, -5.5395e-01,
        -1.1038e+00,  5.3970e-01, -4.6963e-01, -8.5560e-01, -7.7203e-01,
        -6.9342e-01,  1.7239e-02, -6.2188e-01, -4.1743e-01, -2.7738e-01,
         1.0637e-01, -3.6400e-01,  4.2358e-01, -7.8803e-01, -1.8633e-02,
         6.4148e-02, -4.5177e-01, -5.7258e-01,  4.5704e-01, -6.8276e-01,
        -6.5233e-03,  7.7626e-02, -1.2279e-03, -6.7796e-01, -4.8214e-02,
        -2.1020e-01, -1.1471e-01,  1.6934e-01,  1.6584e-01,  9.0140e-01,
         8.0760e-01, -1.7762e-01,  2.8689e-03,  8.2813e-01, -4.3626e-01,
        -3.0642e-01, -1.2573e+00,  5.2368e-02, -6.9311e-01, -8.1795e-01,
         1.3700e-01, -4.1840e-01, -6.9120e-01,  5.6514e-01, -4.6573e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([926]), tensor(0.1476))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([ 2.0261e-01,  1.2030e+00,  7.7160e-02, -9.5301e-01,  2.4184e-02,
        -6.0299e-01, -3.1998e-02, -2.7031e-01,  7.3161e-01, -3.2260e-01,
        -7.7211e-01,  2.3038e-02, -7.2163e-01, -5.8269e-01, -3.9860e-01,
         1.2343e-02, -3.7150e-01,  1.3976e-01, -9.7562e-02,  9.3111e-01,
        -4.8866e-01, -1.7234e-01, -2.9001e-01,  5.9865e-03, -7.3111e-02,
        -3.0129e-01, -5.3486e-01, -1.0612e-01,  6.3604e-01,  1.8485e+00,
         3.6312e-01, -1.4798e-01,  9.2853e-01,  2.5977e-01, -3.1201e-01,
        -2.2697e-01,  1.8420e-01,  5.3606e-01, -7.5655e-03, -1.1097e+00,
        -1.9868e-01,  2.1932e-01,  5.4677e-01,  1.4390e-01, -4.2154e-02,
        -6.9834e-01,  7.4425e-02, -6.5330e-02, -4.3494e-01, -1.5329e-01,
        -4.7699e-01,  5.4194e-01, -4.7066e-01,  2.3565e-01, -6.6083e-03,
        -2.4030e-01, -6.2391e-01, -4.8694e-01, -5.5280e-01, -1.7489e-01,
        -2.5411e-02, -5.6088e-01, -6.2457e-01, -4.3938e-01, -3.6671e-01,
        -4.3851e-01,  1.1935e+00, -2.7868e-01, -7.4402e-01, -5.8887e-01,
        -6.1319e-01, -4.6424e-01, -1.0755e-03, -8.5199e-01,  2.9782e-01,
        -6.3685e-01,  3.1135e-01,  3.7504e-01,  9.3055e-01,  9.0855e-01,
        -1.3097e+00,  2.1281e-01,  2.9228e-03, -8.0592e-01, -7.8568e-02,
         4.6733e-01, -2.8072e-02, -8.7221e-01, -7.9038e-01, -8.6859e-01,
         9.9307e-02,  3.7247e-02,  3.5178e-02, -5.4804e-01, -4.6007e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([11996]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-4.6477e-01, -1.6329e-01, -5.7385e-01,  9.7166e-01,  1.0560e-02,
        -4.4649e-01, -9.3859e-01, -7.7028e-01,  7.0123e-01, -8.5424e-02,
        -7.3104e-01, -2.8118e-02, -7.2163e-01,  2.6148e-01, -3.2232e-01,
         2.4876e-01,  4.0908e-01,  5.4068e-01, -3.3353e-02, -1.1343e-01,
        -6.8954e-01, -8.5314e-01, -5.2115e-01, -3.1027e-01,  1.6108e-01,
        -7.7487e-01, -6.0807e-01, -1.0612e-01,  6.3604e-01,  1.6133e+00,
        -7.7281e-01,  1.6118e-01,  5.1671e-01,  2.5977e-01, -7.8137e-01,
        -4.0242e-01,  1.9530e-01, -5.4869e-01,  2.7720e-01, -9.7963e-01,
        -1.9840e-01,  1.1506e-02,  2.3899e-01, -2.1021e-01, -2.2510e-01,
        -7.7474e-01,  6.0927e-01, -3.0303e-01, -6.7744e-01,  1.4414e-01,
         1.5348e-01,  5.4194e-01, -4.7066e-01, -8.6122e-01, -7.7126e-01,
        -6.5111e-01,  1.7151e-02, -4.8938e-01,  2.0673e-01, -1.9556e-01,
        -1.2346e-01,  2.1711e-01,  3.1240e-01,  1.5820e-02, -1.8926e-02,
        -7.9046e-02, -4.4862e-01,  3.8029e-02,  1.6433e+00, -6.2008e-01,
        -3.3311e-03,  8.0683e-02, -1.0755e-03, -8.6619e-01, -8.6403e-02,
        -3.8545e-01, -1.4906e-01,  1.9993e-01,  1.6000e-01,  4.2635e-01,
         8.0761e-01, -1.4727e-01,  2.9228e-03,  8.0778e-01,  1.0628e-01,
        -2.1268e-01, -1.0824e+00, -5.9950e-01, -6.9591e-01, -8.1839e-01,
        -2.9373e-02, -1.7664e-01, -2.4082e-01, -2.4063e-01, -4.6007e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([956]), tensor(-0.1152))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:main.py:Testing data year: 2014
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 60
            max_num_epochs: 20
            num_cpus: 60
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 102
            num_embeddings: 17893
            device: cpu
            
2024-07-08 06:12:20,996	INFO worker.py:1753 -- Started a local Ray instance.
2024-07-08 06:12:22,269	INFO packaging.py:530 -- Creating a file package for local directory '/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src'.
2024-07-08 06:12:23,044	INFO packaging.py:358 -- Pushing file package 'gcs://_ray_pkg_fadad946ef373469.zip' (1.20MiB) to Ray cluster...
2024-07-08 06:12:23,058	INFO packaging.py:371 -- Successfully pushed file package 'gcs://_ray_pkg_fadad946ef373469.zip'.
2024-07-08 06:12:45,324	WARNING tune.py:902 -- AIR_VERBOSITY is set, ignoring passed-in ProgressReporter for now.
2024-07-08 06:13:41,064	WARNING util.py:201 -- The `on_step_begin` operation took 15.550 s, which may be a performance bottleneck.
2024-07-08 06:14:45,057	WARNING util.py:201 -- The `on_step_begin` operation took 3.584 s, which may be a performance bottleneck.
[33m(raylet)[0m [2024-07-08 06:17:25,527 E 880083 880083] (raylet) gcs_rpc_client.h:564: Failed to connect to GCS within 60 seconds. GCS may have been killed. It's either GCS is terminated by `ray stop` or is killed unexpectedly. If it is killed unexpectedly, see the log file gcs_server.out. https://docs.ray.io/en/master/ray-observability/user-guides/configure-logging.html#logging-directory-structure. The program will terminate.
2024-07-08 06:17:38,890	WARNING resource_updater.py:262 -- Cluster resources not detected or are 0. Attempt #2...
2024-07-08 06:17:39,398	WARNING resource_updater.py:262 -- Cluster resources not detected or are 0. Attempt #3...
2024-07-08 06:17:39,903	WARNING resource_updater.py:262 -- Cluster resources not detected or are 0. Attempt #4...
2024-07-08 06:17:40,410	WARNING resource_updater.py:262 -- Cluster resources not detected or are 0. Attempt #5...
2024-07-08 06:17:40,916	WARNING resource_updater.py:275 -- Cluster resources cannot be detected or are 0. You can resume this experiment by passing in `resume=True` to `run`.
2024-07-08 06:17:40,917	WARNING util.py:201 -- The `on_step_begin` operation took 45.088 s, which may be a performance bottleneck.
2024-07-08 06:17:41,054	WARNING resource_updater.py:262 -- Cluster resources not detected or are 0. Attempt #2...
2024-07-08 06:17:41,560	WARNING resource_updater.py:262 -- Cluster resources not detected or are 0. Attempt #3...
2024-07-08 06:17:42,064	WARNING resource_updater.py:262 -- Cluster resources not detected or are 0. Attempt #4...
2024-07-08 06:17:42,572	WARNING resource_updater.py:262 -- Cluster resources not detected or are 0. Attempt #5...
2024-07-08 06:17:43,081	WARNING resource_updater.py:275 -- Cluster resources cannot be detected or are 0. You can resume this experiment by passing in `resume=True` to `run`.
2024-07-08 06:17:43,187	WARNING resource_updater.py:262 -- Cluster resources not detected or are 0. Attempt #2...
2024-07-08 06:17:43,695	WARNING resource_updater.py:262 -- Cluster resources not detected or are 0. Attempt #3...
2024-07-08 06:17:44,210	WARNING resource_updater.py:262 -- Cluster resources not detected or are 0. Attempt #4...
2024-07-08 06:17:44,717	WARNING resource_updater.py:262 -- Cluster resources not detected or are 0. Attempt #5...
2024-07-08 06:17:45,234	WARNING resource_updater.py:275 -- Cluster resources cannot be detected or are 0. You can resume this experiment by passing in `resume=True` to `run`.
[2024-07-08 06:17:45,545 E 2505436 880243] core_worker.cc:662: :info_message: Attempting to recover 3 lost objects by resubmitting their tasks. To disable object reconstruction, set @ray.remote(max_retries=0).
2024-07-08 06:17:45,660	WARNING resource_updater.py:262 -- Cluster resources not detected or are 0. Attempt #2...
2024-07-08 06:17:46,162	WARNING resource_updater.py:262 -- Cluster resources not detected or are 0. Attempt #3...
2024-07-08 06:17:46,666	WARNING resource_updater.py:262 -- Cluster resources not detected or are 0. Attempt #4...
2024-07-08 06:17:47,169	WARNING resource_updater.py:262 -- Cluster resources not detected or are 0. Attempt #5...
2024-07-08 06:17:47,671	WARNING resource_updater.py:275 -- Cluster resources cannot be detected or are 0. You can resume this experiment by passing in `resume=True` to `run`.
2024-07-08 06:17:47,697	ERROR tune_controller.py:1331 -- Trial task failed for trial train_fnn_17a4d_00053
Traceback (most recent call last):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/air/execution/_internal/event_manager.py", line 110, in resolve_future
    result = ray.get(future)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/auto_init_hook.py", line 21, in auto_init_wrapper
    return fn(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 2613, in get
    values, debugger_breakpoint = worker.get_objects(object_refs, timeout=timeout)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 863, in get_objects
    raise value
ray.exceptions.ActorDiedError: The actor died unexpectedly before finishing this task.
	class_name: ImplicitFunc
	actor_id: 8560371627bfe5db134782bd01000000
	pid: 898357
	namespace: d0218cf8-a72e-4e2e-b88c-1f8fb16ff356
	ip: 10.112.2.41
The actor died because its node has died. Node Id: 0c12af6d48c4d76b6ce0a48eb0ad4bb9473aa4630281edbbfa4f6abc
	the actor's node was terminated unexpectedly: health check failed due to missing too many heartbeats
╭──────────────────────────────────────────────────────────────────╮
│ Configuration for experiment     train_fnn_2024-07-07_10-26-57   │
├──────────────────────────────────────────────────────────────────┤
│ Search algorithm                 BasicVariantGenerator           │
│ Scheduler                        AsyncHyperBandScheduler         │
│ Number of trials                 60                              │
╰──────────────────────────────────────────────────────────────────╯

View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-07_10-26-57
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-07_10-26-16_591806_2505436/artifacts/2024-07-07_10-26-57/train_fnn_2024-07-07_10-26-57/driver_artifacts`

╭──────────────────────────────────────────────────────────────────╮
│ Configuration for experiment     train_fnn_2024-07-07_13-51-50   │
├──────────────────────────────────────────────────────────────────┤
│ Search algorithm                 BasicVariantGenerator           │
│ Scheduler                        AsyncHyperBandScheduler         │
│ Number of trials                 60                              │
╰──────────────────────────────────────────────────────────────────╯

View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-07_13-51-50
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-07_13-51-40_972754_2505436/artifacts/2024-07-07_13-51-50/train_fnn_2024-07-07_13-51-50/driver_artifacts`

╭──────────────────────────────────────────────────────────────────╮
│ Configuration for experiment     train_fnn_2024-07-07_17-11-11   │
├──────────────────────────────────────────────────────────────────┤
│ Search algorithm                 BasicVariantGenerator           │
│ Scheduler                        AsyncHyperBandScheduler         │
│ Number of trials                 60                              │
╰──────────────────────────────────────────────────────────────────╯

View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-07_17-11-11
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-07_17-11-01_427249_2505436/artifacts/2024-07-07_17-11-11/train_fnn_2024-07-07_17-11-11/driver_artifacts`

╭──────────────────────────────────────────────────────────────────╮
│ Configuration for experiment     train_fnn_2024-07-07_20-49-20   │
├──────────────────────────────────────────────────────────────────┤
│ Search algorithm                 BasicVariantGenerator           │
│ Scheduler                        AsyncHyperBandScheduler         │
│ Number of trials                 60                              │
╰──────────────────────────────────────────────────────────────────╯

View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-07_20-49-20
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-07_20-49-09_934260_2505436/artifacts/2024-07-07_20-49-20/train_fnn_2024-07-07_20-49-20/driver_artifacts`

╭──────────────────────────────────────────────────────────────────╮
│ Configuration for experiment     train_fnn_2024-07-07_23-57-39   │
├──────────────────────────────────────────────────────────────────┤
│ Search algorithm                 BasicVariantGenerator           │
│ Scheduler                        AsyncHyperBandScheduler         │
│ Number of trials                 60                              │
╰──────────────────────────────────────────────────────────────────╯

View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-07_23-57-39
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-07_23-57-30_023547_2505436/artifacts/2024-07-07_23-57-39/train_fnn_2024-07-07_23-57-39/driver_artifacts`

╭──────────────────────────────────────────────────────────────────╮
│ Configuration for experiment     train_fnn_2024-07-08_03-01-50   │
├──────────────────────────────────────────────────────────────────┤
│ Search algorithm                 BasicVariantGenerator           │
│ Scheduler                        AsyncHyperBandScheduler         │
│ Number of trials                 60                              │
╰──────────────────────────────────────────────────────────────────╯

View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-08_03-01-50
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-08_03-01-42_428271_2505436/artifacts/2024-07-08_03-01-50/train_fnn_2024-07-08_03-01-50/driver_artifacts`

╭──────────────────────────────────────────────────────────────────╮
│ Configuration for experiment     train_fnn_2024-07-08_06-12-45   │
├──────────────────────────────────────────────────────────────────┤
│ Search algorithm                 BasicVariantGenerator           │
│ Scheduler                        AsyncHyperBandScheduler         │
│ Number of trials                 60                              │
╰──────────────────────────────────────────────────────────────────╯

View detailed results here: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results/train_fnn_2024-07-08_06-12-45
To visualize your results with TensorBoard, run: `tensorboard --logdir /tmp/ray/session_2024-07-08_06-12-14_572316_2505436/artifacts/2024-07-08_06-12-45/train_fnn_2024-07-08_06-12-45/driver_artifacts`
[33m(raylet)[0m The node with node id: 0c12af6d48c4d76b6ce0a48eb0ad4bb9473aa4630281edbbfa4f6abc and address: 10.112.2.41 and node name: 10.112.2.41 has been marked dead because the detector has missed too many heartbeats from it. This can happen when a 	(1) raylet crashes unexpectedly (OOM, etc.) 
	(2) raylet has lagging heartbeats due to slow network or busy workload.

Traceback (most recent call last):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/air/execution/_internal/event_manager.py", line 110, in resolve_future
    result = ray.get(future)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/auto_init_hook.py", line 21, in auto_init_wrapper
    return fn(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 2613, in get
    values, debugger_breakpoint = worker.get_objects(object_refs, timeout=timeout)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 863, in get_objects
    raise value
ray.exceptions.ActorDiedError: The actor died unexpectedly before finishing this task.
	class_name: ImplicitFunc
	actor_id: 8560371627bfe5db134782bd01000000
	pid: 898357
	namespace: d0218cf8-a72e-4e2e-b88c-1f8fb16ff356
	ip: 10.112.2.41
The actor died because its node has died. Node Id: 0c12af6d48c4d76b6ce0a48eb0ad4bb9473aa4630281edbbfa4f6abc
	the actor's node was terminated unexpectedly: health check failed due to missing too many heartbeats

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/execution/tune_controller.py", line 1245, in _on_error
    on_error(trial, exception)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/execution/tune_controller.py", line 1332, in _trial_task_failure
    self._process_trial_failure(trial, exception=exception)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/execution/tune_controller.py", line 1358, in _process_trial_failure
    self._callbacks.on_trial_error(
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/callback.py", line 422, in on_trial_error
    callback.on_trial_error(**info)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/experimental/output.py", line 737, in on_trial_error
    if trial.last_result and TRAINING_ITERATION in trial.last_result:
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/experiment/trial.py", line 498, in last_result
    self._get_default_result_or_future()
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/experiment/trial.py", line 466, in _get_default_result_or_future
    self._default_result_or_future = ray.get(self._default_result_or_future)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/auto_init_hook.py", line 21, in auto_init_wrapper
    return fn(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 2613, in get
    values, debugger_breakpoint = worker.get_objects(object_refs, timeout=timeout)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 840, in get_objects
    data_metadata_pairs = self.core_worker.get_objects(
  File "python/ray/_raylet.pyx", line 3485, in ray._raylet.CoreWorker.get_objects
  File "python/ray/_raylet.pyx", line 581, in ray._raylet.check_status
OSError: Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py", line 384, in <module>
    main()
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/main.py", line 332, in main
    best_trial = data_modeler.get_best_trial(
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/src/model_data_nn.py", line 271, in get_best_trial
    result = tune.run(
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/tune.py", line 994, in run
    runner.step()
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/execution/tune_controller.py", line 685, in step
    if not self._actor_manager.next(timeout=0.1):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/air/execution/_internal/actor_manager.py", line 223, in next
    self._actor_task_events.resolve_future(future)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/air/execution/_internal/event_manager.py", line 113, in resolve_future
    on_error(e)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/air/execution/_internal/actor_manager.py", line 771, in on_error
    self._actor_task_failed(
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/air/execution/_internal/actor_manager.py", line 283, in _actor_task_failed
    tracked_actor_task._on_error(tracked_actor, exception)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/execution/tune_controller.py", line 1254, in _on_error
    raise TuneError(traceback.format_exc())
ray.tune.error.TuneError: Traceback (most recent call last):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/air/execution/_internal/event_manager.py", line 110, in resolve_future
    result = ray.get(future)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/auto_init_hook.py", line 21, in auto_init_wrapper
    return fn(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 2613, in get
    values, debugger_breakpoint = worker.get_objects(object_refs, timeout=timeout)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 863, in get_objects
    raise value
ray.exceptions.ActorDiedError: The actor died unexpectedly before finishing this task.
	class_name: ImplicitFunc
	actor_id: 8560371627bfe5db134782bd01000000
	pid: 898357
	namespace: d0218cf8-a72e-4e2e-b88c-1f8fb16ff356
	ip: 10.112.2.41
The actor died because its node has died. Node Id: 0c12af6d48c4d76b6ce0a48eb0ad4bb9473aa4630281edbbfa4f6abc
	the actor's node was terminated unexpectedly: health check failed due to missing too many heartbeats

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/execution/tune_controller.py", line 1245, in _on_error
    on_error(trial, exception)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/execution/tune_controller.py", line 1332, in _trial_task_failure
    self._process_trial_failure(trial, exception=exception)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/execution/tune_controller.py", line 1358, in _process_trial_failure
    self._callbacks.on_trial_error(
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/callback.py", line 422, in on_trial_error
    callback.on_trial_error(**info)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/experimental/output.py", line 737, in on_trial_error
    if trial.last_result and TRAINING_ITERATION in trial.last_result:
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/experiment/trial.py", line 498, in last_result
    self._get_default_result_or_future()
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/tune/experiment/trial.py", line 466, in _get_default_result_or_future
    self._default_result_or_future = ray.get(self._default_result_or_future)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/auto_init_hook.py", line 21, in auto_init_wrapper
    return fn(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 2613, in get
    values, debugger_breakpoint = worker.get_objects(object_refs, timeout=timeout)
  File "/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/lib/python3.10/site-packages/ray/_private/worker.py", line 840, in get_objects
    data_metadata_pairs = self.core_worker.get_objects(
  File "python/ray/_raylet.pyx", line 3485, in ray._raylet.CoreWorker.get_objects
  File "python/ray/_raylet.pyx", line 581, in ray._raylet.check_status
OSError: Broken pipe

slurmstepd-yen15: error: Detected 7805 oom-kill event(s) in StepId=411798.batch. Some of your processes may have been killed by the cgroup out-of-memory handler.
