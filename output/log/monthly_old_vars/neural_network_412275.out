Current working directory
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin
source venv/bin/activate
which python3
/zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/venv/bin/python3
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
Intel(R) Extension for Scikit-learn* enabled (https://github.com/intel/scikit-learn-intelex)
INFO:preprocess_data_nn.py:

Loading and preprocessing data...

DEBUG:preprocess_data_nn.py:      date  permno
0  1980-01   10006
1  1980-01   10057
2  1980-01   10103
3  1980-01   10137
4  1980-01   10145
DEBUG:preprocess_data_nn.py:--------------------------------------------------
INFO:main.py:preprocessed df: (2216189, 158)
INFO:preprocess_data_nn.py:

Applying secondary data preprocessing..

INFO:main.py:secondary preprocessed df: (2165515, 158)
INFO:main.py:df sample:    permno  gvkey   adatadate  fyear  sic2     spi       mve_f  ...     zerotrade      beta    betasq      rsq1  pricedelay   idiovol  pyear
0   10006   1010  12/31/1978   1978    37  0.0000  269.308500  ...  1.115306e-07  1.060420  1.124491  0.343408    0.029859  0.025576   1980
1   10057   1098  09/30/1978   1978    36  0.0000   97.372000  ...  6.199128e-08  1.526013  2.328716  0.307905    0.092667  0.037473   1980
2   10103   1012  10/31/1978   1978    33     NaN    1.697500  ...           NaN  1.759493  3.095816  0.096753    0.221851  0.087020   1980
3   10137   1279  12/31/1978   1978    49     NaN  537.524500  ...  9.726790e-08  0.492885  0.242936  0.189693    0.125777  0.017540   1980
4   10145   1300  12/31/1978   1978    99 -0.0031  805.633282  ...  6.190654e-08  1.139163  1.297691  0.279437    0.024228  0.031201   1980

[5 rows x 158 columns]
INFO:main.py:Train year start: 1980
INFO:main.py:Prediction data years: [1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020]
INFO:main.py:

Loop through all the prediction years and build optimized model for each year

INFO:main.py:

Transform data

INFO:transform_data_nn.py:Train data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:transform_data_nn.py:Train_data: (1882679, 158)

INFO:transform_data_nn.py:Test data years: [2014]
INFO:transform_data_nn.py:Test_data: (40537, 158)

INFO:transform_data_nn.py:Retrain data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014]
INFO:transform_data_nn.py:Retrain_data: (1923216, 158)

INFO:transform_data_nn.py:Prediction data years: [2015]
INFO:transform_data_nn.py:Prediction_data: (41197, 158)

INFO:main.py:

Generate X and y with train_data and test_data

INFO:main.py:
            x_train_tf: torch.Size([1882679, 103])
            y_train_tf: torch.Size([1882679])

            x_test_tf: torch.Size([40537, 103])
            y_test_tf: torch.Size([40537])

        
INFO:main.py:

Generate X and y with retrain_data and prediction_data

INFO:main.py:
            x_retrain_tf: torch.Size([1923216, 103])
            y_retrain_tf: torch.Size([1923216])

            x_prediction_tf: torch.Size([41197, 103])
            y_prediction_tf: torch.Size([41197])

        
INFO:main.py:

Create dataset

INFO:main.py:Create train_dataset
INFO:main.py:train_dataset first example: (tensor([ 1.9805e-01,  1.1929e+00,  7.9028e-02, -9.4097e-01,  2.1510e-02,
        -6.0508e-01, -2.8910e-02, -2.6827e-01,  7.2547e-01, -3.2288e-01,
        -7.7108e-01,  2.1590e-02, -7.2063e-01, -5.7781e-01, -4.0247e-01,
         1.4122e-02, -3.7462e-01,  1.3879e-01, -9.8145e-02,  9.2092e-01,
        -4.9027e-01, -1.7344e-01, -2.8397e-01,  5.1624e-03, -7.1720e-02,
        -3.0092e-01, -5.3585e-01, -1.0321e-01,  6.3611e-01,  1.8472e+00,
         3.6142e-01, -1.4889e-01,  9.2551e-01,  2.5621e-01, -3.1644e-01,
        -2.2718e-01,  1.8191e-01,  5.3173e-01, -9.4360e-03, -1.1175e+00,
        -2.0046e-01,  2.2394e-01,  5.3814e-01,  1.4488e-01, -4.4704e-02,
        -7.0271e-01,  7.7202e-02, -6.5904e-02, -4.3374e-01, -1.5220e-01,
        -4.7231e-01,  5.3970e-01, -4.6963e-01,  2.3198e-01, -9.4925e-03,
        -2.4283e-01, -6.3228e-01, -4.8792e-01, -5.5122e-01, -1.7649e-01,
        -2.4337e-02, -5.5908e-01, -6.2127e-01, -4.3915e-01, -3.6707e-01,
        -4.3795e-01,  1.1808e+00, -2.8103e-01, -7.3692e-01, -5.8831e-01,
        -6.1301e-01, -4.5760e-01, -1.2279e-03, -8.5698e-01,  2.9652e-01,
        -6.4073e-01,  3.1369e-01,  3.7569e-01,  9.2014e-01,  9.0140e-01,
        -1.3074e+00,  2.1678e-01,  2.8689e-03, -7.7299e-01, -8.2242e-02,
         4.6031e-01, -4.4363e-02, -8.7040e-01, -7.8820e-01, -8.7306e-01,
         9.9373e-02,  3.2455e-02,  3.3200e-02, -5.4273e-01, -4.6573e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2120]), tensor(0.2117))
INFO:main.py:Create test_dataset
INFO:main.py:test_dataset first example: (tensor([-6.6620e-01, -7.6716e-03, -7.8029e-01,  9.7950e-01, -1.1126e-01,
        -3.9356e-01, -1.1918e+00, -8.3599e-01,  4.0991e-01, -1.7166e-01,
        -7.3205e-01, -1.0336e-01, -7.2063e-01,  8.5609e-02, -3.5721e-01,
        -3.5301e-01, -3.0068e-01,  2.0732e-03,  1.8431e-01, -4.2583e-01,
        -8.0421e-01, -1.9666e-01, -3.1832e-01, -1.7572e-01,  5.1240e-02,
        -8.3500e-01, -6.1269e-01, -1.0321e-01,  6.3611e-01,  1.4738e+00,
        -1.6230e-01, -2.4390e-01,  2.9936e-01,  2.5621e-01, -8.1808e-01,
         1.5731e-01,  6.5317e-01, -5.2823e-01, -2.2302e-01, -1.2105e+00,
        -2.0073e-01,  2.4320e-01,  4.4868e-01, -2.1374e-01, -7.8380e-02,
        -6.5890e-01, -3.0483e-01, -4.3363e-01, -4.4071e-01, -5.5395e-01,
        -1.1038e+00,  5.3970e-01, -4.6963e-01, -8.5560e-01, -7.7203e-01,
        -6.9342e-01,  1.7239e-02, -6.2188e-01, -4.1743e-01, -2.7738e-01,
         1.0637e-01, -3.6400e-01,  4.2358e-01, -7.8803e-01, -1.8633e-02,
         6.4148e-02, -4.5177e-01, -5.7258e-01,  4.5704e-01, -6.8276e-01,
        -6.5233e-03,  7.7626e-02, -1.2279e-03, -6.7796e-01, -4.8214e-02,
        -2.1020e-01, -1.1471e-01,  1.6934e-01,  1.6584e-01,  9.0140e-01,
         8.0760e-01, -1.7762e-01,  2.8689e-03,  8.2813e-01, -4.3626e-01,
        -3.0642e-01, -1.2573e+00,  5.2368e-02, -6.9311e-01, -8.1795e-01,
         1.3700e-01, -4.1840e-01, -6.9120e-01,  5.6514e-01, -4.6573e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2508]), tensor(0.1476))
INFO:main.py:Create retrain_dataset
INFO:main.py:retrain_dataset first example: (tensor([ 2.0261e-01,  1.2030e+00,  7.7160e-02, -9.5301e-01,  2.4184e-02,
        -6.0299e-01, -3.1998e-02, -2.7031e-01,  7.3161e-01, -3.2260e-01,
        -7.7211e-01,  2.3038e-02, -7.2163e-01, -5.8269e-01, -3.9860e-01,
         1.2343e-02, -3.7150e-01,  1.3976e-01, -9.7562e-02,  9.3111e-01,
        -4.8866e-01, -1.7234e-01, -2.9001e-01,  5.9865e-03, -7.3111e-02,
        -3.0129e-01, -5.3486e-01, -1.0612e-01,  6.3604e-01,  1.8485e+00,
         3.6312e-01, -1.4798e-01,  9.2853e-01,  2.5977e-01, -3.1201e-01,
        -2.2697e-01,  1.8420e-01,  5.3606e-01, -7.5655e-03, -1.1097e+00,
        -1.9868e-01,  2.1932e-01,  5.4677e-01,  1.4390e-01, -4.2154e-02,
        -6.9834e-01,  7.4425e-02, -6.5330e-02, -4.3494e-01, -1.5329e-01,
        -4.7699e-01,  5.4194e-01, -4.7066e-01,  2.3565e-01, -6.6083e-03,
        -2.4030e-01, -6.2391e-01, -4.8694e-01, -5.5280e-01, -1.7489e-01,
        -2.5411e-02, -5.6088e-01, -6.2457e-01, -4.3938e-01, -3.6671e-01,
        -4.3851e-01,  1.1935e+00, -2.7868e-01, -7.4402e-01, -5.8887e-01,
        -6.1319e-01, -4.6424e-01, -1.0755e-03, -8.5199e-01,  2.9782e-01,
        -6.3685e-01,  3.1135e-01,  3.7504e-01,  9.3055e-01,  9.0855e-01,
        -1.3097e+00,  2.1281e-01,  2.9228e-03, -8.0592e-01, -7.8568e-02,
         4.6733e-01, -2.8072e-02, -8.7221e-01, -7.9038e-01, -8.6859e-01,
         9.9307e-02,  3.7247e-02,  3.5178e-02, -5.4804e-01, -4.6007e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2144]), tensor(0.2117))
INFO:main.py:Create prediction_dataset
INFO:main.py:prediction_dataset first example: (tensor([-4.6477e-01, -1.6329e-01, -5.7385e-01,  9.7166e-01,  1.0560e-02,
        -4.4649e-01, -9.3859e-01, -7.7028e-01,  7.0123e-01, -8.5424e-02,
        -7.3104e-01, -2.8118e-02, -7.2163e-01,  2.6148e-01, -3.2232e-01,
         2.4876e-01,  4.0908e-01,  5.4068e-01, -3.3353e-02, -1.1343e-01,
        -6.8954e-01, -8.5314e-01, -5.2115e-01, -3.1027e-01,  1.6108e-01,
        -7.7487e-01, -6.0807e-01, -1.0612e-01,  6.3604e-01,  1.6133e+00,
        -7.7281e-01,  1.6118e-01,  5.1671e-01,  2.5977e-01, -7.8137e-01,
        -4.0242e-01,  1.9530e-01, -5.4869e-01,  2.7720e-01, -9.7963e-01,
        -1.9840e-01,  1.1506e-02,  2.3899e-01, -2.1021e-01, -2.2510e-01,
        -7.7474e-01,  6.0927e-01, -3.0303e-01, -6.7744e-01,  1.4414e-01,
         1.5348e-01,  5.4194e-01, -4.7066e-01, -8.6122e-01, -7.7126e-01,
        -6.5111e-01,  1.7151e-02, -4.8938e-01,  2.0673e-01, -1.9556e-01,
        -1.2346e-01,  2.1711e-01,  3.1240e-01,  1.5820e-02, -1.8926e-02,
        -7.9046e-02, -4.4862e-01,  3.8029e-02,  1.6433e+00, -6.2008e-01,
        -3.3311e-03,  8.0683e-02, -1.0755e-03, -8.6619e-01, -8.6403e-02,
        -3.8545e-01, -1.4906e-01,  1.9993e-01,  1.6000e-01,  4.2635e-01,
         8.0761e-01, -1.4727e-01,  2.9228e-03,  8.0778e-01,  1.0628e-01,
        -2.1268e-01, -1.0824e+00, -5.9950e-01, -6.9591e-01, -8.1839e-01,
        -2.9373e-02, -1.7664e-01, -2.4082e-01, -2.4063e-01, -4.6007e-01,
         0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,  0.0000e+00,
         0.0000e+00,  0.0000e+00]), tensor([2580]), tensor(-0.1152))
INFO:main.py:

Create dataloader

INFO:main.py:Create train and test dataloader
INFO:main.py:Create retrain and prediction dataloader
INFO:main.py:

Hyperparameters tuning with Ray Tune

INFO:main.py:Training data years: [1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013]
INFO:main.py:Testing data year: 2014
INFO:main.py:

            ray_results_path: /zfs/projects/darc/wolee_edehaan_suzienoh-exploratory-ml/kevin/ray_results
            num_samples: 60
            max_num_epochs: 20
            num_cpus: 60
            cpus_per_trial: 1
            num_gpus: 0
            gpus_per_trial: 0
            continuous_dim: 102
            num_embeddings: 17893
            device: cpu
            
slurmstepd-yen15: error: *** JOB 412275 ON yen15 CANCELLED AT 2024-07-08T21:01:26 ***
